{"version":3,"file":"main-DP9hIrqg.js","sources":["../../node_modules/kaplay/dist/kaplay.mjs","../../src/systems/nameGenerator.js","../../src/data/achievements.js","../../src/data/unlocks.js","../../src/systems/metaProgression.js","../../src/systems/inputSystem.js","../../src/data/weapons.js","../../src/config/constants.js","../../src/entities/player.js","../../src/systems/networkSystem.js","../../src/systems/partySystem.js","../../src/data/bosses.js","../../src/entities/boss.js","../../src/systems/powerupWeapons.js","../../src/entities/pickup.js","../../src/utils/seededRandom.js","../../src/systems/connectionQuality.js","../../src/systems/upgrades.js","../../src/config/uiConfig.js","../../src/systems/toastNotifications.js","../../src/systems/multiplayerGame.js","../../src/systems/objectPool.js","../../src/entities/projectile.js","../../src/data/enemies.js","../../src/systems/pathfinding.js","../../src/entities/enemy.js","../../src/data/minibosses.js","../../src/entities/miniboss.js","../../src/entities/door.js","../../src/entities/obstacle.js","../../src/entities/barrel.js","../../src/systems/spatialGrid.js","../../src/systems/sounds.js","../../src/systems/particleSystem.js","../../src/systems/settings.js","../../src/systems/visualEffects.js","../../src/systems/combat.js","../../src/systems/tutorial.js","../../src/systems/synergies.js","../../src/scenes/upgradeDraft.js","../../src/systems/progression.js","../../src/systems/enemySpawn.js","../../src/systems/eliteSystem.js","../../src/systems/roomGeneration.js","../../src/systems/achievementChecker.js","../../src/systems/floorMap.js","../../src/systems/minimap.js","../../src/systems/floorTheming.js","../../src/core/GameState.js","../../src/core/InputManager.js","../../src/core/NetworkManager.js","../../src/scenes/game.js","../../src/data/portraits.js","../../src/systems/dailyRuns.js","../../src/scenes/menu.js","../../src/components/achievementModal.js","../../src/systems/onlineLeaderboards.js","../../src/systems/leaderboards.js","../../src/config/uiComponents.js","../../src/scenes/gameOver.js","../../src/scenes/shop.js","../../src/scenes/settings.js","../../src/scenes/statistics.js","../../src/scenes/characterSelect.js","../../src/scenes/joinParty.js","../../src/scenes/leaderboards.js","../../src/scenes/profile.js","../../src/main.js"],"sourcesContent":["var Oo=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return n=>{for(var r=n.length,o=new Uint8Array((r-(n[r-1]==\"=\")-(n[r-2]==\"=\"))*3/4|0),s=0,i=0;s<r;){var m=t[n.charCodeAt(s++)],u=t[n.charCodeAt(s++)],c=t[n.charCodeAt(s++)],p=t[n.charCodeAt(s++)];o[i++]=m<<2|u>>4,o[i++]=u<<4|c>>2,o[i++]=c<<6|p}return o}})();var Ao={name:\"kaplay\",description:\"KAPLAY is a JavaScript & TypeScript game library that helps you make games fast and fun! (formerly known as Kaboom.js)\",version:\"3001.0.19\",license:\"MIT\",homepage:\"https://kaplayjs.com/\",bugs:{url:\"https://github.com/kaplayjs/kaplay/issues\"},funding:{type:\"opencollective\",url:\"https://opencollective.com/kaplay\"},repository:{type:\"git\",url:\"git+https://github.com/kaplayjs/kaplay.git\"},type:\"module\",main:\"./dist/kaplay.cjs\",module:\"./dist/kaplay.mjs\",types:\"./dist/doc.d.ts\",readme:\"./README.md\",exports:{\".\":{import:{types:\"./dist/doc.d.ts\",default:\"./dist/kaplay.mjs\"},require:{types:\"./dist/doc.d.ts\",default:\"./dist/kaplay.cjs\"}},\"./global\":\"./dist/declaration/global.js\"},typesVersions:{\"*\":{global:[\"./dist/declaration/global.d.ts\"]}},keywords:[\"game development\",\"javascript\",\"typescript\",\"game engine\",\"2d games\",\"physics engine\",\"webgl\",\"canvas\",\"game library\",\"kaplay\",\"kaboom\",\"kaboomjs\",\"kaboom.js\"],files:[\"dist/\",\"kaplay.webp\",\"CHANGELOG.md\"],scripts:{dev:\"NODE_ENV=development node scripts/dev.js\",\"win:dev\":\"set NODE_ENV=development && node scripts/dev.js\",build:\"node scripts/generateIndex.js && npm run doc-dts && node scripts/build.js\",\"build:fast\":\"node scripts/buildFast.js\",check:\"tsc\",fmt:\"dprint fmt\",test:\"node scripts/test.js\",\"doc-dts\":\"dts-bundle-generator -o dist/doc.d.ts src/index.ts\",\"test:vite\":\"vitest --typecheck\",desktop:\"tauri dev\",prepare:\"npm run build\",\"publish:next\":\"npm publish --tag next\"},devDependencies:{\"@kaplayjs/dprint-config\":\"^1.2.0\",\"@types/jest\":\"^29.5.14\",dprint:\"^0.49.1\",\"dts-bundle-generator\":\"^9.5.1\",ejs:\"^3.1.10\",esbuild:\"^0.25.2\",express:\"^5.1.0\",puppeteer:\"^22.15.0\",\"tar-fs\":\"3.0.8\",typescript:\"5.6.3\",vite:\"5.4.16\",vitest:\"^3.1.1\",\"vitest-environment-puppeteer\":\"^11.0.3\",\"vitest-puppeteer\":\"^11.0.3\"},engines:{node:\">=20.0.0\"},packageManager:\"pnpm@9.9.0+sha512.60c18acd138bff695d339be6ad13f7e936eea6745660d4cc4a776d5247c540d0edee1a563695c183a66eb917ef88f2b4feb1fc25f32a7adcadc7aaf3438e99c1\"};function Te(t,e,n){return e>n?Te(t,n,e):Math.min(Math.max(t,e),n)}var j=class t{r=255;g=255;b=255;constructor(e,n,r){this.r=Te(e,0,255),this.g=Te(n,0,255),this.b=Te(r,0,255)}static fromArray(e){return new t(e[0],e[1],e[2])}static fromHex(e){if(typeof e==\"number\")return new t(e>>16&255,e>>8&255,e>>0&255);if(typeof e==\"string\"){let n=/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(e);if(!n)throw new Error(\"Invalid hex color format\");return new t(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}else throw new Error(\"Invalid hex color format\")}static fromHSL(e,n,r){if(n==0)return new t(255*r,255*r,255*r);let o=(p,b,l)=>(l<0&&(l+=1),l>1&&(l-=1),l<1/6?p+(b-p)*6*l:l<1/2?b:l<2/3?p+(b-p)*(2/3-l)*6:p),s=r<.5?r*(1+n):r+n-r*n,i=2*r-s,m=o(i,s,e+1/3),u=o(i,s,e),c=o(i,s,e-1/3);return new t(Math.round(m*255),Math.round(u*255),Math.round(c*255))}static RED=new t(255,0,0);static GREEN=new t(0,255,0);static BLUE=new t(0,0,255);static YELLOW=new t(255,255,0);static MAGENTA=new t(255,0,255);static CYAN=new t(0,255,255);static WHITE=new t(255,255,255);static BLACK=new t(0,0,0);clone(){return new t(this.r,this.g,this.b)}lighten(e){return new t(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(e){return new t(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,n){return new t(de(this.r,e.r,n),de(this.g,e.g,n),de(this.b,e.b,n))}toHSL(){let e=this.r/255,n=this.g/255,r=this.b/255,o=Math.max(e,n,r),s=Math.min(e,n,r),i=(o+s)/2,m=i,u=i;if(o==s)i=m=0;else{let c=o-s;switch(m=u>.5?c/(2-o-s):c/(o+s),o){case e:i=(n-r)/c+(n<r?6:0);break;case n:i=(r-e)/c+2;break;case r:i=(e-n)/c+4;break}i/=6}return[i,m,u]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return\"#\"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}};function I(...t){if(t.length===0)return new j(255,255,255);if(t.length===1){if(t[0]instanceof j)return t[0].clone();if(typeof t[0]==\"string\")return j.fromHex(t[0]);if(Array.isArray(t[0])&&t[0].length===3)return j.fromArray(t[0])}else if(t.length===2){if(t[0]instanceof j)return t[0].clone()}else if(t.length===3||t.length===4)return new j(t[0],t[1],t[2]);throw new Error(\"Invalid color arguments\")}var So=(t,e,n)=>j.fromHSL(t,e,n);function ae(t){return t*Math.PI/180}function lt(t){return t*180/Math.PI}function de(t,e,n){if(typeof t==\"number\"&&typeof e==\"number\")return t+(e-t)*n;if(t instanceof E&&e instanceof E)return t.lerp(e,n);if(t instanceof j&&e instanceof j)return t.lerp(e,n);throw new Error(`Bad value for lerp(): ${t}, ${e}. Only number, Vec2 and Color is supported.`)}function Se(t,e,n,r,o){return r+(t-e)/(n-e)*(o-r)}function Po(t,e,n,r,o){return Te(Se(t,e,n,r,o),r,o)}var E=class t{x=0;y=0;constructor(e=0,n=e){this.x=e,this.y=n}static fromAngle(e){let n=ae(e);return new t(Math.cos(n),Math.sin(n))}static fromArray(e){return new t(e[0],e[1])}static ZERO=new t(0,0);static ONE=new t(1,1);static LEFT=new t(-1,0);static RIGHT=new t(1,0);static UP=new t(0,-1);static DOWN=new t(0,1);clone(){return new t(this.x,this.y)}add(...e){let n=v(...e);return new t(this.x+n.x,this.y+n.y)}sub(...e){let n=v(...e);return new t(this.x-n.x,this.y-n.y)}scale(...e){let n=v(...e);return new t(this.x*n.x,this.y*n.y)}dist(...e){let n=v(...e);return this.sub(n).len()}sdist(...e){let n=v(...e);return this.sub(n).slen()}static sdist(e,n){let r=e.x-n.x,o=e.y-n.y;return r*r+o*o}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new t(0):this.scale(1/e)}normal(){return new t(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}static dot(e,n){return e.x*n.x+e.y*n.y}cross(e){return this.x*e.y-this.y*e.x}static cross(e,n){return e.x*n.y-e.y*n.x}angle(...e){let n=v(...e);return lt(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...e){let n=v(...e);return lt(Math.atan2(this.cross(n),this.dot(n)))}lerp(e,n){return new t(de(this.x,e.x,n),de(this.y,e.y,n))}slerp(e,n){let r=this.dot(e),o=this.cross(e),s=Math.atan2(o,r);return this.scale(Math.sin((1-n)*s)).add(e.scale(Math.sin(n*s))).scale(1/o)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new t(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new W(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}};function v(...t){if(t.length===1){if(t[0]instanceof E)return new E(t[0].x,t[0].y);if(Array.isArray(t[0])&&t[0].length===2)return new E(...t[0])}return new E(...t)}var q=class t{x=0;y=0;w=1;h=1;constructor(e,n,r,o){this.x=e,this.y=n,this.w=r,this.h=o}scale(e){return new t(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new E(this.x,this.y)}clone(){return new t(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function le(t,e,n,r){return new q(t,e,n,r)}var Dt=class t{a;b;c;d;constructor(e,n,r,o){this.a=e,this.b=n,this.c=r,this.d=o}mul(e){return new t(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return v(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new t(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new t(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,n=this.det,r=e+Math.sqrt(e*e-n),o=e-Math.sqrt(e*e-n);return[r,o]}eigenvectors(e,n){return this.c!=0?[[e-this.d,this.c],[n-this.d,this.c]]:this.b!=0?[[this.b,e-this.a],[this.b,n-this.a]]:Math.abs(this.transform(v(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let n=Math.cos(e),r=Math.sin(e);return new t(n,r,-r,n)}static scale(e,n){return new t(e,0,0,n)}};var bt=class t{m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(e,n,r,o,s,i,m,u,c){this.m11=e,this.m12=n,this.m13=r,this.m21=o,this.m22=s,this.m23=i,this.m31=m,this.m32=u,this.m33=c}static fromMat2(e){return new t(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new Dt(this.m11,this.m12,this.m21,this.m22)}mul(e){return new t(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let n=Math.cos(e),r=Math.sin(e),o=this.m11,s=this.m12;return this.m11=n*this.m11+r*this.m21,this.m12=n*this.m12+r*this.m22,this.m21=n*this.m21-r*o,this.m22=n*this.m22-r*s,this}scale(e,n){return this.m11*=e,this.m12*=e,this.m21*=n,this.m22*=n,this}get inverse(){let e=this.det;return new t((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new t(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},fe=class t{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new t([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new t([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=ae(-e);let n=Math.cos(e),r=Math.sin(e);return new t([1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1])}static rotateY(e){e=ae(-e);let n=Math.cos(e),r=Math.sin(e);return new t([n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1])}static rotateZ(e){e=ae(-e);let n=Math.cos(e),r=Math.sin(e);return new t([n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=ae(-e);let n=Math.cos(e),r=Math.sin(e),o=this.m[0],s=this.m[1],i=this.m[4],m=this.m[5];return this.m[0]=o*n+s*r,this.m[1]=-o*r+s*n,this.m[4]=i*n+m*r,this.m[5]=-i*r+m*n,this}mult(e){let n=[];for(let r=0;r<4;r++)for(let o=0;o<4;o++)n[r*4+o]=this.m[0*4+o]*e.m[r*4+0]+this.m[1*4+o]*e.m[r*4+1]+this.m[2*4+o]*e.m[r*4+2]+this.m[3*4+o]*e.m[r*4+3];return new t(n)}multVec2(e){return new E(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new E(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(n,e/n)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(e/n,n)}else return new E(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return lt(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return lt(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new E(0,0)}invert(){let e=[],n=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],o=this.m[9]*this.m[14]-this.m[13]*this.m[10],s=this.m[8]*this.m[15]-this.m[12]*this.m[11],i=this.m[8]*this.m[14]-this.m[12]*this.m[10],m=this.m[8]*this.m[13]-this.m[12]*this.m[9],u=this.m[6]*this.m[15]-this.m[14]*this.m[7],c=this.m[5]*this.m[15]-this.m[13]*this.m[7],p=this.m[5]*this.m[14]-this.m[13]*this.m[6],b=this.m[4]*this.m[15]-this.m[12]*this.m[7],l=this.m[4]*this.m[14]-this.m[12]*this.m[6],h=this.m[5]*this.m[15]-this.m[13]*this.m[7],d=this.m[4]*this.m[13]-this.m[12]*this.m[5],C=this.m[6]*this.m[11]-this.m[10]*this.m[7],g=this.m[5]*this.m[11]-this.m[9]*this.m[7],y=this.m[5]*this.m[10]-this.m[9]*this.m[6],O=this.m[4]*this.m[11]-this.m[8]*this.m[7],A=this.m[4]*this.m[10]-this.m[8]*this.m[6],R=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*n-this.m[6]*r+this.m[7]*o,e[4]=-(this.m[4]*n-this.m[6]*s+this.m[7]*i),e[8]=this.m[4]*r-this.m[5]*s+this.m[7]*m,e[12]=-(this.m[4]*o-this.m[5]*i+this.m[6]*m),e[1]=-(this.m[1]*n-this.m[2]*r+this.m[3]*o),e[5]=this.m[0]*n-this.m[2]*s+this.m[3]*i,e[9]=-(this.m[0]*r-this.m[1]*s+this.m[3]*m),e[13]=this.m[0]*o-this.m[1]*i+this.m[2]*m,e[2]=this.m[1]*u-this.m[2]*c+this.m[3]*p,e[6]=-(this.m[0]*u-this.m[2]*b+this.m[3]*l),e[10]=this.m[0]*h-this.m[1]*b+this.m[3]*d,e[14]=-(this.m[0]*p-this.m[1]*l+this.m[2]*d),e[3]=-(this.m[1]*C-this.m[2]*g+this.m[3]*y),e[7]=this.m[0]*C-this.m[2]*O+this.m[3]*A,e[11]=-(this.m[0]*g-this.m[1]*O+this.m[3]*R),e[15]=this.m[0]*y-this.m[1]*A+this.m[2]*R;let V=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let x=0;x<4;x++)for(let w=0;w<4;w++)e[x*4+w]*=1/V;return new t(e)}clone(){return new t([...this.m])}toString(){return this.m.toString()}};function An(t,e,n,r=o=>-Math.cos(o)){return t+(r(n)+1)/2*(e-t)}var tu=1103515245,nu=12345,Vo=2147483648,Xt=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(tu*this.seed+nu)%Vo,this.seed/Vo}genNumber(e,n){return e+this.gen()*(n-e)}genVec2(e,n){return new E(this.genNumber(e.x,n.x),this.genNumber(e.y,n.y))}genColor(e,n){return new j(this.genNumber(e.r,n.r),this.genNumber(e.g,n.g),this.genNumber(e.b,n.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]==\"number\")return this.genNumber(0,e[0]);if(e[0]instanceof E)return this.genVec2(v(0,0),e[0]);if(e[0]instanceof j)return this.genColor(I(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]==\"number\"&&typeof e[1]==\"number\")return this.genNumber(e[0],e[1]);if(e[0]instanceof E&&e[1]instanceof E)return this.genVec2(e[0],e[1]);if(e[0]instanceof j&&e[1]instanceof j)return this.genColor(e[0],e[1])}throw new Error(\"More than 2 arguments not supported\")}},wr=new Xt(Date.now());function Go(t){return t!=null&&(wr.seed=t),wr.seed}function he(...t){return wr.genAny(...t)}function Cr(...t){return Math.floor(he(...t.length>0?t:[2]))}function Mo(t){return he()<=t}function Er(t){for(let e=t.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function Ro(t,e){return t.length<=e?t.slice():Er(t.slice()).slice(0,e)}function Do(t){return t[Cr(t.length)]}function Tr(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}function ru(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let n=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(n===0)return null;let r=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/n,o=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/n;return r<0||r>1||o<0||o>1?null:r}function Sn(t,e){let n=ru(t,e);return n?v(t.p1.x+n*(t.p2.x-t.p1.x),t.p1.y+n*(t.p2.y-t.p1.y)):null}function Vn(t,e){let n=e.p2.sub(e.p1),r=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;if(n.x!=0){let s=(t.pos.x-e.p1.x)/n.x,i=(t.pos.x+t.width-e.p1.x)/n.x;r=Math.max(r,Math.min(s,i)),o=Math.min(o,Math.max(s,i))}if(n.y!=0){let s=(t.pos.y-e.p1.y)/n.y,i=(t.pos.y+t.height-e.p1.y)/n.y;r=Math.max(r,Math.min(s,i)),o=Math.min(o,Math.max(s,i))}return o>=r&&o>=0&&r<=1}function Bt(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}function Bo(t,e){let n=Math.max(t.pos.x,Math.min(e.center.x,t.pos.x+t.width)),r=Math.max(t.pos.y,Math.min(e.center.y,t.pos.y+t.height));return v(n,r).sdist(e.center)<=e.radius*e.radius}function Fo(t,e){return Lo(e,new be(t.points()))}function Pn(t,e){let n=e.sub(t.p1),r=t.p2.sub(t.p1);if(Math.abs(n.cross(r))>Number.EPSILON)return!1;let o=n.dot(r)/r.dot(r);return o>=0&&o<=1}function Ft(t,e){let n=t.p2.sub(t.p1),r=n.dot(n),o=t.p1.sub(e.center),s=2*n.dot(o),i=o.dot(o)-e.radius*e.radius,m=s*s-4*r*i;if(r<=Number.EPSILON||m<0)return!1;if(m==0){let u=-s/(2*r);if(u>=0&&u<=1)return!0}else{let u=(-s+Math.sqrt(m))/(2*r),c=(-s-Math.sqrt(m))/(2*r);if(u>=0&&u<=1||c>=0&&c<=1)return!0}return Gn(e,t.p1)}function Or(t,e){if(et(e,t.p1)||et(e,t.p2))return!0;for(let n=0;n<e.pts.length;n++){let r=e.pts[n],o=e.pts[(n+1)%e.pts.length];if(Sn(t,new Oe(r,o)))return!0}return!1}function Gn(t,e){return t.center.sdist(e)<t.radius*t.radius}function ou(t,e){return t.center.sdist(e.center)<(t.radius+e.radius)*(t.radius+e.radius)}function Qt(t,e){let n=e.pts[e.pts.length-1];for(let r of e.pts){if(Ft(new Oe(n,r),t))return!0;n=r}return Gn(t,e.pts[0])?!0:et(e,t.center)}function Lo(t,e){for(let n=0;n<t.pts.length;n++)if(Or(new Oe(t.pts[n],t.pts[(n+1)%t.pts.length]),e))return!0;return!!(t.pts.some(n=>et(e,n))||e.pts.some(n=>et(t,n)))}function et(t,e){let n=!1,r=t.pts;for(let o=0,s=r.length-1;o<r.length;s=o++)r[o].y>e.y!=r[s].y>e.y&&e.x<(r[s].x-r[o].x)*(e.y-r[o].y)/(r[s].y-r[o].y)+r[o].x&&(n=!n);return n}function Ar(t,e){e=e.sub(t.center);let n=ae(t.angle),r=Math.cos(n),o=Math.sin(n),s=e.x*r+e.y*o,i=-e.x*o+e.y*r;return s*s/(t.radiusX*t.radiusX)+i*i/(t.radiusY*t.radiusY)<1}function Tn(t,e){let n=e.center.sub(t.center),r=ae(t.angle),o=Math.cos(r),s=Math.sin(r),i=n.x*o+n.y*s,m=-n.x*s+n.y*o;return Ar(new Ke(v(),t.radiusX+e.radius,t.radiusY+e.radius,0),v(i,m))}function jo(t,e){let n=t.toMat2().inverse;return e=new Oe(n.transform(e.p1.sub(t.center)),n.transform(e.p2.sub(t.center))),Ft(e,new we(v(),1))}function su(t,e){if(t.radiusX===t.radiusY)return Tn(e,new we(t.center,t.radiusX));if(e.radiusX===e.radiusY)return Tn(t,new we(e.center,e.radiusX));let n=new bt(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),r=new bt(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),o=t.center.x,s=t.center.y,i=e.center.x,m=e.center.y,u=ae(t.angle),c=ae(e.angle),p=new bt(Math.cos(u),-Math.sin(u),o,Math.sin(u),Math.cos(u),s,0,0,1),b=new bt(Math.cos(c),-Math.sin(c),i,Math.sin(c),Math.cos(c),m,0,0,1),l=p.inverse,h=b.inverse,d=l.transpose.mul(n).mul(l),C=h.transpose.mul(r).mul(h),g=d.m11,y=d.m12,O=d.m13,A=d.m21,R=d.m22,V=d.m23,x=d.m31,w=d.m32,S=d.m33,G=C.m11,M=C.m12,D=C.m13,L=C.m21,U=C.m22,H=C.m23,Y=C.m31,_=C.m32,K=C.m33,J=g*R*S-g*V*w-y*A*S+y*V*x+O*A*w-O*R*x,$=(g*R*K-g*V*_-g*w*H+g*S*U-y*A*K+y*V*Y+y*x*H-y*S*L+O*A*_-O*R*Y-O*x*U+O*w*L+A*w*D-A*S*M-R*x*D+R*S*G+V*x*M-V*w*G)/J,Z=(g*U*K-g*H*_-y*L*K+y*H*Y+O*L*_-O*U*Y-A*M*K+A*D*_+R*G*K-R*D*Y-V*G*_+V*M*Y+x*M*H-x*D*U-w*G*H+w*D*L+S*G*U-S*M*L)/J,Ee=(G*U*K-G*H*_-M*L*K+M*H*Y+D*L*_-D*U*Y)/J;if($>=0){let k=-3*Z+$**2,gt=3*$*Ee+Z*$**2-4*Z**2,Gt=-27*Ee**2+18*Ee*$*Z+$**2*Z**2-4*$**3*Ee-4*Z**3;return!(k>0&&gt<0&&Gt>0)}else{let k=-3*Z+$**2,gt=-27*Ee**2+18*Ee*$*Z+$**2*Z**2-4*$**3*Ee-4*Z**3;return!(k>0&&gt>0)}}function Io(t,e){return Sr(t,new be(e.points()))}function Sr(t,e){let n=t.toMat2().inverse;return e=new be(e.pts.map(r=>n.transform(r.sub(t.center)))),Qt(new we(v(),1),e)}function iu(t,e){return t.x===e.x&&t.y===e.y}function au(t,e){return e instanceof E?iu(e,t.pt):e instanceof we?Gn(e,t.pt):e instanceof Oe?Pn(e,t.pt):e instanceof W?Bt(e,t.pt):e instanceof be?et(e,t.pt):e instanceof Ke?Ar(e,t.pt):!1}function uu(t,e){return e instanceof E?Pn(t,e):e instanceof we?Ft(t,e):e instanceof Oe?Sn(t,e)!=null:e instanceof W?Vn(e,t):e instanceof be?Or(t,e):e instanceof Ke?jo(e,t):!1}function cu(t,e){return e instanceof E?Gn(t,e):e instanceof we?ou(t,e):e instanceof Oe?Ft(e,t):e instanceof W?Bo(e,t):e instanceof be?Qt(t,e):e instanceof Ke?Tn(e,t):!1}function lu(t,e){return e instanceof E?Bt(t,e):e instanceof we?Bo(t,e):e instanceof Oe?Vn(t,e):e instanceof W?Tr(t,e):e instanceof be?Fo(t,e):e instanceof Ke?Io(e,t):!1}function mu(t,e){return e instanceof E?et(t,e):e instanceof we?Qt(e,t):e instanceof Oe?Or(e,t):e instanceof W?Fo(e,t):e instanceof be?Lo(e,t):e instanceof Ke?Sr(e,t):!1}function pu(t,e){return e instanceof E?Ar(t,e):e instanceof we?Tn(t,e):e instanceof Oe?jo(t,e):e instanceof W?Io(t,e):e instanceof be?Sr(t,e):e instanceof Ke?su(e,t):!1}function Ko(t,e,n){let r=t,o=n.p1,s=n.p2,i=e,m=s.sub(o),u=i.cross(m);if(Math.abs(u)<Number.EPSILON)return null;let c=o.sub(r),p=c.cross(m)/u;if(p<=0||p>=1)return null;let b=c.cross(i)/u;if(b<=0||b>=1)return null;let l=m.normal().unit();return e.dot(l)>0&&(l.x*=-1,l.y*=-1),{point:r.add(i.scale(p)),normal:l,fraction:p}}function du(t,e,n){let r=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,s;if(t.x!=0){let i=(n.pos.x-t.x)/e.x,m=(n.pos.x+n.width-t.x)/e.x;s=v(-Math.sign(e.x),0),r=Math.max(r,Math.min(i,m)),o=Math.min(o,Math.max(i,m))}if(t.y!=0){let i=(n.pos.y-t.y)/e.y,m=(n.pos.y+n.height-t.y)/e.y;Math.min(i,m)>r&&(s=v(0,-Math.sign(e.y))),r=Math.max(r,Math.min(i,m)),o=Math.min(o,Math.max(i,m))}return o>=r&&r>=0&&r<=1?{point:t.add(e.scale(r)),normal:s,fraction:r}:null}function ko(t,e,n){let r=t,o=n.center,s=e,i=s.dot(s),m=r.sub(o),u=2*s.dot(m),c=m.dot(m)-n.radius*n.radius,p=u*u-4*i*c;if(i<=Number.EPSILON||p<0)return null;if(p==0){let b=-u/(2*i);if(b>=0&&b<=1){let l=r.add(s.scale(b));return{point:l,normal:l.sub(o),fraction:b}}}else{let b=(-u+Math.sqrt(p))/(2*i),l=(-u-Math.sqrt(p))/(2*i),h=null;if(b>=0&&b<=1&&(h=b),l>=0&&l<=1&&(h=Math.min(l,h??l)),h!=null){let d=r.add(s.scale(h));return{point:d,normal:d.sub(o).unit(),fraction:h}}}return null}function fu(t,e,n){let r=n.pts,o=null,s=r[r.length-1];for(let i=0;i<r.length;i++){let m=r[i],u=Ko(t,e,new Oe(s,m));u&&(!o||o.fraction>u.fraction)&&(o=u),s=m}return o}function hu(t,e,n){let r=n.toMat2(),o=r.inverse,s=o.transform(t.sub(n.center)),i=o.transform(e),m=ko(s,i,new we(v(),1));if(m){let u=Dt.rotation(ae(-n.angle)),p=Dt.scale(n.radiusX,n.radiusY).transform(m.point),b=r.transform(m.point).add(n.center),l=b.dist(t)/e.len();return{point:b,normal:u.transform(v(n.radiusY**2*p.x,n.radiusX**2*p.y)).unit(),fraction:l}}return m}function _o(t,e,n,r=64){let o=t,s=e.len(),i=e.scale(1/s),m=0,u=v(Math.floor(t.x),Math.floor(t.y)),c=v(i.x>0?1:-1,i.y>0?1:-1),p=v(Math.abs(1/i.x),Math.abs(1/i.y)),b=v(c.x>0?u.x+1-t.x:t.x-u.x,c.y>0?u.y+1-t.y:t.y-u.y),l=v(p.x<1/0?p.x*b.x:1/0,p.y<1/0?p.y*b.y:1/0),h=-1;for(;m<=r;){let d=n(u);if(d===!0)return{point:o.add(i.scale(m)),normal:v(h===0?-c.x:0,h===1?-c.y:0),fraction:m/s,gridPos:u};if(d)return d;l.x<l.y?(u.x+=c.x,m=l.x,l.x+=p.x,h=0):(u.y+=c.y,m=l.y,l.y+=p.y,h=1)}return null}var On=class t{pt;constructor(e){this.pt=e.clone()}transform(e){return new t(e.multVec2(this.pt))}bbox(){return new W(this.pt,0,0)}area(){return 0}clone(){return new t(this.pt)}collides(e){return au(this,e)}contains(e){return this.pt.eq(e)}raycast(e,n){return null}random(){return this.pt.clone()}},Oe=class t{p1;p2;constructor(e,n){this.p1=e.clone(),this.p2=n.clone()}transform(e){return new t(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return W.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new t(this.p1,this.p2)}collides(e){return uu(this,e)}contains(e){return this.collides(e)}raycast(e,n){return Ko(e,n,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(he(1)))}},W=class t{pos;width;height;constructor(e,n,r){this.pos=e.clone(),this.width=n,this.height=r}static fromPoints(e,n){return new t(e.clone(),n.x-e.x,n.y-e.y)}center(){return new E(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new be(this.points().map(n=>e.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new t(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let n=this.pos,r=this.pos.add(this.width,this.height),o=Math.max(n.x-e.x,0,e.x-r.x),s=Math.max(n.y-e.y,0,e.y-r.y);return o*o+s*s}collides(e){return lu(this,e)}contains(e){return this.collides(e)}raycast(e,n){return du(e,n,this)}random(){return this.pos.add(he(this.width),he(this.height))}},we=class t{center;radius;constructor(e,n){this.center=e.clone(),this.radius=n}transform(e){return new Ke(this.center,this.radius,this.radius).transform(e)}bbox(){return W.fromPoints(this.center.sub(v(this.radius)),this.center.add(v(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new t(this.center,this.radius)}collides(e){return cu(this,e)}contains(e){return this.collides(e)}raycast(e,n){return ko(e,n,this)}random(){return this.center.add(E.fromAngle(he(360)).scale(he(this.radius)))}},Ke=class t{center;radiusX;radiusY;angle;constructor(e,n,r,o=0){this.center=e.clone(),this.radiusX=n,this.radiusY=r,this.angle=o}static fromMat2(e){let n=e.inverse,r=n.transpose.mul(n),[o,s]=r.eigenvalues,[i,m]=r.eigenvectors(o,s),[u,c]=[1/Math.sqrt(o),1/Math.sqrt(s)];return u>c?new t(v(),u,c,lt(Math.atan2(-i[1],i[0]))):new t(v(),c,u,lt(Math.atan2(-m[1],m[0])))}toMat2(){let e=ae(this.angle),n=Math.cos(e),r=Math.sin(e);return new Dt(n*this.radiusX,-r*this.radiusY,r*this.radiusX,n*this.radiusY)}transform(e){if(this.angle==0&&e.getRotation()==0)return new t(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY);{let n=this.toMat2(),r=e.getRotation(),o=e.getScale();n=bt.fromMat2(n).scale(o.x,o.y).rotate(r).toMat2();let i=t.fromMat2(n);return i.center=e.multVec2(this.center),i}}bbox(){if(this.angle==0)return W.fromPoints(this.center.sub(v(this.radiusX,this.radiusY)),this.center.add(v(this.radiusX,this.radiusY)));{let e=ae(this.angle),n=Math.cos(e),r=Math.sin(e),o=this.radiusX*n,s=this.radiusX*r,i=this.radiusY*r,m=this.radiusY*n,u=Math.sqrt(o*o+i*i),c=Math.sqrt(s*s+m*m);return W.fromPoints(this.center.sub(v(u,c)),this.center.add(v(u,c)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new t(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return pu(this,e)}contains(e){e=e.sub(this.center);let n=ae(this.angle),r=Math.cos(n),o=Math.sin(n),s=e.x*r+e.y*o,i=-e.x*o+e.y*r;return s*s/(this.radiusX*this.radiusX)+i*i/(this.radiusY*this.radiusY)<1}raycast(e,n){return hu(e,n,this)}random(){return this.center}};function gu(t,e,n,r){let o=e.sub(t),s=r.sub(n),i=o.cross(s);return i<1e-5&&i>-1e-5||(i=n.sub(t).cross(s)/i,i<0||i>1)?null:t.add(o.scale(i))}var be=class t{pts;constructor(e){if(e.length<3)throw new Error(\"Polygons should have at least 3 vertices\");this.pts=e}transform(e){return new t(this.pts.map(n=>e.multVec2(n)))}bbox(){let e=v(Number.MAX_VALUE),n=v(-Number.MAX_VALUE);for(let r of this.pts)e.x=Math.min(e.x,r.x),n.x=Math.max(n.x,r.x),e.y=Math.min(e.y,r.y),n.y=Math.max(n.y,r.y);return W.fromPoints(e,n)}area(){let e=0,n=this.pts.length;for(let r=0;r<n;r++){let o=this.pts[r],s=this.pts[(r+1)%n];e+=o.x*s.y*.5,e-=s.x*o.y*.5}return Math.abs(e)}clone(){return new t(this.pts.map(e=>e.clone()))}collides(e){return mu(this,e)}contains(e){return this.collides(e)}raycast(e,n){return fu(e,n,this)}random(){return v()}cut(e,n){let r=new Oe(e,n),o=[],s=[],i=n.sub(e),m=this.pts[this.pts.length-1],u=m.sub(e),c=i.cross(u)>0;return this.pts.forEach(p=>{u=p.sub(e);let b=i.cross(u)>0;if(c!=b){let l=gu(m,p,e,n);o.push(l),s.push(l),c=b}(b?o:s).push(p),m=p}),[o.length?new t(o):null,s.length?new t(s):null]}};function No(t,e,n,r){let o=r*r,s=1-r,i=s*s;return t.scale(i).add(e.scale(2*s*r)).add(n.scale(o))}function Uo(t,e,n,r){let o=1-r;return e.sub(t).scale(2*o).add(n.sub(e).scale(2*r))}function Ho(t,e,n,r){return n.sub(e.scale(2)).add(t).scale(2)}function Jt(t,e,n,r,o){let s=o*o,i=s*o,m=1-o,u=m*m,c=u*m;return t.scale(c).add(e.scale(3*u*o)).add(n.scale(3*m*s)).add(r.scale(i))}function qo(t,e,n,r,o){let s=o*o,i=1-o,m=i*i;return e.sub(t).scale(3*m).add(n.sub(e).scale(6*i*o)).add(r.sub(n).scale(3*s))}function zo(t,e,n,r,o){let s=1-o;return n.sub(e.scale(2)).add(t).scale(6*s).add(r.sub(n.scale(2)).add(e).scale(6*o))}function Wo(t,e,n,r,o){let s=.5*(((-o+2)*o-1)*o),i=.5*((3*o-5)*o*o+2),m=.5*(((-3*o+4)*o+1)*o),u=.5*((o-1)*o*o);return t.scale(s).add(e.scale(i)).add(n.scale(m)).add(r.scale(u))}function Yo(t,e,n,r,o){let s=.5*((-3*o+4)*o-1),i=.5*((9*o-10)*o),m=.5*((-9*o+8)*o+1),u=.5*((3*o-2)*o);return t.scale(s).add(e.scale(i)).add(n.scale(m)).add(r.scale(u))}function $o(t){let e=Vr(t),n=e(1);return r=>{let o=r*n,s=e(o,!0);return t(s)}}function Vr(t,e=10,n=10){let r=[0],o=[0],i=1/(e-1)/n,m=0,u=t(0),c=0;for(let p=1;p<e;p++){for(let b=0;b<n;b++){c+=i;let l=t(c),h=l.dist(u);m+=h,u=l}r[p]=m,o[p]=c}return o[e-1]=1,(p,b=!1)=>{if(b){let l=p;if(l<=0)return 0;if(l>=m)return 1;let h=0;for(;r[h+1]<l;)h++;let d=o[h],C=o[h+1],g=r[h],y=r[h+1],O=(l-g)/(y-g);return d+(C-d)*O}else{if(p<=0)return 0;if(p>=1)return r[e-1];let l=0;for(;o[l+1]<p;)l++;let h=o[l],d=o[l+1],C=r[l],g=r[l+1],y=(p-h)/(d-h);return C+(g-C)*y}}}function Lt(t,e,n,r){let o=2*t+e-2*r+n,s=-3*t+3*r-2*e-n,i=e,m=t;return u=>{let c=u*u,p=c*u;return o*p+s*c+i*u+m}}function Pr(t,e,n,r,o,s=Lt){let i=s(e.x,(1-o)*(n.x-t.x),(1-o)*(r.x-e.x),n.x),m=s(e.y,(1-o)*(n.y-t.y),(1-o)*(r.y-e.y),n.y);return u=>new E(i(u),m(u))}function jt(t,e,n,r,o=Lt){return Pr(t,e,n,r,.5,o)}function Xo(t,e,n,r,o=Lt){return jt(r.add(t.sub(e).scale(6)),t,r,t.add(r.sub(n).scale(6)),o)}function Qo(t,e,n,r,o,s,i,m=Lt){let u=m(e.x,.5*(1-o)*(1+i)*(1+s)*(e.x-t.x)+.5*(1-o)*(1-i)*(1-s)*(n.x-e.x),.5*(1-o)*(1+i)*(1-s)*(n.x-e.x)+.5*(1-o)*(1-i)*(1+s)*(r.x-n.x),n.x),c=m(e.y,.5*(1-o)*(1+i)*(1+s)*(e.y-t.y)+.5*(1-o)*(1-i)*(1-s)*(n.y-e.y),.5*(1-o)*(1+i)*(1-s)*(n.y-e.y)+.5*(1-o)*(1-i)*(1+s)*(r.y-n.y),n.y);return p=>new E(u(p),c(p))}function Jo(t,e,n,r){let o=2*t+e-2*r+n,s=-3*t+3*r-2*e+n,i=e;return m=>{let u=m*m;return 3*o*u+2*s*m+i}}function Yt(t){return 0<=t&&t<=1}function xr(t,e){return Math.abs(t-e)<=Number.EPSILON}function $t(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function bu(t,e,n,r){let o=3*t-6*e+3*n,s=-3*t+3*e,i=t,m=-t+3*e-3*n+r;if(xr(m,0)){if(xr(o,0))return xr(s,0)?[]:[-i/s].filter(Yt);let y=Math.sqrt(s*s-4*o*i),O=2*o;return[(y-s)/O,(-s-y)/O].filter(Yt)}o/=m,s/=m,i/=m;let u=(3*s-o*o)/3,c=u/3,p=(2*o*o*o-9*o*s+27*i)/27,b=p/2,l=b*b+c*c*c;if(l<0){let y=-u/3,O=y*y*y,A=Math.sqrt(O),R=-p/(2*A),V=R<-1?-1:R>1?1:R,x=Math.acos(V),S=2*$t(A),G=S*Math.cos(x/3)-o/3,M=S*Math.cos((x+2*Math.PI)/3)-o/3,D=S*Math.cos((x+4*Math.PI)/3)-o/3;return[G,M,D].filter(Yt)}if(l===0){let y=b<0?$t(-b):-$t(b),O=2*y-o/3,A=-y-o/3;return[O,A].filter(Yt)}let h=Math.sqrt(l),d=$t(h-b),C=$t(h+b);return[d-C-o/3].filter(Yt)}function yu(t,e,n,r,o){let s=bu(t.x-o,e.x-o,n.x-o,r.x-o);return s.length>0?Jt(t,e,n,r,s[0]).y:NaN}function Zo(t){if(!t||t.length==0)throw new Error(\"Need at least one point for easingLinear.\");let e=t.length;return n=>{if(n<=0||t.length==1||n<=t[0].x)return t[0].y;for(let r=0;r<e;r++)if(t[r].x>=n)return Se(n,t[r-1].x,t[r].x,t[r-1].y,t[r].y);return t[t.length-1].y}}function es(t,e){return n=>yu(v(0,0),t,e,v(1,1),n)}function ts(t,e=\"jump-end\"){let n=1/t,r=e==\"jump-start\"||e==\"jump-both\",o=e==\"jump-end\"||e==\"jump-both\",s=1/(t+(o?1:0)),i=r?s:0;return m=>{let u=Math.floor(m/n);return i+u*s}}function ns(t,e){let n=Number.MAX_VALUE,r={normal:v(0),distance:0};for(let o of[t,e])for(let s=0;s<o.pts.length;s++){let i=o.pts[s],u=o.pts[(s+1)%o.pts.length].sub(i).normal().unit(),c=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let d=0;d<t.pts.length;d++){let C=t.pts[d].dot(u);c=Math.min(c,C),p=Math.max(p,C)}let b=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let d=0;d<e.pts.length;d++){let C=e.pts[d].dot(u);b=Math.min(b,C),l=Math.max(l,C)}let h=Math.min(p,l)-Math.max(c,b);if(h<0)return null;if(h<Math.abs(n)){let d=l-c,C=b-p;n=Math.abs(d)<Math.abs(C)?d:C,r.normal=u,r.distance=n}}return r}function rs(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)>=0}function xu(t){let e=0,n=t[t.length-1];for(let r=0;r<t.length;r++)e+=(t[r].x-n.x)*(t[r].y+n.y),n=t[r];return e<0}function vr(t,e,n,r){let o=r.x-n.x,s=r.y-n.y,i=o*(t.y-n.y)-s*(t.x-n.x),m=o*(e.y-n.y)-s*(e.x-n.x);return i*m>=0}function vu(t,e,n,r){return vr(t,e,n,r)&&vr(t,n,e,r)&&vr(t,r,e,n)}function wu(t,e,n,r){for(let o of t)if(o!==e&&o!==n&&o!==r&&vu(o,e,n,r))return!0;return!1}function Cu(t,e,n,r){return rs(t,e,n)&&!wu(r,t,e,n)}function Mn(t){if(t.length<3)return[];if(t.length==3)return[t];let e=[],n=[],r=0;for(let b=0;b<t.length;b++){let l=t[r],h=t[b];(h.x<l.x||h.x==l.x&&h.y<l.y)&&(r=r),e[b]=b+1,n[b]=b-1}e[e.length-1]=0,n[0]=n.length-1,xu(t)||([e,n]=[n,e]);let o=[];for(let b=0;b<t.length;++b)rs(t[n[b]],t[b],t[e[b]])||o.push(t[b]);let s=[],i=t.length,m=1,u=0,c,p;for(;i>3;){c=e[m],p=n[m];let b=t[p],l=t[m],h=t[c];if(Cu(b,l,h,o))s.push([b,l,h]),e[p]=c,n[c]=p,o.splice(o.indexOf(l),1),--i,u=0;else if(++u>i)return[];m=c}return c=e[m],p=n[m],s.push([t[p],t[m],t[c]]),s}function os(t){if(t.length<3)return!1;let e=t.length-2,n=t.length-1,r=0,o=t[n].sub(t[e]),s=t[r].sub(t[n]),i=o.cross(s);for(;r+1<t.length;)if(e=n,n=r,r++,o=t[n].sub(t[e]),s=t[r].sub(t[n]),o.cross(s)*i<0)return!1;return!0}var Rn=\" !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\",mt=\"topleft\";var ss=\"monospace\",yt=\"monospace\";var Zt=\"linear\";var en=[{name:\"a_pos\",size:2},{name:\"a_uv\",size:2},{name:\"a_color\",size:4}],Eu=en.reduce((t,e)=>t+e.size,0),is=2048,as=is*4*Eu,us=is*6,cs=`\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n`,ls=`\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\tvec4 texColor = texture2D(u_tex, v_uv);\n\treturn vec4((v_color.rgb * texColor.rgb), texColor.a) * v_color.a;\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n`,tn=`\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n`,nn=`\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n`,ms=new Set([\"id\",\"require\"]),ps=new Set([\"add\",\"fixedUpdate\",\"update\",\"draw\",\"destroy\",\"inspect\",\"drawInspect\"]),Gr=200,ds=640,fs=65536,Dn=Symbol.for(\"kaplay.cancel\");var rn=class extends Map{lastID=0;push(e){let n=this.lastID;return this.set(n,e),this.lastID++,n}pushd(e){let n=this.push(e);return()=>this.delete(n)}},ke=class t{paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let n=new t(()=>e.forEach(r=>r.cancel()));return Object.defineProperty(n,\"paused\",{get:()=>e[0].paused,set:r=>e.forEach(o=>o.paused=r)}),n.paused=!1,n}static replace(e,n){return e.cancel=()=>n.cancel(),n.paused=e.paused,Object.defineProperty(e,\"paused\",{get:()=>n.paused,set:r=>n.paused=r}),e}},re=class{cancellers=new WeakMap;handlers=new rn;add(e){function n(...s){if(!o.paused)return e(...s)}let r=this.handlers.pushd(n),o=new ke(r);return this.cancellers.set(n,r),o}addOnce(e){let n=this.add((...r)=>{n.cancel(),e(...r)});return n}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(n=>{let r=n(...e),o;r===Dn&&(o=this.cancellers.get(n))&&o()})}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},ze=class{handlers={};registers={};on(e,n){return this.handlers[e]||(this.handlers[e]=new re),this.handlers[e].add(n)}onOnce(e,n){let r=this.on(e,(...o)=>{r.cancel(),n(...o)});return r}next(e){return new Promise(n=>{this.onOnce(e,(...r)=>n(r[0]))})}trigger(e,...n){this.handlers[e]&&this.handlers[e].trigger(...n)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};var hs=t=>t[0]instanceof j,gs=t=>t[0]instanceof E,bs=t=>typeof t[0]==\"number\";var It=class{_items;_compareFn;constructor(e=(n,r)=>n<r){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],n=this._items.pop();return this._items.length!==0&&(this._items[0]=n,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let n=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[n])&&this._items[e]>=this._items[n])break;this.swap(e,n),e=n}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let n=2*e+1;if(n<this._items.length-1&&!this._compareFn(this._items[n],this._items[n+1])&&++n,this._compareFn(this._items[e],this._items[n]))break;this.swap(e,n),e=n}}swap(e,n){[this._items[e],this._items[n]]=[this._items[n],this._items[e]]}get length(){return this._items.length}};function Tu(t){let e=window.atob(t),n=e.length,r=new Uint8Array(n);for(let o=0;o<n;o++)r[o]=e.charCodeAt(o);return r.buffer}function ys(t){return Tu(t.split(\",\")[1])}function Bn(t,e){let n=document.createElement(\"a\");n.href=e,n.download=t,n.click()}function Mr(t,e){Bn(t,\"data:text/plain;charset=utf-8,\"+e)}function xs(t,e){Mr(t,JSON.stringify(e))}function Rr(t,e){let n=URL.createObjectURL(e);Bn(t,n),URL.revokeObjectURL(n)}var Fn=t=>t.match(/^data:\\w+\\/\\w+;base64,.+/);var vs=t=>t.split(\".\").slice(0,-1).join(\".\");function Ln(t,e){if(t===e)return!0;let n=typeof t,r=typeof e;if(n!==r)return!1;if(n===\"object\"&&r===\"object\"&&t!==null&&e!==null){if(Array.isArray(t)!==Array.isArray(e))return!1;let o=Object.keys(t),s=Object.keys(e);if(o.length!==s.length)return!1;for(let i of o){let m=t[i],u=e[i];if(!Ln(m,u))return!1}return!0}return!1}var ws=new Set,Cs=t=>t instanceof Error?t.message:String(t);function Ou(t){ws.has(t)||(ws.add(t),console.warn(t))}function tt(t,e){Ou(`${t} is deprecated. Use ${e} instead.`)}function on(t,e){return Number(t.toFixed(e))}function ne(t,e){return(...n)=>{let r=n.length;if(r===t.length)return t(...n);if(r===e.length)return e(...n)}}var Au=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Ts(t){if(typeof t!=\"string\")throw new TypeError(\"string cannot be undefined or null\");let e=[],n=0,r=0;for(;n<t.length;){if(r+=Su(n+r,t),Bu(t[n+r])&&r++,Mu(t[n+r])&&r++,Ru(t[n+r])&&r++,Fu(t[n+r])){r++;continue}e.push(t.substring(n,n+r)),n+=r,r=0}return e}function Su(t,e){let n=e[t];if(!Vu(n)||t===e.length-1)return 1;let r=n+e[t+1],o=e.substring(t+2,t+5);return Es(r)&&Es(o)?4:Pu(r)&&Du(o)?e.slice(t).indexOf(String.fromCodePoint(917631))+2:Gu(o)?4:2}function Vu(t){return t&&xt(t[0].charCodeAt(0),55296,56319)}function Es(t){return xt(Dr(t),127462,127487)}function Pu(t){return xt(Dr(t),127988,127988)}function Gu(t){return xt(Dr(t),127995,127999)}function Mu(t){return typeof t==\"string\"&&xt(t.charCodeAt(0),65024,65039)}function Ru(t){return typeof t==\"string\"&&xt(t.charCodeAt(0),8400,8447)}function Du(t){let e=t.codePointAt(0);return typeof t==\"string\"&&typeof e==\"number\"&&xt(e,917504,917631)}function Bu(t){return typeof t==\"string\"&&Au.includes(t.charCodeAt(0))}function Fu(t){return typeof t==\"string\"&&t.charCodeAt(0)===8205}function Dr(t){let e=t.charCodeAt(0)-55296,n=t.charCodeAt(1)-56320;return(e<<10)+n+65536}function xt(t,e,n){return t>=e&&t<=n}var De=(t,e)=>Array.isArray(t)?t?.includes(e):t===e,We=(t,e)=>Array.isArray(e)?e.some(n=>t.has(n)):t.has(e),sn=(t,e,n)=>{t.has(e)?t.get(e)?.push(n):t.set(e,[n])};var Os=(()=>{let t=0;return()=>t++})();var As={\"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"6\":\"ltrigger\",\"7\":\"rtrigger\",\"8\":\"select\",\"9\":\"start\",\"10\":\"lstick\",\"11\":\"rstick\",\"12\":\"dpad-up\",\"13\":\"dpad-down\",\"14\":\"dpad-left\",\"15\":\"dpad-right\",\"16\":\"home\",\"17\":\"capture\"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},\"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"9\":\"select\",\"10\":\"lstick\",\"16\":\"start\"},sticks:{left:{x:0,y:1}}},\"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"9\":\"start\",\"10\":\"lstick\",\"16\":\"select\"},sticks:{left:{x:0,y:1}}},\"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"6\":\"ltrigger\",\"7\":\"rtrigger\",\"8\":\"select\",\"9\":\"start\",\"10\":\"lstick\",\"11\":\"rstick\",\"12\":\"dpad-up\",\"13\":\"dpad-down\",\"14\":\"dpad-left\",\"15\":\"dpad-right\",\"16\":\"home\",\"17\":\"capture\"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"6\":\"ltrigger\",\"7\":\"rtrigger\",\"8\":\"select\",\"9\":\"start\",\"10\":\"lstick\",\"11\":\"rstick\",\"12\":\"dpad-up\",\"13\":\"dpad-down\",\"14\":\"dpad-left\",\"15\":\"dpad-right\",\"16\":\"home\"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}};function jn(){let t=a.globalOpt.pixelDensity??1,e=a.globalOpt.width,n=a.globalOpt.height,r=a.gfx.ggl.gl.drawingBufferWidth,o=a.gfx.ggl.gl.drawingBufferHeight,s=r/t,i=o/t,m=0,u=0,c=s,p=i;if(a.globalOpt.letterbox){if(!e||!n)throw new Error(\"Letterboxing requires width and height defined.\");let b=s/i,l=e/n;if(b>l){let h=i*l;m=(s-h)/2,c=h}else{let h=s/l;p=h,u=(i-h)/2}}if(a.globalOpt.stretch&&(!a.globalOpt.width||!a.globalOpt.height))throw new Error(\"Stretching requires width and height defined.\");a.gfx.viewport={x:m,y:u,width:c,height:p,scale:(a.gfx.viewport.width+a.gfx.viewport.height)/(a.gfx.width+a.gfx.height)}}function Ss(t){return new E(t.x*a.gfx.viewport.width/a.gfx.width,t.y*a.gfx.viewport.height/a.gfx.height)}function Qe(t){return new E((t.x-a.gfx.viewport.x)*a.gfx.width/a.gfx.viewport.width,(t.y-a.gfx.viewport.y)*a.gfx.height/a.gfx.viewport.height)}var Vs=()=>pt.lastInputDevice,Ps=()=>{let t=pt.buttons;for(let e in t){let n=t[e].keyboard&&[t[e].keyboard].flat(),r=t[e].keyboardCode&&[t[e].keyboardCode].flat(),o=t[e].gamepad&&[t[e].gamepad].flat(),s=t[e].mouse&&[t[e].mouse].flat();n&&n.forEach(i=>{sn(pt.buttonsByKey,i,e)}),r&&r.forEach(i=>{sn(pt.buttonsByKeyCode,i,e)}),o&&o.forEach(i=>{sn(pt.buttonsByGamepad,i,e)}),s&&s.forEach(i=>{sn(pt.buttonsByMouse,i,e)})}};var vt=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},Br=class{buttonState=new vt;stickState=new Map},Fr=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((n,r)=>n+r)/this.dts.length)),this.dts=[])}},pt,Gs=As,ju=t=>{let e=t.buttons??{};return{canvas:t.canvas,buttons:e,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new Fr,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new E(0),mouseDeltaPos:new E(0),keyState:new vt,mouseState:new vt,mergedGamepadState:new Br,gamepadStates:new Map,lastInputDevice:null,buttonState:new vt,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new ze}},Ms=t=>{if(!t.canvas)throw new Error(\"Please provide a canvas\");let e=ju(t);pt=e,Ps();function n(){return e.dt*e.timeScale}function r(){return e.fixedDt*e.timeScale}function o(){return e.restDt*e.timeScale}function s(){return e.isHidden}function i(){return e.time}function m(){return e.fpsCounter.fps}function u(){return e.numFrames}function c(){return e.canvas.toDataURL()}function p(f){e.canvas.style.cursor=f}function b(){return e.canvas.style.cursor}function l(f){if(f)try{let T=e.canvas.requestPointerLock();T?.catch&&T.catch(P=>console.error(P))}catch(T){console.error(T)}else document.exitPointerLock()}function h(){return!!document.pointerLockElement}function d(f){f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen&&f.webkitRequestFullscreen()}function C(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function g(f=!0){f?d(e.canvas):C()}function y(){return document.fullscreenElement===e.canvas||document.webkitFullscreenElement===e.canvas}function O(){e.stopped=!0;let f=Object.entries(Me),T=Object.entries(br),P=Object.entries(En);for(let[B,te]of f)e.canvas.removeEventListener(B,te);for(let[B,te]of T)document.removeEventListener(B,te);for(let[B,te]of P)window.removeEventListener(B,te);To.disconnect()}function A(f,T){e.loopID!==null&&cancelAnimationFrame(e.loopID);let P=0,B=0,te=Ae=>{if(e.stopped)return;if(document.visibilityState!==\"visible\"){e.loopID=requestAnimationFrame(te);return}let se=Ae/1e3,Ze=Math.min(se-e.realTime,.25),Rt=t.maxFPS?1/t.maxFPS:0;if(e.realTime=se,B+=Ze,B>Rt){if(!e.skipTime){for(P+=B,e.dt=e.fixedDt,e.restDt=0;P>e.fixedDt;)P-=e.fixedDt,P<e.fixedDt&&(e.restDt=P),f();e.restDt=P,e.dt=B,e.time+=n(),e.fpsCounter.tick(e.dt)}B=0,e.skipTime=!1,e.numFrames++,T(Cn,Xa)}e.loopID=requestAnimationFrame(te)};te(0)}function R(){return\"ontouchstart\"in window||navigator.maxTouchPoints>0}function V(){return e.mousePos.clone()}function x(){return e.mouseDeltaPos.clone()}function w(f=\"left\"){return e.mouseState.pressed.has(f)}function S(f=\"left\"){return e.mouseState.down.has(f)}function G(f=\"left\"){return e.mouseState.released.has(f)}function M(){return e.isMouseMoved}function D(f){return f===void 0?e.keyState.pressed.size>0:We(e.keyState.pressed,f)}function L(f){return f===void 0?e.keyState.pressedRepeat.size>0:We(e.keyState.pressedRepeat,f)}function U(f){return f===void 0?e.keyState.down.size>0:We(e.keyState.down,f)}function H(f){return f===void 0?e.keyState.released.size>0:We(e.keyState.released,f)}function Y(f){return f===void 0?e.mergedGamepadState.buttonState.pressed.size>0:We(e.mergedGamepadState.buttonState.pressed,f)}function _(f){return f===void 0?e.mergedGamepadState.buttonState.down.size>0:We(e.mergedGamepadState.buttonState.down,f)}function K(f){return f===void 0?e.mergedGamepadState.buttonState.released.size>0:We(e.mergedGamepadState.buttonState.released,f)}function J(f){return f===void 0?e.buttonState.pressed.size>0:We(e.buttonState.pressed,f)}function $(f){return f===void 0?e.buttonState.down.size>0:We(e.buttonState.down,f)}function Z(f){return f===void 0?e.buttonState.released.size>0:We(e.buttonState.released,f)}function Ee(f){return e.buttons?.[f]}function k(f,T){e.buttons[f]={...e.buttons[f],...T}}function gt(f){e.buttonState.press(f),e.events.trigger(\"buttonPress\",f)}function Gt(f){e.buttonState.release(f),e.events.trigger(\"buttonRelease\",f)}function Ht(f){return e.events.on(\"resize\",f)}let yn=ne(f=>e.events.on(\"keyDown\",f),(f,T)=>e.events.on(\"keyDown\",P=>De(f,P)&&T(P))),xn=ne(f=>e.events.on(\"keyPress\",T=>f(T)),(f,T)=>e.events.on(\"keyPress\",P=>De(f,P)&&T(P))),mr=ne(f=>e.events.on(\"keyPressRepeat\",f),(f,T)=>e.events.on(\"keyPressRepeat\",P=>De(f,P)&&T(P))),pr=ne(f=>e.events.on(\"keyRelease\",f),(f,T)=>e.events.on(\"keyRelease\",P=>De(f,P)&&T(P))),Mt=ne(f=>e.events.on(\"mouseDown\",T=>f(T)),(f,T)=>e.events.on(\"mouseDown\",P=>De(f,P)&&T(P))),$e=ne(f=>e.events.on(\"mousePress\",T=>f(T)),(f,T)=>e.events.on(\"mousePress\",P=>De(f,P)&&T(P))),vn=ne(f=>e.events.on(\"mouseRelease\",T=>f(T)),(f,T)=>e.events.on(\"mouseRelease\",P=>P===f&&T(P)));function F(f){return e.events.on(\"mouseMove\",()=>f(V(),x()))}function N(f){return e.events.on(\"charInput\",f)}function z(f){return e.events.on(\"touchStart\",f)}function oe(f){return e.events.on(\"touchMove\",f)}function ye(f){return e.events.on(\"touchEnd\",f)}function Q(f){return e.events.on(\"scroll\",f)}function ve(f){return e.events.on(\"hide\",f)}function qt(f){return e.events.on(\"show\",f)}let ut=ne(f=>e.events.on(\"gamepadButtonPress\",(T,P)=>f(T,P)),(f,T)=>e.events.on(\"gamepadButtonPress\",(P,B)=>De(f,P)&&T(P,B))),dr=ne(f=>e.events.on(\"gamepadButtonDown\",(T,P)=>f(T,P)),(f,T)=>e.events.on(\"gamepadButtonDown\",(P,B)=>De(f,P)&&T(P,B))),fr=ne(f=>e.events.on(\"gamepadButtonRelease\",(T,P)=>f(T,P)),(f,T)=>e.events.on(\"gamepadButtonRelease\",(P,B)=>De(f,P)&&T(P,B)));function hr(f,T){return e.events.on(\"gamepadStick\",(P,B,te)=>P===f&&T(B,te))}function gr(f){e.events.on(\"gamepadConnect\",f)}function wn(f){e.events.on(\"gamepadDisconnect\",f)}function Xe(f){return e.mergedGamepadState.stickState.get(f)||new E(0)}function ct(){return[...e.charInputted]}function zt(){return[...e.gamepads]}let Ie=ne(f=>e.events.on(\"buttonPress\",T=>f(T)),(f,T)=>e.events.on(\"buttonPress\",P=>De(f,P)&&T(P))),Wt=ne(f=>e.events.on(\"buttonDown\",T=>f(T)),(f,T)=>e.events.on(\"buttonDown\",P=>De(f,P)&&T(P))),Je=ne(f=>e.events.on(\"buttonRelease\",T=>f(T)),(f,T)=>e.events.on(\"buttonRelease\",P=>De(f,P)&&T(P)));function Cn(){e.events.trigger(\"input\"),e.keyState.down.forEach(f=>e.events.trigger(\"keyDown\",f)),e.mouseState.down.forEach(f=>e.events.trigger(\"mouseDown\",f)),e.buttonState.down.forEach(f=>{e.events.trigger(\"buttonDown\",f)}),Ja()}function Xa(){e.keyState.update(),e.mouseState.update(),e.buttonState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((f,T)=>{e.mergedGamepadState.stickState.set(T,new E(0))}),e.charInputted=[],e.isMouseMoved=!1,e.mouseDeltaPos=new E(0),e.gamepadStates.forEach(f=>{f.buttonState.update(),f.stickState.forEach((T,P)=>{f.stickState.set(P,new E(0))})})}function vo(f){let T={index:f.index,isPressed:P=>e.gamepadStates.get(f.index)?.buttonState.pressed.has(P)||!1,isDown:P=>e.gamepadStates.get(f.index)?.buttonState.down.has(P)||!1,isReleased:P=>e.gamepadStates.get(f.index)?.buttonState.released.has(P)||!1,getStick:P=>e.gamepadStates.get(f.index)?.stickState.get(P)||v()};return e.gamepads.push(T),e.gamepadStates.set(f.index,{buttonState:new vt,stickState:new Map([[\"left\",new E(0)],[\"right\",new E(0)]])}),T}function Qa(f){e.gamepads=e.gamepads.filter(T=>T.index!==f.index),e.gamepadStates.delete(f.index)}function Ja(){for(let f of navigator.getGamepads())f&&!e.gamepadStates.has(f.index)&&vo(f);for(let f of e.gamepads){let T=navigator.getGamepads()[f.index];if(!T)continue;let B=(t.gamepads??{})[T.id]||Gs[T.id]||Gs.default,te=e.gamepadStates.get(f.index);if(te){for(let Ae=0;Ae<T.buttons.length;Ae++){let se=B.buttons[Ae],Ze=T.buttons[Ae],Rt=e.buttonsByGamepad.has(se);if(Ze.pressed){if(te.buttonState.down.has(se)){e.events.trigger(\"gamepadButtonDown\",se,f);continue}e.lastInputDevice=\"gamepad\",Rt&&e.buttonsByGamepad.get(se)?.forEach(Re=>{e.buttonState.press(Re),e.events.trigger(\"buttonPress\",Re)}),e.mergedGamepadState.buttonState.press(se),te.buttonState.press(se),e.events.trigger(\"gamepadButtonPress\",se,f)}else te.buttonState.down.has(se)&&(Rt&&e.buttonsByGamepad.get(se)?.forEach(Re=>{e.buttonState.release(Re),e.events.trigger(\"buttonRelease\",Re)}),e.mergedGamepadState.buttonState.release(se),te.buttonState.release(se),e.events.trigger(\"gamepadButtonRelease\",se,f))}for(let Ae in B.sticks){let se=B.sticks[Ae];if(!se)continue;let Ze=new E(T.axes[se.x],T.axes[se.y]);te.stickState.set(Ae,Ze),e.mergedGamepadState.stickState.set(Ae,Ze),e.events.trigger(\"gamepadStick\",Ae,Ze,f)}}}}let Me={},br={},En={},wo=t.pixelDensity||1;Me.mousemove=f=>{let T=Qe(new E(f.offsetX,f.offsetY)),P=new E(f.movementX,f.movementY);if(y()){let B=e.canvas.width/wo,te=e.canvas.height/wo,Ae=window.innerWidth,se=window.innerHeight,Ze=Ae/se,Rt=B/te;if(Ze>Rt){let Re=se/te,yr=(Ae-B*Re)/2;T.x=Se(f.offsetX-yr,0,B*Re,0,B),T.y=Se(f.offsetY,0,te*Re,0,te)}else{let Re=Ae/B,yr=(se-te*Re)/2;T.x=Se(f.offsetX,0,B*Re,0,B),T.y=Se(f.offsetY-yr,0,te*Re,0,te)}}e.events.onOnce(\"input\",()=>{e.isMouseMoved=!0,e.mousePos=T,e.mouseDeltaPos=P,e.events.trigger(\"mouseMove\")})};let Co=[\"left\",\"middle\",\"right\",\"back\",\"forward\"];Me.mousedown=f=>{e.events.onOnce(\"input\",()=>{let T=Co[f.button];T&&(e.lastInputDevice=\"mouse\",e.buttonsByMouse.has(T)&&e.buttonsByMouse.get(T)?.forEach(P=>{e.buttonState.press(P),e.events.trigger(\"buttonPress\",P)}),e.mouseState.press(T),e.events.trigger(\"mousePress\",T))})},Me.mouseup=f=>{e.events.onOnce(\"input\",()=>{let T=Co[f.button];T&&(e.buttonsByMouse.has(T)&&e.buttonsByMouse.get(T)?.forEach(P=>{e.buttonState.release(P),e.events.trigger(\"buttonRelease\",P)}),e.mouseState.release(T),e.events.trigger(\"mouseRelease\",T))})};let Za=new Set([\" \",\"ArrowLeft\",\"ArrowRight\",\"ArrowUp\",\"ArrowDown\",\"Tab\"]),Eo={ArrowLeft:\"left\",ArrowRight:\"right\",ArrowUp:\"up\",ArrowDown:\"down\",\" \":\"space\"};Me.keydown=f=>{Za.has(f.key)&&f.preventDefault(),e.events.onOnce(\"input\",()=>{let T=Eo[f.key]||f.key.toLowerCase(),P=f.code;if(T===void 0)throw new Error(`Unknown key: ${f.key}`);T.length===1?(e.events.trigger(\"charInput\",T),e.charInputted.push(T)):T===\"space\"&&(e.events.trigger(\"charInput\",\" \"),e.charInputted.push(\" \")),f.repeat?(e.keyState.pressRepeat(T),e.events.trigger(\"keyPressRepeat\",T)):(e.lastInputDevice=\"keyboard\",e.buttonsByKey.has(T)&&e.buttonsByKey.get(T)?.forEach(B=>{e.buttonState.press(B),e.events.trigger(\"buttonPress\",B)}),e.buttonsByKeyCode.has(P)&&e.buttonsByKeyCode.get(P)?.forEach(B=>{e.buttonState.press(B),e.events.trigger(\"buttonPress\",B)}),e.keyState.press(T),e.events.trigger(\"keyPressRepeat\",T),e.events.trigger(\"keyPress\",T))})},Me.keyup=f=>{e.events.onOnce(\"input\",()=>{let T=Eo[f.key]||f.key.toLowerCase(),P=f.code;e.buttonsByKey.has(T)&&e.buttonsByKey.get(T)?.forEach(B=>{e.buttonState.release(B),e.events.trigger(\"buttonRelease\",B)}),e.buttonsByKeyCode.has(P)&&e.buttonsByKeyCode.get(P)?.forEach(B=>{e.buttonState.release(B),e.events.trigger(\"buttonRelease\",B)}),e.keyState.release(T),e.events.trigger(\"keyRelease\",T)})},Me.touchstart=f=>{f.preventDefault(),e.events.onOnce(\"input\",()=>{let T=[...f.changedTouches],P=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=Qe(new E(T[0].clientX-P.x,T[0].clientY-P.y)),e.lastInputDevice=\"mouse\",e.buttonsByMouse.has(\"left\")&&e.buttonsByMouse.get(\"left\")?.forEach(B=>{e.buttonState.press(B),e.events.trigger(\"buttonPress\",B)}),e.mouseState.press(\"left\"),e.events.trigger(\"mousePress\",\"left\")),T.forEach(B=>{e.events.trigger(\"touchStart\",Qe(new E(B.clientX-P.x,B.clientY-P.y)),B)})})},Me.touchmove=f=>{f.preventDefault(),e.events.onOnce(\"input\",()=>{let T=[...f.changedTouches],P=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){let B=e.mousePos;e.mousePos=Qe(new E(T[0].clientX-P.x,T[0].clientY-P.y)),e.mouseDeltaPos=e.mousePos.sub(B),e.events.trigger(\"mouseMove\")}T.forEach(B=>{e.events.trigger(\"touchMove\",Qe(new E(B.clientX-P.x,B.clientY-P.y)),B)})})},Me.touchend=f=>{e.events.onOnce(\"input\",()=>{let T=[...f.changedTouches],P=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=Qe(new E(T[0].clientX-P.x,T[0].clientY-P.y)),e.mouseDeltaPos=new E(0,0),e.buttonsByMouse.has(\"left\")&&e.buttonsByMouse.get(\"left\")?.forEach(B=>{e.buttonState.release(B),e.events.trigger(\"buttonRelease\",B)}),e.mouseState.release(\"left\"),e.events.trigger(\"mouseRelease\",\"left\")),T.forEach(B=>{e.events.trigger(\"touchEnd\",Qe(new E(B.clientX-P.x,B.clientY-P.y)),B)})})},Me.touchcancel=f=>{e.events.onOnce(\"input\",()=>{let T=[...f.changedTouches],P=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=Qe(new E(T[0].clientX-P.x,T[0].clientY-P.y)),e.mouseState.release(\"left\"),e.events.trigger(\"mouseRelease\",\"left\")),T.forEach(B=>{e.events.trigger(\"touchEnd\",Qe(new E(B.clientX-P.x,B.clientY-P.y)),B)})})},Me.wheel=f=>{f.preventDefault(),e.events.onOnce(\"input\",()=>{e.events.trigger(\"scroll\",new E(f.deltaX,f.deltaY))})},Me.contextmenu=f=>f.preventDefault(),br.visibilitychange=()=>{document.visibilityState===\"visible\"?(e.skipTime=!0,e.isHidden=!1,e.events.trigger(\"show\")):(e.isHidden=!0,e.events.trigger(\"hide\"))},En.gamepadconnected=f=>{let T=vo(f.gamepad);e.events.onOnce(\"input\",()=>{e.events.trigger(\"gamepadConnect\",T)})},En.gamepaddisconnected=f=>{let T=zt().filter(P=>P.index===f.gamepad.index)[0];Qa(f.gamepad),e.events.onOnce(\"input\",()=>{e.events.trigger(\"gamepadDisconnect\",T)})};for(let[f,T]of Object.entries(Me))e.canvas.addEventListener(f,T);for(let[f,T]of Object.entries(br))document.addEventListener(f,T);for(let[f,T]of Object.entries(En))window.addEventListener(f,T);let To=new ResizeObserver(f=>{for(let T of f)if(T.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce(\"input\",()=>{e.events.trigger(\"resize\")})}});return To.observe(e.canvas),{state:e,dt:n,fixedDt:r,restDt:o,time:i,run:A,canvas:e.canvas,fps:m,numFrames:u,quit:O,isHidden:s,setFullscreen:g,isFullscreen:y,setCursor:p,screenshot:c,getGamepads:zt,getCursor:b,setCursorLocked:l,isCursorLocked:h,isTouchscreen:R,mousePos:V,mouseDeltaPos:x,isKeyDown:U,isKeyPressed:D,isKeyPressedRepeat:L,isKeyReleased:H,isMouseDown:S,isMousePressed:w,isMouseReleased:G,isMouseMoved:M,isGamepadButtonPressed:Y,isGamepadButtonDown:_,isGamepadButtonReleased:K,getGamepadStick:Xe,isButtonPressed:J,isButtonDown:$,isButtonReleased:Z,setButton:k,getButton:Ee,pressButton:gt,releaseButton:Gt,charInputted:ct,onResize:Ht,onKeyDown:yn,onKeyPress:xn,onKeyPressRepeat:mr,onKeyRelease:pr,onMouseDown:Mt,onMousePress:$e,onMouseRelease:vn,onMouseMove:F,onCharInput:N,onTouchStart:z,onTouchMove:oe,onTouchEnd:ye,onScroll:Q,onHide:ve,onShow:qt,onGamepadButtonDown:dr,onGamepadButtonPress:ut,onGamepadButtonRelease:fr,onGamepadStick:hr,onGamepadConnect:gr,onGamepadDisconnect:wn,onButtonPress:Ie,onButtonDown:Wt,onButtonRelease:Je,getLastInputDeviceType:Vs,events:e.events}};function ee(){return a.app.dt()}function an(){return a.app.fixedDt()}function un(){return a.app.restDt()}var Iu=new E(-1,-1),Ku=new E(0,-1),ku=new E(1,-1),_u=new E(-1,0),Nu=new E(0,0),Uu=new E(1,0),Hu=new E(-1,1),qu=new E(0,1),zu=new E(1,1);function _e(t){switch(t){case\"topleft\":return Iu;case\"top\":return Ku;case\"topright\":return ku;case\"left\":return _u;case\"center\":return Nu;case\"right\":return Uu;case\"botleft\":return Hu;case\"bot\":return qu;case\"botright\":return zu;default:return t}}function Rs(t){switch(t){case\"left\":return 0;case\"center\":return .5;case\"right\":return 1;default:return 0}}function Ds(t){return t.createBuffer(1,1,44100)}var In=2.5949095,Bs=1.70158+1,Fs=2*Math.PI/3,Ls=2*Math.PI/4.5,Kn={linear:t=>t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>Bs*t*t*t-1.70158*t*t,easeOutBack:t=>1+Bs*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*((In+1)*2*t-In)/2:(Math.pow(2*t-2,2)*((In+1)*(t*2-2)+In)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*Fs),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*Fs)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*Ls))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*Ls)/2+1,easeInBounce:t=>1-Kn.easeOutBounce(1-t),easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInOutBounce:t=>t<.5?(1-Kn.easeOutBounce(1-2*t))/2:(1+Kn.easeOutBounce(2*t-1))/2},nt=Kn;function Wu(t,e,n){let r=[],o=e;for(r.push(o);o!==t;){if(o=n.get(o),o==null)return null;r.push(o)}return r.reverse()}function Lr(t,e,n){let r=new It((i,m)=>i.cost<m.cost);r.insert({cost:0,node:e});let o=new Map;o.set(e,e);let s=new Map;for(s.set(e,0);r.length!==0;){let i=r.remove()?.node;if(i===n)break;let m=t.getNeighbours(i);for(let u of m){let c=(s.get(i)||0)+t.getCost(i,u)+t.getHeuristic(u,n);(!s.has(u)||c<s.get(u))&&(s.set(u,c),r.insert({cost:c,node:u}),o.set(u,i))}}return Wu(e,n,o)}var jr=class{a;b;polygon;constructor(e,n,r){this.a=e,this.b=n,this.polygon=new WeakRef(r)}isLeft(e,n){return(this.b.x-this.a.x)*(n-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},Ir=class{_edges;_centroid;_id;constructor(e){this._id=e}get id(){return this._id}set edges(e){this._edges=e;let n=0,r=0,o=0;for(let s of this._edges){s.polygon=new WeakRef(this);let i=s.a.x*s.b.y-s.a.y*s.b.x;n+=(s.a.x+s.b.x)*i,r+=(s.a.y+s.b.y)*i,o+=i}o/=2,this._centroid=v(n/(6*o),r/(6*o))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let n=!1;for(let r of this.edges)r.b.y>e.y!=r.a.y>e.y&&e.x<(r.a.x-r.b.x)*(e.y-r.b.y)/(r.a.y-r.b.y)+r.b.x&&(n=!n);return n}},kn=class{_polygons;_pointCache;_edgeCache;constructor(){this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let n=this._pointCache[`${e.x}_${e.y}`];return n||(n=e.clone(),this._pointCache[`${e.x}_${e.y}`]=n,n)}_addEdge(e){let n=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[n]=e,e}_findEdge(e,n){let r=`${e.x}_${e.y}-${n.x}_${n.y}`;return this._edgeCache[r]}_findCommonEdge(e,n){for(let r of e.edges){let o=this._findEdge(r.b,r.a);if(o&&o.polygon.deref().id===n.id)return o}return null}addPolygon(e){let n=new Ir(this._polygons.length),r=e.map((o,s)=>new jr(o,e[(s+1)%e.length],n));n.edges=r,this._polygons.push(n);for(let o of n.edges)this._addEdge(o);return n}addRect(e,n){let r=this._addPoint(e),o=this._addPoint(e.add(n.x,0)),s=this._addPoint(e.add(n)),i=this._addPoint(e.add(0,n.y));return this.addPolygon([r,o,s,i])}_getLocation(e){for(let n of this._polygons)if(n.contains(e))return n;return null}getNeighbours(e){let n=[];for(let r of this._polygons[e].edges){let o=this._findEdge(r.b,r.a);if(o){let s=o.polygon.deref();s&&n.push(s.id)}}return n}getCost(e,n){return 1}getHeuristic(e,n){let r=this._polygons[e],o=this._polygons[n],s=r.centroid.x-o.centroid.x,i=r.centroid.y-o.centroid.y;return Math.sqrt(s*s+i*i)}getPath(e,n){return e===void 0||n===void 0?[]:e===n?[e,n]:Lr(this,e,n)}getWaypointPath(e,n,r){let o=r?.type||\"centroids\",s=this._getLocation(e),i=this._getLocation(n);if(s===void 0||i===void 0)return[];let m=this.getPath(s.id,i.id);if(!m)return[];if(o===\"edges\"){let u=[];for(let c=1;c<m.length;c++){let p=this._polygons[m[c-1]],b=this._polygons[m[c]],l=this._findCommonEdge(p,b);u.push(l.middle.add(b.centroid.sub(l.middle).unit().scale(4)))}return[e,...u,n]}else return[e,...m.slice(1,-1).map(u=>this._polygons[u].centroid),n]}};function dt(t){let e=new fe;return t.pos&&e.translate(t.pos),t.scale&&e.scale(t.scale),t.angle&&e.rotate(t.angle),t.parent?e.mult(t.parent.transform):e}function js(t){return new E(t.x/ie()*2-1,-t.y/ue()*2+1)}function wt(t,e,n,r,o,s=1){r=ae(r%360),o=ae(o%360),o<=r&&(o+=Math.PI*2);let i=[],m=Math.ceil((o-r)/ae(8)*s),u=(o-r)/m,c=v(Math.cos(r),Math.sin(r)),p=v(Math.cos(u),Math.sin(u));for(let b=0;b<=m;b++)i.push(t.add(e*c.x,n*c.y)),c=v(c.x*p.x-c.y*p.y,c.x*p.y+c.y*p.x);return i}function Is(...t){let e=I(...t),n=t[3]??1;a.gfx.bgColor=e,a.gfx.bgAlpha=n,a.gfx.ggl.gl.clearColor(e.r/255,e.g/255,e.b/255,n)}function Ks(){return a.gfx.bgColor?.clone?.()??null}function X(...t){if(t[0]===void 0)return;let e=v(...t);e.x===0&&e.y===0||a.gfx.transform.translate(e)}function ge(){a.gfx.transformStack.push(a.gfx.transform.clone())}function ks(t){a.gfx.transform=t.clone()}function rt(...t){if(t[0]===void 0)return;let e=v(...t);e.x===1&&e.y===1||a.gfx.transform.scale(e)}function Ye(t){t&&a.gfx.transform.rotate(t)}function me(){a.gfx.transformStack.length>0&&(a.gfx.transform=a.gfx.transformStack.pop())}function Ce(){a.gfx.renderer.flush()}function ie(){return a.gfx.width}function ue(){return a.gfx.height}function _n(){return(a.gfx.viewport.width+a.gfx.viewport.height)/(a.gfx.width+a.gfx.height)}function Ct(){return v(ie()/2,ue()/2)}var Nn=class{lastTextureId=0;textures=[];bigTextures=[];texturesPosition=new Map;canvas;c2d;x=0;y=0;curHeight=0;gfx;padding;constructor(e,n,r,o){this.gfx=e,this.canvas=document.createElement(\"canvas\"),this.canvas.width=n,this.canvas.height=r,this.textures=[Ve.fromImage(e,this.canvas)],this.bigTextures=[],this.padding=o;let s=this.canvas.getContext(\"2d\");if(!s)throw new Error(\"Failed to get 2d context\");this.c2d=s}addSingle(e){let n=Ve.fromImage(this.gfx,e);return this.bigTextures.push(n),[n,new q(0,0,1,1),0]}add(e){let n=e.width+this.padding*2,r=e.height+this.padding*2;if(n>this.canvas.width||r>this.canvas.height)return this.addSingle(e);this.x+n>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+r>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Ve.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let o=this.textures[this.textures.length-1],s=new E(this.x+this.padding,this.y+this.padding);return this.x+=n,r>this.curHeight&&(this.curHeight=r),e instanceof ImageData?this.c2d.putImageData(e,s.x,s.y):this.c2d.drawImage(e,s.x,s.y),o.update(this.canvas),this.texturesPosition.set(this.lastTextureId,{position:s,size:new E(e.width,e.height),texture:o}),this.lastTextureId++,[o,new q(s.x/this.canvas.width,s.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height),this.lastTextureId-1]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}};function pe(t){return typeof t!=\"string\"||Fn(t)?t:a.assets.urlPrefix+t}var ce=class t{loaded=!1;data=null;error=null;onLoadEvents=new re;onErrorEvents=new re;onFinishEvents=new re;constructor(e){e.then(n=>{this.loaded=!0,this.data=n,this.onLoadEvents.trigger(n)}).catch(n=>{if(this.error=n,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(n);else throw n}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let n=new t(Promise.resolve(e));return n.data=e,n.loaded=!0,n}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},ft=class{assets=new Map;lastUID=0;add(e,n){let r=e??this.lastUID+++\"\",o=new ce(n);return this.assets.set(r,o),o}addLoaded(e,n){let r=e??this.lastUID+++\"\",o=ce.loaded(n);return this.assets.set(r,o),o}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(n=>{n.loaded&&e++}),e/this.assets.size}getFailedAssets(){return Array.from(this.assets.keys()).filter(e=>this.assets.get(e).error!==null).map(e=>[e,this.assets.get(e)])}};function _r(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`Failed to fetch \"${t}\"`);return e})}function Et(t){return _r(t).then(e=>e.json())}function _s(t){return _r(t).then(e=>e.text())}function Ns(t){return _r(t).then(e=>e.arrayBuffer())}function Us(t){return t!==void 0&&(a.assets.urlPrefix=t),a.assets.urlPrefix}function Hs(t,e){return a.assets.custom.add(t,Et(pe(e)))}function Tt(t){let e=new Image;return e.crossOrigin=\"anonymous\",e.src=t,new Promise((n,r)=>{e.onload=()=>n(e),e.onerror=()=>r(new Error(`Failed to load image from \"${t}\"`))})}function Be(){let t=[a.assets.sprites,a.assets.sounds,a.assets.shaders,a.assets.fonts,a.assets.bitmapFonts,a.assets.custom];return t.reduce((e,n)=>e+n.progress(),0)/t.length}function Un(){return[a.assets.sprites,a.assets.sounds,a.assets.shaders,a.assets.fonts,a.assets.bitmapFonts,a.assets.custom].reduce((e,n)=>e.concat(n.getFailedAssets()),[])}function qs(t){return a.assets.custom.get(t)??null}function cn(t){return a.assets.custom.add(null,t)}var zs=(t,e)=>({urlPrefix:\"\",sprites:new ft,fonts:new ft,bitmapFonts:new ft,sounds:new ft,shaders:new ft,custom:new ft,music:{},packer:new Nn(t,2048,2048,e),loaded:!1});var Ws=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==\";var Fe=class t{tex;frames=[new q(0,0,1,1)];anims={};slice9=null;constructor(e,n,r={},o=null){this.tex=e,n&&(this.frames=n),this.anims=r,this.slice9=o}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(e,n={}){return typeof e==\"string\"?t.fromURL(e,n):Promise.resolve(t.fromImage(e,n))}static fromImage(e,n={}){let[r,o]=n.singular?a.assets.packer.addSingle(e):a.assets.packer.add(e),s=n.frames?n.frames.map(i=>new q(o.x+i.x*o.w,o.y+i.y*o.h,i.w*o.w,i.h*o.h)):Ur(n.sliceX||1,n.sliceY||1,o.x,o.y,o.w,o.h);return new t(r,s,n.anims,n.slice9)}static fromURL(e,n={}){return Tt(e).then(r=>t.fromImage(r,n))}};function Kt(t){if(typeof t==\"string\"){let e=Nr(t);if(e)return e;if(Be()<1)return null;throw new Error(`Sprite not found: ${t}`)}else{if(t instanceof Fe)return ce.loaded(t);if(t instanceof ce)return t;throw new Error(`Invalid sprite: ${t}`)}}function Nr(t){return a.assets.sprites.get(t)??null}function Ot(t,e,n={sliceX:1,sliceY:1,anims:{}}){return e=pe(e),Array.isArray(e)?e.some(r=>typeof r==\"string\")?a.assets.sprites.add(t,Promise.all(e.map(r=>typeof r==\"string\"?Tt(r):Promise.resolve(r))).then(r=>Ys(r,n))):a.assets.sprites.addLoaded(t,Ys(e,n)):typeof e==\"string\"?a.assets.sprites.add(t,Fe.from(e,n)):a.assets.sprites.addLoaded(t,Fe.fromImage(e,n))}function Ur(t=1,e=1,n=0,r=0,o=1,s=1){let i=[],m=o/t,u=s/e;for(let c=0;c<e;c++)for(let p=0;p<t;p++)i.push(new q(n+p*m,r+c*u,m,u));return i}function Ys(t,e={}){let n=document.createElement(\"canvas\"),r=t[0].width,o=t[0].height;n.width=r*t.length,n.height=o;let s=n.getContext(\"2d\");if(!s)throw new Error(\"Failed to create canvas context\");t.forEach((m,u)=>{m instanceof ImageData?s.putImageData(m,u*r,0):s.drawImage(m,u*r,0)});let i=s.getImageData(0,0,t.length*r,o);return Fe.fromImage(i,{...e,sliceX:t.length,sliceY:1})}function $s(t=\"bean\"){return Ot(t,Ws)}function Xs(t,e,n){e=pe(e),n=pe(n),typeof e==\"string\"&&!n&&(n=vs(e)+\".json\");let r=typeof n==\"string\"?Et(n):Promise.resolve(n);return a.assets.sprites.add(t,r.then(o=>{let s=o.meta.size,i=o.frames.map(u=>new q(u.frame.x/s.w,u.frame.y/s.h,u.frame.w/s.w,u.frame.h/s.h)),m={};for(let u of o.meta.frameTags)u.from===u.to?m[u.name]=u.from:m[u.name]={from:u.from,to:u.to,speed:10,loop:!0,pingpong:u.direction===\"pingpong\"};return Fe.from(e,{frames:i,anims:m})}))}var At=class{fontface;filter=Zt;outline=null;size=64;constructor(e,n={}){if(this.fontface=e,this.filter=n.filter??Zt,this.size=n.size??64,this.size>256)throw new Error(`Max font size: ${256}`);n.outline&&(this.outline={width:1,color:I(0,0,0)},typeof n.outline==\"number\"?this.outline.width=n.outline:typeof n.outline==\"object\"&&(n.outline.width&&(this.outline.width=n.outline.width),n.outline.color&&(this.outline.color=n.outline.color)))}};function Hr(t){if(!t)return Hr(a.globalOpt.font??ss);if(typeof t==\"string\"){let e=Hn(t),n=qr(t);if(e)return e.data??e;if(n)return n.data??n;if(document.fonts.check(`${64}px ${t}`))return t;if(Be()<1)return null;throw new Error(`Font not found: ${t}`)}else if(t instanceof ce)return t.data?t.data:t;return t}function qr(t){return a.assets.fonts.get(t)??null}function Qs(t,e,n={}){let r=pe(e),o=new FontFace(t,typeof e==\"string\"?`url(${r})`:r);return document.fonts.add(o),a.assets.fonts.add(t,o.load().catch(s=>{throw new Error(`Failed to load font from \"${r}\": ${s}`)}).then(s=>new At(s,n)))}function Js(t,e,n,r){let o=t.width/e,s={},i=r.split(\"\").entries();for(let[m,u]of i)s[u]=new q(m%o*e,Math.floor(m/o)*n,e,n);return{tex:t,map:s,size:n}}function Hn(t){return a.assets.bitmapFonts.get(t)??null}function Zs(t,e,n,r,o={}){let s=pe(e);return a.assets.bitmapFonts.add(t,Tt(s).then(i=>Js(Ve.fromImage(a.gfx.ggl,i,o),n,r,o.chars??Rn)))}function ei(t,e){return e=pe(e),a.assets.sprites.add(t,new Promise(async n=>{let r=typeof e==\"string\"?await Et(e):e,o=await Promise.all(r.frames.map(Tt)),s=document.createElement(\"canvas\");s.width=r.width,s.height=r.height*r.frames.length;let i=s.getContext(\"2d\");if(!i)throw new Error(\"Failed to create canvas context\");o.forEach((u,c)=>{i.drawImage(u,0,c*r.height)});let m=await Ot(null,s,{sliceY:r.frames.length,anims:r.anims});n(m)}))}var zr=class{ctx;glProgram;constructor(e,n,r,o){this.ctx=e,e.onDestroy(()=>this.free());let s=e.gl,i=s.createShader(s.VERTEX_SHADER),m=s.createShader(s.FRAGMENT_SHADER);if(!i||!m)throw new Error(\"Failed to create shader\");s.shaderSource(i,n),s.shaderSource(m,r),s.compileShader(i),s.compileShader(m);let u=s.createProgram();if(this.glProgram=u,s.attachShader(u,i),s.attachShader(u,m),o.forEach((c,p)=>s.bindAttribLocation(u,p,c)),s.linkProgram(u),!s.getProgramParameter(u,s.LINK_STATUS)){let c=s.getShaderInfoLog(i);if(c)throw new Error(\"VERTEX SHADER \"+c);let p=s.getShaderInfoLog(m);if(p)throw new Error(\"FRAGMENT SHADER \"+p)}s.deleteShader(i),s.deleteShader(m)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let n=this.ctx.gl;for(let r in e){let o=e[r],s=n.getUniformLocation(this.glProgram,r);if(typeof o==\"number\")n.uniform1f(s,o);else if(o instanceof fe)n.uniformMatrix4fv(s,!1,new Float32Array(o.m));else if(o instanceof j)n.uniform3f(s,o.r,o.g,o.b);else if(o instanceof E)n.uniform2f(s,o.x,o.y);else if(Array.isArray(o)){let i=o[0];bs(o)?n.uniform1fv(s,o):gs(o)?n.uniform2fv(s,o.map(m=>[m.x,m.y]).flat()):hs(o)&&n.uniform3fv(s,o.map(m=>[m.r,m.g,m.b]).flat())}else throw new Error(\"Unsupported uniform data type\")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}};function qn(t,e=tn,n=nn){let r=cs.replace(\"{{user}}\",e??tn),o=ls.replace(\"{{user}}\",n??nn);try{return new zr(t,r,o,en.map(s=>s.name))}catch(s){let m=/(?<type>^\\w+) SHADER ERROR: 0:(?<line>\\d+): (?<msg>.+)/,u=Cs(s).match(m);if(!u?.groups)throw s;let c=Number(u.groups.line)-14,p=u.groups.msg.trim(),b=u.groups.type.toLowerCase();throw new Error(`${b} shader line ${c}: ${p}`)}}function ti(t){if(!t)return a.gfx.defShader;if(typeof t==\"string\"){let e=Wr(t);if(e)return e.data??e;if(Be()<1)return null;throw new Error(`Shader not found: ${t}`)}else if(t instanceof ce)return t.data?t.data:t;return t}function Wr(t){return a.assets.shaders.get(t)??null}function ni(t,e,n){return a.assets.shaders.addLoaded(t,qn(a.gfx.ggl,e,n))}function ri(t,e,n){e=pe(e),n=pe(n);let r=s=>s?_s(s):Promise.resolve(null),o=Promise.all([r(e),r(n)]).then(([s,i])=>qn(a.gfx.ggl,s,i));return a.assets.shaders.add(t,o)}var ot=class t{buf;constructor(e){this.buf=e}static fromArrayBuffer(e){return new Promise((n,r)=>a.audio.ctx.decodeAudioData(e,n,r)).then(n=>new t(n))}static fromURL(e){return Fn(e)?t.fromArrayBuffer(ys(e)):Ns(e).then(n=>t.fromArrayBuffer(n))}};function oi(t){if(typeof t==\"string\"){let e=Yr(t);if(e)return e;if(Be()<1)return null;throw new Error(`Sound not found: ${t}`)}else{if(t instanceof ot)return ce.loaded(t);if(t instanceof ce)return t;throw new Error(`Invalid sound: ${t}`)}}function Yr(t){return a.assets.sounds.get(t)??null}function si(t,e){return e=pe(e),a.assets.sounds.add(t,typeof e==\"string\"?ot.fromURL(e):ot.fromArrayBuffer(e))}function ii(t,e){let n=pe(e),r=new Audio(n);return r.preload=\"auto\",a.assets.music[t]=n}function $r(t,e){return t=pe(t),typeof e==\"string\"?cn(new Promise((n,r)=>{Et(e).then(o=>{$r(t,o).then(n).catch(r)})})):cn(Fe.from(t).then(n=>{let r={};for(let o in e){let s=e[o],i=n.frames[0],m=2048*i.w,u=2048*i.h,c=s.frames?s.frames.map(b=>new q(i.x+(s.x+b.x)/m*i.w,i.y+(s.y+b.y)/u*i.h,b.w/m*i.w,b.h/u*i.h)):Ur(s.sliceX||1,s.sliceY||1,i.x+s.x/m*i.w,i.y+s.y/u*i.h,s.width/m*i.w,s.height/u*i.h),p=new Fe(n.tex,c,s.anims);a.assets.sprites.addLoaded(o,p),r[o]=p}return r}))}function Le(t,e,n=!1,r,o,s={}){let i=r??a.gfx.defTex,m=o??a.gfx.defShader,u=ti(m);if(!u||u instanceof ce)return;let c=a.gfx.fixed||n?a.gfx.transform:a.game.cam.transform.mult(a.gfx.transform),p=[];for(let b of t){let l=js(c.multVec2(b.pos));p.push(l.x,l.y,b.uv.x,b.uv.y,b.color.r/255,b.color.g/255,b.color.b/255,b.opacity)}a.gfx.renderer.push(a.gfx.ggl.gl.TRIANGLES,p,e,u,i,s)}function Pe(t){if(!t.pts)throw new Error('drawPolygon() requires property \"pts\".');let e=t.pts.length;if(!(e<3)){if(ge(),X(t.pos),rt(t.scale),Ye(t.angle),X(t.offset),t.fill!==!1){let n=t.color??j.WHITE,r=t.pts.map((s,i)=>({pos:new E(s.x,s.y),uv:t.uv?t.uv[i]:new E(0,0),color:t.colors&&t.colors[i]?t.colors[i].mult(n):n,opacity:t.opacity??1})),o;t.triangulate?o=Mn(t.pts).map(i=>i.map(m=>t.pts.indexOf(m))).flat():o=[...Array(e-2).keys()].map(s=>[0,s+1,s+2]).flat(),Le(r,t.indices??o,t.fixed,t.uv?t.tex:a.gfx.defTex,t.shader,t.uniform??void 0)}t.outline&&kt({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity??t.outline.opacity}),me()}}function zn(t){if(t.radiusX===void 0||t.radiusY===void 0)throw new Error('drawEllipse() requires properties \"radiusX\" and \"radiusY\".');if(t.radiusX===0||t.radiusY===0)return;let e=t.start??0,n=t.end??360,r=_e(t.anchor??\"center\").scale(new E(-t.radiusX,-t.radiusY)),o=wt(r,t.radiusX,t.radiusY,e,n,t.resolution);o.unshift(r);let s=Object.assign({},t,{pts:o,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(o.length-1).fill(t.gradient[1])]}:{}});if(n-e>=360&&t.outline){t.fill!==!1&&Pe(Object.assign({},s,{outline:null})),Pe(Object.assign({},s,{pts:o.slice(1),fill:!1}));return}Pe(s)}function Ne(t){if(typeof t.radius!=\"number\")throw new Error('drawCircle() requires property \"radius\".');t.radius!==0&&zn(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}function _t(t){let{p1:e,p2:n}=t;if(!e||!n)throw new Error('drawLine() requires properties \"p1\" and \"p2\".');let r=t.width||1,o=n.sub(e).unit().normal().scale(r*.5),s=[e.sub(o),e.add(o),n.add(o),n.sub(o)].map(i=>({pos:new E(i.x,i.y),uv:new E(0),color:t.color??j.WHITE,opacity:t.opacity??1}));Le(s,[0,1,3,1,2,3],t.fixed,a.gfx.defTex,t.shader,t.uniform??void 0)}function $u(t){let e=t.pts,n=[],r=(t.width||1)*.5,o=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),s=t.pos||v(0,0),i;o?i=e[0].sub(e[e.length-2]):i=e[1].sub(e[0]);let m=i.len(),u=i.normal().scale(-r/m),c,p=e[0];if(!o)switch(t.cap){case\"square\":{let d=i.scale(-r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(-1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)n.push(p),n.push(p.sub(g)),g=v(g.x*y-g.y*O,g.x*O+g.y*y)}}for(let d=1;d<e.length;d++){if(p===e[d]||p.eq(e[d]))continue;c=p,p=e[d];let C=p.sub(c),g=C.len(),y=C.normal().scale(-r/g),O=i.cross(C);if(Math.abs(O)/(m*g)<.05){n.push(c.add(u)),n.push(c.sub(u)),i.dot(C)<0&&(n.push(c.sub(u)),n.push(c.add(u))),i=C,m=g,u=y;continue}let A=y.sub(u).cross(C)/O,R=u.add(i.scale(A));O>0?(n.push(c.add(R)),n.push(c.sub(u)),n.push(c.add(R)),n.push(c.sub(y))):(n.push(c.add(u)),n.push(c.sub(R)),n.push(c.add(y)),n.push(c.sub(R))),i=C,m=g,u=y}if(!o)switch(n.push(p.add(u)),n.push(p.sub(u)),t.cap){case\"square\":{let d=i.scale(r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)g=v(g.x*y-g.y*O,g.x*O+g.y*y),n.push(p),n.push(p.sub(g))}}if(n.length<4)return;let b=n.map(d=>({pos:s.add(d),uv:v(),color:t.color||j.WHITE,opacity:t.opacity??1})),l=[],h=0;for(let d=0;d<n.length-2;d+=2)l[h++]=d+1,l[h++]=d,l[h++]=d+2,l[h++]=d+2,l[h++]=d+3,l[h++]=d+1;o&&(l[h++]=n.length-1,l[h++]=n.length-2,l[h++]=0,l[h++]=0,l[h++]=1,l[h++]=n.length-1),Le(b,l,t.fixed,a.gfx.defTex,t.shader,t.uniform??void 0)}function Xu(t){let e=t.pts,n=[],r=(t.width||1)*.5,o=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),s=t.pos||v(0,0),i;o?i=e[0].sub(e[e.length-2]):i=e[1].sub(e[0]);let m=i.len(),u=i.normal().scale(-r/m),c,p=e[0];if(!o)switch(t.cap){case\"square\":{let d=i.scale(-r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(-1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)n.push(p),n.push(p.sub(g)),g=v(g.x*y-g.y*O,g.x*O+g.y*y)}}for(let d=1;d<e.length;d++){if(p===e[d]||p.eq(e[d]))continue;c=p,p=e[d];let C=p.sub(c),g=C.len(),y=C.normal().scale(-r/g),O=i.cross(C);if(Math.abs(O)/(m*g)<.05){n.push(c.add(u)),n.push(c.sub(u)),i.dot(C)<0&&(n.push(c.sub(u)),n.push(c.add(u))),i=C,m=g,u=y;continue}let A=y.sub(u).cross(C)/O,R=u.add(i.scale(A));if(O>0){let V=c.add(R),x=Math.max(r,10),w=ae(u.angleBetween(y)/x),S=u,G=Math.cos(w),M=Math.sin(w);for(let D=0;D<x;D++)n.push(V),n.push(c.sub(S)),S=v(S.x*G-S.y*M,S.x*M+S.y*G)}else{let V=c.sub(R),x=Math.max(r,10),w=ae(u.angleBetween(y)/x),S=u,G=Math.cos(w),M=Math.sin(w);for(let D=0;D<x;D++)n.push(c.add(S)),n.push(V),S=v(S.x*G-S.y*M,S.x*M+S.y*G)}i=C,m=g,u=y}if(!o)switch(n.push(p.add(u)),n.push(p.sub(u)),t.cap){case\"square\":{let d=i.scale(r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)g=v(g.x*y-g.y*O,g.x*O+g.y*y),n.push(p),n.push(p.sub(g))}}if(n.length<4)return;let b=n.map(d=>({pos:s.add(d),uv:v(),color:t.color||j.WHITE,opacity:t.opacity??1})),l=[],h=0;for(let d=0;d<n.length-2;d+=2)l[h++]=d+1,l[h++]=d,l[h++]=d+2,l[h++]=d+2,l[h++]=d+3,l[h++]=d+1;o&&(l[h++]=n.length-1,l[h++]=n.length-2,l[h++]=0,l[h++]=0,l[h++]=1,l[h++]=n.length-1),Le(b,l,t.fixed,a.gfx.defTex,t.shader,t.uniform??void 0)}function Qu(t){let e=t.pts,n=[],r=(t.width||1)*.5,o=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),s=t.pos||v(0,0),i;o?i=e[0].sub(e[e.length-2]):i=e[1].sub(e[0]);let m=i.len(),u=i.normal().scale(-r/m),c,p=e[0];if(!o)switch(t.cap){case\"square\":{let d=i.scale(-r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(-1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)n.push(p),n.push(p.sub(g)),g=v(g.x*y-g.y*O,g.x*O+g.y*y)}}for(let d=1;d<e.length;d++){if(p===e[d]||p.eq(e[d]))continue;c=p,p=e[d];let C=p.sub(c),g=C.len(),y=C.normal().scale(-r/g),O=i.cross(C);if(Math.abs(O)/(m*g)<.05){n.push(c.add(u)),n.push(c.sub(u)),i.dot(C)<0&&(n.push(c.sub(u)),n.push(c.add(u))),i=C,m=g,u=y;continue}let A=y.sub(u).cross(C)/O,R=u.add(i.scale(A));n.push(c.add(R)),n.push(c.sub(R)),i=C,m=g,u=y}if(!o)switch(n.push(p.add(u)),n.push(p.sub(u)),t.cap){case\"square\":{let d=i.scale(r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)g=v(g.x*y-g.y*O,g.x*O+g.y*y),n.push(p),n.push(p.sub(g))}}if(n.length<4)return;let b=n.map(d=>({pos:s.add(d),uv:v(),color:t.color||j.WHITE,opacity:t.opacity??1})),l=[],h=0;for(let d=0;d<n.length-2;d+=2)l[h++]=d+1,l[h++]=d,l[h++]=d+2,l[h++]=d+2,l[h++]=d+3,l[h++]=d+1;o&&(l[h++]=n.length-1,l[h++]=n.length-2,l[h++]=0,l[h++]=0,l[h++]=1,l[h++]=n.length-1),Le(b,l,t.fixed,a.gfx.defTex,t.shader,t.uniform??void 0)}function kt(t){let e=t.pts,n=t.width??1;if(!e)throw new Error('drawLines() requires property \"pts\".');if(!(e.length<2)){if(e.length>2)switch(t.join){case\"bevel\":return $u(t);case\"round\":return Xu(t);case\"miter\":return Qu(t)}if(t.radius&&e.length>=3){_t(Object.assign({},t,{p1:e[0],p2:e[1]}));for(let r=1;r<e.length-2;r++){let o=e[r],s=e[r+1];_t(Object.assign({},t,{p1:o,p2:s}))}_t(Object.assign({},t,{p1:e[e.length-2],p2:e[e.length-1]}))}else for(let r=0;r<e.length-1;r++)_t(Object.assign({},t,{p1:e[r],p2:e[r+1]})),t.join!==\"none\"&&Ne(Object.assign({},t,{pos:e[r],radius:n/2}))}}function Wn(t,e){let n=e.segments??16,r=[];for(let o=0;o<=n;o++)r.push(t(o/n));kt({pts:r,width:e.width||1,pos:e.pos,color:e.color,opacity:e.opacity})}function ai(t){Wn(e=>Jt(t.pt1,t.pt2,t.pt3,t.pt4,e),t)}var Ve=class t{ctx;src=null;glTex;width;height;constructor(e,n,r,o={}){this.ctx=e;let s=e.gl,i=e.gl.createTexture();if(!i)throw new Error(\"Failed to create texture\");this.glTex=i,e.onDestroy(()=>this.free()),this.width=n,this.height=r;let m={linear:s.LINEAR,nearest:s.NEAREST}[o.filter??e.opts.texFilter??\"nearest\"],u={repeat:s.REPEAT,clampToEdge:s.CLAMP_TO_EDGE}[o.wrap??\"clampToEdge\"];this.bind(),n&&r&&s.texImage2D(s.TEXTURE_2D,0,s.RGBA,n,r,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,m),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,m),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,u),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,u),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.unbind()}static fromImage(e,n,r={}){let o=new t(e,n.width,n.height,r);return o.update(n),o.src=n,o}update(e,n=0,r=0){let o=this.ctx.gl;this.bind(),o.texSubImage2D(o.TEXTURE_2D,0,n,r,o.RGBA,o.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},st=class{ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,n,r,o={}){this.ctx=e;let s=e.gl;e.onDestroy(()=>this.free()),this.tex=new Ve(e,n,r,o);let i=s.createFramebuffer(),m=s.createRenderbuffer();if(!i||!m)throw new Error(\"Failed to create framebuffer\");this.glFramebuffer=i,this.glRenderbuffer=m,this.bind(),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,n,r),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.tex.glTex,0),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,n=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,n),this.unbind();let r=this.width*4,o=new Uint8Array(r);for(let s=0;s<(this.height/2|0);s++){let i=s*r,m=(this.height-s-1)*r;o.set(n.subarray(i,i+r)),n.copyWithin(i,m,m+r),n.set(o,m)}return new ImageData(n,this.width,this.height)}toDataURL(){let e=document.createElement(\"canvas\"),n=e.getContext(\"2d\");if(e.width=this.width,e.height=this.height,!n)throw new Error(\"Failed to get 2d context\");return n.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},Yn=class{ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,n,r,o){let s=e.gl;this.vertexFormat=n,this.ctx=e,this.stride=n.reduce((m,u)=>m+u.size,0),this.maxVertices=r,this.maxIndices=o;let i=s.createBuffer();if(!i)throw new Error(\"Failed to create vertex buffer\");this.glVBuf=i,e.pushArrayBuffer(this.glVBuf),s.bufferData(s.ARRAY_BUFFER,r*4,s.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=s.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),s.bufferData(s.ELEMENT_ARRAY_BUFFER,o*4,s.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,n,r,o,s=null,i={}){(e!==this.curPrimitive||s!==this.curTex||o!==this.curShader||!Ln(this.curUniform,i)||this.vqueue.length+n.length*this.stride>this.maxVertices||this.iqueue.length+r.length>this.maxIndices)&&this.flush();let m=this.vqueue.length/this.stride;for(let u of n)this.vqueue.push(u);for(let u of r)this.iqueue.push(u+m);this.curPrimitive=e,this.curShader=o,this.curTex=s,this.curUniform=i}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function St(t){let e=[],n=s=>{e.push(s),t(s)},r=()=>{e.pop(),t(o()??null)},o=()=>e[e.length-1];return[n,r,o]}function ui(t,e={}){let n=[];function r(V){n.push(V)}function o(){n.forEach(x=>x());let V=t.getExtension(\"WEBGL_lose_context\");V&&V.loseContext()}let s=null;function i(V){if(Ln(V,s))return;s=V;let x=V.reduce((w,S)=>w+S.size,0);V.reduce((w,S,G)=>(t.vertexAttribPointer(G,S.size,t.FLOAT,!1,x*4,w),t.enableVertexAttribArray(G),w+S.size*4),0)}let[m,u]=St(V=>t.bindTexture(t.TEXTURE_2D,V)),[c,p]=St(V=>t.bindBuffer(t.ARRAY_BUFFER,V)),[b,l]=St(V=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,V)),[h,d]=St(V=>t.bindFramebuffer(t.FRAMEBUFFER,V)),[C,g]=St(V=>t.bindRenderbuffer(t.RENDERBUFFER,V)),[y,O]=St(V=>{if(!V)return;let{x,y:w,w:S,h:G}=V;t.viewport(x,w,S,G)}),[A,R]=St(V=>t.useProgram(V));return y({x:0,y:0,w:t.drawingBufferWidth,h:t.drawingBufferHeight}),{gl:t,opts:e,onDestroy:r,destroy:o,pushTexture2D:m,popTexture2D:u,pushArrayBuffer:c,popArrayBuffer:p,pushElementArrayBuffer:b,popElementArrayBuffer:l,pushFramebuffer:h,popFramebuffer:d,pushRenderbuffer:C,popRenderbuffer:g,pushViewport:y,popViewport:O,pushProgram:A,popProgram:R,setVertexFormat:i}}var Xr={};function mi(t,e){if(e.override){Object.assign(t,e);return}e.pos&&(t.pos=t.pos.add(e.pos)),e.scale&&(t.scale=t.scale.scale(v(e.scale))),e.angle&&(t.angle+=e.angle),e.color&&t.ch.length===1&&(t.color=t.color.mult(e.color)),e.opacity!=null&&(t.opacity*=e.opacity)}function $n(t){let e={},n=\"\",r=[],o=String(t),s=i=>{r.length>0&&(e[n.length]=r.slice()),n+=i};for(;o!==\"\";){if(o[0]===\"\\\\\"){if(o.length===1)throw new Error(\"Styled text error: \\\\ at end of string\");s(o[1]),o=o.slice(2);continue}if(o[0]===\"[\"){let i=/^\\[(\\/)?(\\w+?)\\]/.exec(o);if(!i){s(o[0]),o=o.slice(1);continue}let[m,u,c]=i;if(u!==void 0){let p=r.pop();if(p!==c)throw p!==void 0?new Error(`Styled text error: mismatched tags. Expected [/${p}], got [/${c}]`):new Error(`Styled text error: stray end tag [/${c}]`)}else r.push(c);o=o.slice(m.length);continue}s(o[0]),o=o.slice(1)}if(r.length>0)throw new Error(`Styled text error: unclosed tags ${r}`);return{charStyleMap:e,text:n}}function Ue(t){if(t.text===void 0)throw new Error('formatText() requires property \"text\".');let e=Hr(t.font);if(!t.text||t.text===\"\"||e instanceof ce||!e)return{width:0,height:0,chars:[],opt:t,renderedText:\"\"};let{charStyleMap:n,text:r}=$n(t.text+\"\"),o=Ts(r);if(e instanceof At||typeof e==\"string\"){let A=e instanceof At?e.fontface.family:e,R=e instanceof At?{outline:e.outline,filter:e.filter}:{outline:null,filter:Zt},V=Xr[A]??{font:{tex:new Ve(a.gfx.ggl,2048,2048,{filter:R.filter}),map:{},size:64},cursor:new E(0),maxHeight:0,outline:R.outline};Xr[A]||(Xr[A]=V),e=V.font;for(let x of o)if(!V.font.map[x]){let w=a.fontCacheC2d;if(!w)throw new Error(\"fontCacheC2d is not defined.\");if(!a.fontCacheCanvas)throw new Error(\"fontCacheCanvas is not defined.\");w.clearRect(0,0,a.fontCacheCanvas.width,a.fontCacheCanvas.height),w.font=`${e.size}px ${A}`,w.textBaseline=\"top\",w.textAlign=\"left\",w.fillStyle=\"#ffffff\";let S=w.measureText(x),G=Math.ceil(S.width);if(!G)continue;let M=Math.ceil(Math.abs(S.actualBoundingBoxAscent))+Math.ceil(Math.abs(S.actualBoundingBoxDescent));V.outline&&V.outline.width&&V.outline.color&&(w.lineJoin=\"round\",w.lineWidth=V.outline.width*2,w.strokeStyle=V.outline.color.toHex(),w.strokeText(x,V.outline.width,V.outline.width),G+=V.outline.width*2,M+=V.outline.width*3),w.fillText(x,V.outline?.width??0,V.outline?.width??0);let D=w.getImageData(0,0,G,M);if(V.cursor.x+G>2048&&(V.cursor.x=0,V.cursor.y+=V.maxHeight,V.maxHeight=0,V.cursor.y>2048))throw new Error(\"Font atlas exceeds character limit\");e.tex.update(D,V.cursor.x,V.cursor.y),e.map[x]=new q(V.cursor.x,V.cursor.y,G,M),V.cursor.x+=G+1,V.maxHeight=Math.max(V.maxHeight,M)}}let s=t.size||e.size,i=v(t.scale??1).scale(s/e.size),m=t.lineSpacing??0,u=t.letterSpacing??0,c=0,p=0,b=0,l=[],h=[],d=0,C=null,g=0,y;for(;d<o.length;){let A=o[d];if(A===`\n`)b+=s+m,l.push({width:c-u,chars:h}),C=null,g=0,c=0,h=[],y=void 0;else{let R=e.map[A];if(R){let V=R.w*i.x;t.width&&c+V>t.width&&(b+=s+m,C!=null&&(d-=h.length-C,A=o[d],R=e.map[A],V=R.w*i.x,h=h.slice(0,C-1),c=g),C=null,g=0,l.push({width:c-u,chars:h}),c=y??0,h=[]),h.push({tex:e.tex,width:R.w,height:R.h,quad:new q(R.x/e.tex.width,R.y/e.tex.height,R.w/e.tex.width,R.h/e.tex.height),ch:A,pos:new E(c,b),opacity:t.opacity??1,color:t.color??j.WHITE,scale:v(i),angle:0}),A===\" \"&&(C=h.length,g=c),t.indentAll&&y===void 0&&/\\S/.test(A)&&(y=c),c+=V,p=Math.max(p,c),c+=u}}d++}l.push({width:c-u,chars:h}),b+=s,t.width&&(p=t.width);let O=[];for(let A=0;A<l.length;A++){let R=(p-l[A].width)*Rs(t.align??\"left\");for(let V of l[A].chars){let x=e.map[V.ch],w=O.length+A;if(V.pos=V.pos.add(R,0).add(x.w*i.x*.5,x.h*i.y*.5),t.transform){let S=typeof t.transform==\"function\"?t.transform(w,V.ch):t.transform;S&&mi(V,S)}if(n[w]){let S=n[w];for(let G of S){let M=t.styles?.[G],D=typeof M==\"function\"?M(w,V.ch):M;D&&mi(V,D)}}O.push(V)}}return{width:p,height:b,chars:O,opt:t,renderedText:r}}function it(t){if(t.width===void 0||t.height===void 0)throw new Error('drawUVQuad() requires property \"width\" and \"height\".');if(t.width<=0||t.height<=0)return;let e=t.width,n=t.height,o=_e(t.anchor||mt).scale(new E(e,n).scale(-.5)),s=t.quad||new q(0,0,1,1),i=t.color||I(255,255,255),m=t.opacity??1,u=t.tex?.1/t.tex.width:0,c=t.tex?.1/t.tex.height:0,p=s.x+u,b=s.y+c,l=s.w-u*2,h=s.h-c*2;ge(),X(t.pos),Ye(t.angle),rt(t.scale),X(o),Le([{pos:new E(-e/2,n/2),uv:new E(t.flipX?p+l:p,t.flipY?b:b+h),color:i,opacity:m},{pos:new E(-e/2,-n/2),uv:new E(t.flipX?p+l:p,t.flipY?b+h:b),color:i,opacity:m},{pos:new E(e/2,-n/2),uv:new E(t.flipX?p:p+l,t.flipY?b+h:b),color:i,opacity:m},{pos:new E(e/2,n/2),uv:new E(t.flipX?p:p+l,t.flipY?b:b+h),color:i,opacity:m}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform??void 0),me()}function He(t){ge(),X(t.opt.pos),Ye(t.opt.angle),X(_e(t.opt.anchor??\"topleft\").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(e=>{it({tex:e.tex,width:e.width,height:e.height,pos:e.pos,scale:e.scale,angle:e.angle,color:e.color,opacity:e.opacity,quad:e.quad,anchor:\"center\",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),me()}function xe(t){if(t.width===void 0||t.height===void 0)throw new Error('drawRect() requires property \"width\" and \"height\".');if(t.width<=0||t.height<=0)return;let e=t.width,n=t.height,o=_e(t.anchor||mt).add(1,1).scale(new E(e,n).scale(-.5)),s=[new E(0,0),new E(e,0),new E(e,n),new E(0,n)];if(t.radius){let i=Math.min(e,n)/2,m=Array.isArray(t.radius)?t.radius.map(u=>Math.min(i,u)):new Array(4).fill(Math.min(i,t.radius));s=[new E(m[0],0),...m[1]?wt(new E(e-m[1],m[1]),m[1],m[1],270,360):[v(e,0)],...m[2]?wt(new E(e-m[2],n-m[2]),m[2],m[2],0,90):[v(e,n)],...m[3]?wt(new E(m[3],n-m[3]),m[3],m[3],90,180):[v(0,n)],...m[0]?wt(new E(m[0],m[0]),m[0],m[0],180,270):[]]}Pe(Object.assign({},t,{offset:o,pts:s,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}function qe(t){Ce();let e=a.gfx.width,n=a.gfx.height;a.gfx.width=a.gfx.viewport.width,a.gfx.height=a.gfx.viewport.height,t(),Ce(),a.gfx.width=e,a.gfx.height=n}function Qr(t,e){qe(()=>{let n=v(8);ge(),X(t);let r=Ue({text:e,font:yt,size:16,pos:n,color:I(255,255,255),fixed:!0}),o=r.width+n.x*2,s=r.height+n.x*2;t.x+o>=ie()&&X(v(-o,0)),t.y+s>=ue()&&X(v(0,-s)),xe({width:o,height:s,color:I(0,0,0),radius:4,opacity:.8,fixed:!0}),He(r),me()})}function Xn(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawTriangle() requires properties \"p1\", \"p2\" and \"p3\".');return Pe(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}function di(){if(a.debug.inspect){let t=null;for(let e of a.game.root.get(\"*\",{recursive:!0}))if(e.has(\"area\")&&e.isHovering()){t=e;break}if(a.game.root.drawInspect(),t){let e=[],n=t.inspect();for(let r in n)n[r]?e.push(`${n[r]}`):e.push(`${r}`);Qr(Ss(a.k.mousePos()),e.join(`\n`))}Qr(v(8),`FPS: ${a.debug.fps()}`)}a.debug.paused&&qe(()=>{ge(),X(ie(),0),X(-8,8);let t=32;xe({width:t,height:t,anchor:\"topright\",color:I(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)xe({width:4,height:t*.6,anchor:\"center\",pos:v(-t/3*e,t*.5),color:I(255,255,255),radius:2,fixed:!0});me()}),a.debug.timeScale!==1&&qe(()=>{ge(),X(ie(),ue()),X(-8,-8);let t=8,e=Ue({text:a.debug.timeScale.toFixed(1),font:yt,size:16,color:I(255,255,255),pos:v(-t),anchor:\"botright\",fixed:!0});xe({width:e.width+t*2+t*4,height:e.height+t*2,anchor:\"botright\",color:I(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=0;n<2;n++){let r=a.debug.timeScale<1;Xn({p1:v(-e.width-t*(r?2:3.5),-t),p2:v(-e.width-t*(r?2:3.5),-t-e.height),p3:v(-e.width-t*(r?3.5:2),-t-e.height/2),pos:v(-n*t*1+(r?-t*.5:0),0),color:I(255,255,255),fixed:!0})}He(e),me()}),a.debug.curRecording&&qe(()=>{ge(),X(0,ue()),X(24,-24),Ne({radius:12,color:I(255,0,0),opacity:An(0,1,a.app.time()*4),fixed:!0}),me()}),a.debug.showLog&&a.game.logs.length>0&&qe(()=>{ge(),X(0,ue()),X(8,-8);let t=8,e=[];for(let r of a.game.logs){let o=\"\",s=r.msg instanceof Error?\"error\":\"info\";o+=`[time]${r.time.toFixed(2)}[/time]`,o+=\" \",o+=`[${s}]${Jr(r.msg)}[/${s}]`,e.push(o)}a.game.logs=a.game.logs.filter(r=>a.app.time()-r.time<(a.globalOpt.logTime||4));let n=Ue({text:e.join(`\n`),font:yt,pos:v(t,-t),anchor:\"botleft\",size:16,width:ie()*.6,lineSpacing:t/2,fixed:!0,styles:{time:{color:I(127,127,127)},info:{color:I(255,255,255)},error:{color:I(255,0,127)}}});xe({width:n.width+t*2,height:n.height+t*2,anchor:\"botleft\",color:I(0,0,0),radius:4,opacity:.8,fixed:!0}),He(n),me()})}function Jr(t,e=!1,n=new Set){if(n.has(t))return\"<recursive>\";var r=\"\",o;return e&&typeof t==\"string\"&&(t=JSON.stringify(t)),Array.isArray(t)&&(r=[\"[\",t.map(s=>Jr(s,!0,n.union(new Set([t])))).join(\", \"),\"]\"].join(\"\"),t=r),t===null?\"null\":(typeof t==\"object\"&&t.toString===Object.prototype.toString&&(t.constructor!==Object&&(r+=t.constructor.name+\" \"),r+=[\"{\",(o=Object.getOwnPropertyNames(t).map(s=>`${/^\\w+$/.test(s)?s:JSON.stringify(s)}: ${Jr(t[s],!0,n.union(new Set([t])))}`).join(\", \"))?` ${o} `:\"\",\"}\"].join(\"\"),t=r),String(t).replaceAll(/(?<!\\\\)\\[/g,\"\\\\[\"))}function fi(){let t=a.game.cam,e=E.fromAngle(he(0,360)).scale(t.shake);t.shake=de(t.shake,0,5*ee()),t.transform=new fe().translate(Ct()).scale(t.scale).rotate(t.angle).translate((t.pos??Ct()).scale(-1).add(e)),a.game.root.draw(),Ce()}function hi(){let t=Be();a.game.events.numListeners(\"loading\")>0?a.game.events.trigger(\"loading\",t):qe(()=>{let e=ie()/2,n=24,r=v(ie()/2,ue()/2).sub(v(e/2,n/2));xe({pos:v(0),width:ie(),height:ue(),color:I(0,0,0)}),xe({pos:r,width:e,height:n,fill:!1,outline:{width:4}}),xe({pos:r,width:e*t,height:n})})}function Qn(t,e,n){let r=a.gfx.ggl.gl;Ce(),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST),r.stencilFunc(r.NEVER,1,255),r.stencilOp(r.REPLACE,r.REPLACE,r.REPLACE),e(),Ce(),r.stencilFunc(n,1,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),t(),Ce(),r.disable(r.STENCIL_TEST)}function gi(t,e){let n=a.gfx.ggl.gl;Qn(t,e,n.EQUAL)}function Vt(t){if(!t.tex)throw new Error('drawTexture() requires property \"tex\".');let e=t.quad??new q(0,0,1,1),n=t.tex.width*e.w,r=t.tex.height*e.h,o=new E(1);if(t.tiled){let s=_e(t.anchor||mt),i=(t.pos?.x||0)-(s.x+1)*.5*(t.width||n),m=(t.pos?.y||0)-(s.y+1)*.5*(t.height||r),u=(t.width||n)/n,c=(t.height||r)/r,p=Math.floor(u),b=Math.floor(c),l=u-p,h=c-b,d=(p+l?1:0)*(b+h?1:0),C=new Array(d*6),g=new Array(d*4),y=0,O=(A,R,V,x,w)=>{C[y*6+0]=y*4+0,C[y*6+1]=y*4+1,C[y*6+2]=y*4+3,C[y*6+3]=y*4+1,C[y*6+4]=y*4+2,C[y*6+5]=y*4+3,g[y*4+0]={pos:new E(A-s.x,R-s.y),uv:new E(w.x,w.y),color:t.color||j.WHITE,opacity:t.opacity||1},g[y*4+1]={pos:new E(A+V-s.x,R-s.y),uv:new E(w.x+w.w,w.y),color:t.color||j.WHITE,opacity:t.opacity||1},g[y*4+2]={pos:new E(A+V-s.x,R+x-s.y),uv:new E(w.x+w.w,w.y+w.h),color:t.color||j.WHITE,opacity:t.opacity||1},g[y*4+3]={pos:new E(A-s.x,R+x-s.y),uv:new E(w.x,w.y+w.h),color:t.color||j.WHITE,opacity:t.opacity||1},y++};for(let A=0;A<b;A++){for(let R=0;R<p;R++)O(R*n,A*r,n,r,e);l&&O(p*n,A*r,n*l,r,new q(e.x,e.y,e.w*l,e.h))}if(h){for(let A=0;A<p;A++)O(A*n,b*r,n,r*h,new q(e.x,e.y,e.w,e.h*h));l&&O(p*n,b*r,n*l,r*h,new q(e.x,e.y,e.w*l,e.h*h))}Le(g,C,t.fixed,t.tex,t.shader,t.uniform??void 0)}else t.width&&t.height?(o.x=t.width/n,o.y=t.height/r):t.width?(o.x=t.width/n,o.y=o.x):t.height&&(o.y=t.height/r,o.x=o.y),it(Object.assign({},t,{scale:o.scale(t.scale||new E(1)),tex:t.tex,quad:e,width:n,height:r}))}function bi(t){if(!t.sprite)throw new Error('drawSprite() requires property \"sprite\"');let e=Kt(t.sprite);if(!e||!e.data)return;let n=e.data.frames[t.frame??0];if(!n)throw new Error(`Frame not found: ${t.frame??0}`);Vt(Object.assign({},t,{tex:e.data.tex,quad:n.scale(t.quad??new q(0,0,1,1))}))}function yi(t,e){let n=a.gfx.ggl.gl;Qn(t,e,n.NOTEQUAL)}function Zr(t){He(Ue(t))}var xi=(t,e)=>{let n=qn(e,tn,nn),r=t.pixelDensity??1,o=t.scale??1,{gl:s}=e,i=Ve.fromImage(e,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),m=t.width&&t.height?new st(e,t.width*r*o,t.height*r*o):new st(e,s.drawingBufferWidth,s.drawingBufferHeight),u=null,c=1;t.background&&(typeof t.background==\"string\"?u=I(t.background):(u=I(...t.background),c=t.background[3]??1),s.clearColor(u.r/255,u.g/255,u.b/255,c??1)),s.enable(s.BLEND),s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);let p=new Yn(e,en,as,us),b=Ve.fromImage(e,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:\"repeat\",filter:\"nearest\"});return{lastDrawCalls:0,ggl:e,defShader:n,defTex:i,frameBuffer:m,postShader:null,postShaderUniform:null,renderer:p,transform:new fe,transformStack:[],bgTex:b,bgColor:u,bgAlpha:c,width:t.width??s.drawingBufferWidth/r/o,height:t.height??s.drawingBufferHeight/r/o,viewport:{x:0,y:0,width:s.drawingBufferWidth,height:s.drawingBufferHeight,scale:1},fixed:!1}};function at(t){return t.fixed?!0:t.parent?at(t.parent):!1}function je(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}function vi(t,e={}){return{id:\"circle\",radius:t,draw(){Ne(Object.assign(je(this),{radius:this.radius,fill:e.fill}))},renderArea(){return new W(new E(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}function Jn(...t){return{id:\"color\",color:I(...t),inspect(){return`color: ${this.color.toString()}`}}}function wi(t){return{add(){this.canvas=t}}}function Ci(t=1){let e,n=0,r=!1;return{require:[\"opacity\"],add(){e=this.opacity,this.opacity=0},update(){r||(n+=ee(),this.opacity=Se(n,0,t,0,e),n>=t&&(this.opacity=e,r=!0))}}}function Ei(t=\"intersect\"){return{id:\"mask\",mask:t}}function Zn(t){return{id:\"opacity\",opacity:t??1,fadeIn(e=1,n=a.k.easings.linear){return a.game.root.tween(0,this.opacity,e,r=>this.opacity=r,n)},fadeOut(e=1,n=a.k.easings.linear){return a.game.root.tween(this.opacity,0,e,r=>this.opacity=r,n)},inspect(){return`opacity: ${on(this.opacity,1)}`}}}function Ti(t=1,e=I(0,0,0),n=1,r=\"miter\",o=10,s=\"butt\"){return{id:\"outline\",outline:{width:t,color:e,opacity:n,join:r,miterLimit:o,cap:s},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}var eo=class{pos=v(0);vel=v(0);acc=v(0);angle=0;angularVelocity=0;damping=0;t;lt=null;gc;constructor(){this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}};function Oi(t,e){let n=e.lifetime,r=[],o=t.colors||[j.WHITE],s=t.opacities||[1],i=t.quads||[new q(0,0,1,1)],m=t.scales||[1],u=t.lifeTime,c=e.direction,p=e.spread,b=t.speed||[0,0],l=t.angle||[0,0],h=t.angularVelocity||[0,0],d=t.acceleration||[v(0),v(0)],C=t.damping||[0,0],g=[],y=new Array(t.max),O=0,A=0;for(let x=0;x<t.max;x++){g[x*6+0]=x*4+0,g[x*6+1]=x*4+1,g[x*6+2]=x*4+3,g[x*6+3]=x*4+1,g[x*6+4]=x*4+2,g[x*6+5]=x*4+3;for(let w=0;w<4;w++)y[x*4+w]={pos:new E(0,0),uv:new E(0,0),color:I(255,255,255),opacity:1};r[x]=new eo}let R=new re;function V(x=0){for(;x<t.max;){if(r[x].gc)return x;x++}return null}return{id:\"particles\",emit(x){let w=0;for(let S=0;S<x;S++){if(w=V(w),w==null)return;let G=he(c-p,c+p),M=E.fromAngle(G).scale(he(b[0],b[1])),D=he(l[0],l[1]),L=he(h[0],h[1]),U=v(he(d[0].x,d[1].x),he(d[0].y,d[1].y)),H=he(C[0],C[1]),Y=u?he(u[0],u[1]):null,_=e.shape?e.shape.random():v(),K=r[w];K.lt=Y,K.pos=_,K.vel=M,K.acc=U,K.angle=D,K.angularVelocity=L,K.damping=H,K.angularVelocity=L,K.gc=!1}O+=x},update(){if(n!==void 0&&n<=0)return;let x=ee();for(let w of r)if(!w.gc){if(w.t+=x,w.lt&&w.t>=w.lt){w.gc=!0,O--;continue}w.vel=w.vel.add(w.acc.scale(x)).scale(1-w.damping*x),w.pos=w.pos.add(w.vel.scale(x)),w.angle+=w.angularVelocity*x}for(n!==void 0&&(n-=x,n<=0&&R.trigger()),A+=x;O<t.max&&e.rate&&A>e.rate;)this.emit(1),O++,A-=e.rate},draw(){if(!(n!==void 0&&n<=0)){for(let x=0;x<r.length;x++){let w=r[x];if(w.gc)continue;let S=w.progress,G=Math.floor(w.progress*o.length),M=G<o.length-1?de(o[G],o[G+1],Se(S,G/o.length,(G+1)/o.length,0,1)):o[G],D=Math.floor(w.progress*s.length),L=D<s.length-1?de(s[D],s[D+1],Se(S,D/s.length,(D+1)/s.length,0,1)):s[D],U=Math.floor(w.progress*i.length),H=i[U],Y=Math.floor(w.progress*m.length),_=m[Y],K=Math.cos(w.angle*Math.PI/180),J=Math.sin(w.angle*Math.PI/180),$=(t.texture?t.texture.width:10)*H.w/2,Z=(t.texture?t.texture.height:10)*H.h/2,Ee=x*4,k=y[Ee];k.pos.x=w.pos.x+-$*_*K- -Z*_*J,k.pos.y=w.pos.y+-$*_*J+-Z*_*K,k.uv.x=H.x,k.uv.y=H.y,k.color.r=M.r,k.color.g=M.g,k.color.b=M.b,k.opacity=L,k=y[Ee+1],k.pos.x=w.pos.x+$*_*K- -Z*_*J,k.pos.y=w.pos.y+$*_*J+-Z*_*K,k.uv.x=H.x+H.w,k.uv.y=H.y,k.color.r=M.r,k.color.g=M.g,k.color.b=M.b,k.opacity=L,k=y[Ee+2],k.pos.x=w.pos.x+$*_*K-Z*_*J,k.pos.y=w.pos.y+$*_*J+Z*_*K,k.uv.x=H.x+H.w,k.uv.y=H.y+H.h,k.color.r=M.r,k.color.g=M.g,k.color.b=M.b,k.opacity=L,k=y[Ee+3],k.pos.x=w.pos.x+-$*_*K-Z*_*J,k.pos.y=w.pos.y+-$*_*J+Z*_*K,k.uv.x=H.x,k.uv.y=H.y+H.h,k.color.r=M.r,k.color.g=M.g,k.color.b=M.b,k.opacity=L}Le(y,g,this.fixed,t.texture,this.shader,this.uniform)}},onEnd(x){return R.add(x)},inspect(){return`count: ${O}/${t.max}`}}}function Ai(t,e={}){if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:\"polygon\",pts:t,colors:e.colors,uv:e.uv,tex:e.tex,radius:e.radius,draw(){Pe(Object.assign(je(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:e.fill,triangulate:e.triangulate}))},renderArea(){return new be(this.pts)},inspect(){return`polygon: ${this.pts.map(n=>`[${n.x},${n.y}]`).join(\",\")}`}}}function er(t,e,n){let r;return a.game.root.get(\"area\").forEach(s=>{if(n&&n.some(u=>s.is(u)))return;let m=s.worldArea().raycast(t,e);m&&(r?m.fraction<r.fraction&&(r=m,r.object=s):(r=m,r.object=s))}),r}function tr(t,e,n={}){return{id:\"rect\",width:t,height:e,radius:n.radius||0,draw(){xe(Object.assign(je(this),{width:this.width,height:this.height,radius:this.radius,fill:n.fill}))},renderArea(){return new W(v(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}function Si(t,e){return{id:\"shader\",shader:t,...typeof e==\"function\"?{uniform:e(),update(){this.uniform=e()}}:{uniform:e},inspect(){return`shader: ${t}`}}}function Vi(t,e){if(!e.tileWidth||!e.tileHeight)throw new Error(\"Must provide tileWidth and tileHeight.\");let n=a.game.root.add([Pt(e.pos??v(0))]),r=t.length,o=0,s=null,i=null,m=null,u=null,c=x=>x.x+x.y*o,p=x=>v(Math.floor(x%o),Math.floor(x/o)),b=()=>{s=[];for(let x of n.children)l(x)},l=x=>{let w=c(x.tilePos);s[w]?s[w].push(x):s[w]=[x]},h=x=>{let w=c(x.tilePos);if(s[w]){let S=s[w].indexOf(x);S>=0&&s[w].splice(S,1)}},d=()=>{let x=!1;for(let w of n.children){let S=n.pos2Tile(w.pos);(w.tilePos.x!=S.x||w.tilePos.y!=S.y)&&(x=!0,h(w),w.tilePos.x=S.x,w.tilePos.y=S.y,l(w))}x&&n.trigger(\"spatialMapChanged\")},C=()=>{let x=n.getSpatialMap(),w=n.numRows()*n.numColumns();i?i.length=w:i=new Array(w),i.fill(1,0,w);for(let S=0;S<x.length;S++){let G=x[S];if(G){let M=0;for(let D of G)if(D.isObstacle){M=1/0;break}else M+=D.cost;i[S]=M||1}}},g=()=>{let x=n.getSpatialMap(),w=n.numRows()*n.numColumns();m?m.length=w:m=new Array(w),m.fill(15,0,w);for(let S=0;S<x.length;S++){let G=x[S];if(G){let M=G.length,D=15;for(let L=0;L<M;L++)D|=G[L].edgeMask;m[S]=D}}},y=()=>{let x=n.numRows()*n.numColumns(),w=(G,M)=>{let D=[];for(D.push(G);D.length>0;){let L=D.pop();R(L).forEach(U=>{u[U]<0&&(u[U]=M,D.push(U))})}};u?u.length=x:u=new Array(x),u.fill(-1,0,x);let S=0;for(let G=0;G<i.length;G++){if(u[G]>=0){S++;continue}w(G,S),S++}},O=(x,w)=>i[w],A=(x,w)=>{let S=p(x),G=p(w);return S.dist(G)},R=(x,w)=>{let S=[],G=Math.floor(x%o),M=G>0&&m[x]&1&&i[x-1]!==1/0,D=x>=o&&m[x]&2&&i[x-o]!==1/0,L=G<o-1&&m[x]&4&&i[x+1]!==1/0,U=x<o*r-o-1&&m[x]&8&&i[x+o]!==1/0;return w?(M&&(D&&S.push(x-o-1),S.push(x-1),U&&S.push(x+o-1)),D&&S.push(x-o),L&&(D&&S.push(x-o+1),S.push(x+1),U&&S.push(x+o+1)),U&&S.push(x+o)):(M&&S.push(x-1),D&&S.push(x-o),L&&S.push(x+1),U&&S.push(x+o)),S},V={id:\"level\",tileWidth(){return e.tileWidth},tileHeight(){return e.tileHeight},spawn(x,...w){let S=v(...w),G=(()=>{if(typeof x==\"string\"){if(e.tiles[x]){if(typeof e.tiles[x]!=\"function\")throw new Error(\"Level symbol def must be a function returning a component list\");return e.tiles[x](S)}else if(e.wildcardTile)return e.wildcardTile(x,S)}else{if(Array.isArray(x))return x;throw new Error(\"Expected a symbol or a component list\")}})();if(!G)return null;let M=!1,D=!1;for(let U of G)U.id===\"tile\"&&(D=!0),U.id===\"pos\"&&(M=!0);M||G.push(Pt(this.tile2Pos(S))),D||G.push(nr());let L=n.add(G);return M&&(L.tilePosOffset=L.pos.clone()),L.tilePos=S,L.transform=dt(L),s&&(l(L),this.trigger(\"spatialMapChanged\"),this.trigger(\"navigationMapInvalid\")),L},numColumns(){return o},numRows(){return r},levelWidth(){return o*this.tileWidth()},levelHeight(){return r*this.tileHeight()},tile2Pos(...x){return v(...x).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...x){let w=v(...x);return v(Math.floor(w.x/this.tileWidth()),Math.floor(w.y/this.tileHeight()))},getSpatialMap(){return s||b(),s},removeFromSpatialMap:h,insertIntoSpatialMap:l,onSpatialMapChanged(x){return this.on(\"spatialMapChanged\",x)},onNavigationMapInvalid(x){return this.on(\"navigationMapInvalid\",x)},getAt(x){s||b();let w=c(x);return s[w]||[]},raycast(x,w){let S=this.toWorld(x),G=this.toWorld(x.add(w)).sub(S),M=1/this.tileWidth(),D=x.scale(M),L=_o(D,w,U=>{let H=this.getAt(U);if(H.some(_=>_.isObstacle))return!0;let Y=null;for(let _ of H)if(_.has(\"area\")){let J=_.worldArea().raycast(S,G);J&&(Y?J.fraction<Y.fraction&&(Y=J,Y.object=_):(Y=J,Y.object=_))}return Y&&(Y.point=this.fromWorld(Y.point).scale(M)),Y||!1},64);return L&&(L.point=L.point.scale(this.tileWidth())),L},update(){s&&d()},invalidateNavigationMap(){i=null,m=null,u=null},onNavigationMapChanged(x){return this.on(\"navigationMapChanged\",x)},getTilePath(x,w,S={}){if(i||C(),m||g(),u||y(),x.x<0||x.x>=o||x.y<0||x.y>=r||w.x<0||w.x>=o||w.y<0||w.y>=r)return null;let G=c(x),M=c(w);if(i[M]===1/0)return null;if(G===M)return[];if(u[G]!=-1&&u[G]!==u[M])return null;let D=new It((K,J)=>K.cost<J.cost);D.insert({cost:0,node:G});let L=new Map;L.set(G,G);let U=new Map;for(U.set(G,0);D.length!==0;){let K=D.remove()?.node;if(K===M)break;let J=R(K,S.allowDiagonals);for(let $ of J){let Z=(U.get(K)||0)+O(K,$)+A($,M);(!U.has($)||Z<U.get($))&&(U.set($,Z),D.insert({cost:Z,node:$}),L.set($,K))}}let H=[],Y=M,_=p(Y);for(H.push(_);Y!==G;){let K=L.get(Y);if(K===void 0)throw new Error(\"Bug in pathfinding algorithm\");Y=K;let J=p(Y);H.push(J)}return H.reverse()},getPath(x,w,S={}){let G=this.tileWidth(),M=this.tileHeight(),D=this.getTilePath(this.pos2Tile(x),this.pos2Tile(w),S);return D?[x,...D.slice(1,-1).map(L=>L.scale(G,M).add(G/2,M/2)),w]:null}};return n.use(V),n.onNavigationMapInvalid(()=>{n.invalidateNavigationMap(),n.trigger(\"navigationMapChanged\")}),t.forEach((x,w)=>{let S=x.split(\"\");o=Math.max(S.length,o),S.forEach((G,M)=>{n.spawn(G,v(M,w))})}),n}function Ge(t,e,n){return a.game.objEvents.registers[t]||(a.game.objEvents.registers[t]=new rn),a.game.objEvents.on(t,(r,...o)=>{r.is(e)&&n(r,...o)})}var Pi=(t,e,...n)=>{for(let r of a.game.root.children)r.is(e)&&r.trigger(t,n)},Gi=ne(t=>{let e=a.game.root.add([{fixedUpdate:t}]);return{get paused(){return e.paused},set paused(n){e.paused=n},cancel:()=>e.destroy()}},(t,e)=>Ge(\"fixedUpdate\",t,e)),rr=ne(t=>{let e=a.game.root.add([{update:t}]);return{get paused(){return e.paused},set paused(n){e.paused=n},cancel:()=>e.destroy()}},(t,e)=>Ge(\"update\",t,e)),Mi=ne(t=>{let e=a.game.root.add([{draw:t}]);return{get paused(){return e.hidden},set paused(n){e.hidden=n},cancel:()=>e.destroy()}},(t,e)=>Ge(\"draw\",t,e)),to=ne(t=>a.game.events.on(\"add\",t),(t,e)=>Ge(\"add\",t,e)),Ri=ne(t=>a.game.events.on(\"destroy\",t),(t,e)=>Ge(\"destroy\",t,e)),Di=ne(t=>a.game.events.on(\"use\",t),(t,e)=>Ge(\"use\",t,e)),Bi=ne(t=>a.game.events.on(\"unuse\",t),(t,e)=>Ge(\"unuse\",t,e)),no=ne(t=>a.game.events.on(\"tag\",t),(t,e)=>Ge(\"tag\",t,e)),Fi=ne(t=>a.game.events.on(\"untag\",t),(t,e)=>Ge(\"untag\",t,e));function Li(t,e,n){return Ge(\"collide\",t,(r,o,s)=>o.is(e)&&n(r,o,s))}function ji(t,e,n){return Ge(\"collideUpdate\",t,(r,o,s)=>o.is(e)&&n(r,o,s))}function Ii(t,e,n){return Ge(\"collideEnd\",t,(r,o,s)=>o.is(e)&&n(r,o,s))}function or(t,e){a.game.root.get(t,{recursive:!0}).forEach(e),to(t,e),no((n,r)=>{r===t&&e(n)})}var Ki=ne(t=>a.app.onMousePress(t),(t,e)=>{let n=[];return or(t,r=>{if(!r.area)throw new Error(\"onClick() requires the object to have area() component\");n.push(r.onClick(()=>e(r)))}),ke.join(n)});function ki(t,e){let n=[];return or(t,r=>{if(!r.area)throw new Error(\"onHover() requires the object to have area() component\");n.push(r.onHover(()=>e(r)))}),ke.join(n)}function _i(t,e){let n=[];return or(t,r=>{if(!r.area)throw new Error(\"onHoverUpdate() requires the object to have area() component\");n.push(r.onHoverUpdate(()=>e(r)))}),ke.join(n)}function Ni(t,e){let n=[];return or(t,r=>{if(!r.area)throw new Error(\"onHoverEnd() requires the object to have area() component\");n.push(r.onHoverEnd(()=>e(r)))}),ke.join(n)}function Ui(t){a.game.events.on(\"loading\",t)}function Hi(t){a.app.onResize(t)}function qi(t){a.game.events.on(\"error\",t)}function Nt(t){a.assets.loaded?t():a.game.events.on(\"load\",t)}function zi(t){if(a.assets.loaded)Un().forEach(e=>t(...e));else return a.game.events.on(\"loadError\",t)}function ro(...t){a.game.cam.pos=v(...t)}function oo(){return a.game.cam.pos?a.game.cam.pos.clone():Ct()}function so(...t){a.game.cam.scale=v(...t)}function io(){return a.game.cam.scale.clone()}function ao(t){a.game.cam.angle=t}function uo(){return a.game.cam.angle}function Wi(){return a.game.cam.transform.clone()}function co(t=I(255,255,255),e=1){let n=a.game.root.add([tr(ie(),ue()),Jn(t),Zn(1),ar()]),r=n.fadeOut(e);return r.onEnd(()=>ir(n)),r}function Yi(){return a.game.cam.transform.clone()}function $i(t=12){a.game.cam.shake+=t}function pn(t){return a.game.cam.transform.multVec2(t)}function sr(t){return a.game.cam.transform.invert().multVec2(t)}function Xi(...t){return tt(\"camPos\",\"setCamPos / getCamPos\"),t.length>0&&ro(...t),oo()}function Qi(...t){return tt(\"camScale\",\"setCamScale / getCamScale\"),t.length>0&&so(...t),io()}function Ji(t){return tt(\"camRot\",\"setCamRot / getCamRot\"),t!==void 0&&ao(t),uo()}function Zi(t=I(255,255,255),e=1){return tt(\"camFlash\",\"flash\"),co(t,e)}function dn(t=[]){let e=new Map,n=[],r={},o=new ze,s=[],i=new Set(\"*\"),m=a.globalOpt.tagsAsComponents,u=null,c=!1,p={id:Os(),hidden:!1,transform:new fe,children:[],parent:null,set paused(l){if(l!==c){c=l;for(let h of s)h.paused=l}},get paused(){return c},get tags(){return Array.from(i)},add(l){let h=Array.isArray(l)?dn(l):l;if(h.parent)throw new Error(\"Cannot add a game obj that already has a parent.\");return h.parent=this,h.transform=dt(h),this.children.push(h),h.trigger(\"add\",h),a.game.events.trigger(\"add\",h),h},readd(l){let h=this.children.indexOf(l);return h!==-1&&(this.children.splice(h,1),this.children.push(l)),l},remove(l){let h=this.children.indexOf(l);if(h!==-1){l.parent=null,this.children.splice(h,1);let d=C=>{C.trigger(\"destroy\"),a.game.events.trigger(\"destroy\",C),C.children.forEach(g=>d(g))};d(l)}},removeAll(l){if(l)this.get(l).forEach(h=>this.remove(h));else for(let h of[...this.children])this.remove(h)},fixedUpdate(){this.paused||(this.children.forEach(l=>l.fixedUpdate()),this.trigger(\"fixedUpdate\"))},update(){this.paused||(this.children.forEach(l=>l.update()),this.trigger(\"update\"))},draw(){if(this.hidden)return;this.canvas&&(Ce(),this.canvas.bind());let l=a.gfx.fixed;this.fixed&&(a.gfx.fixed=!0),ge(),X(this.pos),rt(this.scale),Ye(this.angle);let h=this.children.sort((d,C)=>{let g=d.layerIndex??a.game.defaultLayerIndex,y=C.layerIndex??a.game.defaultLayerIndex;return g-y||(d.z??0)-(C.z??0)});if(this.mask){let d={intersect:a.k.drawMasked,subtract:a.k.drawSubtracted}[this.mask];if(!d)throw new Error(`Invalid mask func: \"${this.mask}\"`);d(()=>{h.forEach(C=>C.draw())},()=>{this.trigger(\"draw\")})}else this.trigger(\"draw\"),h.forEach(d=>d.draw());me(),a.gfx.fixed=l,this.canvas&&(Ce(),this.canvas.unbind())},drawInspect(){this.hidden||(ge(),X(this.pos),rt(this.scale),Ye(this.angle),this.children.forEach(l=>l.drawInspect()),this.trigger(\"drawInspect\"),me())},use(l){if(typeof l==\"string\")return i.add(l);if(!l||typeof l!=\"object\")throw new Error(`You can only pass a component or a string to .use(), you passed a \"${typeof l}\"`);let h=[];l.id?(this.unuse(l.id),r[l.id]=[],h=r[l.id],e.set(l.id,l),m&&i.add(l.id)):n.push(l);for(let C in l){if(ms.has(C))continue;let g=Object.getOwnPropertyDescriptor(l,C);if(g)if(typeof g.value==\"function\"&&(l[C]=l[C].bind(this)),g.set&&Object.defineProperty(l,C,{set:g.set.bind(this)}),g.get&&Object.defineProperty(l,C,{get:g.get.bind(this)}),ps.has(C)){let y=C===\"add\"?()=>{u=O=>h.push(O),l[C]?.(),u=null}:l[C];h.push(this.on(C,y).cancel)}else if(this[C]===void 0)Object.defineProperty(this,C,{get:()=>l[C],set:y=>l[C]=y,configurable:!0,enumerable:!0}),h.push(()=>delete this[C]);else{let y=e.values().find(O=>O[C]!==void 0)?.id;throw new Error(`Duplicate component property: \"${C}\" while adding component \"${l.id}\"`+(y?` (originally added by \"${y}\")`:\"\"))}}let d=()=>{if(l.require){for(let C of l.require)if(!this.c(C))throw new Error(`Component \"${l.id}\" requires component \"${C}\"`)}};l.destroy&&h.push(l.destroy.bind(this)),this.exists()?(d(),l.add&&(u=C=>h.push(C),l.add.call(this),u=null),l.id&&(this.trigger(\"use\",l.id),a.game.events.trigger(\"use\",this,l.id))):l.require&&h.push(this.on(\"add\",d).cancel)},unuse(l){if(e.has(l)){for(let h of e.values())if(h.require&&h.require.includes(l))throw new Error(`Can't unuse. Component \"${h.id}\" requires component \"${l}\"`);e.delete(l),this.trigger(\"unuse\",l),a.game.events.trigger(\"unuse\",this,l)}else m&&i.has(l)&&i.delete(l);r[l]&&(r[l].forEach(h=>h()),delete r[l])},c(l){return e.get(l)??null},get(l,h={}){let d=(g,y)=>h.only===\"comps\"?g.has(y):h.only===\"tags\"?g.is(y):g.is(y)||g.has(y),C=h.recursive?this.children.flatMap(function g(y){return[y,...y.children.flatMap(g)]}):this.children;if(C=C.filter(g=>l?d(g,l):!0),h.liveUpdate){let g=O=>h.recursive?this.isAncestorOf(O):O.parent===this,y=[];y.push(a.k.onAdd(O=>{g(O)&&d(O,l)&&C.push(O)})),y.push(a.k.onDestroy(O=>{if(g(O)&&d(O,l)){let A=C.findIndex(R=>R.id===O.id);A!==-1&&C.splice(A,1)}})),this.onDestroy(()=>{for(let O of y)O.cancel()})}return C},query(l){let h=l.hierarchy||\"children\",d=l.include,C=l.exclude,g=[];switch(h){case\"children\":g=this.children;break;case\"siblings\":g=this.parent?this.parent.children.filter(O=>O!==this):[];break;case\"ancestors\":let y=this.parent;for(;y;)g.push(y),y=y.parent;break;case\"descendants\":g=this.children.flatMap(function O(A){return[A,...A.children.flatMap(O)]});break}if(d&&((l.includeOp||\"and\")===\"and\"||!Array.isArray(l.include)?g=g.filter(O=>O.is(d)):g=g.filter(O=>l.include.some(A=>O.is(A)))),C&&((l.includeOp||\"and\")===\"and\"||!Array.isArray(l.include)?g=g.filter(O=>!O.is(C)):g=g.filter(O=>!l.exclude.some(A=>O.is(A)))),l.visible===!0&&(g=g.filter(y=>y.visible)),l.distance){if(!this.pos)throw Error(\"Can't do a distance query from an object without pos\");let y=l.distanceOp||\"near\",O=l.distance*l.distance;y===\"near\"?g=g.filter(A=>A.pos&&this.pos.sdist(A.pos)<=O):g=g.filter(A=>A.pos&&this.pos.sdist(A.pos)>O)}return l.name&&(g=g.filter(y=>y.name===l.name)),g},isAncestorOf(l){return l.parent?l.parent===this||this.isAncestorOf(l.parent):!1},exists(){return a.game.root.isAncestorOf(this)},is(l,h=\"and\"){return Array.isArray(l)?h===\"and\"?l.every(d=>i.has(d)):l.some(d=>i.has(d)):i.has(l)},tag(l){if(Array.isArray(l))for(let h of l)i.add(h),this.trigger(\"tag\",h),a.game.events.trigger(\"tag\",this,h);else i.add(l),this.trigger(\"tag\",l),a.game.events.trigger(\"tag\",this,l)},untag(l){if(Array.isArray(l))for(let h of l)i.delete(h),this.trigger(\"untag\",h),a.game.events.trigger(\"untag\",this,h);else i.delete(l),this.trigger(\"untag\",l),a.game.events.trigger(\"untag\",this,l)},has(l,h=\"and\"){return Array.isArray(l)?h===\"and\"?l.every(d=>e.has(d)):l.some(d=>e.has(d)):e.has(l)},on(l,h){let d=o.on(l,h.bind(this));return u&&u(()=>d.cancel()),d},trigger(l,...h){o.trigger(l,...h),a.game.objEvents.trigger(l,this,...h)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let l={};for(let[h,d]of e)l[h]=d.inspect?.()??null;for(let[h,d]of n.entries()){if(d.inspect){l[h]=d.inspect();continue}for(let[C,g]of Object.entries(d))typeof g!=\"function\"&&(l[C]=`${C}: ${g}`)}return l},onAdd(l){return this.on(\"add\",l)},onFixedUpdate(l){return this.on(\"fixedUpdate\",l)},onUpdate(l){return this.on(\"update\",l)},onDraw(l){return this.on(\"draw\",l)},onDestroy(l){return this.on(\"destroy\",l)},onUse(l){return this.on(\"use\",l)},onUnuse(l){return this.on(\"unuse\",l)},clearEvents(){o.clear()}},b=[\"onKeyPress\",\"onKeyPressRepeat\",\"onKeyDown\",\"onKeyRelease\",\"onMousePress\",\"onMouseDown\",\"onMouseRelease\",\"onMouseMove\",\"onCharInput\",\"onMouseMove\",\"onTouchStart\",\"onTouchMove\",\"onTouchEnd\",\"onScroll\",\"onGamepadButtonPress\",\"onGamepadButtonDown\",\"onGamepadButtonRelease\",\"onGamepadStick\",\"onButtonPress\",\"onButtonDown\",\"onButtonRelease\"];for(let l of b)p[l]=(...h)=>{let d=a.app[l]?.(...h);return s.push(d),p.onDestroy(()=>d.cancel()),p.on(\"sceneEnter\",()=>{s.splice(s.indexOf(d),1);let C=a.app[l]?.(...h);ke.replace(d,C),s.push(d)}),d};for(let l of t)p.use(l);return p}var ea=()=>({events:new ze,objEvents:new ze,root:dn([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new E(1),angle:0,shake:0,transform:new fe}});function ta(t){a.game.gravity=t?(a.game.gravity||v(0,1)).unit().scale(t):null}function na(){return a.game.gravity?a.game.gravity.len():0}function ra(t){a.game.gravity=t.unit().scale(a.game.gravity?a.game.gravity.len():1)}function ht(){return a.game.gravity?a.game.gravity.unit():v(0,1)}var oa=Oo(\"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\");var sa=()=>(()=>{let e=new(window.AudioContext||window.webkitAudioContext),n=e.createGain();n.connect(e.destination);let r=new ot(Ds(e));return e.decodeAudioData(oa.buffer.slice(0)).then(o=>{r.buf=o}).catch(o=>{console.error(\"Failed to load burp: \",o)}),{ctx:e,masterNode:n,burpSnd:r}})();function ia(t,e={}){let n=new re,r=new Audio(t);r.crossOrigin=\"anonymous\",r.loop=!!e.loop,a.audio.ctx.createMediaElementSource(r).connect(a.audio.masterNode);function s(){a.debug.paused||a.app.isHidden()&&!a.globalOpt.backgroundAudio||a.audio.ctx.resume()}function i(){s(),r.play()}return e.paused||i(),r.onended=()=>n.trigger(),{play(){i()},seek(m){r.currentTime=m},stop(){r.pause(),this.seek(0)},set loop(m){r.loop=m},get loop(){return r.loop},set paused(m){m?r.pause():i()},get paused(){return r.paused},time(){return r.currentTime},duration(){return r.duration},set volume(m){r.volume=Te(m,0,1)},get volume(){return r.volume},set speed(m){r.playbackRate=Math.max(m,0)},get speed(){return r.playbackRate},set detune(m){},get detune(){return 0},onEnd(m){return n.add(m)},then(m){return this.onEnd(m)}}}function aa(t,e={}){if(typeof t==\"string\"&&a.assets.music[t])return ia(a.assets.music[t],e);let n=a.audio.ctx,r=e.paused??!1,o=n.createBufferSource(),s=new re,i=n.createGain(),m=n.createStereoPanner(),u=e.seek??0,c=0,p=0,b=!1;o.loop=!!e.loop,o.detune.value=e.detune??0,o.playbackRate.value=e.speed??1,o.connect(m),o.onended=()=>{d()>=(o.buffer?.duration??Number.POSITIVE_INFINITY)&&s.trigger()},m.pan.value=e.pan??0,m.connect(i),i.connect(a.audio.masterNode),i.gain.value=e.volume??1;let l=g=>{o.buffer=g.buf,r||(c=n.currentTime,o.start(0,u),b=!0)},h=oi(t);h instanceof ce&&h.onLoad(l);let d=()=>{if(!o.buffer)return 0;let g=r?p-c:n.currentTime-c,y=o.buffer.duration;return o.loop?g%y:Math.min(g,y)},C=g=>{let y=n.createBufferSource();return y.buffer=g.buffer,y.loop=g.loop,y.playbackRate.value=g.playbackRate.value,y.detune.value=g.detune.value,y.onended=g.onended,y.connect(m),y};return{stop(){this.paused=!0,this.seek(0)},set paused(g){if(r!==g)if(r=g,g)b&&(o.stop(),b=!1),p=n.currentTime;else{o=C(o);let y=p-c;o.start(0,y),b=!0,c=n.currentTime-y,p=0}},get paused(){return r},play(g=0){this.seek(g),this.paused=!1},seek(g){o.buffer?.duration&&(g>o.buffer.duration||(r?(o=C(o),c=p-g):(o.stop(),o=C(o),c=n.currentTime-g,o.start(0,g),b=!0,p=0)))},set speed(g){o.playbackRate.value=g},get speed(){return o.playbackRate.value},set detune(g){o.detune.value=g},get detune(){return o.detune.value},set volume(g){i.gain.value=Math.max(g,0)},get volume(){return i.gain.value},set pan(g){m.pan.value=g},get pan(){return m.pan.value},set loop(g){o.loop=g},get loop(){return o.loop},duration(){return o.buffer?.duration??0},time(){return d()%this.duration()},onEnd(g){return s.add(g)},then(g){return this.onEnd(g)}}}function ur(t){return a.k.play(a.audio.burpSnd,t)}function lo(t){a.audio.masterNode.gain.value=t}function mo(){return a.audio.masterNode.gain.value}function ua(t){return tt(\"volume\",\"setVolume / getVolume\"),t!==void 0&&lo(t),mo()}function cr(){a.app.onHide(()=>{a.globalOpt.backgroundAudio||a.audio.ctx.suspend()}),a.app.onShow(()=>{!a.globalOpt.backgroundAudio&&!a.debug.paused&&a.audio.ctx.resume()}),a.app.onResize(()=>{if(a.app.isFullscreen())return;let t=a.globalOpt.width&&a.globalOpt.height;t&&!a.globalOpt.stretch&&!a.globalOpt.letterbox||(a.canvas.width=a.canvas.offsetWidth*a.pixelDensity,a.canvas.height=a.canvas.offsetHeight*a.pixelDensity,jn(),t||(a.gfx.frameBuffer.free(),a.gfx.frameBuffer=new st(a.gfx.ggl,a.gfx.ggl.gl.drawingBufferWidth,a.gfx.ggl.gl.drawingBufferHeight),a.gfx.width=a.gfx.ggl.gl.drawingBufferWidth/a.pixelDensity/a.gscale,a.gfx.height=a.gfx.ggl.gl.drawingBufferHeight/a.pixelDensity/a.gscale))}),a.globalOpt.debug!==!1&&(a.app.onKeyPress(a.globalOpt.debugKey??\"f1\",()=>a.debug.inspect=!a.debug.inspect),a.app.onKeyPress(\"f2\",()=>a.debug.clearLog()),a.app.onKeyPress(\"f8\",()=>a.debug.paused=!a.debug.paused),a.app.onKeyPress(\"f7\",()=>{a.debug.timeScale=on(Te(a.debug.timeScale-.2,0,2),1)}),a.app.onKeyPress(\"f9\",()=>{a.debug.timeScale=on(Te(a.debug.timeScale+.2,0,2),1)}),a.app.onKeyPress(\"f10\",()=>a.debug.stepFrame())),a.globalOpt.burp&&a.app.onKeyPress(\"b\",()=>ur())}function ca(t,e={}){let n=a.game.root.add([Pt(t),lr()]),r=(e.speed||1)*5,o=e.scale||1;n.add([fn(a.boomSprite),Ut(0),hn(\"center\"),po(r,o),...e.comps??[]]);let s=n.add([fn(a.kaSprite),Ut(0),hn(\"center\"),gn(),...e.comps??[]]);return s.wait(.4/r,()=>s.use(po(r,o))),s.onDestroy(()=>n.destroy()),n}function fo(t,e){if(a.game.layers)throw Error(\"Layers can only be assigned once.\");let n=t.indexOf(e);if(n==-1)throw Error(\"The default layer name should be present in the layers list.\");a.game.layers=t,a.game.defaultLayerIndex=n}function la(){return a.game.layers}function ma(){return a.game.layers?.[a.game.defaultLayerIndex]??null}function pa(t,e){tt(\"layers\",\"setLayers\"),fo(t,e)}function ir(t){t.destroy()}function da(){return a.game.root}function fa(t,e){a.game.scenes[t]=e}function ha(t,...e){if(!a.game.scenes[t])throw new Error(`Scene not found: ${t}`);a.game.events.onOnce(\"frameEnd\",()=>{a.game.events.trigger(\"sceneLeave\",t),a.app.events.clear(),a.game.events.clear(),a.game.objEvents.clear(),[...a.game.root.children].forEach(n=>{!n.stay||n.scenesToStay&&!n.scenesToStay.includes(t)?a.game.root.remove(n):n.trigger(\"sceneEnter\",t)}),a.game.root.clearEvents(),cr(),a.game.cam={pos:null,scale:v(1),angle:0,shake:0,transform:new fe},a.game.scenes[t](...e)}),a.game.currentScene=t}function ga(t){return a.game.events.on(\"sceneLeave\",t)}function ba(){return a.game.currentScene}function fn(t,e={}){let n=null,r=null,o=null,s=new re;if(!t)throw new Error(\"Please pass the resource name or data to sprite()\");let i=(c,p,b,l)=>{let h=v(1,1);return b&&l?(h.x=b/(c.width*p.w),h.y=l/(c.height*p.h)):b?(h.x=b/(c.width*p.w),h.y=h.x):l&&(h.y=l/(c.height*p.h),h.x=h.y),h},m=(c,p)=>{if(!p)return;let b=p.frames[0].clone();e.quad&&(b=b.scale(e.quad));let l=i(p.tex,b,e.width,e.height);if(c.width=p.tex.width*b.w*l.x,c.height=p.tex.height*b.h*l.y,p.anims)for(let h in p.anims){let d=p.anims[h];typeof d!=\"number\"&&(d.frames=u(d))}n=p,s.trigger(n),e.anim&&c.play(e.anim)},u=c=>{if(c.frames)return c.frames;let p=[];if(c.from===void 0||c.to===void 0)throw new Error(\"Sprite anim 'from' and 'to' must be defined if 'frames' is not defined\");let b=Math.abs(c.to-c.from)+1;for(let l=0;l<b;l++)p.push(c.from+l*Math.sign(c.to-c.from));if(c.pingpong)for(let l=b-2;l>0;l--)p.push(p[l]);return p};return{id:\"sprite\",width:0,height:0,frame:e.frame||0,quad:e.quad||new q(0,0,1,1),animSpeed:e.animSpeed??1,flipX:e.flipX??!1,flipY:e.flipY??!1,get sprite(){return t.toString()},set sprite(c){let p=Kt(c);p&&p.onLoad(b=>m(this,b))},get animFrame(){if(!n||!r||o===null)return this.frame;let c=n.anims[r.name];return typeof c==\"number\"?c:c.from===void 0||c.to===void 0?r.frameIndex:this.frame-Math.min(c.from,c.to)},draw(){if(!n)return;let c=n.frames[this.frame??0];if(!c)throw new Error(`Frame not found: ${this.frame??0}`);if(n.slice9){let{left:p,right:b,top:l,bottom:h}=n.slice9,d=n.tex.width*c.w,C=n.tex.height*c.h,g=this.width-p-b,y=this.height-l-h,O=p/d,A=b/d,R=1-O-A,V=l/C,x=h/C,w=1-V-x,S=[le(0,0,O,V),le(O,0,R,V),le(O+R,0,A,V),le(0,V,O,w),le(O,V,R,w),le(O+R,V,A,w),le(0,V+w,O,x),le(O,V+w,R,x),le(O+R,V+w,A,x),le(0,0,p,l),le(p,0,g,l),le(p+g,0,b,l),le(0,l,p,y),le(p,l,g,y),le(p+g,l,b,y),le(0,l+y,p,h),le(p,l+y,g,h),le(p+g,l+y,b,h)];for(let G=0;G<9;G++){let M=S[G],D=S[G+9];Vt(Object.assign(je(this),{pos:D.pos(),tex:n.tex,quad:c.scale(M),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:D.w,height:D.h}))}}else Vt(Object.assign(je(this),{tex:n.tex,quad:c.scale(this.quad??new q(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:this.width,height:this.height}))},add(){let c=Kt(t);c?c.onLoad(p=>m(this,p)):Nt(()=>m(this,Kt(t).data))},update(){if(!n||!r||o===null)return;let c=n.anims[r.name];if(typeof c==\"number\"){this.frame=c;return}if(c.speed===0)throw new Error(\"Sprite anim speed cannot be 0\");if(r.timer+=ee()*this.animSpeed,r.timer>=1/r.speed){r.timer=0,r.frameIndex+=o;let p=c.frames;if(r.frameIndex>=p.length)if(r.pingpong&&!c.pingpong)o=-1,r.frameIndex=p.length-2;else if(r.loop)r.frameIndex=0;else{this.frame=p.at(-1),r.onEnd(),this.stop();return}else if(r.frameIndex<0)if(r.pingpong&&r.loop)o=1,r.frameIndex=1;else if(r.loop)r.frameIndex=p.length-1;else{this.frame=p[0],r.onEnd(),this.stop();return}this.frame=p[r.frameIndex]}},play(c,p={}){if(!n){s.add(()=>this.play(c,p));return}let b=n.anims[c];if(b===void 0)throw new Error(`Anim not found: ${c}`);r&&this.stop(),r=typeof b==\"number\"?{name:c,timer:0,loop:!1,pingpong:!1,speed:0,frameIndex:0,onEnd:()=>{}}:{name:c,timer:0,loop:p.loop??b.loop??!1,pingpong:p.pingpong??b.pingpong??!1,speed:p.speed??b.speed??10,frameIndex:0,onEnd:p.onEnd??(()=>{})},o=typeof b==\"number\"?null:1,this.frame=typeof b==\"number\"?b:b.frames[0],this.trigger(\"animStart\",c)},stop(){if(!r)return;let c=r.name;r=null,this.trigger(\"animEnd\",c)},numFrames(){return n?.frames.length??0},getCurAnim(){return r},curAnim(){return r?.name},getAnim(c){return n?.anims[c]??null},hasAnim(c){return!!this.getAnim(c)},onAnimEnd(c){return this.on(\"animEnd\",c)},onAnimStart(c){return this.on(\"animStart\",c)},renderArea(){return new W(v(0),this.width,this.height)},inspect(){return typeof t==\"string\"?`sprite: \"${t}\"`:null}}}function ya(t,e={}){function n(o){let s=Ue(Object.assign(je(o),{text:o.text+\"\",size:o.textSize,font:o.font,width:e.width&&o.width,align:o.align,letterSpacing:o.letterSpacing,lineSpacing:o.lineSpacing,transform:o.textTransform,styles:o.textStyles,indentAll:e.indentAll}));return e.width||(o.width=s.width/(o.scale?.x||1)),o.height=s.height/(o.scale?.y||1),s}let r={id:\"text\",set text(o){t=o,n(this),this.renderedText=$n(t).text},get text(){return t},textSize:e.size??36,font:e.font,width:e.width??0,height:0,align:e.align,lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing,textTransform:e.transform,textStyles:e.styles,renderedText:t?$n(t).text:\"\",add(){Nt(()=>n(this))},draw(){He(n(this))},renderArea(){return new W(v(0),this.width,this.height)}};return n(r),r}function xa(t,e){return{id:\"rect\",width:t,height:e,draw(){it(Object.assign(je(this),{width:this.width,height:this.height}))},renderArea(){return new W(v(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}function va(t={}){let e=null,n=null,r=null,o=null;return{id:\"agent\",require:[\"pos\",\"tile\"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return e?this.pos.dist(e):0},getNextLocation(){return n&&r?n[r]:null},getPath(){return n?n.slice():null},getTarget(){return e},isNavigationFinished(){return n?r===null:!0},isTargetReachable(){return n!==null},isTargetReached(){return e?this.pos.eq(e):!0},setTarget(s){e=s,n=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),r=n?0:null,n&&r!==null?(o||(o=this.getLevel().onNavigationMapChanged(()=>{e&&n&&r!==null&&(n=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),n?(r=0,this.trigger(\"navigationNext\",this,n[r])):(r=null,this.trigger(\"navigationEnded\",this)))}),this.onDestroy(()=>o?.cancel())),this.trigger(\"navigationStarted\",this),this.trigger(\"navigationNext\",this,n[r])):this.trigger(\"navigationEnded\",this)},update(){if(e&&n&&r!==null){if(this.pos.sdist(n[r])<2)if(r===n.length-1){this.pos=e.clone(),r=null,this.trigger(\"navigationEnded\",this),this.trigger(\"targetReached\",this);return}else r++,this.trigger(\"navigationNext\",this,n[r]);this.moveTo(n[r],this.agentSpeed)}},onNavigationStarted(s){return this.on(\"navigationStarted\",s)},onNavigationNext(s){return this.on(\"navigationNext\",s)},onNavigationEnded(s){return this.on(\"navigationEnded\",s)},onTargetReached(s){return this.on(\"targetReached\",s)},inspect(){return\"agent: \"+JSON.stringify({target:JSON.stringify(e),path:JSON.stringify(n)})}}}function wa(t){let e=t.graph;return{id:\"pathfinder\",require:[\"pos\"],navigateTo(n){return this.graph?.getWaypointPath(this.pos,n,t.navigationOpt)},get graph(){if(e)return e;let n=this.parent;for(;n;){if(n.has(\"pathfinderMap\"))return n.graph;n=n.parent}},set graph(n){e=n}}}function Ca(t={}){let e=t.waypoints,n=t.speed||100,r=t.endBehavior||\"stop\",o=0,s=e!=null;return{id:\"patrol\",require:[\"pos\"],get patrolSpeed(){return n},set patrolSpeed(i){n=i},get waypoints(){return e},set waypoints(i){e=i,o=0,s=!1},get nextLocation(){return e?e[o]:void 0},update(){let i=this.nextLocation;if(!(!e||!i||s)&&(this.moveTo(i,n),this.pos.sdist(i)<9))switch(r){case\"loop\":o=(o+1)%e.length;break;case\"ping-pong\":o=o+1,o==e.length&&(e.reverse(),o=0);break;case\"stop\":o<e.length-1?o+=1:s||(s=!0,this.trigger(\"patrolFinished\",this));break}},onPatrolFinished(i){return this.on(\"patrolFinished\",i)}}}function Ea(t,e={}){let n=typeof t==\"function\"?t:()=>a.game.root.query(t),r=e.checkFrequency||1,o=typeof e.direction==\"number\"?E.fromAngle(e.direction):e.direction,s=0;return{id:\"sentry\",require:[\"pos\"],direction:typeof e.direction==\"number\"?E.fromAngle(e.direction):e.direction,spotted:[],set directionAngle(i){this.direction=i!==void 0?E.fromAngle(i):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:e.fieldOfView||200,isWithinFieldOfView(i,m,u){let c=(typeof m==\"number\"?E.fromAngle(m):m)||o,p=u||e.fieldOfView;if(!c||!p||p>=360)return!0;let b=p/2;return i.pos&&c.angleBetween(i.pos.sub(this.pos))<=b},hasLineOfSight(i){let m=er(this.pos,i.pos.sub(this.pos),e.raycastExclude);return m!=null&&m.object===i},update(){if(s+=ee(),s>r){s-=r;let i=n();if(i.length&&o&&this.fieldOfView&&this.fieldOfView<360){let m=this.fieldOfView/2;i=i.filter(u=>u.pos&&o.angleBetween(u.pos.sub(this.pos))<=m)}i.length&&e.lineOfSight&&(i=i.filter(m=>m.pos&&this.hasLineOfSight(m))),i.length>0&&(this.spotted=i,this.trigger(\"objectSpotted\",i))}},onObjectsSpotted(i){return this.on(\"objectSpotted\",i)}}}function nr(t={}){let e=v(0),n=t.isObstacle??!1,r=t.cost??0,o=t.edges??[],s=()=>{let m={left:1,top:2,right:4,bottom:8};return o.map(u=>m[u]||0).reduce((u,c)=>u|c,0)},i=s();return{id:\"tile\",tilePosOffset:t.offset??v(0),set tilePos(m){let u=this.getLevel();e=m.clone(),this.pos=v(this.tilePos.x*u.tileWidth(),this.tilePos.y*u.tileHeight()).add(this.tilePosOffset)},get tilePos(){return e},set isObstacle(m){n!==m&&(n=m,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(m){r!==m&&(r=m,this.getLevel().invalidateNavigationMap())},get cost(){return r},set edges(m){o=m,i=s(),this.getLevel().invalidateNavigationMap()},get edges(){return o},get edgeMask(){return i},getLevel(){return this.parent},tileMove(m){let u=this.getLevel();u.removeFromSpatialMap(this),this.tilePos=this.tilePos.add(m),u.insertIntoSpatialMap(this),u.trigger(\"spatialMapChanged\")},moveLeft(){this.tileMove(v(-1,0))},moveRight(){this.tileMove(v(1,0))},moveUp(){this.tileMove(v(0,-1))},moveDown(){this.tileMove(v(0,1))}}}var bn=class{name;duration;loops;direction;easing;interpolation;isFinished;timing;easings;relative;constructor(e,n,r){this.name=e,this.duration=n.duration,this.loops=n.loops||0,this.direction=n.direction||\"forward\",this.easing=n.easing||nt.linear,this.interpolation=n.interpolation||\"linear\",this.isFinished=!1,this.timing=n.timing,this.easings=n.easings,this.relative=r}update(e,n){return!0}getLowerKeyIndexAndRelativeTime(e,n,r){let o=n-1,s=e/this.duration;if(this.loops!==0&&s>=this.loops)return[o,0,!0];let i=Math.trunc(s);if(s-=i,(this.direction==\"reverse\"||this.direction==\"ping-pong\"&&i&1)&&(s=1-s),r){let m=0;for(;r[m+1]!==void 0&&r[m+1]<s;)m++;return m>=o?[o,0,!0]:[m,(s-r[m])/(r[m+1]-r[m]),!1]}else{let m=Math.floor((n-1)*s);return[m,(s-m/o)*o,!1]}}setValue(e,n,r){if(this.relative)switch(n){case\"pos\":e.pos=e.base.pos.add(r);break;case\"angle\":e.angle=e.base.angle+r;break;case\"scale\":e.scale=e.base.scale.scale(r);break;case\"opacity\":e.opacity=e.base.opacity*r;break;default:e[n]=r}else e[n]=r}serialize(){let e={duration:this.duration,keys:[]};return this.loops&&(e.loops=this.loops),this.direction!==\"forward\"&&(e.direction=this.direction),this.easing!=nt.linear&&(e.easing=this.easing.name),this.interpolation!==\"linear\"&&(e.interpolation=this.interpolation),this.timing&&(e.timing=this.timing),this.easings&&(e.easings=this.easings.map(n=>this.easing.name)),e}};function Ta(t,e){return e.add(e.sub(t))}var ho=class extends bn{keys;constructor(e,n,r,o){super(e,r,o),this.keys=n}update(e,n){let[r,o,s]=this.getLowerKeyIndexAndRelativeTime(n,this.keys.length,this.timing);if(o==0||this.interpolation===\"none\")this.setValue(e,this.name,this.keys[r]);else{let i=this.easings?this.easings[r]:this.easing;this.setValue(e,this.name,de(this.keys[r],this.keys[r+1],i(o)))}return s}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},go=class extends bn{keys;curves;dcurves;constructor(e,n,r,o,s){if(super(e,r,o),this.keys=n,this.interpolation===\"spline\"){this.curves=[],s&&(this.dcurves=[]);for(let i=0;i<this.keys.length-1;i++){let m=this.keys[i],u=i+1,c=this.keys[u],p=i>0?this.keys[i-1]:Ta(c,m),b=u<this.keys.length-1?this.keys[u+1]:Ta(m,c);this.curves.push(jt(p,m,c,b)),s&&this.dcurves?.push(jt(p,m,c,b,Jo))}}}update(e,n){let[r,o,s]=this.getLowerKeyIndexAndRelativeTime(n,this.keys.length,this.timing);if(o==0||this.interpolation===\"none\")this.setValue(e,this.name,this.keys[r]);else{let i=this.easings?this.easings[r]:this.easing;switch(this.interpolation){case\"linear\":this.setValue(e,this.name,this.keys[r].lerp(this.keys[r+1],i(o)));break;case\"slerp\":this.setValue(e,this.name,this.keys[r].slerp(this.keys[r+1],i(o)));break;case\"spline\":if(this.curves){this.setValue(e,this.name,this.curves[r](i(o))),this.dcurves&&this.setValue(e,\"angle\",this.dcurves[r](i(o)).angle());break}}}return s}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},bo=class extends bn{keys;constructor(e,n,r,o){super(e,r,o),this.keys=n}update(e,n){let[r,o,s]=this.getLowerKeyIndexAndRelativeTime(n,this.keys.length,this.timing);if(o==0||this.interpolation==\"none\")this.setValue(e,this.name,this.keys[r]);else{let i=this.easings?this.easings[r]:this.easing;this.setValue(e,this.name,this.keys[r].lerp(this.keys[r+1],i(o)))}return s}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}};function Oa(t={}){let e=[],n=0,r=!1;return{id:\"animate\",require:t.followMotion?[\"rotate\"]:void 0,base:{pos:v(0,0),angle:0,scale:v(1,1),opacity:1},animation:{paused:!1,seek(o){n=Te(o,0,this.duration),e.forEach(s=>{s.isFinished=!1}),r=!1},get duration(){return e.reduce((o,s)=>Math.max(s.duration,o),0)}},add(){t.relative&&(this.has(\"pos\")&&(this.base.pos=this.pos.clone()),this.has(\"rotate\")&&(this.base.angle=this.angle),this.has(\"scale\")&&(this.base.scale=this.scale),this.has(\"opacity\")&&(this.base.opacity=this.opacity))},update(){if(this.animation.paused)return;let o=!0,s;n+=ee();for(let i of e)s=i.update(this,n),s&&!i.isFinished&&(i.isFinished=!0,this.trigger(\"animateChannelFinished\",i.name)),o&&=s;o&&!r&&(r=!0,this.trigger(\"animateFinished\"))},animate(o,s,i){r=!1,this.unanimate(o),typeof s[0]==\"number\"?e.push(new ho(o,s,i,t.relative||!1)):s[0]instanceof E?e.push(new go(o,s,i,t.relative||!1,o===\"pos\"&&(t.followMotion||!1))):s[0]instanceof j&&e.push(new bo(o,s,i,t.relative||!1))},unanimate(o){let s=e.findIndex(i=>i.name===o);s>=0&&e.splice(s,1)},unanimateAll(){e.splice(0,e.length)},onAnimateFinished(o){return this.on(\"animateFinished\",o)},onAnimateChannelFinished(o){return this.on(\"animateChannelFinished\",o)},serializeAnimationChannels(){return e.reduce((o,s)=>(o[s.name]=s.serialize(),o),{})},serializeAnimationOptions(){let o={};return t.followMotion&&(o.followMotion=!0),t.relative&&(o.relative=!0),o}}}function yo(t,e){let n={name:t.name};return t.has(\"animate\")&&(n.channels=t.serializeAnimationChannels(),Object.assign(n,t.serializeAnimationOptions())),t.children.length>0&&(n.children=t.children.filter(r=>r.has(\"named\")).map(r=>yo(r,r.name))),n}function po(t=2,e=1){let n=0;return{require:[\"scale\"],update(){let r=Math.sin(n*t)*e;r<0&&this.destroy(),this.scale=v(r),n+=ee()}}}function Aa(t,e){if(t==null)throw new Error(\"health() requires the initial amount of hp\");return{id:\"health\",hurt(n=1){this.setHP(t-n),this.trigger(\"hurt\",n)},heal(n=1){let r=t;this.setHP(t+n),this.trigger(\"heal\",t-r)},hp(){return t},maxHP(){return e??null},setMaxHP(n){e=n},setHP(n){t=e?Math.min(e,n):n,t<=0&&this.trigger(\"death\")},onHurt(n){return this.on(\"hurt\",n)},onHeal(n){return this.on(\"heal\",n)},onDeath(n){return this.on(\"death\",n)},inspect(){return`health: ${t}`}}}function Sa(t,e={}){if(t==null)throw new Error(\"lifespan() requires time\");let n=e.fade??0;return{id:\"lifespan\",require:[\"opacity\"],add(){a.game.root.wait(t,()=>{this.opacity=this.opacity??1,n>0?a.game.root.tween(this.opacity,0,n,r=>this.opacity=r,nt.linear).onEnd(()=>{this.destroy()}):this.destroy()})}}}function Va(t){return{id:\"named\",name:t}}function Pa(t,e,n){if(!t)throw new Error(\"state() requires an initial state\");let r={};function o(u){r[u]||(r[u]={enter:new re,end:new re,update:new re,draw:new re})}function s(u,c,p){return o(c),r[c][u].add(p)}function i(u,c,...p){o(c),r[c][u].trigger(...p)}let m=!1;return{id:\"state\",state:t,enterState(u,...c){if(m=!0,e&&!e.includes(u))throw new Error(`State not found: ${u}`);let p=this.state;if(n){if(!n?.[p])return;let b=typeof n[p]==\"string\"?[n[p]]:n[p];if(!b.includes(u))throw new Error(`Cannot transition state from \"${p}\" to \"${u}\". Available transitions: ${b.map(l=>`\"${l}\"`).join(\", \")}`)}i(\"end\",p,...c),this.state=u,i(\"enter\",u,...c),i(\"enter\",`${p} -> ${u}`,...c)},onStateTransition(u,c,p){return s(\"enter\",`${u} -> ${c}`,p)},onStateEnter(u,c){return s(\"enter\",u,c)},onStateUpdate(u,c){return s(\"update\",u,c)},onStateDraw(u,c){return s(\"draw\",u,c)},onStateEnd(u,c){return s(\"end\",u,c)},update(){m||(i(\"enter\",t),m=!0),i(\"update\",this.state)},draw(){i(\"draw\",this.state)},inspect(){return`state: ${this.state}`}}}function lr(t){return{id:\"stay\",stay:!0,scenesToStay:t}}function Ga(t=!0,e){let n,r;return{id:\"textInput\",hasFocus:t,require:[\"text\"],typedText:\"\",add(){let o=()=>{this.text=this.typedText.replace(/([\\[\\\\])/g,\"\\\\$1\")};n=a.k.onCharInput(s=>{this.hasFocus&&(!e||this.typedText.length<e)&&(a.k.isKeyDown(\"shift\")?this.typedText+=s.toUpperCase():this.typedText+=s,o())}),r=a.k.onKeyPressRepeat(\"backspace\",()=>{this.hasFocus&&(this.typedText=this.typedText.slice(0,-1),o())})},destroy(){n.cancel(),r.cancel()}}}function gn(t=1e3){return{id:\"timer\",maxLoopsPerFrame:t,loop(e,n,r=1/0,o=!1){let s=o?0:e,i=new re,m=this.onUpdate(()=>{s+=a.app.state.dt;for(let u=0;s>=e&&u<this.maxLoopsPerFrame;u++)if(r--,n(),s-=e,r<=0){m.cancel(),i.trigger();return}});return{get paused(){return m.paused},set paused(u){m.paused=u},cancel:m.cancel,onEnd(u){i.add(u)},then(u){return i.add(u),this}}},wait(e,n){return this.loop(e,n??(()=>{}),1,!0)},tween(e,n,r,o,s=nt.linear){let i=0,m=[],u=this.onUpdate(()=>{i+=a.app.state.dt;let c=Math.min(i/r,1);o(de(e,n,s(c))),c===1&&(u.cancel(),o(n),m.forEach(p=>p()))});return{get paused(){return u.paused},set paused(c){u.paused=c},onEnd(c){m.push(c)},then(c){return this.onEnd(c),this},cancel(){u.cancel()},finish(){u.cancel(),o(n),m.forEach(c=>c())}}}}}var xo=0;function Ma(){return xo>0}function Ra(t={}){let e={},n=new Set,r=[];return{id:\"area\",collisionIgnore:t.collisionIgnore??[],add(){xo++,this.area.cursor&&r.push(this.onHover(()=>a.app.setCursor(this.area.cursor))),r.push(this.onCollideUpdate((o,s)=>{if(!o.id)throw new Error(\"area() requires the object to have an id\");e[o.id]||this.trigger(\"collide\",o,s),s&&(e[o.id]=s,n.add(o.id))}))},destroy(){xo--;for(let o of r)o.cancel()},fixedUpdate(){for(let o in e)n.has(Number(o))||(this.trigger(\"collideEnd\",e[o].target),delete e[o]);n.clear()},drawInspect(){let o=this.localArea();ge(),X(this.area.offset);let s={outline:{width:4/_n(),color:I(0,0,255)},anchor:this.anchor,fill:!1,fixed:at(this)};o instanceof W?xe({...s,pos:o.pos,width:o.width*this.area.scale.x,height:o.height*this.area.scale.y}):o instanceof be?Pe({...s,pts:o.pts,scale:this.area.scale}):o instanceof we&&Ne({...s,pos:o.center,radius:o.radius}),me()},area:{shape:t.shape??null,scale:t.scale?v(t.scale):v(1),offset:t.offset??v(0),cursor:t.cursor??null},isClicked(){return a.app.isMousePressed()&&this.isHovering()},isHovering(){let o=at(this)?a.k.mousePos():a.k.toWorld(a.k.mousePos());return this.hasPoint(o)},checkCollision(o){if(!o.id)throw new Error(\"checkCollision() requires the object to have an id\");return e[o.id]??null},getCollisions(){return Object.values(e)},isColliding(o){if(!o.id)throw new Error(\"isColliding() requires the object to have an id\");return!!e[o.id]},isOverlapping(o){if(!o.id)throw new Error(\"isOverlapping() requires the object to have an id\");let s=e[o.id];return s&&s.hasOverlap()},onClick(o,s=\"left\"){let i=this.onMousePress(s,()=>{this.isHovering()&&o()});return r.push(i),i},onHover(o){let s=!1;return this.onUpdate(()=>{s?s=this.isHovering():this.isHovering()&&(s=!0,o())})},onHoverUpdate(o){return this.onUpdate(()=>{this.isHovering()&&o()})},onHoverEnd(o){let s=!1;return this.onUpdate(()=>{s?this.isHovering()||(s=!1,o()):s=this.isHovering()})},onCollide(o,s){if(typeof o==\"function\"&&s===void 0)return this.on(\"collide\",o);if(typeof o==\"string\")return this.onCollide((i,m)=>{i.is(o)&&s?.(i,m)});throw new Error(\"onCollide() requires either a function or a tag\")},onCollideUpdate(o,s){if(typeof o==\"function\"&&s===void 0)return this.on(\"collideUpdate\",o);if(typeof o==\"string\")return this.on(\"collideUpdate\",(i,m)=>i.is(o)&&s?.(i,m));throw new Error(\"onCollideUpdate() requires either a function or a tag\")},onCollideEnd(o,s){if(typeof o==\"function\"&&s===void 0)return this.on(\"collideEnd\",o);if(typeof o==\"string\")return this.on(\"collideEnd\",i=>i.is(o)&&s?.(i));throw new Error(\"onCollideEnd() requires either a function or a tag\")},hasPoint(o){return et(this.worldArea(),o)},resolveCollision(o){let s=this.checkCollision(o);s&&!s.resolved&&(this.pos=this.pos.add(s.displacement),s.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let o=this.localArea();if(!(o instanceof be||o instanceof W))throw new Error(\"Only support polygon and rect shapes for now\");let s=this.transform.clone().translate(this.area.offset).scale(v(this.area.scale??1));if(o instanceof W){let i=_e(this.anchor||mt).add(1,1).scale(-.5).scale(o.width,o.height);s.translate(i)}return o.transform(s)},screenArea(){let o=this.worldArea();return at(this)?o:o.transform(a.game.cam.transform)},inspect(){return this.area.scale?.x==this.area.scale?.y?`area: ${this.area.scale?.x?.toFixed(1)}x`:`area: (${this.area.scale?.x?.toFixed(1)}x, ${this.area.scale.y?.toFixed(1)}y)`}}}function Da(t={}){let e=null,n=null,r=!1,o=v(0),s=null,i=null,m;return{id:\"body\",require:[\"pos\"],vel:v(0),drag:t.drag??0,jumpForce:t.jumpForce??ds,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(s=this.pos.clone(),i=this.pos.clone(),m=this.pos.clone(),this.mass===0)throw new Error(\"Can't set body mass to 0\");this.has(\"area\")&&(this.onCollideUpdate((u,c)=>{if(!c||!u.has(\"body\")||c.resolved)return;this.trigger(\"beforePhysicsResolve\",c);let p=c.reverse();if(u.trigger(\"beforePhysicsResolve\",p),!(c.resolved||p.resolved)&&!(this.isStatic&&u.isStatic)){if(!this.isStatic&&!u.isStatic){let b=this.mass+u.mass;this.pos=this.pos.add(c.displacement.scale(u.mass/b)),u.pos=u.pos.add(c.displacement.scale(-this.mass/b)),this.transform=dt(this),u.transform=dt(u)}else{let b=!this.isStatic&&u.isStatic?c:c.reverse();b.source.pos=b.source.pos.add(b.displacement),b.source.transform=dt(b.source)}c.resolved=!0,this.trigger(\"physicsResolve\",c),u.trigger(\"physicsResolve\",c.reverse())}}),this.onPhysicsResolve(u=>{if(a.game.gravity)if(u.isBottom()&&this.isFalling()){this.vel=this.vel.reject(a.game.gravity.unit());let c=e;e=u.target,c!=e&&(n=u.target.pos),r?r=!1:c||(this.trigger(\"ground\",e),u.target.trigger(\"land\",this))}else u.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(a.game.gravity.unit()),this.trigger(\"headbutt\",u.target),u.target.trigger(\"headbutted\",this))}))},update(){e&&this.isColliding(e)&&e.exists()&&e.has(\"body\")&&(n&&!e.pos.eq(n)&&t.stickToPlatform!==!1&&this.moveBy(e.pos.sub(n)),n=e.pos);let u=un();u&&(this.pos.x==m.x&&(this.pos.x=de(s.x,i.x,u/an()),m.x=this.pos.x),this.pos.y==m.y&&(this.pos.y=de(s.y,i.y,u/an()),m.y=this.pos.y))},fixedUpdate(){if(s&&(this.pos.x==m.x&&(this.pos.x=s.x),this.pos.y==m.y&&(this.pos.y=s.y),s=null),a.game.gravity&&!this.isStatic){r&&(e=null,n=null,this.trigger(\"fallOff\"),r=!1),e&&(!this.isColliding(e)||!e.exists()||!e.has(\"body\"))&&(r=!0);let c=this.vel.clone();this.vel=this.vel.add(a.game.gravity.scale(this.gravityScale*ee()));let p=t.maxVelocity??fs;this.vel.slen()>p*p&&(this.vel=this.vel.unit().scale(p)),c.dot(a.game.gravity)<0&&this.vel.dot(a.game.gravity)>=0&&this.trigger(\"fall\")}if(this.vel.x+=o.x*ee(),this.vel.y+=o.y*ee(),this.vel.x*=1-this.drag*ee(),this.vel.y*=1-this.drag*ee(),this.move(this.vel),un()){s=this.pos.clone();let c=this.vel.add(o.scale(ee()));i=this.pos.add(c.scale(ee())),m=this.pos.clone()}o.x=0,o.y=0},onPhysicsResolve(u){return this.on(\"physicsResolve\",u)},onBeforePhysicsResolve(u){return this.on(\"beforePhysicsResolve\",u)},curPlatform(){return e},isGrounded(){return e!==null},isFalling(){return this.vel.dot(ht())>0},isJumping(){return this.vel.dot(ht())<0},applyImpulse(u){this.isStatic||(this.vel=this.vel.add(u))},addForce(u){this.isStatic||(o.x+=u.x/this.mass,o.y+=u.y/this.mass)},jump(u){this.isStatic||(e=null,n=null,this.vel=ht().scale(-u||-this.jumpForce))},onGround(u){return this.on(\"ground\",u)},onFall(u){return this.on(\"fall\",u)},onFallOff(u){return this.on(\"fallOff\",u)},onHeadbutt(u){return this.on(\"headbutt\",u)},onLand(u){return this.on(\"land\",u)},onHeadbutted(u){return this.on(\"headbutted\",u)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}function Ba(t=2){let e=t;return{id:\"doubleJump\",require:[\"body\"],numJumps:t,add(){this.onGround(()=>{e=this.numJumps})},doubleJump(n){e<=0||(e<this.numJumps&&this.trigger(\"doubleJump\"),e--,this.jump(n))},onDoubleJump(n){return this.on(\"doubleJump\",n)},inspect(){return`jumpsLeft: ${e}`}}}function Fa(t){return{id:\"surfaceEffector\",require:[\"area\"],speed:t.speed,speedVariation:t.speedVariation??0,forceScale:t.speedVariation??.9,add(){this.onCollideUpdate(\"body\",(e,n)=>{let r=n?.normal.normal(),o=e.vel.project(r),i=r?.scale(this.speed)?.sub(o);e.addForce(i?.scale(e.mass*this.forceScale))})}}}function La(t){return{id:\"areaEffector\",require:[\"area\"],useGlobalAngle:t.useGlobalAngle||!1,forceAngle:t.forceAngle,forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,linearDrag:t.linearDrag??0,add(){this.onCollideUpdate(\"body\",(e,n)=>{if(!e.has(\"body\"))return;let o=E.fromAngle(this.forceAngle).scale(this.forceMagnitude);e.addForce(o),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}function ja(t){return{id:\"pointEffector\",require:[\"area\",\"pos\"],forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,distanceScale:t.distanceScale??1,forceMode:t.forceMode||\"inverseLinear\",linearDrag:t.linearDrag??0,add(){this.onCollideUpdate(\"body\",(e,n)=>{let r=this.pos.sub(e.pos),o=r.len(),s=o*this.distanceScale/10,i=this.forceMode===\"constant\"?1:this.forceMode===\"inverseLinear\"?1/s:1/s**2,m=r.scale(this.forceMagnitude*i/o);e.addForce(m),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}function Ia(t){return{id:\"constantForce\",require:[\"body\"],force:t.force,update(){this.force&&this.addForce(this.force)}}}function Ka(t){return{id:\"platformEffector\",require:[\"area\",\"body\"],surfaceArc:t.surfaceArc??180,useOneWay:t.useOneWay??!1,add(){this.onBeforePhysicsResolve(e=>{let n=e.target.vel,o=ht().scale(-1).angleBetween(n);Math.abs(o)>this.surfaceArc/2&&e.preventResolution()})}}}function ka(t){return{id:\"buoyancyEffector\",require:[\"area\"],surfaceLevel:t.surfaceLevel,density:t.density??1,linearDrag:t.linearDrag??1,angularDrag:t.angularDrag??.2,flowAngle:t.flowAngle??0,flowMagnitude:t.flowMagnitude??0,flowVariation:t.flowVariation??0,add(){this.onCollideUpdate(\"body\",(e,n)=>{let r=e,o=r.worldArea(),[s,i]=o.cut(v(-100,this.surfaceLevel),v(100,this.surfaceLevel));s&&(this.applyBuoyancy(r,s),this.applyDrag(r,s)),this.flowMagnitude&&r.addForce(E.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(e,n){let r=this.density*n.area(),o=v(0,1).scale(-r);e.addForce(o)},applyDrag(e,n){let r=e.vel,o=this.density*this.linearDrag,s=r.scale(-o);e.addForce(s)}}}function hn(t){if(!t)throw new Error(\"Please define an anchor\");return{id:\"anchor\",anchor:t,inspect(){return typeof this.anchor==\"string\"?\"anchor: \"+this.anchor:\"anchor: \"+this.anchor.toString()}}}function ar(){return{id:\"fixed\",fixed:!0}}function _a(t,e){return{id:\"follow\",require:[\"pos\"],follow:{obj:t,offset:e??v(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function Na(t){let e=a.game.layers?.indexOf(t);return{id:\"layer\",get layerIndex(){return e??null},get layer(){return e?a.game.layers?.[e]??null:null},set layer(n){if(e=a.game.layers?.indexOf(n),e==-1)throw Error(\"Invalid layer name\")},inspect(){return`layer: ${this.layer}`}}}function Ua(t,e){let n=typeof t==\"number\"?E.fromAngle(t):t.unit();return{id:\"move\",require:[\"pos\"],update(){this.move(n.scale(e))}}}function Ha(t={}){let e=!1,n=new W(v(0),ie(),ue()),r=new W(v(0),0,0),o=s=>{s.isOffScreen()?(e||(s.trigger(\"exitView\"),e=!0),t.hide&&(s.hidden=!0),t.pause&&(s.paused=!0),t.destroy&&s.destroy()):(e&&(s.trigger(\"enterView\"),e=!1),t.hide&&(s.hidden=!1),t.pause&&(s.paused=!1))};return{id:\"offscreen\",require:[\"pos\"],offscreenDistance:t.distance??Gr,isOffScreen(){let s=this.screenPos();if(!s)return!1;if(n.width=ie(),n.height=ue(),!this.offscreenDistance&&this.width&&this.height)return r.width=this.width,r.height=this.height,r.pos=this.pos,r.collides(n);let i=this.offscreenDistance?this.offscreenDistance:Gr;return!Bt(n,s)&&n.sdistToPoint(s)>i*i},onExitScreen(s){return this.on(\"exitView\",s)},onEnterScreen(s){return this.on(\"enterView\",s)},add(){t.pause&&t.unpause?rr(()=>o(this)):this.onUpdate(()=>o(this))}}}function Pt(...t){return{id:\"pos\",pos:v(...t),moveBy(...e){this.pos=this.pos.add(v(...e))},move(...e){this.moveBy(v(...e).scale(ee()))},moveTo(...e){if(typeof e[0]==\"number\"&&typeof e[1]==\"number\")return this.moveTo(v(e[0],e[1]),e[2]);let n=e[0],r=e[1];if(r===void 0){this.pos=v(n);return}let o=n.sub(this.pos);if(o.len()<=r*ee()){this.pos=v(n);return}this.move(o.unit().scale(r))},worldPos(e=null){return e?(this.pos=this.pos.add(this.fromWorld(e)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(e){return this.parent?this.parent.transform.multVec2(this.pos.add(e)):this.pos.add(e)},fromWorld(e){return this.parent?this.parent.transform.invert().multVec2(e).sub(this.pos):e.sub(this.pos)},screenPos(e=null){if(e)return this.pos=this.pos.add(this.fromScreen(e)),null;{let n=this.worldPos();return n?at(this)?n:pn(n):null}},toScreen(e){let n=this.toWorld(e);return at(this)?n:pn(n)},fromScreen(e){return at(this)?this.fromWorld(e):this.fromWorld(sr(e))},toOther(e,n){return e.fromWorld(this.toWorld(n))},fromOther(e,n){return e.toOther(this,n)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){Ne({color:I(255,0,0),radius:4/_n()})}}}function qa(t){return{id:\"rotate\",angle:t??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`}}}function Ut(...t){if(t.length===0)return Ut(1);let e=v(...t);return{id:\"scale\",set scale(n){if(!(n instanceof E))throw Error(\"The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.\");e=v(n)},get scale(){return e},scaleTo(...n){e=v(...n)},scaleBy(...n){e=e.scale(v(...n))},inspect(){return e.x==e.y?`scale: ${e.x.toFixed(1)}x`:`scale: (${e.x.toFixed(1)}x, ${e.y.toFixed(1)}y)`}}}function za(t){return{id:\"z\",z:t,inspect(){return`z: ${this.z}`}}}var Wa=\"data:image/png;base64,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\";var Ya=\"data:image/png;base64,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\";var sc=Ao.version,a={k:null,globalOpt:null,gfx:null,game:null,app:null,assets:null,fontCacheCanvas:null,fontCacheC2d:null,debug:null,audio:null,pixelDensity:null,canvas:null,gscale:null,kaSprite:null,boomSprite:null},ic=(t={tagsAsComponents:!0})=>{a.k&&(console.warn(\"KAPLAY already initialized, you are calling kaplay() multiple times, it may lead bugs!\"),a.k.quit()),a.globalOpt=t;let e=t.root??document.body;e===document.body&&(document.body.style.width=\"100%\",document.body.style.height=\"100%\",document.body.style.margin=\"0px\",document.documentElement.style.width=\"100%\",document.documentElement.style.height=\"100%\");let n=t.canvas??e.appendChild(document.createElement(\"canvas\"));a.canvas=n;let r=t.scale??1;a.gscale=r;let o=t.width&&t.height&&!t.stretch&&!t.letterbox;o?(n.width=t.width*r,n.height=t.height*r):(n.width=n.parentElement.offsetWidth,n.height=n.parentElement.offsetHeight);let s=[\"outline: none\",\"cursor: default\"];if(o){let F=n.width,N=n.height;s.push(`width: ${F}px`),s.push(`height: ${N}px`)}else s.push(\"width: 100%\"),s.push(\"height: 100%\");t.crisp&&(s.push(\"image-rendering: pixelated\"),s.push(\"image-rendering: crisp-edges\")),n.style.cssText=s.join(\";\");let i=t.pixelDensity||1;a.pixelDensity=i,n.width*=i,n.height*=i,n.tabIndex=0;let m=document.createElement(\"canvas\");m.width=256,m.height=256,a.fontCacheCanvas=m;let u=m.getContext(\"2d\",{willReadFrequently:!0});a.fontCacheC2d=u;let c=Ms({canvas:n,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS,buttons:t.buttons});a.app=c;let p=[],b=c.canvas.getContext(\"webgl\",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!b)throw new Error(\"WebGL not supported\");let l=b,h=ui(l,{texFilter:t.texFilter}),d=xi(t,h);a.gfx=d;let C=sa();a.audio=C;let g=zs(h,t.spriteAtlasPadding??0);a.assets=g;let y=ea();a.game=y,y.root.use(gn());function O(F,N){let z=new st(h,F,N);return{clear:()=>z.clear(),free:()=>z.free(),toDataURL:()=>z.toDataURL(),toImageData:()=>z.toImageData(),width:z.width,height:z.height,draw:oe=>{Ce(),z.bind(),oe(),Ce(),z.unbind()},get fb(){return z}}}function A(){l.clear(l.COLOR_BUFFER_BIT),d.frameBuffer.bind(),l.clear(l.COLOR_BUFFER_BIT),d.bgColor||qe(()=>{it({width:ie(),height:ue(),quad:new q(0,0,ie()/64,ue()/64),tex:d.bgTex,fixed:!0})}),d.renderer.numDraws=0,d.fixed=!1,d.transformStack.length=0,d.transform=new fe}function R(F,N){d.postShader=F,d.postShaderUniform=N??null}function V(){Ce(),d.lastDrawCalls=d.renderer.numDraws,d.frameBuffer.unbind(),l.viewport(0,0,l.drawingBufferWidth,l.drawingBufferHeight);let F=d.width,N=d.height;d.width=l.drawingBufferWidth/i,d.height=l.drawingBufferHeight/i,Vt({flipY:!0,tex:d.frameBuffer.tex,pos:new E(d.viewport.x,d.viewport.y),width:d.viewport.width,height:d.viewport.height,shader:d.postShader,uniform:typeof d.postShaderUniform==\"function\"?d.postShaderUniform():d.postShaderUniform,fixed:!0}),Ce(),d.width=F,d.height=N}let x=!1,w={inspect:!1,set timeScale(F){a.app.state.timeScale=F},get timeScale(){return a.app.state.timeScale},showLog:!0,fps:()=>c.fps(),numFrames:()=>c.numFrames(),stepFrame:Gt,drawCalls:()=>d.lastDrawCalls,clearLog:()=>y.logs=[],log:(...F)=>{let N=t.logMax??8,z=F.length>1?F.concat(\" \").join(\" \"):F[0];y.logs.unshift({msg:z,time:c.time()}),y.logs.length>N&&(y.logs=y.logs.slice(0,N))},error:F=>w.log(new Error(F.toString?F.toString():F)),curRecording:null,numObjects:()=>_(\"*\",{recursive:!0}).length,get paused(){return x},set paused(F){x=F,F?C.ctx.suspend():C.ctx.resume()}};a.debug=w;function S(F,N){try{return JSON.parse(window.localStorage[F])}catch{return N?(G(F,N),N):null}}function G(F,N){window.localStorage[F]=JSON.stringify(N)}function M(F,...N){let z=F($e),oe;typeof z==\"function\"?oe=z(...N)($e):oe=z;for(let ye in oe)$e[ye]=oe[ye],t.global!==!1&&(window[ye]=oe[ye]);return $e}function D(F){let N=c.canvas.captureStream(F),z=C.ctx.createMediaStreamDestination();C.masterNode.connect(z);let oe=new MediaRecorder(N),ye=[];return oe.ondataavailable=Q=>{Q.data.size>0&&ye.push(Q.data)},oe.onerror=()=>{C.masterNode.disconnect(z),N.getTracks().forEach(Q=>Q.stop())},oe.start(),{resume(){oe.resume()},pause(){oe.pause()},stop(){return oe.stop(),C.masterNode.disconnect(z),N.getTracks().forEach(Q=>Q.stop()),new Promise(Q=>{oe.onstop=()=>{Q(new Blob(ye,{type:\"video/mp4\"}))}})},download(Q=\"kaboom.mp4\"){this.stop().then(ve=>Rr(Q,ve))}}}function L(){return document.activeElement===c.canvas}let U=y.root.add.bind(y.root),H=y.root.readd.bind(y.root),Y=y.root.removeAll.bind(y.root),_=y.root.get.bind(y.root),K=y.root.wait.bind(y.root),J=y.root.loop.bind(y.root),$=y.root.query.bind(y.root),Z=y.root.tween.bind(y.root),Ee=Ot(null,Ya),k=Ot(null,Wa);a.kaSprite=Ee,a.boomSprite=k;function gt(){y.root.fixedUpdate()}function Gt(){y.root.update()}class Ht{source;target;normal;distance;resolved=!1;constructor(N,z,oe,ye,Q=!1){this.source=N,this.target=z,this.normal=oe,this.distance=ye,this.resolved=Q}get displacement(){return this.normal.scale(this.distance)}reverse(){return new Ht(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(y.gravity||v(0,1))>0}isRight(){return this.displacement.cross(y.gravity||v(0,1))<0}isTop(){return this.displacement.dot(y.gravity||v(0,1))>0}isBottom(){return this.displacement.dot(y.gravity||v(0,1))<0}preventResolution(){this.resolved=!0}}function yn(){if(!Ma())return;let F={},N=t.hashGridSize||64,z=new fe,oe=[];function ye(Q){if(oe.push(z.clone()),Q.pos&&z.translate(Q.pos),Q.scale&&z.scale(Q.scale),Q.angle&&z.rotate(Q.angle),Q.transform=z.clone(),Q.c(\"area\")&&!Q.paused){let ve=Q,ut=ve.worldArea().bbox(),dr=Math.floor(ut.pos.x/N),fr=Math.floor(ut.pos.y/N),hr=Math.ceil((ut.pos.x+ut.width)/N),gr=Math.ceil((ut.pos.y+ut.height)/N),wn=new Set;for(let Xe=dr;Xe<=hr;Xe++)for(let ct=fr;ct<=gr;ct++)if(!F[Xe])F[Xe]={},F[Xe][ct]=[ve];else if(!F[Xe][ct])F[Xe][ct]=[ve];else{let zt=F[Xe][ct];e:for(let Ie of zt){if(Ie.paused||!Ie.exists()||wn.has(Ie.id))continue;for(let Je of ve.collisionIgnore)if(Ie.is(Je))continue e;for(let Je of Ie.collisionIgnore)if(ve.is(Je))continue e;let Wt=ns(ve.worldArea(),Ie.worldArea());if(Wt){let Je=new Ht(ve,Ie,Wt.normal,Wt.distance);ve.trigger(\"collideUpdate\",Ie,Je);let Cn=Je.reverse();Cn.resolved=Je.resolved,Ie.trigger(\"collideUpdate\",ve,Cn)}wn.add(Ie.id)}zt.push(ve)}}Q.children.forEach(ye),z=oe.pop()}ye(y.root)}function xn(F){console.error(F),C.ctx.suspend();let N=F.message??String(F)??\"Unknown error, check console for more info\";c.run(()=>{},()=>{A(),qe(()=>{let ye=ie(),Q=ue(),ve={size:36,width:ye-32*2,letterSpacing:4,lineSpacing:4,font:yt,fixed:!0};xe({width:ye,height:Q,color:I(0,0,255),fixed:!0});let qt=Ue({...ve,text:\"Error\",pos:v(32),color:I(255,128,0),fixed:!0});He(qt),Zr({...ve,text:N,pos:v(32,32+qt.height+16),fixed:!0}),me(),y.events.trigger(\"error\",F)}),V()})}function mr(F){p.push(F)}function pr(){y.events.onOnce(\"frameEnd\",()=>{c.quit(),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT|l.STENCIL_BUFFER_BIT);let F=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS);for(let N=0;N<F;N++)l.activeTexture(l.TEXTURE0+N),l.bindTexture(l.TEXTURE_2D,null),l.bindTexture(l.TEXTURE_CUBE_MAP,null);l.bindBuffer(l.ARRAY_BUFFER,null),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),h.destroy(),p.forEach(N=>N())})}let Mt=!0;c.run(()=>{try{g.loaded&&(w.paused||gt(),yn())}catch(F){xn(F)}},(F,N)=>{try{F(),g.loaded||Be()===1&&!Mt&&(g.loaded=!0,Un().forEach(z=>y.events.trigger(\"loadError\",...z)),y.events.trigger(\"load\")),!g.loaded&&t.loadingScreen!==!1||Mt?(A(),hi(),V()):(w.paused||Gt(),yn(),A(),fi(),t.debug!==!1&&di(),V()),Mt&&(Mt=!1),y.events.trigger(\"frameEnd\"),N()}catch(z){xn(z)}}),jn(),cr();let $e={_k:a,VERSION:sc,loadRoot:Us,loadProgress:Be,loadSprite:Ot,loadSpriteAtlas:$r,loadSound:si,loadMusic:ii,loadBitmapFont:Zs,loadFont:Qs,loadShader:ni,loadShaderURL:ri,loadAseprite:Xs,loadPedit:ei,loadBean:$s,loadJSON:Hs,load:cn,getSound:Yr,getFont:qr,getBitmapFont:Hn,getSprite:Nr,getShader:Wr,getAsset:qs,Asset:ce,SpriteData:Fe,SoundData:ot,width:ie,height:ue,center:Ct,dt:ee,fixedDt:an,restDt:un,time:c.time,screenshot:c.screenshot,record:D,isFocused:L,setCursor:c.setCursor,getCursor:c.getCursor,setCursorLocked:c.setCursorLocked,isCursorLocked:c.isCursorLocked,setFullscreen:c.setFullscreen,isFullscreen:c.isFullscreen,isTouchscreen:c.isTouchscreen,onLoad:Nt,onLoadError:zi,onLoading:Ui,onResize:Hi,onGamepadConnect:c.onGamepadConnect,onGamepadDisconnect:c.onGamepadDisconnect,onError:qi,onCleanup:mr,flash:co,setCamPos:ro,getCamPos:oo,setCamRot:ao,getCamRot:uo,setCamScale:so,getCamScale:io,getCamTransform:Wi,camPos:Xi,camScale:Qi,camFlash:Zi,camRot:Ji,camTransform:Yi,shake:$i,toScreen:pn,toWorld:sr,setGravity:ta,getGravity:na,setGravityDirection:ra,getGravityDirection:ht,setBackground:Is,getBackground:Ks,getGamepads:c.getGamepads,getTreeRoot:da,add:U,make:dn,destroy:ir,destroyAll:Y,get:_,query:$,readd:H,pos:Pt,scale:Ut,rotate:qa,color:Jn,opacity:Zn,anchor:hn,area:Ra,sprite:fn,text:ya,polygon:Ai,rect:tr,circle:vi,uvquad:xa,outline:Ti,particles:Oi,body:Da,platformEffector:Ka,surfaceEffector:Fa,areaEffector:La,pointEffector:ja,buoyancyEffector:ka,constantForce:Ia,doubleJump:Ba,shader:Si,textInput:Ga,timer:gn,fixed:ar,stay:lr,health:Aa,lifespan:Sa,named:Va,state:Pa,z:za,layer:Na,move:Ua,offscreen:Ha,follow:_a,fadeIn:Ci,mask:Ei,drawon:wi,raycast:er,tile:nr,animate:Oa,serializeAnimation:yo,agent:va,sentry:Ea,patrol:Ca,pathfinder:wa,trigger:Pi,on:Ge,onFixedUpdate:Gi,onUpdate:rr,onDraw:Mi,onAdd:to,onDestroy:Ri,onTag:no,onUntag:Fi,onUse:Di,onUnuse:Bi,onClick:Ki,onCollide:Li,onCollideUpdate:ji,onCollideEnd:Ii,onHover:ki,onHoverUpdate:_i,onHoverEnd:Ni,onKeyDown:c.onKeyDown,onKeyPress:c.onKeyPress,onKeyPressRepeat:c.onKeyPressRepeat,onKeyRelease:c.onKeyRelease,onMouseDown:c.onMouseDown,onMousePress:c.onMousePress,onMouseRelease:c.onMouseRelease,onMouseMove:c.onMouseMove,onCharInput:c.onCharInput,onTouchStart:c.onTouchStart,onTouchMove:c.onTouchMove,onTouchEnd:c.onTouchEnd,onScroll:c.onScroll,onHide:c.onHide,onShow:c.onShow,onGamepadButtonDown:c.onGamepadButtonDown,onGamepadButtonPress:c.onGamepadButtonPress,onGamepadButtonRelease:c.onGamepadButtonRelease,onGamepadStick:c.onGamepadStick,onButtonPress:c.onButtonPress,onButtonDown:c.onButtonDown,onButtonRelease:c.onButtonRelease,mousePos:c.mousePos,mouseDeltaPos:c.mouseDeltaPos,isKeyDown:c.isKeyDown,isKeyPressed:c.isKeyPressed,isKeyPressedRepeat:c.isKeyPressedRepeat,isKeyReleased:c.isKeyReleased,isMouseDown:c.isMouseDown,isMousePressed:c.isMousePressed,isMouseReleased:c.isMouseReleased,isMouseMoved:c.isMouseMoved,isGamepadButtonPressed:c.isGamepadButtonPressed,isGamepadButtonDown:c.isGamepadButtonDown,isGamepadButtonReleased:c.isGamepadButtonReleased,getGamepadStick:c.getGamepadStick,isButtonPressed:c.isButtonPressed,isButtonDown:c.isButtonDown,isButtonReleased:c.isButtonReleased,setButton:c.setButton,getButton:c.getButton,pressButton:c.pressButton,releaseButton:c.releaseButton,getLastInputDeviceType:c.getLastInputDeviceType,charInputted:c.charInputted,loop:J,wait:K,play:aa,setVolume:lo,getVolume:mo,volume:ua,burp:ur,audioCtx:C.ctx,Line:Oe,Rect:W,Circle:we,Ellipse:Ke,Point:On,Polygon:be,Vec2:E,Color:j,Mat4:fe,Quad:q,RNG:Xt,rand:he,randi:Cr,randSeed:Go,vec2:v,rgb:I,hsl2rgb:So,quad:le,choose:Do,chooseMultiple:Ro,shuffle:Er,chance:Mo,lerp:de,tween:Z,easings:nt,map:Se,mapc:Po,wave:An,deg2rad:ae,rad2deg:lt,clamp:Te,evaluateQuadratic:No,evaluateQuadraticFirstDerivative:Uo,evaluateQuadraticSecondDerivative:Ho,evaluateBezier:Jt,evaluateBezierFirstDerivative:qo,evaluateBezierSecondDerivative:zo,evaluateCatmullRom:Wo,evaluateCatmullRomFirstDerivative:Yo,curveLengthApproximation:Vr,normalizedCurve:$o,hermite:Lt,cardinal:Pr,catmullRom:jt,bezier:Xo,kochanekBartels:Qo,easingSteps:ts,easingLinear:Zo,easingCubicBezier:es,testLineLine:Sn,testRectRect:Tr,testRectLine:Vn,testRectPoint:Bt,testCirclePolygon:Qt,testLinePoint:Pn,testLineCircle:Ft,isConvex:os,triangulate:Mn,NavMesh:kn,drawSprite:bi,drawText:Zr,formatText:Ue,drawRect:xe,drawLine:_t,drawLines:kt,drawTriangle:Xn,drawCircle:Ne,drawEllipse:zn,drawUVQuad:it,drawPolygon:Pe,drawCurve:Wn,drawBezier:ai,drawFormattedText:He,drawMasked:gi,drawSubtracted:yi,pushTransform:ge,popTransform:me,pushTranslate:X,pushScale:rt,pushRotate:Ye,pushMatrix:ks,usePostEffect:R,makeCanvas:O,debug:w,scene:fa,getSceneName:ba,go:ha,onSceneLeave:ga,layers:pa,getLayers:la,setLayers:fo,getDefaultLayer:ma,addLevel:Vi,getData:S,setData:G,download:Bn,downloadJSON:xs,downloadText:Mr,downloadBlob:Rr,plug:M,ASCII_CHARS:Rn,canvas:c.canvas,addKaboom:ca,LEFT:E.LEFT,RIGHT:E.RIGHT,UP:E.UP,DOWN:E.DOWN,RED:j.RED,GREEN:j.GREEN,BLUE:j.BLUE,YELLOW:j.YELLOW,MAGENTA:j.MAGENTA,CYAN:j.CYAN,WHITE:j.WHITE,BLACK:j.BLACK,quit:pr,KEvent:re,KEventHandler:ze,KEventController:ke,cancel:()=>Dn};a.k=$e;let vn=t.plugins;if(vn&&vn.forEach(M),t.global!==!1)for(let F in $e)window[F]=$e[F];return t.focus!==!1&&c.canvas.focus(),$e};var hw=ic;export{a as _k,hw as default,ic as kaplay};\n//# sourceMappingURL=kaplay.mjs.map\n","/**\r\n * Player Name Generator\r\n * Generates random contestant names in the format [Adjective][Noun]\r\n * Theme: Game show contestants competing in combat arenas\r\n */\r\n\r\nconst ADJECTIVES = [\r\n    // Original - Power & Speed (all 8 chars or less)\r\n    'Swift', 'Mighty', 'Bold', 'Silent', 'Fierce',\r\n    'Brave', 'Quick', 'Sharp', 'Dark', 'Bright',\r\n    'Wild', 'Cool', 'Hot', 'Frozen', 'Burning',\r\n    'Iron', 'Steel', 'Golden', 'Silver', 'Crimson',\r\n    'Azure', 'Jade', 'Ruby', 'Onyx', 'Electric',\r\n    'Toxic', 'Mystic', 'Ancient', 'Cyber', 'Neon',\r\n    'Phantom', 'Shadow', 'Storm', 'Thunder', 'Frost',\r\n    'Blaze', 'Venom', 'Razor', 'Nitro', 'Turbo',\r\n    'Alpha', 'Omega', 'Prime', 'Elite', 'Epic',\r\n    'Royal', 'Noble', 'Rogue', 'Savage',\r\n\r\n    // Game Show / Competition (8 chars or less)\r\n    'Reigning', 'Rising', 'Rookie', 'Veteran', 'Seasoned',\r\n    'Underdog', 'Favored', 'Viral', 'Trending', 'Famous',\r\n    'Infamous', 'Ultimate', 'Supreme', 'Grand', 'Major',\r\n    'Premier', 'Star', 'Main', 'Top', 'Peak', 'Apex',\r\n\r\n    // Fighting / Combat (8 chars or less)\r\n    'Brutal', 'Ruthless', 'Vicious', 'Crushing', 'Raging',\r\n    'Furious', 'Frenzied', 'Berserk', 'Mad', 'Crazy',\r\n    'Lethal', 'Deadly', 'Fatal', 'Killer', 'Murder',\r\n    'Immortal', 'Eternal', 'Heavy', 'Hard', 'Tough',\r\n    'Gritty', 'Scrappy', 'Mean', 'Nasty', 'Dirty',\r\n    'Raw', 'Primal',\r\n\r\n    // Dramatic / Showmanship (8 chars or less)\r\n    'Amazing', 'Awesome', 'Dazzling', 'Stunning', 'Shocking',\r\n    'Dynamic', 'Radical', 'Extreme', 'Intense', 'Hyper',\r\n    'Ultra', 'Mega', 'Super', 'Power', 'Atomic',\r\n    'Nuclear', 'Chaos', 'Havoc', 'Mayhem', 'Rampage',\r\n    'Carnage',\r\n\r\n    // Attitude / Personality (8 chars or less)\r\n    'Cocky', 'Sneaky', 'Tricky', 'Sly', 'Cunning',\r\n    'Wicked', 'Evil', 'Sinister', 'Twisted', 'Crooked',\r\n    'Lucky', 'Unlucky', 'Cursed', 'Blessed', 'Chosen',\r\n    'Lone', 'Solo', 'Outlaw', 'Rebel', 'Bandit'\r\n];\r\n\r\nconst NOUNS = [\r\n    // Original - Animals & Warriors (8 chars or less)\r\n    'Wolf', 'Eagle', 'Tiger', 'Dragon', 'Phoenix',\r\n    'Hawk', 'Lion', 'Bear', 'Falcon', 'Raven',\r\n    'Viper', 'Cobra', 'Panther', 'Shark', 'Raptor',\r\n    'Hunter', 'Warrior', 'Knight', 'Ninja', 'Samurai',\r\n    'Ronin', 'Striker', 'Sniper', 'Ranger', 'Scout',\r\n    'Titan', 'Champion', 'Hero', 'Legend', 'Master',\r\n    'Blade', 'Arrow', 'Bullet', 'Rocket', 'Comet',\r\n    'Star', 'Moon', 'Sun', 'Bolt', 'Flash',\r\n    'Storm', 'Flame', 'Wave', 'Wind', 'Quake',\r\n    'Slayer', 'Reaper', 'Wraith', 'Ghost', 'Specter',\r\n\r\n    // Game Show / Competition (8 chars or less)\r\n    'Finalist', 'Victor', 'Winner', 'Champ', 'Hopeful',\r\n    'Prospect', 'Wildcard', 'Underdog', 'Favorite', 'Prodigy',\r\n    'Rookie', 'Veteran', 'Pro', 'Amateur', 'Phenom',\r\n    'Showman', 'Icon',\r\n\r\n    // Fighting / Brawling (8 chars or less)\r\n    'Brawler', 'Bruiser', 'Slugger', 'Puncher', 'Boxer',\r\n    'Fighter', 'Scrapper', 'Battler', 'Duelist', 'Crusher',\r\n    'Smasher', 'Basher', 'Masher', 'Thrasher', 'Pummeler',\r\n    'Pounder', 'Hammer', 'Mauler', 'Mangler', 'Knockout',\r\n    'Haymaker', 'Uppercut', 'Jab', 'Hook', 'Spartan',\r\n    'Viking',\r\n\r\n    // Destruction / Chaos (8 chars or less)\r\n    'Wrecking', 'Rampage', 'Havoc', 'Mayhem', 'Chaos',\r\n    'Carnage', 'Fury', 'Menace', 'Terror', 'Horror',\r\n    'Dread',\r\n\r\n    // Weaponry / Tools (8 chars or less)\r\n    'Fist', 'Knuckle', 'Claw', 'Talon', 'Spike',\r\n    'Axe', 'Hammer', 'Mace', 'Flail', 'Club',\r\n    'Cannon', 'Mortar', 'Missile', 'Bomb', 'Grenade',\r\n    'Shiv', 'Machete', 'Cleaver', 'Hatchet',\r\n\r\n    // Animals - More Aggressive (8 chars or less)\r\n    'Gorilla', 'Rhino', 'Bull', 'Boar', 'Pitbull',\r\n    'Doberman', 'Mastiff', 'Bulldog', 'Scorpion', 'Mantis',\r\n    'Hornet', 'Wasp', 'Spider', 'Croc', 'Gator',\r\n    'Piranha', 'Orca', 'Hyena', 'Jackal', 'Badger',\r\n    'Warthog', 'Mongoose',\r\n\r\n    // Personas / Archetypes (8 chars or less)\r\n    'Outlaw', 'Bandit', 'Thug', 'Goon', 'Hooligan',\r\n    'Punk', 'Rebel', 'Maverick', 'Renegade', 'Assassin',\r\n    'Bounty', 'Hitman', 'Enforcer', 'Boss', 'Kingpin',\r\n    'Warlord', 'Overlord', 'Tyrant'\r\n];\r\n\r\n/**\r\n * Generate a random player name\r\n * @returns {string} Random name in format \"AdjectiveNoun\"\r\n */\r\nexport function generateRandomName() {\r\n    const adjective = ADJECTIVES[Math.floor(Math.random() * ADJECTIVES.length)];\r\n    const noun = NOUNS[Math.floor(Math.random() * NOUNS.length)];\r\n    return `${adjective}${noun}`;\r\n}\r\n\r\n/**\r\n * Generate a unique 6-digit invite code\r\n * @returns {string} 6-digit code\r\n */\r\nexport function generateInviteCode() {\r\n    // Generate 6 random digits\r\n    return Math.floor(100000 + Math.random() * 900000).toString();\r\n}\r\n\r\n/**\r\n * Validate an invite code\r\n * @param {string} code - Code to validate\r\n * @returns {boolean} True if valid format\r\n */\r\nexport function isValidInviteCode(code) {\r\n    return /^\\d{6}$/.test(code);\r\n}\r\n","// Achievement definitions - expanded achievement system with difficulty tiers and shop unlocks\r\n\r\nexport const ACHIEVEMENTS = {\r\n    // =============================================================================\r\n    // PROGRESSION ACHIEVEMENTS (normal difficulty)\r\n    // =============================================================================\r\n    floor2: {\r\n        id: 'floor2',\r\n        name: 'Floor 2 Reached',\r\n        description: 'Reach Floor 2',\r\n        category: 'progression',\r\n        icon: '2',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'bestFloor', value: 2 },\r\n        hint: 'Progress further into the facility'\r\n    },\r\n    floor3: {\r\n        id: 'floor3',\r\n        name: 'Floor 3 Reached',\r\n        description: 'Reach Floor 3',\r\n        category: 'progression',\r\n        icon: '3',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'bestFloor', value: 3 },\r\n        hint: 'Keep pushing deeper'\r\n    },\r\n    floor5: {\r\n        id: 'floor5',\r\n        name: 'Floor 5 Reached',\r\n        description: 'Reach Floor 5',\r\n        category: 'progression',\r\n        icon: '5',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'bestFloor', value: 5 },\r\n        hint: 'The halfway point awaits',\r\n        unlocks: ['trailIce']\r\n    },\r\n    floor10: {\r\n        id: 'floor10',\r\n        name: 'Double Digits',\r\n        description: 'Reach Floor 10',\r\n        category: 'progression',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'bestFloor', value: 10 },\r\n        unlocks: ['plasmaRifle']\r\n    },\r\n    firstSynergy: {\r\n        id: 'firstSynergy',\r\n        name: 'Combo Starter',\r\n        description: 'Activate your first synergy',\r\n        category: 'progression',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        hint: 'Collect upgrades that work together',\r\n        unlocks: ['trailShadow']\r\n    },\r\n    allCharacters: {\r\n        id: 'allCharacters',\r\n        name: 'Full Roster',\r\n        description: 'Unlock all characters',\r\n        category: 'progression',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        hint: 'Progress through floors to unlock characters'\r\n    },\r\n    maxUpgrade: {\r\n        id: 'maxUpgrade',\r\n        name: 'Maxed Out',\r\n        description: 'Max out a permanent upgrade',\r\n        category: 'progression',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        hint: 'Purchase the same upgrade multiple times'\r\n    },\r\n    firstDoor: {\r\n        id: 'firstDoor',\r\n        name: 'Door Explorer',\r\n        description: 'Enter a special door',\r\n        category: 'progression',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        hint: 'Find and enter a special door in a room'\r\n    },\r\n\r\n    // =============================================================================\r\n    // COMBAT ACHIEVEMENTS (normal difficulty)\r\n    // =============================================================================\r\n    firstKill: {\r\n        id: 'firstKill',\r\n        name: 'First Blood',\r\n        description: 'Kill your first enemy',\r\n        category: 'combat',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalEnemiesKilled', value: 1 },\r\n        hint: 'Defeat any enemy'\r\n    },\r\n    kill100: {\r\n        id: 'kill100',\r\n        name: 'Enemy Slayer',\r\n        description: 'Kill 100 enemies total',\r\n        category: 'combat',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalEnemiesKilled', value: 100 },\r\n        hint: 'Keep fighting!',\r\n        unlocks: ['trailFire']\r\n    },\r\n    kill500: {\r\n        id: 'kill500',\r\n        name: 'Massacre',\r\n        description: 'Kill 500 enemies total',\r\n        category: 'combat',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalEnemiesKilled', value: 500 },\r\n        hint: 'The carnage continues',\r\n        unlocks: ['trailPoison']\r\n    },\r\n    kill1000: {\r\n        id: 'kill1000',\r\n        name: 'Rampage',\r\n        description: 'Kill 1000 enemies total',\r\n        category: 'combat',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalEnemiesKilled', value: 1000 },\r\n        hint: 'A true warrior emerges'\r\n    },\r\n    killStreak10: {\r\n        id: 'killStreak10',\r\n        name: 'On Fire',\r\n        description: 'Kill 10 enemies in 5 seconds',\r\n        category: 'combat',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Defeat enemies rapidly',\r\n        unlocks: ['deathVaporize']\r\n    },\r\n    multikill: {\r\n        id: 'multikill',\r\n        name: 'Multi-Kill',\r\n        description: 'Kill 5 enemies with one attack',\r\n        category: 'combat',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Use piercing or explosive attacks',\r\n        unlocks: ['deathPixelate']\r\n    },\r\n\r\n    // =============================================================================\r\n    // BOSS ACHIEVEMENTS\r\n    // =============================================================================\r\n    firstBoss: {\r\n        id: 'firstBoss',\r\n        name: 'Boss Hunter',\r\n        description: 'Defeat your first boss',\r\n        category: 'boss',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalBossesKilled', value: 1 },\r\n        hint: 'Clear Floor 1 to face a boss',\r\n        unlocks: ['deathExplosion']\r\n    },\r\n    boss5: {\r\n        id: 'boss5',\r\n        name: 'Boss Slayer',\r\n        description: 'Defeat 5 bosses total',\r\n        category: 'boss',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalBossesKilled', value: 5 },\r\n        hint: 'Keep defeating floor bosses',\r\n        unlocks: ['deathDisintegrate']\r\n    },\r\n    boss10: {\r\n        id: 'boss10',\r\n        name: 'Boss Veteran',\r\n        description: 'Defeat 10 bosses total',\r\n        category: 'boss',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalBossesKilled', value: 10 },\r\n        hint: 'Experience makes perfect'\r\n    },\r\n    boss25: {\r\n        id: 'boss25',\r\n        name: 'Boss Crusher',\r\n        description: 'Defeat 25 bosses total',\r\n        category: 'boss',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'totalBossesKilled', value: 25 },\r\n        unlocks: ['railgun'],\r\n        hint: 'Become a boss-hunting expert'\r\n    },\r\n    boss50: {\r\n        id: 'boss50',\r\n        name: 'Boss Destroyer',\r\n        description: 'Defeat 50 bosses total',\r\n        category: 'boss',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'totalBossesKilled', value: 50 },\r\n        hint: 'The ultimate boss hunter'\r\n    },\r\n    minibossSlayer: {\r\n        id: 'minibossSlayer',\r\n        name: 'Miniboss Hunter',\r\n        description: 'Defeat 10 minibosses',\r\n        category: 'boss',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalMinibossesKilled', value: 10 },\r\n        hint: 'Minibosses appear in later rooms'\r\n    },\r\n\r\n    // =============================================================================\r\n    // RUN ACHIEVEMENTS\r\n    // =============================================================================\r\n    firstRun: {\r\n        id: 'firstRun',\r\n        name: 'First Run',\r\n        description: 'Complete your first run',\r\n        category: 'run',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalRuns', value: 1 },\r\n        hint: 'Play until you die (or win!)'\r\n    },\r\n    run10: {\r\n        id: 'run10',\r\n        name: 'Veteran',\r\n        description: 'Complete 10 runs',\r\n        category: 'run',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalRuns', value: 10 },\r\n        hint: 'Practice makes progress'\r\n    },\r\n    run50: {\r\n        id: 'run50',\r\n        name: 'Dedicated',\r\n        description: 'Complete 50 runs',\r\n        category: 'run',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalRuns', value: 50 },\r\n        hint: 'A true fan of the show'\r\n    },\r\n    run100: {\r\n        id: 'run100',\r\n        name: 'Century',\r\n        description: 'Complete 100 runs',\r\n        category: 'run',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'totalRuns', value: 100 },\r\n        hint: 'The ultimate dedication'\r\n    },\r\n    quickDeath: {\r\n        id: 'quickDeath',\r\n        name: 'Speedrun Fail',\r\n        description: 'Die within 30 seconds',\r\n        category: 'run',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        hint: 'Sometimes things go wrong fast'\r\n    },\r\n    longRun: {\r\n        id: 'longRun',\r\n        name: 'Marathon',\r\n        description: 'Survive for 30 minutes',\r\n        category: 'run',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Keep surviving as long as possible'\r\n    },\r\n\r\n    // =============================================================================\r\n    // UPGRADE ACHIEVEMENTS\r\n    // =============================================================================\r\n    level10: {\r\n        id: 'level10',\r\n        name: 'Level 10',\r\n        description: 'Reach level 10 in a single run',\r\n        category: 'upgrade',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'bestLevel', value: 10 },\r\n        hint: 'Collect XP and level up'\r\n    },\r\n    level20: {\r\n        id: 'level20',\r\n        name: 'Level 20',\r\n        description: 'Reach level 20 in a single run',\r\n        category: 'upgrade',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'bestLevel', value: 20 },\r\n        hint: 'Keep grinding for XP'\r\n    },\r\n    level30: {\r\n        id: 'level30',\r\n        name: 'Powerhouse',\r\n        description: 'Reach level 30 in a single run',\r\n        category: 'upgrade',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'bestLevel', value: 30 },\r\n        hint: 'Build becomes unstoppable'\r\n    },\r\n    level50: {\r\n        id: 'level50',\r\n        name: 'Unstoppable',\r\n        description: 'Reach level 50 in a single run',\r\n        category: 'upgrade',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'bestLevel', value: 50 },\r\n        hint: 'Ultimate power achieved'\r\n    },\r\n    upgradeCollector: {\r\n        id: 'upgradeCollector',\r\n        name: 'Collector',\r\n        description: 'Have 15 upgrades at once',\r\n        category: 'upgrade',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        hint: 'Collect many different upgrades'\r\n    },\r\n    synergyMaster: {\r\n        id: 'synergyMaster',\r\n        name: 'Synergy Master',\r\n        description: 'Activate 3 synergies in one run',\r\n        category: 'upgrade',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Build for multiple synergy combos',\r\n        unlocks: ['trailRainbow']\r\n    },\r\n\r\n    // =============================================================================\r\n    // CURRENCY ACHIEVEMENTS\r\n    // =============================================================================\r\n    earn100: {\r\n        id: 'earn100',\r\n        name: 'Pocket Change',\r\n        description: 'Earn 100 credits total',\r\n        category: 'currency',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalCurrencyEarned', value: 100 },\r\n        hint: 'Play runs to earn credits'\r\n    },\r\n    earn500: {\r\n        id: 'earn500',\r\n        name: 'Savings Account',\r\n        description: 'Earn 500 credits total',\r\n        category: 'currency',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalCurrencyEarned', value: 500 },\r\n        hint: 'Keep earning and saving',\r\n        unlocks: ['glowGold']\r\n    },\r\n    earn1000: {\r\n        id: 'earn1000',\r\n        name: 'Money Bags',\r\n        description: 'Earn 1000 credits total',\r\n        category: 'currency',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalCurrencyEarned', value: 1000 },\r\n        hint: 'A fortune awaits'\r\n    },\r\n    earn5000: {\r\n        id: 'earn5000',\r\n        name: 'Fortune',\r\n        description: 'Earn 5000 credits total',\r\n        category: 'currency',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'totalCurrencyEarned', value: 5000 },\r\n        hint: 'Building an empire'\r\n    },\r\n    earn10000: {\r\n        id: 'earn10000',\r\n        name: 'Tycoon',\r\n        description: 'Earn 10000 credits total',\r\n        category: 'currency',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'totalCurrencyEarned', value: 10000 },\r\n        hint: 'The ultimate collector'\r\n    },\r\n    bigSpender: {\r\n        id: 'bigSpender',\r\n        name: 'Big Spender',\r\n        description: 'Spend 1000 credits in the shop',\r\n        category: 'currency',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalCurrencySpent', value: 1000 },\r\n        hint: 'Buy upgrades from the shop'\r\n    },\r\n\r\n    // =============================================================================\r\n    // CHALLENGE ACHIEVEMENTS (special conditions)\r\n    // =============================================================================\r\n    perfectFloor: {\r\n        id: 'perfectFloor',\r\n        name: 'Untouchable',\r\n        description: 'Clear a floor without taking damage',\r\n        category: 'challenge',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Dodge everything on an entire floor',\r\n        unlocks: ['glowVoid']\r\n    },\r\n    speedRunner: {\r\n        id: 'speedRunner',\r\n        name: 'Speed Demon',\r\n        description: 'Clear Floor 3 in under 5 minutes',\r\n        category: 'challenge',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Rush through the first 3 floors',\r\n        unlocks: ['glowElectric']\r\n    },\r\n    bossRush: {\r\n        id: 'bossRush',\r\n        name: 'Boss Rush',\r\n        description: 'Defeat 3 bosses in one run',\r\n        category: 'challenge',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Reach and defeat multiple floor bosses'\r\n    },\r\n    noHitBoss: {\r\n        id: 'noHitBoss',\r\n        name: 'Flawless Victory',\r\n        description: 'Defeat a boss without taking damage',\r\n        category: 'challenge',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Perfect boss fight execution'\r\n    },\r\n    glassCannonWin: {\r\n        id: 'glassCannonWin',\r\n        name: 'Living Dangerously',\r\n        description: 'Defeat a boss while below 25% HP',\r\n        category: 'challenge',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Living dangerously pays off'\r\n    },\r\n    closeCall: {\r\n        id: 'closeCall',\r\n        name: 'Close Call',\r\n        description: 'Survive with 1 HP',\r\n        category: 'challenge',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Get very close to death but survive',\r\n        unlocks: ['glowCrimson']\r\n    },\r\n    pacifist: {\r\n        id: 'pacifist',\r\n        name: 'Pacifist Start',\r\n        description: 'Clear Room 1 without attacking',\r\n        category: 'challenge',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Just dodge everything'\r\n    },\r\n    noDamageRoom: {\r\n        id: 'noDamageRoom',\r\n        name: 'Perfect Room',\r\n        description: 'Clear 5 rooms without damage in one run',\r\n        category: 'challenge',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Master your dodging skills'\r\n    },\r\n\r\n    // =============================================================================\r\n    // BENCHMARK ACHIEVEMENTS (high targets)\r\n    // =============================================================================\r\n    kill5000: {\r\n        id: 'kill5000',\r\n        name: 'Exterminator',\r\n        description: 'Kill 5,000 enemies total',\r\n        category: 'benchmark',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'totalEnemiesKilled', value: 5000 },\r\n        hint: 'A lifetime of combat'\r\n    },\r\n    kill10000: {\r\n        id: 'kill10000',\r\n        name: 'Annihilator',\r\n        description: 'Kill 10,000 enemies total',\r\n        category: 'benchmark',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'totalEnemiesKilled', value: 10000 },\r\n        hint: 'The ultimate destroyer'\r\n    },\r\n    floor15: {\r\n        id: 'floor15',\r\n        name: 'Deep Delver',\r\n        description: 'Reach Floor 15',\r\n        category: 'benchmark',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'bestFloor', value: 15 },\r\n        hint: 'Go deeper than ever before'\r\n    },\r\n    floor20: {\r\n        id: 'floor20',\r\n        name: 'Abyssal',\r\n        description: 'Reach Floor 20',\r\n        category: 'benchmark',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'bestFloor', value: 20 },\r\n        hint: 'The final frontier'\r\n    },\r\n    rooms100: {\r\n        id: 'rooms100',\r\n        name: 'Room Master',\r\n        description: 'Clear 100 rooms total',\r\n        category: 'benchmark',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalRoomsCleared', value: 100 },\r\n        hint: 'Clear many rooms across all runs'\r\n    },\r\n    rooms500: {\r\n        id: 'rooms500',\r\n        name: 'Hall Walker',\r\n        description: 'Clear 500 rooms total',\r\n        category: 'benchmark',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'benchmark',\r\n        threshold: { stat: 'totalRoomsCleared', value: 500 },\r\n        hint: 'Keep exploring'\r\n    },\r\n\r\n    // =============================================================================\r\n    // SECRET/FUN ACHIEVEMENTS\r\n    // =============================================================================\r\n    firstPickup: {\r\n        id: 'firstPickup',\r\n        name: 'Loot Goblin',\r\n        description: 'Collect your first pickup',\r\n        category: 'progression',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        hint: 'Pick up health, XP, or other items'\r\n    },\r\n    healingAddict: {\r\n        id: 'healingAddict',\r\n        name: 'Healing Addict',\r\n        description: 'Collect 50 health pickups',\r\n        category: 'progression',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalHealthPickups', value: 50 },\r\n        hint: 'Stay alive by healing'\r\n    },\r\n    xpHoarder: {\r\n        id: 'xpHoarder',\r\n        name: 'XP Hoarder',\r\n        description: 'Collect 1000 XP orbs',\r\n        category: 'progression',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'normal',\r\n        threshold: { stat: 'totalXpOrbs', value: 1000 },\r\n        hint: 'Collect all those green orbs'\r\n    },\r\n    comeback: {\r\n        id: 'comeback',\r\n        name: 'Comeback King',\r\n        description: 'Win a room after being below 10% HP',\r\n        category: 'challenge',\r\n        icon: '',\r\n        unlocked: false,\r\n        difficulty: 'challenge',\r\n        hint: 'Never give up!'\r\n    }\r\n};\r\n\r\n// Achievement difficulty colors for UI\r\nexport const ACHIEVEMENT_COLORS = {\r\n    normal: [200, 200, 200],      // Gray - standard achievements\r\n    challenge: [255, 200, 100],   // Gold - challenge achievements\r\n    benchmark: [200, 150, 255]    // Purple - benchmark achievements\r\n};\r\n\r\n// Default credit rewards by difficulty (for achievements without unlocks)\r\nexport const ACHIEVEMENT_REWARDS = {\r\n    normal: 25,\r\n    challenge: 50,\r\n    benchmark: 100\r\n};\r\n\r\n/**\r\n * Get the credit reward for an achievement\r\n * Returns 0 if achievement has unlocks (the unlock IS the reward)\r\n * @param {Object} achievement - Achievement object\r\n * @returns {number} Credit reward amount\r\n */\r\nexport function getAchievementReward(achievement) {\r\n    if (!achievement) return 0;\r\n    // If achievement unlocks something, no credit reward\r\n    if (achievement.unlocks && achievement.unlocks.length > 0) return 0;\r\n    // Use explicit reward if set, otherwise use difficulty default\r\n    if (achievement.reward !== undefined) return achievement.reward;\r\n    return ACHIEVEMENT_REWARDS[achievement.difficulty] || ACHIEVEMENT_REWARDS.normal;\r\n}\r\n\r\n// Get achievements by category\r\nexport function getAchievementsByCategory(category) {\r\n    return Object.values(ACHIEVEMENTS).filter(ach => ach.category === category);\r\n}\r\n\r\n// Get achievements by difficulty\r\nexport function getAchievementsByDifficulty(difficulty) {\r\n    return Object.values(ACHIEVEMENTS).filter(ach => ach.difficulty === difficulty);\r\n}\r\n\r\n// Get all achievement categories\r\nexport function getAchievementCategories() {\r\n    const categories = new Set();\r\n    Object.values(ACHIEVEMENTS).forEach(ach => categories.add(ach.category));\r\n    return Array.from(categories);\r\n}\r\n\r\n// Get achievement by ID\r\nexport function getAchievementById(id) {\r\n    return ACHIEVEMENTS[id] || null;\r\n}\r\n\r\n// Get all achievements that unlock shop items\r\nexport function getAchievementsWithUnlocks() {\r\n    return Object.values(ACHIEVEMENTS).filter(ach => ach.unlocks && ach.unlocks.length > 0);\r\n}\r\n\r\n// Calculate achievement progress (for achievements with thresholds)\r\nexport function getAchievementProgress(achievementId, stats) {\r\n    const achievement = ACHIEVEMENTS[achievementId];\r\n    if (!achievement || !achievement.threshold) {\r\n        return null;\r\n    }\r\n\r\n    const currentValue = stats[achievement.threshold.stat] || 0;\r\n    const targetValue = achievement.threshold.value;\r\n    const progress = Math.min(currentValue / targetValue, 1);\r\n\r\n    return {\r\n        current: currentValue,\r\n        target: targetValue,\r\n        progress: progress,\r\n        percentage: Math.round(progress * 100)\r\n    };\r\n}\r\n","// Unlock definitions - defines all unlockable content\r\n\r\n// Character unlocks\r\nexport const CHARACTER_UNLOCKS = {\r\n    survivor: {\r\n        name: 'The Survivor',\r\n        description: 'Balanced stats, +10% XP gain',\r\n        cost: 0,\r\n        unlockedByDefault: true,\r\n        char: '@',\r\n        color: [100, 150, 255],\r\n        stats: {\r\n            health: 100,\r\n            speed: 150,\r\n            damage: 10\r\n        },\r\n        weapon: 'pistol',\r\n        ability: 'xpBoost' // +10% XP gain\r\n    },\r\n    scout: {\r\n        name: 'The Scout',\r\n        description: 'Fast and agile, +20% speed, +10% dodge',\r\n        cost: 0, // Unlocked by completing Floor 2\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 2 },\r\n        char: '',\r\n        color: [255, 255, 100],\r\n        stats: {\r\n            health: 75,\r\n            speed: 200,\r\n            damage: 8\r\n        },\r\n        weapon: 'smg',\r\n        ability: 'speedBoost' // +20% speed, +10% dodge chance\r\n    },\r\n    tank: {\r\n        name: 'The Tank',\r\n        description: 'High health and defense, +25% health, +15% damage reduction',\r\n        cost: 0, // Unlocked by completing Floor 3\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 3 },\r\n        char: '',\r\n        color: [150, 150, 150],\r\n        stats: {\r\n            health: 150,\r\n            speed: 100,\r\n            damage: 12\r\n        },\r\n        weapon: 'shotgun',\r\n        ability: 'tankStats' // +25% health, +15% damage reduction\r\n    },\r\n    sniper: {\r\n        name: 'The Sniper',\r\n        description: 'High damage, precision-focused, +50% crit chance',\r\n        cost: 0, // Unlocked by completing Floor 3\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 3 },\r\n        char: '',\r\n        color: [100, 255, 255],\r\n        stats: {\r\n            health: 80,\r\n            speed: 120,\r\n            damage: 20\r\n        },\r\n        weapon: 'sniper',\r\n        ability: 'critBoost' // +50% crit chance, +25% crit damage (requires crit system)\r\n    },\r\n    pyro: {\r\n        name: 'The Pyro',\r\n        description: 'Fire specialist, +25% fire damage over time',\r\n        cost: 0, // Unlocked by completing Floor 2\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 2 },\r\n        char: '',\r\n        color: [255, 150, 50],\r\n        stats: {\r\n            health: 90,\r\n            speed: 150,\r\n            damage: 12\r\n        },\r\n        weapon: 'flamethrower',\r\n        ability: 'fireDot' // +25% fire DoT (requires DoT system)\r\n    },\r\n    // === NEW CHARACTERS (achievement-locked) ===\r\n    bomber: {\r\n        name: 'The Bomber',\r\n        description: 'Explosive specialist, +50% blast radius, projectiles explode on hit',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'achievement', value: 'boss10' },\r\n        char: '',\r\n        color: [255, 100, 100],\r\n        stats: {\r\n            health: 85,\r\n            speed: 130,\r\n            damage: 15\r\n        },\r\n        weapon: 'launcher',\r\n        ability: 'explosiveShots' // Projectiles explode, +50% blast radius\r\n    },\r\n    engineer: {\r\n        name: 'The Engineer',\r\n        description: 'Support class, +2 orbital drones that auto-attack nearby enemies',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'achievement', value: 'level20' },\r\n        char: '',\r\n        color: [100, 200, 255],\r\n        stats: {\r\n            health: 80,\r\n            speed: 140,\r\n            damage: 8\r\n        },\r\n        weapon: 'pistol',\r\n        ability: 'orbitalDrones' // Start with 2 orbital drones\r\n    },\r\n    vampire: {\r\n        name: 'The Vampire',\r\n        description: 'Lifesteal specialist, +15% lifesteal, -20% max health',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'achievement', value: 'kill1000' },\r\n        char: '',\r\n        color: [180, 50, 180],\r\n        stats: {\r\n            health: 70,\r\n            speed: 160,\r\n            damage: 14\r\n        },\r\n        weapon: 'smg',\r\n        ability: 'vampiric' // +15% lifesteal, -20% max health\r\n    },\r\n    berserker: {\r\n        name: 'The Berserker',\r\n        description: 'Rage mode, +100% damage below 30% HP, takes +25% more damage',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'achievement', value: 'glassCannonWin' },\r\n        char: '',\r\n        color: [255, 50, 50],\r\n        stats: {\r\n            health: 120,\r\n            speed: 140,\r\n            damage: 18\r\n        },\r\n        weapon: 'shotgun',\r\n        ability: 'rage' // +100% damage below 30% HP, +25% damage taken\r\n    },\r\n    ghost: {\r\n        name: 'The Ghost',\r\n        description: 'Evasion master, +25% dodge chance, +15% crit, lower health',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'achievement', value: 'perfectFloor' },\r\n        char: '',\r\n        color: [200, 200, 255],\r\n        stats: {\r\n            health: 60,\r\n            speed: 180,\r\n            damage: 11\r\n        },\r\n        weapon: 'smg',\r\n        ability: 'ethereal' // +25% dodge, +15% crit chance\r\n    }\r\n};\r\n\r\n// Weapon unlocks\r\nexport const WEAPON_UNLOCKS = {\r\n    default: {\r\n        name: 'Default Weapon',\r\n        description: 'Single bullet weapon',\r\n        cost: 0,\r\n        unlockedByDefault: true\r\n    },\r\n    spreadShot: {\r\n        name: 'Spread Shot',\r\n        description: 'Fires 3 projectiles in a cone, lower damage each',\r\n        cost: 250,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 2 }\r\n    },\r\n    boomerang: {\r\n        name: 'Boomerang Blaster',\r\n        description: 'Projectiles return, hitting enemies twice',\r\n        cost: 400,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 3 }\r\n    },\r\n    chainLightning: {\r\n        name: 'Chain Lightning',\r\n        description: 'Bounces to 3 nearby enemies, -20% per bounce',\r\n        cost: 500,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 3 }\r\n    },\r\n    railgun: {\r\n        name: 'Railgun',\r\n        description: 'Pierces ALL enemies in a line, 3s cooldown',\r\n        cost: 600,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 4 },\r\n        requiredAchievement: 'boss25'\r\n    },\r\n    homingMissiles: {\r\n        name: 'Homing Missiles',\r\n        description: 'Slower projectiles that track enemies',\r\n        cost: 700,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 4 }\r\n    },\r\n    plasmaRifle: {\r\n        name: 'Plasma Rifle',\r\n        description: 'High damage, penetrates 2 enemies',\r\n        cost: 800,\r\n        unlockedByDefault: false,\r\n        unlockRequirement: { type: 'floor', value: 5 },\r\n        requiredAchievement: 'floor10'\r\n    }\r\n};\r\n\r\n// Cosmetic unlocks - visual customizations (unlocked via achievements)\r\nexport const COSMETIC_UNLOCKS = {\r\n    // === Player Trails ===\r\n    trailNone: {\r\n        name: 'No Trail',\r\n        description: 'Default appearance',\r\n        cost: 0,\r\n        unlockedByDefault: true,\r\n        category: 'trail'\r\n    },\r\n    trailFire: {\r\n        name: 'Fire Trail',\r\n        description: 'Leave a blazing trail behind you',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'trail',\r\n        color: [255, 100, 50],\r\n        requiredAchievement: 'kill100'\r\n    },\r\n    trailIce: {\r\n        name: 'Ice Trail',\r\n        description: 'Leave a frosty trail behind you',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'trail',\r\n        color: [100, 200, 255],\r\n        requiredAchievement: 'floor5'\r\n    },\r\n    trailPoison: {\r\n        name: 'Toxic Trail',\r\n        description: 'Leave a poisonous trail behind you',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'trail',\r\n        color: [100, 255, 100],\r\n        requiredAchievement: 'kill500'\r\n    },\r\n    trailShadow: {\r\n        name: 'Shadow Trail',\r\n        description: 'Leave a dark trail behind you',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'trail',\r\n        color: [80, 50, 120],\r\n        requiredAchievement: 'firstSynergy'\r\n    },\r\n    trailRainbow: {\r\n        name: 'Rainbow Trail',\r\n        description: 'Leave a colorful trail behind you',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'trail',\r\n        color: 'rainbow',\r\n        requiredAchievement: 'synergyMaster'\r\n    },\r\n\r\n    // === Death Effects ===\r\n    deathNone: {\r\n        name: 'Standard Death',\r\n        description: 'Default enemy death effect',\r\n        cost: 0,\r\n        unlockedByDefault: true,\r\n        category: 'death'\r\n    },\r\n    deathExplosion: {\r\n        name: 'Explosive Death',\r\n        description: 'Enemies explode dramatically',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'death',\r\n        requiredAchievement: 'firstBoss'\r\n    },\r\n    deathDisintegrate: {\r\n        name: 'Disintegration',\r\n        description: 'Enemies crumble into particles',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'death',\r\n        requiredAchievement: 'boss5'\r\n    },\r\n    deathVaporize: {\r\n        name: 'Vaporize',\r\n        description: 'Enemies vanish in a puff of smoke',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'death',\r\n        requiredAchievement: 'killStreak10'\r\n    },\r\n    deathPixelate: {\r\n        name: 'Pixelate',\r\n        description: 'Enemies break into pixels',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'death',\r\n        requiredAchievement: 'multikill'\r\n    },\r\n    deathFireworks: {\r\n        name: 'Fireworks',\r\n        description: 'Enemies burst like fireworks',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'death',\r\n        requiredAchievement: 'floor10'\r\n    },\r\n\r\n    // === Player Glow ===\r\n    glowNone: {\r\n        name: 'No Glow',\r\n        description: 'Default appearance',\r\n        cost: 0,\r\n        unlockedByDefault: true,\r\n        category: 'glow'\r\n    },\r\n    glowGold: {\r\n        name: 'Golden Aura',\r\n        description: 'Radiate a golden glow',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'glow',\r\n        color: [255, 200, 50],\r\n        requiredAchievement: 'earn500'\r\n    },\r\n    glowCrimson: {\r\n        name: 'Crimson Aura',\r\n        description: 'Radiate a blood-red glow',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'glow',\r\n        color: [200, 50, 50],\r\n        requiredAchievement: 'closeCall'\r\n    },\r\n    glowElectric: {\r\n        name: 'Electric Aura',\r\n        description: 'Crackle with electricity',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'glow',\r\n        color: [100, 150, 255],\r\n        requiredAchievement: 'speedRunner'\r\n    },\r\n    glowVoid: {\r\n        name: 'Void Aura',\r\n        description: 'Emanate dark energy',\r\n        cost: 0,\r\n        unlockedByDefault: false,\r\n        category: 'glow',\r\n        color: [50, 0, 80],\r\n        requiredAchievement: 'perfectFloor'\r\n    }\r\n};\r\n\r\n// Run Boosters - one-time consumables for next run\r\nexport const RUN_BOOSTER_UNLOCKS = {\r\n    healthPack: {\r\n        name: 'Health Pack',\r\n        description: 'Start next run with +30 bonus HP',\r\n        cost: 30,\r\n        consumable: true,\r\n        effect: { type: 'startingHealth', value: 30 }\r\n    },\r\n    damageAmp: {\r\n        name: 'Damage Amp',\r\n        description: '+25% damage for first floor',\r\n        cost: 35,\r\n        consumable: true,\r\n        effect: { type: 'tempDamage', value: 0.25, duration: 'floor' }\r\n    },\r\n    speedSerum: {\r\n        name: 'Speed Serum',\r\n        description: '+30% speed for first floor',\r\n        cost: 25,\r\n        consumable: true,\r\n        effect: { type: 'tempSpeed', value: 0.30, duration: 'floor' }\r\n    },\r\n    wealthCharm: {\r\n        name: 'Wealth Charm',\r\n        description: '+30% credits earned this run',\r\n        cost: 50,\r\n        consumable: true,\r\n        effect: { type: 'creditMultiplier', value: 0.30, duration: 'run' }\r\n    },\r\n    luckyCoin: {\r\n        name: 'Lucky Coin',\r\n        description: '+15% crit chance for first floor',\r\n        cost: 40,\r\n        consumable: true,\r\n        effect: { type: 'tempCrit', value: 0.15, duration: 'floor' }\r\n    },\r\n    armorPlating: {\r\n        name: 'Armor Plating',\r\n        description: '+20% damage reduction for first floor',\r\n        cost: 45,\r\n        consumable: true,\r\n        effect: { type: 'tempDefense', value: 0.20, duration: 'floor' }\r\n    },\r\n    xpBooster: {\r\n        name: 'XP Booster',\r\n        description: '+50% XP gained for first floor',\r\n        cost: 40,\r\n        consumable: true,\r\n        effect: { type: 'tempXP', value: 0.50, duration: 'floor' }\r\n    },\r\n    emergencyRevive: {\r\n        name: 'Emergency Revive',\r\n        description: 'Auto-revive once at 25% HP',\r\n        cost: 75,\r\n        consumable: true,\r\n        effect: { type: 'autoRevive', value: 0.25, uses: 1 }\r\n    }\r\n};\r\n\r\n// Permanent upgrade unlocks\r\nexport const PERMANENT_UPGRADE_UNLOCKS = {\r\n    // === TIER 1: Basic Stats (cheap, essential) ===\r\n    startingHealth: {\r\n        name: 'Starting Health +10',\r\n        description: 'Start the show with +10 max health',\r\n        cost: 50,\r\n        maxLevel: 5,\r\n        tier: 1\r\n    },\r\n    startingDamage: {\r\n        name: 'Starting Damage +1',\r\n        description: 'Start the show with +1 damage',\r\n        cost: 75,\r\n        maxLevel: 5,\r\n        tier: 1\r\n    },\r\n    startingSpeed: {\r\n        name: 'Starting Speed +10',\r\n        description: 'Start the show with +10 speed',\r\n        cost: 60,\r\n        maxLevel: 5,\r\n        tier: 1\r\n    },\r\n\r\n    // === TIER 2: Utility (moderate cost) ===\r\n    xpMagnet: {\r\n        name: 'XP Magnet',\r\n        description: '+15% XP pickup radius per level',\r\n        cost: 60,\r\n        maxLevel: 5,\r\n        tier: 2\r\n    },\r\n    propDurability: {\r\n        name: 'Prop Durability',\r\n        description: 'Props last +2 seconds per level',\r\n        cost: 80,\r\n        maxLevel: 5,\r\n        tier: 2\r\n    },\r\n    propDropChance: {\r\n        name: 'Prop Drop Chance',\r\n        description: '+5% prop drop chance per level',\r\n        cost: 100,\r\n        maxLevel: 5,\r\n        tier: 2\r\n    },\r\n    creditBonus: {\r\n        name: 'Credit Bonus',\r\n        description: '+8% credits earned per level',\r\n        cost: 120,\r\n        maxLevel: 5,\r\n        tier: 2\r\n    },\r\n\r\n    // === TIER 3: Combat (higher cost) ===\r\n    luckyStart: {\r\n        name: 'Lucky Start',\r\n        description: '+5% starting crit chance per level',\r\n        cost: 100,\r\n        maxLevel: 4,\r\n        tier: 3\r\n    },\r\n    thickSkin: {\r\n        name: 'Thick Skin',\r\n        description: '+3% damage reduction per level',\r\n        cost: 100,\r\n        maxLevel: 5,\r\n        tier: 3\r\n    },\r\n    secondWind: {\r\n        name: 'Second Wind',\r\n        description: '+5% revive health per level (up to 25%)',\r\n        cost: 150,\r\n        maxLevel: 4,\r\n        tier: 3\r\n    },\r\n    bossBounty: {\r\n        name: 'Boss Bounty',\r\n        description: '+15 bonus credits per boss kill',\r\n        cost: 150,\r\n        maxLevel: 3,\r\n        tier: 3\r\n    },\r\n\r\n    // === TIER 4: Premium (expensive, powerful) ===\r\n    mulligan: {\r\n        name: 'Mulligan',\r\n        description: '+1 reroll per run for upgrade drafts',\r\n        cost: 300,\r\n        maxLevel: 3,\r\n        tier: 4\r\n    },\r\n    comfortZone: {\r\n        name: 'Comfort Zone',\r\n        description: '+0.1s invulnerability after hit',\r\n        cost: 200,\r\n        maxLevel: 3,\r\n        tier: 4\r\n    },\r\n    toughChoices: {\r\n        name: 'Tough Choices',\r\n        description: '+1 upgrade option in drafts (4 total)',\r\n        cost: 500,\r\n        maxLevel: 1,\r\n        tier: 4\r\n    },\r\n    headStart: {\r\n        name: 'Head Start',\r\n        description: 'Begin each run at level 2',\r\n        cost: 750,\r\n        maxLevel: 1,\r\n        tier: 4\r\n    }\r\n};\r\n\r\n// Get all unlocks for a category\r\nexport function getUnlocksForCategory(category) {\r\n    switch (category) {\r\n        case 'characters':\r\n            return CHARACTER_UNLOCKS;\r\n        case 'weapons':\r\n            return WEAPON_UNLOCKS;\r\n        case 'permanentUpgrades':\r\n            return PERMANENT_UPGRADE_UNLOCKS;\r\n        case 'cosmetics':\r\n            return COSMETIC_UNLOCKS;\r\n        case 'boosters':\r\n            return RUN_BOOSTER_UNLOCKS;\r\n        default:\r\n            return {};\r\n    }\r\n}\r\n\r\n// Get unlock info\r\nexport function getUnlockInfo(category, key) {\r\n    const unlocks = getUnlocksForCategory(category);\r\n    return unlocks[key] || null;\r\n}\r\n\r\n// Get cosmetics by sub-category (trail, death, glow)\r\nexport function getCosmeticsByType(type) {\r\n    return Object.entries(COSMETIC_UNLOCKS)\r\n        .filter(([key, item]) => item.category === type)\r\n        .reduce((acc, [key, item]) => ({ ...acc, [key]: item }), {});\r\n}\r\n\r\n","// Meta progression system - handles currency, saves, and unlocks\r\n\r\nimport { generateRandomName, generateInviteCode } from './nameGenerator.js';\r\nimport { getAchievementReward, getAchievementById } from '../data/achievements.js';\r\nimport { CHARACTER_UNLOCKS, getUnlockInfo } from '../data/unlocks.js';\r\n\r\nconst STORAGE_KEY = 'superSmashTexty_save';\r\nconst CURRENCY_NAME = 'Credits'; // Full name (rarely used)\r\nconst CURRENCY_ICON = '$'; // Icon used for display\r\n\r\n// Default save data structure\r\nconst DEFAULT_SAVE = {\r\n    version: 1,\r\n    currency: 0,\r\n    playerName: null, // Will be generated on first load\r\n    inviteCode: null, // Will be generated on first load\r\n    // Player XP/Level system (cosmetic prestige)\r\n    totalXP: 0,\r\n    playerLevel: 1,\r\n    selectedPortrait: 'default',\r\n    unlocks: {\r\n        characters: ['survivor'], // Default character is always unlocked\r\n        weapons: ['default'], // Default weapon is always unlocked\r\n        permanentUpgrades: [], // Array of unlock keys\r\n        portraits: ['default'] // Default portrait is always unlocked\r\n    },\r\n    permanentUpgradeLevels: {}, // Track levels for permanent upgrades: { upgradeKey: level }\r\n    permanentUpgradePurchaseHistory: {}, // Track purchase costs: { upgradeKey: [cost1, cost2, ...] }\r\n    stats: {\r\n        totalRuns: 0,\r\n        totalFloorsReached: 0,\r\n        totalRoomsCleared: 0,\r\n        totalEnemiesKilled: 0,\r\n        totalBossesKilled: 0,\r\n        bestFloor: 1,\r\n        bestRoom: 1,\r\n        bestLevel: 1,\r\n        totalCurrencyEarned: 0,\r\n        totalPlayTime: 0, // Total play time in seconds\r\n        fastestRunTime: 0 // Fastest run completion time in seconds\r\n    },\r\n    achievements: [], // Array of unlocked achievement IDs\r\n    runHistory: [] // Array of last 20 run records\r\n};\r\n\r\n// Maximum number of runs to store in history\r\nconst MAX_RUN_HISTORY = 20;\r\n\r\n// Load save data from localStorage\r\nexport function loadSave() {\r\n    try {\r\n        const saved = localStorage.getItem(STORAGE_KEY);\r\n        if (saved) {\r\n            const data = JSON.parse(saved);\r\n            // Merge with default to handle missing fields\r\n            const mergedData = { ...DEFAULT_SAVE, ...data };\r\n\r\n            // Generate player name if not set\r\n            if (!mergedData.playerName) {\r\n                mergedData.playerName = generateRandomName();\r\n                saveGame(mergedData);\r\n            }\r\n\r\n            // Generate invite code if not set\r\n            if (!mergedData.inviteCode) {\r\n                mergedData.inviteCode = generateInviteCode();\r\n                saveGame(mergedData);\r\n            }\r\n\r\n            return mergedData;\r\n        }\r\n    } catch (e) {\r\n        console.error('Error loading save:', e);\r\n    }\r\n\r\n    // First time load - generate name and code\r\n    const newSave = { ...DEFAULT_SAVE };\r\n    newSave.playerName = generateRandomName();\r\n    newSave.inviteCode = generateInviteCode();\r\n    saveGame(newSave);\r\n    return newSave;\r\n}\r\n\r\n// Save data to localStorage\r\nexport function saveGame(data) {\r\n    try {\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\r\n        return true;\r\n    } catch (e) {\r\n        console.error('Error saving game:', e);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Get current save data\r\nexport function getSaveData() {\r\n    return loadSave();\r\n}\r\n\r\n// Add currency to save\r\nexport function addCurrency(amount) {\r\n    const save = loadSave();\r\n    // Cap currency at Number.MAX_SAFE_INTEGER to prevent overflow\r\n    save.currency = Math.min(Number.MAX_SAFE_INTEGER, save.currency + amount);\r\n    saveGame(save);\r\n    return save.currency;\r\n}\r\n\r\n// Get current currency\r\nexport function getCurrency() {\r\n    return loadSave().currency;\r\n}\r\n\r\n// Check if something is unlocked\r\nexport function isUnlocked(category, item) {\r\n    const save = loadSave();\r\n    return save.unlocks[category] && save.unlocks[category].includes(item);\r\n}\r\n\r\n// Unlock an item\r\nexport function unlockItem(category, item) {\r\n    const save = loadSave();\r\n    if (!save.unlocks[category]) {\r\n        save.unlocks[category] = [];\r\n    }\r\n    if (!save.unlocks[category].includes(item)) {\r\n        save.unlocks[category].push(item);\r\n        saveGame(save);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n// Check and unlock characters based on floor completion\r\nexport function checkFloorUnlocks(floorCompleted) {\r\n    const save = loadSave();\r\n    let unlocked = false;\r\n\r\n    for (const [key, char] of Object.entries(CHARACTER_UNLOCKS)) {\r\n        if (char.unlockRequirement &&\r\n            char.unlockRequirement.type === 'floor' &&\r\n            floorCompleted >= char.unlockRequirement.value) {\r\n            if (!isUnlocked('characters', key)) {\r\n                unlockItem('characters', key);\r\n                unlocked = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    return unlocked;\r\n}\r\n\r\n// Check and unlock characters based on achievement completion\r\n// Call this after unlocking an achievement\r\nexport function checkAchievementUnlocks(achievementId) {\r\n    let unlocked = [];\r\n\r\n    for (const [key, char] of Object.entries(CHARACTER_UNLOCKS)) {\r\n        if (char.unlockRequirement &&\r\n            char.unlockRequirement.type === 'achievement' &&\r\n            char.unlockRequirement.value === achievementId) {\r\n            if (!isUnlocked('characters', key)) {\r\n                unlockItem('characters', key);\r\n                unlocked.push({ type: 'character', key, name: char.name });\r\n            }\r\n        }\r\n    }\r\n\r\n    return unlocked;\r\n}\r\n\r\n// Check if a character is unlocked (handles both floor and achievement requirements)\r\nexport function isCharacterUnlocked(characterKey) {\r\n    // First check if explicitly unlocked in save data\r\n    if (isUnlocked('characters', characterKey)) {\r\n        return true;\r\n    }\r\n\r\n    // Import CHARACTER_UNLOCKS synchronously (already loaded)\r\n    // This is a convenience function - for async contexts use checkAchievementUnlocks\r\n    return false; // If not in save data, it's not unlocked\r\n}\r\n\r\n// Get selected character (stored in save)\r\nexport function getSelectedCharacter() {\r\n    const save = loadSave();\r\n    return save.selectedCharacter || 'survivor';\r\n}\r\n\r\n// Set selected character\r\nexport function setSelectedCharacter(characterKey) {\r\n    const save = loadSave();\r\n    save.selectedCharacter = characterKey;\r\n    saveGame(save);\r\n}\r\n\r\n// Get permanent upgrade level\r\nexport function getPermanentUpgradeLevel(upgradeKey) {\r\n    const save = loadSave();\r\n    if (!save.permanentUpgradeLevels) {\r\n        save.permanentUpgradeLevels = {};\r\n    }\r\n    return save.permanentUpgradeLevels[upgradeKey] || 0;\r\n}\r\n\r\n// Purchase an unlock with currency\r\nexport function purchaseUnlock(category, item, cost) {\r\n    const save = loadSave();\r\n    if (save.currency >= cost) {\r\n        save.currency -= cost;\r\n        // Unlock the item\r\n        if (!save.unlocks[category]) {\r\n            save.unlocks[category] = [];\r\n        }\r\n        if (!save.unlocks[category].includes(item)) {\r\n            save.unlocks[category].push(item);\r\n        }\r\n        saveGame(save);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n// Calculate escalating price for permanent upgrades (same as shop.js)\r\nfunction getUpgradePrice(level) {\r\n    // Level 1 = $50, Level 2 = $65, Level 3 = $90, Level 4 = $115, Level 5 = $160\r\n    const prices = [50, 65, 90, 115, 160];\r\n    if (level < prices.length) {\r\n        return prices[level];\r\n    }\r\n    // For levels beyond 5, increase by 50 each level\r\n    return 160 + (level - 4) * 50;\r\n}\r\n\r\n// Purchase a permanent upgrade (handles level tracking)\r\nexport function purchasePermanentUpgrade(upgradeKey, cost, maxLevel) {\r\n    const save = loadSave();\r\n    const currentLevel = getPermanentUpgradeLevel(upgradeKey);\r\n    \r\n    // Check if already at max level\r\n    if (maxLevel && currentLevel >= maxLevel) {\r\n        return { success: false, reason: 'maxLevel' };\r\n    }\r\n    \r\n    // Check if enough currency\r\n    if (save.currency < cost) {\r\n        return { success: false, reason: 'insufficientCurrency' };\r\n    }\r\n    \r\n    // Purchase\r\n    save.currency -= cost;\r\n    if (!save.permanentUpgradeLevels) {\r\n        save.permanentUpgradeLevels = {};\r\n    }\r\n    save.permanentUpgradeLevels[upgradeKey] = (currentLevel || 0) + 1;\r\n    \r\n    // Track purchase cost for refund purposes\r\n    if (!save.permanentUpgradePurchaseHistory) {\r\n        save.permanentUpgradePurchaseHistory = {};\r\n    }\r\n    if (!save.permanentUpgradePurchaseHistory[upgradeKey]) {\r\n        save.permanentUpgradePurchaseHistory[upgradeKey] = [];\r\n    }\r\n    save.permanentUpgradePurchaseHistory[upgradeKey].push(cost);\r\n    \r\n    // Also add to unlocks if first purchase\r\n    if (!save.unlocks.permanentUpgrades) {\r\n        save.unlocks.permanentUpgrades = [];\r\n    }\r\n    if (!save.unlocks.permanentUpgrades.includes(upgradeKey)) {\r\n        save.unlocks.permanentUpgrades.push(upgradeKey);\r\n    }\r\n    \r\n    saveGame(save);\r\n    return { success: true, newLevel: save.permanentUpgradeLevels[upgradeKey] };\r\n}\r\n\r\n// ============ BOOSTER FUNCTIONS ============\r\n\r\n/**\r\n * Purchase a run booster (consumable)\r\n * @param {string} boosterKey - The booster to purchase\r\n * @param {number} cost - The cost of the booster\r\n * @returns {Object} Result object with success status\r\n */\r\nexport function purchaseBooster(boosterKey, cost) {\r\n    const save = loadSave();\r\n\r\n    // Check if player has enough currency\r\n    if (save.currency < cost) {\r\n        return { success: false, reason: 'insufficientCurrency' };\r\n    }\r\n\r\n    // Initialize boosters array if needed\r\n    if (!save.activeBoosters) {\r\n        save.activeBoosters = [];\r\n    }\r\n\r\n    // Deduct currency\r\n    save.currency -= cost;\r\n\r\n    // Track currency spent in stats\r\n    if (save.stats) {\r\n        save.stats.totalCurrencySpent = (save.stats.totalCurrencySpent || 0) + cost;\r\n    }\r\n\r\n    // Add booster to active boosters\r\n    save.activeBoosters.push({\r\n        key: boosterKey,\r\n        purchasedAt: Date.now()\r\n    });\r\n\r\n    saveGame(save);\r\n    return { success: true, boosterKey };\r\n}\r\n\r\n/**\r\n * Get count of active boosters\r\n * @returns {number} Number of active boosters ready to use\r\n */\r\nexport function getActiveBoostersCount() {\r\n    const save = loadSave();\r\n    return (save.activeBoosters || []).length;\r\n}\r\n\r\n/**\r\n * Get all active boosters\r\n * @returns {Array} Array of active booster objects\r\n */\r\nexport function getActiveBoosters() {\r\n    const save = loadSave();\r\n    return save.activeBoosters || [];\r\n}\r\n\r\n/**\r\n * Consume all active boosters for a run\r\n * @returns {Array} Array of consumed booster effects\r\n */\r\nexport function consumeBoosters() {\r\n    const save = loadSave();\r\n    const boosters = save.activeBoosters || [];\r\n\r\n    // Clear boosters\r\n    save.activeBoosters = [];\r\n    saveGame(save);\r\n\r\n    return boosters;\r\n}\r\n\r\n/**\r\n * Clear a specific booster (refund not included - just removes it)\r\n * @param {number} index - Index of booster to clear\r\n */\r\nexport function clearBooster(index) {\r\n    const save = loadSave();\r\n    if (save.activeBoosters && index >= 0 && index < save.activeBoosters.length) {\r\n        save.activeBoosters.splice(index, 1);\r\n        saveGame(save);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n// Calculate total refundable credits for all permanent upgrades\r\nexport function getTotalRefundableCredits() {\r\n    const save = loadSave();\r\n    \r\n    // If purchase history exists, use it (most accurate)\r\n    if (save.permanentUpgradePurchaseHistory && Object.keys(save.permanentUpgradePurchaseHistory).length > 0) {\r\n        let total = 0;\r\n        Object.keys(save.permanentUpgradePurchaseHistory).forEach(upgradeKey => {\r\n            const purchaseHistory = save.permanentUpgradePurchaseHistory[upgradeKey];\r\n            if (purchaseHistory && Array.isArray(purchaseHistory)) {\r\n                purchaseHistory.forEach(cost => {\r\n                    total += cost;\r\n                });\r\n            }\r\n        });\r\n        return total;\r\n    }\r\n    \r\n    // Fallback: Calculate retroactively from current levels (for existing saves)\r\n    if (save.permanentUpgradeLevels && Object.keys(save.permanentUpgradeLevels).length > 0) {\r\n        let total = 0;\r\n        Object.keys(save.permanentUpgradeLevels).forEach(upgradeKey => {\r\n            const level = save.permanentUpgradeLevels[upgradeKey] || 0;\r\n            // Calculate what was paid for each level (0 to level-1)\r\n            for (let i = 0; i < level; i++) {\r\n                total += getUpgradePrice(i);\r\n            }\r\n        });\r\n        return total;\r\n    }\r\n    \r\n    return 0;\r\n}\r\n\r\n// Refund a single level of a specific permanent upgrade\r\nexport function refundSinglePermanentUpgrade(upgradeKey) {\r\n    const save = loadSave();\r\n    const currentLevel = getPermanentUpgradeLevel(upgradeKey);\r\n    \r\n    // Check if upgrade has any levels to refund\r\n    if (currentLevel === 0) {\r\n        return { success: false, reason: 'noLevels' };\r\n    }\r\n    \r\n    // Get refund amount from purchase history (most accurate)\r\n    let refundAmount = 0;\r\n    if (save.permanentUpgradePurchaseHistory && \r\n        save.permanentUpgradePurchaseHistory[upgradeKey] && \r\n        save.permanentUpgradePurchaseHistory[upgradeKey].length > 0) {\r\n        // Refund the last purchase (most recent level)\r\n        const purchaseHistory = save.permanentUpgradePurchaseHistory[upgradeKey];\r\n        refundAmount = purchaseHistory[purchaseHistory.length - 1];\r\n        // Remove the last entry\r\n        purchaseHistory.pop();\r\n        if (purchaseHistory.length === 0) {\r\n            delete save.permanentUpgradePurchaseHistory[upgradeKey];\r\n        }\r\n    } else {\r\n        // Fallback: Calculate price for the level being refunded (level-1 to level-2)\r\n        refundAmount = getUpgradePrice(currentLevel - 1);\r\n    }\r\n    \r\n    // Return credits\r\n    save.currency += refundAmount;\r\n    \r\n    // Decrease level by 1\r\n    save.permanentUpgradeLevels[upgradeKey] = currentLevel - 1;\r\n    \r\n    // If level becomes 0, remove from unlocks\r\n    if (save.permanentUpgradeLevels[upgradeKey] === 0) {\r\n        delete save.permanentUpgradeLevels[upgradeKey];\r\n        if (save.unlocks.permanentUpgrades) {\r\n            const index = save.unlocks.permanentUpgrades.indexOf(upgradeKey);\r\n            if (index > -1) {\r\n                save.unlocks.permanentUpgrades.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n    \r\n    saveGame(save);\r\n    return { success: true, refundAmount, newLevel: save.permanentUpgradeLevels[upgradeKey] || 0 };\r\n}\r\n\r\n// Refund all permanent upgrades (returns credits and resets levels)\r\nexport function refundAllPermanentUpgrades() {\r\n    const save = loadSave();\r\n    const refundAmount = getTotalRefundableCredits();\r\n    \r\n    if (refundAmount === 0) {\r\n        return { success: false, reason: 'noUpgrades' };\r\n    }\r\n    \r\n    // Return credits\r\n    save.currency += refundAmount;\r\n    \r\n    // Reset upgrade levels\r\n    save.permanentUpgradeLevels = {};\r\n    \r\n    // Clear purchase history\r\n    save.permanentUpgradePurchaseHistory = {};\r\n    \r\n    // Remove from unlocks (but keep the array structure)\r\n    if (save.unlocks.permanentUpgrades) {\r\n        save.unlocks.permanentUpgrades = [];\r\n    }\r\n    \r\n    saveGame(save);\r\n    return { success: true, refundAmount };\r\n}\r\n\r\n// Update run statistics\r\nexport function updateRunStats(runStats) {\r\n    const save = loadSave();\r\n    save.stats.totalRuns++;\r\n    save.stats.totalFloorsReached += runStats.floorsReached || 0;\r\n    save.stats.totalRoomsCleared += runStats.roomsCleared || 0;\r\n    save.stats.totalEnemiesKilled += runStats.enemiesKilled || 0;\r\n    save.stats.totalBossesKilled += runStats.bossesKilled || 0;\r\n    save.stats.totalCurrencyEarned += runStats.currencyEarned || 0;\r\n    \r\n    if (runStats.floorsReached > save.stats.bestFloor) {\r\n        save.stats.bestFloor = runStats.floorsReached;\r\n    }\r\n    if (runStats.roomsCleared > save.stats.bestRoom) {\r\n        save.stats.bestRoom = runStats.roomsCleared;\r\n    }\r\n    if (runStats.level > save.stats.bestLevel) {\r\n        save.stats.bestLevel = runStats.level || 1;\r\n    }\r\n    \r\n    saveGame(save);\r\n}\r\n\r\n// Check if achievement is unlocked\r\nexport function isAchievementUnlocked(achievementId) {\r\n    const save = loadSave();\r\n    if (!save.achievements) {\r\n        save.achievements = [];\r\n    }\r\n    return save.achievements.includes(achievementId);\r\n}\r\n\r\n// Unlock an achievement\r\nexport function unlockAchievement(achievementId) {\r\n    const save = loadSave();\r\n    if (!save.achievements) {\r\n        save.achievements = [];\r\n    }\r\n    if (!save.achievements.includes(achievementId)) {\r\n        save.achievements.push(achievementId);\r\n\r\n        // Award credit reward for the achievement\r\n        const achievement = getAchievementById(achievementId);\r\n        const reward = getAchievementReward(achievement);\r\n        if (reward > 0) {\r\n            save.currency = Math.min(Number.MAX_SAFE_INTEGER, save.currency + reward);\r\n            console.log(`[MetaProgression] Achievement \"${achievementId}\" awarded ${reward} credits`);\r\n        }\r\n\r\n        saveGame(save);\r\n\r\n        // Check if this achievement unlocks any characters\r\n        checkAchievementUnlocks(achievementId).then(unlockedChars => {\r\n            if (unlockedChars.length > 0) {\r\n                console.log('[MetaProgression] Achievement unlocked characters:', unlockedChars);\r\n            }\r\n        });\r\n\r\n        return true; // Newly unlocked\r\n    }\r\n    return false; // Already unlocked\r\n}\r\n\r\n// Get all unlocked achievements\r\nexport function getUnlockedAchievements() {\r\n    const save = loadSave();\r\n    return save.achievements || [];\r\n}\r\n\r\n// Get save statistics\r\nexport function getSaveStats() {\r\n    const save = loadSave();\r\n    return save.stats || DEFAULT_SAVE.stats;\r\n}\r\n\r\n// Calculate currency earned from a run\r\nexport function calculateCurrencyEarned(runStats) {\r\n    let currency = 0;\r\n\r\n    // Base currency per floor reached\r\n    currency += runStats.floorsReached * 10;\r\n\r\n    // Currency per room cleared\r\n    currency += runStats.roomsCleared * 5;\r\n\r\n    // Currency per enemy killed (small amount)\r\n    currency += Math.floor(runStats.enemiesKilled * 0.5);\r\n\r\n    // Bonus for reaching higher floors\r\n    if (runStats.floorsReached >= 2) {\r\n        currency += 10; // Floor 2 bonus\r\n    }\r\n    if (runStats.floorsReached >= 3) {\r\n        currency += 20; // Floor 3 bonus\r\n    }\r\n    if (runStats.floorsReached >= 4) {\r\n        currency += 30; // Floor 4+ bonus\r\n    }\r\n\r\n    // Performance bonus: more enemies killed = bonus\r\n    if (runStats.enemiesKilled >= 50) {\r\n        currency += 10;\r\n    }\r\n    if (runStats.enemiesKilled >= 100) {\r\n        currency += 20;\r\n    }\r\n    if (runStats.enemiesKilled >= 200) {\r\n        currency += 30;\r\n    }\r\n\r\n    // Boss Bounty upgrade: +15 credits per boss killed per level\r\n    const bossBountyLevel = getPermanentUpgradeLevel('bossBounty');\r\n    if (bossBountyLevel > 0 && runStats.bossesKilled > 0) {\r\n        currency += runStats.bossesKilled * bossBountyLevel * 15;\r\n    }\r\n\r\n    // Credit Bonus upgrade: +8% credits per level\r\n    const creditBonusLevel = getPermanentUpgradeLevel('creditBonus');\r\n    if (creditBonusLevel > 0) {\r\n        currency = Math.floor(currency * (1 + creditBonusLevel * 0.08));\r\n    }\r\n\r\n    return Math.floor(currency);\r\n}\r\n\r\n// Get currency name (returns icon for display)\r\nexport function getCurrencyName() {\r\n    return CURRENCY_ICON;\r\n}\r\n\r\n// Get currency icon (same as getCurrencyName for backward compatibility)\r\nexport function getCurrencyIcon() {\r\n    return CURRENCY_ICON;\r\n}\r\n\r\n// Get player name\r\nexport function getPlayerName() {\r\n    const save = loadSave();\r\n    return save.playerName || 'Player';\r\n}\r\n\r\n// Set player name\r\nexport function setPlayerName(name) {\r\n    const save = loadSave();\r\n    save.playerName = name;\r\n    saveGame(save);\r\n    return save.playerName;\r\n}\r\n\r\n// Get invite code\r\nexport function getInviteCode() {\r\n    const save = loadSave();\r\n    return save.inviteCode || '000000';\r\n}\r\n\r\n// Set invite code\r\nexport function setInviteCode(code) {\r\n    const save = loadSave();\r\n    save.inviteCode = code;\r\n    saveGame(save);\r\n    return save.inviteCode;\r\n}\r\n\r\n// Reset save (for testing/debugging)\r\nexport function resetSave() {\r\n    localStorage.removeItem(STORAGE_KEY);\r\n    return { ...DEFAULT_SAVE };\r\n}\r\n\r\n/**\r\n * Record a completed run to history\r\n * @param {Object} runData - Run data to record\r\n * @param {string} runData.character - Character used\r\n * @param {string} runData.weapon - Weapon used\r\n * @param {number} runData.floorsReached - Floors reached\r\n * @param {number} runData.roomsCleared - Rooms cleared\r\n * @param {number} runData.enemiesKilled - Enemies killed\r\n * @param {number} runData.bossesKilled - Bosses killed\r\n * @param {number} runData.level - Final player level\r\n * @param {number} runData.currencyEarned - Currency earned\r\n * @param {number} runData.duration - Run duration in seconds\r\n * @param {string} runData.deathCause - What killed the player\r\n * @param {Array} runData.upgrades - Upgrades collected\r\n * @param {Array} runData.synergies - Synergies activated\r\n */\r\nexport function recordRun(runData) {\r\n    const save = loadSave();\r\n\r\n    // Ensure runHistory array exists\r\n    if (!save.runHistory) {\r\n        save.runHistory = [];\r\n    }\r\n\r\n    // Create run record\r\n    const runRecord = {\r\n        timestamp: Date.now(),\r\n        character: runData.character || 'survivor',\r\n        weapon: runData.weapon || 'pistol',\r\n        floorsReached: runData.floorsReached || 1,\r\n        roomsCleared: runData.roomsCleared || 0,\r\n        enemiesKilled: runData.enemiesKilled || 0,\r\n        bossesKilled: runData.bossesKilled || 0,\r\n        level: runData.level || 1,\r\n        currencyEarned: runData.currencyEarned || 0,\r\n        duration: runData.duration || 0,\r\n        deathCause: runData.deathCause || 'Unknown',\r\n        upgrades: runData.upgrades || [],\r\n        synergies: runData.synergies || []\r\n    };\r\n\r\n    // Add to history (most recent first)\r\n    save.runHistory.unshift(runRecord);\r\n\r\n    // Keep only last MAX_RUN_HISTORY runs\r\n    if (save.runHistory.length > MAX_RUN_HISTORY) {\r\n        save.runHistory = save.runHistory.slice(0, MAX_RUN_HISTORY);\r\n    }\r\n\r\n    saveGame(save);\r\n    return runRecord;\r\n}\r\n\r\n/**\r\n * Get run history\r\n * @returns {Array} Array of run records (most recent first)\r\n */\r\nexport function getRunHistory() {\r\n    const save = loadSave();\r\n    return save.runHistory || [];\r\n}\r\n\r\n/**\r\n * Check if a shop item's achievement requirement is met\r\n * @param {string} category - Category of the item ('characters', 'weapons', 'permanentUpgrades')\r\n * @param {string} itemKey - Key of the item to check\r\n * @returns {boolean} True if achievement requirement is met (or no requirement exists)\r\n */\r\nexport function isShopItemAchievementUnlocked(category, itemKey) {\r\n    const unlockInfo = getUnlockInfo(category, itemKey);\r\n\r\n    if (!unlockInfo || !unlockInfo.requiredAchievement) {\r\n        return true; // No achievement requirement\r\n    }\r\n\r\n    return isAchievementUnlocked(unlockInfo.requiredAchievement);\r\n}\r\n\r\n/**\r\n * Get the required achievement info for a shop item\r\n * @param {string} category - Category of the item\r\n * @param {string} itemKey - Key of the item\r\n * @returns {Object|null} Achievement info or null if no requirement\r\n */\r\nexport function getRequiredAchievementForItem(category, itemKey) {\r\n    const unlockInfo = getUnlockInfo(category, itemKey);\r\n\r\n    if (!unlockInfo || !unlockInfo.requiredAchievement) {\r\n        return null;\r\n    }\r\n\r\n    const achievement = getAchievementById(unlockInfo.requiredAchievement);\r\n    return achievement;\r\n}\r\n\r\n/**\r\n * Synchronous version - Check if a shop item's achievement requirement is met\r\n * Use this when you already have the unlock info\r\n * @param {Object} unlockInfo - Unlock info object (must have requiredAchievement field if required)\r\n * @returns {boolean} True if achievement requirement is met (or no requirement exists)\r\n */\r\nexport function isItemAchievementUnlockedSync(unlockInfo) {\r\n    if (!unlockInfo || !unlockInfo.requiredAchievement) {\r\n        return true; // No achievement requirement\r\n    }\r\n\r\n    return isAchievementUnlocked(unlockInfo.requiredAchievement);\r\n}\r\n\r\n// ============ COSMETIC FUNCTIONS ============\r\n\r\n/**\r\n * Get the equipped cosmetic of a specific type\r\n * @param {string} type - Type of cosmetic (trail, death, glow)\r\n * @returns {string} Key of the equipped cosmetic, or default\r\n */\r\nexport function getEquippedCosmetic(type) {\r\n    const save = loadSave();\r\n    if (!save.equippedCosmetics) {\r\n        return type === 'trail' ? 'trailNone' : type === 'death' ? 'deathNone' : 'glowNone';\r\n    }\r\n    return save.equippedCosmetics[type] || (type === 'trail' ? 'trailNone' : type === 'death' ? 'deathNone' : 'glowNone');\r\n}\r\n\r\n/**\r\n * Set the equipped cosmetic of a specific type\r\n * @param {string} type - Type of cosmetic (trail, death, glow)\r\n * @param {string} key - Key of the cosmetic to equip\r\n * @returns {boolean} True if successful\r\n */\r\nexport function setEquippedCosmetic(type, key) {\r\n    const save = loadSave();\r\n\r\n    // Initialize cosmetics object if needed\r\n    if (!save.equippedCosmetics) {\r\n        save.equippedCosmetics = {\r\n            trail: 'trailNone',\r\n            death: 'deathNone',\r\n            glow: 'glowNone'\r\n        };\r\n    }\r\n\r\n    // Check if the cosmetic is owned (either default or purchased)\r\n    if (!key.includes('None') && !isUnlocked('cosmetics', key)) {\r\n        return false; // Can't equip what you don't own\r\n    }\r\n\r\n    save.equippedCosmetics[type] = key;\r\n    saveGame(save);\r\n    return true;\r\n}\r\n\r\n/**\r\n * Get all equipped cosmetics\r\n * @returns {Object} Object with trail, death, glow keys\r\n */\r\nexport function getEquippedCosmetics() {\r\n    const save = loadSave();\r\n    return save.equippedCosmetics || {\r\n        trail: 'trailNone',\r\n        death: 'deathNone',\r\n        glow: 'glowNone'\r\n    };\r\n}\r\n\r\n// ============ PLAYER XP/LEVEL SYSTEM ============\r\n\r\n/**\r\n * Calculate player level from total XP\r\n * Formula: level = floor(sqrt(totalXP / 100)) + 1\r\n * - Level 1: 0 XP\r\n * - Level 2: 100 XP\r\n * - Level 5: 1,600 XP\r\n * - Level 10: 8,100 XP\r\n * - Level 20: 36,100 XP\r\n * - Level 50: 240,100 XP\r\n * @param {number} xp - Total XP\r\n * @returns {number} Player level\r\n */\r\nexport function calculateLevelFromXP(xp) {\r\n    return Math.floor(Math.sqrt(xp / 100)) + 1;\r\n}\r\n\r\n/**\r\n * Calculate XP required for a specific level\r\n * @param {number} level - Target level\r\n * @returns {number} Total XP required to reach that level\r\n */\r\nexport function getXPRequiredForLevel(level) {\r\n    if (level <= 1) return 0;\r\n    return Math.pow(level - 1, 2) * 100;\r\n}\r\n\r\n/**\r\n * Get current player level\r\n * @returns {number} Current level\r\n */\r\nexport function getPlayerLevel() {\r\n    const save = loadSave();\r\n    return calculateLevelFromXP(save.totalXP || 0);\r\n}\r\n\r\n/**\r\n * Get total XP earned\r\n * @returns {number} Total XP\r\n */\r\nexport function getTotalXP() {\r\n    const save = loadSave();\r\n    return save.totalXP || 0;\r\n}\r\n\r\n/**\r\n * Get XP required for next level\r\n * @returns {number} XP needed for next level\r\n */\r\nexport function getXPForNextLevel() {\r\n    const currentLevel = getPlayerLevel();\r\n    return getXPRequiredForLevel(currentLevel + 1);\r\n}\r\n\r\n/**\r\n * Get XP progress towards next level (0-1)\r\n * @returns {number} Progress percentage (0-1)\r\n */\r\nexport function getXPProgress() {\r\n    const totalXP = getTotalXP();\r\n    const currentLevel = calculateLevelFromXP(totalXP);\r\n    const currentLevelXP = getXPRequiredForLevel(currentLevel);\r\n    const nextLevelXP = getXPRequiredForLevel(currentLevel + 1);\r\n\r\n    if (nextLevelXP === currentLevelXP) return 1;\r\n    return (totalXP - currentLevelXP) / (nextLevelXP - currentLevelXP);\r\n}\r\n\r\n/**\r\n * Add XP to player and check for level ups\r\n * @param {number} amount - XP to add\r\n * @returns {Object} Result with newXP, newLevel, levelsGained\r\n */\r\nexport function addXP(amount) {\r\n    const save = loadSave();\r\n    const oldLevel = calculateLevelFromXP(save.totalXP || 0);\r\n\r\n    save.totalXP = (save.totalXP || 0) + amount;\r\n    const newLevel = calculateLevelFromXP(save.totalXP);\r\n\r\n    // Update stored level\r\n    save.playerLevel = newLevel;\r\n\r\n    saveGame(save);\r\n\r\n    return {\r\n        newXP: save.totalXP,\r\n        newLevel: newLevel,\r\n        levelsGained: newLevel - oldLevel,\r\n        oldLevel: oldLevel\r\n    };\r\n}\r\n\r\n/**\r\n * Calculate XP earned from a run\r\n * @param {Object} runStats - Run statistics\r\n * @returns {number} XP earned\r\n */\r\nexport function calculateRunXP(runStats) {\r\n    let xp = 0;\r\n\r\n    // Floors reached: 50 XP per floor\r\n    xp += (runStats.floorsReached || 0) * 50;\r\n\r\n    // Enemies killed: 2 XP each\r\n    xp += (runStats.enemiesKilled || 0) * 2;\r\n\r\n    // Bosses killed: 100 XP each\r\n    xp += (runStats.bossesKilled || 0) * 100;\r\n\r\n    // Run completion bonus (reached floor 5+): 200 XP\r\n    if ((runStats.floorsReached || 0) >= 5) {\r\n        xp += 200;\r\n    }\r\n\r\n    // Daily run completion bonus: 500 XP\r\n    if (runStats.isDailyRun) {\r\n        xp += 500;\r\n    }\r\n\r\n    return xp;\r\n}\r\n\r\n// ============ PORTRAIT SYSTEM ============\r\n\r\n/**\r\n * Get selected portrait ID\r\n * @returns {string} Portrait ID\r\n */\r\nexport function getSelectedPortrait() {\r\n    const save = loadSave();\r\n    return save.selectedPortrait || 'default';\r\n}\r\n\r\n/**\r\n * Set selected portrait\r\n * @param {string} portraitId - Portrait ID to select\r\n * @returns {boolean} True if successful\r\n * Note: Caller should verify portrait is unlocked before calling this\r\n */\r\nexport function setSelectedPortrait(portraitId) {\r\n    const save = loadSave();\r\n    save.selectedPortrait = portraitId;\r\n    saveGame(save);\r\n    return true;\r\n}\r\n\r\n/**\r\n * Check if a portrait is unlocked\r\n * @param {string} portraitId - Portrait ID to check\r\n * @returns {boolean} True if unlocked\r\n */\r\nexport function isPortraitUnlocked(portraitId) {\r\n    const save = loadSave();\r\n\r\n    // Default portrait is always unlocked\r\n    if (portraitId === 'default') return true;\r\n\r\n    // Check unlocks array\r\n    if (save.unlocks?.portraits?.includes(portraitId)) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n/**\r\n * Unlock a portrait\r\n * @param {string} portraitId - Portrait ID to unlock\r\n * @returns {boolean} True if newly unlocked\r\n */\r\nexport function unlockPortrait(portraitId) {\r\n    const save = loadSave();\r\n\r\n    if (!save.unlocks.portraits) {\r\n        save.unlocks.portraits = ['default'];\r\n    }\r\n\r\n    if (!save.unlocks.portraits.includes(portraitId)) {\r\n        save.unlocks.portraits.push(portraitId);\r\n        saveGame(save);\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n/**\r\n * Get all unlocked portraits\r\n * @returns {Array} Array of unlocked portrait IDs\r\n */\r\nexport function getUnlockedPortraits() {\r\n    const save = loadSave();\r\n    return save.unlocks?.portraits || ['default'];\r\n}\r\n\r\n","/**\r\n * Input System\r\n * Handles gamepad controllers (Backbone, Xbox, PlayStation, etc.) and touch controls\r\n *\r\n * Features:\r\n * - Gamepad support with dual analog sticks\r\n * - Virtual touch joysticks for mobile devices\r\n * - Left stick/joystick for movement\r\n * - Right stick/joystick for aiming and auto-fire\r\n */\r\n\r\n// Deadzone for analog sticks (ignore small movements)\r\nconst STICK_DEADZONE = 0.15;\r\n\r\n// Touch joystick configuration\r\nconst JOYSTICK_SIZE = 120;\r\nconst JOYSTICK_KNOB_SIZE = 50;\r\nconst JOYSTICK_OPACITY = 0.5;\r\nconst JOYSTICK_ACTIVE_OPACITY = 0.7;\r\n\r\n// Input state\r\nconst inputState = {\r\n    // Initialization flags (prevent duplicate setup)\r\n    systemInitialized: false,\r\n    touchInitialized: false,\r\n\r\n    // Gamepad state\r\n    gamepadConnected: false,\r\n    gamepadIndex: null,\r\n\r\n    // Movement (left stick or left touch joystick)\r\n    moveX: 0,\r\n    moveY: 0,\r\n\r\n    // Aim (right stick or right touch joystick)\r\n    aimX: 0,\r\n    aimY: 0,\r\n    aimActive: false, // True when right stick is being used\r\n\r\n    // Touch joystick state\r\n    touchEnabled: false,\r\n    leftTouch: null,  // Touch identifier for left joystick\r\n    rightTouch: null, // Touch identifier for right joystick\r\n    leftJoystickCenter: null,\r\n    rightJoystickCenter: null,\r\n\r\n    // UI elements (set by initTouchControls)\r\n    leftJoystickBase: null,\r\n    leftJoystickKnob: null,\r\n    rightJoystickBase: null,\r\n    rightJoystickKnob: null,\r\n\r\n    // Kaplay instance\r\n    k: null\r\n};\r\n\r\n/**\r\n * Apply deadzone to a value\r\n */\r\nfunction applyDeadzone(value, deadzone = STICK_DEADZONE) {\r\n    if (Math.abs(value) < deadzone) return 0;\r\n    // Scale the value to go from 0 at deadzone edge to 1 at full tilt\r\n    const sign = value > 0 ? 1 : -1;\r\n    return sign * (Math.abs(value) - deadzone) / (1 - deadzone);\r\n}\r\n\r\n/**\r\n * Initialize the input system\r\n * @param {Object} k - Kaplay instance\r\n */\r\nexport function initInputSystem(k) {\r\n    inputState.k = k;\r\n\r\n    // Prevent duplicate initialization of event listeners\r\n    if (inputState.systemInitialized) {\r\n        return;\r\n    }\r\n    inputState.systemInitialized = true;\r\n\r\n    // Listen for gamepad connections\r\n    window.addEventListener('gamepadconnected', (e) => {\r\n        console.log('[InputSystem] Gamepad connected:', e.gamepad.id);\r\n        inputState.gamepadConnected = true;\r\n        inputState.gamepadIndex = e.gamepad.index;\r\n    });\r\n\r\n    window.addEventListener('gamepaddisconnected', (e) => {\r\n        console.log('[InputSystem] Gamepad disconnected:', e.gamepad.id);\r\n        if (e.gamepad.index === inputState.gamepadIndex) {\r\n            inputState.gamepadConnected = false;\r\n            inputState.gamepadIndex = null;\r\n        }\r\n    });\r\n\r\n    // Check for already connected gamepads\r\n    const gamepads = navigator.getGamepads();\r\n    for (let i = 0; i < gamepads.length; i++) {\r\n        if (gamepads[i]) {\r\n            console.log('[InputSystem] Found existing gamepad:', gamepads[i].id);\r\n            inputState.gamepadConnected = true;\r\n            inputState.gamepadIndex = gamepads[i].index;\r\n            break;\r\n        }\r\n    }\r\n\r\n    // Detect touch device\r\n    inputState.touchEnabled = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\r\n\r\n    console.log('[InputSystem] Initialized. Gamepad:', inputState.gamepadConnected, 'Touch:', inputState.touchEnabled);\r\n}\r\n\r\n/**\r\n * Update gamepad input state (call each frame)\r\n */\r\nexport function updateGamepadInput() {\r\n    if (!inputState.gamepadConnected || inputState.gamepadIndex === null) {\r\n        return;\r\n    }\r\n\r\n    const gamepads = navigator.getGamepads();\r\n    const gamepad = gamepads[inputState.gamepadIndex];\r\n\r\n    if (!gamepad) {\r\n        inputState.gamepadConnected = false;\r\n        inputState.gamepadIndex = null;\r\n        return;\r\n    }\r\n\r\n    // Standard gamepad mapping:\r\n    // axes[0] = Left stick X (-1 left, 1 right)\r\n    // axes[1] = Left stick Y (-1 up, 1 down)\r\n    // axes[2] = Right stick X (-1 left, 1 right)\r\n    // axes[3] = Right stick Y (-1 up, 1 down)\r\n\r\n    // Left stick - movement\r\n    inputState.moveX = applyDeadzone(gamepad.axes[0] || 0);\r\n    inputState.moveY = applyDeadzone(gamepad.axes[1] || 0);\r\n\r\n    // Right stick - aiming\r\n    const rawAimX = applyDeadzone(gamepad.axes[2] || 0);\r\n    const rawAimY = applyDeadzone(gamepad.axes[3] || 0);\r\n\r\n    inputState.aimX = rawAimX;\r\n    inputState.aimY = rawAimY;\r\n\r\n    // Aim is active if right stick is being used\r\n    inputState.aimActive = Math.abs(rawAimX) > 0 || Math.abs(rawAimY) > 0;\r\n}\r\n\r\n/**\r\n * Initialize touch controls with virtual joysticks\r\n * @param {Object} k - Kaplay instance\r\n */\r\nexport function initTouchControls(k) {\r\n    if (!inputState.touchEnabled) return;\r\n\r\n    // Clean up existing joysticks first (in case of scene reload)\r\n    cleanupTouchJoysticks();\r\n\r\n    // Prevent duplicate touch event listeners\r\n    if (inputState.touchInitialized) {\r\n        // Just recreate the visual elements, don't re-add event listeners\r\n        createJoystickVisuals(k);\r\n        return;\r\n    }\r\n    inputState.touchInitialized = true;\r\n\r\n    createJoystickVisuals(k);\r\n\r\n    // Touch event handlers (only added once)\r\n    const canvas = k.canvas;\r\n\r\n    canvas.addEventListener('touchstart', handleTouchStart, { passive: false });\r\n    canvas.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n    canvas.addEventListener('touchend', handleTouchEnd, { passive: false });\r\n    canvas.addEventListener('touchcancel', handleTouchEnd, { passive: false });\r\n\r\n    console.log('[InputSystem] Touch controls initialized');\r\n}\r\n\r\n/**\r\n * Create joystick visual elements\r\n * @param {Object} k - Kaplay instance\r\n */\r\nfunction createJoystickVisuals(k) {\r\n    const screenWidth = k.width();\r\n    const screenHeight = k.height();\r\n\r\n    // Left joystick (bottom left quarter of screen)\r\n    const leftCenterX = screenWidth * 0.15;\r\n    const leftCenterY = screenHeight * 0.75;\r\n\r\n    // Right joystick (bottom right quarter of screen)\r\n    const rightCenterX = screenWidth * 0.85;\r\n    const rightCenterY = screenHeight * 0.75;\r\n\r\n    // Create left joystick base\r\n    inputState.leftJoystickBase = k.add([\r\n        k.circle(JOYSTICK_SIZE / 2),\r\n        k.pos(leftCenterX, leftCenterY),\r\n        k.anchor('center'),\r\n        k.color(100, 100, 100),\r\n        k.opacity(JOYSTICK_OPACITY),\r\n        k.fixed(),\r\n        k.z(1000),\r\n        'touchJoystick'\r\n    ]);\r\n\r\n    // Create left joystick knob\r\n    inputState.leftJoystickKnob = k.add([\r\n        k.circle(JOYSTICK_KNOB_SIZE / 2),\r\n        k.pos(leftCenterX, leftCenterY),\r\n        k.anchor('center'),\r\n        k.color(200, 200, 200),\r\n        k.opacity(JOYSTICK_OPACITY),\r\n        k.fixed(),\r\n        k.z(1001),\r\n        'touchJoystick'\r\n    ]);\r\n\r\n    // Create right joystick base\r\n    inputState.rightJoystickBase = k.add([\r\n        k.circle(JOYSTICK_SIZE / 2),\r\n        k.pos(rightCenterX, rightCenterY),\r\n        k.anchor('center'),\r\n        k.color(100, 100, 100),\r\n        k.opacity(JOYSTICK_OPACITY),\r\n        k.fixed(),\r\n        k.z(1000),\r\n        'touchJoystick'\r\n    ]);\r\n\r\n    // Create right joystick knob\r\n    inputState.rightJoystickKnob = k.add([\r\n        k.circle(JOYSTICK_KNOB_SIZE / 2),\r\n        k.pos(rightCenterX, rightCenterY),\r\n        k.anchor('center'),\r\n        k.color(255, 100, 100),\r\n        k.opacity(JOYSTICK_OPACITY),\r\n        k.fixed(),\r\n        k.z(1001),\r\n        'touchJoystick'\r\n    ]);\r\n\r\n    inputState.leftJoystickCenter = { x: leftCenterX, y: leftCenterY };\r\n    inputState.rightJoystickCenter = { x: rightCenterX, y: rightCenterY };\r\n}\r\n\r\n/**\r\n * Handle touch start\r\n */\r\nfunction handleTouchStart(e) {\r\n    e.preventDefault();\r\n\r\n    const k = inputState.k;\r\n    const rect = k.canvas.getBoundingClientRect();\r\n    const scaleX = k.width() / rect.width;\r\n    const scaleY = k.height() / rect.height;\r\n\r\n    for (const touch of e.changedTouches) {\r\n        const x = (touch.clientX - rect.left) * scaleX;\r\n        const y = (touch.clientY - rect.top) * scaleY;\r\n\r\n        // Check if touch is on left side (movement joystick)\r\n        if (x < k.width() / 2 && inputState.leftTouch === null) {\r\n            inputState.leftTouch = touch.identifier;\r\n            inputState.leftJoystickCenter = { x, y };\r\n\r\n            // Move joystick base to touch position\r\n            if (inputState.leftJoystickBase) {\r\n                inputState.leftJoystickBase.pos.x = x;\r\n                inputState.leftJoystickBase.pos.y = y;\r\n                inputState.leftJoystickBase.opacity = JOYSTICK_ACTIVE_OPACITY;\r\n            }\r\n            if (inputState.leftJoystickKnob) {\r\n                inputState.leftJoystickKnob.pos.x = x;\r\n                inputState.leftJoystickKnob.pos.y = y;\r\n                inputState.leftJoystickKnob.opacity = JOYSTICK_ACTIVE_OPACITY;\r\n            }\r\n        }\r\n        // Check if touch is on right side (aim joystick)\r\n        else if (x >= k.width() / 2 && inputState.rightTouch === null) {\r\n            inputState.rightTouch = touch.identifier;\r\n            inputState.rightJoystickCenter = { x, y };\r\n\r\n            // Move joystick base to touch position\r\n            if (inputState.rightJoystickBase) {\r\n                inputState.rightJoystickBase.pos.x = x;\r\n                inputState.rightJoystickBase.pos.y = y;\r\n                inputState.rightJoystickBase.opacity = JOYSTICK_ACTIVE_OPACITY;\r\n            }\r\n            if (inputState.rightJoystickKnob) {\r\n                inputState.rightJoystickKnob.pos.x = x;\r\n                inputState.rightJoystickKnob.pos.y = y;\r\n                inputState.rightJoystickKnob.opacity = JOYSTICK_ACTIVE_OPACITY;\r\n            }\r\n\r\n            inputState.aimActive = true;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Handle touch move\r\n */\r\nfunction handleTouchMove(e) {\r\n    e.preventDefault();\r\n\r\n    const k = inputState.k;\r\n    const rect = k.canvas.getBoundingClientRect();\r\n    const scaleX = k.width() / rect.width;\r\n    const scaleY = k.height() / rect.height;\r\n\r\n    for (const touch of e.changedTouches) {\r\n        const x = (touch.clientX - rect.left) * scaleX;\r\n        const y = (touch.clientY - rect.top) * scaleY;\r\n\r\n        // Left joystick (movement)\r\n        if (touch.identifier === inputState.leftTouch && inputState.leftJoystickCenter) {\r\n            const dx = x - inputState.leftJoystickCenter.x;\r\n            const dy = y - inputState.leftJoystickCenter.y;\r\n            const distance = Math.sqrt(dx * dx + dy * dy);\r\n            const maxDistance = JOYSTICK_SIZE / 2;\r\n\r\n            // Clamp to joystick radius\r\n            const clampedDistance = Math.min(distance, maxDistance);\r\n            const angle = Math.atan2(dy, dx);\r\n\r\n            // Update knob position\r\n            if (inputState.leftJoystickKnob) {\r\n                inputState.leftJoystickKnob.pos.x = inputState.leftJoystickCenter.x + Math.cos(angle) * clampedDistance;\r\n                inputState.leftJoystickKnob.pos.y = inputState.leftJoystickCenter.y + Math.sin(angle) * clampedDistance;\r\n            }\r\n\r\n            // Calculate normalized movement (-1 to 1)\r\n            const normalizedDistance = clampedDistance / maxDistance;\r\n            inputState.moveX = Math.cos(angle) * normalizedDistance;\r\n            inputState.moveY = Math.sin(angle) * normalizedDistance;\r\n        }\r\n\r\n        // Right joystick (aim)\r\n        if (touch.identifier === inputState.rightTouch && inputState.rightJoystickCenter) {\r\n            const dx = x - inputState.rightJoystickCenter.x;\r\n            const dy = y - inputState.rightJoystickCenter.y;\r\n            const distance = Math.sqrt(dx * dx + dy * dy);\r\n            const maxDistance = JOYSTICK_SIZE / 2;\r\n\r\n            // Clamp to joystick radius\r\n            const clampedDistance = Math.min(distance, maxDistance);\r\n            const angle = Math.atan2(dy, dx);\r\n\r\n            // Update knob position\r\n            if (inputState.rightJoystickKnob) {\r\n                inputState.rightJoystickKnob.pos.x = inputState.rightJoystickCenter.x + Math.cos(angle) * clampedDistance;\r\n                inputState.rightJoystickKnob.pos.y = inputState.rightJoystickCenter.y + Math.sin(angle) * clampedDistance;\r\n            }\r\n\r\n            // Calculate normalized aim (-1 to 1)\r\n            const normalizedDistance = clampedDistance / maxDistance;\r\n            inputState.aimX = Math.cos(angle) * normalizedDistance;\r\n            inputState.aimY = Math.sin(angle) * normalizedDistance;\r\n            inputState.aimActive = normalizedDistance > 0.1;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Handle touch end\r\n */\r\nfunction handleTouchEnd(e) {\r\n    e.preventDefault();\r\n\r\n    for (const touch of e.changedTouches) {\r\n        // Left joystick released\r\n        if (touch.identifier === inputState.leftTouch) {\r\n            inputState.leftTouch = null;\r\n            inputState.moveX = 0;\r\n            inputState.moveY = 0;\r\n\r\n            // Reset knob to center\r\n            if (inputState.leftJoystickKnob && inputState.leftJoystickCenter) {\r\n                inputState.leftJoystickKnob.pos.x = inputState.leftJoystickCenter.x;\r\n                inputState.leftJoystickKnob.pos.y = inputState.leftJoystickCenter.y;\r\n            }\r\n            if (inputState.leftJoystickBase) {\r\n                inputState.leftJoystickBase.opacity = JOYSTICK_OPACITY;\r\n            }\r\n            if (inputState.leftJoystickKnob) {\r\n                inputState.leftJoystickKnob.opacity = JOYSTICK_OPACITY;\r\n            }\r\n        }\r\n\r\n        // Right joystick released\r\n        if (touch.identifier === inputState.rightTouch) {\r\n            inputState.rightTouch = null;\r\n            inputState.aimX = 0;\r\n            inputState.aimY = 0;\r\n            inputState.aimActive = false;\r\n\r\n            // Reset knob to center\r\n            if (inputState.rightJoystickKnob && inputState.rightJoystickCenter) {\r\n                inputState.rightJoystickKnob.pos.x = inputState.rightJoystickCenter.x;\r\n                inputState.rightJoystickKnob.pos.y = inputState.rightJoystickCenter.y;\r\n            }\r\n            if (inputState.rightJoystickBase) {\r\n                inputState.rightJoystickBase.opacity = JOYSTICK_OPACITY;\r\n            }\r\n            if (inputState.rightJoystickKnob) {\r\n                inputState.rightJoystickKnob.opacity = JOYSTICK_OPACITY;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Get movement input (from gamepad or touch)\r\n * @returns {{ x: number, y: number }} Movement direction (-1 to 1)\r\n */\r\nexport function getMovementInput() {\r\n    return {\r\n        x: inputState.moveX,\r\n        y: inputState.moveY\r\n    };\r\n}\r\n\r\n/**\r\n * Get aim input (from gamepad or touch)\r\n * @returns {{ x: number, y: number, active: boolean }} Aim direction (-1 to 1) and whether aim is active\r\n */\r\nexport function getAimInput() {\r\n    return {\r\n        x: inputState.aimX,\r\n        y: inputState.aimY,\r\n        active: inputState.aimActive\r\n    };\r\n}\r\n\r\n/**\r\n * Check if gamepad is connected\r\n * @returns {boolean}\r\n */\r\nexport function isGamepadConnected() {\r\n    return inputState.gamepadConnected;\r\n}\r\n\r\n/**\r\n * Check if touch controls are enabled\r\n * @returns {boolean}\r\n */\r\nexport function isTouchEnabled() {\r\n    return inputState.touchEnabled;\r\n}\r\n\r\n/**\r\n * Check if any alternative input is being used (gamepad or touch)\r\n * @returns {boolean}\r\n */\r\nexport function isUsingAlternativeInput() {\r\n    return inputState.gamepadConnected ||\r\n           inputState.leftTouch !== null ||\r\n           inputState.rightTouch !== null;\r\n}\r\n\r\n/**\r\n * Hide touch joysticks (e.g., when not in game)\r\n */\r\nexport function hideTouchJoysticks() {\r\n    if (inputState.leftJoystickBase) inputState.leftJoystickBase.hidden = true;\r\n    if (inputState.leftJoystickKnob) inputState.leftJoystickKnob.hidden = true;\r\n    if (inputState.rightJoystickBase) inputState.rightJoystickBase.hidden = true;\r\n    if (inputState.rightJoystickKnob) inputState.rightJoystickKnob.hidden = true;\r\n}\r\n\r\n/**\r\n * Show touch joysticks\r\n */\r\nexport function showTouchJoysticks() {\r\n    if (inputState.leftJoystickBase) inputState.leftJoystickBase.hidden = false;\r\n    if (inputState.leftJoystickKnob) inputState.leftJoystickKnob.hidden = false;\r\n    if (inputState.rightJoystickBase) inputState.rightJoystickBase.hidden = false;\r\n    if (inputState.rightJoystickKnob) inputState.rightJoystickKnob.hidden = false;\r\n}\r\n\r\n/**\r\n * Clean up touch joystick visuals (call when leaving game scene)\r\n * Note: Does not remove event listeners as they persist across scenes\r\n */\r\nexport function cleanupTouchJoysticks() {\r\n    const k = inputState.k;\r\n    if (!k) return;\r\n\r\n    // Destroy joystick entities if they exist\r\n    try {\r\n        k.get('touchJoystick').forEach(j => {\r\n            if (j && j.exists()) k.destroy(j);\r\n        });\r\n    } catch (e) {\r\n        // Ignore errors if entities are already destroyed\r\n    }\r\n\r\n    inputState.leftJoystickBase = null;\r\n    inputState.leftJoystickKnob = null;\r\n    inputState.rightJoystickBase = null;\r\n    inputState.rightJoystickKnob = null;\r\n    inputState.leftTouch = null;\r\n    inputState.rightTouch = null;\r\n    inputState.moveX = 0;\r\n    inputState.moveY = 0;\r\n    inputState.aimX = 0;\r\n    inputState.aimY = 0;\r\n    inputState.aimActive = false;\r\n}\r\n","// Weapon definitions - defines all weapon types and their properties\r\n\r\nexport const WEAPON_DEFINITIONS = {\r\n    pistol: {\r\n        name: 'Basic Pistol',\r\n        icon: '', // Gun icon\r\n        char: '', // Bullet point\r\n        color: [255, 255, 255],\r\n        fireRate: 3.75, // Shots per second (2.5x multiplier)\r\n        projectileSpeed: 300,\r\n        baseDamage: 10,\r\n        projectileCount: 1,\r\n        spreadAngle: 0, // No spread\r\n        piercing: 0,\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05, // 5% base crit chance\r\n        critDamage: 2.0, // 200% damage\r\n        range: 600, // Medium range\r\n        category: 'balanced', // balanced, rapid, spread, precision, area\r\n        upgradeCategories: ['damage', 'fireRate', 'multiShot', 'piercing', 'crit'] // Available upgrade types\r\n    },\r\n    smg: {\r\n        name: 'Rapid Fire SMG',\r\n        icon: '', // Rapid fire icon\r\n        char: '', // Box drawing vertical\r\n        color: [100, 200, 255],\r\n        fireRate: 7.5, // Shots per second (2.5x multiplier)\r\n        projectileSpeed: 350,\r\n        baseDamage: 6,\r\n        projectileCount: 1,\r\n        spreadAngle: 0,\r\n        piercing: 0,\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05,\r\n        critDamage: 2.0,\r\n        range: 700, // Medium-long range\r\n        category: 'rapid',\r\n        upgradeCategories: ['damage', 'fireRate', 'multiShot', 'piercing', 'crit'] // Removed 'speed' (passive upgrade)\r\n    },\r\n    shotgun: {\r\n        name: 'Spread Shotgun',\r\n        icon: '', // Spread pattern icon\r\n        char: '', // White bullet\r\n        color: [255, 200, 100],\r\n        fireRate: 2.0, // Shots per second (2.5x multiplier)\r\n        projectileSpeed: 250,\r\n        baseDamage: 8, // Per pellet\r\n        projectileCount: 3, // 3-5 pellets\r\n        spreadAngle: 35, // Degrees\r\n        piercing: 0,\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05,\r\n        critDamage: 2.0,\r\n        range: 400, // Short-medium range\r\n        category: 'spread',\r\n        upgradeCategories: ['damage', 'pelletCount', 'spread', 'fireRate', 'crit']\r\n    },\r\n    sniper: {\r\n        name: 'Sniper Rifle',\r\n        icon: '', // Long barrel icon\r\n        char: '', // Arrow\r\n        color: [100, 255, 255],\r\n        fireRate: 1.0, // Very slow (2.5x multiplier)\r\n        projectileSpeed: 500, // Very fast\r\n        baseDamage: 20, // Very high\r\n        projectileCount: 1,\r\n        spreadAngle: 0,\r\n        piercing: 1, // Passes through 1 enemy\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05,\r\n        critDamage: 2.5, // Higher crit damage\r\n        range: 900, // Long range\r\n        category: 'precision',\r\n        upgradeCategories: ['damage', 'piercing', 'crit', 'fireRate', 'range']\r\n    },\r\n    flamethrower: {\r\n        name: 'Flame Thrower',\r\n        icon: '', // Flame wave icon\r\n        char: '', // Double line\r\n        color: [255, 150, 50],\r\n        fireRate: 12.5, // Continuous fire (ticks per second) (2.5x multiplier)\r\n        projectileSpeed: 200,\r\n        baseDamage: 8, // Per tick\r\n        projectileCount: 1,\r\n        spreadAngle: 15, // Small spread\r\n        piercing: 0,\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05,\r\n        critDamage: 2.0,\r\n        range: 150, // Short range\r\n        category: 'area',\r\n        upgradeCategories: ['damage', 'fireRate', 'range', 'spread', 'dot'] // DoT upgrades\r\n    },\r\n    orbital: {\r\n        name: 'Orbital Weapons',\r\n        icon: '', // Orbital icon\r\n        char: '', // White circle\r\n        color: [100, 200, 255],\r\n        fireRate: 0, // No firing - passive orbs\r\n        projectileSpeed: 0,\r\n        baseDamage: 12, // Per contact\r\n        projectileCount: 1, // Starting orbs\r\n        spreadAngle: 0,\r\n        piercing: 0,\r\n        obstaclePiercing: 0,\r\n        critChance: 0,\r\n        critDamage: 1.0,\r\n        range: 0,\r\n        orbitRadius: 45, // Distance from player\r\n        rotationSpeed: 180, // Degrees per second\r\n        category: 'passive',\r\n        upgradeCategories: ['orbitalCount', 'orbitalSpeed', 'orbitalRadius', 'damage'] // Orbital-specific upgrades\r\n    },\r\n    explosive: {\r\n        name: 'Explosive Launcher',\r\n        icon: '', // Explosion icon\r\n        char: '', // Black circle\r\n        color: [255, 100, 50],\r\n        fireRate: 1.5, // Slow fire rate (2.5x multiplier)\r\n        projectileSpeed: 200, // Slow, visible\r\n        baseDamage: 25, // Base explosion damage\r\n        projectileCount: 1,\r\n        spreadAngle: 0,\r\n        piercing: 0,\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05,\r\n        critDamage: 2.0,\r\n        range: 500, // Medium range\r\n        explosionRadius: 50, // Area damage radius\r\n        explosionDamage: 15, // Area damage\r\n        category: 'area',\r\n        upgradeCategories: ['damage', 'explosionRadius', 'explosionDamage', 'fireRate', 'range']\r\n    },\r\n    chainLightning: {\r\n        name: 'Chain Lightning',\r\n        icon: '', // Lightning icon\r\n        char: '', // Lightning bolt\r\n        color: [255, 255, 100],\r\n        fireRate: 3.0, // Shots per second (2.5x multiplier)\r\n        projectileSpeed: 400, // Fast\r\n        baseDamage: 12, // Base damage\r\n        projectileCount: 1,\r\n        spreadAngle: 0,\r\n        piercing: 0,\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05,\r\n        critDamage: 2.0,\r\n        range: 600, // Medium range\r\n        chainRange: 70, // Distance between chain jumps\r\n        maxJumps: 3, // Starting chain jumps\r\n        chainDamageReduction: 0.15, // -15% damage per jump\r\n        category: 'multiTarget',\r\n        upgradeCategories: ['damage', 'chainJumps', 'chainRange', 'fireRate', 'chainDamage']\r\n    },\r\n    boomerang: {\r\n        name: 'Boomerang Blaster',\r\n        icon: '', // Circular arrow\r\n        char: '', // Clockwise arrow\r\n        color: [100, 255, 200],\r\n        fireRate: 2.0, // Shots per second\r\n        projectileSpeed: 250,\r\n        baseDamage: 14, // Higher base damage since hits twice\r\n        projectileCount: 1,\r\n        spreadAngle: 0,\r\n        piercing: 0, // No pierce, but returns to hit again\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05,\r\n        critDamage: 2.0,\r\n        range: 400, // Medium range - travels out and back\r\n        returnsToPlayer: true, // Projectiles return, hitting enemies twice\r\n        returnSpeedMultiplier: 1.2, // Returns faster\r\n        category: 'multiTarget',\r\n        upgradeCategories: ['damage', 'fireRate', 'range', 'crit', 'projectileSpeed']\r\n    },\r\n    railgun: {\r\n        name: 'Railgun',\r\n        icon: '', // Double horizontal line\r\n        char: '', // Rail\r\n        color: [150, 200, 255],\r\n        fireRate: 0.33, // 3 second cooldown (very slow)\r\n        projectileSpeed: 800, // Very fast\r\n        baseDamage: 50, // Very high damage\r\n        projectileCount: 1,\r\n        spreadAngle: 0,\r\n        piercing: 999, // Effectively infinite - pierces ALL enemies\r\n        obstaclePiercing: 1, // Can pierce one obstacle\r\n        critChance: 0.1, // Higher crit chance\r\n        critDamage: 3.0, // Higher crit damage\r\n        range: 1000, // Very long range\r\n        infinitePierce: true, // Special flag for railgun\r\n        category: 'precision',\r\n        upgradeCategories: ['damage', 'crit', 'critDamage', 'fireRate', 'obstaclePiercing']\r\n    },\r\n    spreadShot: {\r\n        name: 'Spread Shot',\r\n        icon: '', // Trident-like spread\r\n        char: '', // Small bullet\r\n        color: [255, 180, 100],\r\n        fireRate: 2.5, // Moderate fire rate\r\n        projectileSpeed: 280,\r\n        baseDamage: 6, // Lower per projectile\r\n        projectileCount: 3, // 3 projectiles in cone\r\n        spreadAngle: 25, // Cone spread\r\n        piercing: 0,\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05,\r\n        critDamage: 2.0,\r\n        range: 450, // Medium range\r\n        category: 'spread',\r\n        upgradeCategories: ['damage', 'pelletCount', 'spread', 'fireRate', 'crit']\r\n    },\r\n    homingMissiles: {\r\n        name: 'Homing Missiles',\r\n        icon: '', // Triangle pointing right\r\n        char: '', // Small triangle\r\n        color: [255, 100, 150],\r\n        fireRate: 1.5, // Slow fire rate\r\n        projectileSpeed: 180, // Slower but tracks\r\n        baseDamage: 18, // High damage per hit\r\n        projectileCount: 1,\r\n        spreadAngle: 0,\r\n        piercing: 0,\r\n        obstaclePiercing: 0,\r\n        critChance: 0.05,\r\n        critDamage: 2.0,\r\n        range: 700, // Long range\r\n        homing: true, // Tracks nearest enemy\r\n        homingStrength: 3.0, // Turn rate multiplier\r\n        category: 'precision',\r\n        upgradeCategories: ['damage', 'fireRate', 'range', 'crit', 'projectileSpeed']\r\n    },\r\n    plasmaRifle: {\r\n        name: 'Plasma Rifle',\r\n        icon: '', // Circled plus\r\n        char: '', // Diamond\r\n        color: [100, 255, 200],\r\n        fireRate: 2.0, // Moderate fire rate\r\n        projectileSpeed: 350,\r\n        baseDamage: 16, // High damage\r\n        projectileCount: 1,\r\n        spreadAngle: 0,\r\n        piercing: 2, // Penetrates 2 enemies\r\n        obstaclePiercing: 0,\r\n        critChance: 0.08, // Slightly higher crit\r\n        critDamage: 2.2,\r\n        range: 650, // Medium-long range\r\n        category: 'precision',\r\n        upgradeCategories: ['damage', 'piercing', 'crit', 'fireRate', 'range']\r\n    }\r\n};\r\n\r\n// Get weapon definition by key\r\nexport function getWeaponDefinition(weaponKey) {\r\n    return WEAPON_DEFINITIONS[weaponKey] || WEAPON_DEFINITIONS.pistol;\r\n}\r\n\r\n// Get all weapons in a category\r\nexport function getWeaponsByCategory(category) {\r\n    return Object.entries(WEAPON_DEFINITIONS)\r\n        .filter(([key, weapon]) => weapon.category === category)\r\n        .map(([key, weapon]) => ({ key, ...weapon }));\r\n}\r\n\r\n// Check if upgrade category is valid for weapon\r\nexport function isUpgradeValidForWeapon(weaponKey, upgradeCategory) {\r\n    const weapon = getWeaponDefinition(weaponKey);\r\n    return weapon.upgradeCategories.includes(upgradeCategory);\r\n}\r\n\r\n","/**\r\n * Game Constants & Configuration\r\n *\r\n * Centralized configuration for all game values.\r\n * This makes balancing easier and prepares for multiplayer where\r\n * constants may need to be synchronized across clients.\r\n */\r\n\r\n// =============================================================================\r\n// GAME WINDOW & RENDERING\r\n// =============================================================================\r\n\r\nexport const GAME_CONFIG = {\r\n    // Canvas dimensions\r\n    CANVAS_WIDTH: 800,\r\n    CANVAS_HEIGHT: 600,\r\n    CANVAS_SCALE: 1,\r\n\r\n    // Background\r\n    BACKGROUND_COLOR: [0, 0, 0],\r\n\r\n    // Debug mode\r\n    DEBUG_MODE: false,\r\n};\r\n\r\n// =============================================================================\r\n// PLAYER BASE STATS\r\n// =============================================================================\r\n\r\nexport const PLAYER_CONFIG = {\r\n    // Collision & physics\r\n    COLLISION_SIZE: 12, // Approximate player hitbox radius\r\n\r\n    // Pickup system\r\n    BASE_PICKUP_RADIUS: 30, // Base pickup radius in pixels\r\n\r\n    // Immunity frames (i-frames after taking damage)\r\n    INVULNERABILITY_DURATION: 1.0, // Seconds of immunity after hit\r\n    IMMUNITY_FLASH_RATE: 10, // Flashes per second during immunity\r\n\r\n    // Visual feedback\r\n    NORMAL_COLOR: [100, 150, 255],\r\n    HIT_COLOR: [255, 100, 100],\r\n    IMMUNITY_ALPHA: 0.3, // Transparency during flash\r\n\r\n    // Movement boundaries\r\n    ROOM_MARGIN: 20, // Distance from edge of screen\r\n};\r\n\r\n// =============================================================================\r\n// PROGRESSION SYSTEM\r\n// =============================================================================\r\n\r\nexport const PROGRESSION_CONFIG = {\r\n    // XP & Leveling (flattened curve: higher early, lower scaling)\r\n    BASE_XP_TO_NEXT_LEVEL: 15,\r\n    XP_SCALING_FACTOR: 1.25, // Multiplier per level for XP requirements\r\n\r\n    // Starting stats\r\n    STARTING_LEVEL: 1,\r\n    STARTING_XP: 0,\r\n\r\n    // Level up notification\r\n    LEVEL_UP_NOTIFICATION_Y: 100, // Y position of level up text\r\n    LEVEL_UP_NOTIFICATION_DURATION: 0.5, // Seconds before showing upgrade draft\r\n};\r\n\r\n// =============================================================================\r\n// CHARACTER ABILITIES (Multipliers & Bonuses)\r\n// =============================================================================\r\n\r\nexport const CHARACTER_ABILITIES = {\r\n    // The Survivor\r\n    SURVIVOR_XP_BOOST: 1.1, // +10% XP gain\r\n\r\n    // The Scout\r\n    SCOUT_SPEED_BOOST: 1.2, // +20% speed\r\n    SCOUT_DODGE_CHANCE: 0.1, // 10% dodge chance\r\n\r\n    // The Tank\r\n    TANK_HEALTH_BOOST: 1.25, // +25% health\r\n    TANK_DAMAGE_REDUCTION: 0.15, // 15% damage reduction\r\n\r\n    // The Sniper\r\n    SNIPER_CRIT_CHANCE_MULTIPLIER: 1.5, // +50% to base crit chance\r\n    SNIPER_CRIT_DAMAGE_MULTIPLIER: 1.25, // +25% to crit damage\r\n\r\n    // The Pyro\r\n    PYRO_FIRE_DOT_MULTIPLIER: 1.25, // +25% fire DoT damage\r\n};\r\n\r\n// =============================================================================\r\n// COMBAT SYSTEM\r\n// =============================================================================\r\n\r\nexport const COMBAT_CONFIG = {\r\n    // Damage\r\n    MIN_DAMAGE: 1, // Minimum damage that can be dealt\r\n\r\n    // Knockback distances\r\n    KNOCKBACK_ENEMY: 20, // Regular enemy knockback\r\n    KNOCKBACK_ENEMY_FROM_PROJECTILE: 15, // Enemy hit by projectile\r\n    KNOCKBACK_MINIBOSS: 25, // Miniboss knockback\r\n    KNOCKBACK_BOSS: 10, // Boss knockback (heavier)\r\n    KNOCKBACK_BOSS_FROM_PROJECTILE: 10, // Boss hit by projectile\r\n\r\n    // Base enemy damage values\r\n    BASE_ENEMY_DAMAGE: 10,\r\n    BASE_MINIBOSS_DAMAGE: 15,\r\n    BASE_BOSS_DAMAGE: 18,\r\n\r\n    // Enemy scaling per floor\r\n    ENEMY_HP_SCALING_PER_FLOOR: 0.3, // +30% HP per floor\r\n    ENEMY_DAMAGE_SCALING_PER_FLOOR: 0.15, // +15% damage per floor (new)\r\n    ENEMY_SPEED_SCALING_PER_FLOOR: 0.1, // +10% speed per floor\r\n\r\n    // Boss enrage multiplier\r\n    BOSS_ENRAGE_DAMAGE_MULTIPLIER: 1.25, // +25% damage when enraged\r\n\r\n    // Multi-shot delays\r\n    MULTISHOT_STAGGER_DELAY: 0.02, // Delay between projectiles in multi-shot\r\n\r\n    // Visual feedback durations\r\n    HIT_FLASH_DURATION: 0.1, // How long hit flash lasts\r\n    EXPLOSION_VISUAL_DURATION: 0.2, // How long explosion effect shows\r\n    CHAIN_VISUAL_DURATION: 0.1, // How long chain lightning visual shows\r\n\r\n    // Critical hit visuals\r\n    CRIT_COLOR: [255, 200, 0], // Gold color for crits\r\n    HIT_COLOR: [255, 255, 255], // White color for normal hits\r\n};\r\n\r\n// =============================================================================\r\n// WEAPON SYSTEMS (for special weapon types)\r\n// =============================================================================\r\n\r\nexport const WEAPON_CONFIG = {\r\n    // Orbital weapons\r\n    ORBITAL_CONTACT_COOLDOWN: 0.2, // Seconds between orbital hits on same enemy\r\n    BASE_ORBIT_RADIUS: 45, // Distance from player\r\n    BASE_ROTATION_SPEED: 180, // Degrees per second\r\n\r\n    // Explosive weapons\r\n    BASE_EXPLOSION_RADIUS: 50, // Area damage radius\r\n    BASE_EXPLOSION_DAMAGE: 15, // Area damage amount\r\n\r\n    // Chain lightning\r\n    BASE_CHAIN_RANGE: 70, // Distance between chain jumps\r\n    BASE_CHAIN_JUMPS: 3, // Number of times it can chain\r\n    BASE_CHAIN_DAMAGE_REDUCTION: 0.15, // 15% damage reduction per jump\r\n    CHAIN_COLLISION_DELAY: 0.01, // Small delay for collision detection\r\n\r\n    // Range fallback\r\n    DEFAULT_WEAPON_RANGE: 750, // Default projectile range if not specified\r\n};\r\n\r\n// =============================================================================\r\n// MULTIPLAYER (Future - Placeholder)\r\n// =============================================================================\r\n\r\nexport const MULTIPLAYER_CONFIG = {\r\n    // Player limits\r\n    MIN_PLAYERS: 1,\r\n    MAX_PLAYERS: 4,\r\n\r\n    // Default mode\r\n    DEFAULT_MODE: 'singleplayer', // 'singleplayer' | 'coop'\r\n\r\n    // Network (future)\r\n    TICK_RATE: 60, // Server tick rate\r\n    CLIENT_PREDICTION: true, // Enable client-side prediction\r\n    INTERPOLATION_DELAY: 100, // Milliseconds of interpolation buffer\r\n};\r\n\r\n// =============================================================================\r\n// PICKUPS & LOOT\r\n// =============================================================================\r\n\r\nexport const PICKUP_CONFIG = {\r\n    // XP Pickups\r\n    XP_LIFETIME: 10, // Seconds before XP despawns\r\n    XP_PULSE_SPEED: 5, // Speed of pulse animation\r\n    XP_PULSE_AMOUNT: 0.2, // Amount of pulse scaling (0.2 = 20% scale change)\r\n    XP_COLOR: [100, 200, 255], // Light blue\r\n\r\n    // Currency Pickups\r\n    CURRENCY_LIFETIME: 15, // Seconds before currency despawns (longer than XP)\r\n    CURRENCY_PULSE_SPEED: 4, // Speed of pulse animation\r\n    CURRENCY_PULSE_AMOUNT: 0.15, // Amount of pulse scaling\r\n    CURRENCY_COLOR: [255, 215, 0], // Gold\r\n\r\n    // Magnetization\r\n    MAGNETIZE_SPEED: 800, // Max speed at which pickups move toward player when magnetized (pixels/second)\r\n    MAGNETIZE_ACCELERATION: 600, // Acceleration of magnetized pickups (pixels/second)\r\n    COLLECTION_RADIUS: 20, // Distance at which pickups are automatically collected\r\n};\r\n\r\n// =============================================================================\r\n// PERFORMANCE & OPTIMIZATION\r\n// =============================================================================\r\n\r\nexport const PERFORMANCE_CONFIG = {\r\n    // Object pooling (future)\r\n    PROJECTILE_POOL_SIZE: 100,\r\n    PARTICLE_POOL_SIZE: 200,\r\n\r\n    // Spatial partitioning (future)\r\n    GRID_CELL_SIZE: 100, // Size of spatial grid cells\r\n\r\n    // Max entities (safety limits)\r\n    MAX_PROJECTILES: 500,\r\n    MAX_ENEMIES: 300, // Increased for 3x enemy count\r\n    MAX_PICKUPS: 600, // Increased for 3x pickups\r\n};\r\n\r\n// =============================================================================\r\n// HELPER FUNCTIONS\r\n// =============================================================================\r\n\r\n/**\r\n * Get XP required for next level\r\n * @param {number} currentLevel - Current player level\r\n * @returns {number} XP required to reach next level\r\n */\r\nexport function getXPForNextLevel(currentLevel) {\r\n    return Math.floor(\r\n        PROGRESSION_CONFIG.BASE_XP_TO_NEXT_LEVEL *\r\n        Math.pow(PROGRESSION_CONFIG.XP_SCALING_FACTOR, currentLevel - 1)\r\n    );\r\n}\r\n\r\n/**\r\n * Calculate damage after defense reduction\r\n * @param {number} baseDamage - Base damage before reduction\r\n * @param {number} defense - Flat defense reduction\r\n * @param {number} damageReduction - Percentage damage reduction (0-1)\r\n * @returns {number} Final damage (minimum 1)\r\n */\r\nexport function calculateDamageAfterDefense(baseDamage, defense = 0, damageReduction = 0) {\r\n    const afterReduction = baseDamage * (1 - damageReduction);\r\n    return Math.max(COMBAT_CONFIG.MIN_DAMAGE, afterReduction - defense);\r\n}\r\n\r\n/**\r\n * Check if an attack is a critical hit\r\n * @param {number} critChance - Critical hit chance (0-1)\r\n * @param {Object} rng - Optional seeded RNG for multiplayer consistency\r\n * @returns {boolean} Whether the attack is a crit\r\n */\r\nexport function rollCriticalHit(critChance, rng = null) {\r\n    const roll = rng ? rng.next() : Math.random();\r\n    return roll < critChance;\r\n}\r\n\r\n/**\r\n * Calculate critical hit damage\r\n * @param {number} baseDamage - Base damage\r\n * @param {number} critMultiplier - Critical damage multiplier (default 2.0 = 200%)\r\n * @returns {number} Critical damage\r\n */\r\nexport function calculateCriticalDamage(baseDamage, critMultiplier = 2.0) {\r\n    return Math.floor(baseDamage * critMultiplier);\r\n}\r\n","/**\r\n * Player Entity\r\n *\r\n * Creates and manages the player character including:\r\n * - Character selection and stats\r\n * - Health and death handling\r\n * - Progression (level, XP)\r\n * - Upgrades and abilities\r\n * - Invulnerability frames\r\n * - Character-specific abilities (dodge, XP boost, etc.)\r\n */\r\n\r\n// System imports\r\nimport { getSelectedCharacter, getPermanentUpgradeLevel } from '../systems/metaProgression.js';\r\nimport { getMovementInput, updateGamepadInput } from '../systems/inputSystem.js';\r\n\r\n// Data imports\r\nimport { CHARACTER_UNLOCKS } from '../data/unlocks.js';\r\nimport { getWeaponDefinition } from '../data/weapons.js';\r\n\r\n// Configuration imports\r\nimport {\r\n    PLAYER_CONFIG,\r\n    PROGRESSION_CONFIG,\r\n    CHARACTER_ABILITIES\r\n} from '../config/constants.js';\r\n\r\nexport function createPlayer(k, x, y, characterKey = null) {\r\n    // Get selected character (use provided characterKey for remote players, or get local selection)\r\n    const selectedCharKey = characterKey || getSelectedCharacter();\r\n    const charData = CHARACTER_UNLOCKS[selectedCharKey] || CHARACTER_UNLOCKS.survivor;\r\n    \r\n    // Create outline (larger, dark version behind player)\r\n    const outline = k.add([\r\n        k.text(charData.char, { size: 24 }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(0, 0, 0), // Black outline\r\n        k.scale(1.15), // Slightly larger\r\n        k.rotate(0), // Enable rotation\r\n        k.z(-1), // Behind the player\r\n        'playerOutline'\r\n    ]);\r\n\r\n    const player = k.add([\r\n        k.text(charData.char, { size: 24 }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...charData.color),\r\n        k.rotate(0), // Enable rotation\r\n        k.area(),\r\n        k.health(charData.stats.health),\r\n        'player'\r\n    ]);\r\n\r\n    // Link outline to player\r\n    player.outline = outline;\r\n\r\n    // Store character info\r\n    player.characterKey = selectedCharKey;\r\n    player.characterData = charData;\r\n    \r\n    // Player stats (from character)\r\n    player.speed = charData.stats.speed;\r\n    player.originalSpeed = charData.stats.speed; // Store original speed for debuff restoration\r\n    player.slowed = false; // Track if player is slowed\r\n    player.maxHealth = charData.stats.health;\r\n    // Head Start: Begin at level 2 if upgrade purchased\r\n    const headStartLevel = getPermanentUpgradeLevel('headStart');\r\n    player.level = headStartLevel > 0 ? 2 : PROGRESSION_CONFIG.STARTING_LEVEL;\r\n    player.xp = PROGRESSION_CONFIG.STARTING_XP;\r\n    player.xpToNext = PROGRESSION_CONFIG.BASE_XP_TO_NEXT_LEVEL;\r\n    player.pickupRadius = PLAYER_CONFIG.BASE_PICKUP_RADIUS;\r\n    player.invulnerable = false; // Immunity frames flag\r\n    player.invulnerableTime = 0; // Time remaining in immunity\r\n    player.invulnerableDuration = PLAYER_CONFIG.INVULNERABILITY_DURATION;\r\n    \r\n    // Sync health component with maxHealth\r\n    player.setHP(player.maxHealth);\r\n    \r\n    // Weapon system - get weapon definition\r\n    const weaponKey = charData.weapon || 'pistol';\r\n    const weaponDef = getWeaponDefinition(weaponKey);\r\n    player.weaponKey = weaponKey;\r\n    player.weaponDef = weaponDef;\r\n    \r\n    // Store base weapon stats (for upgrade recalculation)\r\n    player.baseFireRate = weaponDef.fireRate;\r\n    player.baseProjectileSpeed = weaponDef.projectileSpeed;\r\n    player.baseProjectileDamage = weaponDef.baseDamage;\r\n\r\n    // Apply character damage bonus to base weapon damage\r\n    const characterDamageBonus = charData.stats.damage || 10; // Default to 10 if not specified\r\n    const weaponBaseDamage = weaponDef.baseDamage;\r\n    const characterDamageMultiplier = characterDamageBonus / 10; // Normalize (10 is baseline)\r\n\r\n    // Weapon stats (from weapon definition + character bonuses)\r\n    player.fireRate = weaponDef.fireRate;\r\n    player.projectileSpeed = weaponDef.projectileSpeed;\r\n    player.projectileDamage = Math.floor(weaponBaseDamage * characterDamageMultiplier);\r\n    player.lastFireTime = 0;\r\n    \r\n    // Advanced weapon stats (from weapon definition)\r\n    player.projectileCount = weaponDef.projectileCount;\r\n    player.piercing = weaponDef.piercing;\r\n    player.obstaclePiercing = weaponDef.obstaclePiercing;\r\n    player.critChance = weaponDef.critChance;\r\n    player.critDamage = weaponDef.critDamage;\r\n    player.spreadAngle = weaponDef.spreadAngle;\r\n    player.defense = 0; // Damage reduction (flat reduction)\r\n    \r\n    // Weapon-specific properties\r\n    player.weaponRange = weaponDef.range;\r\n    player.weaponCategory = weaponDef.category;\r\n    \r\n    // Orbital weapon properties\r\n    if (weaponDef.orbitRadius) {\r\n        player.orbitRadius = weaponDef.orbitRadius;\r\n        player.rotationSpeed = weaponDef.rotationSpeed;\r\n        player.orbitalOrbs = []; // Array to store orbital entities\r\n        player.orbitalAngles = []; // Array to store orbital angles\r\n    }\r\n    \r\n    // Explosive weapon properties\r\n    if (weaponDef.explosionRadius) {\r\n        player.explosionRadius = weaponDef.explosionRadius;\r\n        player.explosionDamage = weaponDef.explosionDamage;\r\n    }\r\n    \r\n    // Chain lightning properties\r\n    if (weaponDef.chainRange) {\r\n        player.chainRange = weaponDef.chainRange;\r\n        player.maxJumps = weaponDef.maxJumps;\r\n        player.chainDamageReduction = weaponDef.chainDamageReduction;\r\n    }\r\n    \r\n    // Character abilities (apply based on character)\r\n    player.xpMultiplier = 1.0; // Base multiplier\r\n    player.dodgeChance = 0; // Base dodge chance\r\n    player.damageReduction = 0; // Base damage reduction\r\n    \r\n    // Upgrade tracking\r\n    player.weapons = [weaponKey]; // Array of equipped weapon keys (max 4)\r\n    player.passiveUpgrades = []; // Array of passive upgrade keys (max 4)\r\n    player.upgradeStacks = {}; // Track upgrade stack counts: { upgradeKey: count }\r\n    \r\n    // Apply character-specific abilities\r\n    if (charData.ability === 'xpBoost') {\r\n        player.xpMultiplier = CHARACTER_ABILITIES.SURVIVOR_XP_BOOST;\r\n    } else if (charData.ability === 'speedBoost') {\r\n        player.speed = player.speed * CHARACTER_ABILITIES.SCOUT_SPEED_BOOST;\r\n        player.originalSpeed = player.speed;\r\n        player.dodgeChance = CHARACTER_ABILITIES.SCOUT_DODGE_CHANCE;\r\n    } else if (charData.ability === 'tankStats') {\r\n        player.maxHealth = Math.floor(player.maxHealth * CHARACTER_ABILITIES.TANK_HEALTH_BOOST);\r\n        player.setHP(player.maxHealth);\r\n        player.damageReduction = CHARACTER_ABILITIES.TANK_DAMAGE_REDUCTION;\r\n    } else if (charData.ability === 'critBoost') {\r\n        player.critChance = (player.critChance || 0) * CHARACTER_ABILITIES.SNIPER_CRIT_CHANCE_MULTIPLIER;\r\n        player.critDamage = (player.critDamage || 2.0) * CHARACTER_ABILITIES.SNIPER_CRIT_DAMAGE_MULTIPLIER;\r\n    } else if (charData.ability === 'fireDot') {\r\n        player.fireDotMultiplier = CHARACTER_ABILITIES.PYRO_FIRE_DOT_MULTIPLIER;\r\n    }\r\n\r\n    // Apply permanent upgrades from shop (only for local players, not in multiplayer sync)\r\n    if (!charData.skipPermanentUpgrades) {\r\n        // Lucky Start: +5% crit chance per level\r\n        const luckyStartLevel = getPermanentUpgradeLevel('luckyStart');\r\n        if (luckyStartLevel > 0) {\r\n            player.critChance = (player.critChance || 0) + (luckyStartLevel * 0.05);\r\n        }\r\n\r\n        // Thick Skin: +3% damage reduction per level\r\n        const thickSkinLevel = getPermanentUpgradeLevel('thickSkin');\r\n        if (thickSkinLevel > 0) {\r\n            player.damageReduction = (player.damageReduction || 0) + (thickSkinLevel * 0.03);\r\n        }\r\n\r\n        // XP Magnet: +15% pickup radius per level\r\n        const xpMagnetLevel = getPermanentUpgradeLevel('xpMagnet');\r\n        if (xpMagnetLevel > 0) {\r\n            player.pickupRadius = Math.floor(player.pickupRadius * (1 + xpMagnetLevel * 0.15));\r\n        }\r\n\r\n        // Comfort Zone: +0.1s invulnerability after hit per level\r\n        const comfortZoneLevel = getPermanentUpgradeLevel('comfortZone');\r\n        if (comfortZoneLevel > 0) {\r\n            player.invulnerableDuration = player.invulnerableDuration + (comfortZoneLevel * 0.1);\r\n        }\r\n    }\r\n\r\n    // Control flags\r\n    player.canMove = true; // Can the player move? (set to false on death)\r\n    player.canShoot = true; // Can the player shoot? (set to false on death)\r\n    player.isDead = false; // Is the player dead?\r\n\r\n    // Movement\r\n    let moveDir = k.vec2(0, 0);\r\n    let windowHasFocus = document.hasFocus();\r\n    // Track keys that need to be released before accepting input again\r\n    let keysNeedRelease = { w: false, s: false, a: false, d: false, up: false, down: false, left: false, right: false };\r\n\r\n    // Expose moveDir on player object for multiplayer input reading\r\n    player.moveDir = moveDir;\r\n\r\n    k.onKeyDown(['w', 'up'], () => {\r\n        if (player.isRemote || !windowHasFocus) return;\r\n        if (keysNeedRelease.w || keysNeedRelease.up) return;\r\n        moveDir.y = -1;\r\n        player.moveDir = moveDir;\r\n    });\r\n\r\n    k.onKeyDown(['s', 'down'], () => {\r\n        if (player.isRemote || !windowHasFocus) return;\r\n        if (keysNeedRelease.s || keysNeedRelease.down) return;\r\n        moveDir.y = 1;\r\n        player.moveDir = moveDir;\r\n    });\r\n\r\n    k.onKeyDown(['a', 'left'], () => {\r\n        if (player.isRemote || !windowHasFocus) return;\r\n        if (keysNeedRelease.a || keysNeedRelease.left) return;\r\n        moveDir.x = -1;\r\n        player.moveDir = moveDir;\r\n    });\r\n\r\n    k.onKeyDown(['d', 'right'], () => {\r\n        if (player.isRemote || !windowHasFocus) return;\r\n        if (keysNeedRelease.d || keysNeedRelease.right) return;\r\n        moveDir.x = 1;\r\n        player.moveDir = moveDir;\r\n    });\r\n\r\n    k.onKeyRelease(['w', 'up'], () => {\r\n        if (player.isRemote) return;\r\n        keysNeedRelease.w = false;\r\n        keysNeedRelease.up = false;\r\n        if (!k.isKeyDown('s') && !k.isKeyDown('down')) {\r\n            moveDir.y = 0;\r\n            player.moveDir = moveDir;\r\n        }\r\n    });\r\n\r\n    k.onKeyRelease(['s', 'down'], () => {\r\n        if (player.isRemote) return;\r\n        keysNeedRelease.s = false;\r\n        keysNeedRelease.down = false;\r\n        if (!k.isKeyDown('w') && !k.isKeyDown('up')) {\r\n            moveDir.y = 0;\r\n            player.moveDir = moveDir;\r\n        }\r\n    });\r\n\r\n    k.onKeyRelease(['a', 'left'], () => {\r\n        if (player.isRemote) return;\r\n        keysNeedRelease.a = false;\r\n        keysNeedRelease.left = false;\r\n        if (!k.isKeyDown('d') && !k.isKeyDown('right')) {\r\n            moveDir.x = 0;\r\n            player.moveDir = moveDir;\r\n        }\r\n    });\r\n\r\n    k.onKeyRelease(['d', 'right'], () => {\r\n        if (player.isRemote) return;\r\n        keysNeedRelease.d = false;\r\n        keysNeedRelease.right = false;\r\n        if (!k.isKeyDown('a') && !k.isKeyDown('left')) {\r\n            moveDir.x = 0;\r\n            player.moveDir = moveDir;\r\n        }\r\n    });\r\n\r\n    // Stop movement when window loses focus\r\n    const handleBlur = () => {\r\n        if (player.isRemote) return;\r\n        windowHasFocus = false;\r\n        moveDir.x = 0;\r\n        moveDir.y = 0;\r\n        player.moveDir = moveDir;\r\n        player.isShooting = false;\r\n        // Only mark keys that are currently held as needing release\r\n        keysNeedRelease = {\r\n            w: k.isKeyDown('w'),\r\n            s: k.isKeyDown('s'),\r\n            a: k.isKeyDown('a'),\r\n            d: k.isKeyDown('d'),\r\n            up: k.isKeyDown('up'),\r\n            down: k.isKeyDown('down'),\r\n            left: k.isKeyDown('left'),\r\n            right: k.isKeyDown('right')\r\n        };\r\n    };\r\n\r\n    const handleFocus = () => {\r\n        windowHasFocus = true;\r\n    };\r\n\r\n    window.addEventListener('blur', handleBlur);\r\n    window.addEventListener('focus', handleFocus);\r\n\r\n    // Clean up listeners when player is destroyed\r\n    player.onDestroy(() => {\r\n        window.removeEventListener('blur', handleBlur);\r\n        window.removeEventListener('focus', handleFocus);\r\n    });\r\n\r\n    // Update movement and immunity frames\r\n    player.onUpdate(() => {\r\n        // Sync outline position with player\r\n        if (player.outline && player.outline.exists()) {\r\n            player.outline.pos = player.pos.clone();\r\n        }\r\n\r\n        if (k.paused) return;\r\n\r\n        // Update immunity frames\r\n        if (player.invulnerable) {\r\n            player.invulnerableTime -= k.dt();\r\n            if (player.invulnerableTime <= 0) {\r\n                player.invulnerable = false;\r\n                player.color = k.rgb(...PLAYER_CONFIG.NORMAL_COLOR);\r\n                // Reset outline visibility\r\n                if (player.outline && player.outline.exists()) {\r\n                    player.outline.opacity = 1;\r\n                }\r\n            } else {\r\n                // Flash effect during immunity\r\n                const flashRate = PLAYER_CONFIG.IMMUNITY_FLASH_RATE;\r\n                const shouldShow = Math.floor(player.invulnerableTime * flashRate) % 2 === 0;\r\n                if (shouldShow) {\r\n                    player.color = k.rgb(...PLAYER_CONFIG.NORMAL_COLOR);\r\n                    if (player.outline && player.outline.exists()) {\r\n                        player.outline.opacity = 1;\r\n                    }\r\n                } else {\r\n                    player.color = k.rgb(...PLAYER_CONFIG.NORMAL_COLOR, PLAYER_CONFIG.IMMUNITY_ALPHA);\r\n                    if (player.outline && player.outline.exists()) {\r\n                        player.outline.opacity = PLAYER_CONFIG.IMMUNITY_ALPHA;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Don't allow movement if canMove is false (e.g., player is dead)\r\n        if (player.canMove === false) {\r\n            return;\r\n        }\r\n\r\n        // Update gamepad input polling\r\n        updateGamepadInput();\r\n\r\n        // For remote players, use network-provided move input instead of keyboard\r\n        let effectiveMoveDir = moveDir;\r\n        if (player.isRemote && player.move) {\r\n            effectiveMoveDir = k.vec2(player.move.x, player.move.y);\r\n        } else if (!player.isRemote) {\r\n            // Check for gamepad/touch input (overrides keyboard if active)\r\n            const altInput = getMovementInput();\r\n            if (altInput.x !== 0 || altInput.y !== 0) {\r\n                effectiveMoveDir = k.vec2(altInput.x, altInput.y);\r\n            }\r\n        }\r\n\r\n        if (effectiveMoveDir.len() > 0) {\r\n            const len = effectiveMoveDir.len();\r\n            const normalized = effectiveMoveDir.scale(1 / len);\r\n            const moveAmount = normalized.scale(player.speed * k.dt());\r\n            \r\n            // Check collision with obstacles before moving\r\n            const newX = player.pos.x + moveAmount.x;\r\n            const newY = player.pos.y + moveAmount.y;\r\n            \r\n            // Test collision with obstacles (walls and cover both block movement)\r\n            let canMoveX = true;\r\n            let canMoveY = true;\r\n\r\n            const obstacles = k.get('obstacle');\r\n            const playerSize = PLAYER_CONFIG.COLLISION_SIZE;\r\n            \r\n            for (const obstacle of obstacles) {\r\n                if (!obstacle.exists()) continue;\r\n                \r\n                // Check X movement\r\n                const obsLeft = obstacle.pos.x - obstacle.width / 2;\r\n                const obsRight = obstacle.pos.x + obstacle.width / 2;\r\n                const obsTop = obstacle.pos.y - obstacle.height / 2;\r\n                const obsBottom = obstacle.pos.y + obstacle.height / 2;\r\n                \r\n                const playerLeft = newX - playerSize;\r\n                const playerRight = newX + playerSize;\r\n                const playerTop = player.pos.y - playerSize;\r\n                const playerBottom = player.pos.y + playerSize;\r\n                \r\n                if (playerRight > obsLeft && playerLeft < obsRight &&\r\n                    playerBottom > obsTop && playerTop < obsBottom) {\r\n                    canMoveX = false;\r\n                }\r\n                \r\n                // Check Y movement\r\n                const playerLeftY = player.pos.x - playerSize;\r\n                const playerRightY = player.pos.x + playerSize;\r\n                const playerTopY = newY - playerSize;\r\n                const playerBottomY = newY + playerSize;\r\n                \r\n                if (playerRightY > obsLeft && playerLeftY < obsRight &&\r\n                    playerBottomY > obsTop && playerTopY < obsBottom) {\r\n                    canMoveY = false;\r\n                }\r\n            }\r\n            \r\n            // Apply movement if no collision\r\n            if (canMoveX) player.pos.x = newX;\r\n            if (canMoveY) player.pos.y = newY;\r\n        }\r\n        \r\n        // Keep player in bounds (room boundaries)\r\n        const roomWidth = k.width();\r\n        const roomHeight = k.height();\r\n        const margin = PLAYER_CONFIG.ROOM_MARGIN;\r\n\r\n        player.pos.x = k.clamp(player.pos.x, margin, roomWidth - margin);\r\n        player.pos.y = k.clamp(player.pos.y, margin, roomHeight - margin);\r\n    });\r\n\r\n    return player;\r\n}\r\n\r\n","/**\r\n * Network System - P2P Multiplayer using PeerJS\r\n * Handles connections, message passing, and state synchronization\r\n */\r\n\r\nimport { generateInviteCode } from './nameGenerator.js';\r\n\r\n// Debug flag - set to true to enable verbose network logging\r\nconst NET_DEBUG = false;\r\n\r\n// Network state\r\nconst network = {\r\n    peer: null,              // Our Peer instance\r\n    connections: new Map(),  // Map of peerId -> DataConnection\r\n    isHost: true,            // Are we the host?\r\n    hostId: null,            // Host's peer ID (null if we're host)\r\n    hostConnection: null,    // Connection to host (null if we're host)\r\n    messageHandlers: new Map(), // Message type -> handler function\r\n    connectionCallbacks: [], // Callbacks for when someone joins/leaves\r\n    isInitialized: false,\r\n    peerId: null            // Our peer ID (same as invite code for host)\r\n};\r\n\r\n/**\r\n * Initialize the network system\r\n * @param {string} inviteCode - Our invite code (will be our Peer ID if host)\r\n * @param {boolean} isHost - Whether we're the host\r\n * @returns {Promise<string>} Resolves with the actual invite code used (may differ if ID was taken)\r\n */\r\nexport function initNetwork(inviteCode, isHost = true) {\r\n    return new Promise((resolve, reject) => {\r\n        if (network.isInitialized) {\r\n            console.warn('Network already initialized');\r\n            resolve(inviteCode);\r\n            return;\r\n        }\r\n\r\n        // Clean up on page unload\r\n        window.addEventListener('beforeunload', () => {\r\n            disconnect();\r\n        });\r\n\r\n        // Check if PeerJS is available\r\n        if (typeof Peer === 'undefined') {\r\n            console.error('PeerJS library not loaded');\r\n            reject(new Error('PeerJS library not available'));\r\n            return;\r\n        }\r\n\r\n        network.isHost = isHost;\r\n\r\n        // Create peer with invite code as ID (for host) or random ID (for client)\r\n        const peerId = isHost ? `smash-${inviteCode}` : undefined;\r\n\r\n        // Auto-detect environment: use local PeerJS server for localhost, cloud for production\r\n        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\r\n\r\n        // Configure PeerJS connection based on environment\r\n        let peerConfig;\r\n        if (isLocalhost) {\r\n            // Localhost: use local PeerJS server\r\n            peerConfig = {\r\n                debug: 3, // Maximum debug logging\r\n                host: 'localhost',\r\n                port: 9000,\r\n                path: '/',\r\n                secure: false, // HTTP for localhost\r\n                config: {\r\n                    // STUN and TURN servers for reliable connection\r\n                    iceServers: [\r\n                        { urls: 'stun:stun.l.google.com:19302' },\r\n                        // Public TURN server as fallback relay\r\n                        {\r\n                            urls: 'turn:numb.viagenie.ca',\r\n                            username: 'webrtc@live.com',\r\n                            credential: 'muazkh'\r\n                        }\r\n                    ]\r\n                }\r\n            };\r\n        } else {\r\n            // Production (GitHub Pages): use PeerJS cloud service\r\n            peerConfig = {\r\n                debug: 2, // Moderate debug logging\r\n                // No host/port/path specified = uses PeerJS cloud service (cloud.peerjs.com)\r\n                secure: true, // HTTPS for production\r\n                config: {\r\n                    // STUN and TURN servers for reliable connection\r\n                    iceServers: [\r\n                        { urls: 'stun:stun.l.google.com:19302' },\r\n                        { urls: 'stun:stun1.l.google.com:19302' },\r\n                        // Public TURN server as fallback relay\r\n                        {\r\n                            urls: 'turn:numb.viagenie.ca',\r\n                            username: 'webrtc@live.com',\r\n                            credential: 'muazkh'\r\n                        }\r\n                    ]\r\n                }\r\n            };\r\n        }\r\n\r\n        try {\r\n            network.peer = new Peer(peerId, peerConfig);\r\n\r\n            network.peer.on('open', (id) => {\r\n                network.peerId = id;\r\n                network.isInitialized = true;\r\n\r\n                // For hosts, extract the 6-digit code from the peer ID (format: \"smash-123456\")\r\n                // For clients, just resolve with the full ID\r\n                const codeToReturn = (isHost && id.startsWith('smash-'))\r\n                    ? id.substring(6) // Extract \"123456\" from \"smash-123456\"\r\n                    : id;\r\n\r\n                resolve(codeToReturn);\r\n            });\r\n\r\n            network.peer.on('error', (err) => {\r\n                console.error('Peer error:', err);\r\n\r\n                // Handle unavailable-id error (peer ID already taken)\r\n                if (err.type === 'unavailable-id' && isHost) {\r\n                    console.warn('Peer ID already taken - generating new code and retrying...');\r\n\r\n                    // Fully cleanup the peer\r\n                    if (network.peer) {\r\n                        try {\r\n                            network.peer.destroy();\r\n                        } catch (e) {\r\n                            console.warn('Error destroying peer:', e);\r\n                        }\r\n                        network.peer = null;\r\n                        network.peerId = null;\r\n                        network.isInitialized = false;\r\n                    }\r\n\r\n                    // Wait a bit longer for cleanup to complete\r\n                    setTimeout(() => {\r\n                        // Generate a new invite code (just 6 digits, no prefix)\r\n                        const newCode = generateInviteCode();\r\n\r\n                        // Recursively call initNetwork with new code\r\n                        // This will create a NEW peer with `smash-${newCode}` format\r\n                        initNetwork(newCode, isHost).then(resolve).catch(reject);\r\n                    }, 2000); // Longer delay to ensure cleanup\r\n                    return;\r\n                }\r\n\r\n                // Provide user-friendly error messages\r\n                if (err.type === 'network') {\r\n                    console.warn('PeerJS server unavailable - multiplayer disabled');\r\n                } else if (err.type === 'peer-unavailable') {\r\n                    console.warn('Host not found - check invite code');\r\n                } else if (err.type === 'server-error') {\r\n                    console.warn('PeerJS server error - multiplayer may be unavailable');\r\n                }\r\n\r\n                if (!network.isInitialized) {\r\n                    reject(new Error(`Multiplayer unavailable: ${err.type || 'connection failed'}`));\r\n                }\r\n            });\r\n\r\n            // Host listens for incoming connections\r\n            if (isHost) {\r\n                network.peer.on('connection', (conn) => {\r\n                    handleIncomingConnection(conn);\r\n                });\r\n            }\r\n\r\n        } catch (err) {\r\n            console.error('Failed to create peer:', err);\r\n            reject(err);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Handle an incoming connection (host only)\r\n */\r\nfunction handleIncomingConnection(conn) {\r\n    if (!network.isHost) return;\r\n\r\n    conn.on('open', () => {\r\n        if (NET_DEBUG) console.log('Connection opened with:', conn.peer);\r\n        network.connections.set(conn.peer, conn);\r\n\r\n        // Notify callbacks\r\n        network.connectionCallbacks.forEach(cb => cb('join', conn.peer));\r\n    });\r\n\r\n    conn.on('data', (data) => {\r\n        handleMessage(data, conn.peer);\r\n    });\r\n\r\n    conn.on('close', () => {\r\n        if (NET_DEBUG) console.log('Connection closed with:', conn.peer);\r\n        network.connections.delete(conn.peer);\r\n\r\n        // Notify callbacks\r\n        network.connectionCallbacks.forEach(cb => cb('leave', conn.peer));\r\n    });\r\n\r\n    conn.on('error', (err) => {\r\n        console.error('Connection error with', conn.peer, ':', err);\r\n    });\r\n}\r\n\r\n/**\r\n * Connect to a host as a client\r\n * @param {string} hostInviteCode - The host's 6-digit invite code\r\n * @returns {Promise} Resolves when connected\r\n */\r\nexport function connectToHost(hostInviteCode) {\r\n    return new Promise((resolve, reject) => {\r\n        if (network.isHost) {\r\n            reject(new Error('Host cannot connect to another host'));\r\n            return;\r\n        }\r\n\r\n        if (!network.isInitialized) {\r\n            reject(new Error('Network not initialized'));\r\n            return;\r\n        }\r\n\r\n        const hostPeerId = `smash-${hostInviteCode}`;\r\n        if (NET_DEBUG) {\r\n            console.log('[NetworkSystem] Attempting to connect to host:', hostPeerId);\r\n            console.log('[NetworkSystem] Using STUN/TURN servers for NAT traversal...');\r\n        }\r\n\r\n        // Add connection timeout\r\n        let connectionTimeout;\r\n        let isResolved = false;\r\n\r\n        const conn = network.peer.connect(hostPeerId, {\r\n            reliable: true\r\n        });\r\n\r\n        // Set timeout for connection attempt (30 seconds)\r\n        connectionTimeout = setTimeout(() => {\r\n            if (!isResolved) {\r\n                console.error('[NetworkSystem] Connection timeout - host may be offline or unreachable');\r\n                console.error('[NetworkSystem] This could be due to:');\r\n                console.error('  - Host not found (wrong code or host offline)');\r\n                console.error('  - Firewall blocking connection');\r\n                console.error('  - NAT traversal failure (TURN servers may be overloaded)');\r\n                conn.close();\r\n                reject(new Error('Connection timeout - could not reach host'));\r\n            }\r\n        }, 30000);\r\n\r\n        conn.on('open', () => {\r\n            isResolved = true;\r\n            clearTimeout(connectionTimeout);\r\n            connectionTimeout = null; // Clear reference\r\n            network.hostConnection = conn;\r\n            network.hostId = hostPeerId;\r\n\r\n            // Don't send join_request here - partySystem.js will send it with full player info\r\n            resolve();\r\n        });\r\n\r\n        conn.on('data', (data) => {\r\n            handleMessage(data, hostPeerId);\r\n        });\r\n\r\n        conn.on('close', () => {\r\n            // Clear timeout to prevent race conditions\r\n            if (connectionTimeout) {\r\n                clearTimeout(connectionTimeout);\r\n                connectionTimeout = null;\r\n            }\r\n\r\n            network.hostConnection = null;\r\n            network.hostId = null;\r\n\r\n            // Notify callbacks\r\n            network.connectionCallbacks.forEach(cb => cb('host_disconnect'));\r\n        });\r\n\r\n        conn.on('error', (err) => {\r\n            isResolved = true;\r\n            clearTimeout(connectionTimeout);\r\n            connectionTimeout = null; // Clear reference\r\n            console.error('[NetworkSystem] Connection error:', err);\r\n            console.error('[NetworkSystem] Error type:', err.type || 'unknown');\r\n            reject(err);\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Handle incoming message\r\n */\r\nfunction handleMessage(data, fromPeerId) {\r\n    if (!data || !data.type) {\r\n        console.warn('Invalid message:', data);\r\n        return;\r\n    }\r\n\r\n    const handler = network.messageHandlers.get(data.type);\r\n    if (handler) {\r\n        handler(data.payload, fromPeerId);\r\n    } else {\r\n        console.warn('No handler for message type:', data.type);\r\n    }\r\n}\r\n\r\n/**\r\n * Register a message handler\r\n * @param {string} messageType - Type of message to handle\r\n * @param {Function} handler - Handler function (payload, fromPeerId) => void\r\n */\r\nexport function onMessage(messageType, handler) {\r\n    network.messageHandlers.set(messageType, handler);\r\n}\r\n\r\n/**\r\n * Unregister a message handler\r\n * @param {string} messageType - Type of message to remove\r\n */\r\nexport function offMessage(messageType) {\r\n    network.messageHandlers.delete(messageType);\r\n}\r\n\r\n/**\r\n * Clear all message handlers (useful for cleanup)\r\n */\r\nexport function clearAllMessageHandlers() {\r\n    network.messageHandlers.clear();\r\n}\r\n\r\n/**\r\n * Register a connection callback\r\n * @param {Function} callback - Callback function (event, peerId) => void\r\n *                              event can be 'join', 'leave', 'host_disconnect'\r\n */\r\nexport function onConnectionChange(callback) {\r\n    // Prevent duplicate callbacks\r\n    if (!network.connectionCallbacks.includes(callback)) {\r\n        network.connectionCallbacks.push(callback);\r\n    }\r\n}\r\n\r\n/**\r\n * Send message to host (client only)\r\n * @param {string} type - Message type\r\n * @param {any} payload - Message payload\r\n */\r\nexport function sendToHost(type, payload) {\r\n    if (network.isHost) {\r\n        console.warn('Host cannot send to itself');\r\n        return;\r\n    }\r\n\r\n    if (!network.hostConnection) {\r\n        console.warn('Not connected to host');\r\n        return;\r\n    }\r\n\r\n    network.hostConnection.send({ type, payload });\r\n}\r\n\r\n/**\r\n * Send message to specific peer (host only)\r\n * @param {string} peerId - Target peer ID\r\n * @param {string} type - Message type\r\n * @param {any} payload - Message payload\r\n */\r\nexport function sendToPeer(peerId, type, payload) {\r\n    if (!network.isHost) {\r\n        console.warn('Only host can send to specific peers');\r\n        return;\r\n    }\r\n\r\n    const conn = network.connections.get(peerId);\r\n    if (conn) {\r\n        conn.send({ type, payload });\r\n    } else {\r\n        console.warn('No connection to peer:', peerId);\r\n    }\r\n}\r\n\r\n/**\r\n * Broadcast message to all connected peers (host only)\r\n * @param {string} type - Message type\r\n * @param {any} payload - Message payload\r\n * @param {string[]} excludePeerIds - Peer IDs to exclude from broadcast\r\n */\r\nexport function broadcast(type, payload, excludePeerIds = []) {\r\n    if (!network.isHost) {\r\n        console.warn('Only host can broadcast');\r\n        return;\r\n    }\r\n\r\n    network.connections.forEach((conn, peerId) => {\r\n        if (!excludePeerIds.includes(peerId)) {\r\n            conn.send({ type, payload });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Disconnect from network\r\n */\r\nexport function disconnect() {\r\n    // Close all connections\r\n    if (network.isHost) {\r\n        network.connections.forEach(conn => conn.close());\r\n        network.connections.clear();\r\n    } else if (network.hostConnection) {\r\n        network.hostConnection.close();\r\n        network.hostConnection = null;\r\n        network.hostId = null;\r\n    }\r\n\r\n    // Destroy peer\r\n    if (network.peer) {\r\n        network.peer.destroy();\r\n        network.peer = null;\r\n    }\r\n\r\n    // Clear handlers and callbacks to prevent memory leaks\r\n    network.messageHandlers.clear();\r\n    network.connectionCallbacks = [];\r\n\r\n    network.isInitialized = false;\r\n    network.peerId = null;\r\n}\r\n\r\n/**\r\n * Get network state info\r\n */\r\nexport function getNetworkInfo() {\r\n    // Extract just the 6-digit code from peerId if it has \"smash-\" prefix\r\n    const displayCode = network.peerId && network.peerId.startsWith('smash-')\r\n        ? network.peerId.substring(6)\r\n        : network.peerId;\r\n\r\n    return {\r\n        isInitialized: network.isInitialized,\r\n        isHost: network.isHost,\r\n        peerId: displayCode, // Return clean code without \"smash-\" prefix\r\n        hostId: network.hostId,\r\n        connectedPeers: Array.from(network.connections.keys()),\r\n        peerCount: network.connections.size\r\n    };\r\n}\r\n\r\n/**\r\n * Check if we're connected to the network\r\n */\r\nexport function isConnected() {\r\n    if (network.isHost) {\r\n        return network.isInitialized;\r\n    } else {\r\n        return network.hostConnection !== null;\r\n    }\r\n}\r\n\r\n/**\r\n * Get all connected peer IDs (host only)\r\n */\r\nexport function getConnectedPeers() {\r\n    if (!network.isHost) return [];\r\n    return Array.from(network.connections.keys());\r\n}\r\n","/**\r\n * Party System\r\n * Manages multiplayer party state and joining\r\n */\r\n\r\nimport { getPlayerName, getInviteCode, getSelectedCharacter, setInviteCode, getPermanentUpgradeLevel, getSelectedPortrait, getPlayerLevel, getTotalXP, getSaveStats, getUnlockedAchievements, getUnlockedPortraits } from './metaProgression.js';\r\nimport {\r\n    initNetwork,\r\n    connectToHost,\r\n    onMessage,\r\n    onConnectionChange,\r\n    broadcast,\r\n    sendToHost,\r\n    sendToPeer,\r\n    getConnectedPeers,\r\n    getNetworkInfo,\r\n    disconnect\r\n} from './networkSystem.js';\r\nimport { sendInitialGameState, handlePlayerDisconnect as cleanupDisconnectedPlayer } from './multiplayerGame.js';\r\n\r\n// Party state\r\nconst party = {\r\n    slots: [\r\n        { playerId: 'local', playerName: null, inviteCode: null, selectedCharacter: null, selectedPortrait: null, isLocal: true, peerId: null, isReady: false }, // Slot 1: Local player\r\n        { playerId: null, playerName: null, inviteCode: null, selectedCharacter: null, selectedPortrait: null, isLocal: false, peerId: null, isReady: false }, // Slot 2: Empty\r\n        { playerId: null, playerName: null, inviteCode: null, selectedCharacter: null, selectedPortrait: null, isLocal: false, peerId: null, isReady: false }, // Slot 3: Empty\r\n        { playerId: null, playerName: null, inviteCode: null, selectedCharacter: null, selectedPortrait: null, isLocal: false, peerId: null, isReady: false }  // Slot 4: Empty\r\n    ],\r\n    isHost: true, // Local player is always the host for now\r\n    maxSlots: 4,\r\n    peerIdToSlot: new Map(), // Map peer IDs to slot indices\r\n    networkInitialized: false,\r\n    kaplayInstance: null, // Reference to kaplay instance for client game start\r\n    hostInviteCode: null, // The host's invite code (null if we are the host, or the code we joined if we're a client)\r\n    // Disconnect handling\r\n    disconnectedPlayers: new Map(), // Map slotIndex -> { disconnectTime, playerData }\r\n    reconnectWindow: 15000, // 15 seconds to reconnect\r\n    // Ready-up and countdown\r\n    countdownActive: false,\r\n    countdownStartTime: 0,\r\n    countdownDuration: 3000, // 3 seconds countdown\r\n    // Party emotes\r\n    activeEmotes: new Map(), // Map slotIndex -> { emoteType, startTime }\r\n    emoteCallbacks: [] // Callbacks to notify when emotes are received\r\n};\r\n\r\n// Flags to prevent duplicate handler registration (memory leak/freeze prevention)\r\nlet partyHostHandlersRegistered = false;\r\nlet partyClientHandlersRegistered = false;\r\n\r\n/**\r\n * Initialize party system\r\n * @param {Object} k - Kaplay instance (optional, used for client game start)\r\n */\r\nexport async function initParty(k = null) {\r\n    // Store kaplay instance for client game start\r\n    if (k) {\r\n        party.kaplayInstance = k;\r\n    }\r\n\r\n    // Only set local player info in slot 0 if we're the host\r\n    // For clients, their slot info is set by party_sync from the host\r\n    if (party.isHost) {\r\n        const playerName = getPlayerName();\r\n        const inviteCode = getInviteCode();\r\n        const selectedCharacter = getSelectedCharacter();\r\n        const selectedPortrait = getSelectedPortrait();\r\n\r\n        party.slots[0].playerId = 'local';\r\n        party.slots[0].playerName = playerName || 'Player'; // Fallback if name not set\r\n        party.slots[0].inviteCode = inviteCode || '000000'; // Fallback if code not set\r\n        party.slots[0].selectedCharacter = selectedCharacter || 'survivor'; // Fallback if character not set\r\n        party.slots[0].selectedPortrait = selectedPortrait || 'default'; // Fallback if portrait not set\r\n        party.slots[0].isLocal = true;\r\n        party.slots[0].permanentUpgradeLevels = {\r\n            startingHealth: getPermanentUpgradeLevel('startingHealth'),\r\n            startingDamage: getPermanentUpgradeLevel('startingDamage'),\r\n            startingSpeed: getPermanentUpgradeLevel('startingSpeed'),\r\n            propDurability: getPermanentUpgradeLevel('propDurability'),\r\n            propDropChance: getPermanentUpgradeLevel('propDropChance')\r\n        };\r\n\r\n        console.log('[PartySystem] Host player initialized in slot 0:', {\r\n            name: party.slots[0].playerName,\r\n            code: party.slots[0].inviteCode,\r\n            character: party.slots[0].selectedCharacter\r\n        });\r\n    } else {\r\n        console.log('[PartySystem] Client mode - preserving existing slot assignments');\r\n    }\r\n\r\n    // Initialize network as host so other players can connect\r\n    // This is needed because we display the invite code in the UI,\r\n    // meaning we're always potentially hosting\r\n    if (!party.networkInitialized) {\r\n        try {\r\n            console.log('[PartySystem] Initializing network as host...');\r\n            const inviteCode = getInviteCode();\r\n            const actualCode = await initNetwork(inviteCode, true);\r\n\r\n            // If the code changed (because it was taken), update it\r\n            if (actualCode !== inviteCode) {\r\n                console.log(`[PartySystem] Invite code changed: ${inviteCode} -> ${actualCode}`);\r\n                setInviteCode(actualCode);\r\n                party.slots[0].inviteCode = actualCode;\r\n            }\r\n\r\n            party.networkInitialized = true;\r\n            party.isHost = true;\r\n            setupNetworkHandlers();\r\n            console.log('[PartySystem] Network initialized as host - ready to accept connections');\r\n        } catch (err) {\r\n            console.error('[PartySystem] Failed to initialize network as host:', err);\r\n            console.log('[PartySystem] Multiplayer disabled - running in single-player mode');\r\n            // Continue anyway - single-player will still work\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Set up network message handlers (for host)\r\n */\r\nexport function setupNetworkHandlers() {\r\n    // Prevent duplicate handler registration (causes memory leaks and freezes)\r\n    if (partyHostHandlersRegistered) {\r\n        return;\r\n    }\r\n    partyHostHandlersRegistered = true;\r\n\r\n    // Handle join requests from clients\r\n    onMessage('join_request', (payload, fromPeerId) => {\r\n        console.log('[PartySystem] Join request from:', fromPeerId);\r\n        console.log('[PartySystem] Payload:', {\r\n            playerName: payload.playerName,\r\n            inviteCode: payload.inviteCode,\r\n            selectedCharacter: payload.selectedCharacter\r\n        });\r\n\r\n        // Validate payload has required data\r\n        if (!payload.playerName) {\r\n            console.warn('[PartySystem] Join request missing playerName, using default');\r\n        }\r\n\r\n        // Add player to party\r\n        const slotIndex = addPlayerToPartyFromNetwork(\r\n            payload.playerName || 'Player',\r\n            payload.inviteCode || '000000',\r\n            payload.selectedCharacter || 'survivor',\r\n            payload.selectedPortrait || 'default',\r\n            fromPeerId,\r\n            payload.permanentUpgradeLevels || null\r\n        );\r\n\r\n        if (slotIndex !== null) {\r\n            // Send party sync to the new player\r\n            const partySyncData = {\r\n                slots: party.slots.map(slot => ({\r\n                    playerId: slot.playerId,\r\n                    playerName: slot.playerName,\r\n                    inviteCode: slot.inviteCode,\r\n                    selectedCharacter: slot.selectedCharacter,\r\n                    selectedPortrait: slot.selectedPortrait,\r\n                    permanentUpgradeLevels: slot.permanentUpgradeLevels,\r\n                    isLocal: false // All remote for the client\r\n                })),\r\n                yourSlotIndex: slotIndex\r\n            };\r\n\r\n            console.log('[PartySystem] Sending party_sync to new player:', {\r\n                hostName: partySyncData.slots[0].playerName,\r\n                hostCharacter: partySyncData.slots[0].selectedCharacter,\r\n                newPlayerSlot: slotIndex\r\n            });\r\n\r\n            sendToPeer(fromPeerId, 'party_sync', partySyncData);\r\n\r\n            // Send immediate game state if in-game (don't wait for next broadcast cycle)\r\n            // This helps clients joining mid-game see entities immediately\r\n            // Use a slightly longer delay to ensure client has processed party_sync\r\n            // and initialized their game scene handlers\r\n            setTimeout(() => {\r\n                sendInitialGameState(fromPeerId);\r\n            }, 250); // Increased delay for slower connections\r\n\r\n            // Broadcast updated party to all other clients\r\n            broadcastPartyUpdate();\r\n        } else {\r\n            // Party full - send rejection\r\n            sendToPeer(fromPeerId, 'join_rejected', { reason: 'Party full' });\r\n        }\r\n    });\r\n\r\n    // Handle player info updates from clients\r\n    onMessage('player_info', (payload, fromPeerId) => {\r\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\r\n        if (slotIndex !== undefined) {\r\n            if (payload.playerName) {\r\n                party.slots[slotIndex].playerName = payload.playerName;\r\n            }\r\n            broadcastPartyUpdate();\r\n        }\r\n    });\r\n\r\n    // Handle character changes from clients\r\n    onMessage('character_change', (payload, fromPeerId) => {\r\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\r\n        if (slotIndex !== undefined) {\r\n            console.log(`[PartySystem] Player in slot ${slotIndex} changed character to:`, payload.selectedCharacter);\r\n            party.slots[slotIndex].selectedCharacter = payload.selectedCharacter;\r\n            broadcastPartyUpdate();\r\n        }\r\n    });\r\n\r\n    // Handle ready state changes from clients\r\n    onMessage('ready_change', (payload, fromPeerId) => {\r\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\r\n        if (slotIndex !== undefined) {\r\n            console.log(`[PartySystem] Player in slot ${slotIndex} ready state:`, payload.isReady);\r\n            party.slots[slotIndex].isReady = payload.isReady;\r\n            broadcastPartyUpdate();\r\n            // Check if all players are ready\r\n            checkAllReady();\r\n        }\r\n    });\r\n\r\n    // Handle party emotes from clients - rebroadcast to all\r\n    onMessage('party_emote', (payload, fromPeerId) => {\r\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\r\n        if (slotIndex !== undefined) {\r\n            // Set the slot index from the verified peer\r\n            payload.slotIndex = slotIndex;\r\n            // Store emote and notify callbacks\r\n            handlePartyEmote(payload);\r\n            // Rebroadcast to all clients\r\n            broadcast('party_emote', payload);\r\n        }\r\n    });\r\n\r\n    // Handle profile requests from clients\r\n    onMessage('profile_request', (payload, fromPeerId) => {\r\n        const targetSlot = payload.targetSlot;\r\n        if (targetSlot === 0) {\r\n            // Client wants host's profile\r\n            handleProfileRequest(payload, fromPeerId);\r\n        } else {\r\n            // Client wants another client's profile - forward the request\r\n            const targetPeerId = party.slots[targetSlot]?.peerId;\r\n            if (targetPeerId) {\r\n                sendToPeer(targetPeerId, 'profile_request', {\r\n                    requestingSlot: party.peerIdToSlot.get(fromPeerId),\r\n                    forwardTo: fromPeerId\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n    // Handle profile responses from clients\r\n    onMessage('profile_response', (payload, fromPeerId) => {\r\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\r\n        if (slotIndex !== undefined) {\r\n            payload.slotIndex = slotIndex;\r\n            // Check if this is a forwarded response\r\n            if (payload.forwardTo) {\r\n                sendToPeer(payload.forwardTo, 'profile_response', payload);\r\n            } else {\r\n                // This is for the host\r\n                handleProfileResponse(payload);\r\n            }\r\n        }\r\n    });\r\n\r\n    // Handle connection changes\r\n    onConnectionChange((event, peerId) => {\r\n        if (event === 'leave') {\r\n            handlePlayerDisconnect(peerId);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Get party state\r\n * @returns {object} Party state\r\n */\r\nexport function getParty() {\r\n    return party;\r\n}\r\n\r\n/**\r\n * Get local player\r\n * @returns {object} Local player slot\r\n */\r\nexport function getLocalPlayer() {\r\n    return party.slots[0];\r\n}\r\n\r\n// Re-export helper functions from metaProgression for convenience\r\nexport { getPlayerName, getInviteCode, getSelectedCharacter };\r\n\r\n/**\r\n * Get party size (number of players)\r\n * @returns {number} Number of players in party\r\n */\r\nexport function getPartySize() {\r\n    return party.slots.filter(slot => slot.playerId !== null).length;\r\n}\r\n\r\n/**\r\n * Check if party is full\r\n * @returns {boolean} True if all slots filled\r\n */\r\nexport function isPartyFull() {\r\n    return getPartySize() >= party.maxSlots;\r\n}\r\n\r\n/**\r\n * Get the invite code to display in UI\r\n * Returns the host's code if we're a client, or our own code if we're the host\r\n * @returns {string} Invite code to display\r\n */\r\nexport function getDisplayInviteCode() {\r\n    // If we're a client, show the host's code we joined\r\n    if (!party.isHost && party.hostInviteCode) {\r\n        return party.hostInviteCode;\r\n    }\r\n    // If we're the host, show our own code\r\n    return getInviteCode();\r\n}\r\n\r\n/**\r\n * Add player to party (when they join via code) - LEGACY, use joinPartyAsClient\r\n * @param {string} playerName - Player name\r\n * @param {string} inviteCode - Player invite code\r\n * @returns {number|null} Slot index if successful, null if party full\r\n */\r\nexport function addPlayerToParty(playerName, inviteCode) {\r\n    // Find first empty slot\r\n    for (let i = 1; i < party.slots.length; i++) {\r\n        if (party.slots[i].playerId === null) {\r\n            party.slots[i].playerId = `player_${Date.now()}_${i}`;\r\n            party.slots[i].playerName = playerName;\r\n            party.slots[i].inviteCode = inviteCode;\r\n            return i;\r\n        }\r\n    }\r\n    return null; // Party full\r\n}\r\n\r\n/**\r\n * Add player to party from network (host only)\r\n * @param {string} playerName - Player name\r\n * @param {string} inviteCode - Player invite code\r\n * @param {string} selectedCharacter - Player's selected character key\r\n * @param {string} peerId - Peer ID of the joining player\r\n * @returns {number|null} Slot index if successful, null if party full\r\n */\r\nfunction addPlayerToPartyFromNetwork(playerName, inviteCode, selectedCharacter, selectedPortrait, peerId, permanentUpgradeLevels = null) {\r\n    // Find first empty slot\r\n    for (let i = 1; i < party.slots.length; i++) {\r\n        if (party.slots[i].playerId === null) {\r\n            party.slots[i].playerId = `player_${Date.now()}_${i}`;\r\n            party.slots[i].playerName = playerName;\r\n            party.slots[i].inviteCode = inviteCode;\r\n            party.slots[i].selectedCharacter = selectedCharacter;\r\n            party.slots[i].selectedPortrait = selectedPortrait;\r\n            party.slots[i].peerId = peerId;\r\n            party.slots[i].permanentUpgradeLevels = permanentUpgradeLevels;\r\n            party.peerIdToSlot.set(peerId, i);\r\n            return i;\r\n        }\r\n    }\r\n    return null; // Party full\r\n}\r\n\r\n/**\r\n * Join a party as a client\r\n * @param {string} hostInviteCode - Host's 6-digit invite code\r\n * @returns {Promise<boolean>} True if successfully joined\r\n */\r\nexport async function joinPartyAsClient(hostInviteCode) {\r\n    // Save local player info before clearing (for restoration on failure)\r\n    const savedLocalPlayer = {\r\n        playerName: getPlayerName(),\r\n        inviteCode: getInviteCode(),\r\n        selectedCharacter: getSelectedCharacter()\r\n    };\r\n\r\n    try {\r\n        // Always clear party slots when joining as client - they'll be repopulated by party_sync\r\n        console.log('[PartySystem] Joining as client - clearing all party slots');\r\n        for (let i = 0; i < party.slots.length; i++) {\r\n            party.slots[i] = {\r\n                playerId: null,\r\n                playerName: null,\r\n                inviteCode: null,\r\n                selectedCharacter: null,\r\n                selectedPortrait: null,\r\n                isLocal: false,\r\n                peerId: null\r\n            };\r\n        }\r\n\r\n        // If we were initialized as host, disconnect and re-initialize as client\r\n        if (party.networkInitialized && party.isHost) {\r\n            console.log('[PartySystem] Switching from host to client - disconnecting current peer...');\r\n            disconnect();\r\n            party.networkInitialized = false;\r\n            party.isHost = false;\r\n            // Reset handler flags to allow client handler registration\r\n            partyHostHandlersRegistered = false;\r\n            partyClientHandlersRegistered = false;\r\n        }\r\n\r\n        // Initialize network as client\r\n        if (!party.networkInitialized) {\r\n            await initNetwork('client', false);\r\n            party.networkInitialized = true;\r\n            party.isHost = false;\r\n        }\r\n\r\n        // Store the host's invite code so we can display it\r\n        party.hostInviteCode = hostInviteCode;\r\n\r\n        // Set up client message handlers\r\n        setupClientHandlers();\r\n\r\n        // Connect to host\r\n        await connectToHost(hostInviteCode);\r\n\r\n        // Send our player info including selected character, portrait, and permanent upgrades\r\n        sendToHost('join_request', {\r\n            playerName: savedLocalPlayer.playerName,\r\n            inviteCode: savedLocalPlayer.inviteCode,\r\n            selectedCharacter: savedLocalPlayer.selectedCharacter,\r\n            selectedPortrait: getSelectedPortrait() || 'default',\r\n            permanentUpgradeLevels: {\r\n                startingHealth: getPermanentUpgradeLevel('startingHealth'),\r\n                startingDamage: getPermanentUpgradeLevel('startingDamage'),\r\n                startingSpeed: getPermanentUpgradeLevel('startingSpeed'),\r\n                propDurability: getPermanentUpgradeLevel('propDurability'),\r\n                propDropChance: getPermanentUpgradeLevel('propDropChance')\r\n            }\r\n        });\r\n\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Failed to join party:', err);\r\n\r\n        // Restore local player to solo party state on failure\r\n        console.log('[PartySystem] Restoring local player after join failure');\r\n        restoreLocalPlayerToSoloParty(savedLocalPlayer);\r\n\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Restore local player to solo party state (after failed/cancelled join)\r\n * @param {Object} playerInfo - Saved player info {playerName, inviteCode, selectedCharacter}\r\n */\r\nexport function restoreLocalPlayerToSoloParty(playerInfo) {\r\n    // Disconnect network if still trying to connect as client\r\n    if (party.networkInitialized && !party.isHost) {\r\n        disconnect();\r\n    }\r\n\r\n    // Reset to host state\r\n    party.isHost = true;\r\n    party.hostInviteCode = null;\r\n    party.networkInitialized = false;\r\n\r\n    // Reset handler registration flags to allow re-registration\r\n    partyHostHandlersRegistered = false;\r\n    partyClientHandlersRegistered = false;\r\n\r\n    // Clear all slots\r\n    for (let i = 0; i < party.slots.length; i++) {\r\n        party.slots[i] = {\r\n            playerId: null,\r\n            playerName: null,\r\n            inviteCode: null,\r\n            selectedCharacter: null,\r\n            isLocal: false,\r\n            peerId: null\r\n        };\r\n    }\r\n\r\n    // Restore local player in slot 0\r\n    party.slots[0] = {\r\n        playerId: 'local',\r\n        playerName: playerInfo.playerName || getPlayerName(),\r\n        inviteCode: playerInfo.inviteCode || getInviteCode(),\r\n        selectedCharacter: playerInfo.selectedCharacter || getSelectedCharacter(),\r\n        isLocal: true,\r\n        peerId: null\r\n    };\r\n\r\n    // Re-initialize as host (will restart network)\r\n    initParty(party.kaplayInstance).catch(err => {\r\n        console.warn('[PartySystem] Failed to re-initialize as host:', err);\r\n    });\r\n}\r\n\r\n/**\r\n * Set up network message handlers for client\r\n */\r\nfunction setupClientHandlers() {\r\n    // Prevent duplicate handler registration (causes memory leaks and freezes)\r\n    if (partyClientHandlersRegistered) {\r\n        return;\r\n    }\r\n    partyClientHandlersRegistered = true;\r\n\r\n    // Receive party state from host\r\n    onMessage('party_sync', (payload) => {\r\n        console.log('[PartySystem] Received party sync:', {\r\n            hostName: payload.slots[0].playerName,\r\n            hostCharacter: payload.slots[0].selectedCharacter,\r\n            yourSlot: payload.yourSlotIndex,\r\n            totalSlots: payload.slots.filter(s => s.playerId !== null).length\r\n        });\r\n\r\n        // Update our party state\r\n        party.slots = payload.slots;\r\n\r\n        // Mark our own slot as local\r\n        if (payload.yourSlotIndex !== undefined) {\r\n            party.slots[payload.yourSlotIndex].isLocal = true;\r\n            console.log(`[PartySystem] Marked slot ${payload.yourSlotIndex} as local`);\r\n        }\r\n\r\n        // Mark host's slot (slot 0) as remote\r\n        party.slots[0].isLocal = false;\r\n\r\n        // Debug: log party size and host info after sync\r\n        const partySize = party.slots.filter(s => s.playerId !== null).length;\r\n        console.log(`[PartySystem] Party synced successfully:`, {\r\n            partySize,\r\n            hostInSlot0: party.slots[0].playerName,\r\n            localSlot: payload.yourSlotIndex\r\n        });\r\n    });\r\n\r\n    // Handle join rejection\r\n    onMessage('join_rejected', (payload) => {\r\n        console.error('Join rejected:', payload.reason);\r\n        alert(`Failed to join party: ${payload.reason}`);\r\n    });\r\n\r\n    // Handle game start from host\r\n    onMessage('game_start', (payload) => {\r\n        console.log('Host started game - joining...');\r\n        // Automatically join the game when host starts\r\n        if (party.kaplayInstance) {\r\n            party.kaplayInstance.go('game', { resetState: true });\r\n        } else {\r\n            console.error('Cannot join game: Kaplay instance not available');\r\n        }\r\n    });\r\n\r\n    // Handle countdown start from host\r\n    onMessage('countdown_start', (payload) => {\r\n        console.log('[PartySystem] Countdown started by host:', payload.duration);\r\n        party.countdownActive = true;\r\n        party.countdownStartTime = Date.now();\r\n        party.countdownDuration = payload.duration || 3000;\r\n    });\r\n\r\n    // Handle countdown cancel from host\r\n    onMessage('countdown_cancel', () => {\r\n        console.log('[PartySystem] Countdown cancelled by host');\r\n        party.countdownActive = false;\r\n        party.countdownStartTime = 0;\r\n    });\r\n\r\n    // Handle party update with ready states\r\n    onMessage('party_update', (payload) => {\r\n        // Find which slot is local before updating\r\n        const localSlotIndex = party.slots.findIndex(slot => slot.isLocal);\r\n\r\n        // Update slots (includes ready states)\r\n        party.slots = payload.slots;\r\n\r\n        // Re-mark local slot (preserve isLocal flag)\r\n        if (localSlotIndex !== -1) {\r\n            party.slots[localSlotIndex].isLocal = true;\r\n        }\r\n    });\r\n\r\n    // Handle party emotes from host\r\n    onMessage('party_emote', (payload) => {\r\n        handlePartyEmote(payload);\r\n    });\r\n\r\n    // Handle profile request (forwarded from host or direct from host)\r\n    onMessage('profile_request', (payload) => {\r\n        handleProfileRequest(payload);\r\n    });\r\n\r\n    // Handle profile response\r\n    onMessage('profile_response', (payload) => {\r\n        handleProfileResponse(payload);\r\n    });\r\n\r\n    // Handle host disconnect\r\n    onConnectionChange((event) => {\r\n        if (event === 'host_disconnect') {\r\n            console.log('[PartySystem] Host disconnected - returning to solo party');\r\n            alert('Host disconnected - returning to main menu');\r\n\r\n            // Restore local player to solo party state\r\n            const savedLocalPlayer = {\r\n                playerName: getPlayerName(),\r\n                inviteCode: getInviteCode(),\r\n                selectedCharacter: getSelectedCharacter()\r\n            };\r\n            restoreLocalPlayerToSoloParty(savedLocalPlayer);\r\n\r\n            // Return to main menu\r\n            if (party.kaplayInstance) {\r\n                party.kaplayInstance.go('menu');\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast party update to all clients (host only)\r\n */\r\nfunction broadcastPartyUpdate() {\r\n    if (!party.isHost) return;\r\n\r\n    broadcast('party_update', {\r\n        slots: party.slots.map(slot => ({\r\n            playerId: slot.playerId,\r\n            playerName: slot.playerName,\r\n            inviteCode: slot.inviteCode,\r\n            selectedCharacter: slot.selectedCharacter,\r\n            selectedPortrait: slot.selectedPortrait,\r\n            permanentUpgradeLevels: slot.permanentUpgradeLevels,\r\n            isLocal: false, // Always false for remote players\r\n            isReady: slot.isReady || false,\r\n            isDisconnected: slot.isDisconnected || false\r\n        }))\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast game start to all clients (host only)\r\n */\r\nexport function broadcastGameStart() {\r\n    if (!party.isHost) return;\r\n\r\n    console.log('Broadcasting game start to all clients');\r\n    broadcast('game_start', {});\r\n}\r\n\r\n/**\r\n * Handle player disconnect (host only)\r\n * Starts a reconnection window instead of immediately removing\r\n * @param {string} peerId - Peer ID of disconnected player\r\n */\r\nfunction handlePlayerDisconnect(peerId) {\r\n    const slotIndex = party.peerIdToSlot.get(peerId);\r\n    if (slotIndex !== undefined) {\r\n        console.log('[PartySystem] Player disconnected from slot', slotIndex, '- starting reconnection window');\r\n\r\n        // Store player data for potential reconnection\r\n        const playerData = { ...party.slots[slotIndex] };\r\n\r\n        // Mark player as disconnected (but don't remove yet)\r\n        party.disconnectedPlayers.set(slotIndex, {\r\n            disconnectTime: Date.now(),\r\n            playerData: playerData,\r\n            peerId: peerId\r\n        });\r\n\r\n        // Mark the slot as disconnected (but keep the player info)\r\n        party.slots[slotIndex].isDisconnected = true;\r\n\r\n        // Broadcast disconnect status to all clients\r\n        broadcast('player_disconnected', {\r\n            slotIndex: slotIndex,\r\n            reconnectWindow: party.reconnectWindow\r\n        });\r\n\r\n        party.peerIdToSlot.delete(peerId);\r\n\r\n        // Set timeout to fully remove player if they don't reconnect\r\n        setTimeout(() => {\r\n            finalizeDisconnect(slotIndex);\r\n        }, party.reconnectWindow);\r\n    }\r\n}\r\n\r\n/**\r\n * Finalize player disconnect after reconnection window expires\r\n * @param {number} slotIndex - Slot index of the disconnected player\r\n */\r\nfunction finalizeDisconnect(slotIndex) {\r\n    const disconnectData = party.disconnectedPlayers.get(slotIndex);\r\n    if (!disconnectData) return; // Player already reconnected or was removed\r\n\r\n    console.log('[PartySystem] Reconnection window expired for slot', slotIndex, '- removing player');\r\n\r\n    // Clean up player entity from the game\r\n    cleanupDisconnectedPlayer(slotIndex);\r\n\r\n    // Remove from party\r\n    removePlayerFromParty(slotIndex);\r\n    party.disconnectedPlayers.delete(slotIndex);\r\n\r\n    // Broadcast final removal\r\n    broadcast('player_removed', { slotIndex: slotIndex });\r\n    broadcastPartyUpdate();\r\n}\r\n\r\n/**\r\n * Attempt to reconnect a player to their previous slot\r\n * @param {string} peerId - New peer ID of reconnecting player\r\n * @param {string} playerName - Player name for verification\r\n * @returns {number|null} - Slot index if reconnected, null if not found\r\n */\r\nexport function attemptReconnect(peerId, playerName) {\r\n    // Check if there's a disconnected player with this name\r\n    for (const [slotIndex, data] of party.disconnectedPlayers) {\r\n        if (data.playerData.playerName === playerName) {\r\n            console.log('[PartySystem] Player', playerName, 'reconnected to slot', slotIndex);\r\n\r\n            // Restore player to their slot\r\n            party.slots[slotIndex] = { ...data.playerData };\r\n            party.slots[slotIndex].peerId = peerId;\r\n            party.slots[slotIndex].isDisconnected = false;\r\n            party.peerIdToSlot.set(peerId, slotIndex);\r\n\r\n            // Clear disconnect data\r\n            party.disconnectedPlayers.delete(slotIndex);\r\n\r\n            // Broadcast reconnection\r\n            broadcast('player_reconnected', { slotIndex: slotIndex });\r\n            broadcastPartyUpdate();\r\n\r\n            return slotIndex;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Check if a player slot is disconnected\r\n * @param {number} slotIndex - Slot index to check\r\n * @returns {boolean} - True if player is disconnected\r\n */\r\nexport function isPlayerDisconnected(slotIndex) {\r\n    return party.slots[slotIndex]?.isDisconnected || false;\r\n}\r\n\r\n/**\r\n * Get time remaining for reconnection window\r\n * @param {number} slotIndex - Slot index to check\r\n * @returns {number} - Milliseconds remaining, 0 if not disconnected\r\n */\r\nexport function getReconnectTimeRemaining(slotIndex) {\r\n    const data = party.disconnectedPlayers.get(slotIndex);\r\n    if (!data) return 0;\r\n\r\n    const elapsed = Date.now() - data.disconnectTime;\r\n    return Math.max(0, party.reconnectWindow - elapsed);\r\n}\r\n\r\n/**\r\n * Remove player from party and shift remaining players up to fill the gap\r\n * @param {number} slotIndex - Slot to remove (1-3, can't remove slot 0)\r\n */\r\nfunction removePlayerFromPartyAndShift(slotIndex) {\r\n    if (slotIndex <= 0 || slotIndex >= party.slots.length) return;\r\n\r\n    console.log(`[PartySystem] Removing player from slot ${slotIndex} and shifting remaining players up`);\r\n\r\n    // Shift all players above this slot down by one\r\n    for (let i = slotIndex; i < party.slots.length - 1; i++) {\r\n        const nextSlot = party.slots[i + 1];\r\n\r\n        // Move next slot to current slot\r\n        party.slots[i] = { ...nextSlot };\r\n\r\n        // Update peer ID mapping if this slot has a peer\r\n        if (nextSlot.peerId) {\r\n            party.peerIdToSlot.set(nextSlot.peerId, i);\r\n        }\r\n    }\r\n\r\n    // Clear the last slot\r\n    party.slots[party.slots.length - 1] = {\r\n        playerId: null,\r\n        playerName: null,\r\n        inviteCode: null,\r\n        selectedCharacter: null,\r\n        isLocal: false,\r\n        peerId: null\r\n    };\r\n\r\n    console.log('[PartySystem] Slots after shift:', party.slots.map((s, i) => `${i}: ${s.playerName || 'empty'}`));\r\n}\r\n\r\n/**\r\n * Remove player from party\r\n * @param {number} slotIndex - Slot to clear (1-3, can't remove slot 0)\r\n * @returns {boolean} True if successful\r\n */\r\nexport function removePlayerFromParty(slotIndex) {\r\n    if (slotIndex > 0 && slotIndex < party.slots.length) {\r\n        // Remove from peer map if present\r\n        const peerId = party.slots[slotIndex].peerId;\r\n        if (peerId) {\r\n            party.peerIdToSlot.delete(peerId);\r\n        }\r\n\r\n        party.slots[slotIndex] = {\r\n            playerId: null,\r\n            playerName: null,\r\n            inviteCode: null,\r\n            selectedCharacter: null,\r\n            isLocal: false,\r\n            peerId: null,\r\n            isReady: false\r\n        };\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Update local player name\r\n * @param {string} newName - New player name\r\n */\r\nexport function updateLocalPlayerName(newName) {\r\n    party.slots[0].playerName = newName;\r\n}\r\n\r\n/**\r\n * Clear all remote players (used when disconnecting)\r\n */\r\nexport function clearRemotePlayers() {\r\n    for (let i = 1; i < party.slots.length; i++) {\r\n        removePlayerFromParty(i);\r\n    }\r\n}\r\n\r\n/**\r\n * Get formatted party info for display\r\n * @returns {Array} Array of slot info for UI\r\n */\r\nexport function getPartyDisplayInfo() {\r\n    return party.slots.map((slot, index) => ({\r\n        slotNumber: index + 1,\r\n        isEmpty: slot.playerId === null,\r\n        playerName: slot.playerName || 'Empty Slot',\r\n        isLocal: slot.isLocal,\r\n        inviteCode: slot.inviteCode,\r\n        selectedCharacter: slot.selectedCharacter || 'survivor',\r\n        selectedPortrait: slot.selectedPortrait || 'default',\r\n        isReady: slot.isReady || false,\r\n        isDisconnected: slot.isDisconnected || false\r\n    }));\r\n}\r\n\r\n/**\r\n * Check if multiplayer is available\r\n * @returns {boolean} True if multiplayer was successfully initialized\r\n */\r\nexport function isMultiplayerAvailable() {\r\n    return party.networkInitialized;\r\n}\r\n\r\n/**\r\n * Broadcast local player's character change to all party members\r\n * @param {string} characterKey - The new character key (e.g., 'scout', 'tank')\r\n */\r\nexport function broadcastCharacterChange(characterKey) {\r\n    // Update local slot\r\n    party.slots[0].selectedCharacter = characterKey;\r\n\r\n    if (!party.networkInitialized) {\r\n        return; // No network, no need to broadcast\r\n    }\r\n\r\n    if (party.isHost) {\r\n        // Host broadcasts to all clients\r\n        broadcastPartyUpdate();\r\n    } else {\r\n        // Client sends to host\r\n        sendToHost('character_change', {\r\n            selectedCharacter: characterKey\r\n        });\r\n    }\r\n}\r\n\r\n// ==========================================\r\n// Ready-up System\r\n// ==========================================\r\n\r\n/**\r\n * Toggle ready state for local player\r\n * @returns {boolean} - New ready state\r\n */\r\nexport function toggleReady() {\r\n    const localSlot = getLocalPlayerSlot();\r\n    if (localSlot === null) return false;\r\n\r\n    party.slots[localSlot].isReady = !party.slots[localSlot].isReady;\r\n\r\n    // Broadcast ready state change\r\n    if (party.networkInitialized) {\r\n        if (party.isHost) {\r\n            broadcastPartyUpdate();\r\n            // Check if all players are ready\r\n            checkAllReady();\r\n        } else {\r\n            sendToHost('ready_change', {\r\n                isReady: party.slots[localSlot].isReady\r\n            });\r\n        }\r\n    }\r\n\r\n    return party.slots[localSlot].isReady;\r\n}\r\n\r\n/**\r\n * Get local player slot index\r\n * @returns {number|null} - Local player slot index, or null if not found\r\n */\r\nexport function getLocalPlayerSlot() {\r\n    const index = party.slots.findIndex(s => s.isLocal);\r\n    return index >= 0 ? index : null;\r\n}\r\n\r\n/**\r\n * Check if local player is ready\r\n * @returns {boolean} - True if ready\r\n */\r\nexport function isLocalPlayerReady() {\r\n    const localSlot = getLocalPlayerSlot();\r\n    return localSlot !== null && party.slots[localSlot].isReady;\r\n}\r\n\r\n/**\r\n * Check if all players are ready (host only)\r\n * @returns {boolean} - True if all ready\r\n */\r\nexport function areAllPlayersReady() {\r\n    const occupiedSlots = party.slots.filter(s => s.playerId !== null);\r\n    if (occupiedSlots.length < 2) return false; // Need at least 2 players\r\n\r\n    return occupiedSlots.every(s => s.isReady);\r\n}\r\n\r\n/**\r\n * Check if all players are ready and start countdown (host only)\r\n */\r\nfunction checkAllReady() {\r\n    if (!party.isHost) return;\r\n\r\n    if (areAllPlayersReady() && !party.countdownActive) {\r\n        startCountdown();\r\n    } else if (!areAllPlayersReady() && party.countdownActive) {\r\n        cancelCountdown();\r\n    }\r\n}\r\n\r\n/**\r\n * Start the game countdown (host only)\r\n */\r\nfunction startCountdown() {\r\n    if (!party.isHost) return;\r\n\r\n    party.countdownActive = true;\r\n    party.countdownStartTime = Date.now();\r\n\r\n    // Broadcast countdown start\r\n    broadcast('countdown_start', {\r\n        duration: party.countdownDuration\r\n    });\r\n\r\n    console.log('[PartySystem] Countdown started');\r\n}\r\n\r\n/**\r\n * Cancel the game countdown (host only)\r\n */\r\nfunction cancelCountdown() {\r\n    if (!party.isHost) return;\r\n\r\n    party.countdownActive = false;\r\n    party.countdownStartTime = 0;\r\n\r\n    // Broadcast countdown cancel\r\n    broadcast('countdown_cancel', {});\r\n\r\n    console.log('[PartySystem] Countdown cancelled');\r\n}\r\n\r\n/**\r\n * Get countdown state\r\n * @returns {Object} - { active, timeRemaining }\r\n */\r\nexport function getCountdownState() {\r\n    if (!party.countdownActive) {\r\n        return { active: false, timeRemaining: 0 };\r\n    }\r\n\r\n    const elapsed = Date.now() - party.countdownStartTime;\r\n    const remaining = Math.max(0, party.countdownDuration - elapsed);\r\n\r\n    return {\r\n        active: true,\r\n        timeRemaining: remaining\r\n    };\r\n}\r\n\r\n/**\r\n * Reset all ready states (called after game ends)\r\n */\r\nexport function resetAllReadyStates() {\r\n    party.slots.forEach(slot => {\r\n        slot.isReady = false;\r\n    });\r\n    party.countdownActive = false;\r\n    party.countdownStartTime = 0;\r\n}\r\n\r\n// ==========================================\r\n// Party Emotes System\r\n// ==========================================\r\n\r\n/**\r\n * Handle incoming party emote (store and notify callbacks)\r\n * @param {Object} payload - { slotIndex, emoteType }\r\n */\r\nfunction handlePartyEmote(payload) {\r\n    const { slotIndex, emoteType } = payload;\r\n\r\n    // Store the emote with timestamp\r\n    party.activeEmotes.set(slotIndex, {\r\n        emoteType,\r\n        startTime: Date.now()\r\n    });\r\n\r\n    // Notify all registered callbacks\r\n    party.emoteCallbacks.forEach(callback => {\r\n        try {\r\n            callback(slotIndex, emoteType);\r\n        } catch (err) {\r\n            console.error('[PartySystem] Emote callback error:', err);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast an emote from the local player\r\n * @param {string} emoteType - 'exclamation' or 'heart'\r\n */\r\nexport function broadcastPartyEmote(emoteType) {\r\n    const localSlot = getLocalPlayerSlot();\r\n    if (localSlot === null) return;\r\n\r\n    const payload = { slotIndex: localSlot, emoteType };\r\n\r\n    // Handle locally first\r\n    handlePartyEmote(payload);\r\n\r\n    // Send to network if available\r\n    if (party.networkInitialized) {\r\n        if (party.isHost) {\r\n            // Host broadcasts directly to all clients\r\n            broadcast('party_emote', payload);\r\n        } else {\r\n            // Client sends to host (who will rebroadcast)\r\n            sendToHost('party_emote', payload);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Register a callback to be notified when emotes are received\r\n * @param {Function} callback - (slotIndex, emoteType) => void\r\n */\r\nexport function onPartyEmote(callback) {\r\n    party.emoteCallbacks.push(callback);\r\n}\r\n\r\n/**\r\n * Unregister an emote callback\r\n * @param {Function} callback - The callback to remove\r\n */\r\nexport function offPartyEmote(callback) {\r\n    const index = party.emoteCallbacks.indexOf(callback);\r\n    if (index !== -1) {\r\n        party.emoteCallbacks.splice(index, 1);\r\n    }\r\n}\r\n\r\n/**\r\n * Get active emote for a slot (if still valid)\r\n * @param {number} slotIndex - Slot to check\r\n * @param {number} maxAge - Max age in ms (default 2000ms)\r\n * @returns {string|null} - Emote type or null if no active emote\r\n */\r\nexport function getActiveEmote(slotIndex, maxAge = 2000) {\r\n    const emote = party.activeEmotes.get(slotIndex);\r\n    if (!emote) return null;\r\n\r\n    const age = Date.now() - emote.startTime;\r\n    if (age > maxAge) {\r\n        party.activeEmotes.delete(slotIndex);\r\n        return null;\r\n    }\r\n\r\n    return emote.emoteType;\r\n}\r\n\r\n/**\r\n * Clear all active emotes\r\n */\r\nexport function clearActiveEmotes() {\r\n    party.activeEmotes.clear();\r\n}\r\n\r\n/**\r\n * Clear all party callbacks to prevent memory leaks\r\n * Call this when cleaning up multiplayer session\r\n */\r\nexport function clearPartyCallbacks() {\r\n    party.emoteCallbacks = [];\r\n    party.activeEmotes.clear();\r\n    // Reset handler registration flags to allow re-registration on next session\r\n    partyHostHandlersRegistered = false;\r\n    partyClientHandlersRegistered = false;\r\n}\r\n\r\n// ==========================================\r\n// Profile Request System\r\n// ==========================================\r\n\r\n// Store pending profile request callbacks\r\nconst profileRequestCallbacks = new Map();\r\n\r\n/**\r\n * Get local player's profile data for sharing\r\n * @returns {Object} Profile data object\r\n */\r\nexport function getLocalProfileData() {\r\n    return {\r\n        playerName: getPlayerName(),\r\n        selectedPortrait: getSelectedPortrait(),\r\n        playerLevel: getPlayerLevel(),\r\n        totalXP: getTotalXP(),\r\n        stats: getSaveStats(),\r\n        achievements: getUnlockedAchievements(),\r\n        unlockedPortraits: getUnlockedPortraits()\r\n    };\r\n}\r\n\r\n/**\r\n * Request another player's profile data\r\n * @param {number} slotIndex - The slot index of the player to request\r\n * @param {Function} callback - Callback function (profileData) => void\r\n */\r\nexport function requestPlayerProfile(slotIndex, callback) {\r\n    const slot = party.slots[slotIndex];\r\n    if (!slot || slot.playerId === null) {\r\n        console.warn('[PartySystem] Cannot request profile for empty slot:', slotIndex);\r\n        callback(null);\r\n        return;\r\n    }\r\n\r\n    // If requesting our own profile, return local data\r\n    if (slot.isLocal) {\r\n        callback(getLocalProfileData());\r\n        return;\r\n    }\r\n\r\n    // Store the callback\r\n    profileRequestCallbacks.set(slotIndex, callback);\r\n\r\n    // Send the request\r\n    if (party.isHost) {\r\n        // Host sends directly to the peer\r\n        const peerId = slot.peerId;\r\n        if (peerId) {\r\n            sendToPeer(peerId, 'profile_request', { requestingSlot: getLocalPlayerSlot() });\r\n        } else {\r\n            console.warn('[PartySystem] No peerId for slot:', slotIndex);\r\n            callback(null);\r\n            profileRequestCallbacks.delete(slotIndex);\r\n        }\r\n    } else {\r\n        // Client sends request through host\r\n        sendToHost('profile_request', { targetSlot: slotIndex });\r\n    }\r\n\r\n    // Timeout after 5 seconds\r\n    setTimeout(() => {\r\n        if (profileRequestCallbacks.has(slotIndex)) {\r\n            console.warn('[PartySystem] Profile request timed out for slot:', slotIndex);\r\n            const cb = profileRequestCallbacks.get(slotIndex);\r\n            profileRequestCallbacks.delete(slotIndex);\r\n            cb(null);\r\n        }\r\n    }, 5000);\r\n}\r\n\r\n/**\r\n * Handle incoming profile request (called by message handlers)\r\n * @param {Object} payload - Request payload\r\n * @param {string} fromPeerId - Peer ID of requester (for host)\r\n */\r\nfunction handleProfileRequest(payload, fromPeerId = null) {\r\n    const profileData = getLocalProfileData();\r\n\r\n    if (party.isHost && fromPeerId) {\r\n        // Host responding to client request\r\n        sendToPeer(fromPeerId, 'profile_response', {\r\n            slotIndex: getLocalPlayerSlot(),\r\n            profileData\r\n        });\r\n    } else {\r\n        // Client responding to host\r\n        sendToHost('profile_response', {\r\n            slotIndex: getLocalPlayerSlot(),\r\n            profileData\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Handle incoming profile response\r\n * @param {Object} payload - Response payload with slotIndex and profileData\r\n */\r\nfunction handleProfileResponse(payload) {\r\n    const { slotIndex, profileData } = payload;\r\n\r\n    const callback = profileRequestCallbacks.get(slotIndex);\r\n    if (callback) {\r\n        profileRequestCallbacks.delete(slotIndex);\r\n        callback(profileData);\r\n    }\r\n}\r\n","/**\r\n * Boss Type Definitions\r\n *\r\n * All boss types and their properties.\r\n * Bosses have armor/shield systems and higher stats than regular enemies.\r\n */\r\n\r\nexport const BOSS_TYPES = {\r\n    gatekeeper: {\r\n        name: 'Studio Head',\r\n        coreChar: 'GG',\r\n        armorChar: '[]',\r\n        shieldChar: '{}',\r\n        color: [255, 50, 50], // Red\r\n        armorColor: [200, 200, 200], // Gray/white for armor\r\n        shieldColor: [100, 200, 255], // Light blue for shields\r\n        baseHealth: 500,\r\n        baseArmorHealth: 125, // 100-150 range, using middle\r\n        baseShieldHealth: 0, // No shields by default\r\n        baseSpeed: 70, // 60-80 range, using middle\r\n        size: 28,\r\n        baseXPValue: 125, // 100-150 range\r\n        damageReduction: 0.3, // 30% damage reduction when armor is active\r\n        shieldRegenRate: 0, // HP per second (0 = no regen)\r\n    },\r\n    swarmQueen: {\r\n        name: 'Showrunner',\r\n        coreChar: 'QQ',\r\n        armorChar: '[]',\r\n        shieldChar: '{}',\r\n        color: [200, 100, 255], // Purple\r\n        armorColor: [200, 200, 200],\r\n        shieldColor: [100, 200, 255], // Light blue for shields\r\n        baseHealth: 800,\r\n        baseArmorHealth: 175, // 150-200 range\r\n        baseShieldHealth: 0, // No shields by default\r\n        baseSpeed: 50, // 40-60 range\r\n        size: 28,\r\n        baseXPValue: 250, // 200-300 range\r\n        damageReduction: 0.35, // 35% damage reduction\r\n        shieldRegenRate: 0, // HP per second (0 = no regen)\r\n    },\r\n    twinGuardianMelee: {\r\n        name: 'Co-Host (Melee)',\r\n        coreChar: '',\r\n        armorChar: '[]',\r\n        shieldChar: '{}',\r\n        color: [255, 50, 50], // Red\r\n        armorColor: [200, 200, 200],\r\n        shieldColor: [100, 200, 255], // Light blue for shields\r\n        baseHealth: 600,\r\n        baseArmorHealth: 125,\r\n        baseShieldHealth: 0, // No shields by default\r\n        baseSpeed: 110, // Faster, aggressive\r\n        size: 28,\r\n        baseXPValue: 175, // Half of total (350/2)\r\n        damageReduction: 0.3,\r\n        meleeDamage: 22, // 20-25 range, using middle\r\n        shieldRegenRate: 0, // HP per second (0 = no regen)\r\n    },\r\n    twinGuardianRanged: {\r\n        name: 'Co-Host (Ranged)',\r\n        coreChar: '',\r\n        armorChar: '[]',\r\n        shieldChar: '{}',\r\n        color: [100, 150, 255], // Blue\r\n        armorColor: [200, 200, 200],\r\n        shieldColor: [100, 200, 255], // Light blue for shields\r\n        baseHealth: 600,\r\n        baseArmorHealth: 125,\r\n        baseShieldHealth: 0, // No shields by default\r\n        baseSpeed: 70, // 60-80 range, slower, maintains distance\r\n        size: 28,\r\n        baseXPValue: 175, // Half of total (350/2)\r\n        damageReduction: 0.3,\r\n        projectileDamage: 13, // 12-15 range, using middle\r\n        projectileSpeed: 250,\r\n        fireRate: 1.0, // Shots per second\r\n        shieldRegenRate: 0, // HP per second (0 = no regen)\r\n    }\r\n};\r\n\r\n/**\r\n * Get boss definition by type key\r\n * @param {string} type - Boss type key\r\n * @returns {object} Boss configuration\r\n */\r\nexport function getBossDefinition(type) {\r\n    return BOSS_TYPES[type] || BOSS_TYPES.gatekeeper;\r\n}\r\n\r\n/**\r\n * Get all boss types\r\n * @returns {Array<string>} Array of boss type keys\r\n */\r\nexport function getAllBossTypes() {\r\n    return Object.keys(BOSS_TYPES);\r\n}\r\n","/**\r\n * Boss Entity\r\n *\r\n * Creates and manages boss entities with advanced mechanics:\r\n * - Multi-layered defense system (shields, armor, health)\r\n * - Shield regeneration mechanics\r\n * - Visual state updates based on defense layers\r\n * - Unique boss types: Gatekeeper, Swarm Queen, Twin Guardians\r\n * - Spawning mechanics and minion control\r\n * - Floor-based stat scaling\r\n */\r\n\r\n// Entity imports\r\nimport { createEnemy } from './enemy.js';\r\nimport { createProjectile } from './projectile.js';\r\n\r\n// Data imports\r\nimport { getBossDefinition } from '../data/bosses.js';\r\n\r\n// Multiplayer imports\r\nimport { isMultiplayerActive, isHost, registerEnemy, broadcastDeathEvent, broadcastBossEnrage } from '../systems/multiplayerGame.js';\r\n\r\nexport function createBoss(k, x, y, type = 'gatekeeper', floor = 1, rng = null) {\r\n    const baseConfig = getBossDefinition(type);\r\n    \r\n    // Scale stats based on floor\r\n    const floorMultiplier = 1 + (floor - 1) * 0.2; // 20% increase per floor\r\n    const config = {\r\n        coreChar: baseConfig.coreChar,\r\n        armorChar: baseConfig.armorChar || '()',\r\n        shieldChar: baseConfig.shieldChar || '{}',\r\n        color: baseConfig.color,\r\n        armorColor: baseConfig.armorColor || [200, 200, 200],\r\n        shieldColor: baseConfig.shieldColor || [100, 200, 255],\r\n        health: Math.floor(baseConfig.baseHealth * floorMultiplier),\r\n        armorHealth: Math.floor((baseConfig.baseArmorHealth || 0) * floorMultiplier),\r\n        maxArmorHealth: Math.floor((baseConfig.baseArmorHealth || 0) * floorMultiplier),\r\n        shieldHealth: Math.floor((baseConfig.baseShieldHealth || 0) * floorMultiplier),\r\n        maxShieldHealth: Math.floor((baseConfig.baseShieldHealth || 0) * floorMultiplier),\r\n        speed: Math.floor(baseConfig.baseSpeed * (1 + (floor - 1) * 0.05)),\r\n        size: baseConfig.size,\r\n        xpValue: Math.floor(baseConfig.baseXPValue * floorMultiplier),\r\n        damageReduction: baseConfig.damageReduction || 0,\r\n        shieldRegenRate: (baseConfig.shieldRegenRate || 0) * floorMultiplier // Scale regen with floor\r\n    };\r\n    \r\n    // Build the visual representation based on armor state\r\n    function getBossVisual() {\r\n        const leftArmor = config.armorHealth > config.maxArmorHealth * 0.5 ? '(' : '';\r\n        const rightArmor = config.armorHealth > 0 ? ')' : '';\r\n        return `${leftArmor}${config.coreChar}${rightArmor}`;\r\n    }\r\n    \r\n    // Create boss entity with dynamic text\r\n    const boss = k.add([\r\n        k.text(getBossVisual(), { size: config.size }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...config.color),\r\n        k.area(),\r\n        k.health(config.health),\r\n        'boss'\r\n    ]);\r\n\r\n    boss.maxHealth = config.health;\r\n    boss.speed = config.speed;\r\n    boss.xpValue = config.xpValue;\r\n    boss.type = type;\r\n    boss.floor = floor;\r\n    boss.textSize = config.size; // Store text size for later use\r\n    boss.rng = rng; // Store seeded RNG for multiplayer synchronization\r\n    \r\n    // Store boss-specific stats\r\n    if (baseConfig.meleeDamage) boss.meleeDamage = baseConfig.meleeDamage;\r\n    if (baseConfig.projectileDamage) boss.projectileDamage = baseConfig.projectileDamage;\r\n    if (baseConfig.projectileSpeed) boss.projectileSpeed = baseConfig.projectileSpeed;\r\n    if (baseConfig.fireRate) boss.fireRate = baseConfig.fireRate;\r\n    \r\n    // Initialize enraged state for Twin Guardians\r\n    if (type === 'twinGuardianMelee' || type === 'twinGuardianRanged') {\r\n        boss.enraged = false;\r\n        boss.enrage = function() {\r\n            if (this.enraged) return;\r\n            this.enraged = true;\r\n            this.speed = Math.floor(this.speed * 1.5);\r\n            if (this.type === 'twinGuardianMelee') {\r\n                this.chargeCooldownTimer = 0;\r\n                this.meleeDamage = Math.floor(this.meleeDamage * 1.25);\r\n            } else { // Ranged\r\n                this.fireRate = this.fireRate * 1.5;\r\n                this.projectileDamage = Math.floor(this.projectileDamage * 1.25);\r\n            }\r\n            this.color = k.rgb(255, 200, 0);\r\n        }\r\n    }\r\n    \r\n    // Armor properties\r\n    boss.armorHealth = config.armorHealth;\r\n    boss.maxArmorHealth = config.maxArmorHealth;\r\n    boss.damageReduction = config.damageReduction;\r\n    boss.coreChar = config.coreChar;\r\n    boss.armorChar = config.armorChar;\r\n    boss.armorColor = config.armorColor;\r\n    \r\n    // Shield properties\r\n    boss.shieldHealth = config.shieldHealth;\r\n    boss.maxShieldHealth = config.maxShieldHealth;\r\n    boss.shieldRegenRate = config.shieldRegenRate;\r\n    boss.shieldChar = config.shieldChar;\r\n    boss.shieldColor = config.shieldColor;\r\n    boss.shieldRegenTimer = 0; // Timer for shield regeneration\r\n    boss.shieldRegenCooldown = 0; // Cooldown after taking damage (prevents regen)\r\n    boss.lastDamageTime = 0; // Track when last damaged\r\n    \r\n    // Function to update visual representation\r\n    boss.updateVisual = function() {\r\n        // Priority: Shields > Armor > Core\r\n        // Shields: {GG}\r\n        // Armor: [GG]\r\n        // Core: GG\r\n        \r\n        let leftShield = '';\r\n        let rightShield = '';\r\n        let leftArmor = '';\r\n        let rightArmor = '';\r\n        \r\n        // Shields take priority (outermost layer)\r\n        // Size scales with health: Full =  , Medium =  , Low =  \r\n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\r\n        if (boss.shieldHealth > 0) {\r\n            const shieldPercent = boss.shieldHealth / boss.maxShieldHealth;\r\n            \r\n            if (shieldPercent > 0.66) {\r\n                // Full shield (66-100%): Double brackets   (mathematical double brackets)\r\n                leftShield = '';\r\n                rightShield = '';\r\n            } else if (shieldPercent > 0.33) {\r\n                // Medium shield (33-66%): Left/right white parenthesis  \r\n                leftShield = '';\r\n                rightShield = '';\r\n            } else {\r\n                // Low shield (0-33%): Left/right angle brackets  \r\n                leftShield = '';\r\n                rightShield = '';\r\n            }\r\n        }\r\n        \r\n        // Armor (middle layer, can appear with shields: {[GG]})\r\n        // Size scales with health: Full =  , Medium =  , Low =  \r\n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\r\n        if (boss.armorHealth > 0) {\r\n            const armorPercent = boss.armorHealth / boss.maxArmorHealth;\r\n            \r\n            if (armorPercent > 0.66) {\r\n                // Full armor (66-100%): Double brackets   (mathematical double brackets)\r\n                leftArmor = '';\r\n                rightArmor = '';\r\n            } else if (armorPercent > 0.33) {\r\n                // Medium armor (33-66%): Left/right angle brackets  \r\n                leftArmor = '';\r\n                rightArmor = '';\r\n            } else {\r\n                // Low armor (0-33%): Left/right double angle brackets  \r\n                leftArmor = '';\r\n                rightArmor = '';\r\n            }\r\n        }\r\n        \r\n        // Visual format: {[GG]} (shields outside, armor inside)\r\n        const visual = `${leftShield}${leftArmor}${boss.coreChar}${rightArmor}${rightShield}`;\r\n        \r\n        // Update text directly (same approach as enemy and miniboss)\r\n        boss.text = visual;\r\n        \r\n        // Update color - use shield color if shields exist, otherwise boss color\r\n        if (boss.shieldHealth > 0) {\r\n            boss.color = k.rgb(...config.shieldColor);\r\n        } else {\r\n            boss.color = k.rgb(...config.color);\r\n        }\r\n    };\r\n    \r\n    // Function to take damage (handles shields, then armor, then health)\r\n    boss.takeDamage = function(damage) {\r\n        let shieldChanged = false;\r\n        let armorChanged = false;\r\n        const previousShieldHealth = boss.shieldHealth;\r\n        const previousArmorHealth = boss.armorHealth;\r\n        \r\n        // Track damage time for shield regen cooldown\r\n        boss.lastDamageTime = k.time();\r\n        const shieldRegenCooldownDuration = 3.0; // 3 seconds cooldown after taking damage\r\n        boss.shieldRegenCooldown = shieldRegenCooldownDuration;\r\n        \r\n        // Priority: Shields > Armor > Health\r\n        // Shields take normal damage (no reduction)\r\n        if (boss.shieldHealth > 0) {\r\n            const shieldDamage = Math.min(damage, boss.shieldHealth);\r\n            boss.shieldHealth = Math.max(0, boss.shieldHealth - shieldDamage);\r\n            shieldChanged = (boss.shieldHealth !== previousShieldHealth);\r\n            \r\n            // Remaining damage goes to armor/health\r\n            const remainingDamage = damage - shieldDamage;\r\n            if (remainingDamage > 0) {\r\n                boss.takeDamageInternal(remainingDamage);\r\n            }\r\n        } else {\r\n            // No shields - damage goes to armor/health\r\n            boss.takeDamageInternal(damage);\r\n        }\r\n        \r\n        armorChanged = (boss.armorHealth !== previousArmorHealth);\r\n        \r\n        // Update visual when shields or armor change\r\n        if (shieldChanged || armorChanged) {\r\n            boss.updateVisual();\r\n        }\r\n    };\r\n    \r\n    // Internal damage function (handles armor and health)\r\n    boss.takeDamageInternal = function(damage) {\r\n        // If armor exists, armor takes reduced damage first\r\n        if (boss.armorHealth > 0) {\r\n            // Apply damage reduction to armor damage\r\n            const reducedDamage = Math.floor(damage * (1 - boss.damageReduction));\r\n            const armorDamage = Math.min(reducedDamage, boss.armorHealth);\r\n            boss.armorHealth = Math.max(0, boss.armorHealth - armorDamage);\r\n            \r\n            // Remaining damage goes to boss, but reduced if armor still exists\r\n            const remainingDamage = damage - reducedDamage;\r\n            if (remainingDamage > 0) {\r\n                // If armor still exists, apply damage reduction\r\n                // If armor is destroyed, remaining damage goes through at full\r\n                const damageMultiplier = boss.armorHealth > 0 ? (1 - boss.damageReduction) : 1;\r\n                const finalDamage = Math.floor(remainingDamage * damageMultiplier);\r\n                boss.hurt(finalDamage);\r\n            }\r\n        } else {\r\n            // No armor - full damage\r\n            boss.hurt(damage);\r\n        }\r\n    };\r\n    \r\n    // Boss-specific mechanics initialization\r\n    boss.attackTimer = 0;\r\n    boss.minionSpawnTimer = 0;\r\n    boss.chargeCooldownTimer = 0; // Time until next charge can start\r\n    boss.chargeDurationTimer = 0; // Time spent charging\r\n    boss.radialBurstTimer = 0;\r\n    boss.isCharging = false;\r\n    boss.chargeDirection = null;\r\n    boss.chargeSpeed = 0;\r\n    boss.spawnedMinions = []; // Track minions for cleanup\r\n    boss.enraged = false; // For twin guardians enrage system\r\n    boss.twinPartner = null; // Reference to other guardian (for enrage system)\r\n    \r\n    // Get current phase based on health\r\n    boss.getPhase = function() {\r\n        const healthPercent = boss.hp() / boss.maxHealth;\r\n        if (healthPercent > 0.75) return 1;\r\n        if (healthPercent > 0.5) return 2;\r\n        return 3; // Enraged\r\n    };\r\n    \r\n    // Spawn minions function\r\n    boss.spawnMinions = function() {\r\n        if (!boss.exists()) return;\r\n\r\n        const phase = boss.getPhase();\r\n        const minionCount = phase === 1 ? 2 : phase === 2 ? 3 : 3; // 2-3 minions\r\n\r\n        for (let i = 0; i < minionCount; i++) {\r\n            // Spawn minions around boss in a circle\r\n            // Use seeded RNG if available (multiplayer), otherwise Math.random()\r\n            const angleVariation = boss.rng ? boss.rng.next() * 0.5 : Math.random() * 0.5;\r\n            const angle = (Math.PI * 2 / minionCount) * i + angleVariation;\r\n\r\n            const distanceVariation = boss.rng ? boss.rng.next() * 20 : Math.random() * 20;\r\n            const spawnDistance = 40 + distanceVariation;\r\n\r\n            const spawnX = boss.pos.x + Math.cos(angle) * spawnDistance;\r\n            const spawnY = boss.pos.y + Math.sin(angle) * spawnDistance;\r\n\r\n            // Randomly choose rusher or basic (as proxy for shooter)\r\n            const minionTypeRoll = boss.rng ? boss.rng.next() : Math.random();\r\n            const minionType = minionTypeRoll < 0.5 ? 'rusher' : 'basic';\r\n            const minion = createEnemy(k, spawnX, spawnY, minionType, floor);\r\n            minion.isBossMinion = true; // Mark as boss minion\r\n            boss.spawnedMinions.push(minion);\r\n\r\n            // Register minion for multiplayer sync\r\n            if (isMultiplayerActive() && isHost()) {\r\n                registerEnemy(minion, { type: minionType, floor: floor, isBossMinion: true });\r\n            }\r\n        }\r\n    };\r\n    \r\n    // Radial burst attack (8 directions)\r\n    boss.radialBurst = function() {\r\n        if (!boss.exists()) return;\r\n        \r\n        const directions = [\r\n            k.vec2(0, -1),   // N\r\n            k.vec2(0.707, -0.707), // NE\r\n            k.vec2(1, 0),    // E\r\n            k.vec2(0.707, 0.707),  // SE\r\n            k.vec2(0, 1),    // S\r\n            k.vec2(-0.707, 0.707), // SW\r\n            k.vec2(-1, 0),   // W\r\n            k.vec2(-0.707, -0.707) // NW\r\n        ];\r\n        \r\n        const phase = boss.getPhase();\r\n        const projectileSpeed = 200;\r\n        const projectileDamage = 12;\r\n        \r\n        directions.forEach(dir => {\r\n            const projectile = createProjectile(k, boss.pos.x, boss.pos.y, dir, projectileSpeed, projectileDamage, 0, 0, false);\r\n            projectile.isBossProjectile = true; // Mark as boss projectile\r\n            projectile.color = k.rgb(255, 100, 100); // Red color for boss projectiles\r\n        });\r\n    };\r\n    \r\n    // Charge attack\r\n    boss.startCharge = function(targetPos) {\r\n        if (!boss.exists()) return;\r\n        \r\n        boss.isCharging = true;\r\n        const dir = k.vec2(targetPos.x - boss.pos.x, targetPos.y - boss.pos.y);\r\n        if (dir.len() > 0) {\r\n            boss.chargeDirection = dir.unit();\r\n            // Charge speed is set before calling startCharge, or use default based on phase\r\n            if (!boss.chargeSpeed || boss.chargeSpeed === 0) {\r\n                const phase = boss.getPhase ? boss.getPhase() : 1;\r\n                boss.chargeSpeed = boss.speed * (phase === 1 ? 2.5 : phase === 2 ? 3.0 : 3.5); // Faster in later phases\r\n            }\r\n        }\r\n    };\r\n    \r\n    // AI based on boss type\r\n    boss.onUpdate(() => {\r\n        if (k.paused) return;\r\n        \r\n        // Shield regeneration (if shields exist and regen rate > 0)\r\n        // Only regen if cooldown has expired (not damaged recently) and boss is alive\r\n        if (boss.shieldRegenRate > 0 && boss.shieldHealth < boss.maxShieldHealth && boss.hp() > 0 && !boss.isDead) {\r\n            // Update cooldown timer\r\n            if (boss.shieldRegenCooldown > 0) {\r\n                boss.shieldRegenCooldown -= k.dt();\r\n            }\r\n            \r\n            // Only regenerate if cooldown has expired\r\n            if (boss.shieldRegenCooldown <= 0) {\r\n                boss.shieldRegenTimer += k.dt();\r\n                const regenInterval = 1.0; // Regenerate every second\r\n                \r\n                if (boss.shieldRegenTimer >= regenInterval) {\r\n                    const regenAmount = boss.shieldRegenRate * regenInterval;\r\n                    boss.shieldHealth = Math.min(boss.maxShieldHealth, boss.shieldHealth + regenAmount);\r\n                    boss.shieldRegenTimer = 0;\r\n                    \r\n                    // Update visual if shield regenerated\r\n                    if (boss.shieldHealth > 0) {\r\n                        boss.updateVisual();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Process burn DoT (Damage over Time) from flamethrower\r\n        if (boss.burnDuration > 0 && boss.hp() > 0 && !boss.isDead) {\r\n            boss.burnTimer = (boss.burnTimer || 0) + k.dt();\r\n            const burnTickInterval = 0.5; // Deal burn damage every 0.5 seconds\r\n\r\n            if (boss.burnTimer >= burnTickInterval) {\r\n                // In multiplayer, only host deals burn damage\r\n                if (!isMultiplayerActive() || isHost()) {\r\n                    // Deal burn damage\r\n                    if (boss.takeDamage) {\r\n                        boss.takeDamage(boss.burnDamage);\r\n                    } else {\r\n                        boss.hurt(boss.burnDamage);\r\n                    }\r\n                }\r\n\r\n                // Visual feedback for burn damage (orange tint) on all clients\r\n                const originalColor = boss.color;\r\n                boss.color = k.rgb(255, 150, 50);\r\n                k.wait(0.1, () => {\r\n                    if (boss.exists()) {\r\n                        boss.updateVisual();\r\n                    }\r\n                });\r\n\r\n                boss.burnTimer = 0;\r\n            }\r\n\r\n            // Decrease burn duration\r\n            boss.burnDuration -= k.dt();\r\n            if (boss.burnDuration <= 0) {\r\n                boss.burnDamage = 0;\r\n                boss.burnTimer = 0;\r\n            }\r\n        }\r\n\r\n        const player = k.get('player')[0];\r\n        if (!player || !player.exists()) return;\r\n        \r\n        const phase = boss.getPhase();\r\n        \r\n        // Gatekeeper-specific mechanics\r\n        if (boss.type === 'gatekeeper') {\r\n            boss.attackTimer += k.dt();\r\n            boss.minionSpawnTimer += k.dt();\r\n            boss.radialBurstTimer += k.dt();\r\n            \r\n            // Phase-based timing\r\n            const minionSpawnInterval = phase === 1 ? 8 : phase === 2 ? 6 : 5; // 8s  6s  5s\r\n            const chargeCooldown = 10; // 10 seconds between charges\r\n            const radialBurstInterval = phase === 1 ? 8 : phase === 2 ? 6 : 5; // 8s  6s  5s\r\n            \r\n            // Handle charge attack\r\n            if (boss.isCharging) {\r\n                const chargeMove = boss.chargeDirection.scale(boss.chargeSpeed * k.dt());\r\n                boss.pos.x += chargeMove.x;\r\n                boss.pos.y += chargeMove.y;\r\n                \r\n                // Track charge duration\r\n                boss.chargeDurationTimer += k.dt();\r\n                const chargeDuration = 1.0;\r\n                if (boss.chargeDurationTimer >= chargeDuration) {\r\n                    boss.isCharging = false;\r\n                    boss.chargeDurationTimer = 0;\r\n                    boss.chargeCooldownTimer = 0; // Reset cooldown after charge ends\r\n                }\r\n            } else {\r\n                // Increment charge cooldown timer when not charging\r\n                boss.chargeCooldownTimer += k.dt();\r\n                // Normal movement (slower when not charging)\r\n                const dir = k.vec2(\r\n                    player.pos.x - boss.pos.x,\r\n                    player.pos.y - boss.pos.y\r\n                );\r\n                const distance = dir.len();\r\n                \r\n                if (distance > 0) {\r\n                    const normalized = dir.unit();\r\n                    // Movement speed scales with phase\r\n                    const moveSpeed = boss.speed * (phase === 1 ? 1.0 : phase === 2 ? 1.2 : 1.5);\r\n                    const moveAmount = normalized.scale(moveSpeed * k.dt());\r\n                    \r\n                    // Check collision with obstacles\r\n                    const newX = boss.pos.x + moveAmount.x;\r\n                    const newY = boss.pos.y + moveAmount.y;\r\n                    \r\n                    let canMoveX = true;\r\n                    let canMoveY = true;\r\n                    \r\n                    const obstacles = k.get('obstacle');\r\n                    const bossSize = boss.size || 14;\r\n                    \r\n                    for (const obstacle of obstacles) {\r\n                        if (!obstacle.exists()) continue;\r\n                        \r\n                        const obsLeft = obstacle.pos.x - obstacle.width / 2;\r\n                        const obsRight = obstacle.pos.x + obstacle.width / 2;\r\n                        const obsTop = obstacle.pos.y - obstacle.height / 2;\r\n                        const obsBottom = obstacle.pos.y + obstacle.height / 2;\r\n                        \r\n                        // Check X movement\r\n                        const bossLeftX = newX - bossSize;\r\n                        const bossRightX = newX + bossSize;\r\n                        const bossTopX = boss.pos.y - bossSize;\r\n                        const bossBottomX = boss.pos.y + bossSize;\r\n                        \r\n                        if (bossRightX > obsLeft && bossLeftX < obsRight &&\r\n                            bossBottomX > obsTop && bossTopX < obsBottom) {\r\n                            canMoveX = false;\r\n                            if (boss.isCharging) {\r\n                                boss.isCharging = false;\r\n                                boss.chargeTimer = 0;\r\n                            }\r\n                        }\r\n                        \r\n                        // Check Y movement\r\n                        const bossLeftY = boss.pos.x - bossSize;\r\n                        const bossRightY = boss.pos.x + bossSize;\r\n                        const bossTopY = newY - bossSize;\r\n                        const bossBottomY = newY + bossSize;\r\n                        \r\n                        if (bossRightY > obsLeft && bossLeftY < obsRight &&\r\n                            bossBottomY > obsTop && bossTopY < obsBottom) {\r\n                            canMoveY = false;\r\n                            if (boss.isCharging) {\r\n                                boss.isCharging = false;\r\n                                boss.chargeTimer = 0;\r\n                            }\r\n                        }\r\n                    }\r\n                    \r\n                    // Apply movement if no collision\r\n                    if (canMoveX) boss.pos.x = newX;\r\n                    if (canMoveY) boss.pos.y = newY;\r\n                }\r\n                \r\n                // Spawn minions\r\n                if (boss.minionSpawnTimer >= minionSpawnInterval) {\r\n                    boss.spawnMinions();\r\n                    boss.minionSpawnTimer = 0;\r\n                }\r\n                \r\n                // Charge attack\r\n                if (boss.chargeCooldownTimer >= chargeCooldown) {\r\n                    // Brief telegraph (flash color)\r\n                    boss.color = k.rgb(255, 255, 0);\r\n                    k.wait(0.3, () => {\r\n                        if (boss.exists()) {\r\n                            boss.color = k.rgb(...config.color);\r\n                            boss.startCharge(player.pos);\r\n                        }\r\n                    });\r\n                    boss.chargeCooldownTimer = 0;\r\n                }\r\n                \r\n                // Radial burst\r\n                if (boss.radialBurstTimer >= radialBurstInterval) {\r\n                    boss.radialBurst();\r\n                    boss.radialBurstTimer = 0;\r\n                }\r\n            }\r\n        } else if (boss.type === 'twinGuardianMelee') {\r\n            // Melee Guardian AI: Charge player, melee attacks\r\n            boss.attackTimer += k.dt();\r\n            boss.chargeCooldownTimer += k.dt();\r\n            \r\n            const chargeCooldown = 8; // 8 seconds between charges\r\n            const chargeDistance = 150; // Distance to start charge\r\n            \r\n            const dir = k.vec2(\r\n                player.pos.x - boss.pos.x,\r\n                player.pos.y - boss.pos.y\r\n            );\r\n            const distance = dir.len();\r\n            \r\n            // Handle charge attack\r\n            if (boss.isCharging) {\r\n                const chargeMove = boss.chargeDirection.scale(boss.chargeSpeed * k.dt());\r\n                boss.pos.x += chargeMove.x;\r\n                boss.pos.y += chargeMove.y;\r\n                \r\n                boss.chargeDurationTimer += k.dt();\r\n                const chargeDuration = 1.2;\r\n                if (boss.chargeDurationTimer >= chargeDuration) {\r\n                    boss.isCharging = false;\r\n                    boss.chargeDurationTimer = 0;\r\n                    boss.chargeCooldownTimer = 0;\r\n                }\r\n            } else {\r\n                // Normal movement - charge at player\r\n                if (distance > 0) {\r\n                    const normalized = dir.unit();\r\n                    const moveSpeed = boss.speed * (boss.enraged ? 1.5 : 1.0);\r\n                    const moveAmount = normalized.scale(moveSpeed * k.dt());\r\n                    \r\n                    // Check collision with obstacles\r\n                    const newX = boss.pos.x + moveAmount.x;\r\n                    const newY = boss.pos.y + moveAmount.y;\r\n                    \r\n                    let canMoveX = true;\r\n                    let canMoveY = true;\r\n                    \r\n                    const obstacles = k.get('obstacle');\r\n                    const bossSize = boss.size || 14;\r\n                    \r\n                    for (const obstacle of obstacles) {\r\n                        if (!obstacle.exists()) continue;\r\n                        \r\n                        const obsLeft = obstacle.pos.x - obstacle.width / 2;\r\n                        const obsRight = obstacle.pos.x + obstacle.width / 2;\r\n                        const obsTop = obstacle.pos.y - obstacle.height / 2;\r\n                        const obsBottom = obstacle.pos.y + obstacle.height / 2;\r\n                        \r\n                        const bossLeftX = newX - bossSize;\r\n                        const bossRightX = newX + bossSize;\r\n                        const bossTopX = boss.pos.y - bossSize;\r\n                        const bossBottomX = boss.pos.y + bossSize;\r\n                        \r\n                        if (bossRightX > obsLeft && bossLeftX < obsRight &&\r\n                            bossBottomX > obsTop && bossTopX < obsBottom) {\r\n                            canMoveX = false;\r\n                        }\r\n                        \r\n                        const bossLeftY = boss.pos.x - bossSize;\r\n                        const bossRightY = boss.pos.x + bossSize;\r\n                        const bossTopY = newY - bossSize;\r\n                        const bossBottomY = newY + bossSize;\r\n                        \r\n                        if (bossRightY > obsLeft && bossLeftY < obsRight &&\r\n                            bossBottomY > obsTop && bossTopY < obsBottom) {\r\n                            canMoveY = false;\r\n                        }\r\n                    }\r\n                    \r\n                    if (canMoveX) boss.pos.x = newX;\r\n                    if (canMoveY) boss.pos.y = newY;\r\n                }\r\n                \r\n                // Charge attack when close enough\r\n                if (boss.chargeCooldownTimer >= chargeCooldown && distance < chargeDistance) {\r\n                    boss.color = k.rgb(255, 255, 0); // Yellow telegraph\r\n                    k.wait(0.3, () => {\r\n                        if (boss.exists()) {\r\n                            boss.color = k.rgb(...config.color);\r\n                            // Set charge speed based on enrage\r\n                            const chargeSpeedMultiplier = boss.enraged ? 3.5 : 2.5;\r\n                            boss.chargeSpeed = boss.speed * chargeSpeedMultiplier;\r\n                            boss.startCharge(player.pos);\r\n                        }\r\n                    });\r\n                    boss.chargeCooldownTimer = 0;\r\n                }\r\n            }\r\n        } else if (boss.type === 'twinGuardianRanged') {\r\n            // Ranged Guardian AI: Maintain distance, fire projectiles\r\n            boss.attackTimer += k.dt();\r\n            \r\n            const preferredDistance = 200; // Maintain this distance from player\r\n            const dir = k.vec2(\r\n                player.pos.x - boss.pos.x,\r\n                player.pos.y - boss.pos.y\r\n            );\r\n            const distance = dir.len();\r\n            \r\n            // Movement: maintain distance from player\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                let moveSpeed = boss.speed * (boss.enraged ? 1.5 : 1.0);\r\n                \r\n                // Move away if too close, move closer if too far\r\n                if (distance < preferredDistance) {\r\n                    // Move away from player\r\n                    const moveAmount = normalized.scale(-moveSpeed * k.dt());\r\n                    const newX = boss.pos.x + moveAmount.x;\r\n                    const newY = boss.pos.y + moveAmount.y;\r\n                    \r\n                    // Check collision with obstacles\r\n                    let canMoveX = true;\r\n                    let canMoveY = true;\r\n                    const obstacles = k.get('obstacle');\r\n                    const bossSize = boss.size || 14;\r\n                    \r\n                    for (const obstacle of obstacles) {\r\n                        if (!obstacle.exists()) continue;\r\n                        \r\n                        const obsLeft = obstacle.pos.x - obstacle.width / 2;\r\n                        const obsRight = obstacle.pos.x + obstacle.width / 2;\r\n                        const obsTop = obstacle.pos.y - obstacle.height / 2;\r\n                        const obsBottom = obstacle.pos.y + obstacle.height / 2;\r\n                        \r\n                        const bossLeftX = newX - bossSize;\r\n                        const bossRightX = newX + bossSize;\r\n                        const bossTopX = boss.pos.y - bossSize;\r\n                        const bossBottomX = boss.pos.y + bossSize;\r\n                        \r\n                        if (bossRightX > obsLeft && bossLeftX < obsRight &&\r\n                            bossBottomX > obsTop && bossTopX < obsBottom) {\r\n                            canMoveX = false;\r\n                        }\r\n                        \r\n                        const bossLeftY = boss.pos.x - bossSize;\r\n                        const bossRightY = boss.pos.x + bossSize;\r\n                        const bossTopY = newY - bossSize;\r\n                        const bossBottomY = newY + bossSize;\r\n                        \r\n                        if (bossRightY > obsLeft && bossLeftY < obsRight &&\r\n                            bossBottomY > obsTop && bossTopY < obsBottom) {\r\n                            canMoveY = false;\r\n                        }\r\n                    }\r\n                    \r\n                    if (canMoveX) boss.pos.x = newX;\r\n                    if (canMoveY) boss.pos.y = newY;\r\n                } else if (distance > preferredDistance * 1.5) {\r\n                    // Move closer if too far\r\n                    const moveAmount = normalized.scale(moveSpeed * k.dt());\r\n                    const newX = boss.pos.x + moveAmount.x;\r\n                    const newY = boss.pos.y + moveAmount.y;\r\n                    \r\n                    // Check collision (same as above)\r\n                    let canMoveX = true;\r\n                    let canMoveY = true;\r\n                    const obstacles = k.get('obstacle');\r\n                    const bossSize = boss.size || 14;\r\n                    \r\n                    for (const obstacle of obstacles) {\r\n                        if (!obstacle.exists()) continue;\r\n                        \r\n                        const obsLeft = obstacle.pos.x - obstacle.width / 2;\r\n                        const obsRight = obstacle.pos.x + obstacle.width / 2;\r\n                        const obsTop = obstacle.pos.y - obstacle.height / 2;\r\n                        const obsBottom = obstacle.pos.y + obstacle.height / 2;\r\n                        \r\n                        const bossLeftX = newX - bossSize;\r\n                        const bossRightX = newX + bossSize;\r\n                        const bossTopX = boss.pos.y - bossSize;\r\n                        const bossBottomX = boss.pos.y + bossSize;\r\n                        \r\n                        if (bossRightX > obsLeft && bossLeftX < obsRight &&\r\n                            bossBottomX > obsTop && bossTopX < obsBottom) {\r\n                            canMoveX = false;\r\n                        }\r\n                        \r\n                        const bossLeftY = boss.pos.x - bossSize;\r\n                        const bossRightY = boss.pos.x + bossSize;\r\n                        const bossTopY = newY - bossSize;\r\n                        const bossBottomY = newY + bossSize;\r\n                        \r\n                        if (bossRightY > obsLeft && bossLeftY < obsRight &&\r\n                            bossBottomY > obsTop && bossTopY < obsBottom) {\r\n                            canMoveY = false;\r\n                        }\r\n                    }\r\n                    \r\n                    if (canMoveX) boss.pos.x = newX;\r\n                    if (canMoveY) boss.pos.y = newY;\r\n                }\r\n            }\r\n            \r\n            // Fire projectiles at player\r\n            const fireInterval = 1 / (boss.fireRate * (boss.enraged ? 1.5 : 1.0));\r\n            if (boss.attackTimer >= fireInterval) {\r\n                if (distance > 0) {\r\n                    const direction = dir.unit();\r\n                    const projectile = createProjectile(\r\n                        k, \r\n                        boss.pos.x, \r\n                        boss.pos.y, \r\n                        direction, \r\n                        boss.projectileSpeed, \r\n                        boss.projectileDamage * (boss.enraged ? 1.25 : 1.0), \r\n                        0, // piercing\r\n                        0, // obstaclePiercing\r\n                        false // isCrit\r\n                    );\r\n                    projectile.isBossProjectile = true;\r\n                    projectile.color = k.rgb(100, 150, 255); // Blue for ranged guardian\r\n                }\r\n                boss.attackTimer = 0;\r\n            }\r\n        } else if (boss.type === 'swarmQueen') {\r\n            // Swarm Queen mechanics\r\n            boss.minionSpawnTimer += k.dt();\r\n            \r\n            // Get health percentage for escalating spawn rate\r\n            const healthPercent = boss.hp() / boss.maxHealth;\r\n            let spawnInterval;\r\n            if (healthPercent > 0.66) {\r\n                spawnInterval = 5; // Every 5 seconds\r\n            } else if (healthPercent > 0.33) {\r\n                spawnInterval = 3; // Every 3 seconds\r\n            } else {\r\n                spawnInterval = 2; // Every 2 seconds (enraged)\r\n            }\r\n            \r\n            // Count active minions\r\n            const activeMinions = boss.spawnedMinions.filter(m => m.exists() && m.hp() > 0);\r\n            const maxMinions = 8; // Up to 8 minions active\r\n            \r\n            // Spawn minions if under limit\r\n            if (boss.minionSpawnTimer >= spawnInterval && activeMinions.length < maxMinions) {\r\n                // Spawn Bat or Slime (using fast or basic as proxy)\r\n                // Use seeded RNG for multiplayer consistency\r\n                const minionType = (boss.rng ? boss.rng.next() : Math.random()) < 0.5 ? 'fast' : 'basic';\r\n                const angle = (boss.rng ? boss.rng.next() : Math.random()) * Math.PI * 2;\r\n                const spawnDistance = 50 + (boss.rng ? boss.rng.next() : Math.random()) * 30;\r\n                const spawnX = boss.pos.x + Math.cos(angle) * spawnDistance;\r\n                const spawnY = boss.pos.y + Math.sin(angle) * spawnDistance;\r\n                \r\n                const minion = createEnemy(k, spawnX, spawnY, minionType, floor);\r\n                minion.isBossMinion = true;\r\n                boss.spawnedMinions.push(minion);\r\n                \r\n                // Remove dead minions from tracking\r\n                boss.spawnedMinions = boss.spawnedMinions.filter(m => m.exists());\r\n                \r\n                boss.minionSpawnTimer = 0;\r\n            }\r\n            \r\n            // Positioning: Move to center, maintain distance from player\r\n            const centerX = k.width() / 2;\r\n            const centerY = k.height() / 2;\r\n            const preferredDistance = 150; // Distance from player\r\n            \r\n            const toCenter = k.vec2(centerX - boss.pos.x, centerY - boss.pos.y);\r\n            const toPlayer = k.vec2(player.pos.x - boss.pos.x, player.pos.y - boss.pos.y);\r\n            const playerDistance = toPlayer.len();\r\n            \r\n            // Move toward center, but maintain distance from player\r\n            let moveDir = k.vec2(0, 0);\r\n            \r\n            if (toCenter.len() > 30) {\r\n                // Move toward center\r\n                moveDir = moveDir.add(toCenter.unit().scale(0.5));\r\n            }\r\n            \r\n            if (playerDistance < preferredDistance) {\r\n                // Move away from player\r\n                moveDir = moveDir.add(toPlayer.unit().scale(-1));\r\n            }\r\n            \r\n            if (moveDir.len() > 0) {\r\n                const normalized = moveDir.unit();\r\n                const moveAmount = normalized.scale(boss.speed * k.dt());\r\n                \r\n                // Check collision with obstacles\r\n                const newX = boss.pos.x + moveAmount.x;\r\n                const newY = boss.pos.y + moveAmount.y;\r\n                \r\n                let canMoveX = true;\r\n                let canMoveY = true;\r\n                \r\n                const obstacles = k.get('obstacle');\r\n                const bossSize = boss.size || 14;\r\n                \r\n                for (const obstacle of obstacles) {\r\n                    if (!obstacle.exists()) continue;\r\n                    \r\n                    const obsLeft = obstacle.pos.x - obstacle.width / 2;\r\n                    const obsRight = obstacle.pos.x + obstacle.width / 2;\r\n                    const obsTop = obstacle.pos.y - obstacle.height / 2;\r\n                    const obsBottom = obstacle.pos.y + obstacle.height / 2;\r\n                    \r\n                    const bossLeftX = newX - bossSize;\r\n                    const bossRightX = newX + bossSize;\r\n                    const bossTopX = boss.pos.y - bossSize;\r\n                    const bossBottomX = boss.pos.y + bossSize;\r\n                    \r\n                    if (bossRightX > obsLeft && bossLeftX < obsRight &&\r\n                        bossBottomX > obsTop && bossTopX < obsBottom) {\r\n                        canMoveX = false;\r\n                    }\r\n                    \r\n                    const bossLeftY = boss.pos.x - bossSize;\r\n                    const bossRightY = boss.pos.x + bossSize;\r\n                    const bossTopY = newY - bossSize;\r\n                    const bossBottomY = newY + bossSize;\r\n                    \r\n                    if (bossRightY > obsLeft && bossLeftY < obsRight &&\r\n                        bossBottomY > obsTop && bossTopY < obsBottom) {\r\n                        canMoveY = false;\r\n                    }\r\n                }\r\n                \r\n                if (canMoveX) boss.pos.x = newX;\r\n                if (canMoveY) boss.pos.y = newY;\r\n            }\r\n        } else {\r\n            // Default behavior for other boss types (just movement)\r\n            const dir = k.vec2(\r\n                player.pos.x - boss.pos.x,\r\n                player.pos.y - boss.pos.y\r\n            );\r\n            const distance = dir.len();\r\n            \r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                const moveAmount = normalized.scale(boss.speed * k.dt());\r\n                \r\n                // Check collision with obstacles (same as before)\r\n                const newX = boss.pos.x + moveAmount.x;\r\n                const newY = boss.pos.y + moveAmount.y;\r\n                \r\n                let canMoveX = true;\r\n                let canMoveY = true;\r\n                \r\n                const obstacles = k.get('obstacle');\r\n                const bossSize = boss.size || 14;\r\n                \r\n                for (const obstacle of obstacles) {\r\n                    if (!obstacle.exists()) continue;\r\n                    \r\n                    const obsLeft = obstacle.pos.x - obstacle.width / 2;\r\n                    const obsRight = obstacle.pos.x + obstacle.width / 2;\r\n                    const obsTop = obstacle.pos.y - obstacle.height / 2;\r\n                    const obsBottom = obstacle.pos.y + obstacle.height / 2;\r\n                    \r\n                    const bossLeftX = newX - bossSize;\r\n                    const bossRightX = newX + bossSize;\r\n                    const bossTopX = boss.pos.y - bossSize;\r\n                    const bossBottomX = boss.pos.y + bossSize;\r\n                    \r\n                    if (bossRightX > obsLeft && bossLeftX < obsRight &&\r\n                        bossBottomX > obsTop && bossTopX < obsBottom) {\r\n                        canMoveX = false;\r\n                    }\r\n                    \r\n                    const bossLeftY = boss.pos.x - bossSize;\r\n                    const bossRightY = boss.pos.x + bossSize;\r\n                    const bossTopY = newY - bossSize;\r\n                    const bossBottomY = newY + bossSize;\r\n                    \r\n                    if (bossRightY > obsLeft && bossLeftY < obsRight &&\r\n                        bossBottomY > obsTop && bossTopY < obsBottom) {\r\n                        canMoveY = false;\r\n                    }\r\n                }\r\n                \r\n                if (canMoveX) boss.pos.x = newX;\r\n                if (canMoveY) boss.pos.y = newY;\r\n            }\r\n        }\r\n        \r\n        // Keep boss in bounds (room boundaries) - same as player and enemies\r\n        const roomWidth = k.width();\r\n        const roomHeight = k.height();\r\n        const margin = 20;\r\n        const bossSize = boss.size || 14;\r\n        \r\n        boss.pos.x = k.clamp(boss.pos.x, margin + bossSize, roomWidth - margin - bossSize);\r\n        boss.pos.y = k.clamp(boss.pos.y, margin + bossSize, roomHeight - margin - bossSize);\r\n    });\r\n\r\n    // Mark as not dead initially\r\n    boss.isDead = false;\r\n\r\n    boss.onDeath(() => {\r\n        // In multiplayer, broadcast death event from host\r\n        if (isMultiplayerActive() && isHost() && boss.mpEntityId) {\r\n            broadcastDeathEvent({\r\n                entityId: boss.mpEntityId,\r\n                entityType: 'boss',\r\n                x: boss.pos.x,\r\n                y: boss.pos.y,\r\n                xpDropped: boss.xpValue\r\n            });\r\n        }\r\n    });\r\n    \r\n    // Swarm Queen death explosion handler\r\n    if (type === 'swarmQueen') {\r\n        boss.onDeath(() => {\r\n            // Spawn 8-12 minions in burst on death\r\n            // Use seeded RNG for multiplayer consistency\r\n            const minionCount = 8 + Math.floor((boss.rng ? boss.rng.next() : Math.random()) * 5); // 8-12 minions\r\n            for (let i = 0; i < minionCount; i++) {\r\n                const angle = (Math.PI * 2 / minionCount) * i + (boss.rng ? boss.rng.next() : Math.random()) * 0.3;\r\n                const spawnDistance = 40 + (boss.rng ? boss.rng.next() : Math.random()) * 20;\r\n                const spawnX = boss.pos.x + Math.cos(angle) * spawnDistance;\r\n                const spawnY = boss.pos.y + Math.sin(angle) * spawnDistance;\r\n\r\n                const minionType = (boss.rng ? boss.rng.next() : Math.random()) < 0.5 ? 'fast' : 'basic';\r\n                const minion = createEnemy(k, spawnX, spawnY, minionType, floor);\r\n                minion.isBossMinion = true;\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Initialize visual\r\n    boss.updateVisual();\r\n\r\n    // Multiplayer: Register boss for network sync if host\r\n    if (isMultiplayerActive() && isHost()) {\r\n        registerEnemy(boss, { type, floor, isBoss: true });\r\n        boss.enemyType = type; // Store type for sync\r\n    }\r\n\r\n    return boss;\r\n}\r\n\r\n// Spawn twin guardians as separate entities from opposite doors\r\nexport function createTwinGuardians(k, door1, door2, floor = 1, rng = null) {\r\n    // Spawn melee guardian from first door\r\n    const meleeGuardian = createBoss(k, door1.pos.x, door1.pos.y, 'twinGuardianMelee', floor, rng);\r\n\r\n    // Spawn ranged guardian from second door\r\n    const rangedGuardian = createBoss(k, door2.pos.x, door2.pos.y, 'twinGuardianRanged', floor, rng);\r\n    \r\n    // Link them together for enrage system\r\n    meleeGuardian.twinPartner = rangedGuardian;\r\n    rangedGuardian.twinPartner = meleeGuardian;\r\n    \r\n    // Set up death handlers for enrage system\r\n    meleeGuardian.onDeath(() => {\r\n        if (rangedGuardian && rangedGuardian.exists() && !rangedGuardian.enraged) {\r\n            // Enrage the ranged guardian\r\n            rangedGuardian.enrage();\r\n            if (isMultiplayerActive() && isHost()) {\r\n                broadcastBossEnrage(rangedGuardian.networkId);\r\n            }\r\n        }\r\n    });\r\n\r\n    rangedGuardian.onDeath(() => {\r\n        if (meleeGuardian && meleeGuardian.exists() && !meleeGuardian.enraged) {\r\n            // Enrage the melee guardian\r\n            meleeGuardian.enrage();\r\n            if (isMultiplayerActive() && isHost()) {\r\n                broadcastBossEnrage(meleeGuardian.networkId);\r\n            }\r\n        }\r\n    });\r\n    \r\n    return [meleeGuardian, rangedGuardian];\r\n}\r\n\r\n","/**\r\n * Powerup Weapon System\r\n *\r\n * Handles temporary weapon powerups that drop during gameplay:\r\n * - Limited ammo or timed duration\r\n * - More powerful than starting weapons\r\n * - Reverts to starting weapon when depleted\r\n */\r\n\r\nimport { WEAPON_DEFINITIONS } from '../data/weapons.js';\r\nimport { isMultiplayerActive, isHost, broadcastPowerupExpired } from './multiplayerGame.js';\r\nimport { getPermanentUpgradeLevel } from './metaProgression.js';\r\n\r\n// Powerup weapon definitions\r\nexport const POWERUP_WEAPONS = {\r\n    orbital: {\r\n        weaponKey: 'orbital',\r\n        name: 'Orbital Weapons',\r\n        duration: 30, // seconds\r\n        isTimeBased: true,\r\n        dropChance: 0.15, // 15% chance from enemies\r\n        icon: '',\r\n        color: [100, 200, 255]\r\n    },\r\n    explosive: {\r\n        weaponKey: 'explosive',\r\n        name: 'Explosive Launcher',\r\n        ammo: 20, // number of shots\r\n        isAmmoBased: true,\r\n        dropChance: 0.12, // 12% chance from enemies\r\n        icon: '',\r\n        color: [255, 100, 50]\r\n    },\r\n    chainLightning: {\r\n        weaponKey: 'chainLightning',\r\n        name: 'Chain Lightning',\r\n        ammo: 25, // number of shots\r\n        isAmmoBased: true,\r\n        dropChance: 0.12, // 12% chance from enemies\r\n        icon: '',\r\n        color: [255, 255, 100]\r\n    }\r\n};\r\n\r\n/**\r\n * Check if enemy should drop powerup weapon\r\n * @param {string} enemyType - Type of enemy killed\r\n * @param {number} floor - Current floor\r\n * @returns {string|null} - Powerup weapon key or null\r\n */\r\nexport function rollPowerupDrop(enemyType, floor = 1) {\r\n    // Only drop from tougher enemies\r\n    const eligibleEnemies = ['heavyTank', 'golem', 'shieldBearer', 'spawner', 'mage'];\r\n\r\n    if (!eligibleEnemies.includes(enemyType)) {\r\n        return null;\r\n    }\r\n\r\n    // Increased chance on higher floors\r\n    const floorMultiplier = 1 + (floor - 1) * 0.1;\r\n    \r\n    // Get prop drop chance upgrade level (+5% per level, max 25%)\r\n    const dropChanceLevel = getPermanentUpgradeLevel('propDropChance');\r\n    const dropChanceBonus = dropChanceLevel * 0.05; // +5% per level\r\n\r\n    for (const [key, powerup] of Object.entries(POWERUP_WEAPONS)) {\r\n        const adjustedChance = powerup.dropChance * floorMultiplier + dropChanceBonus;\r\n        // Cap at 100% chance\r\n        const finalChance = Math.min(adjustedChance, 1.0);\r\n        if (Math.random() < finalChance) {\r\n            return key;\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n/**\r\n * Apply powerup weapon to player\r\n * @param {object} player - Player entity\r\n * @param {string} powerupKey - Powerup weapon key\r\n */\r\nexport function applyPowerupWeapon(player, powerupKey) {\r\n    const powerup = POWERUP_WEAPONS[powerupKey];\r\n    if (!powerup) return;\r\n\r\n    const weaponDef = WEAPON_DEFINITIONS[powerup.weaponKey];\r\n    if (!weaponDef) return;\r\n\r\n    // Store original weapon state\r\n    if (!player.originalWeapon) {\r\n        player.originalWeapon = {\r\n            weaponKey: player.weaponKey,\r\n            weaponDef: player.weaponDef,\r\n            fireRate: player.fireRate,\r\n            projectileSpeed: player.projectileSpeed,\r\n            projectileDamage: player.projectileDamage,\r\n            projectileCount: player.projectileCount,\r\n            piercing: player.piercing,\r\n            obstaclePiercing: player.obstaclePiercing,\r\n            critChance: player.critChance,\r\n            critDamage: player.critDamage,\r\n            spreadAngle: player.spreadAngle,\r\n            weaponRange: player.weaponRange,\r\n            weaponCategory: player.weaponCategory\r\n        };\r\n\r\n        // Store weapon-specific properties if they exist\r\n        if (player.orbitRadius) player.originalWeapon.orbitRadius = player.orbitRadius;\r\n        if (player.rotationSpeed) player.originalWeapon.rotationSpeed = player.rotationSpeed;\r\n        if (player.explosionRadius) player.originalWeapon.explosionRadius = player.explosionRadius;\r\n        if (player.explosionDamage) player.originalWeapon.explosionDamage = player.explosionDamage;\r\n        if (player.chainRange) player.originalWeapon.chainRange = player.chainRange;\r\n        if (player.maxJumps) player.originalWeapon.maxJumps = player.maxJumps;\r\n        if (player.chainDamageReduction) player.originalWeapon.chainDamageReduction = player.chainDamageReduction;\r\n    }\r\n\r\n    // Apply powerup weapon\r\n    player.powerupWeapon = powerupKey;\r\n    player.weaponKey = powerup.weaponKey;\r\n    player.weaponDef = weaponDef;\r\n\r\n    // Apply weapon stats (don't use upgrade multipliers for powerups)\r\n    player.fireRate = weaponDef.fireRate;\r\n    player.projectileSpeed = weaponDef.projectileSpeed;\r\n    player.projectileDamage = weaponDef.baseDamage;\r\n    player.projectileCount = weaponDef.projectileCount;\r\n    player.piercing = weaponDef.piercing;\r\n    player.obstaclePiercing = weaponDef.obstaclePiercing;\r\n    player.critChance = weaponDef.critChance;\r\n    player.critDamage = weaponDef.critDamage;\r\n    player.spreadAngle = weaponDef.spreadAngle;\r\n    player.weaponRange = weaponDef.range;\r\n    player.weaponCategory = weaponDef.category;\r\n\r\n    // Apply weapon-specific properties\r\n    if (weaponDef.orbitRadius) {\r\n        player.orbitRadius = weaponDef.orbitRadius;\r\n        player.rotationSpeed = weaponDef.rotationSpeed;\r\n        player.orbitalOrbs = [];\r\n        player.orbitalAngles = [];\r\n        player.orbitalNeedsReinit = true;\r\n    }\r\n    if (weaponDef.explosionRadius) {\r\n        player.explosionRadius = weaponDef.explosionRadius;\r\n        player.explosionDamage = weaponDef.explosionDamage;\r\n    }\r\n    if (weaponDef.chainRange) {\r\n        player.chainRange = weaponDef.chainRange;\r\n        player.maxJumps = weaponDef.maxJumps;\r\n        player.chainDamageReduction = weaponDef.chainDamageReduction;\r\n    }\r\n\r\n    // Set ammo or duration\r\n    if (powerup.isAmmoBased) {\r\n        player.powerupAmmo = powerup.ammo;\r\n        player.powerupDuration = null;\r\n    } else if (powerup.isTimeBased) {\r\n        // Get prop durability upgrade level (+2 seconds per level, max +10 seconds)\r\n        const durabilityLevel = getPermanentUpgradeLevel('propDurability');\r\n        const durabilityBonus = durabilityLevel * 2; // +2 seconds per level\r\n        player.powerupDuration = powerup.duration + durabilityBonus;\r\n        player.powerupAmmo = null;\r\n    }\r\n}\r\n\r\n/**\r\n * Restore player's original weapon\r\n * @param {object} player - Player entity\r\n */\r\nexport function restoreOriginalWeapon(player) {\r\n    if (!player.originalWeapon) return;\r\n\r\n    const original = player.originalWeapon;\r\n\r\n    // Restore weapon state\r\n    player.weaponKey = original.weaponKey;\r\n    player.weaponDef = original.weaponDef;\r\n    player.fireRate = original.fireRate;\r\n    player.projectileSpeed = original.projectileSpeed;\r\n    player.projectileDamage = original.projectileDamage;\r\n    player.projectileCount = original.projectileCount;\r\n    player.piercing = original.piercing;\r\n    player.obstaclePiercing = original.obstaclePiercing;\r\n    player.critChance = original.critChance;\r\n    player.critDamage = original.critDamage;\r\n    player.spreadAngle = original.spreadAngle;\r\n    player.weaponRange = original.weaponRange;\r\n    player.weaponCategory = original.weaponCategory;\r\n\r\n    // Restore weapon-specific properties\r\n    if (original.orbitRadius) player.orbitRadius = original.orbitRadius;\r\n    if (original.rotationSpeed) player.rotationSpeed = original.rotationSpeed;\r\n    if (original.explosionRadius) player.explosionRadius = original.explosionRadius;\r\n    if (original.explosionDamage) player.explosionDamage = original.explosionDamage;\r\n    if (original.chainRange) player.chainRange = original.chainRange;\r\n    if (original.maxJumps) player.maxJumps = original.maxJumps;\r\n    if (original.chainDamageReduction) player.chainDamageReduction = original.chainDamageReduction;\r\n\r\n    // Clean up orbital weapons if switching away from orbital\r\n    if (player.weaponKey !== 'orbital' && player.orbitalOrbs) {\r\n        player.orbitalOrbs = [];\r\n        player.orbitalAngles = [];\r\n    }\r\n\r\n    // Clear powerup state\r\n    player.powerupWeapon = null;\r\n    player.powerupAmmo = null;\r\n    player.powerupDuration = null;\r\n    player.originalWeapon = null;\r\n}\r\n\r\n/**\r\n * Update powerup weapon state (called each shot for ammo-based, or each frame for time-based)\r\n * @param {object} player - Player entity\r\n * @param {number} dt - Delta time (for time-based powerups)\r\n * @returns {boolean} - True if powerup expired\r\n */\r\nexport function updatePowerupWeapon(player, dt = 0) {\r\n    if (!player.powerupWeapon) return false;\r\n\r\n    const powerup = POWERUP_WEAPONS[player.powerupWeapon];\r\n    if (!powerup) return false;\r\n\r\n    // Update ammo-based powerups\r\n    if (powerup.isAmmoBased && player.powerupAmmo !== null) {\r\n        if (player.powerupAmmo <= 0) {\r\n            // Broadcast expiration before restoring (only host in multiplayer)\r\n            if (isMultiplayerActive() && isHost() && player.slotIndex !== undefined) {\r\n                broadcastPowerupExpired(player.slotIndex, player.powerupWeapon);\r\n            }\r\n            restoreOriginalWeapon(player);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    // Update time-based powerups\r\n    if (powerup.isTimeBased && player.powerupDuration !== null) {\r\n        player.powerupDuration -= dt;\r\n        if (player.powerupDuration <= 0) {\r\n            // Broadcast expiration before restoring (only host in multiplayer)\r\n            if (isMultiplayerActive() && isHost() && player.slotIndex !== undefined) {\r\n                broadcastPowerupExpired(player.slotIndex, player.powerupWeapon);\r\n            }\r\n            restoreOriginalWeapon(player);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n/**\r\n * Decrement powerup ammo (call when player fires)\r\n * @param {object} player - Player entity\r\n */\r\nexport function decrementPowerupAmmo(player) {\r\n    if (!player.powerupWeapon) return;\r\n\r\n    const powerup = POWERUP_WEAPONS[player.powerupWeapon];\r\n    if (powerup && powerup.isAmmoBased && player.powerupAmmo !== null) {\r\n        player.powerupAmmo = Math.max(0, player.powerupAmmo - 1);\r\n    }\r\n}\r\n\r\n/**\r\n * Get powerup weapon display info\r\n * @param {object} player - Player entity\r\n * @returns {object|null} - Display info or null\r\n */\r\nexport function getPowerupDisplay(player) {\r\n    if (!player.powerupWeapon) return null;\r\n\r\n    const powerup = POWERUP_WEAPONS[player.powerupWeapon];\r\n    if (!powerup) return null;\r\n\r\n    return {\r\n        name: powerup.name,\r\n        icon: powerup.icon,\r\n        color: powerup.color,\r\n        ammo: player.powerupAmmo,\r\n        duration: player.powerupDuration,\r\n        isAmmoBased: powerup.isAmmoBased,\r\n        isTimeBased: powerup.isTimeBased\r\n    };\r\n}\r\n","// Pickup entity definitions\r\nimport { PICKUP_CONFIG } from '../config/constants.js';\r\nimport { POWERUP_WEAPONS } from '../systems/powerupWeapons.js';\r\nimport { registerPickup, isHost, isMultiplayerActive, unregisterPickup } from '../systems/multiplayerGame.js';\r\n\r\nexport function createXPPickup(k, x, y, value) {\r\n    const pickup = k.add([\r\n        k.text('+', { size: 16 }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...PICKUP_CONFIG.XP_COLOR),\r\n        k.area(),\r\n        k.scale(1),\r\n        'xpPickup'\r\n    ]);\r\n\r\n    pickup.value = value;\r\n    pickup.lifetime = PICKUP_CONFIG.XP_LIFETIME;\r\n    pickup.age = 0;\r\n    pickup.collected = false;\r\n\r\n    // Magnetization state\r\n    pickup.magnetizing = false; // Whether this pickup is being pulled toward player\r\n    pickup.magnetizeSpeed = 0; // Current magnetization speed (for acceleration)\r\n    pickup.targetPlayer = null; // Reference to player being magnetized to\r\n    pickup.isFlyingToUI = false;\r\n\r\n    // Bounce physics\r\n    pickup.velocityY = -150 - Math.random() * 100; // Initial upward velocity (randomized)\r\n    pickup.gravity = 600; // Gravity acceleration\r\n    pickup.groundY = y; // Ground level (spawn position)\r\n    pickup.bounceDamping = 0.5; // Energy loss per bounce\r\n    pickup.bouncing = true; // Whether still bouncing\r\n\r\n    // Visual effect - slight pulsing\r\n    let pulseDir = 1;\r\n    pickup.onUpdate(() => {\r\n        if (pickup.isFlyingToUI) {\r\n            const targetPos = k.vec2(k.width() / 2, k.height() - 18); // XP bar position\r\n            const dir = targetPos.sub(pickup.pos);\r\n            if (dir.len() < 10) {\r\n                k.destroy(pickup);\r\n            } else {\r\n                pickup.pos = pickup.pos.add(dir.unit().scale(1000 * k.dt()));\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (k.paused) {\r\n            // Still allow animation during pause for visual feedback\r\n            const pulse = Math.sin(pickup.age * PICKUP_CONFIG.XP_PULSE_SPEED) * PICKUP_CONFIG.XP_PULSE_AMOUNT;\r\n            pickup.scale = k.vec2(1 + pulse);\r\n            return;\r\n        }\r\n\r\n        pickup.age += k.dt();\r\n\r\n        // Pulse animation\r\n        const pulse = Math.sin(pickup.age * PICKUP_CONFIG.XP_PULSE_SPEED) * PICKUP_CONFIG.XP_PULSE_AMOUNT;\r\n        pickup.scale = k.vec2(1 + pulse);\r\n\r\n        // Bounce physics (only when not magnetizing)\r\n        if (!pickup.magnetizing && pickup.bouncing) {\r\n            // Apply gravity\r\n            pickup.velocityY += pickup.gravity * k.dt();\r\n            pickup.pos.y += pickup.velocityY * k.dt();\r\n\r\n            // Check for ground collision\r\n            if (pickup.pos.y >= pickup.groundY) {\r\n                pickup.pos.y = pickup.groundY;\r\n                pickup.velocityY = -pickup.velocityY * pickup.bounceDamping;\r\n\r\n                // Stop bouncing if velocity is very small\r\n                if (Math.abs(pickup.velocityY) < 20) {\r\n                    pickup.bouncing = false;\r\n                    pickup.velocityY = 0;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Magnetization movement - once magnetizing starts, it never stops\r\n        if (pickup.magnetizing && pickup.targetPlayer && pickup.targetPlayer.exists()) {\r\n            pickup.bouncing = false; // Stop bouncing when magnetizing\r\n\r\n            // Calculate direction to player\r\n            const dirToPlayer = k.vec2(\r\n                pickup.targetPlayer.pos.x - pickup.pos.x,\r\n                pickup.targetPlayer.pos.y - pickup.pos.y\r\n            );\r\n            const distance = dirToPlayer.len();\r\n\r\n            if (distance > 0) {\r\n                // Normalize direction\r\n                const dir = dirToPlayer.scale(1 / distance);\r\n\r\n                // Accelerate magnetization speed\r\n                pickup.magnetizeSpeed = Math.min(\r\n                    pickup.magnetizeSpeed + PICKUP_CONFIG.MAGNETIZE_ACCELERATION * k.dt(),\r\n                    PICKUP_CONFIG.MAGNETIZE_SPEED\r\n                );\r\n\r\n                // Move toward player\r\n                pickup.pos = pickup.pos.add(dir.scale(pickup.magnetizeSpeed * k.dt()));\r\n            }\r\n        }\r\n\r\n        // Despawn after lifetime\r\n        if (pickup.age >= pickup.lifetime) {\r\n            k.destroy(pickup);\r\n        }\r\n    });\r\n\r\n    // Multiplayer: Register pickup for network sync if host\r\n    pickup.pickupType = 'xp'; // Mark type for sync\r\n    if (isMultiplayerActive() && isHost()) {\r\n        registerPickup(pickup, { type: 'xpPickup', value });\r\n    }\r\n\r\n    // Cleanup: Remove from tracking map when destroyed (prevents memory leak)\r\n    if (isMultiplayerActive()) {\r\n        pickup.onDestroy(() => {\r\n            unregisterPickup(pickup);\r\n        });\r\n    }\r\n\r\n    return pickup;\r\n}\r\n\r\n// Currency icons for different types of money\r\nconst CURRENCY_ICONS = ['$', '', '', '', '', '', '', ''];\r\n\r\n// Get a random currency icon\r\nexport function getRandomCurrencyIcon() {\r\n    return CURRENCY_ICONS[Math.floor(Math.random() * CURRENCY_ICONS.length)];\r\n}\r\n\r\n// Create a currency pickup that can be collected for money\r\nexport function createCurrencyPickup(k, x, y, value, icon = null) {\r\n    // Use provided icon or random one\r\n    const currencyIcon = icon || getRandomCurrencyIcon();\r\n\r\n    const pickup = k.add([\r\n        k.text(currencyIcon, { size: 9 }), // Reduced from 18 to 9 (50% smaller)\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...PICKUP_CONFIG.CURRENCY_COLOR),\r\n        k.area(),\r\n        k.scale(1),\r\n        k.opacity(1),\r\n        'currencyPickup'\r\n    ]);\r\n\r\n    pickup.value = value;\r\n    pickup.lifetime = PICKUP_CONFIG.CURRENCY_LIFETIME;\r\n    pickup.age = 0;\r\n    pickup.collected = false;\r\n\r\n    // Magnetization state\r\n    pickup.magnetizing = false;\r\n    pickup.magnetizeSpeed = 0;\r\n    pickup.targetPlayer = null;\r\n    pickup.isFlyingToUI = false;\r\n\r\n    // Bounce physics\r\n    pickup.velocityY = -150 - Math.random() * 100; // Initial upward velocity (randomized)\r\n    pickup.gravity = 600; // Gravity acceleration\r\n    pickup.groundY = y; // Ground level (spawn position)\r\n    pickup.bounceDamping = 0.5; // Energy loss per bounce\r\n    pickup.bouncing = true; // Whether still bouncing\r\n\r\n    // Visual effect - slight pulsing with rotation, and flashing before despawn\r\n    pickup.onUpdate(() => {\r\n        if (pickup.isFlyingToUI) {\r\n            const targetPos = k.vec2(k.width() - 20, 20); // Currency UI position\r\n            const dir = targetPos.sub(pickup.pos);\r\n            if (dir.len() < 10) {\r\n                k.destroy(pickup);\r\n            } else {\r\n                pickup.pos = pickup.pos.add(dir.unit().scale(1000 * k.dt()));\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (k.paused) {\r\n            // Still allow animation during pause for visual feedback\r\n            const pulse = Math.sin(pickup.age * PICKUP_CONFIG.CURRENCY_PULSE_SPEED) * PICKUP_CONFIG.CURRENCY_PULSE_AMOUNT;\r\n            pickup.scale = k.vec2(1 + pulse);\r\n            return;\r\n        }\r\n\r\n        pickup.age += k.dt();\r\n\r\n        // Pulse animation\r\n        const pulse = Math.sin(pickup.age * PICKUP_CONFIG.CURRENCY_PULSE_SPEED) * PICKUP_CONFIG.CURRENCY_PULSE_AMOUNT;\r\n        pickup.scale = k.vec2(1 + pulse);\r\n\r\n        // Flashing effect when about to despawn (last 4 seconds)\r\n        const timeRemaining = pickup.lifetime - pickup.age;\r\n        if (timeRemaining <= 4 && timeRemaining > 0) {\r\n            // Flash faster as time runs out: 4Hz at 4s, up to 12Hz at 0s\r\n            const flashSpeed = 4 + (4 - timeRemaining) * 2;\r\n            const flash = Math.sin(pickup.age * flashSpeed * Math.PI * 2);\r\n            // Opacity oscillates between 0.3 and 1.0\r\n            pickup.opacity = 0.65 + flash * 0.35;\r\n            // Also make it brighter/whiter when visible\r\n            if (flash > 0) {\r\n                pickup.color = k.rgb(255, 255, 200); // Bright gold/white flash\r\n            } else {\r\n                pickup.color = k.rgb(...PICKUP_CONFIG.CURRENCY_COLOR);\r\n            }\r\n        } else {\r\n            pickup.opacity = 1;\r\n        }\r\n\r\n        // Bounce physics (only when not magnetizing)\r\n        if (!pickup.magnetizing && pickup.bouncing) {\r\n            // Apply gravity\r\n            pickup.velocityY += pickup.gravity * k.dt();\r\n            pickup.pos.y += pickup.velocityY * k.dt();\r\n\r\n            // Check for ground collision\r\n            if (pickup.pos.y >= pickup.groundY) {\r\n                pickup.pos.y = pickup.groundY;\r\n                pickup.velocityY = -pickup.velocityY * pickup.bounceDamping;\r\n\r\n                // Stop bouncing if velocity is very small\r\n                if (Math.abs(pickup.velocityY) < 20) {\r\n                    pickup.bouncing = false;\r\n                    pickup.velocityY = 0;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Magnetization movement - once magnetizing starts, it never stops\r\n        if (pickup.magnetizing && pickup.targetPlayer && pickup.targetPlayer.exists()) {\r\n            pickup.bouncing = false; // Stop bouncing when magnetizing\r\n\r\n            // Calculate direction to player\r\n            const dirToPlayer = k.vec2(\r\n                pickup.targetPlayer.pos.x - pickup.pos.x,\r\n                pickup.targetPlayer.pos.y - pickup.pos.y\r\n            );\r\n            const distance = dirToPlayer.len();\r\n\r\n            if (distance > 0) {\r\n                // Normalize direction\r\n                const dir = dirToPlayer.scale(1 / distance);\r\n\r\n                // Accelerate magnetization speed\r\n                pickup.magnetizeSpeed = Math.min(\r\n                    pickup.magnetizeSpeed + PICKUP_CONFIG.MAGNETIZE_ACCELERATION * k.dt(),\r\n                    PICKUP_CONFIG.MAGNETIZE_SPEED\r\n                );\r\n\r\n                // Move toward player\r\n                pickup.pos = pickup.pos.add(dir.scale(pickup.magnetizeSpeed * k.dt()));\r\n            }\r\n        }\r\n\r\n        // Despawn after lifetime\r\n        if (pickup.age >= pickup.lifetime) {\r\n            k.destroy(pickup);\r\n        }\r\n    });\r\n\r\n    // Multiplayer: Register pickup for network sync if host\r\n    pickup.pickupType = 'currency'; // Mark type for sync\r\n    if (isMultiplayerActive() && isHost()) {\r\n        registerPickup(pickup, { type: 'currencyPickup', value, icon: currencyIcon });\r\n    }\r\n\r\n    // Cleanup: Remove from tracking map when destroyed (prevents memory leak)\r\n    if (isMultiplayerActive()) {\r\n        pickup.onDestroy(() => {\r\n            unregisterPickup(pickup);\r\n        });\r\n    }\r\n\r\n    return pickup;\r\n}\r\n\r\n// Create a powerup weapon pickup that can be collected for temporary weapon\r\nexport function createPowerupWeaponPickup(k, x, y, powerupKey) {\r\n    const powerup = POWERUP_WEAPONS[powerupKey];\r\n    if (!powerup) return null;\r\n\r\n    const pickup = k.add([\r\n        k.text(powerup.icon, { size: 24 }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...powerup.color),\r\n        k.area(),\r\n        k.scale(1),\r\n        'powerupWeaponPickup'\r\n    ]);\r\n\r\n    pickup.powerupKey = powerupKey;\r\n    pickup.lifetime = PICKUP_CONFIG.CURRENCY_LIFETIME; // Same lifetime as currency\r\n    pickup.age = 0;\r\n    pickup.collected = false;\r\n\r\n    // Magnetization state\r\n    pickup.magnetizing = false;\r\n    pickup.magnetizeSpeed = 0;\r\n    pickup.targetPlayer = null;\r\n\r\n    // Bounce physics\r\n    pickup.velocityY = -150 - Math.random() * 100; // Initial upward velocity (randomized)\r\n    pickup.gravity = 600; // Gravity acceleration\r\n    pickup.groundY = y; // Ground level (spawn position)\r\n    pickup.bounceDamping = 0.5; // Energy loss per bounce\r\n    pickup.bouncing = true; // Whether still bouncing\r\n\r\n    // Visual effect - pulsing and rotating\r\n    pickup.onUpdate(() => {\r\n        if (k.paused) {\r\n            // Still allow animation during pause for visual feedback\r\n            const pulse = Math.sin(pickup.age * 4) * 0.15;\r\n            pickup.scale = k.vec2(1 + pulse);\r\n            pickup.angle = Math.sin(pickup.age * 2) * 10;\r\n            return;\r\n        }\r\n\r\n        pickup.age += k.dt();\r\n\r\n        // Pulse animation (more pronounced than other pickups)\r\n        const pulse = Math.sin(pickup.age * 4) * 0.15;\r\n        pickup.scale = k.vec2(1 + pulse);\r\n\r\n        // Gentle rotation\r\n        pickup.angle = Math.sin(pickup.age * 2) * 10;\r\n\r\n        // Bounce physics (only when not magnetizing)\r\n        if (!pickup.magnetizing && pickup.bouncing) {\r\n            // Apply gravity\r\n            pickup.velocityY += pickup.gravity * k.dt();\r\n            pickup.pos.y += pickup.velocityY * k.dt();\r\n\r\n            // Check for ground collision\r\n            if (pickup.pos.y >= pickup.groundY) {\r\n                pickup.pos.y = pickup.groundY;\r\n                pickup.velocityY = -pickup.velocityY * pickup.bounceDamping;\r\n\r\n                // Stop bouncing if velocity is very small\r\n                if (Math.abs(pickup.velocityY) < 20) {\r\n                    pickup.bouncing = false;\r\n                    pickup.velocityY = 0;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Magnetization movement - once magnetizing starts, it never stops\r\n        if (pickup.magnetizing && pickup.targetPlayer && pickup.targetPlayer.exists()) {\r\n            pickup.bouncing = false; // Stop bouncing when magnetizing\r\n\r\n            // Calculate direction to player\r\n            const dirToPlayer = k.vec2(\r\n                pickup.targetPlayer.pos.x - pickup.pos.x,\r\n                pickup.targetPlayer.pos.y - pickup.pos.y\r\n            );\r\n            const distance = dirToPlayer.len();\r\n\r\n            if (distance > 0) {\r\n                // Normalize direction\r\n                const dir = dirToPlayer.scale(1 / distance);\r\n\r\n                // Accelerate magnetization speed\r\n                pickup.magnetizeSpeed = Math.min(\r\n                    pickup.magnetizeSpeed + PICKUP_CONFIG.MAGNETIZE_ACCELERATION * k.dt(),\r\n                    PICKUP_CONFIG.MAGNETIZE_SPEED\r\n                );\r\n\r\n                // Move toward player\r\n                pickup.pos = pickup.pos.add(dir.scale(pickup.magnetizeSpeed * k.dt()));\r\n            }\r\n        }\r\n\r\n        // Despawn after lifetime\r\n        if (pickup.age >= pickup.lifetime) {\r\n            k.destroy(pickup);\r\n        }\r\n    });\r\n\r\n    // Multiplayer: Register pickup for network sync if host\r\n    pickup.pickupType = 'powerup'; // Mark type for sync\r\n    if (isMultiplayerActive() && isHost()) {\r\n        registerPickup(pickup);\r\n    }\r\n\r\n    // Cleanup: Remove from tracking map when destroyed (prevents memory leak)\r\n    if (isMultiplayerActive()) {\r\n        pickup.onDestroy(() => {\r\n            unregisterPickup(pickup);\r\n        });\r\n    }\r\n\r\n    return pickup;\r\n}\r\n","/**\r\n * Seeded Random Number Generator\r\n *\r\n * Uses the Mulberry32 algorithm for deterministic random number generation.\r\n * This ensures that the same seed always produces the same sequence of random numbers,\r\n * which is critical for multiplayer synchronization.\r\n *\r\n * Usage:\r\n *   const rng = new SeededRandom(12345);\r\n *   const value = rng.next(); // 0 to 1\r\n *   const num = rng.range(1, 10); // 1 to 9\r\n *   const choice = rng.choose(['a', 'b', 'c']); // random element\r\n */\r\n\r\nexport class SeededRandom {\r\n    /**\r\n     * Create a new seeded random number generator\r\n     * @param {number} seed - The seed value (must be a 32-bit integer)\r\n     */\r\n    constructor(seed) {\r\n        // Ensure seed is a 32-bit integer\r\n        this.seed = seed >>> 0;\r\n        this.originalSeed = this.seed;\r\n    }\r\n\r\n    /**\r\n     * Generate the next random number (0 to 1, exclusive)\r\n     * Uses Mulberry32 algorithm for high-quality deterministic randomness\r\n     * @returns {number} Random number between 0 and 1\r\n     */\r\n    next() {\r\n        let t = this.seed += 0x6D2B79F5;\r\n        t = Math.imul(t ^ t >>> 15, t | 1);\r\n        t ^= t + Math.imul(t ^ t >>> 7, t | 61);\r\n        return ((t ^ t >>> 14) >>> 0) / 4294967296;\r\n    }\r\n\r\n    /**\r\n     * Generate a random integer in range [min, max)\r\n     * @param {number} min - Minimum value (inclusive)\r\n     * @param {number} max - Maximum value (exclusive)\r\n     * @returns {number} Random integer\r\n     */\r\n    range(min, max) {\r\n        if (max <= min) {\r\n            console.warn(`SeededRandom.range: Invalid range [${min}, ${max}). Returning min.`);\r\n            return min;\r\n        }\r\n        return Math.floor(min + this.next() * (max - min));\r\n    }\r\n\r\n    /**\r\n     * Generate a random float in range [min, max)\r\n     * @param {number} min - Minimum value (inclusive)\r\n     * @param {number} max - Maximum value (exclusive)\r\n     * @returns {number} Random float\r\n     */\r\n    rangeFloat(min, max) {\r\n        return min + this.next() * (max - min);\r\n    }\r\n\r\n    /**\r\n     * Choose a random element from an array\r\n     * @param {Array} array - Array to choose from\r\n     * @returns {*} Random element from array\r\n     */\r\n    choose(array) {\r\n        if (!array || array.length === 0) return undefined;\r\n        return array[this.range(0, array.length)];\r\n    }\r\n\r\n    /**\r\n     * Shuffle an array using Fisher-Yates algorithm\r\n     * @param {Array} array - Array to shuffle (modified in place)\r\n     * @returns {Array} The shuffled array\r\n     */\r\n    shuffle(array) {\r\n        const arr = [...array]; // Create copy to avoid mutation\r\n        for (let i = arr.length - 1; i > 0; i--) {\r\n            const j = this.range(0, i + 1);\r\n            [arr[i], arr[j]] = [arr[j], arr[i]];\r\n        }\r\n        return arr;\r\n    }\r\n\r\n    /**\r\n     * Roll a probability check\r\n     * @param {number} probability - Probability of success (0 to 1)\r\n     * @returns {boolean} True if roll succeeds\r\n     */\r\n    probability(probability) {\r\n        return this.next() < probability;\r\n    }\r\n\r\n    /**\r\n     * Reset the RNG to its original seed\r\n     */\r\n    reset() {\r\n        this.seed = this.originalSeed;\r\n    }\r\n\r\n    /**\r\n     * Get current seed state (for saving/loading)\r\n     * @returns {number} Current seed\r\n     */\r\n    getState() {\r\n        return this.seed;\r\n    }\r\n\r\n    /**\r\n     * Set seed state (for loading)\r\n     * @param {number} state - Seed state to restore\r\n     */\r\n    setState(state) {\r\n        this.seed = state >>> 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Create a seed from multiple components\r\n * Useful for creating deterministic seeds from game state\r\n * @param  {...number} components - Numbers to combine into a seed\r\n * @returns {number} Combined seed\r\n */\r\nexport function createSeed(...components) {\r\n    let seed = 0;\r\n    for (let i = 0; i < components.length; i++) {\r\n        seed = ((seed << 5) - seed + components[i]) | 0;\r\n    }\r\n    return seed >>> 0;\r\n}\r\n\r\n/**\r\n * Create a seed from a string\r\n * @param {string} str - String to convert to seed\r\n * @returns {number} Seed value\r\n */\r\nexport function seedFromString(str) {\r\n    let hash = 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n        hash = ((hash << 5) - hash + str.charCodeAt(i)) | 0;\r\n    }\r\n    return hash >>> 0;\r\n}\r\n","/**\r\n * Connection Quality Indicator System\r\n *\r\n * Measures and displays latency/ping for multiplayer connections.\r\n * Provides visual feedback on connection quality.\r\n */\r\n\r\nimport { onMessage, sendToPeer, sendToHost, getNetworkInfo } from './networkSystem.js';\r\nimport { isHost, isMultiplayerActive } from './multiplayerGame.js';\r\n\r\n// Connection quality state\r\nconst connectionState = {\r\n    // Map of peerId -> { latency, lastPingTime, pingId }\r\n    peers: new Map(),\r\n    localLatency: 0,\r\n    pingInterval: 2000, // Ping every 2 seconds\r\n    pingTimeout: 5000, // Consider disconnected after 5s without response\r\n    lastPingId: 0,\r\n    lastPingSentTime: 0,\r\n    handlersRegistered: false\r\n};\r\n\r\n// Quality thresholds (in ms)\r\nconst QUALITY_THRESHOLDS = {\r\n    GOOD: 100,      // < 100ms = green\r\n    MEDIUM: 200,    // 100-200ms = yellow\r\n    POOR: 500       // > 200ms = red, > 500ms = critical\r\n};\r\n\r\n/**\r\n * Initialize connection quality monitoring\r\n * Call this when multiplayer starts\r\n */\r\nexport function initConnectionQuality() {\r\n    if (connectionState.handlersRegistered) return;\r\n    connectionState.handlersRegistered = true;\r\n\r\n    // Handle ping requests (respond with pong)\r\n    onMessage('ping', (payload, fromPeerId) => {\r\n        // Respond immediately with the same ping ID\r\n        if (isHost()) {\r\n            sendToPeer(fromPeerId, 'pong', { pingId: payload.pingId, serverTime: Date.now() });\r\n        } else {\r\n            sendToHost('pong', { pingId: payload.pingId, serverTime: Date.now() });\r\n        }\r\n    });\r\n\r\n    // Handle pong responses (calculate latency)\r\n    onMessage('pong', (payload, fromPeerId) => {\r\n        const now = Date.now();\r\n        const pingId = payload.pingId;\r\n\r\n        if (isHost()) {\r\n            // Host received pong from a client\r\n            const peerState = connectionState.peers.get(fromPeerId);\r\n            if (peerState && peerState.pingId === pingId) {\r\n                const latency = now - peerState.lastPingTime;\r\n                peerState.latency = latency;\r\n            }\r\n        } else {\r\n            // Client received pong from host\r\n            if (connectionState.lastPingId === pingId) {\r\n                connectionState.localLatency = now - connectionState.lastPingSentTime;\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Send a ping to measure latency\r\n * Call this periodically (e.g., every 2 seconds)\r\n * @param {string} peerId - Peer ID to ping (host only, for clients leave empty)\r\n */\r\nexport function sendPing(peerId = null) {\r\n    const pingId = Date.now();\r\n\r\n    if (isHost() && peerId) {\r\n        // Host pinging a specific client\r\n        let peerState = connectionState.peers.get(peerId);\r\n        if (!peerState) {\r\n            peerState = { latency: 0, lastPingTime: 0, pingId: 0 };\r\n            connectionState.peers.set(peerId, peerState);\r\n        }\r\n        peerState.pingId = pingId;\r\n        peerState.lastPingTime = Date.now();\r\n        sendToPeer(peerId, 'ping', { pingId });\r\n    } else if (!isHost()) {\r\n        // Client pinging host\r\n        connectionState.lastPingId = pingId;\r\n        connectionState.lastPingSentTime = Date.now();\r\n        sendToHost('ping', { pingId });\r\n    }\r\n}\r\n\r\n/**\r\n * Get latency for a specific peer (host only)\r\n * @param {string} peerId - Peer ID\r\n * @returns {number} - Latency in ms (0 if unknown)\r\n */\r\nexport function getPeerLatency(peerId) {\r\n    const peerState = connectionState.peers.get(peerId);\r\n    return peerState ? peerState.latency : 0;\r\n}\r\n\r\n/**\r\n * Get local latency to host (client only)\r\n * @returns {number} - Latency in ms\r\n */\r\nexport function getLocalLatency() {\r\n    return connectionState.localLatency;\r\n}\r\n\r\n/**\r\n * Get quality level from latency\r\n * @param {number} latencyMs - Latency in milliseconds\r\n * @returns {string} - 'good', 'medium', 'poor', or 'critical'\r\n */\r\nexport function getQualityLevel(latencyMs) {\r\n    if (latencyMs < QUALITY_THRESHOLDS.GOOD) return 'good';\r\n    if (latencyMs < QUALITY_THRESHOLDS.MEDIUM) return 'medium';\r\n    if (latencyMs < QUALITY_THRESHOLDS.POOR) return 'poor';\r\n    return 'critical';\r\n}\r\n\r\n/**\r\n * Get quality icon based on latency\r\n * @param {number} latencyMs - Latency in milliseconds\r\n * @returns {Object} - { icon: string, color: number[] }\r\n */\r\nexport function getQualityIcon(latencyMs) {\r\n    const quality = getQualityLevel(latencyMs);\r\n\r\n    switch (quality) {\r\n        case 'good':\r\n            return { icon: '', color: [100, 255, 100] }; // Green\r\n        case 'medium':\r\n            return { icon: '', color: [255, 255, 100] }; // Yellow\r\n        case 'poor':\r\n            return { icon: '', color: [255, 150, 100] }; // Orange\r\n        case 'critical':\r\n            return { icon: '', color: [255, 100, 100] }; // Red\r\n        default:\r\n            return { icon: '', color: [150, 150, 150] }; // Gray (unknown)\r\n    }\r\n}\r\n\r\n/**\r\n * Get formatted latency string\r\n * @param {number} latencyMs - Latency in milliseconds\r\n * @returns {string} - Formatted latency (e.g., \"45ms\")\r\n */\r\nexport function formatLatency(latencyMs) {\r\n    if (latencyMs <= 0) return '?ms';\r\n    return `${Math.round(latencyMs)}ms`;\r\n}\r\n\r\n/**\r\n * Get all peer latencies (host only)\r\n * @returns {Map<string, number>} - Map of peerId -> latency\r\n */\r\nexport function getAllPeerLatencies() {\r\n    const latencies = new Map();\r\n    connectionState.peers.forEach((state, peerId) => {\r\n        latencies.set(peerId, state.latency);\r\n    });\r\n    return latencies;\r\n}\r\n\r\n/**\r\n * Clear connection state for a peer\r\n * @param {string} peerId - Peer ID to clear\r\n */\r\nexport function clearPeerConnection(peerId) {\r\n    connectionState.peers.delete(peerId);\r\n}\r\n\r\n/**\r\n * Reset all connection quality state\r\n */\r\nexport function resetConnectionQuality() {\r\n    connectionState.peers.clear();\r\n    connectionState.localLatency = 0;\r\n    connectionState.lastPingId = 0;\r\n    connectionState.lastPingSentTime = 0;\r\n}\r\n\r\n/**\r\n * Update connection quality display for all players\r\n * Should be called in the game's update loop\r\n * @param {Object} k - Kaplay instance\r\n * @param {Function} getConnectedPeers - Function to get connected peer IDs\r\n */\r\nexport function updateConnectionQuality(k, getConnectedPeers) {\r\n    if (!isMultiplayerActive()) return;\r\n\r\n    const now = Date.now();\r\n\r\n    // Only ping every interval\r\n    if (now - connectionState.lastPingSentTime < connectionState.pingInterval) {\r\n        return;\r\n    }\r\n\r\n    if (isHost()) {\r\n        // Host: ping all connected clients\r\n        const peers = getConnectedPeers();\r\n        peers.forEach(peerId => {\r\n            sendPing(peerId);\r\n        });\r\n    } else {\r\n        // Client: ping host\r\n        sendPing();\r\n    }\r\n}\r\n","// Upgrade system - handles upgrade definitions and application\r\nimport { isUpgradeValidForWeapon, getWeaponDefinition, WEAPON_DEFINITIONS } from '../data/weapons.js';\r\n\r\n// Upgrade stack limits\r\nexport const UPGRADE_STACK_LIMITS = {\r\n    damage: 10, // 10 stacks = 250% total (25% per stack)\r\n    fireRate: 10, // 10 stacks = ~620% total (20% per stack, multiplicative)\r\n    speed: 10, // 10 stacks = ~405% total (15% per stack, multiplicative)\r\n    health: 10, // 10 stacks = +200 HP total (20 per stack)\r\n    projectileSpeed: 10, // 10 stacks = ~931% total (25% per stack, multiplicative)\r\n    xpGain: 10, // 10 stacks = +150% total (15% per stack)\r\n    pickupRadius: 10, // 10 stacks = ~5766% total (50% per stack, multiplicative)\r\n    multiShot: 5, // 5 stacks = +5 projectiles total\r\n    piercing: 5, // 5 stacks = +5 penetration total\r\n    obstaclePiercing: 5, // 5 stacks = +5 obstacle penetration total\r\n    critChance: 10, // 10 stacks = +100% crit chance total (10% per stack)\r\n    critDamage: 10, // 10 stacks = +500% crit damage total (50% per stack)\r\n    spreadShot: 5, // 5 stacks = +150 spread total (30 per stack)\r\n    pelletCount: 5, // 5 stacks = +5 pellets total\r\n    range: 5, // 5 stacks = ~305% total (25% per stack, multiplicative)\r\n    dot: 10, // 10 stacks = +250% DoT total (25% per stack)\r\n    orbitalCount: 5, // 5 stacks = +5 orbs total\r\n    orbitalSpeed: 10, // 10 stacks = ~5766% total (50% per stack, multiplicative)\r\n    orbitalRadius: 10, // 10 stacks = ~619% total (20% per stack, multiplicative)\r\n    explosionRadius: 10, // 10 stacks = ~931% total (25% per stack, multiplicative)\r\n    explosionDamage: 10, // 10 stacks = ~931% total (25% per stack, multiplicative)\r\n    chainJumps: 5, // 5 stacks = +5 jumps total\r\n    chainRange: 10, // 10 stacks = ~931% total (25% per stack, multiplicative)\r\n    chainDamage: 10, // 10 stacks = -100% damage reduction (minimum 5% per jump)\r\n    defense: 10, // 10 stacks = +20 damage reduction total (2 per stack)\r\n    // New upgrades\r\n    lifesteal: 5, // 5 stacks = 10% lifesteal total (2% per stack)\r\n    dodgeChance: 5, // 5 stacks = 25% dodge chance total (5% per stack)\r\n    thorns: 5, // 5 stacks = 75% reflected damage total (15% per stack)\r\n    aoeSize: 10, // 10 stacks = +150% AoE size total (15% per stack)\r\n    knockback: 5, // 5 stacks = +100% knockback total (20% per stack)\r\n    magnetRange: 10, // 10 stacks = +250% pickup radius total (25% per stack)\r\n    invulnTime: 5, // 5 stacks = +0.75s invuln total (0.15s per stack)\r\n    moveDamage: 5, // 5 stacks = +10% damage per speed stack (2% per stack)\r\n    lowHealthDmg: 5, // 5 stacks = +25% damage per 10% missing HP (5% per stack)\r\n    killSpeed: 5 // 5 stacks = +15% speed on kill for 3s (3% per stack)\r\n};\r\n\r\n// Basic upgrade definitions\r\n// Each upgrade can specify which weapons it's valid for\r\nexport const UPGRADES = {\r\n    damage: {\r\n        name: 'Damage Boost',\r\n        icon: '',\r\n        description: '+25% damage',\r\n        category: 'weapon',\r\n        upgradeCategory: 'damage',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+25% damage${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.damage})` : ''}`,\r\n        apply: (player) => {\r\n            // Stackable: recalculate from base damage\r\n            const stacks = player.upgradeStacks?.damage || 0;\r\n            const baseDamage = player.baseProjectileDamage || player.weaponDef?.baseDamage || 10;\r\n            const multiplier = Math.pow(1.25, stacks);\r\n            player.projectileDamage = Math.floor(baseDamage * multiplier);\r\n        }\r\n    },\r\n    fireRate: {\r\n        name: 'Fire Rate',\r\n        icon: '',\r\n        description: '+20% fire rate',\r\n        category: 'weapon',\r\n        upgradeCategory: 'fireRate',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+20% fire rate${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.fireRate})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.fireRate || 0;\r\n            const baseFireRate = player.baseFireRate || player.weaponDef?.fireRate || 1.5;\r\n            const multiplier = Math.pow(1.2, stacks);\r\n            player.fireRate = baseFireRate * multiplier;\r\n        }\r\n    },\r\n    speed: {\r\n        name: 'Movement Speed',\r\n        icon: '',\r\n        description: '+15% movement speed',\r\n        category: 'passive',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+15% movement speed${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.speed})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.speed || 0;\r\n            const baseSpeed = player.characterData?.stats?.speed || 150;\r\n            const multiplier = Math.pow(1.15, stacks);\r\n            player.speed = Math.floor(baseSpeed * multiplier);\r\n            player.originalSpeed = player.speed;\r\n        }\r\n    },\r\n    health: {\r\n        name: 'Max Health',\r\n        icon: '',\r\n        description: '+20 max HP',\r\n        category: 'passive',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+20 max HP${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.health})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.health || 0;\r\n            const baseHealth = player.characterData?.stats?.health || 100;\r\n            const bonusHP = stacks * 20;\r\n            const oldMaxHealth = player.maxHealth;\r\n            player.maxHealth = baseHealth + bonusHP;\r\n            // Heal the difference\r\n            const hpDiff = player.maxHealth - oldMaxHealth;\r\n            if (hpDiff > 0) {\r\n                player.setHP(player.hp() + hpDiff);\r\n            }\r\n        }\r\n    },\r\n    projectileSpeed: {\r\n        name: 'Projectile Speed',\r\n        icon: '',\r\n        description: '+25% projectile speed',\r\n        category: 'weapon',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+25% projectile speed${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.projectileSpeed})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.projectileSpeed || 0;\r\n            const baseSpeed = player.baseProjectileSpeed || player.weaponDef?.projectileSpeed || 300;\r\n            const multiplier = Math.pow(1.25, stacks);\r\n            player.projectileSpeed = Math.floor(baseSpeed * multiplier);\r\n        }\r\n    },\r\n    xpGain: {\r\n        name: 'XP Gain',\r\n        icon: '',\r\n        description: '+15% XP from enemies',\r\n        category: 'passive',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+15% XP from enemies${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.xpGain})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.xpGain || 0;\r\n            const baseMultiplier = player.characterData?.ability === 'xpBoost' ? 1.1 : 1.0;\r\n            player.xpMultiplier = baseMultiplier + (stacks * 0.15);\r\n        }\r\n    },\r\n    pickupRadius: {\r\n        name: 'Pickup Radius',\r\n        icon: '',\r\n        description: '+50% pickup range',\r\n        category: 'passive',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+50% pickup range${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.pickupRadius})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.pickupRadius || 0;\r\n            const baseRadius = 30;\r\n            const multiplier = Math.pow(1.5, stacks);\r\n            player.pickupRadius = Math.floor(baseRadius * multiplier);\r\n        }\r\n    },\r\n    multiShot: {\r\n        name: 'Multi-Shot',\r\n        icon: '',\r\n        description: '+1 projectile per shot',\r\n        category: 'weapon',\r\n        upgradeCategory: 'multiShot',\r\n        validWeapons: ['pistol', 'smg', 'sniper'],\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+1 projectile per shot${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.multiShot})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.multiShot || 0;\r\n            const baseCount = player.weaponDef?.projectileCount || 1;\r\n            player.projectileCount = baseCount + stacks;\r\n        }\r\n    },\r\n    piercing: {\r\n        name: 'Piercing',\r\n        icon: '',\r\n        description: '+1 enemy penetration',\r\n        category: 'weapon',\r\n        upgradeCategory: 'piercing',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+1 enemy penetration${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.piercing})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.piercing || 0;\r\n            const basePiercing = player.weaponDef?.piercing || 0;\r\n            player.piercing = basePiercing + stacks;\r\n        }\r\n    },\r\n    obstaclePiercing: {\r\n        name: 'Obstacle Piercing',\r\n        icon: '',\r\n        description: '+1 obstacle penetration',\r\n        category: 'weapon',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+1 obstacle penetration${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.obstaclePiercing})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.obstaclePiercing || 0;\r\n            const baseObstaclePiercing = player.weaponDef?.obstaclePiercing || 0;\r\n            player.obstaclePiercing = baseObstaclePiercing + stacks;\r\n        }\r\n    },\r\n    critChance: {\r\n        name: 'Critical Strike',\r\n        icon: '',\r\n        description: '+10% crit chance',\r\n        category: 'weapon',\r\n        upgradeCategory: 'crit',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+10% crit chance${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.critChance})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.critChance || 0;\r\n            const baseCritChance = player.weaponDef?.critChance || 0.05;\r\n            let finalCritChance = baseCritChance + (stacks * 0.1);\r\n            // Apply character bonus if applicable\r\n            if (player.characterData?.ability === 'critBoost') {\r\n                finalCritChance *= 1.5;\r\n            }\r\n            player.critChance = finalCritChance;\r\n        }\r\n    },\r\n    critDamage: {\r\n        name: 'Critical Power',\r\n        icon: '',\r\n        description: '+50% crit damage',\r\n        category: 'weapon',\r\n        upgradeCategory: 'crit',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+50% crit damage${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.critDamage})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.critDamage || 0;\r\n            const baseCritDamage = player.weaponDef?.critDamage || 2.0;\r\n            let finalCritDamage = baseCritDamage + (stacks * 0.5);\r\n            // Apply character bonus if applicable\r\n            if (player.characterData?.ability === 'critBoost') {\r\n                finalCritDamage *= 1.25;\r\n            }\r\n            player.critDamage = finalCritDamage;\r\n        }\r\n    },\r\n    spreadShot: {\r\n        name: 'Spread Shot',\r\n        icon: '',\r\n        description: '+30 spread angle',\r\n        category: 'weapon',\r\n        upgradeCategory: 'spread',\r\n        validWeapons: ['shotgun'], // Only shotgun has 'spread' in upgradeCategories\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+30 spread angle${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.spreadShot})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.spreadShot || 0;\r\n            const baseSpread = player.weaponDef?.spreadAngle || 0;\r\n            player.spreadAngle = baseSpread + (stacks * 30);\r\n        }\r\n    },\r\n    pelletCount: {\r\n        name: 'More Pellets',\r\n        icon: '',\r\n        description: '+1 pellet per shot',\r\n        category: 'weapon',\r\n        upgradeCategory: 'pelletCount',\r\n        validWeapons: ['shotgun'],\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+1 pellet per shot${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.pelletCount})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.pelletCount || 0;\r\n            const baseCount = player.weaponDef?.projectileCount || 3;\r\n            player.projectileCount = baseCount + stacks;\r\n        }\r\n    },\r\n    range: {\r\n        name: 'Extended Range',\r\n        icon: '',\r\n        description: '+25% weapon range',\r\n        category: 'weapon',\r\n        upgradeCategory: 'range',\r\n        validWeapons: ['sniper', 'flamethrower', 'explosive'], // All weapons with 'range' in upgradeCategories\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+25% weapon range${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.range})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.range || 0;\r\n            const baseRange = player.weaponDef?.range || 600;\r\n            const multiplier = Math.pow(1.25, stacks);\r\n            player.weaponRange = Math.floor(baseRange * multiplier);\r\n        }\r\n    },\r\n    dot: {\r\n        name: 'Burn Damage',\r\n        icon: '',\r\n        description: '+25% fire damage over time',\r\n        category: 'weapon',\r\n        upgradeCategory: 'dot',\r\n        validWeapons: ['flamethrower'],\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+25% fire damage over time${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.dot})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.dot || 0;\r\n            const baseMultiplier = player.characterData?.ability === 'fireDot' ? 1.25 : 1.0;\r\n            player.fireDotMultiplier = baseMultiplier + (stacks * 0.25);\r\n        }\r\n    },\r\n    orbitalCount: {\r\n        name: 'Extra Orb',\r\n        icon: '',\r\n        description: '+1 orbital orb',\r\n        category: 'weapon',\r\n        upgradeCategory: 'orbitalCount',\r\n        validWeapons: ['orbital'],\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+1 orbital orb${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.orbitalCount})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.orbitalCount || 0;\r\n            const baseCount = player.weaponDef?.projectileCount || 1;\r\n            player.projectileCount = baseCount + stacks;\r\n            // Reinitialize orbital weapons if needed\r\n            if (player.weaponKey === 'orbital' && player.orbitalOrbs) {\r\n                // Mark for reinitialization\r\n                player.orbitalNeedsReinit = true;\r\n            }\r\n        }\r\n    },\r\n    orbitalSpeed: {\r\n        name: 'Faster Orbit',\r\n        icon: '',\r\n        description: '+50% orbital rotation speed',\r\n        category: 'weapon',\r\n        upgradeCategory: 'orbitalSpeed',\r\n        validWeapons: ['orbital'],\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+50% orbital rotation speed${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.orbitalSpeed})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.orbitalSpeed || 0;\r\n            const baseSpeed = player.weaponDef?.rotationSpeed || 180;\r\n            const multiplier = Math.pow(1.5, stacks);\r\n            player.rotationSpeed = baseSpeed * multiplier;\r\n        }\r\n    },\r\n    orbitalRadius: {\r\n        name: 'Wider Orbit',\r\n        icon: '',\r\n        description: '+20% orbital radius',\r\n        category: 'weapon',\r\n        upgradeCategory: 'orbitalRadius',\r\n        validWeapons: ['orbital'],\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+20% orbital radius${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.orbitalRadius})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.orbitalRadius || 0;\r\n            const baseRadius = player.weaponDef?.orbitRadius || 45;\r\n            const multiplier = Math.pow(1.2, stacks);\r\n            player.orbitRadius = Math.floor(baseRadius * multiplier);\r\n        }\r\n    },\r\n    explosionRadius: {\r\n        name: 'Bigger Explosion',\r\n        icon: '',\r\n        description: '+25% explosion radius',\r\n        category: 'weapon',\r\n        upgradeCategory: 'explosionRadius',\r\n        validWeapons: ['explosive'],\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+25% explosion radius${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.explosionRadius})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.explosionRadius || 0;\r\n            const baseRadius = player.weaponDef?.explosionRadius || 50;\r\n            const multiplier = Math.pow(1.25, stacks);\r\n            player.explosionRadius = Math.floor(baseRadius * multiplier);\r\n        }\r\n    },\r\n    explosionDamage: {\r\n        name: 'Explosive Power',\r\n        icon: '',\r\n        description: '+25% explosion damage',\r\n        category: 'weapon',\r\n        upgradeCategory: 'explosionDamage',\r\n        validWeapons: ['explosive'],\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+25% explosion damage${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.explosionDamage})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.explosionDamage || 0;\r\n            const baseDamage = player.weaponDef?.explosionDamage || 15;\r\n            const multiplier = Math.pow(1.25, stacks);\r\n            player.explosionDamage = Math.floor(baseDamage * multiplier);\r\n        }\r\n    },\r\n    chainJumps: {\r\n        name: 'More Chains',\r\n        icon: '',\r\n        description: '+1 chain jump',\r\n        category: 'weapon',\r\n        upgradeCategory: 'chainJumps',\r\n        validWeapons: ['chainLightning'],\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+1 chain jump${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.chainJumps})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.chainJumps || 0;\r\n            const baseJumps = player.weaponDef?.maxJumps || 3;\r\n            player.maxJumps = baseJumps + stacks;\r\n        }\r\n    },\r\n    chainRange: {\r\n        name: 'Longer Chain',\r\n        icon: '',\r\n        description: '+25% chain range',\r\n        category: 'weapon',\r\n        upgradeCategory: 'chainRange',\r\n        validWeapons: ['chainLightning'],\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+25% chain range${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.chainRange})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.chainRange || 0;\r\n            const baseRange = player.weaponDef?.chainRange || 70;\r\n            const multiplier = Math.pow(1.25, stacks);\r\n            player.chainRange = Math.floor(baseRange * multiplier);\r\n        }\r\n    },\r\n    chainDamage: {\r\n        name: 'Chain Power',\r\n        icon: '',\r\n        description: '-10% damage reduction per jump',\r\n        category: 'weapon',\r\n        upgradeCategory: 'chainDamage',\r\n        validWeapons: ['chainLightning'],\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `-10% damage reduction per jump${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.chainDamage})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.chainDamage || 0;\r\n            const baseReduction = player.weaponDef?.chainDamageReduction || 0.15;\r\n            // Reduce damage reduction (so damage stays higher)\r\n            player.chainDamageReduction = Math.max(0.05, baseReduction - (stacks * 0.1));\r\n        }\r\n    },\r\n    defense: {\r\n        name: 'Armor',\r\n        icon: '',\r\n        description: '+2 damage reduction',\r\n        category: 'passive',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+2 damage reduction${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.defense})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.defense || 0;\r\n            const baseDefense = player.characterData?.ability === 'tankStats' ? 0.15 : 0;\r\n            player.defense = baseDefense + (stacks * 2);\r\n        }\r\n    },\r\n\r\n    // ========================================\r\n    // NEW UPGRADES\r\n    // ========================================\r\n\r\n    lifesteal: {\r\n        name: 'Life Drain',\r\n        icon: '',\r\n        description: 'Heal 2% of damage dealt',\r\n        category: 'passive',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `Heal ${(stacks || 1) * 2}% of damage dealt${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.lifesteal})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.lifesteal || 0;\r\n            player.lifestealPercent = stacks * 0.02; // 2% per stack\r\n        }\r\n    },\r\n    dodgeChance: {\r\n        name: 'Evasion',\r\n        icon: '',\r\n        description: '+5% dodge chance',\r\n        category: 'passive',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+${(stacks || 1) * 5}% dodge chance${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.dodgeChance})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.dodgeChance || 0;\r\n            // Add to existing dodge chance (Scout has base 10%)\r\n            const baseDodge = player.characterData?.ability === 'dodgeChance' ? 0.1 : 0;\r\n            player.dodgeChance = baseDodge + (stacks * 0.05); // 5% per stack\r\n        }\r\n    },\r\n    thorns: {\r\n        name: 'Thorns',\r\n        icon: '',\r\n        description: 'Reflect 15% damage to attackers',\r\n        category: 'passive',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `Reflect ${(stacks || 1) * 15}% damage${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.thorns})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.thorns || 0;\r\n            player.thornsPercent = stacks * 0.15; // 15% per stack\r\n        }\r\n    },\r\n    aoeSize: {\r\n        name: 'Blast Radius',\r\n        icon: '',\r\n        description: '+15% explosion/area size',\r\n        category: 'weapon',\r\n        upgradeCategory: 'explosionRadius',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+${(stacks || 1) * 15}% AoE size${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.aoeSize})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.aoeSize || 0;\r\n            player.aoeSizeMultiplier = 1 + (stacks * 0.15); // 15% per stack\r\n            // Also update explosion radius if player has explosive weapon\r\n            if (player.explosionRadius) {\r\n                const baseRadius = player.weaponDef?.explosionRadius || 50;\r\n                player.explosionRadius = Math.floor(baseRadius * player.aoeSizeMultiplier);\r\n            }\r\n        }\r\n    },\r\n    knockback: {\r\n        name: 'Impact Force',\r\n        icon: '',\r\n        description: '+20% knockback',\r\n        category: 'weapon',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+${(stacks || 1) * 20}% knockback${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.knockback})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.knockback || 0;\r\n            player.knockbackMultiplier = 1 + (stacks * 0.2); // 20% per stack\r\n        }\r\n    },\r\n    magnetRange: {\r\n        name: 'Treasure Hunter',\r\n        icon: '',\r\n        description: '+25% pickup radius',\r\n        category: 'passive',\r\n        maxStacks: 10,\r\n        getDescription: (stacks) => `+${(stacks || 1) * 25}% pickup radius${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.magnetRange})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.magnetRange || 0;\r\n            const baseRadius = 30;\r\n            // Additive with pickupRadius upgrade\r\n            const pickupStacks = player.upgradeStacks?.pickupRadius || 0;\r\n            const pickupMultiplier = Math.pow(1.5, pickupStacks);\r\n            player.pickupRadius = Math.floor(baseRadius * pickupMultiplier * (1 + stacks * 0.25));\r\n        }\r\n    },\r\n    invulnTime: {\r\n        name: 'Iron Skin',\r\n        icon: '',\r\n        description: '+0.15s invulnerability frames',\r\n        category: 'passive',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+${((stacks || 1) * 0.15).toFixed(2)}s invuln${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.invulnTime})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.invulnTime || 0;\r\n            const baseDuration = 1.0; // Base invulnerability duration\r\n            player.invulnerableDuration = baseDuration + (stacks * 0.15); // 0.15s per stack\r\n        }\r\n    },\r\n    moveDamage: {\r\n        name: 'Momentum',\r\n        icon: '',\r\n        description: '+2% damage per speed stack',\r\n        category: 'passive',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+${(stacks || 1) * 2}% damage per speed stack${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.moveDamage})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.moveDamage || 0;\r\n            player.moveDamageBonus = stacks * 0.02; // 2% per stack\r\n            // Damage bonus is applied dynamically based on speed stacks in combat\r\n        }\r\n    },\r\n    lowHealthDmg: {\r\n        name: 'Desperation',\r\n        icon: '',\r\n        description: '+5% damage per 10% missing HP',\r\n        category: 'passive',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+${(stacks || 1) * 5}% damage per 10% missing HP${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.lowHealthDmg})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.lowHealthDmg || 0;\r\n            player.lowHealthDmgBonus = stacks * 0.05; // 5% per stack per 10% missing HP\r\n            // Damage bonus is applied dynamically based on HP percentage in combat\r\n        }\r\n    },\r\n    killSpeed: {\r\n        name: 'Bloodlust',\r\n        icon: '',\r\n        description: '+3% speed for 3s on kill',\r\n        category: 'passive',\r\n        maxStacks: 5,\r\n        getDescription: (stacks) => `+${(stacks || 1) * 3}% speed for 3s on kill${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.killSpeed})` : ''}`,\r\n        apply: (player) => {\r\n            const stacks = player.upgradeStacks?.killSpeed || 0;\r\n            player.killSpeedBonus = stacks * 0.03; // 3% per stack\r\n            player.killSpeedDuration = 3.0; // 3 seconds\r\n            player.killSpeedStacks = 0; // Active kill stacks (managed in combat)\r\n            player.killSpeedTimer = 0; // Timer for speed buff decay\r\n        }\r\n    }\r\n};\r\n\r\n// Check if upgrade is valid for player\r\nfunction isUpgradeValidForPlayer(upgrade, player) {\r\n    // Passive upgrades\r\n    if (upgrade.category === 'passive') {\r\n        // Check stack limit\r\n        const stacks = player.upgradeStacks?.[upgrade.key] || 0;\r\n        const maxStacks = upgrade.maxStacks || UPGRADE_STACK_LIMITS[upgrade.key] || 10;\r\n        if (stacks >= maxStacks) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    // Weapon stat upgrades\r\n    if (upgrade.category === 'weapon') {\r\n        // Check stack limit\r\n        const stacks = player.upgradeStacks?.[upgrade.key] || 0;\r\n        const maxStacks = upgrade.maxStacks || UPGRADE_STACK_LIMITS[upgrade.key] || 10;\r\n        if (stacks >= maxStacks) {\r\n            return false;\r\n        }\r\n\r\n        // Check weapon validity - only show upgrades for character's starting weapon\r\n        // (not powerup weapons, since those are temporary)\r\n        const startingWeapon = player.characterData?.weapon || player.weaponKey || 'pistol';\r\n\r\n        if (upgrade.validWeapons) {\r\n            // Must match starting weapon exactly\r\n            return upgrade.validWeapons.includes(startingWeapon);\r\n        }\r\n\r\n        if (upgrade.upgradeCategory) {\r\n            return isUpgradeValidForWeapon(startingWeapon, upgrade.upgradeCategory);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// Get random upgrades for draft (weapon-aware)\r\n// @param {number} count - Number of upgrades to return\r\n// @param {Object} player - Player object to filter valid upgrades\r\n// @param {SeededRandom} rng - Optional seeded RNG for multiplayer synchronization\r\nexport function getRandomUpgrades(count = 3, player = null, rng = null) {\r\n    const upgradeKeys = Object.keys(UPGRADES);\r\n\r\n    // Map upgrade keys to full upgrade objects\r\n    let allOptions = upgradeKeys.map(key => ({ key, ...UPGRADES[key], type: 'upgrade' }));\r\n\r\n    // Filter based on player state\r\n    let validOptions = allOptions;\r\n    if (player) {\r\n        validOptions = allOptions.filter(option => isUpgradeValidForPlayer(option, player));\r\n    }\r\n\r\n    // If not enough valid options, fall back to all options\r\n    if (validOptions.length < count) {\r\n        validOptions = allOptions;\r\n    }\r\n\r\n    const selected = [];\r\n    const used = new Set();\r\n\r\n    while (selected.length < count && selected.length < validOptions.length) {\r\n        // Use seeded RNG if provided (for multiplayer sync), otherwise Math.random()\r\n        const randomIndex = rng\r\n            ? rng.range(0, validOptions.length)\r\n            : Math.floor(Math.random() * validOptions.length);\r\n        const option = validOptions[randomIndex];\r\n        if (!used.has(option.key)) {\r\n            used.add(option.key);\r\n            selected.push(option);\r\n        }\r\n    }\r\n\r\n    return selected;\r\n}\r\n\r\n// Apply upgrade to player\r\nexport function applyUpgrade(player, upgradeKey) {\r\n    // Get the upgrade\r\n    const upgrade = UPGRADES[upgradeKey];\r\n    if (!upgrade) return;\r\n    \r\n    // Track upgrade\r\n    if (upgrade.category === 'passive') {\r\n        if (!player.passiveUpgrades.includes(upgradeKey)) {\r\n            player.passiveUpgrades.push(upgradeKey);\r\n        }\r\n    }\r\n    \r\n    // Increment stack count\r\n    if (!player.upgradeStacks) {\r\n        player.upgradeStacks = {};\r\n    }\r\n    player.upgradeStacks[upgradeKey] = (player.upgradeStacks[upgradeKey] || 0) + 1;\r\n    \r\n    // Apply upgrade (will recalculate from base values)\r\n    recalculateAllUpgrades(player);\r\n}\r\n\r\n// Recalculate all upgrades from base values\r\nexport function recalculateAllUpgrades(player) {\r\n    // Apply all upgrades in order\r\n    Object.keys(UPGRADES).forEach(key => {\r\n        if (player.upgradeStacks && player.upgradeStacks[key] > 0) {\r\n            UPGRADES[key].apply(player);\r\n        }\r\n    });\r\n}\r\n\r\n// Get upgrade description with stack count\r\nexport function getUpgradeDescription(upgrade, player) {\r\n    if (!upgrade) return '';\r\n    \r\n    if (upgrade.getDescription) {\r\n        const stacks = player?.upgradeStacks?.[upgrade.key] || 0;\r\n        return upgrade.getDescription(stacks);\r\n    }\r\n    \r\n    if (upgrade.weaponKey) {\r\n        return upgrade.getDescription ? upgrade.getDescription() : upgrade.description;\r\n    }\r\n    \r\n    return upgrade.description;\r\n}\r\n","/**\r\n * UI Configuration & Design System\r\n *\r\n * Centralized UI styling for consistent design across all game scenes\r\n */\r\n\r\n// =============================================================================\r\n// SIZE SYSTEM - Button Hierarchy\r\n// =============================================================================\r\n\r\nexport const UI_SIZES = {\r\n    // Button sizes - use these for consistent button dimensions\r\n    BUTTON: {\r\n        XS: { width: 80, height: 24 },    // Tab buttons, small actions\r\n        SM: { width: 120, height: 30 },   // Secondary actions, back buttons\r\n        MD: { width: 160, height: 36 },   // Standard actions\r\n        LG: { width: 280, height: 45 },   // Primary CTAs (Play, Start, Confirm)\r\n        XL: { width: 320, height: 50 }    // Full-width menu buttons\r\n    },\r\n    // Card sizes - use these for consistent card dimensions\r\n    CARD: {\r\n        FULL: { width: 340, height: 105 },  // Shop items, detailed cards\r\n        HALF: { width: 165, height: 100 },  // Character select, dual-column\r\n        ICON: { width: 60, height: 60 }     // Stat icons, cosmetic previews\r\n    },\r\n    // Progress bar sizes\r\n    PROGRESS: {\r\n        STANDARD: { width: 100, height: 8 },   // Upgrade progress\r\n        WIDE: { width: 200, height: 12 },      // XP bars, loading\r\n        NARROW: { width: 80, height: 6 }       // Inline stats\r\n    }\r\n};\r\n\r\n// =============================================================================\r\n// TYPOGRAPHY SCALE\r\n// =============================================================================\r\n\r\nexport const UI_TEXT_SIZES = {\r\n    H1: 24,              // Scene titles (was TITLE at 36, reduced for better fit)\r\n    H2: 18,              // Section headers\r\n    BODY: 16,            // Main content\r\n    SMALL: 14,           // Descriptions\r\n    TINY: 12,            // Labels, hints\r\n    MICRO: 11,           // Stats, fine print\r\n    // Legacy names (for backwards compatibility)\r\n    TITLE: 36,           // Scene titles (legacy)\r\n    HEADER: 24,          // Section headers (legacy)\r\n    LABEL: 18,           // Important labels (legacy)\r\n    BUTTON: 20,          // Button text (legacy)\r\n    HUD: 16              // In-game HUD (legacy)\r\n};\r\n\r\n// =============================================================================\r\n// COLORS\r\n// =============================================================================\r\n\r\nexport const UI_COLORS = {\r\n    // Primary Actions\r\n    PRIMARY: [80, 180, 80],           // Green - Start, Confirm\r\n    PRIMARY_HOVER: [120, 220, 120],\r\n\r\n    // Secondary Actions\r\n    SECONDARY: [80, 120, 200],        // Blue - Info, Navigate\r\n    SECONDARY_HOVER: [120, 160, 255],\r\n\r\n    // Tertiary Actions\r\n    TERTIARY: [180, 80, 180],         // Purple - Special\r\n    TERTIARY_HOVER: [220, 120, 220],\r\n\r\n    // Shop/Currency\r\n    GOLD: [200, 150, 50],             // Gold - Shop, Currency\r\n    GOLD_HOVER: [240, 190, 90],\r\n\r\n    // Neutral\r\n    NEUTRAL: [100, 100, 120],         // Gray - Settings, Cancel\r\n    NEUTRAL_HOVER: [140, 140, 160],\r\n\r\n    // Destructive\r\n    DANGER: [180, 50, 50],            // Red - Quit, Delete\r\n    DANGER_HOVER: [220, 90, 90],\r\n\r\n    // Status Colors\r\n    SUCCESS: [100, 255, 100],         // Green - Success messages\r\n    WARNING: [255, 200, 100],         // Orange - Warnings\r\n    ERROR: [255, 100, 100],           // Red - Errors\r\n    INFO: [100, 200, 255],            // Blue - Info messages\r\n\r\n    // Text Colors\r\n    TEXT_PRIMARY: [255, 255, 255],    // White - Primary text\r\n    TEXT_SECONDARY: [200, 200, 200],  // Light gray - Secondary text\r\n    TEXT_TERTIARY: [150, 150, 150],   // Medium gray - Tertiary text\r\n    TEXT_DISABLED: [100, 100, 100],   // Dark gray - Disabled text\r\n\r\n    // Background Colors\r\n    BG_DARK: [20, 20, 30],            // Dark background\r\n    BG_MEDIUM: [40, 40, 50],          // Medium background\r\n    BG_LIGHT: [60, 60, 70],           // Light background\r\n    BG_DISABLED: [60, 60, 60],        // Disabled background\r\n\r\n    // UI Element Colors\r\n    BORDER: [150, 180, 255],          // Standard border\r\n    BORDER_HOVER: [255, 255, 255],    // Hovered border\r\n    BORDER_ACTIVE: [100, 200, 255],   // Active border\r\n\r\n    // HUD Colors\r\n    HEALTH_FULL: [100, 255, 100],     // Green health\r\n    HEALTH_MEDIUM: [255, 255, 100],   // Yellow health\r\n    HEALTH_LOW: [255, 100, 100],      // Red health\r\n    XP_BAR: [100, 200, 255],          // Blue XP bar\r\n\r\n    // Boss/Enemy Colors\r\n    BOSS_NAME: [255, 200, 100],       // Gold for boss names\r\n    MINIBOSS_NAME: [255, 150, 100],   // Orange for miniboss names\r\n};\r\n\r\n// =============================================================================\r\n// SPACING - Standard spacing scale\r\n// =============================================================================\r\n\r\nexport const UI_SPACING = {\r\n    // Standard spacing scale\r\n    XS: 4,                    // Extra small spacing\r\n    SM: 8,                    // Small spacing\r\n    MD: 16,                   // Medium spacing\r\n    LG: 24,                   // Large spacing\r\n    XL: 32,                   // Extra large spacing\r\n    // Legacy spacing (for backwards compatibility)\r\n    BUTTON_VERTICAL: 65,      // Vertical spacing between menu buttons\r\n    BUTTON_HORIZONTAL: 20,    // Horizontal spacing between buttons\r\n    ITEM_SPACING: 50,         // Spacing between list items\r\n    SECTION_SPACING: 100,     // Spacing between major sections\r\n    CONTENT_MARGIN: 40,       // Margin from screen edges\r\n    PADDING_SMALL: 10,        // Small padding\r\n    PADDING_MEDIUM: 20,       // Medium padding\r\n    PADDING_LARGE: 40         // Large padding\r\n};\r\n\r\n// =============================================================================\r\n// BUTTON DEFAULTS\r\n// =============================================================================\r\n\r\nexport const UI_BUTTON = {\r\n    WIDTH: 300,\r\n    HEIGHT: 50,\r\n    BORDER_WIDTH: 2,\r\n    HOVER_SCALE: 1.05,\r\n    TRANSITION_TIME: 0.15\r\n};\r\n\r\n// =============================================================================\r\n// TERMINOLOGY (Standardized)\r\n// =============================================================================\r\n\r\nexport const UI_TERMS = {\r\n    HEALTH: 'HP',             // Use \"HP\" not \"Health\"\r\n    EXPERIENCE: 'XP',         // Use \"XP\" not \"Experience\"\r\n    LEVEL: 'Level',           // Capitalize\r\n    FLOOR: 'Floor',           // Capitalize\r\n    ROOM: 'Room',             // Capitalize\r\n    CURRENCY: 'Silver',       // Default currency name (can be overridden)\r\n    DAMAGE: 'Damage',\r\n    SPEED: 'Speed',\r\n    BOSS: 'BOSS',             // ALL CAPS for emphasis\r\n    MINIBOSS: 'MINIBOSS'\r\n};\r\n\r\n// =============================================================================\r\n// TEXT FORMATTING FUNCTIONS\r\n// =============================================================================\r\n\r\n/**\r\n * Format button text (ALL CAPS)\r\n */\r\nexport function formatButtonText(text) {\r\n    return text.toUpperCase();\r\n}\r\n\r\n/**\r\n * Format section header (Title Case)\r\n */\r\nexport function formatHeader(text) {\r\n    return text.split(' ')\r\n        .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\r\n        .join(' ');\r\n}\r\n\r\n/**\r\n * Format status text (ALL CAPS)\r\n */\r\nexport function formatStatus(text) {\r\n    return text.toUpperCase();\r\n}\r\n\r\n/**\r\n * Format stat label (Sentence case)\r\n */\r\nexport function formatStatLabel(text) {\r\n    return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();\r\n}\r\n\r\n/**\r\n * Format floor and room display\r\n */\r\nexport function formatFloorRoom(floor, room, abbreviated = false) {\r\n    if (abbreviated) {\r\n        return `F${floor} R${room}`;\r\n    }\r\n    return `Floor ${floor}, Room ${room}`;\r\n}\r\n\r\n/**\r\n * Format health display\r\n */\r\nexport function formatHealth(current, max) {\r\n    return `${UI_TERMS.HEALTH}: ${current}/${max}`;\r\n}\r\n\r\n/**\r\n * Format XP display\r\n */\r\nexport function formatXP(current, max) {\r\n    return `${current}/${max}`;\r\n}\r\n\r\n// =============================================================================\r\n// Z-LAYER SYSTEM\r\n// =============================================================================\r\n\r\nexport const UI_Z_LAYERS = {\r\n    BACKGROUND: 0,\r\n    GAME_ENTITIES: 10,\r\n    PARTICLES: 50,\r\n    UI_BACKGROUND: 100,\r\n    UI_ELEMENTS: 200,\r\n    UI_TEXT: 300,\r\n    OVERLAY: 500,\r\n    MODAL: 1500,\r\n    TOOLTIP: 2000,\r\n    PAUSE_MENU: 2001,\r\n    DEBUG: 9999\r\n};\r\n\r\n// =============================================================================\r\n// ANIMATION TIMINGS\r\n// =============================================================================\r\n\r\nexport const UI_ANIMATIONS = {\r\n    FAST: 0.1,\r\n    NORMAL: 0.2,\r\n    SLOW: 0.3,\r\n    PULSE_SPEED: 2,\r\n    WAVE_SPEED: 1\r\n};\r\n\r\n// =============================================================================\r\n// CURRENCY SYMBOLS (for rotating display)\r\n// =============================================================================\r\n\r\nexport const CURRENCY_SYMBOLS = ['$', '', '', '', '', '', '', ''];\r\n\r\n/**\r\n * Create background particle effects for menu scenes\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} options - Configuration options\r\n * @param {number} options.patternCount - Number of pulsing patterns (default: 12)\r\n * @param {number} options.particleCount - Number of falling particles (default: 20)\r\n * @param {boolean} options.includeCursorFollowers - Include cursor-following ships (default: false)\r\n */\r\nexport function createMenuParticles(k, options = {}) {\r\n    const {\r\n        patternCount = 12,\r\n        particleCount = 20,\r\n        includeCursorFollowers = false\r\n    } = options;\r\n\r\n    // Pulsing geometric ASCII patterns\r\n    const patterns = ['', '', '', '', '', '', '', ''];\r\n    for (let i = 0; i < patternCount; i++) {\r\n        const pattern = k.add([\r\n            k.text(patterns[Math.floor(Math.random() * patterns.length)], { size: 20 }),\r\n            k.pos(Math.random() * k.width(), Math.random() * k.height()),\r\n            k.color(...UI_COLORS.BG_LIGHT),\r\n            k.opacity(0.15),\r\n            k.scale(1),\r\n            k.z(UI_Z_LAYERS.PARTICLES)\r\n        ]);\r\n\r\n        pattern.pulseTime = Math.random() * Math.PI * 2;\r\n        pattern.pulseSpeed = 1 + Math.random() * 2;\r\n\r\n        pattern.onUpdate(() => {\r\n            pattern.pulseTime += k.dt() * pattern.pulseSpeed;\r\n            const scale = 0.8 + Math.sin(pattern.pulseTime) * 0.3;\r\n            pattern.scale = k.vec2(scale, scale);\r\n            pattern.opacity = 0.1 + Math.abs(Math.sin(pattern.pulseTime)) * 0.15;\r\n        });\r\n    }\r\n\r\n    // Falling particles\r\n    for (let i = 0; i < particleCount; i++) {\r\n        const particle = k.add([\r\n            k.text(['*', '+', '', ''][Math.floor(Math.random() * 4)], { size: 12 }),\r\n            k.pos(Math.random() * k.width(), Math.random() * k.height()),\r\n            k.color(...UI_COLORS.BG_LIGHT),\r\n            k.opacity(0.3 + Math.random() * 0.3),\r\n            k.z(UI_Z_LAYERS.PARTICLES)\r\n        ]);\r\n\r\n        particle.speed = 10 + Math.random() * 20;\r\n        particle.onUpdate(() => {\r\n            particle.pos.y += particle.speed * k.dt();\r\n            if (particle.pos.y > k.height()) {\r\n                particle.pos.y = 0;\r\n                particle.pos.x = Math.random() * k.width();\r\n            }\r\n        });\r\n    }\r\n\r\n    // Cursor-following ships/asteroids (optional easter egg)\r\n    if (includeCursorFollowers) {\r\n        const cursorFollowers = [];\r\n        k.loop(5, () => {\r\n            if (cursorFollowers.length < 3 && Math.random() < 0.3) {\r\n                const shipChars = ['', '', '', '', '', '', ''];\r\n                const ship = k.add([\r\n                    k.text(shipChars[Math.floor(Math.random() * shipChars.length)], { size: 16 }),\r\n                    k.pos(Math.random() * k.width(), Math.random() * k.height()),\r\n                    k.color(100 + Math.random() * 100, 100 + Math.random() * 100, 200 + Math.random() * 55),\r\n                    k.opacity(0.4 + Math.random() * 0.2),\r\n                    k.rotate(Math.random() * 360),\r\n                    k.z(UI_Z_LAYERS.PARTICLES)\r\n                ]);\r\n\r\n                ship.followSpeed = 20 + Math.random() * 30;\r\n                ship.rotationSpeed = 50 + Math.random() * 100;\r\n                ship.lifetime = 15 + Math.random() * 10;\r\n\r\n                ship.onUpdate(() => {\r\n                    // Follow mouse cursor\r\n                    const mousePos = k.mousePos();\r\n                    const dir = mousePos.sub(ship.pos);\r\n                    const dist = dir.len();\r\n\r\n                    if (dist > 5) {\r\n                        const normalized = dir.scale(1 / dist);\r\n                        ship.pos = ship.pos.add(normalized.scale(ship.followSpeed * k.dt()));\r\n                    }\r\n\r\n                    // Rotate slowly\r\n                    ship.angle += ship.rotationSpeed * k.dt();\r\n\r\n                    // Fade out over lifetime\r\n                    ship.lifetime -= k.dt();\r\n                    if (ship.lifetime <= 0) {\r\n                        k.destroy(ship);\r\n                        const index = cursorFollowers.indexOf(ship);\r\n                        if (index > -1) cursorFollowers.splice(index, 1);\r\n                    }\r\n                });\r\n\r\n                cursorFollowers.push(ship);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * ASCII block art definitions for sub-menu titles\r\n * Each title is rendered as multi-line ASCII art using block characters\r\n */\r\nconst ASCII_TITLES = {\r\n    'CONTESTANTS': [\r\n        '           ',\r\n        '    ',\r\n        '                              ',\r\n        '                            ',\r\n        '                      ',\r\n        '                           '\r\n    ],\r\n    'MERCH': [\r\n        '       ',\r\n        '   ',\r\n        '       ',\r\n        '       ',\r\n        '      ',\r\n        '          '\r\n    ],\r\n    'OPTIONS': [\r\n        '        ',\r\n        '  ',\r\n        '             ',\r\n        '             ',\r\n        '            ',\r\n        '                 '\r\n    ],\r\n    'RATINGS AND RECORDS': [\r\n        '                           ',\r\n        '            ',\r\n        '                               ',\r\n        '                              ',\r\n        '                         ',\r\n        '                                  '\r\n    ],\r\n    'PROFILE': [\r\n        '         ',\r\n        '     ',\r\n        '            ',\r\n        '             ',\r\n        '            ',\r\n        '              '\r\n    ]\r\n};\r\n\r\n/**\r\n * Create an animated ASCII block art title with rainbow wave effect (similar to main menu title)\r\n * Uses multi-line ASCII art constructed from block characters\r\n * @param {Object} k - Kaplay instance\r\n * @param {string} text - Title text (will be converted to uppercase and matched to ASCII art)\r\n * @param {number} x - X position (center)\r\n * @param {number} y - Y position (center of title)\r\n * @param {number} fontSize - Font size (default: 8, smaller than main menu's 10)\r\n * @returns {Array} - Array of title line objects\r\n */\r\nexport function createAnimatedTitle(k, text, x, y, fontSize = 8) {\r\n    // Helper function to convert HSL to RGB (same as main menu)\r\n    function hslToRgb(h, s, l) {\r\n        s /= 100;\r\n        l /= 100;\r\n        const c = (1 - Math.abs(2 * l - 1)) * s;\r\n        const x = c * (1 - Math.abs((h / 60) % 2 - 1));\r\n        const m = l - c / 2;\r\n        let r = 0, g = 0, b = 0;\r\n        if (h >= 0 && h < 60) { r = c; g = x; b = 0; }\r\n        else if (h >= 60 && h < 120) { r = x; g = c; b = 0; }\r\n        else if (h >= 120 && h < 180) { r = 0; g = c; b = x; }\r\n        else if (h >= 180 && h < 240) { r = 0; g = x; b = c; }\r\n        else if (h >= 240 && h < 300) { r = x; g = 0; b = c; }\r\n        else if (h >= 300 && h < 360) { r = c; g = 0; b = x; }\r\n        return [\r\n            Math.round((r + m) * 255),\r\n            Math.round((g + m) * 255),\r\n            Math.round((b + m) * 255)\r\n        ];\r\n    }\r\n\r\n    // Get ASCII art for the title (use uppercase key)\r\n    const titleKey = formatButtonText(text);\r\n    const asciiTitle = ASCII_TITLES[titleKey];\r\n    \r\n    // Fallback to plain text if ASCII art not found\r\n    if (!asciiTitle) {\r\n        console.warn(`ASCII art not found for \"${titleKey}\", using plain text`);\r\n        const title = k.add([\r\n            k.text(titleKey, { size: fontSize * 2, font: 'monospace' }),\r\n            k.pos(x, y),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT),\r\n            'animatedTitle'\r\n        ]);\r\n        \r\n        // Apply same animation\r\n        let colorTime = 0;\r\n        title.onUpdate(() => {\r\n            colorTime += k.dt();\r\n            const hue = (colorTime * 50) % 360;\r\n            const color = hslToRgb(hue, 80, 60);\r\n            title.color = k.rgb(...color);\r\n            const offset = Math.sin(colorTime * 2) * 2;\r\n            title.pos.y = y + offset;\r\n        });\r\n        return [title];\r\n    }\r\n\r\n    // Create animated ASCII title (same structure as main menu)\r\n    const titleLines = [];\r\n    const lineSpacing = 10; // Slightly tighter than main menu's 12\r\n    const startY = y - (asciiTitle.length * lineSpacing) / 2;\r\n\r\n    asciiTitle.forEach((line, index) => {\r\n        const titleLine = k.add([\r\n            k.text(line, { size: fontSize, font: 'monospace' }),\r\n            k.pos(x, startY + index * lineSpacing),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT),\r\n            'animatedTitle'\r\n        ]);\r\n        titleLines.push(titleLine);\r\n    });\r\n\r\n    // Animated color wave effect (same as main menu)\r\n    let colorTime = 0;\r\n    k.onUpdate(() => {\r\n        colorTime += k.dt();\r\n        titleLines.forEach((line, index) => {\r\n            // Rainbow wave effect (same as main menu)\r\n            const hue = (colorTime * 50 + index * 20) % 360;\r\n            const color = hslToRgb(hue, 80, 60);\r\n            line.color = k.rgb(...color);\r\n\r\n            // Subtle floating animation (same as main menu)\r\n            const offset = Math.sin(colorTime * 2 + index * 0.3) * 2;\r\n            line.pos.y = startY + index * lineSpacing + offset;\r\n\r\n            // Glitch effect (random chance, same as main menu)\r\n            if (Math.random() < 0.001) {\r\n                line.pos.x = x + (Math.random() - 0.5) * 10;\r\n                k.wait(0.1, () => {\r\n                    if (line.exists()) {\r\n                        line.pos.x = x;\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    });\r\n\r\n    return titleLines;\r\n}\r\n\r\n/**\r\n * Create a standardized credit indicator with rotating currency symbols\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} currency - Current currency amount\r\n * @param {string} currencyName - Name of currency (e.g., \"Credits\")\r\n * @returns {Object} - Object with panel, icon, and text elements for updates\r\n */\r\nexport function createCreditIndicator(k, currency, currencyName) {\r\n    // Currency symbols rotate with random duration between 2-5 seconds\r\n    const getRandomInterval = () => 2.0 + Math.random() * 3.0; // Random between 2-5 seconds\r\n    \r\n    // Create measurement text to calculate panel width (with symbol placeholder, no currency name)\r\n    const measurementText = k.add([\r\n        k.text(`${CURRENCY_SYMBOLS[0]}: ${currency}`, { size: UI_TEXT_SIZES.LABEL }),\r\n        k.pos(0, 0),\r\n        k.opacity(0),\r\n        k.fixed()\r\n    ]);\r\n    \r\n    const panelWidth = measurementText.width + 30;\r\n    const panelHeight = 40;\r\n    \r\n    k.destroy(measurementText);\r\n    \r\n    // Panel background\r\n    const panel = k.add([\r\n        k.rect(panelWidth, panelHeight),\r\n        k.pos(k.width() - 20, 20),\r\n        k.anchor('topright'),\r\n        k.color(...UI_COLORS.BG_MEDIUM),\r\n        k.outline(2, k.rgb(...UI_COLORS.GOLD)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_BACKGROUND)\r\n    ]);\r\n    \r\n    // Currency text with rotating symbol only (no currency name)\r\n    const text = k.add([\r\n        k.text(`${CURRENCY_SYMBOLS[0]}: ${currency}`, { size: UI_TEXT_SIZES.LABEL }),\r\n        k.pos(k.width() - 20 - panelWidth / 2, 40),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.GOLD),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_TEXT)\r\n    ]);\r\n    \r\n    // Store rotation state and current currency on text\r\n    text.symbolIndex = 0;\r\n    text.timeSinceLastChange = 0;\r\n    text.currentCurrency = currency;\r\n    text.symbolChangeInterval = getRandomInterval(); // Initialize with random interval\r\n    \r\n    // Update currency amount\r\n    const updateCurrency = (newCurrency) => {\r\n        text.currentCurrency = newCurrency;\r\n        text.text = `${CURRENCY_SYMBOLS[text.symbolIndex]}: ${newCurrency}`;\r\n        // Recalculate panel width if needed\r\n        const newWidth = text.width + 30;\r\n        if (Math.abs(newWidth - panelWidth) > 10) {\r\n            panel.width = newWidth;\r\n            text.pos.x = k.width() - 20 - newWidth / 2;\r\n        }\r\n    };\r\n    \r\n    // Add update handler for rotating symbols\r\n    text.onUpdate(() => {\r\n        text.timeSinceLastChange += k.dt();\r\n        if (text.timeSinceLastChange >= text.symbolChangeInterval) {\r\n            text.timeSinceLastChange = 0;\r\n            text.symbolIndex = (text.symbolIndex + 1) % CURRENCY_SYMBOLS.length;\r\n            text.text = `${CURRENCY_SYMBOLS[text.symbolIndex]}: ${text.currentCurrency}`;\r\n            // Get new random interval for next rotation\r\n            text.symbolChangeInterval = getRandomInterval();\r\n        }\r\n    });\r\n    \r\n    return {\r\n        panel,\r\n        text,\r\n        updateCurrency\r\n    };\r\n}\r\n\r\n// =============================================================================\r\n// STYLED TEXT HELPER\r\n// =============================================================================\r\n\r\n/**\r\n * Create styled text using the typography scale\r\n * @param {Object} k - Kaplay instance\r\n * @param {string} content - Text content\r\n * @param {Object} options - Configuration options\r\n * @param {string} options.level - Typography level: 'H1', 'H2', 'BODY', 'SMALL', 'TINY', 'MICRO'\r\n * @param {number} options.x - X position\r\n * @param {number} options.y - Y position\r\n * @param {string} options.anchor - Anchor point (default: 'center')\r\n * @param {Array} options.color - RGB color array (default: TEXT_PRIMARY)\r\n * @returns {Object} - The text game object\r\n */\r\nexport function createStyledText(k, content, options = {}) {\r\n    const {\r\n        level = 'BODY',\r\n        x = 0,\r\n        y = 0,\r\n        anchor = 'center',\r\n        color = UI_COLORS.TEXT_PRIMARY\r\n    } = options;\r\n\r\n    const size = UI_TEXT_SIZES[level] || UI_TEXT_SIZES.BODY;\r\n\r\n    return k.add([\r\n        k.text(content, { size }),\r\n        k.pos(x, y),\r\n        k.anchor(anchor),\r\n        k.color(...color),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_TEXT)\r\n    ]);\r\n}\r\n\r\n// =============================================================================\r\n// PROGRESS BAR HELPER\r\n// =============================================================================\r\n\r\n/**\r\n * Create a progress bar\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} options - Configuration options\r\n * @param {number} options.x - X position\r\n * @param {number} options.y - Y position\r\n * @param {number} options.width - Bar width (default: 100)\r\n * @param {number} options.height - Bar height (default: 8)\r\n * @param {number} options.value - Current value (0-1)\r\n * @param {Array} options.fillColor - RGB color for filled portion\r\n * @param {Array} options.bgColor - RGB color for background\r\n * @returns {Object} - Object with bg, fill elements and update function\r\n */\r\nexport function createProgressBar(k, options = {}) {\r\n    const {\r\n        x = 0,\r\n        y = 0,\r\n        width = UI_SIZES.PROGRESS.STANDARD.width,\r\n        height = UI_SIZES.PROGRESS.STANDARD.height,\r\n        value = 0,\r\n        fillColor = UI_COLORS.PRIMARY,\r\n        bgColor = UI_COLORS.BG_DARK\r\n    } = options;\r\n\r\n    const clampedValue = Math.max(0, Math.min(1, value));\r\n\r\n    // Background\r\n    const bg = k.add([\r\n        k.rect(width, height),\r\n        k.pos(x, y),\r\n        k.anchor('topleft'),\r\n        k.color(...bgColor),\r\n        k.outline(1, k.rgb(60, 60, 80)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n    ]);\r\n\r\n    // Fill\r\n    const fillWidth = Math.max(0, (width - 2) * clampedValue);\r\n    const fill = k.add([\r\n        k.rect(fillWidth, height - 2),\r\n        k.pos(x + 1, y + 1),\r\n        k.anchor('topleft'),\r\n        k.color(...fillColor),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\r\n    ]);\r\n\r\n    // Update function\r\n    const updateValue = (newValue) => {\r\n        const clamped = Math.max(0, Math.min(1, newValue));\r\n        fill.width = Math.max(0, (width - 2) * clamped);\r\n    };\r\n\r\n    return {\r\n        bg,\r\n        fill,\r\n        updateValue\r\n    };\r\n}","/**\r\n * Toast Notification System\r\n * Displays non-blocking notifications in the top-right corner of the screen\r\n */\r\n\r\nimport { UI_Z_LAYERS, UI_COLORS } from '../config/uiConfig.js';\r\nimport { ACHIEVEMENT_COLORS } from '../data/achievements.js';\r\n\r\n// Toast queue and state\r\nconst toastState = {\r\n    queue: [],\r\n    activeToasts: [],\r\n    k: null,\r\n    maxActiveToasts: 3,\r\n    toastWidth: 300,\r\n    toastHeight: 80,\r\n    toastMargin: 10,\r\n    animationDuration: 0.3,\r\n    displayDuration: 3\r\n};\r\n\r\n/**\r\n * Initialize the toast system with a Kaplay instance\r\n * @param {Object} k - Kaplay instance\r\n */\r\nexport function initToastSystem(k) {\r\n    toastState.k = k;\r\n    toastState.queue = [];\r\n    toastState.activeToasts = [];\r\n}\r\n\r\n/**\r\n * Show a toast notification\r\n * @param {Object} options - Toast options\r\n * @param {string} options.title - Toast title\r\n * @param {string} options.message - Toast message\r\n * @param {string} options.icon - Icon character to display\r\n * @param {Array} options.iconColor - RGB color array for icon\r\n * @param {string} options.type - Toast type ('achievement', 'info', 'success', 'error')\r\n * @param {number} options.duration - Display duration in seconds (default: 3)\r\n */\r\nexport function showToast(options) {\r\n    const k = toastState.k;\r\n    if (!k) {\r\n        console.warn('Toast system not initialized');\r\n        return;\r\n    }\r\n\r\n    const toast = {\r\n        title: options.title || 'Notification',\r\n        message: options.message || '',\r\n        icon: options.icon || '!',\r\n        iconColor: options.iconColor || UI_COLORS.TEXT_PRIMARY,\r\n        type: options.type || 'info',\r\n        duration: options.duration || toastState.displayDuration\r\n    };\r\n\r\n    toastState.queue.push(toast);\r\n    processQueue();\r\n}\r\n\r\n/**\r\n * Show an achievement unlock toast\r\n * @param {Object} achievement - Achievement object\r\n */\r\nexport function showAchievementToast(achievement) {\r\n    const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\r\n\r\n    // Determine title based on difficulty\r\n    let title = ' Achievement Unlocked!';\r\n    if (achievement.difficulty === 'challenge') {\r\n        title = ' Challenge Complete!';\r\n    } else if (achievement.difficulty === 'benchmark') {\r\n        title = ' Milestone Reached!';\r\n    }\r\n\r\n    showToast({\r\n        title: title,\r\n        message: `${achievement.name}\\n${achievement.description}`,\r\n        icon: achievement.icon,\r\n        iconColor: difficultyColor,\r\n        type: 'achievement',\r\n        duration: 5,\r\n        difficulty: achievement.difficulty\r\n    });\r\n}\r\n\r\n/**\r\n * Show a multiplayer achievement toast (when another player unlocks)\r\n * @param {string} playerName - Name of the player who unlocked\r\n * @param {Object} achievement - Achievement object\r\n */\r\nexport function showMultiplayerAchievementToast(playerName, achievement) {\r\n    const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\r\n\r\n    showToast({\r\n        title: `${playerName} unlocked:`,\r\n        message: achievement.name,\r\n        icon: achievement.icon,\r\n        iconColor: difficultyColor,\r\n        type: 'achievement',\r\n        duration: 3\r\n    });\r\n}\r\n\r\n/**\r\n * Process the toast queue and display toasts\r\n */\r\nfunction processQueue() {\r\n    const k = toastState.k;\r\n    if (!k) return;\r\n\r\n    // Check if we can show more toasts\r\n    while (toastState.queue.length > 0 && toastState.activeToasts.length < toastState.maxActiveToasts) {\r\n        const toastData = toastState.queue.shift();\r\n        createToastUI(toastData);\r\n    }\r\n}\r\n\r\n/**\r\n * Create the UI elements for a toast\r\n * @param {Object} toastData - Toast data\r\n */\r\nfunction createToastUI(toastData) {\r\n    const k = toastState.k;\r\n    if (!k) return;\r\n\r\n    const startX = k.width() + toastState.toastWidth; // Start off-screen right\r\n    const targetX = k.width() - toastState.toastMargin - toastState.toastWidth / 2;\r\n    const toastIndex = toastState.activeToasts.length;\r\n    const y = toastState.toastMargin + toastIndex * (toastState.toastHeight + toastState.toastMargin) + toastState.toastHeight / 2 + 20;\r\n\r\n    // Get border color based on type\r\n    let borderColor = UI_COLORS.BORDER;\r\n    let bgColor = [...UI_COLORS.BG_MEDIUM];\r\n    let borderWidth = 2;\r\n    if (toastData.type === 'achievement') {\r\n        borderColor = toastData.iconColor;\r\n        bgColor = [35, 30, 45];\r\n        borderWidth = 3; // Thicker border for achievements\r\n    } else if (toastData.type === 'success') {\r\n        borderColor = UI_COLORS.SUCCESS;\r\n    } else if (toastData.type === 'error') {\r\n        borderColor = UI_COLORS.ERROR;\r\n    }\r\n\r\n    // Toast container\r\n    const container = k.add([\r\n        k.rect(toastState.toastWidth, toastState.toastHeight),\r\n        k.pos(startX, y),\r\n        k.anchor('center'),\r\n        k.color(...bgColor),\r\n        k.outline(borderWidth, k.rgb(...borderColor)),\r\n        k.opacity(0.95),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.TOOLTIP),\r\n        'toast'\r\n    ]);\r\n\r\n    // Add glow pulse effect for achievement toasts\r\n    if (toastData.type === 'achievement') {\r\n        let glowTime = 0;\r\n        container.onUpdate(() => {\r\n            glowTime += k.dt();\r\n            // Subtle pulse on the border brightness\r\n            const pulse = Math.sin(glowTime * 4) * 0.2 + 0.8;\r\n            const r = Math.min(255, borderColor[0] * pulse);\r\n            const g = Math.min(255, borderColor[1] * pulse);\r\n            const b = Math.min(255, borderColor[2] * pulse);\r\n            container.outline.color = k.rgb(r, g, b);\r\n        });\r\n    }\r\n\r\n    // Icon background\r\n    const iconBg = k.add([\r\n        k.rect(50, toastState.toastHeight - 10),\r\n        k.pos(startX - toastState.toastWidth / 2 + 30, y),\r\n        k.anchor('center'),\r\n        k.color(...bgColor),\r\n        k.opacity(0.5),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.TOOLTIP + 1),\r\n        'toast'\r\n    ]);\r\n\r\n    // Icon (larger for emoji icons)\r\n    const iconSize = toastData.type === 'achievement' ? 32 : 28;\r\n    const icon = k.add([\r\n        k.text(toastData.icon, { size: iconSize }),\r\n        k.pos(startX - toastState.toastWidth / 2 + 30, y),\r\n        k.anchor('center'),\r\n        k.color(...toastData.iconColor),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.TOOLTIP + 2),\r\n        'toast'\r\n    ]);\r\n\r\n    // Add bounce effect to icon for achievements\r\n    if (toastData.type === 'achievement') {\r\n        let iconTime = 0;\r\n        const baseY = y;\r\n        icon.onUpdate(() => {\r\n            iconTime += k.dt();\r\n            // Gentle bounce effect\r\n            const bounce = Math.abs(Math.sin(iconTime * 3)) * 3;\r\n            icon.pos.y = baseY - bounce;\r\n        });\r\n    }\r\n\r\n    // Title\r\n    const title = k.add([\r\n        k.text(toastData.title, { size: 14 }),\r\n        k.pos(startX - toastState.toastWidth / 2 + 65, y - 20),\r\n        k.anchor('left'),\r\n        k.color(...(toastData.type === 'achievement' ? [255, 220, 100] : UI_COLORS.TEXT_PRIMARY)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.TOOLTIP + 2),\r\n        'toast'\r\n    ]);\r\n\r\n    // Message (support multi-line)\r\n    const messageLines = toastData.message.split('\\n');\r\n    const messageElements = [];\r\n    messageLines.forEach((line, index) => {\r\n        const msg = k.add([\r\n            k.text(line, { size: 12, width: toastState.toastWidth - 80 }),\r\n            k.pos(startX - toastState.toastWidth / 2 + 65, y - 5 + index * 16),\r\n            k.anchor('left'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.TOOLTIP + 2),\r\n            'toast'\r\n        ]);\r\n        messageElements.push(msg);\r\n    });\r\n\r\n    // Store all elements\r\n    const toastElements = {\r\n        container,\r\n        iconBg,\r\n        icon,\r\n        title,\r\n        messages: messageElements,\r\n        startX,\r\n        targetX,\r\n        y,\r\n        state: 'entering', // 'entering', 'visible', 'exiting', 'done'\r\n        timer: 0,\r\n        data: toastData\r\n    };\r\n\r\n    toastState.activeToasts.push(toastElements);\r\n\r\n    // Animation update handler\r\n    const updateHandler = k.onUpdate(() => {\r\n        if (toastElements.state === 'done') {\r\n            updateHandler.cancel();\r\n            return;\r\n        }\r\n\r\n        toastElements.timer += k.dt();\r\n\r\n        if (toastElements.state === 'entering') {\r\n            // Slide in animation\r\n            const progress = Math.min(toastElements.timer / toastState.animationDuration, 1);\r\n            const easedProgress = easeOutCubic(progress);\r\n            const currentX = lerp(toastElements.startX, toastElements.targetX, easedProgress);\r\n\r\n            updateToastPositionX(toastElements, currentX);\r\n\r\n            if (progress >= 1) {\r\n                toastElements.state = 'visible';\r\n                toastElements.timer = 0;\r\n            }\r\n        } else if (toastElements.state === 'visible') {\r\n            // Display duration\r\n            if (toastElements.timer >= toastElements.data.duration) {\r\n                toastElements.state = 'exiting';\r\n                toastElements.timer = 0;\r\n            }\r\n        } else if (toastElements.state === 'exiting') {\r\n            // Slide out animation\r\n            const progress = Math.min(toastElements.timer / toastState.animationDuration, 1);\r\n            const easedProgress = easeInCubic(progress);\r\n            const exitX = k.width() + toastState.toastWidth;\r\n            const currentX = lerp(toastElements.targetX, exitX, easedProgress);\r\n\r\n            updateToastPositionX(toastElements, currentX);\r\n\r\n            // Fade out\r\n            const opacity = 1 - progress;\r\n            toastElements.container.opacity = opacity * 0.95;\r\n            toastElements.iconBg.opacity = opacity * 0.5;\r\n            toastElements.icon.opacity = opacity;\r\n            toastElements.title.opacity = opacity;\r\n            toastElements.messages.forEach(msg => msg.opacity = opacity);\r\n\r\n            if (progress >= 1) {\r\n                toastElements.state = 'done';\r\n                destroyToast(toastElements);\r\n            }\r\n        }\r\n    });\r\n\r\n    toastElements.updateHandler = updateHandler;\r\n}\r\n\r\n/**\r\n * Update toast position on X axis\r\n * @param {Object} toastElements - Toast elements object\r\n * @param {number} x - New X position\r\n */\r\nfunction updateToastPositionX(toastElements, x) {\r\n    const offset = x - toastElements.container.pos.x;\r\n    toastElements.container.pos.x = x;\r\n    toastElements.iconBg.pos.x += offset;\r\n    toastElements.icon.pos.x += offset;\r\n    toastElements.title.pos.x += offset;\r\n    toastElements.messages.forEach(msg => msg.pos.x += offset);\r\n}\r\n\r\n/**\r\n * Destroy a toast and its elements\r\n * @param {Object} toastElements - Toast elements object\r\n */\r\nfunction destroyToast(toastElements) {\r\n    const k = toastState.k;\r\n    if (!k) return;\r\n\r\n    // Cancel update handler\r\n    if (toastElements.updateHandler) {\r\n        toastElements.updateHandler.cancel();\r\n    }\r\n\r\n    // Destroy all elements\r\n    if (toastElements.container.exists()) k.destroy(toastElements.container);\r\n    if (toastElements.iconBg.exists()) k.destroy(toastElements.iconBg);\r\n    if (toastElements.icon.exists()) k.destroy(toastElements.icon);\r\n    if (toastElements.title.exists()) k.destroy(toastElements.title);\r\n    toastElements.messages.forEach(msg => {\r\n        if (msg.exists()) k.destroy(msg);\r\n    });\r\n\r\n    // Remove from active toasts\r\n    const index = toastState.activeToasts.indexOf(toastElements);\r\n    if (index > -1) {\r\n        toastState.activeToasts.splice(index, 1);\r\n    }\r\n\r\n    // Reposition remaining toasts\r\n    repositionActiveToasts();\r\n\r\n    // Process queue\r\n    processQueue();\r\n}\r\n\r\n/**\r\n * Reposition active toasts after one is removed\r\n */\r\nfunction repositionActiveToasts() {\r\n    toastState.activeToasts.forEach((toast, index) => {\r\n        if (toast.state === 'visible' || toast.state === 'entering') {\r\n            const newY = toastState.toastMargin + index * (toastState.toastHeight + toastState.toastMargin) + toastState.toastHeight / 2 + 20;\r\n\r\n            // Animate to new position\r\n            const oldY = toast.container.pos.y;\r\n            const offsetY = newY - oldY;\r\n\r\n            toast.container.pos.y = newY;\r\n            toast.iconBg.pos.y += offsetY;\r\n            toast.icon.pos.y += offsetY;\r\n            toast.title.pos.y += offsetY;\r\n            toast.messages.forEach((msg, msgIndex) => {\r\n                msg.pos.y += offsetY;\r\n            });\r\n            toast.y = newY;\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Clear all active toasts\r\n */\r\nexport function clearAllToasts() {\r\n    const k = toastState.k;\r\n    if (!k) return;\r\n\r\n    // Destroy all active toasts\r\n    [...toastState.activeToasts].forEach(toast => {\r\n        destroyToast(toast);\r\n    });\r\n\r\n    // Clear queue\r\n    toastState.queue = [];\r\n}\r\n\r\n/**\r\n * Clean up toast system (call on scene change)\r\n */\r\nexport function cleanupToastSystem() {\r\n    clearAllToasts();\r\n    toastState.k = null;\r\n}\r\n\r\n// Easing functions\r\nfunction easeOutCubic(t) {\r\n    return 1 - Math.pow(1 - t, 3);\r\n}\r\n\r\nfunction easeInCubic(t) {\r\n    return t * t * t;\r\n}\r\n\r\nfunction lerp(start, end, t) {\r\n    return start + (end - start) * t;\r\n}\r\n","/**\r\n * Multiplayer Game System\r\n * Handles game state synchronization for multiplayer\r\n */\r\n\r\nimport { getParty, getPartySize, getLocalPlayer, clearPartyCallbacks } from './partySystem.js';\r\nimport { broadcast, sendToHost, sendToPeer, onMessage, offMessage, getNetworkInfo } from './networkSystem.js';\r\nimport { createEnemy } from '../entities/enemy.js';\r\nimport { createBoss } from '../entities/boss.js';\r\nimport { createXPPickup, createCurrencyPickup, getRandomCurrencyIcon } from '../entities/pickup.js';\r\nimport { SeededRandom, createSeed } from '../utils/seededRandom.js';\r\nimport { initConnectionQuality } from './connectionQuality.js';\r\nimport { applyUpgrade, recalculateAllUpgrades } from './upgrades.js';\r\nimport { createProjectile } from '../entities/projectile.js';\r\nimport { getPermanentUpgradeLevel, addCurrency } from './metaProgression.js';\r\nimport { ACHIEVEMENTS } from '../data/achievements.js';\r\nimport { showMultiplayerAchievementToast, initToastSystem } from './toastNotifications.js';\r\n\r\n// Debug flag - set to true to enable verbose multiplayer logging\r\nconst MP_DEBUG = false;\r\n\r\n// Multiplayer game state\r\nconst mpGame = {\r\n    isActive: false,\r\n    players: new Map(), // Map of slotIndex -> player entity\r\n    localPlayerSlot: 0, // Which slot is the local player\r\n    lastSyncTime: 0,\r\n    syncInterval: 1 / 15, // 15 updates per second (reduced from 20 for better performance)\r\n    lastResyncTime: 0,\r\n    resyncInterval: 5.0, // Re-sync check every 5 seconds (desync detection)\r\n    inputBuffer: [], // Store inputs to send to host\r\n    isHost: false,\r\n    // Entity tracking (host only)\r\n    enemies: new Map(), // Map of entityId -> enemy entity\r\n    projectiles: new Map(), // Map of entityId -> projectile entity\r\n    pickups: new Map(), // Map of entityId -> pickup entity\r\n    nextEntityId: 1, // Auto-incrementing ID for entities\r\n    // Kaplay instance reference\r\n    k: null,\r\n    // Seeded RNG for deterministic world generation\r\n    gameSeed: 0, // Base seed for this game session\r\n    floorRng: null, // SeededRandom instance for floor generation\r\n    roomRng: null, // SeededRandom instance for room generation\r\n    currentFloor: 1, // Track current floor for seed generation\r\n    currentRoom: { x: 0, y: 0 }, // Track current room for seed generation\r\n    pendingXP: 0, // XP accumulated while player was in upgrade draft screen\r\n    onGameSeedCallback: null // Callback for when game_seed is received (clients only)\r\n};\r\n\r\n/**\r\n * Initialize multiplayer game session\r\n * @param {boolean} isHost - Whether this client is the host\r\n * @param {number} localSlot - Local player's slot index\r\n * @param {Object} kaplayInstance - Kaplay instance for creating entities\r\n * @param {number} gameSeed - Optional seed for deterministic generation (host generates, broadcasts to clients)\r\n */\r\nexport function initMultiplayerGame(isHost, localSlot = 0, kaplayInstance = null, gameSeed = null) {\r\n    mpGame.isActive = true;\r\n    mpGame.isHost = isHost;\r\n    mpGame.localPlayerSlot = localSlot;\r\n    mpGame.players.clear();\r\n    mpGame.inputBuffer = [];\r\n    mpGame.lastSyncTime = 0;\r\n    mpGame.k = kaplayInstance;\r\n\r\n    // Initialize connection quality monitoring (registers ping/pong handlers)\r\n    initConnectionQuality();\r\n\r\n    // Clear entity tracking\r\n    mpGame.enemies.clear();\r\n    mpGame.projectiles.clear();\r\n    mpGame.pickups.clear();\r\n    mpGame.nextEntityId = 1;\r\n\r\n    // Initialize seeded RNG\r\n    if (gameSeed !== null) {\r\n        // Client: use seed from host\r\n        mpGame.gameSeed = gameSeed;\r\n    } else if (isHost) {\r\n        // Host: generate new game seed\r\n        mpGame.gameSeed = Math.floor(Math.random() * 0xFFFFFFFF);\r\n    }\r\n\r\n    // Initialize floor RNG (will be reset when floor changes)\r\n    mpGame.floorRng = new SeededRandom(mpGame.gameSeed);\r\n    mpGame.currentFloor = 1;\r\n    mpGame.currentRoom = { x: 0, y: 0 };\r\n\r\n    // Set up message handlers\r\n    if (isHost) {\r\n        setupHostHandlers();\r\n    } else {\r\n        // Reset handler registration flag to allow re-registration on reconnect\r\n        multiplayerClientHandlersRegistered = false;\r\n        setupClientHandlers();\r\n    }\r\n}\r\n\r\n/**\r\n * Set up message handlers for host\r\n */\r\nfunction setupHostHandlers() {\r\n    // Prevent duplicate handler registration\r\n    if (multiplayerHostHandlersRegistered) {\r\n        return;\r\n    }\r\n    multiplayerHostHandlersRegistered = true;\r\n\r\n    // Handle player input from clients\r\n    onMessage('player_input', (payload, fromPeerId) => {\r\n        // Validate payload structure\r\n        if (!payload || typeof payload !== 'object') return;\r\n\r\n        // Store input to be processed in game loop\r\n        // Find which player slot this peer belongs to\r\n        const party = getParty();\r\n        const slotIndex = party.slots.findIndex(slot => slot.peerId === fromPeerId);\r\n\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received input from peer:', fromPeerId, 'slot:', slotIndex);\r\n\r\n        if (slotIndex !== -1 && mpGame.players.has(slotIndex)) {\r\n            const player = mpGame.players.get(slotIndex);\r\n\r\n            // Check if player entity still exists (might be destroyed during scene transition)\r\n            if (!player || !player.exists()) {\r\n                if (MP_DEBUG) console.warn('[Multiplayer] Player entity destroyed for slot:', slotIndex);\r\n                return;\r\n            }\r\n\r\n            // Apply input to player with validation\r\n            if (payload.move && typeof payload.move === 'object') {\r\n                // Clamp movement values to valid range [-1, 1]\r\n                const moveX = Math.max(-1, Math.min(1, Number(payload.move.x) || 0));\r\n                const moveY = Math.max(-1, Math.min(1, Number(payload.move.y) || 0));\r\n                player.move = { x: moveX, y: moveY };\r\n            }\r\n            if (payload.shoot !== undefined) {\r\n                player.isShooting = Boolean(payload.shoot);\r\n            }\r\n            if (payload.aimAngle !== undefined) {\r\n                // Clamp aimAngle to valid range [-360, 360]\r\n                const aimAngle = Number(payload.aimAngle) || 0;\r\n                player.aimAngle = Math.max(-360, Math.min(360, aimAngle));\r\n            }\r\n            if (MP_DEBUG) console.log('[Multiplayer] Applied input to player at slot', slotIndex);\r\n        } else {\r\n            console.warn('[Multiplayer] Could not find player for peer:', fromPeerId, 'slot:', slotIndex);\r\n            console.warn('[Multiplayer] Party slots:', party.slots);\r\n            console.warn('[Multiplayer] Registered players:', Array.from(mpGame.players.keys()));\r\n        }\r\n    });\r\n\r\n    // Handle pause requests from clients\r\n    onMessage('pause_request', (payload, fromPeerId) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Pause request from peer:', fromPeerId, 'paused:', payload.paused);\r\n\r\n        // Host applies the pause state and broadcasts to all clients\r\n        if (mpGame.k) {\r\n            mpGame.k.paused = payload.paused;\r\n\r\n            // Update host's pause UI\r\n            if (mpGame.k.gameData && mpGame.k.gameData.updatePauseUI) {\r\n                mpGame.k.gameData.updatePauseUI(payload.paused);\r\n            }\r\n\r\n            // Broadcast to all clients (including the requester for confirmation)\r\n            broadcast('pause_state', { paused: payload.paused });\r\n\r\n            if (MP_DEBUG) console.log('[Multiplayer] Host set pause state to:', payload.paused);\r\n        }\r\n    });\r\n\r\n    // Handle player death notifications from clients\r\n    onMessage('player_death', (payload, fromPeerId) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received player death from client:', fromPeerId, 'slot:', payload.slotIndex);\r\n\r\n        // Mark player as dead on host\r\n        const player = mpGame.players.get(payload.slotIndex);\r\n        if (player && player.exists()) {\r\n            player.isDead = true;\r\n            player.canMove = false;\r\n            player.canShoot = false;\r\n            player.isShooting = false;\r\n\r\n            // Visual indication of death\r\n            player.opacity = 0.5;\r\n            if (player.outline && player.outline.exists()) {\r\n                player.outline.opacity = 0.5;\r\n            }\r\n\r\n            if (MP_DEBUG) console.log('[Multiplayer] Host marked player at slot', payload.slotIndex, 'as dead');\r\n\r\n            // Broadcast to all other clients\r\n            broadcast('player_death', { slotIndex: payload.slotIndex }, [fromPeerId]);\r\n        }\r\n    });\r\n\r\n    // Handle enemy death notifications from clients\r\n    onMessage('enemy_death', (payload, fromPeerId) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received enemy death from client:', fromPeerId, 'entity:', payload.entityId);\r\n\r\n        // Broadcast the death to all clients (including back to the sender for confirmation)\r\n        broadcast('entity_destroyed', {\r\n            entityId: payload.entityId,\r\n            entityType: payload.entityType,\r\n            x: payload.x,\r\n            y: payload.y\r\n        });\r\n\r\n    });\r\n\r\n    // Handle re-sync requests from clients\r\n    onMessage('resync_request', (payload, fromPeerId) => {\r\n        // Send full game state to requesting client immediately\r\n        sendToPeer(fromPeerId, 'game_state', collectGameState());\r\n    });\r\n\r\n    // Handle level up queued from clients\r\n    onMessage('level_up_queued', (payload, fromPeerId) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received level up queued from client:', fromPeerId, 'slot:', payload.slotIndex, 'level:', payload.level);\r\n\r\n        // Broadcast to ALL clients so everyone knows about the level up\r\n        broadcast('level_up_queued', {\r\n            slotIndex: payload.slotIndex,\r\n            level: payload.level,\r\n            timestamp: Date.now()\r\n        });\r\n\r\n        if (MP_DEBUG) console.log('[Multiplayer] Host broadcasted level up queued for slot:', payload.slotIndex);\r\n    });\r\n\r\n    // Handle emote from clients - rebroadcast to all\r\n    onMessage('player_emote', (payload, fromPeerId) => {\r\n        // Rebroadcast emote to all clients (including sender for consistency)\r\n        broadcast('player_emote', payload);\r\n    });\r\n\r\n    // Handle upgrade selection from clients\r\n    onMessage('upgrade_selected', (payload, fromPeerId) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received upgrade selection from client:', fromPeerId, 'slot:', payload.slotIndex, 'upgrade:', payload.upgradeKey);\r\n\r\n        // Apply upgrade to the player on host side\r\n        const player = mpGame.players.get(payload.slotIndex);\r\n        if (player && player.exists()) {\r\n            applyUpgrade(player, payload.upgradeKey);\r\n            // Track the upgrade in upgradeStacks for proper persistence\r\n            if (!player.upgradeStacks) player.upgradeStacks = {};\r\n            player.upgradeStacks[payload.upgradeKey] = (player.upgradeStacks[payload.upgradeKey] || 0) + 1;\r\n            // Track in selectedUpgrades for synergy detection\r\n            if (!player.selectedUpgrades) player.selectedUpgrades = new Set();\r\n            player.selectedUpgrades.add(payload.upgradeKey);\r\n            recalculateAllUpgrades(player);\r\n        }\r\n\r\n        // Broadcast to ALL clients (including back to sender) so everyone can apply the upgrade\r\n        broadcast('upgrade_selected', {\r\n            slotIndex: payload.slotIndex,\r\n            upgradeKey: payload.upgradeKey,\r\n            timestamp: Date.now()\r\n        });\r\n\r\n        if (MP_DEBUG) console.log('[Multiplayer] Host broadcasted upgrade selection for slot:', payload.slotIndex);\r\n    });\r\n\r\n    // Handle synergy activation from clients\r\n    onMessage('synergy_activated', (payload, fromPeerId) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received synergy activation from client:', fromPeerId, 'slot:', payload.slotIndex);\r\n\r\n        // Broadcast to ALL clients so everyone can apply the synergies\r\n        broadcast('synergy_activated', {\r\n            slotIndex: payload.slotIndex,\r\n            synergies: payload.synergies,\r\n            timestamp: Date.now()\r\n        });\r\n\r\n        if (MP_DEBUG) console.log('[Multiplayer] Host broadcasted synergy activation for slot:', payload.slotIndex);\r\n    });\r\n\r\n    // Handle achievement unlock from clients (rebroadcast to all)\r\n    onMessage('achievement_unlocked', (payload, fromPeerId) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received achievement unlock from client:', fromPeerId, 'achievement:', payload.achievementId);\r\n\r\n        // Broadcast to ALL clients so everyone can show the toast\r\n        broadcast('achievement_unlocked', {\r\n            achievementId: payload.achievementId,\r\n            playerSlotIndex: payload.playerSlotIndex,\r\n            playerName: payload.playerName\r\n        });\r\n    });\r\n}\r\n\r\n// Flags to prevent duplicate handler registration\r\nlet multiplayerClientHandlersRegistered = false;\r\nlet multiplayerHostHandlersRegistered = false;\r\n\r\n/**\r\n * Set up message handlers for client\r\n */\r\nfunction setupClientHandlers() {\r\n    // Prevent duplicate handler registration (memory leak fix)\r\n    if (multiplayerClientHandlersRegistered) {\r\n        return;\r\n    }\r\n    multiplayerClientHandlersRegistered = true;\r\n\r\n    // Receive game state updates from host\r\n    onMessage('game_state', (payload) => {\r\n        if (!mpGame.k) return; // Need kaplay instance\r\n\r\n        // Update all remote player positions\r\n        if (payload.players) {\r\n            payload.players.forEach(playerState => {\r\n                if (playerState.slotIndex !== mpGame.localPlayerSlot) {\r\n                    const player = mpGame.players.get(playerState.slotIndex);\r\n                    if (player && player.exists()) {\r\n                        // Store target position for smooth interpolation\r\n                        if (!player.netTarget) {\r\n                            player.netTarget = { x: playerState.x, y: playerState.y };\r\n                        } else {\r\n                            player.netTarget.x = playerState.x;\r\n                            player.netTarget.y = playerState.y;\r\n                        }\r\n                        player.angle = playerState.angle || 0;\r\n                        // Also rotate the outline\r\n                        if (player.outline && player.outline.exists()) {\r\n                            player.outline.angle = player.angle;\r\n                        }\r\n\r\n                        // Update health and maxHealth\r\n                        if (playerState.maxHealth !== undefined) {\r\n                            player.maxHealth = playerState.maxHealth;\r\n                        }\r\n                        if (playerState.hp !== undefined && player.setHP) {\r\n                            player.setHP(playerState.hp);\r\n                        }\r\n\r\n                        // Update invulnerability state\r\n                        if (playerState.invulnerable !== undefined) {\r\n                            player.invulnerable = playerState.invulnerable;\r\n                        }\r\n                        if (playerState.invulnerableTime !== undefined) {\r\n                            player.invulnerableTime = playerState.invulnerableTime;\r\n                        }\r\n\r\n                        // Update death state\r\n                        if (playerState.isDead !== undefined) {\r\n                            player.isDead = playerState.isDead;\r\n                            // Set state based on alive/dead\r\n                            if (player.isDead) {\r\n                                player.canShoot = false;\r\n                                player.canMove = false;\r\n                                player.isShooting = false;\r\n                                // Death visual state\r\n                                player.opacity = 0.5;\r\n                                if (player.outline && player.outline.exists()) {\r\n                                    player.outline.opacity = 0.5;\r\n                                }\r\n                            } else {\r\n                                // Re-enable for alive players\r\n                                player.canShoot = true;\r\n                                player.canMove = true;\r\n                                // Alive visual state\r\n                                player.opacity = 1;\r\n                                if (player.outline && player.outline.exists()) {\r\n                                    player.outline.opacity = 1;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        // Update weapon/upgrade state\r\n                        if (playerState.weapons) {\r\n                            player.weapons = playerState.weapons;\r\n                        }\r\n                        if (playerState.passiveUpgrades) {\r\n                            player.passiveUpgrades = playerState.passiveUpgrades;\r\n                        }\r\n                        if (playerState.upgradeStacks) {\r\n                            player.upgradeStacks = playerState.upgradeStacks;\r\n                        }\r\n\r\n                        // Update stats\r\n                        if (playerState.speed !== undefined) player.speed = playerState.speed;\r\n                        if (playerState.damage !== undefined) player.damage = playerState.damage;\r\n                        if (playerState.pickupRadius !== undefined) player.pickupRadius = playerState.pickupRadius;\r\n\r\n                        // Sync per-player run stats for game over screen\r\n                        if (playerState.runStats) {\r\n                            if (!player.runStats) {\r\n                                player.runStats = { kills: 0, creditsPickedUp: 0, bossesKilled: 0 };\r\n                            }\r\n                            player.runStats.kills = playerState.runStats.kills;\r\n                            player.runStats.creditsPickedUp = playerState.runStats.creditsPickedUp;\r\n                            player.runStats.bossesKilled = playerState.runStats.bossesKilled;\r\n                        }\r\n                    }\r\n                } else {\r\n                    // Update local player's HP from host (damage is host-authoritative)\r\n                    const localPlayer = mpGame.players.get(mpGame.localPlayerSlot);\r\n                    if (localPlayer && localPlayer.exists()) {\r\n                        // Sync HP (host is authoritative for damage)\r\n                        if (playerState.hp !== undefined && localPlayer.setHP) {\r\n                            localPlayer.setHP(playerState.hp);\r\n                        }\r\n                        if (playerState.maxHealth !== undefined) {\r\n                            localPlayer.maxHealth = playerState.maxHealth;\r\n                        }\r\n\r\n                        // Sync invulnerability state\r\n                        if (playerState.invulnerable !== undefined) {\r\n                            localPlayer.invulnerable = playerState.invulnerable;\r\n                        }\r\n                        if (playerState.invulnerableTime !== undefined) {\r\n                            localPlayer.invulnerableTime = playerState.invulnerableTime;\r\n                        }\r\n\r\n                        // Sync death state\r\n                        if (playerState.isDead !== undefined) {\r\n                            localPlayer.isDead = playerState.isDead;\r\n                            if (localPlayer.isDead) {\r\n                                localPlayer.canShoot = false;\r\n                                localPlayer.canMove = false;\r\n                                localPlayer.isShooting = false;\r\n                                // Death visual state\r\n                                localPlayer.opacity = 0.5;\r\n                                if (localPlayer.outline && localPlayer.outline.exists()) {\r\n                                    localPlayer.outline.opacity = 0.5;\r\n                                }\r\n                            } else {\r\n                                localPlayer.canShoot = true;\r\n                                localPlayer.canMove = true;\r\n                                // Alive visual state - restore full opacity\r\n                                localPlayer.opacity = 1;\r\n                                if (localPlayer.outline && localPlayer.outline.exists()) {\r\n                                    localPlayer.outline.opacity = 1;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        // Sync per-player run stats from host (host tracks all kills/credits)\r\n                        if (playerState.runStats) {\r\n                            if (!localPlayer.runStats) {\r\n                                localPlayer.runStats = { kills: 0, creditsPickedUp: 0, bossesKilled: 0 };\r\n                            }\r\n                            localPlayer.runStats.kills = playerState.runStats.kills;\r\n                            localPlayer.runStats.creditsPickedUp = playerState.runStats.creditsPickedUp;\r\n                            localPlayer.runStats.bossesKilled = playerState.runStats.bossesKilled;\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // Update enemies\r\n        if (payload.enemies) {\r\n            const receivedIds = new Set();\r\n\r\n            payload.enemies.forEach(enemyState => {\r\n                receivedIds.add(enemyState.id);\r\n\r\n                const existingEnemy = mpGame.enemies.get(enemyState.id);\r\n                if (existingEnemy && existingEnemy.exists()) {\r\n                    // Update existing enemy with interpolation for smooth movement\r\n                    // Store target position for interpolation\r\n                    if (!existingEnemy.netTarget) {\r\n                        existingEnemy.netTarget = { x: enemyState.x, y: enemyState.y };\r\n                    } else {\r\n                        existingEnemy.netTarget.x = enemyState.x;\r\n                        existingEnemy.netTarget.y = enemyState.y;\r\n                    }\r\n\r\n                    // Update health immediately (no interpolation for discrete values)\r\n                    if (enemyState.maxHealth !== undefined) {\r\n                        existingEnemy.maxHealth = enemyState.maxHealth;\r\n                    }\r\n                    if (existingEnemy.setHP && enemyState.hp !== undefined) {\r\n                        existingEnemy.setHP(enemyState.hp);\r\n                    }\r\n\r\n                    // Update shield and armor state for visual sync\r\n                    if (enemyState.shieldHealth !== undefined) {\r\n                        existingEnemy.shieldHealth = enemyState.shieldHealth;\r\n                    }\r\n                    if (enemyState.armorHealth !== undefined) {\r\n                        existingEnemy.armorHealth = enemyState.armorHealth;\r\n                    }\r\n                    // Update visual if shield/armor changed\r\n                    if (existingEnemy.updateVisual) {\r\n                        existingEnemy.updateVisual();\r\n                    }\r\n                } else {\r\n                    // TODO: Mid-game join limitation\r\n                    // Enemy doesn't exist on client yet. To fully recreate it, we'd need:\r\n                    // - Enemy type, difficulty level, modifiers\r\n                    // - Full creation parameters from createEnemy()\r\n                    //\r\n                    // Current behavior: Entities appear when they move into view or are destroyed\r\n                    // Future improvement: Send full entity creation data via 'spawn_entity' messages\r\n                    //\r\n                    // For now, clients joining mid-game will see entity positions update\r\n                    // but won't have visual representations until next spawn/despawn cycle\r\n                }\r\n            });\r\n\r\n            // Remove enemies that no longer exist on host\r\n            mpGame.enemies.forEach((enemy, id) => {\r\n                if (!receivedIds.has(id) && enemy.exists()) {\r\n                    // Clean up health bars before destroying\r\n                    if (enemy.cleanupHealthBars && typeof enemy.cleanupHealthBars === 'function') {\r\n                        enemy.cleanupHealthBars();\r\n                    }\r\n                    mpGame.k.destroy(enemy); // Use Kaplay's destroy method\r\n                    mpGame.enemies.delete(id);\r\n                }\r\n            });\r\n        }\r\n\r\n        // NOTE: Projectiles are no longer synced via game_state\r\n        // They are spawned via spawn_projectile messages and move autonomously\r\n        // This significantly reduces network bandwidth and improves performance\r\n\r\n        // Update pickups\r\n        if (payload.pickups) {\r\n            const receivedIds = new Set();\r\n\r\n            payload.pickups.forEach(pickupState => {\r\n                receivedIds.add(pickupState.id);\r\n\r\n                const existing = mpGame.pickups.get(pickupState.id);\r\n                if (existing && existing.exists()) {\r\n                    // Update position\r\n                    existing.pos.x = pickupState.x;\r\n                    existing.pos.y = pickupState.y;\r\n\r\n                    // Update magnetization state\r\n                    if (pickupState.magnetizing !== undefined) {\r\n                        existing.magnetizing = pickupState.magnetizing;\r\n\r\n                        // Set target player if specified\r\n                        if (pickupState.magnetizing && pickupState.targetPlayerSlot !== undefined) {\r\n                            const targetPlayer = mpGame.players.get(pickupState.targetPlayerSlot);\r\n                            if (targetPlayer && targetPlayer.exists()) {\r\n                                existing.targetPlayer = targetPlayer;\r\n                            } else {\r\n                                // Target player disconnected or invalid - stop magnetizing\r\n                                existing.magnetizing = false;\r\n                                existing.targetPlayer = null;\r\n                            }\r\n                        } else if (!pickupState.magnetizing) {\r\n                            // Stopped magnetizing - clear target\r\n                            existing.targetPlayer = null;\r\n                        }\r\n                    }\r\n\r\n                    // Update isFlyingToUI state\r\n                    if (pickupState.isFlyingToUI !== undefined) {\r\n                        existing.isFlyingToUI = pickupState.isFlyingToUI;\r\n                    }\r\n                }\r\n            });\r\n\r\n            // Remove collected pickups\r\n            mpGame.pickups.forEach((pickup, id) => {\r\n                if (!receivedIds.has(id) && pickup.exists()) {\r\n                    mpGame.k.destroy(pickup); // Use Kaplay's destroy method\r\n                    mpGame.pickups.delete(id);\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    // Handle entity spawn events\r\n    onMessage('spawn_entity', (payload) => {\r\n        if (!mpGame.k) return; // Need kaplay instance\r\n\r\n        // Host tells clients to spawn a new entity with full creation parameters\r\n        if (payload.entityType === 'enemy') {\r\n            let enemy;\r\n            if (payload.isBoss) {\r\n                // Create boss entity\r\n                enemy = createBoss(\r\n                    mpGame.k,\r\n                    payload.x,\r\n                    payload.y,\r\n                    payload.type,\r\n                    payload.floor\r\n                );\r\n            } else {\r\n                // Create regular enemy\r\n                enemy = createEnemy(\r\n                    mpGame.k,\r\n                    payload.x,\r\n                    payload.y,\r\n                    payload.type,\r\n                    payload.floor\r\n                );\r\n            }\r\n            enemy.mpEntityId = payload.id;\r\n            if (payload.isBossMinion) {\r\n                enemy.isBossMinion = true;\r\n            }\r\n            mpGame.enemies.set(payload.id, enemy);\r\n            // Removed console.log for performance\r\n        } else if (payload.entityType === 'xpPickup') {\r\n            const pickup = createXPPickup(\r\n                mpGame.k,\r\n                payload.x,\r\n                payload.y,\r\n                payload.value\r\n            );\r\n            pickup.mpEntityId = payload.id;\r\n            pickup.pickupType = 'xp';\r\n            mpGame.pickups.set(payload.id, pickup);\r\n            // Removed console.log for performance\r\n        } else if (payload.entityType === 'currencyPickup') {\r\n            const pickup = createCurrencyPickup(\r\n                mpGame.k,\r\n                payload.x,\r\n                payload.y,\r\n                payload.value,\r\n                payload.icon\r\n            );\r\n            pickup.mpEntityId = payload.id;\r\n            pickup.pickupType = 'currency';\r\n            mpGame.pickups.set(payload.id, pickup);\r\n            // Removed console.log for performance\r\n        }\r\n    });\r\n\r\n    // Handle projectile spawn events\r\n    onMessage('spawn_projectile', (payload) => {\r\n        if (!mpGame.k) return; // Need kaplay instance\r\n\r\n        // Reconstruct direction vector\r\n        const direction = mpGame.k.vec2(payload.directionX, payload.directionY);\r\n\r\n        // Create the projectile with all parameters\r\n        const projectile = createProjectile(\r\n            mpGame.k,\r\n            payload.x,\r\n            payload.y,\r\n            direction,\r\n            payload.speed,\r\n            payload.damage,\r\n            payload.piercing,\r\n            payload.obstaclePiercing,\r\n            payload.isCrit,\r\n            payload.maxRange\r\n        );\r\n\r\n        // Apply visual customization if provided\r\n        if (payload.char || payload.color) {\r\n            projectile.text = payload.char;\r\n            if (payload.color) {\r\n                projectile.color = mpGame.k.rgb(...payload.color);\r\n            }\r\n        }\r\n\r\n        // Assign network ID and track\r\n        projectile.mpEntityId = payload.id;\r\n        mpGame.projectiles.set(payload.id, projectile);\r\n    });\r\n\r\n    // Handle damage events\r\n    onMessage('damage_dealt', (payload) => {\r\n        if (!mpGame.k) return; // Need kaplay instance\r\n\r\n        // Show damage number at the hit location\r\n        const damageText = mpGame.k.add([\r\n            mpGame.k.text(payload.damage.toString(), {\r\n                size: payload.isCrit ? 24 : 18\r\n            }),\r\n            mpGame.k.pos(payload.x, payload.y),\r\n            mpGame.k.anchor('center'),\r\n            mpGame.k.color(payload.isCrit ? 255 : 255, payload.isCrit ? 200 : 255, payload.isCrit ? 0 : 255),\r\n            mpGame.k.opacity(1), // Required for lifespan component\r\n            mpGame.k.lifespan(0.8),\r\n            mpGame.k.z(1000)\r\n        ]);\r\n\r\n        // Animate damage number rising and fading\r\n        damageText.onUpdate(() => {\r\n            if (!damageText.exists()) return; // Prevent crash on scene exit\r\n            damageText.pos.y -= 50 * mpGame.k.dt();\r\n            damageText.opacity -= 1.25 * mpGame.k.dt();\r\n        });\r\n\r\n        // Flash the target entity if we have it (enemies only - players keyed by slotIndex)\r\n        const target = mpGame.enemies.get(payload.targetId);\r\n        if (target && target.exists()) {\r\n            const originalColor = target.color;\r\n            target.color = mpGame.k.rgb(255, 255, 255); // White flash\r\n            mpGame.k.wait(0.1, () => {\r\n                if (target.exists()) {\r\n                    target.color = originalColor;\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    // Handle entity death events\r\n    onMessage('entity_destroyed', (payload) => {\r\n        if (!mpGame.k) return; // Need kaplay instance\r\n\r\n        // Remove the entity from tracking and destroy it\r\n        // Check enemies and pickups only - players have separate death handling\r\n        // NOTE: Do NOT check mpGame.players here as it's keyed by slotIndex, not entityId\r\n        const entity = mpGame.enemies.get(payload.entityId) ||\r\n                      mpGame.pickups.get(payload.entityId);\r\n\r\n        if (entity && entity.exists()) {\r\n            // Clean up health bars before destroying entity\r\n            if (entity.cleanupHealthBars && typeof entity.cleanupHealthBars === 'function') {\r\n                entity.cleanupHealthBars();\r\n            }\r\n\r\n            // Don't trigger onDeath for network-destroyed entities\r\n            // The host already handled death effects (splitting, explosions, etc.)\r\n            // and will broadcast any spawned entities separately\r\n            // This prevents errors from death handlers trying to spawn entities on clients\r\n\r\n            // Destroy the entity\r\n            mpGame.k.destroy(entity);\r\n\r\n            // Remove from appropriate tracking map\r\n            if (payload.entityType === 'pickup' || payload.entityType === 'xpPickup' || payload.entityType === 'currencyPickup') {\r\n                mpGame.pickups.delete(payload.entityId);\r\n            }\r\n        }\r\n\r\n        // Clean up from tracking maps\r\n        mpGame.enemies.delete(payload.entityId);\r\n        mpGame.projectiles.delete(payload.entityId);\r\n        mpGame.pickups.delete(payload.entityId);\r\n\r\n        // Note: XP/currency drops are handled by spawn_entity events from host\r\n        // The host will spawn pickups and broadcast them separately\r\n    });\r\n\r\n    // Handle boss enrage events\r\n    onMessage('boss_enrage', (payload) => {\r\n        if (!mpGame.k) return;\r\n        const boss = mpGame.enemies.get(payload.networkId);\r\n        if (boss && boss.exists() && boss.enrage) {\r\n            boss.enrage();\r\n        }\r\n    });\r\n\r\n    // Handle player revival events\r\n    onMessage('players_revived', (payload) => {\r\n        if (!mpGame.k) return; // Need kaplay instance\r\n\r\n        // Get Second Wind level for revive health bonus\r\n        const secondWindLevel = getPermanentUpgradeLevel('secondWind');\r\n        const revivePercent = 0.05 + (secondWindLevel * 0.05);\r\n\r\n        // Revive all dead players\r\n        mpGame.players.forEach((player, slotIndex) => {\r\n            if (player && player.exists() && (player.hp() <= 0 || player.isDead)) {\r\n                // Revive player at 5% health + 5% per Second Wind level\r\n                const reviveHealth = Math.max(1, Math.floor(player.maxHealth * revivePercent));\r\n                player.setHP(reviveHealth);\r\n                player.isDead = false;\r\n\r\n                // Re-enable movement and shooting only for the local player\r\n                if (slotIndex === mpGame.localPlayerSlot) {\r\n                    player.canMove = true;\r\n                    player.canShoot = true;\r\n                }\r\n\r\n                // Show revival effect with HP percentage\r\n                const reviveHealthPercent = Math.round(revivePercent * 100);\r\n                const reviveEffect = mpGame.k.add([\r\n                    mpGame.k.text(` REVIVED (${reviveHealthPercent}% HP) `, { size: 16 }),\r\n                    mpGame.k.pos(player.pos.x, player.pos.y - 40),\r\n                    mpGame.k.anchor('center'),\r\n                    mpGame.k.color(100, 255, 100),\r\n                    mpGame.k.opacity(1), // Required for lifespan component\r\n                    mpGame.k.lifespan(2),\r\n                    mpGame.k.z(1000)\r\n                ]);\r\n\r\n                // Animate rising and fading\r\n                reviveEffect.onUpdate(() => {\r\n                    if (!reviveEffect.exists()) return; // Prevent crash on scene exit\r\n                    reviveEffect.pos.y -= 30 * mpGame.k.dt();\r\n                    reviveEffect.opacity -= 0.5 * mpGame.k.dt();\r\n                });\r\n\r\n                // Restore visual state\r\n                player.opacity = 1;\r\n                if (player.characterData) {\r\n                    player.color = mpGame.k.rgb(...player.characterData.color);\r\n                }\r\n                if (player.outline && player.outline.exists()) {\r\n                    player.outline.opacity = 1;\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    // Handle game seed broadcast from host\r\n    onMessage('game_seed', (payload) => {\r\n        // Initialize RNG with seed from host\r\n        mpGame.gameSeed = payload.seed;\r\n        mpGame.floorRng = new SeededRandom(mpGame.gameSeed);\r\n\r\n        // Store first room template key for use when room loads\r\n        if (payload.roomTemplateKey) {\r\n            mpGame.firstRoomTemplateKey = payload.roomTemplateKey;\r\n            console.log('[Multiplayer] Client received first room template:', payload.roomTemplateKey);\r\n        }\r\n\r\n        // Call callback to regenerate floor map with correct seed\r\n        if (mpGame.onGameSeedCallback) {\r\n            mpGame.onGameSeedCallback();\r\n            mpGame.onGameSeedCallback = null;\r\n        }\r\n    });\r\n\r\n    // Receive pause state updates from host\r\n    onMessage('pause_state', (payload) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received pause state from host:', payload.paused);\r\n\r\n        // Apply pause state locally\r\n        if (mpGame.k) {\r\n            mpGame.k.paused = payload.paused;\r\n\r\n            // Update pause UI if callback is registered\r\n            if (mpGame.k.gameData && mpGame.k.gameData.updatePauseUI) {\r\n                mpGame.k.gameData.updatePauseUI(payload.paused);\r\n            }\r\n\r\n            if (MP_DEBUG) console.log('[Multiplayer] Client set pause state to:', payload.paused);\r\n        }\r\n    });\r\n\r\n    // Receive XP gain from host\r\n    onMessage('xp_gain', (payload) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received XP gain from host:', payload.value);\r\n\r\n        // Give XP to local player\r\n        const localPlayer = mpGame.players.get(mpGame.localPlayerSlot);\r\n        if (localPlayer && localPlayer.exists() && !localPlayer.isDead && localPlayer.addXP) {\r\n            localPlayer.addXP(payload.value);\r\n        } else {\r\n            // Player doesn't exist (in upgrade draft screen) - accumulate pending XP\r\n            mpGame.pendingXP += payload.value;\r\n            if (MP_DEBUG) console.log('[Multiplayer] Accumulated pending XP:', mpGame.pendingXP);\r\n        }\r\n    });\r\n\r\n    // Receive currency gain from host\r\n    onMessage('currency_gain', (payload) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received currency gain from host:', payload.value);\r\n        addCurrency(payload.value);\r\n    });\r\n\r\n    // Receive enemy split events from host\r\n    onMessage('enemy_split', (payload) => {\r\n\r\n        // Update split enemy counter\r\n        if (mpGame.k && mpGame.k.gameData && mpGame.k.gameData.incrementSplitEnemies) {\r\n            mpGame.k.gameData.incrementSplitEnemies(payload.count);\r\n        }\r\n    });\r\n\r\n    // Receive player death events from host\r\n    onMessage('player_death', (payload) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Received player death event for slot:', payload.slotIndex);\r\n\r\n        // Mark player as dead immediately\r\n        const player = mpGame.players.get(payload.slotIndex);\r\n        if (player && player.exists()) {\r\n            player.isDead = true;\r\n            player.canMove = false;\r\n            player.canShoot = false;\r\n            player.isShooting = false;\r\n\r\n            // Visual indication of death\r\n            player.opacity = 0.5;\r\n            if (player.outline && player.outline.exists()) {\r\n                player.outline.opacity = 0.5;\r\n            }\r\n\r\n            if (MP_DEBUG) console.log('[Multiplayer] Marked player at slot', payload.slotIndex, 'as dead');\r\n        }\r\n    });\r\n\r\n    // Receive player disconnect events from host\r\n    onMessage('player_disconnected', (payload) => {\r\n        // Clean up the disconnected player's entity on this client\r\n        const player = mpGame.players.get(payload.slotIndex);\r\n        if (player && player.exists()) {\r\n            // Clear pending level-ups\r\n            if (player.pendingLevelUps) {\r\n                player.pendingLevelUps = [];\r\n            }\r\n\r\n            // Clean up health bars before destroying\r\n            if (player.cleanupHealthBars && typeof player.cleanupHealthBars === 'function') {\r\n                player.cleanupHealthBars();\r\n            }\r\n\r\n            // Destroy player entity\r\n            mpGame.k.destroy(player);\r\n\r\n            // Remove from tracking\r\n            mpGame.players.delete(payload.slotIndex);\r\n        }\r\n    });\r\n\r\n    // Receive host quit event - return to menu\r\n    onMessage('host_quit', (payload) => {\r\n        if (MP_DEBUG) console.log('[Multiplayer] Host quit to menu, returning to menu');\r\n\r\n        // Cleanup multiplayer state\r\n        cleanupMultiplayer();\r\n\r\n        // Reset game state and return to menu\r\n        if (mpGame.k) {\r\n            mpGame.k.go('menu');\r\n        }\r\n    });\r\n\r\n    // Receive achievement unlock notification from other players\r\n    onMessage('achievement_unlocked', (payload) => {\r\n        // Only show toast if it's not from the local player\r\n        if (payload.playerSlotIndex !== mpGame.localPlayerSlot) {\r\n            if (MP_DEBUG) console.log('[Multiplayer] Achievement unlocked by player:', payload.playerName, 'achievement:', payload.achievementId);\r\n\r\n            const achievement = ACHIEVEMENTS[payload.achievementId];\r\n            if (achievement && mpGame.k) {\r\n                // Make sure toast system is initialized\r\n                initToastSystem(mpGame.k);\r\n                showMultiplayerAchievementToast(payload.playerName, achievement);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Register a player entity for multiplayer\r\n * @param {number} slotIndex - Party slot index (0-3)\r\n * @param {Object} playerEntity - Kaplay player entity\r\n */\r\nexport function registerPlayer(slotIndex, playerEntity) {\r\n    mpGame.players.set(slotIndex, playerEntity);\r\n    playerEntity.mpSlotIndex = slotIndex; // Store slot index on entity\r\n}\r\n\r\n/**\r\n * Handle player disconnect (cleanup entity and state)\r\n * @param {number} slotIndex - Party slot index (0-3)\r\n */\r\nexport function handlePlayerDisconnect(slotIndex) {\r\n    const player = mpGame.players.get(slotIndex);\r\n    if (player && player.exists()) {\r\n\r\n        // Clear pending level-ups\r\n        if (player.pendingLevelUps) {\r\n            player.pendingLevelUps = [];\r\n        }\r\n\r\n        // Clean up health bars before destroying\r\n        if (player.cleanupHealthBars && typeof player.cleanupHealthBars === 'function') {\r\n            player.cleanupHealthBars();\r\n        }\r\n\r\n        // Destroy player entity\r\n        if (mpGame.k) {\r\n            mpGame.k.destroy(player);\r\n        }\r\n\r\n        // Remove from tracking\r\n        mpGame.players.delete(slotIndex);\r\n\r\n        // Broadcast disconnect to other clients (host only)\r\n        if (mpGame.isHost) {\r\n            broadcastPlayerDisconnect(slotIndex);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Broadcast player disconnect event to all clients\r\n * @param {number} slotIndex - Slot index of disconnected player\r\n */\r\nexport function broadcastPlayerDisconnect(slotIndex) {\r\n    if (!mpGame.isHost) return;\r\n\r\n    broadcast('player_disconnected', { slotIndex });\r\n}\r\n\r\n/**\r\n * Update multiplayer state - call this every frame\r\n * @param {number} dt - Delta time\r\n */\r\nexport function updateMultiplayer(dt) {\r\n    if (!mpGame.isActive) return;\r\n\r\n    mpGame.lastSyncTime += dt;\r\n    mpGame.lastResyncTime += dt;\r\n\r\n    if (mpGame.isHost) {\r\n        // Host: broadcast game state periodically\r\n        if (mpGame.lastSyncTime >= mpGame.syncInterval) {\r\n            broadcastGameState();\r\n            mpGame.lastSyncTime = 0;\r\n        }\r\n\r\n        // Host: periodic desync check (verify critical state)\r\n        if (mpGame.lastResyncTime >= mpGame.resyncInterval) {\r\n            // Check if any players have inconsistent state\r\n            mpGame.players.forEach((player, slotIndex) => {\r\n                if (player && player.exists()) {\r\n                    // Check for critical desyncs (e.g., dead but still has HP)\r\n                    if (player.isDead && player.hp() > 0) {\r\n                        console.warn('[Multiplayer] Desync detected: Player', slotIndex, 'is marked dead but has HP. Correcting...');\r\n                        player.setHP(0);\r\n                    }\r\n                    if (!player.isDead && player.hp() <= 0) {\r\n                        console.warn('[Multiplayer] Desync detected: Player', slotIndex, 'has no HP but not marked dead. Correcting...');\r\n                        player.isDead = true;\r\n                        player.canMove = false;\r\n                        player.canShoot = false;\r\n                    }\r\n                }\r\n            });\r\n            mpGame.lastResyncTime = 0;\r\n        }\r\n    } else {\r\n        // Client: send input state periodically\r\n        if (mpGame.lastSyncTime >= mpGame.syncInterval) {\r\n            sendInputState();\r\n            mpGame.lastSyncTime = 0;\r\n        }\r\n\r\n        // Client: periodic desync check and auto-resync request\r\n        if (mpGame.lastResyncTime >= mpGame.resyncInterval) {\r\n            // Check for desyncs on client\r\n            let desyncDetected = false;\r\n\r\n            mpGame.players.forEach((player, slotIndex) => {\r\n                if (player && player.exists()) {\r\n                    // Check for critical desyncs\r\n                    if (player.isDead && player.hp() > 0) {\r\n                        console.warn('[Multiplayer] Client desync: Player', slotIndex, 'is dead but has HP');\r\n                        desyncDetected = true;\r\n                    }\r\n                    if (!player.isDead && player.hp() <= 0) {\r\n                        console.warn('[Multiplayer] Client desync: Player', slotIndex, 'has no HP but not dead');\r\n                        desyncDetected = true;\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (desyncDetected) {\r\n                requestResync();\r\n            }\r\n\r\n            mpGame.lastResyncTime = 0;\r\n        }\r\n\r\n        // Client: interpolate entity positions for smooth movement\r\n        const lerpFactor = Math.min(dt * 10, 1); // Lerp 10x per second, cap at 1\r\n\r\n        // Interpolate remote players\r\n        mpGame.players.forEach(player => {\r\n            if (player.exists() && player.isRemote && player.netTarget) {\r\n                player.pos.x += (player.netTarget.x - player.pos.x) * lerpFactor;\r\n                player.pos.y += (player.netTarget.y - player.pos.y) * lerpFactor;\r\n            }\r\n        });\r\n\r\n        // Interpolate enemies\r\n        mpGame.enemies.forEach(enemy => {\r\n            if (enemy.exists() && enemy.netTarget) {\r\n                enemy.pos.x += (enemy.netTarget.x - enemy.pos.x) * lerpFactor;\r\n                enemy.pos.y += (enemy.netTarget.y - enemy.pos.y) * lerpFactor;\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Collect current game state (helper function)\r\n * @returns {Object} Game state object\r\n */\r\nfunction collectGameState() {\r\n    const playerStates = [];\r\n    const enemyStates = [];\r\n    const projectileStates = [];\r\n    const pickupStates = [];\r\n\r\n    // Collect player states\r\n    mpGame.players.forEach((player, slotIndex) => {\r\n        if (player.exists()) {\r\n            // Ensure weapons and upgrades are serializable using JSON round-trip to strip functions\r\n            let weaponsArray = [];\r\n            let upgradesArray = [];\r\n            let stacksObj = {};\r\n\r\n            try {\r\n                // Deep clone to remove functions and non-serializable data\r\n                if (player.weapons) {\r\n                    weaponsArray = JSON.parse(JSON.stringify(player.weapons));\r\n                }\r\n                if (player.passiveUpgrades) {\r\n                    upgradesArray = JSON.parse(JSON.stringify(player.passiveUpgrades));\r\n                }\r\n                if (player.upgradeStacks) {\r\n                    stacksObj = JSON.parse(JSON.stringify(player.upgradeStacks));\r\n                }\r\n            } catch (e) {\r\n                console.warn('Failed to serialize player upgrades:', e);\r\n                // Fallback to empty arrays/objects\r\n            }\r\n\r\n            // Get current HP safely - if player has hp() method, use it, otherwise use maxHealth\r\n            let currentHP = player.maxHealth;\r\n            if (player.hp && typeof player.hp === 'function') {\r\n                currentHP = player.hp();\r\n            } else if (typeof player.hp === 'number') {\r\n                currentHP = player.hp;\r\n            }\r\n\r\n            playerStates.push({\r\n                slotIndex: Number(slotIndex),\r\n                x: Number(player.pos.x),\r\n                y: Number(player.pos.y),\r\n                angle: Number(player.angle || 0),\r\n                hp: Number(currentHP),\r\n                maxHealth: Number(player.maxHealth || 100),\r\n                level: Number(player.level || 1),\r\n                xp: Number(player.xp || 0),\r\n                isDead: Boolean(player.isDead || false), // Track death state\r\n                // Weapon and upgrade state (ensure plain data)\r\n                weapons: weaponsArray,\r\n                passiveUpgrades: upgradesArray,\r\n                upgradeStacks: stacksObj,\r\n                // Stats that affect gameplay\r\n                speed: Number(player.speed || 0),\r\n                damage: Number(player.damage || 0),\r\n                pickupRadius: Number(player.pickupRadius || 0),\r\n                // Visual state for color sync\r\n                invulnerable: Boolean(player.invulnerable || false),\r\n                invulnerableTime: Number(player.invulnerableTime || 0),\r\n                // Per-player run stats for game over screen\r\n                runStats: player.runStats ? {\r\n                    kills: Number(player.runStats.kills || 0),\r\n                    creditsPickedUp: Number(player.runStats.creditsPickedUp || 0),\r\n                    bossesKilled: Number(player.runStats.bossesKilled || 0)\r\n                } : null\r\n            });\r\n        }\r\n    });\r\n\r\n    // Collect enemy states\r\n    mpGame.enemies.forEach((enemy, entityId) => {\r\n        if (enemy.exists()) {\r\n            // Get current HP safely\r\n            let currentHP = 0;\r\n            if (enemy.hp && typeof enemy.hp === 'function') {\r\n                currentHP = enemy.hp();\r\n            } else if (typeof enemy.hp === 'number') {\r\n                currentHP = enemy.hp;\r\n            }\r\n\r\n            enemyStates.push({\r\n                id: Number(entityId),\r\n                x: Number(enemy.pos.x),\r\n                y: Number(enemy.pos.y),\r\n                hp: Number(currentHP),\r\n                maxHealth: Number(enemy.maxHealth || 0),\r\n                type: String(enemy.enemyType || 'basic'),\r\n                // Shield and armor state for visual sync\r\n                shieldHealth: Number(enemy.shieldHealth || 0),\r\n                armorHealth: Number(enemy.armorHealth || 0)\r\n            });\r\n        } else {\r\n            // Enemy destroyed - remove from tracking\r\n            mpGame.enemies.delete(entityId);\r\n        }\r\n    });\r\n\r\n    // NOTE: Projectiles are NOT synced via game_state anymore\r\n    // They are spawned via spawn_projectile messages and then move autonomously\r\n    // This significantly reduces network traffic (projectiles change every frame)\r\n    // Just clean up destroyed projectiles from tracking\r\n    mpGame.projectiles.forEach((projectile, entityId) => {\r\n        if (!projectile.exists()) {\r\n            mpGame.projectiles.delete(entityId);\r\n        }\r\n    });\r\n\r\n    // Collect pickup states\r\n    mpGame.pickups.forEach((pickup, entityId) => {\r\n        if (pickup.exists()) {\r\n            const pickupState = {\r\n                id: Number(entityId),\r\n                x: Number(pickup.pos.x),\r\n                y: Number(pickup.pos.y),\r\n                type: String(pickup.pickupType || 'xp'),\r\n                magnetizing: Boolean(pickup.magnetizing || false),\r\n                isFlyingToUI: Boolean(pickup.isFlyingToUI || false)\r\n            };\r\n\r\n            // Include target player slot if magnetizing\r\n            if (pickup.magnetizing && pickup.targetPlayer && pickup.targetPlayer.slotIndex !== undefined) {\r\n                pickupState.targetPlayerSlot = Number(pickup.targetPlayer.slotIndex);\r\n            }\r\n\r\n            pickupStates.push(pickupState);\r\n        } else {\r\n            // Pickup collected - remove from tracking\r\n            mpGame.pickups.delete(entityId);\r\n        }\r\n    });\r\n\r\n    return {\r\n        players: playerStates,\r\n        enemies: enemyStates,\r\n        projectiles: projectileStates,\r\n        pickups: pickupStates\r\n    };\r\n}\r\n\r\n/**\r\n * Broadcast current game state to all clients (host only)\r\n */\r\nfunction broadcastGameState() {\r\n    if (!mpGame.isHost) return;\r\n    broadcast('game_state', collectGameState());\r\n}\r\n\r\n/**\r\n * Send initial game state to a specific peer (host only)\r\n * Called when a new client joins mid-game\r\n * @param {string} peerId - Peer ID to send state to\r\n */\r\nexport function sendInitialGameState(peerId) {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    console.log('Sending initial game state to new joiner:', peerId);\r\n    sendToPeer(peerId, 'game_state', collectGameState());\r\n\r\n    // Also send all existing entities for mid-game join\r\n    sendAllExistingEntities(peerId);\r\n}\r\n\r\n/**\r\n * Send all existing entities to a newly joined peer (host only)\r\n * This ensures mid-game joiners see all enemies and pickups\r\n * @param {string} peerId - Peer ID to send entities to\r\n */\r\nexport function sendAllExistingEntities(peerId) {\r\n    if (!mpGame.isHost || !mpGame.isActive || !mpGame.k) return;\r\n\r\n    const k = mpGame.k;\r\n    console.log('[Multiplayer] Sending existing entities to new joiner:', peerId);\r\n\r\n    // Send all enemies\r\n    mpGame.enemies.forEach((enemy, entityId) => {\r\n        if (enemy && enemy.exists()) {\r\n            const entityData = {\r\n                entityId: entityId,\r\n                entityType: 'enemy',\r\n                x: enemy.pos.x,\r\n                y: enemy.pos.y,\r\n                enemyType: enemy.type || 'basic',\r\n                floor: enemy.floor || 1,\r\n                isBoss: enemy.is('boss') || false,\r\n                isMiniboss: enemy.is('miniboss') || false,\r\n                health: enemy.hp(),\r\n                maxHealth: enemy.maxHealth,\r\n                armorHealth: enemy.armorHealth || 0,\r\n                shieldHealth: enemy.shieldHealth || 0\r\n            };\r\n            sendToPeer(peerId, 'spawn_entity', entityData);\r\n        }\r\n    });\r\n\r\n    // Send all pickups\r\n    mpGame.pickups.forEach((pickup, entityId) => {\r\n        if (pickup && pickup.exists()) {\r\n            const entityData = {\r\n                entityId: entityId,\r\n                entityType: 'pickup',\r\n                x: pickup.pos.x,\r\n                y: pickup.pos.y,\r\n                pickupType: pickup.pickupType || (pickup.is('xpPickup') ? 'xp' : pickup.is('currencyPickup') ? 'currency' : 'powerup'),\r\n                xpValue: pickup.xpValue || 0,\r\n                currencyValue: pickup.currencyValue || 0\r\n            };\r\n            sendToPeer(peerId, 'spawn_entity', entityData);\r\n        }\r\n    });\r\n\r\n    console.log('[Multiplayer] Sent', mpGame.enemies.size, 'enemies and', mpGame.pickups.size, 'pickups to new joiner');\r\n}\r\n\r\n/**\r\n * Send local player input to host (client only)\r\n */\r\nfunction sendInputState() {\r\n    if (mpGame.isHost) return;\r\n\r\n    const localPlayer = mpGame.players.get(mpGame.localPlayerSlot);\r\n    if (!localPlayer || !localPlayer.exists()) return;\r\n\r\n    // Extract move as plain object (Vec2 has functions that can't be serialized)\r\n    // Read from moveDir (local keyboard input) not move (remote network input)\r\n    const move = localPlayer.moveDir\r\n        ? { x: Number(localPlayer.moveDir.x || 0), y: Number(localPlayer.moveDir.y || 0) }\r\n        : { x: 0, y: 0 };\r\n\r\n    sendToHost('player_input', {\r\n        slotIndex: Number(mpGame.localPlayerSlot),\r\n        move: move,\r\n        shoot: Boolean(localPlayer.isShooting || false),\r\n        aimAngle: Number(localPlayer.aimAngle || 0)\r\n    });\r\n}\r\n\r\n/**\r\n * Get local player entity\r\n * @returns {Object|null} Local player entity\r\n */\r\nexport function getLocalPlayerEntity() {\r\n    return mpGame.players.get(mpGame.localPlayerSlot);\r\n}\r\n\r\n/**\r\n * Check if multiplayer is active\r\n * @returns {boolean}\r\n */\r\nexport function isMultiplayerActive() {\r\n    return mpGame.isActive;\r\n}\r\n\r\n/**\r\n * Get multiplayer player count\r\n * @returns {number}\r\n */\r\nexport function getPlayerCount() {\r\n    return mpGame.players.size;\r\n}\r\n\r\n/**\r\n * Cleanup multiplayer session\r\n */\r\nexport function cleanupMultiplayer() {\r\n    mpGame.isActive = false;\r\n    mpGame.players.clear();\r\n    mpGame.inputBuffer = [];\r\n\r\n    // Clear entity tracking to prevent memory leaks\r\n    mpGame.enemies.clear();\r\n    mpGame.projectiles.clear();\r\n    mpGame.pickups.clear();\r\n\r\n    // Reset entity ID counter\r\n    mpGame.nextEntityId = 1;\r\n\r\n    // Actually remove message handlers to prevent memory leaks\r\n    // Host handlers\r\n    offMessage('player_input');\r\n    offMessage('pause_request');\r\n    offMessage('player_death');\r\n    offMessage('enemy_death');\r\n    offMessage('resync_request');\r\n    offMessage('level_up_queued');\r\n    offMessage('player_emote');\r\n    offMessage('upgrade_selected');\r\n    offMessage('synergy_activated');\r\n    offMessage('achievement_unlocked');\r\n\r\n    // Client handlers\r\n    offMessage('game_state');\r\n    offMessage('spawn_entity');\r\n    offMessage('spawn_projectile');\r\n    offMessage('damage_dealt');\r\n    offMessage('entity_destroyed');\r\n    offMessage('boss_enrage');\r\n    offMessage('players_revived');\r\n    offMessage('game_seed');\r\n    offMessage('pause_state');\r\n    offMessage('xp_gain');\r\n    offMessage('currency_gain');\r\n    offMessage('enemy_split');\r\n    offMessage('player_disconnected');\r\n    offMessage('host_quit');\r\n\r\n    // Clear party callbacks to prevent memory leaks\r\n    clearPartyCallbacks();\r\n\r\n    // Reset handler registration flags (allows re-registration on reconnect)\r\n    multiplayerClientHandlersRegistered = false;\r\n    multiplayerHostHandlersRegistered = false;\r\n}\r\n\r\n/**\r\n * Check if this is the local player\r\n * @param {Object} player - Player entity to check\r\n * @returns {boolean}\r\n */\r\nexport function isLocalPlayer(player) {\r\n    return player.mpSlotIndex === mpGame.localPlayerSlot;\r\n}\r\n\r\n/**\r\n * Register an enemy for multiplayer sync (host only)\r\n * @param {Object} enemy - Enemy entity\r\n * @param {Object} creationParams - Parameters used to create this enemy { type, floor }\r\n * @returns {number} Entity ID assigned to this enemy\r\n */\r\nexport function registerEnemy(enemy, creationParams = {}) {\r\n    if (!mpGame.isHost) return null;\r\n\r\n    const entityId = mpGame.nextEntityId++;\r\n    enemy.mpEntityId = entityId;\r\n    mpGame.enemies.set(entityId, enemy);\r\n\r\n    // Broadcast spawn message to all clients with full creation parameters\r\n    broadcast('spawn_entity', {\r\n        id: entityId,\r\n        entityType: 'enemy',\r\n        x: enemy.pos.x,\r\n        y: enemy.pos.y,\r\n        type: creationParams.type || 'basic',\r\n        floor: creationParams.floor || 1,\r\n        isBoss: creationParams.isBoss || false,\r\n        isBossMinion: creationParams.isBossMinion || false\r\n    });\r\n\r\n    return entityId;\r\n}\r\n\r\n/**\r\n * Register a projectile for multiplayer sync (host only)\r\n * @param {Object} projectile - Projectile entity\r\n * @param {Object} creationParams - Parameters used to create this projectile\r\n * @returns {number} Entity ID assigned to this projectile\r\n */\r\nexport function registerProjectile(projectile, creationParams = {}) {\r\n    if (!mpGame.isHost) return null;\r\n\r\n    const entityId = mpGame.nextEntityId++;\r\n    projectile.mpEntityId = entityId;\r\n    mpGame.projectiles.set(entityId, projectile);\r\n\r\n    // Extract color from projectile entity\r\n    let colorArray = [255, 255, 100]; // Default yellow\r\n    if (projectile.color && projectile.color.r !== undefined) {\r\n        colorArray = [\r\n            Math.round(projectile.color.r),\r\n            Math.round(projectile.color.g),\r\n            Math.round(projectile.color.b)\r\n        ];\r\n    }\r\n\r\n    // Broadcast projectile spawn to all clients\r\n    broadcast('spawn_projectile', {\r\n        id: Number(entityId),\r\n        x: Number(projectile.pos.x),\r\n        y: Number(projectile.pos.y),\r\n        directionX: Number(projectile.direction.x),\r\n        directionY: Number(projectile.direction.y),\r\n        speed: Number(projectile.speed),\r\n        damage: Number(projectile.damage),\r\n        piercing: Number(projectile.piercing || 0),\r\n        obstaclePiercing: Number(projectile.obstaclePiercing || 0),\r\n        isCrit: Boolean(projectile.isCrit),\r\n        maxRange: Number(projectile.maxRange),\r\n        angle: Number(projectile.angle || 0),\r\n        // Visual properties from projectile entity\r\n        char: projectile.text || creationParams.char || '*',\r\n        color: colorArray\r\n    });\r\n\r\n    return entityId;\r\n}\r\n\r\n/**\r\n * Unregister a projectile from multiplayer tracking (client and host)\r\n * Called when a projectile is destroyed to prevent memory leaks\r\n * @param {Object} projectile - Projectile entity to unregister\r\n */\r\nexport function unregisterProjectile(projectile) {\r\n    if (!mpGame.isActive) return;\r\n\r\n    // Remove from tracking map using the entity's network ID\r\n    if (projectile.mpEntityId !== undefined) {\r\n        mpGame.projectiles.delete(projectile.mpEntityId);\r\n    }\r\n}\r\n\r\n/**\r\n * Register a pickup for multiplayer sync (host only)\r\n * @param {Object} pickup - Pickup entity\r\n * @param {Object} creationParams - Parameters used to create this pickup { type, value, icon }\r\n * @returns {number} Entity ID assigned to this pickup\r\n */\r\nexport function registerPickup(pickup, creationParams = {}) {\r\n    if (!mpGame.isHost) return null;\r\n\r\n    const entityId = mpGame.nextEntityId++;\r\n    pickup.mpEntityId = entityId;\r\n    mpGame.pickups.set(entityId, pickup);\r\n\r\n    // Broadcast spawn message to all clients with full creation parameters\r\n    const spawnData = {\r\n        id: entityId,\r\n        entityType: creationParams.type || 'xpPickup',\r\n        x: pickup.pos.x,\r\n        y: pickup.pos.y,\r\n        value: creationParams.value || pickup.value || 1\r\n    };\r\n\r\n    // Add icon for currency pickups\r\n    if (creationParams.type === 'currencyPickup' && creationParams.icon) {\r\n        spawnData.icon = creationParams.icon;\r\n    }\r\n\r\n    broadcast('spawn_entity', spawnData);\r\n\r\n    return entityId;\r\n}\r\n\r\n/**\r\n * Unregister a pickup from multiplayer tracking (client and host)\r\n * Called when a pickup is destroyed to prevent memory leaks\r\n * @param {Object} pickup - Pickup entity to unregister\r\n */\r\nexport function unregisterPickup(pickup) {\r\n    if (!mpGame.isActive) return;\r\n\r\n    // Remove from tracking map using the entity's network ID\r\n    if (pickup.mpEntityId !== undefined) {\r\n        mpGame.pickups.delete(pickup.mpEntityId);\r\n    }\r\n}\r\n\r\n/**\r\n * Check if we're the host\r\n * @returns {boolean}\r\n */\r\nexport function isHost() {\r\n    return mpGame.isHost;\r\n}\r\n\r\n/**\r\n * Broadcast a damage event to all clients (host only)\r\n * @param {Object} params - Damage event parameters\r\n * @param {string|number} params.targetId - Target entity ID\r\n * @param {string} params.targetType - Type of target ('enemy', 'player', 'boss', 'miniboss')\r\n * @param {number} params.damage - Damage amount\r\n * @param {boolean} params.isCrit - Whether this was a critical hit\r\n * @param {number} params.attackerId - Attacker player slot index (optional)\r\n * @param {number} params.x - X position for visual effects\r\n * @param {number} params.y - Y position for visual effects\r\n */\r\nexport function broadcastDamageEvent(params) {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('damage_dealt', {\r\n        targetId: Number(params.targetId),\r\n        targetType: String(params.targetType),\r\n        damage: Number(params.damage),\r\n        isCrit: Boolean(params.isCrit || false),\r\n        attackerId: params.attackerId !== undefined ? Number(params.attackerId) : null,\r\n        x: Number(params.x),\r\n        y: Number(params.y)\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast a heal event to all clients (host only)\r\n * @param {Object} params - Heal event parameters\r\n * @param {number} params.slotIndex - Player slot index\r\n * @param {number} params.healAmount - Amount healed\r\n * @param {number} params.newHP - New HP value\r\n * @param {string} params.source - Source of healing ('lifesteal', 'regen', 'vampiric', 'pickup')\r\n */\r\nexport function broadcastHealEvent(params) {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('player_healed', {\r\n        slotIndex: Number(params.slotIndex),\r\n        healAmount: Number(params.healAmount),\r\n        newHP: Number(params.newHP),\r\n        source: String(params.source || 'unknown')\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast a dodge event to all clients (host only)\r\n * @param {Object} params - Dodge event parameters\r\n * @param {number} params.slotIndex - Player slot index\r\n * @param {number} params.x - X position for visual\r\n * @param {number} params.y - Y position for visual\r\n */\r\nexport function broadcastDodgeEvent(params) {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('player_dodged', {\r\n        slotIndex: Number(params.slotIndex),\r\n        x: Number(params.x),\r\n        y: Number(params.y)\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast an entity death event to all clients (host only)\r\n * @param {Object} params - Death event parameters\r\n * @param {string|number} params.entityId - Entity ID that died\r\n * @param {string} params.entityType - Type of entity ('enemy', 'player', 'boss', 'miniboss')\r\n * @param {number} params.x - X position\r\n * @param {number} params.y - Y position\r\n * @param {number} params.xpDropped - Amount of XP dropped (optional)\r\n * @param {number} params.currencyDropped - Amount of currency dropped (optional)\r\n */\r\nexport function broadcastDeathEvent(params) {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('entity_destroyed', {\r\n        entityId: Number(params.entityId),\r\n        entityType: String(params.entityType),\r\n        x: Number(params.x),\r\n        y: Number(params.y),\r\n        xpDropped: params.xpDropped !== undefined ? Number(params.xpDropped) : 0,\r\n        currencyDropped: params.currencyDropped !== undefined ? Number(params.currencyDropped) : 0\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast a boss enrage event to all clients (host only)\r\n * @param {string|number} bossNetworkId - The network ID of the boss that is enraged\r\n */\r\nexport function broadcastBossEnrage(bossNetworkId) {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('boss_enrage', {\r\n        networkId: bossNetworkId,\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast a player revival event to all clients (host only)\r\n * Called when a level up triggers revival of all dead players\r\n */\r\nexport function broadcastRevivalEvent() {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('players_revived', {\r\n        timestamp: Date.now()\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast game over event to all clients (host only)\r\n * Called when all players are dead\r\n * @param {Object} runStats - Run statistics\r\n * @param {number} currencyEarned - Currency earned this run\r\n * @param {Array} partyStats - Party statistics for game over screen\r\n */\r\nexport function broadcastGameOver(runStats, currencyEarned, partyStats = []) {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('game_over', {\r\n        runStats: runStats,\r\n        currencyEarned: currencyEarned,\r\n        partyStats: partyStats,\r\n        timestamp: Date.now()\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast host quit to menu to all clients (host only)\r\n * All clients should return to menu when host quits\r\n */\r\nexport function broadcastHostQuit() {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('host_quit', {\r\n        timestamp: Date.now()\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast powerup weapon application to all clients (host only)\r\n * Called when a powerup weapon is picked up\r\n * @param {string} powerupKey - Powerup weapon key\r\n */\r\nexport function broadcastPowerupWeaponApplied(powerupKey) {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('powerup_weapon_applied', {\r\n        powerupKey: powerupKey,\r\n        timestamp: Date.now()\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast upgrade selection (both host and client)\r\n * Called when a player selects an upgrade\r\n * @param {number} slotIndex - Player slot index\r\n * @param {string} upgradeKey - Selected upgrade key\r\n */\r\nexport function broadcastUpgradeSelected(slotIndex, upgradeKey) {\r\n    if (!mpGame.isActive) return;\r\n\r\n    if (mpGame.isHost) {\r\n        broadcast('upgrade_selected', {\r\n            slotIndex: slotIndex,\r\n            upgradeKey: upgradeKey,\r\n            timestamp: Date.now()\r\n        });\r\n    } else {\r\n        sendToHost('upgrade_selected', {\r\n            slotIndex: slotIndex,\r\n            upgradeKey: upgradeKey\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Broadcast level up queued event (both host and client)\r\n * Called when a player levels up during combat\r\n * @param {number} slotIndex - Player slot index\r\n * @param {number} level - New level\r\n */\r\nexport function broadcastLevelUpQueued(slotIndex, level) {\r\n    if (!mpGame.isActive) return;\r\n\r\n    if (mpGame.isHost) {\r\n        broadcast('level_up_queued', {\r\n            slotIndex: slotIndex,\r\n            level: level,\r\n            timestamp: Date.now()\r\n        });\r\n    } else {\r\n        sendToHost('level_up_queued', {\r\n            slotIndex: slotIndex,\r\n            level: level\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Broadcast synergy activation (both host and client)\r\n * Called when synergies are activated\r\n * @param {number} slotIndex - Player slot index\r\n * @param {Array<string>} synergyKeys - Activated synergy keys\r\n */\r\nexport function broadcastSynergyActivated(slotIndex, synergyKeys) {\r\n    if (!mpGame.isActive) return;\r\n\r\n    if (mpGame.isHost) {\r\n        broadcast('synergy_activated', {\r\n            slotIndex: slotIndex,\r\n            synergies: synergyKeys,\r\n            timestamp: Date.now()\r\n        });\r\n    } else {\r\n        sendToHost('synergy_activated', {\r\n            slotIndex: slotIndex,\r\n            synergies: synergyKeys\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Broadcast powerup weapon expiration (host only)\r\n * Called when powerup weapon expires (ammo or time)\r\n * @param {number} slotIndex - Player slot index\r\n * @param {string} powerupKey - Expired powerup key\r\n */\r\nexport function broadcastPowerupExpired(slotIndex, powerupKey) {\r\n    if (!mpGame.isHost || !mpGame.isActive) return;\r\n\r\n    broadcast('powerup_expired', {\r\n        slotIndex: slotIndex,\r\n        powerupKey: powerupKey,\r\n        timestamp: Date.now()\r\n    });\r\n}\r\n\r\n/**\r\n * Get the game seed (for synchronized random generation)\r\n * @returns {number} Game seed\r\n */\r\nexport function getGameSeed() {\r\n    return mpGame.gameSeed;\r\n}\r\n\r\n/**\r\n * Check if game seed has been set (not 0)\r\n * @returns {boolean} True if seed is set\r\n */\r\nexport function hasGameSeed() {\r\n    return mpGame.gameSeed !== 0;\r\n}\r\n\r\n/**\r\n * Set callback for when game_seed is received (clients only)\r\n * @param {Function} callback - Function to call when seed is received\r\n */\r\nexport function onGameSeedReceived(callback) {\r\n    mpGame.onGameSeedCallback = callback;\r\n}\r\n\r\n/**\r\n * Set current floor for seeded RNG\r\n * @param {number} floor - Floor number\r\n */\r\nexport function setCurrentFloor(floor) {\r\n    mpGame.currentFloor = floor;\r\n    // Reset floor RNG with new seed based on floor\r\n    const floorSeed = createSeed(mpGame.gameSeed, floor);\r\n    mpGame.floorRng = new SeededRandom(floorSeed);\r\n}\r\n\r\n/**\r\n * Set current room for seeded RNG\r\n * @param {number} roomX - Room X coordinate\r\n * @param {number} roomY - Room Y coordinate\r\n */\r\nexport function setCurrentRoom(roomX, roomY) {\r\n    mpGame.currentRoom = { x: roomX, y: roomY };\r\n}\r\n\r\n/**\r\n * Get a seeded RNG for the current room\r\n * Creates a deterministic RNG based on floor and room coordinates\r\n * @returns {SeededRandom} Seeded random number generator for this room\r\n */\r\nexport function getRoomRNG() {\r\n    const seed = createSeed(mpGame.gameSeed, mpGame.currentFloor, mpGame.currentRoom.x, mpGame.currentRoom.y);\r\n    return new SeededRandom(seed);\r\n}\r\n\r\n/**\r\n * Get and clear the first room template key (for clients to use when loading first room)\r\n * @returns {string|null} Template key or null if not set\r\n */\r\nexport function getFirstRoomTemplateKey() {\r\n    const key = mpGame.firstRoomTemplateKey;\r\n    mpGame.firstRoomTemplateKey = null; // Clear after use\r\n    return key;\r\n}\r\n\r\n/**\r\n * Get the floor RNG (for floor-wide generation like floor maps)\r\n * @returns {SeededRandom} Seeded random number generator for this floor\r\n */\r\nexport function getFloorRNG() {\r\n    return mpGame.floorRng;\r\n}\r\n\r\n/**\r\n * Get a seeded RNG for upgrade selection\r\n * Creates a deterministic RNG based on player index and level\r\n * @param {number} playerIndex - Player index (0 for host, 1+ for clients)\r\n * @param {number} playerLevel - Current player level\r\n * @returns {SeededRandom} Seeded random number generator for this upgrade draft\r\n */\r\nexport function getUpgradeRNG(playerIndex, playerLevel) {\r\n    const seed = createSeed(mpGame.gameSeed, playerIndex, playerLevel);\r\n    return new SeededRandom(seed);\r\n}\r\n\r\n/**\r\n * Broadcast game seed to all clients (host only)\r\n * Called when game starts to sync RNG\r\n * @param {string} firstRoomTemplateKey - Key of the first room template\r\n */\r\nexport function broadcastGameSeed(firstRoomTemplateKey = null) {\r\n    if (!mpGame.isHost) return;\r\n\r\n    broadcast('game_seed', {\r\n        seed: mpGame.gameSeed,\r\n        roomTemplateKey: firstRoomTemplateKey\r\n    });\r\n}\r\n\r\n/**\r\n * Broadcast pause state to all clients (host only)\r\n * @param {boolean} paused - Whether the game should be paused\r\n */\r\nexport function broadcastPauseState(paused) {\r\n    if (!mpGame.isHost) return;\r\n\r\n    broadcast('pause_state', { paused });\r\n}\r\n\r\n/**\r\n * Send pause request to host (client only)\r\n * @param {boolean} paused - Whether the game should be paused\r\n */\r\nexport function sendPauseRequest(paused) {\r\n    if (mpGame.isHost) return; // Host doesn't send requests to itself\r\n\r\n    sendToHost('pause_request', { paused });\r\n}\r\n\r\n/**\r\n * Send enemy death notification to host (client only)\r\n * Called when a client kills an enemy to notify host and sync state\r\n * @param {Object} deathData - Enemy death data { entityId, entityType, x, y }\r\n */\r\nexport function sendEnemyDeath(deathData) {\r\n    if (mpGame.isHost) return; // Host doesn't send to itself\r\n\r\n    sendToHost('enemy_death', deathData);\r\n}\r\n\r\n/**\r\n * Broadcast obstacle data to all clients (host only)\r\n * @param {Array} obstacles - Array of obstacle data objects\r\n * @param {Object} doorStates - Optional door blocked states { north, south, east, west }\r\n */\r\nexport function broadcastObstacles(obstacles, doorStates = null) {\r\n    if (!mpGame.isHost) return;\r\n\r\n    broadcast('obstacle_data', { obstacles, doorStates });\r\n}\r\n\r\n/**\r\n * Broadcast room completion to all clients (host only)\r\n * Called when the host detects all enemies are defeated\r\n */\r\nexport function broadcastRoomCompletion() {\r\n    if (!mpGame.isHost) return;\r\n\r\n    broadcast('room_completed', {});\r\n}\r\n\r\n/**\r\n * Broadcast XP gain to all clients (host only)\r\n * Called when XP is collected so all players gain XP\r\n */\r\nexport function broadcastXPGain(xpValue) {\r\n    if (!mpGame.isHost) return;\r\n\r\n    broadcast('xp_gain', { value: xpValue });\r\n}\r\n\r\n/**\r\n * Broadcast currency gain to all clients (host only)\r\n * Called when currency is collected so all players gain currency\r\n */\r\nexport function broadcastCurrencyGain(currencyValue) {\r\n    if (!mpGame.isHost) return;\r\n\r\n    broadcast('currency_gain', { value: currencyValue });\r\n}\r\n\r\n/**\r\n * Get and clear any pending XP accumulated while player was in upgrade draft\r\n * @returns {number} Pending XP amount (0 if none)\r\n */\r\nexport function getAndClearPendingXP() {\r\n    const pending = mpGame.pendingXP;\r\n    mpGame.pendingXP = 0;\r\n    return pending;\r\n}\r\n\r\n/**\r\n * Broadcast emote to all players\r\n * @param {number} slotIndex - Player slot showing emote\r\n * @param {string} emoteType - Type of emote ('exclamation' or 'heart')\r\n */\r\nexport function broadcastEmote(slotIndex, emoteType) {\r\n    if (mpGame.isHost) {\r\n        broadcast('player_emote', { slotIndex, emoteType });\r\n    } else {\r\n        sendToHost('player_emote', { slotIndex, emoteType });\r\n    }\r\n}\r\n\r\n/**\r\n * Broadcast room transition to all clients (host only)\r\n * Called when transitioning to a new room to sync spawn positions and player stats\r\n * @param {string} entryDirection - Direction players will enter from ('north', 'south', 'east', 'west', or null)\r\n * @param {Array} allPlayerStats - Stats for all players to restore after transition\r\n * @param {string} gridDirection - Direction moved on floor map\r\n * @param {number} currentFloor - Current floor number\r\n * @param {string} roomTemplateKey - Key of the room template for obstacle sync\r\n */\r\nexport function broadcastRoomTransition(entryDirection, allPlayerStats = null, gridDirection = null, currentFloor = null, roomTemplateKey = null) {\r\n    if (!mpGame.isHost) return;\r\n\r\n    broadcast('room_transition', {\r\n        entryDirection: entryDirection,\r\n        allPlayerStats: allPlayerStats,\r\n        gridDirection: gridDirection,\r\n        currentFloor: currentFloor,\r\n        roomTemplateKey: roomTemplateKey\r\n    });\r\n}\r\n\r\n// Store pending obstacles for next room (set by host before transition)\r\nlet pendingObstacles = null;\r\n\r\n/**\r\n * Set pending obstacles to be sent with next scene load\r\n * @param {Array} obstacles - Array of obstacle data\r\n */\r\nexport function setPendingObstacles(obstacles) {\r\n    pendingObstacles = obstacles;\r\n}\r\n\r\n/**\r\n * Get and clear pending obstacles\r\n * @returns {Array|null} Pending obstacles or null\r\n */\r\nexport function getPendingObstacles() {\r\n    const obstacles = pendingObstacles;\r\n    pendingObstacles = null;\r\n    return obstacles;\r\n}\r\n\r\n/**\r\n * Broadcast enemy split event to all clients (host only)\r\n * Called when an enemy splits (e.g., slimes) to update the total enemy count\r\n * @param {number} splitCount - Number of enemies created by splitting\r\n */\r\nexport function broadcastEnemySplit(splitCount) {\r\n    if (!mpGame.isHost) return;\r\n\r\n    broadcast('enemy_split', { count: splitCount });\r\n}\r\n\r\n/**\r\n * Broadcast player death event (both host and client)\r\n * Called immediately when a player dies to ensure all clients are synced\r\n * @param {number} slotIndex - Player slot that died\r\n */\r\nexport function broadcastPlayerDeath(slotIndex) {\r\n    if (!mpGame.isActive) return;\r\n\r\n    if (mpGame.isHost) {\r\n        // Host broadcasts to all clients\r\n        broadcast('player_death', { slotIndex });\r\n    } else {\r\n        // Client sends to host\r\n        sendToHost('player_death', { slotIndex });\r\n    }\r\n}\r\n\r\n/**\r\n * Request full game state re-sync from host (client only)\r\n * Called when client detects desynchronization\r\n */\r\nexport function requestResync() {\r\n    if (mpGame.isHost) return; // Host doesn't request resyncs\r\n\r\n    sendToHost('resync_request', { timestamp: Date.now() });\r\n}\r\n\r\n/**\r\n * Get the local player's slot index\r\n * @returns {number} Local player's slot index\r\n */\r\nexport function getLocalPlayerSlot() {\r\n    return mpGame.localPlayerSlot;\r\n}\r\n\r\n/**\r\n * Broadcast achievement unlock to all players\r\n * @param {string} achievementId - ID of the achievement that was unlocked\r\n * @param {number} playerSlotIndex - Slot index of the player who unlocked it\r\n */\r\nexport function broadcastAchievementUnlocked(achievementId, playerSlotIndex) {\r\n    if (!mpGame.isActive) return;\r\n\r\n    const party = getParty();\r\n    const player = party.slots[playerSlotIndex];\r\n    const playerName = player?.name || `Player ${playerSlotIndex + 1}`;\r\n\r\n    // Broadcast to all players (including ourselves for consistency)\r\n    broadcast('achievement_unlocked', {\r\n        achievementId,\r\n        playerSlotIndex,\r\n        playerName\r\n    });\r\n}\r\n","/**\r\n * Object Pooling System\r\n *\r\n * Generic object pooling for performance optimization.\r\n * Reuses game objects instead of creating/destroying them repeatedly.\r\n *\r\n * Usage:\r\n * - Create a pool with a factory function and reset function\r\n * - Use acquire() to get an object from the pool\r\n * - Use release(obj) to return an object to the pool\r\n * - Use clear() to destroy all pooled objects\r\n */\r\n\r\nexport class ObjectPool {\r\n    /**\r\n     * Create a new object pool\r\n     * @param {Object} k - Kaplay instance\r\n     * @param {Function} createFn - Function to create a new object: (k) => object\r\n     * @param {Function} resetFn - Function to reset an object for reuse: (obj, ...args) => void\r\n     * @param {number} initialSize - Number of objects to pre-create\r\n     */\r\n    constructor(k, createFn, resetFn, initialSize = 0) {\r\n        this.k = k;\r\n        this.createFn = createFn;\r\n        this.resetFn = resetFn;\r\n        this.pool = [];\r\n        this.active = new Set();\r\n\r\n        // Pre-warm the pool\r\n        for (let i = 0; i < initialSize; i++) {\r\n            const obj = this.createFn(k);\r\n            obj.hidden = true;\r\n            if (obj.paused !== undefined) obj.paused = true;\r\n            this.pool.push(obj);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Acquire an object from the pool (or create a new one if empty)\r\n     * @param {...any} args - Arguments to pass to the reset function\r\n     * @returns {Object} - The acquired object\r\n     */\r\n    acquire(...args) {\r\n        let obj;\r\n\r\n        if (this.pool.length > 0) {\r\n            // Reuse from pool\r\n            obj = this.pool.pop();\r\n            obj.hidden = false;\r\n            if (obj.paused !== undefined) obj.paused = false;\r\n        } else {\r\n            // Create new object\r\n            obj = this.createFn(this.k);\r\n        }\r\n\r\n        // Reset/initialize the object with provided arguments\r\n        if (this.resetFn) {\r\n            this.resetFn(obj, ...args);\r\n        }\r\n\r\n        // Track as active\r\n        this.active.add(obj);\r\n        obj._pooled = true;\r\n\r\n        return obj;\r\n    }\r\n\r\n    /**\r\n     * Release an object back to the pool\r\n     * @param {Object} obj - The object to release\r\n     */\r\n    release(obj) {\r\n        if (!obj || !obj._pooled) return;\r\n\r\n        // Check if object still exists (wasn't destroyed externally)\r\n        if (!obj.exists || !obj.exists()) {\r\n            this.active.delete(obj);\r\n            return;\r\n        }\r\n\r\n        // Hide the object instead of destroying it\r\n        obj.hidden = true;\r\n        if (obj.paused !== undefined) obj.paused = true;\r\n\r\n        // Move off-screen to prevent accidental collisions\r\n        if (obj.pos) {\r\n            obj.pos.x = -9999;\r\n            obj.pos.y = -9999;\r\n        }\r\n\r\n        // Remove from active tracking\r\n        this.active.delete(obj);\r\n\r\n        // Add back to pool\r\n        this.pool.push(obj);\r\n    }\r\n\r\n    /**\r\n     * Clear all objects (both pooled and active)\r\n     */\r\n    clear() {\r\n        // Destroy all pooled objects\r\n        for (const obj of this.pool) {\r\n            if (obj.exists && obj.exists()) {\r\n                this.k.destroy(obj);\r\n            }\r\n        }\r\n        this.pool = [];\r\n\r\n        // Destroy all active objects\r\n        for (const obj of this.active) {\r\n            if (obj.exists && obj.exists()) {\r\n                this.k.destroy(obj);\r\n            }\r\n        }\r\n        this.active.clear();\r\n    }\r\n\r\n    /**\r\n     * Get the current pool size\r\n     * @returns {number} - Number of objects in the pool\r\n     */\r\n    getPoolSize() {\r\n        return this.pool.length;\r\n    }\r\n\r\n    /**\r\n     * Get the current number of active objects\r\n     * @returns {number} - Number of active objects\r\n     */\r\n    getActiveCount() {\r\n        return this.active.size;\r\n    }\r\n\r\n    /**\r\n     * Prewarm the pool with a specific number of objects\r\n     * @param {number} count - Number of objects to add to the pool\r\n     */\r\n    prewarm(count) {\r\n        for (let i = 0; i < count; i++) {\r\n            const obj = this.createFn(this.k);\r\n            obj.hidden = true;\r\n            if (obj.paused !== undefined) obj.paused = true;\r\n            obj._pooled = true;\r\n            // Move off-screen\r\n            if (obj.pos) {\r\n                obj.pos.x = -9999;\r\n                obj.pos.y = -9999;\r\n            }\r\n            this.pool.push(obj);\r\n        }\r\n    }\r\n}\r\n\r\n// Pool manager to hold all object pools\r\nconst pools = {\r\n    projectiles: null,\r\n    particles: null\r\n};\r\n\r\n/**\r\n * Initialize object pools for the game\r\n * @param {Object} k - Kaplay instance\r\n */\r\nexport function initObjectPools(k) {\r\n    // Projectile pool\r\n    pools.projectiles = new ObjectPool(\r\n        k,\r\n        // Create function\r\n        (k) => {\r\n            const proj = k.add([\r\n                k.text('*', { size: 16 }),\r\n                k.pos(-9999, -9999),\r\n                k.anchor('center'),\r\n                k.color(255, 255, 100),\r\n                k.rotate(0),\r\n                k.area(),\r\n                'projectile'\r\n            ]);\r\n            proj.hidden = true;\r\n            return proj;\r\n        },\r\n        // Reset function\r\n        (proj, x, y, direction, speed, damage, piercing, obstaclePiercing, isCrit, maxRange) => {\r\n            proj.pos.x = x;\r\n            proj.pos.y = y;\r\n            proj.damage = damage;\r\n            proj.piercing = piercing || 0;\r\n            proj.obstaclePiercing = obstaclePiercing || 0;\r\n            proj.piercedEnemies = new Set();\r\n            proj.piercedObstacles = new Set();\r\n            proj.isCrit = isCrit || false;\r\n            proj.maxRange = maxRange || 750;\r\n            proj.distanceTraveled = 0;\r\n            proj.direction = direction;\r\n            proj.speed = speed;\r\n            proj.isBoomerang = false;\r\n            proj.isReturning = false;\r\n            proj.ownerPlayer = null;\r\n            proj.returnSpeedMultiplier = 1.2;\r\n            proj.isExplosive = false;\r\n            proj.isChainLightning = false;\r\n            proj.isEnemyProjectile = false;\r\n            proj.isBossProjectile = false;\r\n            proj.isReflected = false;\r\n            proj.reflectionCount = 0;\r\n            proj.chainedEnemies = null;\r\n            proj.chainJumps = 0;\r\n            proj.ownerSlotIndex = undefined;\r\n            proj.burnDamage = null;\r\n            proj.burnDuration = null;\r\n\r\n            // Reset visuals\r\n            proj.text = '*';\r\n            proj.color = isCrit ? k.rgb(255, 200, 0) : k.rgb(255, 255, 100);\r\n            const angle = (Math.atan2(direction.y, direction.x) * (180 / Math.PI)) + 90;\r\n            proj.angle = angle;\r\n        },\r\n        50 // Pre-create 50 projectiles\r\n    );\r\n\r\n    // Particle pool\r\n    pools.particles = new ObjectPool(\r\n        k,\r\n        // Create function\r\n        (k) => {\r\n            const particle = k.add([\r\n                k.text('*', { size: 12 }),\r\n                k.pos(-9999, -9999),\r\n                k.anchor('center'),\r\n                k.color(255, 255, 255),\r\n                k.z(100),\r\n                'particle'\r\n            ]);\r\n            particle.hidden = true;\r\n            return particle;\r\n        },\r\n        // Reset function\r\n        (particle, x, y, options = {}) => {\r\n            const {\r\n                char = '*',\r\n                size = 12,\r\n                color = [255, 255, 255],\r\n                velocity = { x: 0, y: 0 },\r\n                gravity = 0,\r\n                lifetime = 1.0,\r\n                fadeStart = 0.3,\r\n                friction = 0.95,\r\n                zIndex = 100\r\n            } = options;\r\n\r\n            particle.pos.x = x;\r\n            particle.pos.y = y;\r\n            particle.text = char;\r\n            // Note: KAPLAY text size can't be changed dynamically, so we use default\r\n            particle.color = k.rgb(...color);\r\n            particle.z = zIndex;\r\n            particle.opacity = 1;\r\n\r\n            // Physics properties\r\n            particle.velocity = { x: velocity.x, y: velocity.y };\r\n            particle.gravity = gravity;\r\n            particle.friction = friction;\r\n            particle.lifetime = lifetime;\r\n            particle.fadeStart = fadeStart;\r\n            particle.age = 0;\r\n            particle.initialOpacity = 1.0;\r\n        },\r\n        100 // Pre-create 100 particles\r\n    );\r\n}\r\n\r\n/**\r\n * Get the projectile pool\r\n * @returns {ObjectPool|null} - The projectile pool\r\n */\r\nexport function getProjectilePool() {\r\n    return pools.projectiles;\r\n}\r\n\r\n/**\r\n * Get the particle pool\r\n * @returns {ObjectPool|null} - The particle pool\r\n */\r\nexport function getParticlePool() {\r\n    return pools.particles;\r\n}\r\n\r\n/**\r\n * Clear all object pools\r\n */\r\nexport function clearAllPools() {\r\n    if (pools.projectiles) {\r\n        pools.projectiles.clear();\r\n        pools.projectiles = null;\r\n    }\r\n    if (pools.particles) {\r\n        pools.particles.clear();\r\n        pools.particles = null;\r\n    }\r\n}\r\n\r\n/**\r\n * Get pool statistics for debugging\r\n * @returns {Object} - Pool statistics\r\n */\r\nexport function getPoolStats() {\r\n    return {\r\n        projectiles: pools.projectiles ? {\r\n            pooled: pools.projectiles.getPoolSize(),\r\n            active: pools.projectiles.getActiveCount()\r\n        } : null,\r\n        particles: pools.particles ? {\r\n            pooled: pools.particles.getPoolSize(),\r\n            active: pools.particles.getActiveCount()\r\n        } : null\r\n    };\r\n}\r\n","/**\r\n * Projectile Entity\r\n *\r\n * Creates and manages bullet/projectile entities:\r\n * - Player and enemy projectiles\r\n * - Piercing mechanics (enemy and obstacle)\r\n * - Critical hit visual feedback\r\n * - Range limiting\r\n * - Lifetime tracking\r\n * - Collision detection and cleanup\r\n * - Object pooling support for performance\r\n */\r\n\r\n// Configuration imports\r\nimport { WEAPON_CONFIG } from '../config/constants.js';\r\nimport { registerProjectile, isHost, isMultiplayerActive, unregisterProjectile } from '../systems/multiplayerGame.js';\r\nimport { getProjectilePool } from '../systems/objectPool.js';\r\n\r\n// Track projectiles that use pooling for proper cleanup\r\nlet pooledProjectileUpdateHandler = null;\r\n\r\nexport function createProjectile(k, x, y, direction, speed, damage, piercing = 0, obstaclePiercing = 0, isCrit = false, maxRange = null) {\r\n    // Calculate rotation angle from direction vector\r\n    // Add 90 degrees offset since most bullet characters (like ) are vertical by default\r\n    const angle = (Math.atan2(direction.y, direction.x) * (180 / Math.PI)) + 90;\r\n\r\n    const projectile = k.add([\r\n        k.text('*', { size: 16 }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(isCrit ? 255 : 255, isCrit ? 200 : 255, isCrit ? 0 : 100), // Orange/red for crits\r\n        k.rotate(angle), // Rotate to face direction of travel\r\n        k.area(),\r\n        'projectile'\r\n    ]);\r\n\r\n    projectile.damage = damage;\r\n    projectile.piercing = piercing; // Number of enemies this can pass through\r\n    projectile.obstaclePiercing = obstaclePiercing; // Number of obstacles this can pass through (separate from enemy piercing)\r\n    projectile.piercedEnemies = new Set(); // Track which enemies this has already hit\r\n    projectile.piercedObstacles = new Set(); // Track which obstacles this has already hit\r\n    projectile.isCrit = isCrit;\r\n    // Set max range - use provided range or default\r\n    projectile.maxRange = maxRange || WEAPON_CONFIG.DEFAULT_WEAPON_RANGE;\r\n    projectile.distanceTraveled = 0;\r\n    projectile.direction = direction; // Store direction for manual movement\r\n    projectile.speed = speed; // Store speed for manual movement\r\n\r\n    // Boomerang properties (set by weapon system when creating boomerang projectiles)\r\n    projectile.isBoomerang = false;\r\n    projectile.isReturning = false;\r\n    projectile.ownerPlayer = null; // Reference to player for return targeting\r\n    projectile.returnSpeedMultiplier = 1.2;\r\n    \r\n    // Method to apply weapon visual properties\r\n    projectile.useWeaponVisual = function(weaponDef) {\r\n        if (weaponDef && weaponDef.char) {\r\n            // Update text directly (KAPLAY allows direct text assignment)\r\n            projectile.text = weaponDef.char;\r\n        }\r\n        if (weaponDef && weaponDef.color) {\r\n            // Keep crit color if it's a crit, otherwise use weapon color\r\n            if (!projectile.isCrit) {\r\n                projectile.color = k.rgb(...weaponDef.color);\r\n            }\r\n        }\r\n        if (weaponDef && weaponDef.range) {\r\n            projectile.maxRange = weaponDef.range;\r\n        }\r\n    };\r\n\r\n    // Manual movement and range management\r\n    projectile.onUpdate(() => {\r\n        if (k.paused) return;\r\n\r\n        // Boomerang return logic\r\n        if (projectile.isBoomerang) {\r\n            if (!projectile.isReturning) {\r\n                // Moving outward\r\n                const moveAmount = projectile.direction.scale(projectile.speed * k.dt());\r\n                projectile.distanceTraveled += moveAmount.len();\r\n\r\n                projectile.pos.x += moveAmount.x;\r\n                projectile.pos.y += moveAmount.y;\r\n\r\n                // Check if should start returning\r\n                if (projectile.distanceTraveled >= projectile.maxRange) {\r\n                    projectile.isReturning = true;\r\n                    projectile.piercedEnemies.clear(); // Reset hit tracking so it can hit enemies on return\r\n                    projectile.distanceTraveled = 0;\r\n                }\r\n            } else {\r\n                // Returning to player\r\n                if (projectile.ownerPlayer && projectile.ownerPlayer.exists() && !projectile.ownerPlayer.isDead) {\r\n                    const toPlayer = k.vec2(\r\n                        projectile.ownerPlayer.pos.x - projectile.pos.x,\r\n                        projectile.ownerPlayer.pos.y - projectile.pos.y\r\n                    );\r\n                    const distToPlayer = toPlayer.len();\r\n\r\n                    // Move toward player\r\n                    if (distToPlayer > 0) {\r\n                        const returnDir = toPlayer.unit();\r\n                        const returnSpeed = projectile.speed * projectile.returnSpeedMultiplier;\r\n                        const moveAmount = returnDir.scale(returnSpeed * k.dt());\r\n\r\n                        projectile.pos.x += moveAmount.x;\r\n                        projectile.pos.y += moveAmount.y;\r\n                        projectile.direction = returnDir; // Update direction for rotation\r\n\r\n                        // Destroy when close to player\r\n                        if (distToPlayer < 30) {\r\n                            k.destroy(projectile);\r\n                            return;\r\n                        }\r\n                    }\r\n                } else {\r\n                    // No player to return to - destroy\r\n                    k.destroy(projectile);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Update rotation for boomerang visual\r\n            const angle = (Math.atan2(projectile.direction.y, projectile.direction.x) * (180 / Math.PI)) + 90;\r\n            projectile.angle = angle;\r\n            return;\r\n        }\r\n\r\n        // Normal projectile movement\r\n        const moveAmount = projectile.direction.scale(projectile.speed * k.dt());\r\n        const distanceThisFrame = moveAmount.len();\r\n        projectile.distanceTraveled += distanceThisFrame;\r\n\r\n        projectile.pos.x += moveAmount.x;\r\n        projectile.pos.y += moveAmount.y;\r\n\r\n        // Remove if exceeded max range\r\n        if (projectile.distanceTraveled >= projectile.maxRange) {\r\n            k.destroy(projectile);\r\n            return;\r\n        }\r\n\r\n        // Remove if out of bounds\r\n        if (projectile.pos.x < 0 || projectile.pos.x > k.width() ||\r\n            projectile.pos.y < 0 || projectile.pos.y > k.height()) {\r\n            k.destroy(projectile);\r\n        }\r\n    });\r\n\r\n    // Multiplayer: Register projectile for network sync if host\r\n    if (isMultiplayerActive() && isHost()) {\r\n        registerProjectile(projectile);\r\n    }\r\n\r\n    // Cleanup: Remove from tracking map when destroyed (prevents memory leak)\r\n    if (isMultiplayerActive()) {\r\n        projectile.onDestroy(() => {\r\n            unregisterProjectile(projectile);\r\n        });\r\n    }\r\n\r\n    return projectile;\r\n}\r\n\r\n/**\r\n * Release a projectile back to the pool instead of destroying it\r\n * Falls back to k.destroy if pooling is not enabled\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} projectile - The projectile to release\r\n */\r\nexport function releaseProjectile(k, projectile) {\r\n    if (!projectile || !projectile.exists()) return;\r\n\r\n    // Unregister from multiplayer tracking\r\n    if (isMultiplayerActive()) {\r\n        unregisterProjectile(projectile);\r\n    }\r\n\r\n    // Try to release to pool, otherwise destroy\r\n    const pool = getProjectilePool();\r\n    if (pool && projectile._pooled) {\r\n        pool.release(projectile);\r\n    } else {\r\n        k.destroy(projectile);\r\n    }\r\n}\r\n\r\n","/**\r\n * Enemy Type Definitions\r\n *\r\n * All enemy types and their properties.\r\n * Extracted from enemy.js for better organization and maintainability.\r\n */\r\n\r\nexport const ENEMY_TYPES = {\r\n    // =================================================================\r\n    // FLOOR 1 ENEMIES\r\n    // =================================================================\r\n    rusher: {\r\n        name: 'Security Guard',\r\n        char: '', // Right-pointing triangle\r\n        color: [255, 150, 100],\r\n        baseHealth: 25, // 20-30 range\r\n        baseSpeed: 90, // 80-100 range\r\n        size: 18,\r\n        baseXPValue: 2, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 9 // 8-10 range\r\n    },\r\n    shooter: {\r\n        name: 'Camera Operator',\r\n        char: '', // White diamond containing black small diamond\r\n        color: [100, 200, 255],\r\n        baseHealth: 30, // 25-35 range\r\n        baseSpeed: 70, // 60-80 range\r\n        size: 18,\r\n        baseXPValue: 2, // Reduced by 3x for balance\r\n        behavior: 'shoot',\r\n        fireRate: 0.53, // Shots per second (reduced by 1/3 from 0.8)\r\n        projectileSpeed: 200,\r\n        projectileDamage: 7 // 6-8 range\r\n    },\r\n    zombie: {\r\n        name: 'Audience Member',\r\n        char: '', // Skull and crossbones\r\n        color: [150, 150, 150],\r\n        baseHealth: 45, // 40-50 range\r\n        baseSpeed: 50, // 40-60 range\r\n        size: 20,\r\n        baseXPValue: 3, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 11 // 10-12 range\r\n    },\r\n    slime: {\r\n        name: 'Fan',\r\n        char: '', // Black circle\r\n        color: [100, 255, 100],\r\n        baseHealth: 12, // 10-15 range\r\n        baseSpeed: 40, // 30-50 range\r\n        size: 16,\r\n        baseXPValue: 1, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 5,\r\n        splits: true // Splits on death\r\n    },\r\n    bat: {\r\n        name: 'Stagehand',\r\n        char: '', // Black down triangle\r\n        color: [200, 150, 255],\r\n        baseHealth: 10, // 8-12 range\r\n        baseSpeed: 135, // 120-150 range\r\n        size: 14,\r\n        baseXPValue: 2, // Reduced by 3x for balance\r\n        behavior: 'erratic',\r\n        damage: 6 // 5-7 range\r\n    },\r\n\r\n    // =================================================================\r\n    // FLOOR 2 ENEMIES\r\n    // =================================================================\r\n    charger: {\r\n        name: 'Head of Security',\r\n        char: '', // Right arrow\r\n        color: [255, 200, 100],\r\n        baseHealth: 20, // 15-25 range\r\n        baseSpeed: 175, // 150-200 range (charge speed)\r\n        size: 18,\r\n        baseXPValue: 3, // Reduced by 3x for balance\r\n        behavior: 'charge',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 17, // 15-20 range\r\n        chargeCooldown: 3 // Seconds between charges\r\n    },\r\n    turret: {\r\n        name: 'Camera Director',\r\n        char: '', // Box drawing cross\r\n        color: [200, 200, 200],\r\n        baseHealth: 60, // 50-70 range\r\n        baseSpeed: 0, // Stationary\r\n        size: 20,\r\n        baseXPValue: 3, // Reduced by 3x for balance\r\n        behavior: 'turret',\r\n        fireRate: 1.2, // Shots per second\r\n        projectileSpeed: 250,\r\n        projectileDamage: 13 // 12-15 range\r\n    },\r\n    heavyTank: {\r\n        name: 'Bouncer',\r\n        char: '', // Full block\r\n        color: [150, 150, 255],\r\n        baseHealth: 125, // 100-150 range\r\n        baseSpeed: 40, // 30-50 range\r\n        size: 24,\r\n        baseXPValue: 5, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 22 // 20-25 range\r\n    },\r\n    zippy: {\r\n        name: 'Runner',\r\n        char: '', // Circle with left half black\r\n        color: [255, 255, 150],\r\n        baseHealth: 7, // 5-10 range\r\n        baseSpeed: 200, // 180-220 range\r\n        size: 14,\r\n        baseXPValue: 2, // Reduced by 3x for balance\r\n        behavior: 'erratic',\r\n        damage: 5 // 4-6 range\r\n    },\r\n    exploder: {\r\n        name: 'Pyrotechnics Tech',\r\n        char: '', // Bullseye\r\n        color: [255, 100, 50],\r\n        baseHealth: 25, // 20-30 range\r\n        baseSpeed: 80, // 70-90 range\r\n        size: 18,\r\n        baseXPValue: 3, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart',\r\n        damage: 8,\r\n        explodes: true, // Explodes on death\r\n        explosionDamage: 17, // 15-20 range\r\n        explosionRadius: 60 // Pixels\r\n    },\r\n    orbiter: {\r\n        name: 'Floor Manager',\r\n        char: '', // Fisheye\r\n        color: [255, 150, 0],\r\n        baseHealth: 35, // Slightly tankier\r\n        baseSpeed: 60, // Slower, methodical movement\r\n        size: 20,\r\n        baseXPValue: 4, // Reduced by 3x for balance\r\n        behavior: 'perimeter', // Walks around edge of map\r\n        pathfindingMode: 'perimeter',\r\n        damage: 10,\r\n        explodes: true, // Explodes into shrapnel\r\n        explosionDamage: 20,\r\n        explosionRadius: 80,\r\n        shrapnel: true, // Shoots projectiles in all directions on death\r\n        shrapnelCount: 12 // Number of projectiles\r\n    },\r\n    splitter: {\r\n        name: 'Intern',\r\n        char: '', // White diamond\r\n        color: [200, 255, 200],\r\n        baseHealth: 40, // 35-45 range\r\n        baseSpeed: 75, // 70-80 range\r\n        size: 20,\r\n        baseXPValue: 3,\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart',\r\n        damage: 8,\r\n        splits: true, // Splits into 2 smaller copies on death\r\n        splitCount: 2\r\n    },\r\n\r\n    // =================================================================\r\n    // FLOOR 3 ENEMIES\r\n    // =================================================================\r\n    mage: {\r\n        name: 'Lighting Director',\r\n        char: '', // Four-pointed star\r\n        color: [200, 100, 255],\r\n        baseHealth: 70, // 60-80 range\r\n        baseSpeed: 50, // 40-60 range\r\n        size: 20,\r\n        baseXPValue: 4, // Reduced by 3x for balance\r\n        behavior: 'shoot',\r\n        fireRate: 0.6, // Slower but more powerful\r\n        projectileSpeed: 180,\r\n        projectileDamage: 12 // 10-15 range\r\n    },\r\n    shieldBearer: {\r\n        name: 'Stage Manager',\r\n        char: '', // Dark shade\r\n        color: [150, 150, 200],\r\n        baseHealth: 90, // 80-100 range\r\n        baseSpeed: 40, // 30-50 range\r\n        size: 22,\r\n        baseXPValue: 5, // Reduced by 3x for balance\r\n        behavior: 'shield',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 15,\r\n        blocksProjectiles: true // Blocks from front (simplified for now)\r\n    },\r\n    golem: {\r\n        name: 'Set Designer',\r\n        char: '', // Black medium square\r\n        color: [100, 100, 100],\r\n        baseHealth: 250, // 200-300 range\r\n        baseSpeed: 30, // 20-40 range\r\n        size: 26,\r\n        baseXPValue: 7, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 30 // 25-35 range\r\n    },\r\n    wraith: {\r\n        name: 'Editor',\r\n        char: '', // Almost equal (wave)\r\n        color: [150, 150, 255],\r\n        baseHealth: 20, // 15-25 range\r\n        baseSpeed: 225, // 200-250 range\r\n        size: 16,\r\n        baseXPValue: 3, // Reduced by 3x for balance\r\n        behavior: 'teleport',\r\n        damage: 13, // 12-15 range\r\n        teleportCooldown: 4, // Seconds between teleports\r\n        teleportRange: 150 // Teleport distance\r\n    },\r\n    spawner: {\r\n        name: 'Casting Director',\r\n        char: '', // Circle with upper right quadrant black\r\n        color: [255, 150, 100],\r\n        baseHealth: 80, // 70-90 range\r\n        baseSpeed: 40, // 30-50 range\r\n        size: 20,\r\n        baseXPValue: 5, // Reduced by 3x for balance\r\n        behavior: 'spawner',\r\n        damage: 8,\r\n        spawnInterval: 6, // Spawn every 6 seconds\r\n        spawnType: 'rusher' // Spawns basic rushers\r\n    },\r\n    buffer: {\r\n        name: 'Assistant Director',\r\n        char: '', // Heavy plus\r\n        color: [255, 200, 100],\r\n        baseHealth: 35, // 30-40 range\r\n        baseSpeed: 50, // 40-60 range\r\n        size: 18,\r\n        baseXPValue: 3, // Reduced by 3x for balance\r\n        behavior: 'buffer',\r\n        damage: 6,\r\n        buffRadius: 100, // Buffs enemies within this radius\r\n        buffAmount: 0.2 // +20% speed and damage\r\n    },\r\n    phaser: {\r\n        name: 'Ghost Writer',\r\n        char: '', // Dotted circle\r\n        color: [180, 180, 255],\r\n        baseHealth: 25, // 20-30 range\r\n        baseSpeed: 100, // 90-110 range\r\n        size: 18,\r\n        baseXPValue: 3,\r\n        behavior: 'phase',\r\n        pathfindingMode: 'none', // Phases through obstacles, no pathfinding needed\r\n        damage: 10,\r\n        phaseOpacity: 0.5, // Semi-transparent\r\n        phaseThroughObstacles: true // Can move through obstacles\r\n    },\r\n    mimic: {\r\n        name: 'Stunt Double',\r\n        char: '@', // Same as player\r\n        color: [255, 100, 100],\r\n        baseHealth: 35, // 30-40 range\r\n        baseSpeed: 150, // Matches player speed\r\n        size: 18,\r\n        baseXPValue: 4,\r\n        behavior: 'mimic',\r\n        pathfindingMode: 'none',\r\n        damage: 12,\r\n        mimicDuration: 2.0, // Seconds to copy player movement\r\n        mimicCooldown: 4.0 // Seconds between mimic attempts\r\n    },\r\n\r\n    // =================================================================\r\n    // FLOOR 4 ENEMIES\r\n    // =================================================================\r\n    healer: {\r\n        name: 'Producer',\r\n        char: '', // Open center cross\r\n        color: [100, 255, 150],\r\n        baseHealth: 70, // 60-80 range\r\n        baseSpeed: 40, // 30-50 range\r\n        size: 20,\r\n        baseXPValue: 4, // Reduced by 3x for balance\r\n        behavior: 'healer',\r\n        damage: 8,\r\n        healRadius: 120, // Heals enemies within this radius\r\n        healAmount: 12, // 10-15 range\r\n        healInterval: 4 // Heal every 4 seconds\r\n    },\r\n    teleporter: {\r\n        name: 'Executive Producer',\r\n        char: '', // Left half black circle\r\n        color: [200, 150, 255],\r\n        baseHealth: 25, // 20-30 range\r\n        baseSpeed: 90, // 80-100 range\r\n        size: 18,\r\n        baseXPValue: 3, // Reduced by 3x for balance\r\n        behavior: 'teleportPlayer',\r\n        damage: 8,\r\n        teleportRange: 200, // Teleport player this distance\r\n        teleportCooldown: 5 // Seconds between teleports\r\n    },\r\n    freezer: {\r\n        name: 'Network Executive',\r\n        char: '', // Snowflake\r\n        color: [150, 200, 255],\r\n        baseHealth: 60, // 50-70 range\r\n        baseSpeed: 50, // 40-60 range\r\n        size: 20,\r\n        baseXPValue: 4, // Reduced by 3x for balance\r\n        behavior: 'freeze',\r\n        damage: 10,\r\n        slowRadius: 80, // Slows player within this radius\r\n        slowAmount: 0.4 // -40% speed\r\n    },\r\n    leech: {\r\n        name: 'Talent Agent',\r\n        char: '', // Right half black circle\r\n        color: [255, 100, 150],\r\n        baseHealth: 30, // 25-35 range\r\n        baseSpeed: 80, // 70-90 range\r\n        size: 18,\r\n        baseXPValue: 3, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 8,\r\n        lifesteal: 7 // 5-10 range, heals this much on hit\r\n    },\r\n    reflector: {\r\n        name: 'Mirror Master',\r\n        char: '', // Diamond with dot\r\n        color: [200, 200, 255],\r\n        baseHealth: 80, // 70-90 range\r\n        baseSpeed: 45, // 40-50 range\r\n        size: 22,\r\n        baseXPValue: 5,\r\n        behavior: 'shield',\r\n        pathfindingMode: 'smart',\r\n        damage: 12,\r\n        reflectsProjectiles: true, // Reflects projectiles back at player\r\n        reflectChance: 0.4 // 40% chance to reflect\r\n    },\r\n    bomber: {\r\n        name: 'Demolitions Expert',\r\n        char: '', // Black diamond\r\n        color: [255, 150, 100],\r\n        baseHealth: 70, // 60-80 range\r\n        baseSpeed: 0, // Stationary\r\n        size: 22,\r\n        baseXPValue: 5,\r\n        behavior: 'bomber',\r\n        fireRate: 0.4, // Launches a bomb every 2.5 seconds\r\n        projectileSpeed: 100, // Slow moving bombs\r\n        projectileDamage: 20,\r\n        homingStrength: 0.5, // How strongly bombs home in on player\r\n        bombExplosionRadius: 50 // Explosion radius when bomb hits\r\n    },\r\n\r\n    // =================================================================\r\n    // LEGACY TYPES (for backwards compatibility)\r\n    // =================================================================\r\n    basic: {\r\n        name: 'Crew Member',\r\n        char: 'E',\r\n        color: [255, 100, 100],\r\n        baseHealth: 30,\r\n        baseSpeed: 50,\r\n        size: 20,\r\n        baseXPValue: 2, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 8\r\n    },\r\n    tank: {\r\n        name: 'Camera Operator',\r\n        char: '', // Full block (same as heavyTank)\r\n        color: [150, 150, 255],\r\n        baseHealth: 80,\r\n        baseSpeed: 30,\r\n        size: 24,\r\n        baseXPValue: 4, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 20\r\n    },\r\n    fast: {\r\n        name: 'Runner',\r\n        char: 'F',\r\n        color: [255, 255, 100],\r\n        baseHealth: 20,\r\n        baseSpeed: 90,\r\n        size: 16,\r\n        baseXPValue: 2, // Reduced by 3x for balance\r\n        behavior: 'rush',\r\n        pathfindingMode: 'smart', // Uses A* pathfinding\r\n        damage: 6\r\n    }\r\n};\r\n\r\n/**\r\n * Get enemy definition by type key\r\n * @param {string} type - Enemy type key\r\n * @returns {object} Enemy configuration\r\n */\r\nexport function getEnemyDefinition(type) {\r\n    return ENEMY_TYPES[type] || ENEMY_TYPES.basic;\r\n}\r\n\r\n/**\r\n * Get all enemy types for a specific floor\r\n * @param {number} floor - Floor number\r\n * @returns {Array<string>} Array of enemy type keys for that floor\r\n */\r\nexport function getEnemiesForFloor(floor) {\r\n    const floor1 = ['rusher', 'shooter', 'zombie', 'slime', 'bat'];\r\n    const floor2 = ['charger', 'turret', 'heavyTank', 'zippy', 'exploder', 'splitter'];\r\n    const floor3 = ['mage', 'shieldBearer', 'golem', 'wraith', 'spawner', 'buffer', 'phaser', 'mimic'];\r\n    const floor4 = ['healer', 'teleporter', 'freezer', 'leech', 'reflector', 'bomber'];\r\n\r\n    if (floor === 1) return floor1;\r\n    if (floor === 2) return [...floor1, ...floor2];\r\n    if (floor === 3) return [...floor2, ...floor3];\r\n    if (floor >= 4) return [...floor3, ...floor4];\r\n\r\n    return floor1; // Default to floor 1\r\n}\r\n","/**\r\n * Pathfinding System\r\n *\r\n * Provides intelligent pathfinding for enemies:\r\n * - A* pathfinding for obstacle avoidance\r\n * - Different behaviors: direct, smart, perimeter\r\n * - Grid-based navigation with obstacle detection\r\n */\r\n\r\nconst GRID_SIZE = 32; // Size of each grid cell for pathfinding\r\nconst MAX_PATH_LENGTH = 100; // Max path nodes to prevent infinite loops\r\n\r\n/**\r\n * Simple priority queue for A* algorithm\r\n */\r\nclass PriorityQueue {\r\n    constructor() {\r\n        this.elements = [];\r\n    }\r\n\r\n    enqueue(element, priority) {\r\n        this.elements.push({ element, priority });\r\n        this.elements.sort((a, b) => a.priority - b.priority);\r\n    }\r\n\r\n    dequeue() {\r\n        return this.elements.shift()?.element;\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.elements.length === 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Get grid coordinate from world position\r\n */\r\nfunction worldToGrid(x, y) {\r\n    return {\r\n        gx: Math.floor(x / GRID_SIZE),\r\n        gy: Math.floor(y / GRID_SIZE)\r\n    };\r\n}\r\n\r\n/**\r\n * Get world position from grid coordinate (center of cell)\r\n */\r\nfunction gridToWorld(gx, gy) {\r\n    return {\r\n        x: gx * GRID_SIZE + GRID_SIZE / 2,\r\n        y: gy * GRID_SIZE + GRID_SIZE / 2\r\n    };\r\n}\r\n\r\n/**\r\n * Check if a grid cell is walkable\r\n */\r\nfunction isCellWalkable(k, gx, gy, gridWidth, gridHeight) {\r\n    // Out of bounds\r\n    if (gx < 0 || gy < 0 || gx >= gridWidth || gy >= gridHeight) {\r\n        return false;\r\n    }\r\n\r\n    // Check if there's an obstacle at this grid cell\r\n    const worldPos = gridToWorld(gx, gy);\r\n    const obstacles = k.get('obstacle');\r\n\r\n    for (const obstacle of obstacles) {\r\n        if (!obstacle.exists()) continue;\r\n\r\n        // Check if cell overlaps with obstacle\r\n        const halfSize = GRID_SIZE / 2;\r\n        const cellLeft = worldPos.x - halfSize;\r\n        const cellRight = worldPos.x + halfSize;\r\n        const cellTop = worldPos.y - halfSize;\r\n        const cellBottom = worldPos.y + halfSize;\r\n\r\n        const obstacleLeft = obstacle.pos.x - obstacle.width / 2;\r\n        const obstacleRight = obstacle.pos.x + obstacle.width / 2;\r\n        const obstacleTop = obstacle.pos.y - obstacle.height / 2;\r\n        const obstacleBottom = obstacle.pos.y + obstacle.height / 2;\r\n\r\n        // Check overlap\r\n        if (cellRight > obstacleLeft && cellLeft < obstacleRight &&\r\n            cellBottom > obstacleTop && cellTop < obstacleBottom) {\r\n            return false; // Cell overlaps obstacle\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n/**\r\n * Manhattan distance heuristic for A*\r\n */\r\nfunction heuristic(a, b) {\r\n    return Math.abs(a.gx - b.gx) + Math.abs(a.gy - b.gy);\r\n}\r\n\r\n/**\r\n * A* pathfinding algorithm\r\n * Returns array of waypoints from start to goal\r\n */\r\nexport function findPath(k, startX, startY, goalX, goalY) {\r\n    const roomWidth = k.width();\r\n    const roomHeight = k.height();\r\n    const gridWidth = Math.ceil(roomWidth / GRID_SIZE);\r\n    const gridHeight = Math.ceil(roomHeight / GRID_SIZE);\r\n\r\n    const start = worldToGrid(startX, startY);\r\n    const goal = worldToGrid(goalX, goalY);\r\n\r\n    // If start or goal is not walkable, return empty path\r\n    if (!isCellWalkable(k, start.gx, start.gy, gridWidth, gridHeight) ||\r\n        !isCellWalkable(k, goal.gx, goal.gy, gridWidth, gridHeight)) {\r\n        return [];\r\n    }\r\n\r\n    const frontier = new PriorityQueue();\r\n    frontier.enqueue(start, 0);\r\n\r\n    const cameFrom = new Map();\r\n    const costSoFar = new Map();\r\n\r\n    const getKey = (node) => `${node.gx},${node.gy}`;\r\n\r\n    cameFrom.set(getKey(start), null);\r\n    costSoFar.set(getKey(start), 0);\r\n\r\n    let iterations = 0;\r\n    const maxIterations = gridWidth * gridHeight; // Safety limit\r\n\r\n    while (!frontier.isEmpty() && iterations < maxIterations) {\r\n        iterations++;\r\n        const current = frontier.dequeue();\r\n\r\n        // Reached goal\r\n        if (current.gx === goal.gx && current.gy === goal.gy) {\r\n            break;\r\n        }\r\n\r\n        // Check neighbors (4-directional: up, down, left, right)\r\n        const neighbors = [\r\n            { gx: current.gx + 1, gy: current.gy },\r\n            { gx: current.gx - 1, gy: current.gy },\r\n            { gx: current.gx, gy: current.gy + 1 },\r\n            { gx: current.gx, gy: current.gy - 1 },\r\n            // Diagonals for smoother paths\r\n            { gx: current.gx + 1, gy: current.gy + 1 },\r\n            { gx: current.gx + 1, gy: current.gy - 1 },\r\n            { gx: current.gx - 1, gy: current.gy + 1 },\r\n            { gx: current.gx - 1, gy: current.gy - 1 }\r\n        ];\r\n\r\n        for (const next of neighbors) {\r\n            if (!isCellWalkable(k, next.gx, next.gy, gridWidth, gridHeight)) {\r\n                continue;\r\n            }\r\n\r\n            // Diagonal movement costs more\r\n            const isDiagonal = next.gx !== current.gx && next.gy !== current.gy;\r\n            const moveCost = isDiagonal ? 1.4 : 1.0;\r\n            const newCost = costSoFar.get(getKey(current)) + moveCost;\r\n\r\n            const nextKey = getKey(next);\r\n            if (!costSoFar.has(nextKey) || newCost < costSoFar.get(nextKey)) {\r\n                costSoFar.set(nextKey, newCost);\r\n                const priority = newCost + heuristic(next, goal);\r\n                frontier.enqueue(next, priority);\r\n                cameFrom.set(nextKey, current);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Reconstruct path\r\n    const path = [];\r\n    let current = goal;\r\n\r\n    while (current && cameFrom.has(getKey(current))) {\r\n        const worldPos = gridToWorld(current.gx, current.gy);\r\n        path.unshift(worldPos);\r\n        current = cameFrom.get(getKey(current));\r\n\r\n        if (path.length > MAX_PATH_LENGTH) {\r\n            break; // Safety limit\r\n        }\r\n    }\r\n\r\n    return path;\r\n}\r\n\r\n/**\r\n * Get next move direction using A* pathfinding\r\n * Returns a vector for the next move\r\n */\r\nexport function getSmartMoveDirection(k, enemy, targetX, targetY) {\r\n    // Update path periodically or if we don't have one\r\n    if (!enemy.pathfindingPath || enemy.pathfindingTimer <= 0) {\r\n        enemy.pathfindingPath = findPath(k, enemy.pos.x, enemy.pos.y, targetX, targetY);\r\n        enemy.pathfindingTimer = 0.5; // Recalculate path every 0.5 seconds\r\n        enemy.pathfindingWaypointIndex = 0;\r\n    }\r\n\r\n    enemy.pathfindingTimer -= k.dt();\r\n\r\n    // If we have a path, follow it\r\n    if (enemy.pathfindingPath && enemy.pathfindingPath.length > 0) {\r\n        const waypoint = enemy.pathfindingPath[enemy.pathfindingWaypointIndex];\r\n\r\n        if (waypoint) {\r\n            const toWaypoint = k.vec2(\r\n                waypoint.x - enemy.pos.x,\r\n                waypoint.y - enemy.pos.y\r\n            );\r\n            const distanceToWaypoint = toWaypoint.len();\r\n\r\n            // Reached waypoint, move to next\r\n            if (distanceToWaypoint < GRID_SIZE / 2) {\r\n                enemy.pathfindingWaypointIndex++;\r\n\r\n                // Reached end of path, recalculate\r\n                if (enemy.pathfindingWaypointIndex >= enemy.pathfindingPath.length) {\r\n                    enemy.pathfindingPath = null;\r\n                    enemy.pathfindingTimer = 0;\r\n                }\r\n            }\r\n\r\n            // Move toward waypoint\r\n            if (distanceToWaypoint > 0) {\r\n                return toWaypoint.unit();\r\n            }\r\n        }\r\n    }\r\n\r\n    // No path available, move directly toward target (fallback)\r\n    const toTarget = k.vec2(targetX - enemy.pos.x, targetY - enemy.pos.y);\r\n    const distance = toTarget.len();\r\n    if (distance > 0) {\r\n        return toTarget.unit();\r\n    }\r\n\r\n    return k.vec2(0, 0);\r\n}\r\n\r\n/**\r\n * Get perimeter movement direction\r\n * Enemy walks around the edge of the map\r\n */\r\nexport function getPerimeterMoveDirection(k, enemy) {\r\n    const roomWidth = k.width();\r\n    const roomHeight = k.height();\r\n    const margin = 40; // Distance from edge\r\n\r\n    // Initialize perimeter mode if not set\r\n    if (!enemy.perimeterMode) {\r\n        enemy.perimeterMode = {\r\n            side: 'top', // top, right, bottom, left\r\n            targetX: enemy.pos.x,\r\n            targetY: margin\r\n        };\r\n    }\r\n\r\n    const perim = enemy.perimeterMode;\r\n    const speed = enemy.speed * k.dt();\r\n    const threshold = 20; // Distance to target before switching sides\r\n\r\n    // Calculate distance to current target\r\n    const toTarget = k.vec2(perim.targetX - enemy.pos.x, perim.targetY - enemy.pos.y);\r\n    const distanceToTarget = toTarget.len();\r\n\r\n    // Reached target, switch to next side\r\n    if (distanceToTarget < threshold) {\r\n        switch (perim.side) {\r\n            case 'top':\r\n                perim.side = 'right';\r\n                perim.targetX = roomWidth - margin;\r\n                perim.targetY = margin;\r\n                break;\r\n            case 'right':\r\n                perim.side = 'bottom';\r\n                perim.targetX = roomWidth - margin;\r\n                perim.targetY = roomHeight - margin;\r\n                break;\r\n            case 'bottom':\r\n                perim.side = 'left';\r\n                perim.targetX = margin;\r\n                perim.targetY = roomHeight - margin;\r\n                break;\r\n            case 'left':\r\n                perim.side = 'top';\r\n                perim.targetX = margin;\r\n                perim.targetY = margin;\r\n                break;\r\n        }\r\n    }\r\n\r\n    // Move toward target\r\n    if (distanceToTarget > 0) {\r\n        return toTarget.unit();\r\n    }\r\n\r\n    return k.vec2(0, 0);\r\n}\r\n","/**\r\n * Enemy Entity\r\n *\r\n * Creates and manages enemy entities with 21 different types:\r\n * - Basic, Rusher, Sniper, Tank, Healer, etc.\r\n * - Behavior patterns: rush, shoot, explode, teleport, heal\r\n * - Health bars for visual feedback\r\n * - Floor-based stat scaling\r\n * - Death handling and cleanup\r\n */\r\n\r\n// Entity imports\r\nimport { createProjectile } from './projectile.js';\r\n\r\n// Data imports\r\nimport { getEnemyDefinition } from '../data/enemies.js';\r\n\r\n// System imports\r\nimport { getSmartMoveDirection, getPerimeterMoveDirection } from '../systems/pathfinding.js';\r\nimport { registerEnemy, isHost, isMultiplayerActive, broadcastEnemySplit, broadcastDeathEvent } from '../systems/multiplayerGame.js';\r\n\r\nexport function createEnemy(k, x, y, type = 'basic', floor = 1, rng = null) {\r\n    const baseConfig = getEnemyDefinition(type);\r\n    \r\n    // Scale stats based on floor\r\n    const floorMultiplier = 1 + (floor - 1) * 0.3; // 30% increase per floor\r\n    const config = {\r\n        char: baseConfig.char,\r\n        color: baseConfig.color,\r\n        health: Math.floor(baseConfig.baseHealth * floorMultiplier),\r\n        speed: Math.floor(baseConfig.baseSpeed * (1 + (floor - 1) * 0.1)), // 10% speed increase per floor\r\n        size: baseConfig.size,\r\n        xpValue: Math.floor(baseConfig.baseXPValue * floorMultiplier),\r\n        behavior: baseConfig.behavior\r\n    };\r\n    \r\n    // Build visual representation (will be updated if armor/shields exist)\r\n    // Note: Floor-based bonuses calculated later, so initial visual is just base character\r\n    function getEnemyVisual() {\r\n        return config.char;\r\n    }\r\n    \r\n    const enemy = k.add([\r\n        k.text(getEnemyVisual(), { size: config.size }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...config.color),\r\n        k.area(),\r\n        k.health(config.health),\r\n        'enemy'\r\n    ]);\r\n    \r\n    // Store original color for later use\r\n    enemy.originalColor = config.color;\r\n\r\n    enemy.maxHealth = config.health;\r\n    enemy.speed = config.speed;\r\n    enemy.xpValue = config.xpValue;\r\n    enemy.type = type;\r\n    enemy.behavior = config.behavior;\r\n    enemy.floor = floor;\r\n    enemy.pathfindingMode = baseConfig.pathfindingMode || 'none'; // Pathfinding mode: 'none', 'smart', 'perimeter'\r\n    \r\n    // Store enemy-specific properties\r\n    if (baseConfig.damage) enemy.damage = baseConfig.damage;\r\n    if (baseConfig.fireRate) enemy.fireRate = baseConfig.fireRate;\r\n    if (baseConfig.projectileSpeed) enemy.projectileSpeed = baseConfig.projectileSpeed;\r\n    if (baseConfig.projectileDamage) enemy.projectileDamage = baseConfig.projectileDamage;\r\n    if (baseConfig.chargeCooldown) enemy.chargeCooldown = baseConfig.chargeCooldown;\r\n    if (baseConfig.splits) {\r\n        enemy.splits = true;\r\n        enemy.splitCount = baseConfig.splitCount || 2;\r\n        enemy.splitType = baseConfig.splitType || type; // Type to spawn on split (default: same type)\r\n    }\r\n    if (baseConfig.explodes) {\r\n        enemy.explodes = true;\r\n        enemy.explosionDamage = baseConfig.explosionDamage;\r\n        enemy.explosionRadius = baseConfig.explosionRadius;\r\n        if (baseConfig.shrapnel) {\r\n            enemy.shrapnel = true;\r\n            enemy.shrapnelCount = baseConfig.shrapnelCount || 8;\r\n        }\r\n    }\r\n    \r\n    // Floor-based armor/shield scaling\r\n    // Floor 1: No armor/shields\r\n    // Floor 2: Some enemies get armor\r\n    // Floor 3: More enemies get armor, some get shields\r\n    // Floor 4+: Mix of armor and shields, some get both\r\n    \r\n    // Calculate floor-based armor/shield bonuses\r\n    let floorArmorBonus = 0;\r\n    let floorShieldBonus = 0;\r\n    let floorShieldRegen = 0;\r\n    \r\n    if (floor >= 2) {\r\n        // Floor 2+: Some enemies get armor (30% chance, or specific types)\r\n        // Use seeded RNG if provided, fall back to Math.random() for backwards compatibility\r\n        const armorRoll = rng ? rng.next() : Math.random();\r\n        if (floor >= 2 && (type === 'zombie' || type === 'turret' || type === 'heavyTank' || armorRoll < 0.3)) {\r\n            floorArmorBonus = Math.floor(15 + (floor - 2) * 5); // 15 base, +5 per floor\r\n        }\r\n    }\r\n\r\n    if (floor >= 3) {\r\n        // Floor 3+: Some enemies get shields (20% chance, or specific types)\r\n        // Use seeded RNG if provided, fall back to Math.random() for backwards compatibility\r\n        const shieldRoll = rng ? rng.next() : Math.random();\r\n        if (type === 'shooter' || type === 'turret' || type === 'wraith' || shieldRoll < 0.2) {\r\n            floorShieldBonus = Math.floor(10 + (floor - 3) * 5); // 10 base, +5 per floor\r\n            floorShieldRegen = 1 + (floor - 3) * 0.5; // 1 HP/sec base, +0.5 per floor\r\n        }\r\n    }\r\n\r\n    if (floor >= 4) {\r\n        // Floor 4+: Some enemies get both armor and shields (10% chance, or specific types)\r\n        // Use seeded RNG if provided, fall back to Math.random() for backwards compatibility\r\n        const bothRoll = rng ? rng.next() : Math.random();\r\n        if (type === 'heavyTank' || type === 'spawner' || bothRoll < 0.1) {\r\n            if (floorArmorBonus === 0) floorArmorBonus = Math.floor(20 + (floor - 4) * 5);\r\n            if (floorShieldBonus === 0) {\r\n                floorShieldBonus = Math.floor(15 + (floor - 4) * 5);\r\n                floorShieldRegen = 1.5 + (floor - 4) * 0.5;\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Armor properties (base + floor bonus)\r\n    const totalBaseArmor = (baseConfig.baseArmorHealth || 0) + floorArmorBonus;\r\n    enemy.armorHealth = Math.floor(totalBaseArmor * floorMultiplier);\r\n    enemy.maxArmorHealth = Math.floor(totalBaseArmor * floorMultiplier);\r\n    enemy.damageReduction = baseConfig.damageReduction || (totalBaseArmor > 0 ? 0.2 : 0); // 20% reduction if has armor\r\n    enemy.armorChar = baseConfig.armorChar || '[]'; // Changed from () to []\r\n    enemy.armorColor = baseConfig.armorColor || [200, 200, 200];\r\n    \r\n    // Shield properties (base + floor bonus)\r\n    const totalBaseShield = (baseConfig.baseShieldHealth || 0) + floorShieldBonus;\r\n    enemy.shieldHealth = Math.floor(totalBaseShield * floorMultiplier);\r\n    enemy.maxShieldHealth = Math.floor(totalBaseShield * floorMultiplier);\r\n    enemy.shieldRegenRate = ((baseConfig.shieldRegenRate || 0) + floorShieldRegen) * floorMultiplier;\r\n    enemy.shieldChar = baseConfig.shieldChar || '{}';\r\n    enemy.shieldColor = baseConfig.shieldColor || [100, 200, 255];\r\n    enemy.shieldRegenTimer = 0;\r\n    enemy.shieldRegenCooldown = 0; // Cooldown after taking damage (prevents regen)\r\n    enemy.lastDamageTime = 0; // Track when last damaged\r\n    \r\n    // Store original color for visual updates\r\n    enemy.originalColor = config.color;\r\n    enemy.coreChar = config.char;\r\n    \r\n    // Function to update visual representation (for armor/shield changes)\r\n    enemy.updateVisual = function() {\r\n        // Priority: Shields > Armor > Core\r\n        let leftShield = '';\r\n        let rightShield = '';\r\n        let leftArmor = '';\r\n        let rightArmor = '';\r\n        \r\n        // Shields take priority (outermost layer)\r\n        // Size scales with health: Full =  , Medium =  , Low =  \r\n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\r\n        if (enemy.shieldHealth > 0) {\r\n            const shieldPercent = enemy.shieldHealth / enemy.maxShieldHealth;\r\n            \r\n            if (shieldPercent > 0.66) {\r\n                // Full shield (66-100%): Double brackets   (mathematical double brackets)\r\n                leftShield = '';\r\n                rightShield = '';\r\n            } else if (shieldPercent > 0.33) {\r\n                // Medium shield (33-66%): Left/right white parenthesis  \r\n                leftShield = '';\r\n                rightShield = '';\r\n            } else {\r\n                // Low shield (0-33%): Left/right angle brackets  \r\n                leftShield = '';\r\n                rightShield = '';\r\n            }\r\n        }\r\n        \r\n        // Armor (middle layer, can appear with shields: {[E]})\r\n        // Size scales with health: Full =  , Medium =  , Low =  \r\n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\r\n        if (enemy.armorHealth > 0) {\r\n            const armorPercent = enemy.armorHealth / enemy.maxArmorHealth;\r\n            \r\n            if (armorPercent > 0.66) {\r\n                // Full armor (66-100%): Double brackets   (mathematical double brackets)\r\n                leftArmor = '';\r\n                rightArmor = '';\r\n            } else if (armorPercent > 0.33) {\r\n                // Medium armor (33-66%): Left/right angle brackets  \r\n                leftArmor = '';\r\n                rightArmor = '';\r\n            } else {\r\n                // Low armor (0-33%): Left/right double angle brackets  \r\n                leftArmor = '';\r\n                rightArmor = '';\r\n            }\r\n        }\r\n        \r\n        // Visual format: {[E]} (shields outside, armor inside)\r\n        const visual = `${leftShield}${leftArmor}${enemy.coreChar}${rightArmor}${rightShield}`;\r\n        \r\n        // Update text component\r\n        enemy.text = visual;\r\n        \r\n        // Update color - use shield color if shields exist, otherwise original color\r\n        if (enemy.shieldHealth > 0) {\r\n            enemy.color = k.rgb(...enemy.shieldColor);\r\n        } else {\r\n            enemy.color = k.rgb(...enemy.originalColor);\r\n        }\r\n    };\r\n    \r\n    // Function to take damage (handles shields, then armor, then health)\r\n    enemy.takeDamage = function(damage) {\r\n        let shieldChanged = false;\r\n        let armorChanged = false;\r\n        const previousShieldHealth = enemy.shieldHealth;\r\n        const previousArmorHealth = enemy.armorHealth;\r\n        \r\n        // Track damage time for shield regen cooldown\r\n        enemy.lastDamageTime = k.time();\r\n        const shieldRegenCooldownDuration = 3.0; // 3 seconds cooldown after taking damage\r\n        enemy.shieldRegenCooldown = shieldRegenCooldownDuration;\r\n        \r\n        // Priority: Shields > Armor > Health\r\n        // Shields take normal damage (no reduction)\r\n        if (enemy.shieldHealth > 0) {\r\n            const shieldDamage = Math.min(damage, enemy.shieldHealth);\r\n            enemy.shieldHealth = Math.max(0, enemy.shieldHealth - shieldDamage);\r\n            shieldChanged = (enemy.shieldHealth !== previousShieldHealth);\r\n            \r\n            // Remaining damage goes to armor/health\r\n            const remainingDamage = damage - shieldDamage;\r\n            if (remainingDamage > 0) {\r\n                enemy.takeDamageInternal(remainingDamage);\r\n            }\r\n        } else {\r\n            // No shields - damage goes to armor/health\r\n            enemy.takeDamageInternal(damage);\r\n        }\r\n        \r\n        armorChanged = (enemy.armorHealth !== previousArmorHealth);\r\n        \r\n        // Update visual when shields or armor change\r\n        if (shieldChanged || armorChanged) {\r\n            enemy.updateVisual();\r\n        }\r\n    };\r\n    \r\n    // Internal damage function (handles armor and health)\r\n    enemy.takeDamageInternal = function(damage) {\r\n        // If armor exists, armor takes reduced damage first\r\n        if (enemy.armorHealth > 0) {\r\n            // Apply damage reduction to armor damage\r\n            const reducedDamage = Math.floor(damage * (1 - enemy.damageReduction));\r\n            const armorDamage = Math.min(reducedDamage, enemy.armorHealth);\r\n            enemy.armorHealth = Math.max(0, enemy.armorHealth - armorDamage);\r\n            \r\n            // Remaining damage goes to enemy, but reduced if armor still exists\r\n            const remainingDamage = damage - reducedDamage;\r\n            if (remainingDamage > 0) {\r\n                // If armor still exists, apply damage reduction\r\n                // If armor is destroyed, remaining damage goes through at full\r\n                const damageMultiplier = enemy.armorHealth > 0 ? (1 - enemy.damageReduction) : 1;\r\n                const finalDamage = Math.floor(remainingDamage * damageMultiplier);\r\n                enemy.hurt(finalDamage);\r\n            }\r\n        } else {\r\n            // No armor - full damage\r\n            enemy.hurt(damage);\r\n        }\r\n    };\r\n    \r\n    if (baseConfig.blocksProjectiles) enemy.blocksProjectiles = true;\r\n    if (baseConfig.teleportCooldown) enemy.teleportCooldown = baseConfig.teleportCooldown;\r\n    if (baseConfig.teleportRange) enemy.teleportRange = baseConfig.teleportRange;\r\n    if (baseConfig.spawnInterval) enemy.spawnInterval = baseConfig.spawnInterval;\r\n    if (baseConfig.spawnType) enemy.spawnType = baseConfig.spawnType;\r\n    if (baseConfig.buffRadius) enemy.buffRadius = baseConfig.buffRadius;\r\n    \r\n    if (baseConfig.buffAmount) enemy.buffAmount = baseConfig.buffAmount;\r\n    if (baseConfig.healRadius) enemy.healRadius = baseConfig.healRadius;\r\n    if (baseConfig.healAmount) enemy.healAmount = baseConfig.healAmount;\r\n    if (baseConfig.healInterval) enemy.healInterval = baseConfig.healInterval;\r\n    if (baseConfig.slowRadius) enemy.slowRadius = baseConfig.slowRadius;\r\n    if (baseConfig.slowAmount) enemy.slowAmount = baseConfig.slowAmount;\r\n    if (baseConfig.lifesteal) enemy.lifesteal = baseConfig.lifesteal;\r\n\r\n    // New enemy properties\r\n    if (baseConfig.phaseOpacity) enemy.phaseOpacity = baseConfig.phaseOpacity;\r\n    if (baseConfig.phaseThroughObstacles) enemy.phaseThroughObstacles = baseConfig.phaseThroughObstacles;\r\n    if (baseConfig.mimicDuration) enemy.mimicDuration = baseConfig.mimicDuration;\r\n    if (baseConfig.mimicCooldown) enemy.mimicCooldown = baseConfig.mimicCooldown;\r\n    if (baseConfig.reflectsProjectiles) enemy.reflectsProjectiles = baseConfig.reflectsProjectiles;\r\n    if (baseConfig.reflectChance) enemy.reflectChance = baseConfig.reflectChance;\r\n    if (baseConfig.homingStrength) enemy.homingStrength = baseConfig.homingStrength;\r\n    if (baseConfig.bombExplosionRadius) enemy.bombExplosionRadius = baseConfig.bombExplosionRadius;\r\n    \r\n    // Initialize visual with armor/shields if they exist (after all properties are set)\r\n    enemy.updateVisual();\r\n    \r\n    // Initialize behavior-specific timers\r\n    enemy.attackTimer = 0;\r\n    enemy.chargeTimer = 0;\r\n    enemy.isCharging = false;\r\n    enemy.chargeDirection = null;\r\n    enemy.chargeDuration = 0;\r\n    enemy.chargePauseTimer = 0;\r\n    enemy.teleportTimer = 0;\r\n    enemy.spawnTimer = 0;\r\n    enemy.healTimer = 0;\r\n    enemy.buffedEnemies = new Set(); // Track which enemies are buffed by this buffer\r\n\r\n    // New behavior timers\r\n    enemy.mimicTimer = 0;\r\n    enemy.mimicMovementHistory = []; // Store player movement for mimic\r\n    enemy.isMimicking = false;\r\n    enemy.mimicMoveIndex = 0;\r\n\r\n    // Set phase opacity for phaser enemies (semi-transparent)\r\n    if (enemy.phaseOpacity) {\r\n        enemy.opacity = enemy.phaseOpacity;\r\n    }\r\n\r\n    // Obstacle avoidance state\r\n    enemy.stuckTimer = 0; // Track how long enemy has been stuck\r\n    enemy.stuckThreshold = 1.0; // Seconds before considered stuck\r\n    enemy.lastPosition = { x: x, y: y };\r\n    enemy.lastPositionUpdateTime = 0; // Track when last position was updated\r\n    enemy.avoidanceDirection = null; // Current avoidance direction\r\n    enemy.avoidanceTimer = 0; // How long to continue avoidance\r\n    \r\n    // Health bar components (only shown when health is low)\r\n    const healthBarWidth = 30;\r\n    const healthBarHeight = 3;\r\n    const healthBarOffset = -20; // Offset above enemy\r\n    \r\n    const healthBarBg = k.add([\r\n        k.rect(healthBarWidth, healthBarHeight),\r\n        k.pos(x, y + healthBarOffset),\r\n        k.anchor('center'),\r\n        k.color(50, 50, 50),\r\n        k.z(100),\r\n        'enemyHealthBar'\r\n    ]);\r\n    \r\n    const healthBar = k.add([\r\n        k.rect(healthBarWidth, healthBarHeight),\r\n        k.pos(x, y + healthBarOffset),\r\n        k.anchor('center'),\r\n        k.color(200, 200, 200), // Simple gray color\r\n        k.z(101),\r\n        'enemyHealthBar'\r\n    ]);\r\n    \r\n    // Link health bars to enemy\r\n    enemy.healthBarBg = healthBarBg;\r\n    enemy.healthBar = healthBar;\r\n    enemy.showHealthThreshold = 0.5; // Show health bar when below 50% health\r\n    \r\n    // Initially hide health bars\r\n    healthBarBg.hidden = true;\r\n    healthBar.hidden = true;\r\n\r\n    // AI based on behavior type\r\n    enemy.onUpdate(() => {\r\n        // Update health bar position and visibility\r\n        if (enemy.exists() && enemy.healthBar && enemy.healthBarBg) {\r\n            const healthPercent = enemy.hp() / enemy.maxHealth;\r\n            const shouldShow = healthPercent < enemy.showHealthThreshold && healthPercent > 0;\r\n            \r\n            if (shouldShow) {\r\n                // Show and update health bars\r\n                enemy.healthBarBg.hidden = false;\r\n                enemy.healthBar.hidden = false;\r\n                \r\n                // Update position\r\n                enemy.healthBarBg.pos.x = enemy.pos.x;\r\n                enemy.healthBarBg.pos.y = enemy.pos.y + healthBarOffset;\r\n                enemy.healthBar.pos.x = enemy.pos.x;\r\n                enemy.healthBar.pos.y = enemy.pos.y + healthBarOffset;\r\n                \r\n                // Update health bar width\r\n                const barWidth = healthBarWidth * healthPercent;\r\n                enemy.healthBar.width = Math.max(1, barWidth);\r\n                enemy.healthBar.pos.x = enemy.pos.x - (healthBarWidth - barWidth) / 2;\r\n            } else {\r\n                // Hide health bars\r\n                enemy.healthBarBg.hidden = true;\r\n                enemy.healthBar.hidden = true;\r\n            }\r\n        }\r\n    });\r\n    \r\n    // Cleanup function for health bars\r\n    enemy.cleanupHealthBars = function() {\r\n        if (enemy.healthBarBg && enemy.healthBarBg.exists()) {\r\n            k.destroy(enemy.healthBarBg);\r\n        }\r\n        if (enemy.healthBar && enemy.healthBar.exists()) {\r\n            k.destroy(enemy.healthBar);\r\n        }\r\n    };\r\n    \r\n    // Helper function to check if a position is clear of obstacles\r\n    const isPositionClear = (testX, testY) => {\r\n        const obstacles = k.get('obstacle');\r\n        const enemySize = enemy.size || 12;\r\n        \r\n        for (const obstacle of obstacles) {\r\n            if (!obstacle.exists()) continue;\r\n            \r\n            const obsLeft = obstacle.pos.x - obstacle.width / 2;\r\n            const obsRight = obstacle.pos.x + obstacle.width / 2;\r\n            const obsTop = obstacle.pos.y - obstacle.height / 2;\r\n            const obsBottom = obstacle.pos.y + obstacle.height / 2;\r\n            \r\n            const enemyLeft = testX - enemySize;\r\n            const enemyRight = testX + enemySize;\r\n            const enemyTop = testY - enemySize;\r\n            const enemyBottom = testY + enemySize;\r\n            \r\n            if (enemyRight > obsLeft && enemyLeft < obsRight &&\r\n                enemyBottom > obsTop && enemyTop < obsBottom) {\r\n                return false; // Collision detected\r\n            }\r\n        }\r\n        return true; // Position is clear\r\n    };\r\n    \r\n    // Obstacle avoidance function - tries to find a path around obstacles\r\n    const applyObstacleAvoidance = (desiredMove) => {\r\n        const moveSpeed = desiredMove.len();\r\n        const desiredDir = moveSpeed > 0 ? desiredMove.unit() : k.vec2(0, 0);\r\n        \r\n        // Update stuck detection\r\n        enemy.lastPositionUpdateTime += k.dt();\r\n        if (enemy.lastPositionUpdateTime >= 0.1) {\r\n            // Update last position every 0.1 seconds\r\n            const movedDistance = Math.sqrt(\r\n                Math.pow(enemy.pos.x - enemy.lastPosition.x, 2) +\r\n                Math.pow(enemy.pos.y - enemy.lastPosition.y, 2)\r\n            );\r\n            \r\n            if (movedDistance < 5) {\r\n                // Enemy hasn't moved much\r\n                enemy.stuckTimer += enemy.lastPositionUpdateTime;\r\n            } else {\r\n                // Enemy is moving, reset stuck timer\r\n                enemy.stuckTimer = 0;\r\n            }\r\n            \r\n            enemy.lastPosition = { x: enemy.pos.x, y: enemy.pos.y };\r\n            enemy.lastPositionUpdateTime = 0;\r\n        }\r\n        \r\n        // Check if desired position is clear\r\n        const newX = enemy.pos.x + desiredMove.x;\r\n        const newY = enemy.pos.y + desiredMove.y;\r\n        \r\n        if (isPositionClear(newX, newY)) {\r\n            // Desired path is clear - reset avoidance\r\n            enemy.avoidanceDirection = null;\r\n            enemy.avoidanceTimer = 0;\r\n            return desiredMove;\r\n        }\r\n        \r\n        // Movement is blocked - try obstacle avoidance\r\n        enemy.avoidanceTimer -= k.dt();\r\n        \r\n        // If stuck for too long or avoidance timer expired, try new direction\r\n        if (enemy.stuckTimer >= enemy.stuckThreshold || enemy.avoidanceTimer <= 0) {\r\n            // Try perpendicular directions to find a way around\r\n            const perpendicular1 = k.vec2(-desiredDir.y, desiredDir.x); // 90 degrees left\r\n            const perpendicular2 = k.vec2(desiredDir.y, -desiredDir.x); // 90 degrees right\r\n            \r\n            // Try multiple directions: perpendicular, diagonal, and slight variations\r\n            const testDirections = [\r\n                perpendicular1.scale(moveSpeed), // Left\r\n                perpendicular2.scale(moveSpeed), // Right\r\n                k.vec2(perpendicular1.x * 0.7 + desiredDir.x * 0.3, perpendicular1.y * 0.7 + desiredDir.y * 0.3).unit().scale(moveSpeed), // Diagonal left-forward\r\n                k.vec2(perpendicular2.x * 0.7 + desiredDir.x * 0.3, perpendicular2.y * 0.7 + desiredDir.y * 0.3).unit().scale(moveSpeed), // Diagonal right-forward\r\n                k.vec2(perpendicular1.x * 0.5 + desiredDir.x * 0.5, perpendicular1.y * 0.5 + desiredDir.y * 0.5).unit().scale(moveSpeed), // More forward-left\r\n                k.vec2(perpendicular2.x * 0.5 + desiredDir.x * 0.5, perpendicular2.y * 0.5 + desiredDir.y * 0.5).unit().scale(moveSpeed), // More forward-right\r\n            ];\r\n            \r\n            // Find first clear direction\r\n            for (const testDir of testDirections) {\r\n                const testX = enemy.pos.x + testDir.x;\r\n                const testY = enemy.pos.y + testDir.y;\r\n                if (isPositionClear(testX, testY)) {\r\n                    enemy.avoidanceDirection = k.vec2(testDir.x, testDir.y).unit();\r\n                    enemy.avoidanceTimer = 0.8; // Continue avoidance for 0.8 seconds\r\n                    return testDir;\r\n                }\r\n            }\r\n            \r\n            // No clear path found - try moving in avoidance direction if we have one\r\n            if (enemy.avoidanceDirection) {\r\n                const avoidMove = enemy.avoidanceDirection.scale(moveSpeed);\r\n                const avoidX = enemy.pos.x + avoidMove.x;\r\n                const avoidY = enemy.pos.y + avoidMove.y;\r\n                if (isPositionClear(avoidX, avoidY)) {\r\n                    return avoidMove;\r\n                }\r\n            }\r\n            \r\n            // Still stuck - try partial movement (X or Y only)\r\n            if (isPositionClear(newX, enemy.pos.y)) {\r\n                return k.vec2(desiredMove.x, 0);\r\n            } else if (isPositionClear(enemy.pos.x, newY)) {\r\n                return k.vec2(0, desiredMove.y);\r\n            }\r\n            \r\n            // Completely blocked\r\n            return k.vec2(0, 0);\r\n        } else if (enemy.avoidanceDirection) {\r\n            // Continue in avoidance direction\r\n            const avoidMove = enemy.avoidanceDirection.scale(moveSpeed);\r\n            const avoidX = enemy.pos.x + avoidMove.x;\r\n            const avoidY = enemy.pos.y + avoidMove.y;\r\n            if (isPositionClear(avoidX, avoidY)) {\r\n                return avoidMove;\r\n            } else {\r\n                // Avoidance direction blocked, reset\r\n                enemy.avoidanceDirection = null;\r\n                enemy.avoidanceTimer = 0;\r\n            }\r\n        }\r\n        \r\n        // Fallback: try partial movement\r\n        if (isPositionClear(newX, enemy.pos.y)) {\r\n            return k.vec2(desiredMove.x, 0);\r\n        } else if (isPositionClear(enemy.pos.x, newY)) {\r\n            return k.vec2(0, desiredMove.y);\r\n        }\r\n        \r\n        // Completely blocked\r\n        return k.vec2(0, 0);\r\n    };\r\n    \r\n    enemy.onUpdate(() => {\r\n        if (k.paused) return;\r\n        \r\n        // Shield regeneration (if shields exist and regen rate > 0)\r\n        // Only regen if cooldown has expired (not damaged recently) and enemy is alive\r\n        // Host-authoritative in multiplayer to prevent desync from frame rate differences\r\n        if (enemy.shieldRegenRate > 0 && enemy.shieldHealth < enemy.maxShieldHealth && enemy.hp() > 0 && !enemy.isDead) {\r\n            // Only process shield regen on host (or in single player)\r\n            if (!isMultiplayerActive() || isHost()) {\r\n                // Update cooldown timer\r\n                if (enemy.shieldRegenCooldown > 0) {\r\n                    enemy.shieldRegenCooldown -= k.dt();\r\n                }\r\n\r\n                // Only regenerate if cooldown has expired\r\n                if (enemy.shieldRegenCooldown <= 0) {\r\n                    enemy.shieldRegenTimer += k.dt();\r\n                    const regenInterval = 1.0; // Regenerate every second\r\n\r\n                    if (enemy.shieldRegenTimer >= regenInterval) {\r\n                        const regenAmount = enemy.shieldRegenRate * regenInterval;\r\n                        enemy.shieldHealth = Math.min(enemy.maxShieldHealth, enemy.shieldHealth + regenAmount);\r\n                        enemy.shieldRegenTimer = 0;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Update visual on all clients (synced via game_state)\r\n            if (enemy.shieldHealth > 0 && enemy.updateVisual) {\r\n                enemy.updateVisual();\r\n            }\r\n        }\r\n\r\n        // Process burn DoT (Damage over Time) from flamethrower\r\n        if (enemy.burnDuration > 0 && enemy.hp() > 0 && !enemy.isDead) {\r\n            enemy.burnTimer = (enemy.burnTimer || 0) + k.dt();\r\n            const burnTickInterval = 0.5; // Deal burn damage every 0.5 seconds\r\n\r\n            if (enemy.burnTimer >= burnTickInterval) {\r\n                // In multiplayer, only host deals burn damage\r\n                if (!isMultiplayerActive() || isHost()) {\r\n                    // Deal burn damage\r\n                    if (enemy.takeDamage) {\r\n                        enemy.takeDamage(enemy.burnDamage);\r\n                    } else {\r\n                        enemy.hurt(enemy.burnDamage);\r\n                    }\r\n                }\r\n\r\n                // Visual feedback for burn damage (orange tint) on all clients\r\n                enemy.color = k.rgb(255, 150, 50);\r\n                k.wait(0.1, () => {\r\n                    if (enemy.exists()) {\r\n                        enemy.color = k.rgb(...enemy.originalColor);\r\n                    }\r\n                });\r\n\r\n                enemy.burnTimer = 0;\r\n            }\r\n\r\n            // Decrease burn duration\r\n            enemy.burnDuration -= k.dt();\r\n            if (enemy.burnDuration <= 0) {\r\n                enemy.burnDamage = 0;\r\n                enemy.burnTimer = 0;\r\n            }\r\n        }\r\n\r\n        // Find nearest alive player (support multiplayer)\r\n        // Use cached alivePlayers from gameData for performance (updated each frame in game.js)\r\n        const alivePlayers = k.gameData?.alivePlayers || k.get('player').filter(p => p.exists() && !p.isDead && p.hp() > 0);\r\n\r\n        if (alivePlayers.length === 0) return; // No alive players to target\r\n\r\n        // Find closest alive player\r\n        let player = alivePlayers[0];\r\n        let minDistance = Math.sqrt(\r\n            Math.pow(player.pos.x - enemy.pos.x, 2) +\r\n            Math.pow(player.pos.y - enemy.pos.y, 2)\r\n        );\r\n\r\n        for (let i = 1; i < alivePlayers.length; i++) {\r\n            const p = alivePlayers[i];\r\n            const d = Math.sqrt(\r\n                Math.pow(p.pos.x - enemy.pos.x, 2) +\r\n                Math.pow(p.pos.y - enemy.pos.y, 2)\r\n            );\r\n            if (d < minDistance) {\r\n                minDistance = d;\r\n                player = p;\r\n            }\r\n        }\r\n\r\n        const dir = k.vec2(\r\n            player.pos.x - enemy.pos.x,\r\n            player.pos.y - enemy.pos.y\r\n        );\r\n        const distance = dir.len();\r\n        \r\n        // Behavior-specific AI\r\n        if (enemy.behavior === 'turret') {\r\n            // Turret: Stationary, just fires projectiles\r\n            enemy.attackTimer += k.dt();\r\n            if (distance > 0 && enemy.attackTimer >= 1 / enemy.fireRate) {\r\n                const direction = dir.unit();\r\n                const projectile = createProjectile(\r\n                    k,\r\n                    enemy.pos.x,\r\n                    enemy.pos.y,\r\n                    direction,\r\n                    enemy.projectileSpeed,\r\n                    enemy.projectileDamage,\r\n                    0, // piercing\r\n                    0, // obstaclePiercing\r\n                    false // isCrit\r\n                );\r\n                projectile.isEnemyProjectile = true;\r\n                projectile.color = k.rgb(...enemy.originalColor);\r\n                enemy.attackTimer = 0;\r\n            }\r\n            return; // Turrets don't move\r\n        }\r\n        \r\n        if (enemy.behavior === 'shoot') {\r\n            // Shooter: Maintains distance, fires projectiles\r\n            enemy.attackTimer += k.dt();\r\n            \r\n            // Movement: try to maintain distance\r\n            const preferredDistance = 150;\r\n            let moveAmount = k.vec2(0, 0);\r\n            \r\n            if (distance > preferredDistance * 1.2) {\r\n                // Too far, move closer\r\n                moveAmount = dir.unit().scale(enemy.speed * k.dt());\r\n            } else if (distance < preferredDistance * 0.8) {\r\n                // Too close, move away\r\n                moveAmount = dir.unit().scale(-enemy.speed * k.dt());\r\n            }\r\n            \r\n            // Fire projectiles\r\n            if (distance > 0 && enemy.attackTimer >= 1 / enemy.fireRate) {\r\n                const direction = dir.unit();\r\n                const projectile = createProjectile(\r\n                    k,\r\n                    enemy.pos.x,\r\n                    enemy.pos.y,\r\n                    direction,\r\n                    enemy.projectileSpeed,\r\n                    enemy.projectileDamage,\r\n                    0,\r\n                    0,\r\n                    false\r\n                );\r\n                projectile.isEnemyProjectile = true;\r\n                projectile.color = k.rgb(...enemy.originalColor);\r\n                enemy.attackTimer = 0;\r\n            }\r\n            \r\n            // Apply movement with obstacle avoidance\r\n            if (moveAmount.len() > 0) {\r\n                const finalMove = applyObstacleAvoidance(moveAmount);\r\n                enemy.pos.x += finalMove.x;\r\n                enemy.pos.y += finalMove.y;\r\n\r\n                // Keep in bounds (prevent backpedaling off screen)\r\n                const margin = 20;\r\n                const enemySize = enemy.size || 12;\r\n                enemy.pos.x = k.clamp(enemy.pos.x, margin + enemySize, k.width() - margin - enemySize);\r\n                enemy.pos.y = k.clamp(enemy.pos.y, margin + enemySize, k.height() - margin - enemySize);\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (enemy.behavior === 'charge') {\r\n            // Charger: Charges in straight line, then pauses\r\n            enemy.chargeTimer += k.dt();\r\n            \r\n            if (enemy.isCharging) {\r\n                // Currently charging\r\n                enemy.chargeDuration += k.dt();\r\n                const chargeTime = 0.8; // Charge for 0.8 seconds\r\n                \r\n                if (enemy.chargeDuration >= chargeTime) {\r\n                    // Stop charging, start pause\r\n                    enemy.isCharging = false;\r\n                    enemy.chargeDuration = 0;\r\n                    enemy.chargePauseTimer = 0;\r\n                } else {\r\n                    // Continue charging - use obstacle avoidance but prefer straight line\r\n                    const chargeMove = enemy.chargeDirection.scale(enemy.speed * k.dt());\r\n                    const finalMove = applyObstacleAvoidance(chargeMove);\r\n                    // If heavily blocked, stop charging\r\n                    if (finalMove.len() < chargeMove.len() * 0.3) {\r\n                        enemy.isCharging = false;\r\n                        enemy.chargePauseTimer = 0.1;\r\n                    } else {\r\n                        enemy.pos.x += finalMove.x;\r\n                        enemy.pos.y += finalMove.y;\r\n                    }\r\n                }\r\n            } else {\r\n                // Not charging - normal movement or pause\r\n                if (enemy.chargePauseTimer > 0) {\r\n                    // Pausing after charge\r\n                    enemy.chargePauseTimer += k.dt();\r\n                    if (enemy.chargePauseTimer >= 1.0) {\r\n                        enemy.chargePauseTimer = 0;\r\n                        enemy.chargeTimer = 0; // Reset cooldown\r\n                    }\r\n                } else if (enemy.chargeTimer >= enemy.chargeCooldown) {\r\n                    // Ready to charge - telegraph and charge\r\n                    enemy.color = k.rgb(255, 255, 0); // Yellow telegraph\r\n                    k.wait(0.2, () => {\r\n                        if (enemy.exists()) {\r\n                            enemy.color = k.rgb(...enemy.originalColor);\r\n                            if (distance > 0) {\r\n                                enemy.isCharging = true;\r\n                                enemy.chargeDirection = dir.unit();\r\n                                enemy.chargeDuration = 0;\r\n                            }\r\n                        }\r\n                    });\r\n                    enemy.chargeTimer = 0;\r\n                } else {\r\n                    // Normal movement toward player\r\n                    const normalized = dir.unit();\r\n                    const desiredMove = normalized.scale(enemy.speed * 0.5 * k.dt()); // Slower when not charging\r\n                    const finalMove = applyObstacleAvoidance(desiredMove);\r\n                    \r\n                    // If movement is blocked, stop charging\r\n                    if (finalMove.len() < desiredMove.len() * 0.5 && enemy.isCharging) {\r\n                        enemy.isCharging = false;\r\n                        enemy.chargePauseTimer = 0.1; // Start pause\r\n                    }\r\n                    \r\n                    enemy.pos.x += finalMove.x;\r\n                    enemy.pos.y += finalMove.y;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (enemy.behavior === 'erratic') {\r\n            // Erratic: Fast, unpredictable movement (Bat, Zippy)\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                // Add jitter for unpredictability\r\n                const jitter = k.vec2(\r\n                    (Math.random() - 0.5) * 0.4,\r\n                    (Math.random() - 0.5) * 0.4\r\n                );\r\n                const moveDir = k.vec2(\r\n                    normalized.x + jitter.x,\r\n                    normalized.y + jitter.y\r\n                ).unit();\r\n                const desiredMove = moveDir.scale(enemy.speed * k.dt());\r\n                const finalMove = applyObstacleAvoidance(desiredMove);\r\n                enemy.pos.x += finalMove.x;\r\n                enemy.pos.y += finalMove.y;\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (enemy.behavior === 'shield') {\r\n            // Shield Bearer: High health, blocks projectiles from front (simplified - just high health for now)\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\r\n                const finalMove = applyObstacleAvoidance(desiredMove);\r\n                enemy.pos.x += finalMove.x;\r\n                enemy.pos.y += finalMove.y;\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (enemy.behavior === 'teleport') {\r\n            // Wraith: Teleports periodically\r\n            enemy.teleportTimer += k.dt();\r\n            \r\n            if (enemy.teleportTimer >= enemy.teleportCooldown && distance > 0) {\r\n                // Teleport toward player\r\n                const teleportDir = dir.unit();\r\n                const teleportPos = k.vec2(\r\n                    enemy.pos.x + teleportDir.x * enemy.teleportRange,\r\n                    enemy.pos.y + teleportDir.y * enemy.teleportRange\r\n                );\r\n                \r\n                // Check if teleport position is clear\r\n                if (isPositionClear(teleportPos.x, teleportPos.y)) {\r\n                    enemy.pos.x = teleportPos.x;\r\n                    enemy.pos.y = teleportPos.y;\r\n                    enemy.teleportTimer = 0;\r\n                    \r\n                    // Visual effect\r\n                    enemy.color = k.rgb(255, 255, 255);\r\n                    k.wait(0.1, () => {\r\n                        if (enemy.exists()) {\r\n                            enemy.color = k.rgb(...enemy.originalColor);\r\n                        }\r\n                    });\r\n                }\r\n            } else {\r\n                // Normal movement\r\n                if (distance > 0) {\r\n                    const normalized = dir.unit();\r\n                    const desiredMove = normalized.scale(enemy.speed * k.dt());\r\n                    const finalMove = applyObstacleAvoidance(desiredMove);\r\n                    enemy.pos.x += finalMove.x;\r\n                    enemy.pos.y += finalMove.y;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (enemy.behavior === 'spawner') {\r\n            // Spawner: Periodically spawns minions\r\n            enemy.spawnTimer += k.dt();\r\n            \r\n            if (enemy.spawnTimer >= enemy.spawnInterval) {\r\n                // Spawn minion\r\n                const spawnAngle = Math.random() * Math.PI * 2;\r\n                const spawnDistance = 30;\r\n                const spawnX = enemy.pos.x + Math.cos(spawnAngle) * spawnDistance;\r\n                const spawnY = enemy.pos.y + Math.sin(spawnAngle) * spawnDistance;\r\n                \r\n                if (isPositionClear(spawnX, spawnY)) {\r\n                    const minion = createEnemy(k, spawnX, spawnY, enemy.spawnType || 'rusher', enemy.floor);\r\n                    minion.isBossMinion = true; // Mark as minion\r\n                    enemy.spawnTimer = 0;\r\n                }\r\n            }\r\n            \r\n            // Normal movement (slow)\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\r\n                const finalMove = applyObstacleAvoidance(desiredMove);\r\n                enemy.pos.x += finalMove.x;\r\n                enemy.pos.y += finalMove.y;\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (enemy.behavior === 'buffer') {\r\n            // Buffer: Buffs nearby enemies\r\n            enemy.attackTimer += k.dt();\r\n            \r\n            if (enemy.attackTimer >= 1.0) { // Check every second\r\n                const nearbyEnemies = k.get('enemy');\r\n                for (const otherEnemy of nearbyEnemies) {\r\n                    if (!otherEnemy.exists() || otherEnemy === enemy) continue;\r\n                    \r\n                    const buffDir = k.vec2(\r\n                        otherEnemy.pos.x - enemy.pos.x,\r\n                        otherEnemy.pos.y - enemy.pos.y\r\n                    );\r\n                    const buffDistance = buffDir.len();\r\n                    \r\n                    if (buffDistance <= enemy.buffRadius) {\r\n                        // Buff this enemy\r\n                        if (!otherEnemy.buffed) {\r\n                            otherEnemy.buffed = true;\r\n                            otherEnemy.originalSpeed = otherEnemy.speed;\r\n                            otherEnemy.originalDamage = otherEnemy.damage || 10;\r\n                        }\r\n                        otherEnemy.speed = otherEnemy.originalSpeed * (1 + enemy.buffAmount);\r\n                        otherEnemy.damage = otherEnemy.originalDamage * (1 + enemy.buffAmount);\r\n                        enemy.buffedEnemies.add(otherEnemy);\r\n                    } else if (enemy.buffedEnemies.has(otherEnemy)) {\r\n                        // Remove buff if out of range\r\n                        if (otherEnemy.buffed) {\r\n                            otherEnemy.speed = otherEnemy.originalSpeed;\r\n                            otherEnemy.damage = otherEnemy.originalDamage;\r\n                            otherEnemy.buffed = false;\r\n                        }\r\n                        enemy.buffedEnemies.delete(otherEnemy);\r\n                    }\r\n                }\r\n                enemy.attackTimer = 0;\r\n            }\r\n            \r\n            // Normal movement\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\r\n                const finalMove = applyObstacleAvoidance(desiredMove);\r\n                enemy.pos.x += finalMove.x;\r\n                enemy.pos.y += finalMove.y;\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (enemy.behavior === 'healer') {\r\n            // Healer: Heals nearby enemies\r\n            enemy.healTimer += k.dt();\r\n            \r\n            if (enemy.healTimer >= enemy.healInterval) {\r\n                const nearbyEnemies = k.get('enemy');\r\n                for (const otherEnemy of nearbyEnemies) {\r\n                    if (!otherEnemy.exists() || otherEnemy === enemy) continue;\r\n                    \r\n                    const healDir = k.vec2(\r\n                        otherEnemy.pos.x - enemy.pos.x,\r\n                        otherEnemy.pos.y - enemy.pos.y\r\n                    );\r\n                    const healDistance = healDir.len();\r\n                    \r\n                    if (healDistance <= enemy.healRadius) {\r\n                        // Heal this enemy\r\n                        const currentHP = otherEnemy.hp();\r\n                        const maxHP = otherEnemy.maxHealth;\r\n                        if (currentHP < maxHP) {\r\n                            const newHP = Math.min(maxHP, currentHP + enemy.healAmount);\r\n                            otherEnemy.setHP(newHP);\r\n                            \r\n                            // Visual effect\r\n                            const healText = k.add([\r\n                                k.text('+', { size: 16 }),\r\n                                k.pos(otherEnemy.pos.x, otherEnemy.pos.y - 20),\r\n                                k.anchor('center'),\r\n                                k.color(100, 255, 100),\r\n                                k.z(200)\r\n                            ]);\r\n                            k.wait(0.5, () => {\r\n                                if (healText.exists()) k.destroy(healText);\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                enemy.healTimer = 0;\r\n            }\r\n            \r\n            // Normal movement\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\r\n                const finalMove = applyObstacleAvoidance(desiredMove);\r\n                enemy.pos.x += finalMove.x;\r\n                enemy.pos.y += finalMove.y;\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (enemy.behavior === 'teleportPlayer') {\r\n            // Teleporter: Teleports player when close\r\n            enemy.teleportTimer += k.dt();\r\n            \r\n            if (enemy.teleportTimer >= enemy.teleportCooldown && distance <= 80) {\r\n                // Teleport player to random location\r\n                const teleportAngle = Math.random() * Math.PI * 2;\r\n                const teleportX = player.pos.x + Math.cos(teleportAngle) * enemy.teleportRange;\r\n                const teleportY = player.pos.y + Math.sin(teleportAngle) * enemy.teleportRange;\r\n                \r\n                // Clamp to screen bounds\r\n                const clampedX = Math.max(50, Math.min(k.width() - 50, teleportX));\r\n                const clampedY = Math.max(50, Math.min(k.height() - 50, teleportY));\r\n                \r\n                player.pos.x = clampedX;\r\n                player.pos.y = clampedY;\r\n                enemy.teleportTimer = 0;\r\n                \r\n                // Visual effect\r\n                const teleportText = k.add([\r\n                    k.text('!', { size: 24 }),\r\n                    k.pos(player.pos.x, player.pos.y),\r\n                    k.anchor('center'),\r\n                    k.color(255, 200, 0),\r\n                    k.z(200)\r\n                ]);\r\n                k.wait(0.3, () => {\r\n                    if (teleportText.exists()) k.destroy(teleportText);\r\n                });\r\n            }\r\n            \r\n            // Normal movement\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\r\n                const finalMove = applyObstacleAvoidance(desiredMove);\r\n                enemy.pos.x += finalMove.x;\r\n                enemy.pos.y += finalMove.y;\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (enemy.behavior === 'freeze') {\r\n            // Freezer: Slows player when nearby\r\n            if (distance <= enemy.slowRadius) {\r\n                if (!player.slowed) {\r\n                    player.slowed = true;\r\n                    player.originalSpeed = player.speed;\r\n                }\r\n                player.speed = player.originalSpeed * (1 - enemy.slowAmount);\r\n            } else {\r\n                if (player.slowed) {\r\n                    player.speed = player.originalSpeed;\r\n                    player.slowed = false;\r\n                }\r\n            }\r\n            \r\n            // Normal movement\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\r\n                const finalMove = applyObstacleAvoidance(desiredMove);\r\n                enemy.pos.x += finalMove.x;\r\n                enemy.pos.y += finalMove.y;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (enemy.behavior === 'phase') {\r\n            // Phaser: Moves directly toward player, ignoring obstacles (semi-transparent)\r\n            // But still respect room boundaries to prevent getting stuck outside playable area\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                // No obstacle avoidance - phase through everything\r\n                enemy.pos.x += normalized.x * enemy.speed * k.dt();\r\n                enemy.pos.y += normalized.y * enemy.speed * k.dt();\r\n\r\n                // Keep phaser in bounds (important - phasers can't escape room boundaries)\r\n                const roomWidth = k.width();\r\n                const roomHeight = k.height();\r\n                const margin = 20;\r\n                const enemySize = enemy.size || 12;\r\n                enemy.pos.x = k.clamp(enemy.pos.x, margin + enemySize, roomWidth - margin - enemySize);\r\n                enemy.pos.y = k.clamp(enemy.pos.y, margin + enemySize, roomHeight - margin - enemySize);\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (enemy.behavior === 'mimic') {\r\n            // Mimic: Records player movement, then replays it\r\n            enemy.mimicTimer += k.dt();\r\n\r\n            if (enemy.isMimicking) {\r\n                // Currently mimicking - replay stored movements\r\n                if (enemy.mimicMoveIndex < enemy.mimicMovementHistory.length) {\r\n                    const move = enemy.mimicMovementHistory[enemy.mimicMoveIndex];\r\n                    const desiredMove = k.vec2(move.x * k.dt() * 60, move.y * k.dt() * 60); // Scale for deltatime\r\n                    const finalMove = applyObstacleAvoidance(desiredMove);\r\n                    enemy.pos.x += finalMove.x;\r\n                    enemy.pos.y += finalMove.y;\r\n                    enemy.mimicMoveIndex++;\r\n                } else {\r\n                    // Finished mimicking\r\n                    enemy.isMimicking = false;\r\n                    enemy.mimicTimer = 0;\r\n                    enemy.mimicMovementHistory = [];\r\n                    enemy.mimicMoveIndex = 0;\r\n                }\r\n            } else {\r\n                // Not mimicking - record player movement and approach\r\n                if (enemy.mimicTimer < enemy.mimicDuration) {\r\n                    // Recording phase - store player movement direction\r\n                    if (player.move && (player.move.x !== 0 || player.move.y !== 0)) {\r\n                        enemy.mimicMovementHistory.push({ x: player.move.x, y: player.move.y });\r\n                    }\r\n\r\n                    // Move toward player while recording\r\n                    if (distance > 0) {\r\n                        const normalized = dir.unit();\r\n                        const desiredMove = normalized.scale(enemy.speed * 0.5 * k.dt()); // Slower while recording\r\n                        const finalMove = applyObstacleAvoidance(desiredMove);\r\n                        enemy.pos.x += finalMove.x;\r\n                        enemy.pos.y += finalMove.y;\r\n                    }\r\n                } else if (enemy.mimicTimer >= enemy.mimicCooldown) {\r\n                    // Start mimicking\r\n                    if (enemy.mimicMovementHistory.length > 0) {\r\n                        enemy.isMimicking = true;\r\n                        enemy.mimicMoveIndex = 0;\r\n                        // Flash to indicate mimic start\r\n                        enemy.color = k.rgb(255, 255, 255);\r\n                        k.wait(0.15, () => {\r\n                            if (enemy.exists()) {\r\n                                enemy.color = k.rgb(...enemy.originalColor);\r\n                            }\r\n                        });\r\n                    } else {\r\n                        // No movement recorded - player was standing still\r\n                        // Rush directly toward player for a short burst instead of doing nothing\r\n                        if (distance > 0) {\r\n                            const rushDir = dir.unit();\r\n                            const rushMove = rushDir.scale(enemy.speed * 1.5 * k.dt()); // Faster rush\r\n                            const finalMove = applyObstacleAvoidance(rushMove);\r\n                            enemy.pos.x += finalMove.x;\r\n                            enemy.pos.y += finalMove.y;\r\n                        }\r\n                        // Reset timer to try again\r\n                        enemy.mimicTimer = 0;\r\n                    }\r\n                } else {\r\n                    // Wait period between recording and mimicking - approach player\r\n                    if (distance > 0) {\r\n                        const normalized = dir.unit();\r\n                        const desiredMove = normalized.scale(enemy.speed * k.dt());\r\n                        const finalMove = applyObstacleAvoidance(desiredMove);\r\n                        enemy.pos.x += finalMove.x;\r\n                        enemy.pos.y += finalMove.y;\r\n                    }\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (enemy.behavior === 'bomber') {\r\n            // Bomber: Stationary, launches slow homing bombs\r\n            enemy.attackTimer += k.dt();\r\n            if (distance > 0 && enemy.attackTimer >= 1 / enemy.fireRate) {\r\n                const direction = dir.unit();\r\n                const bomb = createProjectile(\r\n                    k,\r\n                    enemy.pos.x,\r\n                    enemy.pos.y,\r\n                    direction,\r\n                    enemy.projectileSpeed,\r\n                    enemy.projectileDamage,\r\n                    0, // piercing\r\n                    0, // obstaclePiercing\r\n                    false // isCrit\r\n                );\r\n                bomb.isEnemyProjectile = true;\r\n                bomb.isBomb = true;\r\n                bomb.homingStrength = enemy.homingStrength;\r\n                bomb.bombExplosionRadius = enemy.bombExplosionRadius;\r\n                bomb.targetPlayer = player;\r\n                bomb.color = k.rgb(255, 100, 0);\r\n                bomb.text = ''; // Bomb visual\r\n\r\n                // Add homing behavior to bomb\r\n                bomb.onUpdate(() => {\r\n                    if (bomb.targetPlayer && bomb.targetPlayer.exists() && !bomb.targetPlayer.isDead) {\r\n                        const toPlayer = k.vec2(\r\n                            bomb.targetPlayer.pos.x - bomb.pos.x,\r\n                            bomb.targetPlayer.pos.y - bomb.pos.y\r\n                        );\r\n                        const toPlayerNorm = toPlayer.len() > 0 ? toPlayer.unit() : k.vec2(0, 0);\r\n                        // Gradually adjust direction toward player\r\n                        bomb.direction = k.vec2(\r\n                            bomb.direction.x + (toPlayerNorm.x - bomb.direction.x) * bomb.homingStrength * k.dt(),\r\n                            bomb.direction.y + (toPlayerNorm.y - bomb.direction.y) * bomb.homingStrength * k.dt()\r\n                        ).unit();\r\n                    }\r\n                });\r\n\r\n                enemy.attackTimer = 0;\r\n            }\r\n            return; // Bombers don't move\r\n        }\r\n\r\n        // Default behavior: rush (direct charge)\r\n        if (enemy.behavior === 'rush') {\r\n            if (distance > 0) {\r\n                let moveDir;\r\n\r\n                // Use smart pathfinding if enabled\r\n                if (enemy.pathfindingMode === 'smart') {\r\n                    moveDir = getSmartMoveDirection(k, enemy, player.pos.x, player.pos.y);\r\n                } else {\r\n                    // Fallback to direct movement with obstacle avoidance\r\n                    const normalized = dir.unit();\r\n                    const desiredMove = normalized.scale(enemy.speed * k.dt());\r\n                    const finalMove = applyObstacleAvoidance(desiredMove);\r\n                    moveDir = finalMove.unit();\r\n                }\r\n\r\n                enemy.pos.x += moveDir.x * enemy.speed * k.dt();\r\n                enemy.pos.y += moveDir.y * enemy.speed * k.dt();\r\n            }\r\n        }\r\n\r\n        // Perimeter behavior: walks around edge of map\r\n        if (enemy.behavior === 'perimeter') {\r\n            const moveDir = getPerimeterMoveDirection(k, enemy);\r\n            enemy.pos.x += moveDir.x * enemy.speed * k.dt();\r\n            enemy.pos.y += moveDir.y * enemy.speed * k.dt();\r\n        }\r\n        \r\n        // Keep enemy in bounds (room boundaries) - same as player\r\n        const roomWidth = k.width();\r\n        const roomHeight = k.height();\r\n        const margin = 20;\r\n        const enemySize = enemy.size || 12;\r\n        \r\n        enemy.pos.x = k.clamp(enemy.pos.x, margin + enemySize, roomWidth - margin - enemySize);\r\n        enemy.pos.y = k.clamp(enemy.pos.y, margin + enemySize, roomHeight - margin - enemySize);\r\n    });\r\n\r\n    // Mark as not dead initially\r\n    enemy.isDead = false;\r\n    \r\n    // Cleanup buffs when buffer dies\r\n    enemy.onDeath(() => {\r\n        // Remove buffs from enemies when buffer dies\r\n        if (enemy.behavior === 'buffer' && enemy.buffedEnemies) {\r\n            for (const buffedEnemy of enemy.buffedEnemies) {\r\n                if (buffedEnemy.exists() && buffedEnemy.buffed) {\r\n                    buffedEnemy.speed = buffedEnemy.originalSpeed;\r\n                    buffedEnemy.damage = buffedEnemy.originalDamage;\r\n                    buffedEnemy.buffed = false;\r\n                }\r\n            }\r\n        }\r\n    });\r\n    \r\n    // Handle special death mechanics\r\n    enemy.onDeath(() => {\r\n        // In multiplayer, broadcast death event from host\r\n        if (isMultiplayerActive() && isHost() && enemy.mpEntityId) {\r\n            broadcastDeathEvent({\r\n                entityId: enemy.mpEntityId,\r\n                entityType: 'enemy',\r\n                x: enemy.pos.x,\r\n                y: enemy.pos.y,\r\n                xpDropped: enemy.xpValue\r\n            });\r\n        }\r\n\r\n        // Enemy splitting - only spawn on host in multiplayer to avoid desyncs\r\n        if (enemy.splits && enemy.hp() <= 0) {\r\n            // In multiplayer, only host spawns split enemies and broadcasts them\r\n            if (isMultiplayerActive() && !isHost()) {\r\n                return; // Clients skip spawning - they'll receive spawn_entity messages\r\n            }\r\n\r\n            const splitCount = enemy.splitCount || 2;\r\n            const splitType = enemy.splitType || 'slime'; // Fallback to slime for legacy behavior\r\n            for (let i = 0; i < splitCount; i++) {\r\n                const angle = (Math.PI * 2 / splitCount) * i;\r\n                const spawnDistance = 20;\r\n                const spawnX = enemy.pos.x + Math.cos(angle) * spawnDistance;\r\n                const spawnY = enemy.pos.y + Math.sin(angle) * spawnDistance;\r\n\r\n                // Create smaller enemy (half health, smaller size)\r\n                // Ensure minimum health of 10 to prevent 0 HP enemies\r\n                const splitEnemy = createEnemy(k, spawnX, spawnY, splitType, enemy.floor);\r\n                splitEnemy.maxHealth = Math.max(10, Math.floor(splitEnemy.maxHealth / 2));\r\n                splitEnemy.setHP(splitEnemy.maxHealth);\r\n                splitEnemy.size = Math.max(8, Math.floor(splitEnemy.size * 0.8)); // Minimum size of 8\r\n                splitEnemy.splits = false; // Don't split again\r\n                splitEnemy.isSplitEnemy = true; // Mark as split enemy for tracking\r\n\r\n                // Register split enemy for multiplayer sync (host only)\r\n                if (isMultiplayerActive() && isHost() && registerEnemy) {\r\n                    registerEnemy(splitEnemy, {\r\n                        enemyType: splitType,\r\n                        maxHealth: splitEnemy.maxHealth,\r\n                        floor: enemy.floor,\r\n                        isSplitEnemy: true\r\n                    });\r\n                }\r\n            }\r\n\r\n            // Increment split enemy counter\r\n            if (k.gameData && k.gameData.incrementSplitEnemies) {\r\n                k.gameData.incrementSplitEnemies(splitCount);\r\n            }\r\n\r\n            // Broadcast split event to clients in multiplayer\r\n            if (isMultiplayerActive() && isHost()) {\r\n                broadcastEnemySplit(splitCount);\r\n            }\r\n        }\r\n        \r\n        // Exploder explosion\r\n        if (enemy.explodes && enemy.hp() <= 0) {\r\n            // Damage all players within explosion radius (only host in multiplayer)\r\n            if (!isMultiplayerActive() || isHost()) {\r\n                const allPlayers = k.get('player');\r\n                allPlayers.forEach(player => {\r\n                    if (player && player.exists() && !player.isDead) {\r\n                        const explosionDir = k.vec2(\r\n                            player.pos.x - enemy.pos.x,\r\n                            player.pos.y - enemy.pos.y\r\n                        );\r\n                        const explosionDistance = explosionDir.len();\r\n\r\n                        if (explosionDistance <= enemy.explosionRadius) {\r\n                            // Player is in explosion radius\r\n                            if (!player.invulnerable) {\r\n                                const finalDamage = Math.max(1, enemy.explosionDamage - (player.defense || 0));\r\n                                player.hurt(finalDamage);\r\n                                player.invulnerable = true;\r\n                                player.invulnerableTime = player.invulnerableDuration;\r\n                                player.color = k.rgb(255, 100, 100);\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            \r\n            // Visual explosion effect (could add particles later)\r\n            const explosionText = k.add([\r\n                k.text('*', { size: 24 }),\r\n                k.pos(enemy.pos.x, enemy.pos.y),\r\n                k.anchor('center'),\r\n                k.color(255, 200, 0),\r\n                k.z(200)\r\n            ]);\r\n            k.wait(0.2, () => {\r\n                if (explosionText.exists()) k.destroy(explosionText);\r\n            });\r\n        }\r\n    });\r\n\r\n    // Multiplayer: Register enemy for network sync if host\r\n    if (isMultiplayerActive() && isHost()) {\r\n        registerEnemy(enemy, { type, floor });\r\n        enemy.enemyType = type; // Store type for sync\r\n    }\r\n\r\n    return enemy;\r\n}\r\n\r\n","/**\r\n * Miniboss Type Definitions\r\n *\r\n * Scaled-down bosses that appear randomly in rooms.\r\n * Minibosses have armor/shield systems but lower stats than full bosses.\r\n */\r\n\r\nexport const MINIBOSS_TYPES = {\r\n    brute: {\r\n        name: 'Security Chief',\r\n        coreChar: 'B',\r\n        armorChar: '[]',\r\n        shieldChar: '{}',\r\n        color: [255, 100, 50], // Orange-red\r\n        armorColor: [200, 200, 200],\r\n        shieldColor: [100, 200, 255],\r\n        baseHealth: 200,\r\n        baseArmorHealth: 50,\r\n        baseShieldHealth: 0,\r\n        baseSpeed: 60,\r\n        size: 24,\r\n        baseXPValue: 50,\r\n        damageReduction: 0.25,\r\n        shieldRegenRate: 0,\r\n        meleeDamage: 18,\r\n        behavior: 'charge' // Charges at player periodically\r\n    },\r\n    sentinel: {\r\n        name: 'Technical Director',\r\n        coreChar: 'S',\r\n        armorChar: '[]',\r\n        shieldChar: '{}',\r\n        color: [100, 200, 255], // Light blue\r\n        armorColor: [200, 200, 200],\r\n        shieldColor: [100, 200, 255],\r\n        baseHealth: 180,\r\n        baseArmorHealth: 40,\r\n        baseShieldHealth: 30, // Has shields\r\n        baseSpeed: 50,\r\n        size: 24,\r\n        baseXPValue: 45,\r\n        damageReduction: 0.2,\r\n        shieldRegenRate: 2, // 2 HP/sec regen\r\n        projectileDamage: 12,\r\n        projectileSpeed: 250,\r\n        fireRate: 1.2,\r\n        behavior: 'shoot' // Ranged attacker\r\n    },\r\n    berserker: {\r\n        name: 'Stunt Coordinator',\r\n        coreChar: 'Z',\r\n        armorChar: '[]',\r\n        shieldChar: '{}',\r\n        color: [255, 50, 50], // Red\r\n        armorColor: [200, 200, 200],\r\n        shieldColor: [100, 200, 255],\r\n        baseHealth: 250,\r\n        baseArmorHealth: 0,\r\n        baseShieldHealth: 0,\r\n        baseSpeed: 80, // Fast\r\n        size: 24,\r\n        baseXPValue: 55,\r\n        damageReduction: 0,\r\n        shieldRegenRate: 0,\r\n        meleeDamage: 20,\r\n        behavior: 'rush' // Fast, aggressive\r\n    },\r\n    guardian: {\r\n        name: 'Studio Manager',\r\n        coreChar: 'G',\r\n        armorChar: '[]',\r\n        shieldChar: '{}',\r\n        color: [150, 150, 255], // Light purple\r\n        armorColor: [200, 200, 200],\r\n        shieldColor: [100, 200, 255],\r\n        baseHealth: 220,\r\n        baseArmorHealth: 60, // Heavy armor\r\n        baseShieldHealth: 0,\r\n        baseSpeed: 40, // Slow\r\n        size: 24,\r\n        baseXPValue: 50,\r\n        damageReduction: 0.3,\r\n        shieldRegenRate: 0,\r\n        meleeDamage: 16,\r\n        behavior: 'rush' // Tanky, slow\r\n    },\r\n    warlock: {\r\n        name: 'Creative Director',\r\n        coreChar: 'W',\r\n        armorChar: '[]',\r\n        shieldChar: '{}',\r\n        color: [200, 100, 255], // Purple\r\n        armorColor: [200, 200, 200],\r\n        shieldColor: [100, 200, 255],\r\n        baseHealth: 160,\r\n        baseArmorHealth: 0,\r\n        baseShieldHealth: 40, // Has shields\r\n        baseSpeed: 55,\r\n        size: 24,\r\n        baseXPValue: 48,\r\n        damageReduction: 0,\r\n        shieldRegenRate: 3, // 3 HP/sec regen\r\n        projectileDamage: 14,\r\n        projectileSpeed: 220,\r\n        fireRate: 1.0,\r\n        behavior: 'shoot' // Ranged with shields\r\n    }\r\n};\r\n\r\n/**\r\n * Get miniboss definition by type key\r\n * @param {string} type - Miniboss type key\r\n * @returns {object} Miniboss configuration\r\n */\r\nexport function getMinibossDefinition(type) {\r\n    return MINIBOSS_TYPES[type] || MINIBOSS_TYPES.brute;\r\n}\r\n\r\n/**\r\n * Get all miniboss types\r\n * @returns {Array<string>} Array of miniboss type keys\r\n */\r\nexport function getAllMinibossTypes() {\r\n    return Object.keys(MINIBOSS_TYPES);\r\n}\r\n","// Miniboss entity definition - scaled-down bosses that appear randomly in rooms\r\nimport { createProjectile } from './projectile.js';\r\nimport { getMinibossDefinition } from '../data/minibosses.js';\r\nimport { isMultiplayerActive, isHost } from '../systems/multiplayerGame.js';\r\n\r\nexport function createMiniboss(k, x, y, type = 'brute', floor = 1) {\r\n    const baseConfig = getMinibossDefinition(type);\r\n    \r\n    // Scale stats based on floor\r\n    const floorMultiplier = 1 + (floor - 1) * 0.2; // 20% increase per floor\r\n    const config = {\r\n        coreChar: baseConfig.coreChar,\r\n        armorChar: baseConfig.armorChar || '[]',\r\n        shieldChar: baseConfig.shieldChar || '{}',\r\n        color: baseConfig.color,\r\n        armorColor: baseConfig.armorColor || [200, 200, 200],\r\n        shieldColor: baseConfig.shieldColor || [100, 200, 255],\r\n        health: Math.floor(baseConfig.baseHealth * floorMultiplier),\r\n        armorHealth: Math.floor((baseConfig.baseArmorHealth || 0) * floorMultiplier),\r\n        maxArmorHealth: Math.floor((baseConfig.baseArmorHealth || 0) * floorMultiplier),\r\n        shieldHealth: Math.floor((baseConfig.baseShieldHealth || 0) * floorMultiplier),\r\n        maxShieldHealth: Math.floor((baseConfig.baseShieldHealth || 0) * floorMultiplier),\r\n        speed: Math.floor(baseConfig.baseSpeed * (1 + (floor - 1) * 0.05)),\r\n        size: baseConfig.size,\r\n        xpValue: Math.floor(baseConfig.baseXPValue * floorMultiplier),\r\n        damageReduction: baseConfig.damageReduction || 0,\r\n        shieldRegenRate: (baseConfig.shieldRegenRate || 0) * floorMultiplier\r\n    };\r\n    \r\n    // Create miniboss entity\r\n    const miniboss = k.add([\r\n        k.text(config.coreChar, { size: config.size }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...config.color),\r\n        k.area(),\r\n        k.health(config.health),\r\n        'miniboss'\r\n    ]);\r\n\r\n    miniboss.maxHealth = config.health;\r\n    miniboss.speed = config.speed;\r\n    miniboss.xpValue = config.xpValue;\r\n    miniboss.type = type;\r\n    miniboss.floor = floor;\r\n    \r\n    // Store miniboss-specific stats\r\n    if (baseConfig.meleeDamage) miniboss.meleeDamage = baseConfig.meleeDamage;\r\n    if (baseConfig.projectileDamage) miniboss.projectileDamage = baseConfig.projectileDamage;\r\n    if (baseConfig.projectileSpeed) miniboss.projectileSpeed = baseConfig.projectileSpeed;\r\n    if (baseConfig.fireRate) miniboss.fireRate = baseConfig.fireRate;\r\n    \r\n    // Armor properties\r\n    miniboss.armorHealth = config.armorHealth;\r\n    miniboss.maxArmorHealth = config.maxArmorHealth;\r\n    miniboss.damageReduction = config.damageReduction;\r\n    miniboss.coreChar = config.coreChar;\r\n    miniboss.armorChar = config.armorChar;\r\n    miniboss.armorColor = config.armorColor;\r\n    \r\n    // Shield properties\r\n    miniboss.shieldHealth = config.shieldHealth;\r\n    miniboss.maxShieldHealth = config.maxShieldHealth;\r\n    miniboss.shieldRegenRate = config.shieldRegenRate;\r\n    miniboss.shieldChar = config.shieldChar;\r\n    miniboss.shieldColor = config.shieldColor;\r\n    miniboss.shieldRegenTimer = 0;\r\n    miniboss.shieldRegenCooldown = 0;\r\n    miniboss.lastDamageTime = 0;\r\n    \r\n    // Behavior-specific timers\r\n    miniboss.attackTimer = 0;\r\n    miniboss.chargeCooldownTimer = 0;\r\n    miniboss.chargeDurationTimer = 0;\r\n    miniboss.isCharging = false;\r\n    miniboss.chargeDirection = null;\r\n    miniboss.chargeSpeed = 0;\r\n    \r\n    // Function to update visual representation\r\n    miniboss.updateVisual = function() {\r\n        // Priority: Shields > Armor > Core\r\n        let leftShield = '';\r\n        let rightShield = '';\r\n        let leftArmor = '';\r\n        let rightArmor = '';\r\n        \r\n        // Shields take priority (outermost layer)\r\n        // Size scales with health: Full =  , Medium =  , Low =  \r\n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\r\n        if (miniboss.shieldHealth > 0) {\r\n            const shieldPercent = miniboss.shieldHealth / miniboss.maxShieldHealth;\r\n            \r\n            if (shieldPercent > 0.66) {\r\n                // Full shield (66-100%): Double brackets   (mathematical double brackets)\r\n                leftShield = '';\r\n                rightShield = '';\r\n            } else if (shieldPercent > 0.33) {\r\n                // Medium shield (33-66%): Left/right white parenthesis  \r\n                leftShield = '';\r\n                rightShield = '';\r\n            } else {\r\n                // Low shield (0-33%): Left/right angle brackets  \r\n                leftShield = '';\r\n                rightShield = '';\r\n            }\r\n        }\r\n        \r\n        // Armor (middle layer, can appear with shields: {[B]})\r\n        // Size scales with health: Full =  , Medium =  , Low =  \r\n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\r\n        if (miniboss.armorHealth > 0) {\r\n            const armorPercent = miniboss.armorHealth / miniboss.maxArmorHealth;\r\n            \r\n            if (armorPercent > 0.66) {\r\n                // Full armor (66-100%): Double brackets   (mathematical double brackets)\r\n                leftArmor = '';\r\n                rightArmor = '';\r\n            } else if (armorPercent > 0.33) {\r\n                // Medium armor (33-66%): Left/right angle brackets  \r\n                leftArmor = '';\r\n                rightArmor = '';\r\n            } else {\r\n                // Low armor (0-33%): Left/right double angle brackets  \r\n                leftArmor = '';\r\n                rightArmor = '';\r\n            }\r\n        }\r\n        \r\n        // Visual format: {[B]} (shields outside, armor inside)\r\n        const visual = `${leftShield}${leftArmor}${miniboss.coreChar}${rightArmor}${rightShield}`;\r\n        \r\n        // Update text component\r\n        miniboss.text = visual;\r\n        \r\n        // Update color - use shield color if shields exist, otherwise original color\r\n        if (miniboss.shieldHealth > 0) {\r\n            miniboss.color = k.rgb(...config.shieldColor);\r\n        } else {\r\n            miniboss.color = k.rgb(...config.color);\r\n        }\r\n    };\r\n    \r\n    // Function to take damage (handles shields, then armor, then health)\r\n    miniboss.takeDamage = function(damage) {\r\n        let shieldChanged = false;\r\n        let armorChanged = false;\r\n        const previousShieldHealth = miniboss.shieldHealth;\r\n        const previousArmorHealth = miniboss.armorHealth;\r\n        \r\n        // Track damage time for shield regen cooldown\r\n        miniboss.lastDamageTime = k.time();\r\n        const shieldRegenCooldownDuration = 3.0; // 3 seconds cooldown after taking damage\r\n        miniboss.shieldRegenCooldown = shieldRegenCooldownDuration;\r\n        \r\n        // Priority: Shields > Armor > Health\r\n        // Shields take normal damage (no reduction)\r\n        if (miniboss.shieldHealth > 0) {\r\n            const shieldDamage = Math.min(damage, miniboss.shieldHealth);\r\n            miniboss.shieldHealth = Math.max(0, miniboss.shieldHealth - shieldDamage);\r\n            shieldChanged = (miniboss.shieldHealth !== previousShieldHealth);\r\n            \r\n            // Remaining damage goes to armor/health\r\n            const remainingDamage = damage - shieldDamage;\r\n            if (remainingDamage > 0) {\r\n                miniboss.takeDamageInternal(remainingDamage);\r\n            }\r\n        } else {\r\n            // No shields - damage goes to armor/health\r\n            miniboss.takeDamageInternal(damage);\r\n        }\r\n        \r\n        armorChanged = (miniboss.armorHealth !== previousArmorHealth);\r\n        \r\n        // Update visual when shields or armor change\r\n        if (shieldChanged || armorChanged) {\r\n            miniboss.updateVisual();\r\n        }\r\n    };\r\n    \r\n    // Internal damage function (handles armor and health)\r\n    miniboss.takeDamageInternal = function(damage) {\r\n        // If armor exists, armor takes reduced damage first\r\n        if (miniboss.armorHealth > 0) {\r\n            // Apply damage reduction to armor damage\r\n            const reducedDamage = Math.floor(damage * (1 - miniboss.damageReduction));\r\n            const armorDamage = Math.min(reducedDamage, miniboss.armorHealth);\r\n            miniboss.armorHealth = Math.max(0, miniboss.armorHealth - armorDamage);\r\n            \r\n            // Remaining damage goes to miniboss, but reduced if armor still exists\r\n            const remainingDamage = damage - reducedDamage;\r\n            if (remainingDamage > 0) {\r\n                const damageMultiplier = miniboss.armorHealth > 0 ? (1 - miniboss.damageReduction) : 1;\r\n                const finalDamage = Math.floor(remainingDamage * damageMultiplier);\r\n                miniboss.hurt(finalDamage);\r\n            }\r\n        } else {\r\n            // No armor - full damage\r\n            miniboss.hurt(damage);\r\n        }\r\n    };\r\n    \r\n    // Charge attack\r\n    miniboss.startCharge = function(targetPos) {\r\n        if (!miniboss.exists()) return;\r\n        \r\n        miniboss.isCharging = true;\r\n        const dir = k.vec2(targetPos.x - miniboss.pos.x, targetPos.y - miniboss.pos.y);\r\n        if (dir.len() > 0) {\r\n            miniboss.chargeDirection = dir.unit();\r\n            miniboss.chargeSpeed = miniboss.speed * 2.5; // 2.5x speed for charge\r\n        }\r\n    };\r\n    \r\n    // AI based on behavior type\r\n    miniboss.onUpdate(() => {\r\n        if (k.paused) return;\r\n        \r\n        // Shield regeneration (if shields exist and regen rate > 0)\r\n        // Only regen if cooldown has expired (not damaged recently) and miniboss is alive\r\n        if (miniboss.shieldRegenRate > 0 && miniboss.shieldHealth < miniboss.maxShieldHealth && miniboss.hp() > 0 && !miniboss.isDead) {\r\n            // Update cooldown timer\r\n            if (miniboss.shieldRegenCooldown > 0) {\r\n                miniboss.shieldRegenCooldown -= k.dt();\r\n            }\r\n            \r\n            // Only regenerate if cooldown has expired\r\n            if (miniboss.shieldRegenCooldown <= 0) {\r\n                miniboss.shieldRegenTimer += k.dt();\r\n                const regenInterval = 1.0; // Regenerate every second\r\n                \r\n                if (miniboss.shieldRegenTimer >= regenInterval) {\r\n                    const regenAmount = miniboss.shieldRegenRate * regenInterval;\r\n                    miniboss.shieldHealth = Math.min(miniboss.maxShieldHealth, miniboss.shieldHealth + regenAmount);\r\n                    miniboss.shieldRegenTimer = 0;\r\n                    \r\n                    // Update visual if shield regenerated\r\n                    if (miniboss.shieldHealth > 0) {\r\n                        miniboss.updateVisual();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Process burn DoT (Damage over Time) from flamethrower\r\n        if (miniboss.burnDuration > 0 && miniboss.hp() > 0 && !miniboss.isDead) {\r\n            miniboss.burnTimer = (miniboss.burnTimer || 0) + k.dt();\r\n            const burnTickInterval = 0.5; // Deal burn damage every 0.5 seconds\r\n\r\n            if (miniboss.burnTimer >= burnTickInterval) {\r\n                // In multiplayer, only host deals burn damage\r\n                if (!isMultiplayerActive() || isHost()) {\r\n                    // Deal burn damage\r\n                    if (miniboss.takeDamage) {\r\n                        miniboss.takeDamage(miniboss.burnDamage);\r\n                    } else {\r\n                        miniboss.hurt(miniboss.burnDamage);\r\n                    }\r\n                }\r\n\r\n                // Visual feedback for burn damage (orange tint) on all clients\r\n                const originalColor = miniboss.color;\r\n                miniboss.color = k.rgb(255, 150, 50);\r\n                k.wait(0.1, () => {\r\n                    if (miniboss.exists()) {\r\n                        miniboss.updateVisual();\r\n                    }\r\n                });\r\n\r\n                miniboss.burnTimer = 0;\r\n            }\r\n\r\n            // Decrease burn duration\r\n            miniboss.burnDuration -= k.dt();\r\n            if (miniboss.burnDuration <= 0) {\r\n                miniboss.burnDamage = 0;\r\n                miniboss.burnTimer = 0;\r\n            }\r\n        }\r\n\r\n        const player = k.get('player')[0];\r\n        if (!player || !player.exists()) return;\r\n        \r\n        const dir = k.vec2(\r\n            player.pos.x - miniboss.pos.x,\r\n            player.pos.y - miniboss.pos.y\r\n        );\r\n        const distance = dir.len();\r\n        \r\n        // Behavior-specific AI\r\n        if (baseConfig.behavior === 'charge') {\r\n            // Brute: Charges at player periodically\r\n            miniboss.attackTimer += k.dt();\r\n            miniboss.chargeCooldownTimer += k.dt();\r\n            \r\n            const chargeCooldown = 6; // 6 seconds between charges\r\n            const chargeDistance = 200; // Distance to start charge\r\n            \r\n            // Handle charge attack\r\n            if (miniboss.isCharging) {\r\n                const chargeMove = miniboss.chargeDirection.scale(miniboss.chargeSpeed * k.dt());\r\n                miniboss.pos.x += chargeMove.x;\r\n                miniboss.pos.y += chargeMove.y;\r\n                \r\n                miniboss.chargeDurationTimer += k.dt();\r\n                const chargeDuration = 1.0;\r\n                if (miniboss.chargeDurationTimer >= chargeDuration) {\r\n                    miniboss.isCharging = false;\r\n                    miniboss.chargeDurationTimer = 0;\r\n                    miniboss.chargeCooldownTimer = 0;\r\n                }\r\n            } else {\r\n                // Normal movement toward player\r\n                if (distance > 0) {\r\n                    const normalized = dir.unit();\r\n                    const moveAmount = normalized.scale(miniboss.speed * k.dt());\r\n                    miniboss.pos.x += moveAmount.x;\r\n                    miniboss.pos.y += moveAmount.y;\r\n                }\r\n                \r\n                // Charge attack when close enough\r\n                if (miniboss.chargeCooldownTimer >= chargeCooldown && distance < chargeDistance) {\r\n                    miniboss.color = k.rgb(255, 255, 0); // Yellow telegraph\r\n                    k.wait(0.3, () => {\r\n                        if (miniboss.exists()) {\r\n                            miniboss.color = k.rgb(...config.color);\r\n                            miniboss.startCharge(player.pos);\r\n                        }\r\n                    });\r\n                    miniboss.chargeCooldownTimer = 0;\r\n                }\r\n            }\r\n        } else if (baseConfig.behavior === 'shoot') {\r\n            // Sentinel/Warlock: Ranged attacker\r\n            miniboss.attackTimer += k.dt();\r\n            \r\n            // Movement: maintain distance from player\r\n            const preferredDistance = 180;\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                let moveSpeed = miniboss.speed;\r\n                \r\n                // Move away if too close, move closer if too far\r\n                if (distance < preferredDistance) {\r\n                    // Move away from player\r\n                    const moveAmount = normalized.scale(-moveSpeed * k.dt());\r\n                    miniboss.pos.x += moveAmount.x;\r\n                    miniboss.pos.y += moveAmount.y;\r\n                } else if (distance > preferredDistance * 1.5) {\r\n                    // Move closer if too far\r\n                    const moveAmount = normalized.scale(moveSpeed * k.dt());\r\n                    miniboss.pos.x += moveAmount.x;\r\n                    miniboss.pos.y += moveAmount.y;\r\n                }\r\n            }\r\n            \r\n            // Fire projectiles at player\r\n            const fireInterval = 1 / miniboss.fireRate;\r\n            if (miniboss.attackTimer >= fireInterval) {\r\n                if (distance > 0) {\r\n                    const direction = dir.unit();\r\n                    const projectile = createProjectile(\r\n                        k, \r\n                        miniboss.pos.x, \r\n                        miniboss.pos.y, \r\n                        direction, \r\n                        miniboss.projectileSpeed, \r\n                        miniboss.projectileDamage, \r\n                        0, \r\n                        0, \r\n                        false\r\n                    );\r\n                    projectile.isBossProjectile = true;\r\n                    projectile.color = k.rgb(...config.color);\r\n                }\r\n                miniboss.attackTimer = 0;\r\n            }\r\n        } else if (baseConfig.behavior === 'rush') {\r\n            // Berserker/Guardian: Direct charge at player\r\n            if (distance > 0) {\r\n                const normalized = dir.unit();\r\n                const moveAmount = normalized.scale(miniboss.speed * k.dt());\r\n                miniboss.pos.x += moveAmount.x;\r\n                miniboss.pos.y += moveAmount.y;\r\n            }\r\n        }\r\n\r\n        // Keep miniboss in bounds (room boundaries)\r\n        const roomWidth = k.width();\r\n        const roomHeight = k.height();\r\n        const margin = 20;\r\n        const minibossSize = miniboss.size || 24;\r\n\r\n        miniboss.pos.x = k.clamp(miniboss.pos.x, margin + minibossSize, roomWidth - margin - minibossSize);\r\n        miniboss.pos.y = k.clamp(miniboss.pos.y, margin + minibossSize, roomHeight - margin - minibossSize);\r\n    });\r\n    \r\n    // Mark as not dead initially\r\n    miniboss.isDead = false;\r\n    \r\n    // Initialize visual\r\n    miniboss.updateVisual();\r\n\r\n    return miniboss;\r\n}\r\n\r\n","// Door entity definition\r\nexport function createDoor(k, x, y, direction) {\r\n    // Create a group to hold door parts\r\n    // Add a rect component so area() has a shape to work with\r\n    const doorGroup = k.add([\r\n        k.rect(40, 40),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.area(),\r\n        k.opacity(0), // Make the rect invisible (only used for collision)\r\n        k.fixed(),\r\n        'door'\r\n    ]);\r\n\r\n    doorGroup.direction = direction;\r\n    doorGroup.open = false;\r\n    doorGroup.isSpawnDoor = false;\r\n    doorGroup.blocked = false; // NEW: Blocked state for doors that don't lead anywhere\r\n    doorGroup.gridDirection = null; // NEW: Which grid direction this door represents\r\n    doorGroup.parts = []; // Store door visual parts\r\n\r\n    // Function to update door appearance based on state\r\n    doorGroup.updateVisual = () => {\r\n        // Remove old parts\r\n        doorGroup.parts.forEach(part => {\r\n            if (part.exists()) k.destroy(part);\r\n        });\r\n        doorGroup.parts = [];\r\n\r\n        // Determine color based on state\r\n        let color;\r\n        if (doorGroup.blocked) {\r\n            color = k.rgb(80, 80, 80);  // Gray when blocked\r\n        } else if (doorGroup.open) {\r\n            color = k.rgb(100, 255, 100);  // Green when open\r\n        } else if (doorGroup.isSpawnDoor) {\r\n            color = k.rgb(200, 50, 50);  // Red for spawn doors\r\n        } else {\r\n            color = k.rgb(200, 200, 100);  // Yellow for closed exit doors\r\n        }\r\n\r\n        if (direction === 'north' || direction === 'south') {\r\n            // Horizontal doors (top and bottom)\r\n            // Use box drawing characters for a nice doorway look\r\n            const doorChars = doorGroup.blocked ? '' : (doorGroup.open ? '' : '');\r\n\r\n            const doorText = k.add([\r\n                k.text(doorChars, { size: 24 }),\r\n                k.pos(x, y),\r\n                k.anchor('center'),\r\n                k.color(color),\r\n                k.fixed(),\r\n                k.z(100)\r\n            ]);\r\n            doorGroup.parts.push(doorText);\r\n\r\n            // Add decorative corners\r\n            const leftCorner = k.add([\r\n                k.text(doorGroup.open ? '' : '', { size: 20 }),\r\n                k.pos(x - 35, y),\r\n                k.anchor('center'),\r\n                k.color(color),\r\n                k.fixed(),\r\n                k.z(100)\r\n            ]);\r\n            doorGroup.parts.push(leftCorner);\r\n\r\n            const rightCorner = k.add([\r\n                k.text(doorGroup.open ? '' : '', { size: 20 }),\r\n                k.pos(x + 35, y),\r\n                k.anchor('center'),\r\n                k.color(color),\r\n                k.fixed(),\r\n                k.z(100)\r\n            ]);\r\n            doorGroup.parts.push(rightCorner);\r\n\r\n        } else {\r\n            // Vertical doors (left and right sides)\r\n            // Stack characters vertically for proper door appearance\r\n            const doorChars = doorGroup.blocked ? ['', '', ''] : (doorGroup.open ? ['', '', ''] : ['', '', '']);\r\n            const spacing = 16; // Vertical spacing between characters\r\n\r\n            for (let i = 0; i < doorChars.length; i++) {\r\n                const offsetY = (i - 1) * spacing; // Center around y position\r\n                const doorPart = k.add([\r\n                    k.text(doorChars[i], { size: 24 }),\r\n                    k.pos(x, y + offsetY),\r\n                    k.anchor('center'),\r\n                    k.color(color),\r\n                    k.fixed(),\r\n                    k.z(100)\r\n                ]);\r\n                doorGroup.parts.push(doorPart);\r\n            }\r\n\r\n            // Add decorative top and bottom\r\n            const topDecor = k.add([\r\n                k.text(doorGroup.open ? '' : '', { size: 20 }),\r\n                k.pos(x, y - spacing * 1.5),\r\n                k.anchor('center'),\r\n                k.color(color),\r\n                k.fixed(),\r\n                k.z(100)\r\n            ]);\r\n            doorGroup.parts.push(topDecor);\r\n\r\n            const bottomDecor = k.add([\r\n                k.text(doorGroup.open ? '' : '', { size: 20 }),\r\n                k.pos(x, y + spacing * 1.5),\r\n                k.anchor('center'),\r\n                k.color(color),\r\n                k.fixed(),\r\n                k.z(100)\r\n            ]);\r\n            doorGroup.parts.push(bottomDecor);\r\n        }\r\n\r\n        // Add 'X' overlay for blocked doors\r\n        if (doorGroup.blocked) {\r\n            const blockedMarker = k.add([\r\n                k.text('X', { size: 28 }),\r\n                k.pos(x, y),\r\n                k.anchor('center'),\r\n                k.color(255, 100, 100),\r\n                k.fixed(),\r\n                k.z(101)\r\n            ]);\r\n            doorGroup.parts.push(blockedMarker);\r\n        }\r\n    };\r\n\r\n    // Override color setter to update all parts\r\n    Object.defineProperty(doorGroup, 'color', {\r\n        get: () => doorGroup._color,\r\n        set: (newColor) => {\r\n            doorGroup._color = newColor;\r\n            doorGroup.parts.forEach(part => {\r\n                if (part.exists()) {\r\n                    part.color = newColor;\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    // Override text setter to maintain compatibility\r\n    Object.defineProperty(doorGroup, 'text', {\r\n        get: () => doorGroup._text || '=',\r\n        set: (newText) => {\r\n            doorGroup._text = newText;\r\n            // Don't actually update visuals - updateVisual() handles this\r\n        }\r\n    });\r\n\r\n    // Cleanup handler to prevent memory leaks\r\n    doorGroup.onDestroy(() => {\r\n        // Destroy all visual parts when door is destroyed\r\n        doorGroup.parts.forEach(part => {\r\n            if (part.exists()) {\r\n                k.destroy(part);\r\n            }\r\n        });\r\n        doorGroup.parts = [];\r\n    });\r\n\r\n    // Initial visual setup\r\n    doorGroup.updateVisual();\r\n\r\n    return doorGroup;\r\n}\r\n","// Obstacle entity definition\r\n// Obstacles can be walls (block everything) or cover (block movement, allow projectiles)\r\n\r\nexport function createObstacle(k, x, y, width, height, type = 'wall', char = '#', color = null) {\r\n    // type: 'wall' (blocks movement and projectiles) or 'cover' (blocks movement, projectiles pass)\r\n    \r\n    // Visual distinction: walls are darker/solid, cover is lighter/more transparent\r\n    // Walls: darker gray (100, 100, 100) - solid, blocks everything\r\n    // Cover: lighter gray (140, 140, 140) - allows projectiles through\r\n    const isWall = type === 'wall';\r\n    const defaultColor = isWall ? k.rgb(100, 100, 100) : k.rgb(140, 140, 140);\r\n    const defaultOutline = isWall ? k.rgb(80, 80, 80) : k.rgb(120, 120, 120);\r\n    \r\n    // Use rect for visual representation\r\n    const obstacle = k.add([\r\n        k.rect(width, height),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(color || defaultColor),\r\n        k.outline(2, color || defaultOutline), // Thicker outline for better visibility\r\n        k.area({ width: width, height: height }),\r\n        k.fixed(), // Fixed position (doesn't move)\r\n        'obstacle',\r\n        type === 'wall' ? 'wall' : 'cover' // Tag for collision filtering\r\n    ]);\r\n    \r\n    obstacle.type = type; // 'wall' or 'cover'\r\n    obstacle.width = width;\r\n    obstacle.height = height;\r\n    \r\n    return obstacle;\r\n}\r\n\r\n","/**\r\n * Explosive Barrel Entity\r\n *\r\n * Destructible environmental hazard that:\r\n * - Has a health bar and takes multiple hits to destroy\r\n * - Creates AOE explosion damaging players and enemies\r\n * - Can trigger chain reactions with nearby barrels\r\n * - Adds tactical depth to combat\r\n */\r\n\r\nimport { isMultiplayerActive, isHost } from '../systems/multiplayerGame.js';\r\nimport { broadcast } from '../systems/networkSystem.js';\r\n\r\n// Barrel configuration\r\nconst BARREL_CONFIG = {\r\n    // Visual\r\n    CHAR: '',\r\n    SIZE: 20,\r\n    COLOR: [180, 80, 40], // Orange-red\r\n    DAMAGED_COLOR: [220, 100, 30], // Brighter when damaged\r\n    CRITICAL_COLOR: [255, 60, 20], // Red when near death\r\n\r\n    // Stats\r\n    MAX_HEALTH: 3,\r\n\r\n    // Explosion\r\n    EXPLOSION_RADIUS: 80,\r\n    EXPLOSION_DAMAGE: 25,\r\n    CHAIN_DELAY: 0.15, // Delay before chain reaction (seconds)\r\n    KNOCKBACK_FORCE: 200,\r\n\r\n    // Visual effects\r\n    SHAKE_INTENSITY: 0.5,\r\n    EXPLOSION_DURATION: 0.3\r\n};\r\n\r\n// Track all barrels for chain reactions\r\nlet allBarrels = [];\r\n\r\n/**\r\n * Create an explosive barrel\r\n * @param {object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n * @param {object} options - Optional configuration overrides\r\n * @returns {object} - Barrel entity\r\n */\r\nexport function createBarrel(k, x, y, options = {}) {\r\n    const config = { ...BARREL_CONFIG, ...options };\r\n\r\n    const barrel = k.add([\r\n        k.text(config.CHAR, { size: config.SIZE }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.area({ width: config.SIZE, height: config.SIZE }),\r\n        k.color(...config.COLOR),\r\n        k.z(50),\r\n        k.opacity(1),\r\n        'barrel',\r\n        'obstacle', // Blocks movement like other obstacles\r\n        {\r\n            maxHealth: config.MAX_HEALTH,\r\n            currentHealth: config.MAX_HEALTH,\r\n            explosionRadius: config.EXPLOSION_RADIUS,\r\n            explosionDamage: config.EXPLOSION_DAMAGE,\r\n            chainDelay: config.CHAIN_DELAY,\r\n            knockbackForce: config.KNOCKBACK_FORCE,\r\n            isExploding: false,\r\n            barrelId: Math.random().toString(36).substr(2, 9)\r\n        }\r\n    ]);\r\n\r\n    // Create health bar background\r\n    const healthBarBg = k.add([\r\n        k.rect(24, 4),\r\n        k.pos(x, y - 18),\r\n        k.anchor('center'),\r\n        k.color(40, 40, 40),\r\n        k.z(51),\r\n        'barrelHealthBar'\r\n    ]);\r\n\r\n    // Create health bar fill\r\n    const healthBarFill = k.add([\r\n        k.rect(22, 2),\r\n        k.pos(x - 11, y - 18),\r\n        k.anchor('left'),\r\n        k.color(255, 100, 50),\r\n        k.z(52),\r\n        'barrelHealthBar'\r\n    ]);\r\n\r\n    // Store references\r\n    barrel.healthBarBg = healthBarBg;\r\n    barrel.healthBarFill = healthBarFill;\r\n\r\n    // Update health bar position and size\r\n    barrel.updateHealthBar = () => {\r\n        if (!barrel.exists()) return;\r\n\r\n        const healthPercent = barrel.currentHealth / barrel.maxHealth;\r\n\r\n        if (healthBarBg.exists()) {\r\n            healthBarBg.pos.x = barrel.pos.x;\r\n            healthBarBg.pos.y = barrel.pos.y - 18;\r\n        }\r\n\r\n        if (healthBarFill.exists()) {\r\n            healthBarFill.pos.x = barrel.pos.x - 11;\r\n            healthBarFill.pos.y = barrel.pos.y - 18;\r\n            healthBarFill.width = 22 * healthPercent;\r\n\r\n            // Color based on health\r\n            if (healthPercent <= 0.33) {\r\n                healthBarFill.color = k.rgb(255, 50, 50);\r\n            } else if (healthPercent <= 0.66) {\r\n                healthBarFill.color = k.rgb(255, 150, 50);\r\n            }\r\n        }\r\n\r\n        // Update barrel color based on damage\r\n        if (healthPercent <= 0.33) {\r\n            barrel.color = k.rgb(...config.CRITICAL_COLOR);\r\n            // Add shake effect when critical\r\n            barrel.pos.x += (Math.random() - 0.5) * 2;\r\n            barrel.pos.y += (Math.random() - 0.5) * 2;\r\n        } else if (healthPercent <= 0.66) {\r\n            barrel.color = k.rgb(...config.DAMAGED_COLOR);\r\n        }\r\n    };\r\n\r\n    // Take damage from any source\r\n    barrel.takeDamage = (damage = 1, sourceId = null, fromNetwork = false) => {\r\n        if (barrel.isExploding || !barrel.exists()) return;\r\n\r\n        barrel.currentHealth -= damage;\r\n        barrel.updateHealthBar();\r\n\r\n        // Broadcast damage in multiplayer (only host broadcasts, and only if not from network)\r\n        if (!fromNetwork && isMultiplayerActive() && isHost()) {\r\n            broadcast('barrel_damage', {\r\n                x: barrel.pos.x,\r\n                y: barrel.pos.y,\r\n                damage: damage,\r\n                currentHealth: barrel.currentHealth\r\n            });\r\n        }\r\n\r\n        // Flash effect\r\n        const originalColor = barrel.color;\r\n        barrel.color = k.rgb(255, 255, 255);\r\n        k.wait(0.05, () => {\r\n            if (barrel.exists()) {\r\n                barrel.updateHealthBar(); // Restore color based on health\r\n            }\r\n        });\r\n\r\n        // Check for destruction\r\n        if (barrel.currentHealth <= 0) {\r\n            barrel.explode(sourceId);\r\n        }\r\n    };\r\n\r\n    // Explode the barrel\r\n    barrel.explode = (sourceId = null) => {\r\n        if (barrel.isExploding || !barrel.exists()) return;\r\n        barrel.isExploding = true;\r\n\r\n        const explosionX = barrel.pos.x;\r\n        const explosionY = barrel.pos.y;\r\n\r\n        // Broadcast explosion in multiplayer\r\n        if (isMultiplayerActive() && isHost()) {\r\n            broadcast('barrel_explode', {\r\n                barrelId: barrel.barrelId,\r\n                x: explosionX,\r\n                y: explosionY,\r\n                radius: barrel.explosionRadius,\r\n                damage: barrel.explosionDamage\r\n            });\r\n        }\r\n\r\n        // Create explosion visual\r\n        createExplosionEffect(k, explosionX, explosionY, barrel.explosionRadius);\r\n\r\n        // Deal damage to entities in range\r\n        dealExplosionDamage(k, explosionX, explosionY, barrel.explosionRadius, barrel.explosionDamage, barrel.knockbackForce, sourceId);\r\n\r\n        // Trigger chain reactions after delay\r\n        k.wait(barrel.chainDelay, () => {\r\n            triggerChainReaction(k, explosionX, explosionY, barrel.explosionRadius, barrel.barrelId);\r\n        });\r\n\r\n        // Cleanup\r\n        if (healthBarBg.exists()) k.destroy(healthBarBg);\r\n        if (healthBarFill.exists()) k.destroy(healthBarFill);\r\n\r\n        // Remove from tracking\r\n        allBarrels = allBarrels.filter(b => b !== barrel);\r\n\r\n        k.destroy(barrel);\r\n    };\r\n\r\n    // Add to tracking array\r\n    allBarrels.push(barrel);\r\n\r\n    return barrel;\r\n}\r\n\r\n/**\r\n * Create explosion visual effect\r\n */\r\nfunction createExplosionEffect(k, x, y, radius) {\r\n    // Outer explosion ring\r\n    const outerRing = k.add([\r\n        k.circle(radius),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(255, 150, 50),\r\n        k.opacity(0.8),\r\n        k.scale(1),\r\n        k.z(100),\r\n        'explosionEffect'\r\n    ]);\r\n\r\n    // Inner explosion\r\n    const innerRing = k.add([\r\n        k.circle(radius * 0.6),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(255, 255, 150),\r\n        k.opacity(0.9),\r\n        k.scale(1),\r\n        k.z(101),\r\n        'explosionEffect'\r\n    ]);\r\n\r\n    // Core flash\r\n    const core = k.add([\r\n        k.text('*', { size: 40 }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(255, 255, 255),\r\n        k.opacity(1),\r\n        k.scale(1),\r\n        k.z(102),\r\n        'explosionEffect'\r\n    ]);\r\n\r\n    // Animate and fade out\r\n    k.tween(outerRing.scale, k.vec2(1.5, 1.5), 0.2, (val) => outerRing.scale = val);\r\n    k.tween(outerRing.opacity, 0, 0.3, (val) => outerRing.opacity = val, k.easings.easeOutQuad).onEnd(() => {\r\n        if (outerRing.exists()) k.destroy(outerRing);\r\n    });\r\n\r\n    k.tween(innerRing.scale, k.vec2(1.3, 1.3), 0.15, (val) => innerRing.scale = val);\r\n    k.tween(innerRing.opacity, 0, 0.25, (val) => innerRing.opacity = val, k.easings.easeOutQuad).onEnd(() => {\r\n        if (innerRing.exists()) k.destroy(innerRing);\r\n    });\r\n\r\n    k.tween(core.scale, k.vec2(2, 2), 0.1, (val) => core.scale = val);\r\n    k.tween(core.opacity, 0, 0.2, (val) => core.opacity = val).onEnd(() => {\r\n        if (core.exists()) k.destroy(core);\r\n    });\r\n\r\n    // Spawn debris particles\r\n    for (let i = 0; i < 8; i++) {\r\n        const angle = (Math.PI * 2 * i) / 8;\r\n        const speed = 100 + Math.random() * 100;\r\n\r\n        const debris = k.add([\r\n            k.text(['#', '*', '+', '~'][Math.floor(Math.random() * 4)], { size: 12 }),\r\n            k.pos(x, y),\r\n            k.anchor('center'),\r\n            k.color(255, 150 + Math.random() * 100, 50),\r\n            k.opacity(1),\r\n            k.z(99),\r\n            'explosionDebris'\r\n        ]);\r\n\r\n        const targetX = x + Math.cos(angle) * speed;\r\n        const targetY = y + Math.sin(angle) * speed;\r\n\r\n        k.tween(debris.pos, k.vec2(targetX, targetY), 0.4, (val) => debris.pos = val, k.easings.easeOutQuad);\r\n        k.tween(debris.opacity, 0, 0.4, (val) => debris.opacity = val).onEnd(() => {\r\n            if (debris.exists()) k.destroy(debris);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Deal explosion damage to all entities in range\r\n */\r\nfunction dealExplosionDamage(k, x, y, radius, damage, knockbackForce, sourceId) {\r\n    // Damage enemies\r\n    k.get('enemy').forEach(enemy => {\r\n        if (!enemy.exists()) return;\r\n\r\n        const dist = k.vec2(enemy.pos.x - x, enemy.pos.y - y).len();\r\n        if (dist <= radius) {\r\n            // Damage falls off with distance\r\n            const falloff = 1 - (dist / radius) * 0.5;\r\n            const finalDamage = Math.floor(damage * falloff);\r\n\r\n            if (enemy.takeDamage) {\r\n                enemy.takeDamage(finalDamage);\r\n            } else if (enemy.hp) {\r\n                enemy.hurt(finalDamage);\r\n            }\r\n\r\n            // Apply knockback\r\n            if (dist > 0) {\r\n                const dir = k.vec2(enemy.pos.x - x, enemy.pos.y - y).unit();\r\n                const knockback = knockbackForce * falloff;\r\n                enemy.pos.x += dir.x * knockback * 0.1;\r\n                enemy.pos.y += dir.y * knockback * 0.1;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Damage minibosses\r\n    k.get('miniboss').forEach(miniboss => {\r\n        if (!miniboss.exists()) return;\r\n\r\n        const dist = k.vec2(miniboss.pos.x - x, miniboss.pos.y - y).len();\r\n        if (dist <= radius) {\r\n            const falloff = 1 - (dist / radius) * 0.5;\r\n            const finalDamage = Math.floor(damage * falloff);\r\n\r\n            if (miniboss.takeDamage) {\r\n                miniboss.takeDamage(finalDamage, null);\r\n            }\r\n        }\r\n    });\r\n\r\n    // Damage bosses\r\n    k.get('boss').forEach(boss => {\r\n        if (!boss.exists()) return;\r\n\r\n        const dist = k.vec2(boss.pos.x - x, boss.pos.y - y).len();\r\n        if (dist <= radius) {\r\n            const falloff = 1 - (dist / radius) * 0.5;\r\n            const finalDamage = Math.floor(damage * falloff);\r\n\r\n            if (boss.takeDamage) {\r\n                boss.takeDamage(finalDamage, null);\r\n            }\r\n        }\r\n    });\r\n\r\n    // Damage players\r\n    k.get('player').forEach(player => {\r\n        if (!player.exists() || player.isDead) return;\r\n\r\n        const dist = k.vec2(player.pos.x - x, player.pos.y - y).len();\r\n        if (dist <= radius) {\r\n            const falloff = 1 - (dist / radius) * 0.5;\r\n            const finalDamage = Math.floor(damage * falloff * 0.5); // Players take half damage\r\n\r\n            // Check invulnerability\r\n            if (!player.invulnerable) {\r\n                player.hurt(finalDamage);\r\n\r\n                // Apply knockback\r\n                if (dist > 0) {\r\n                    const dir = k.vec2(player.pos.x - x, player.pos.y - y).unit();\r\n                    const knockback = knockbackForce * falloff;\r\n                    player.pos.x += dir.x * knockback * 0.05;\r\n                    player.pos.y += dir.y * knockback * 0.05;\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Trigger chain reaction with nearby barrels\r\n */\r\nfunction triggerChainReaction(k, x, y, radius, sourceBarrelId) {\r\n    // Find barrels in range (slightly larger than explosion for chain feel)\r\n    const chainRadius = radius * 1.2;\r\n\r\n    allBarrels.forEach(barrel => {\r\n        if (!barrel.exists() || barrel.isExploding || barrel.barrelId === sourceBarrelId) return;\r\n\r\n        const dist = k.vec2(barrel.pos.x - x, barrel.pos.y - y).len();\r\n        if (dist <= chainRadius) {\r\n            // Damage the barrel, potentially causing it to explode\r\n            barrel.takeDamage(barrel.maxHealth, sourceBarrelId); // Instant kill for chain\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Get all active barrels\r\n */\r\nexport function getAllBarrels() {\r\n    return allBarrels.filter(b => b.exists());\r\n}\r\n\r\n/**\r\n * Find a barrel by position (for multiplayer sync)\r\n * Uses position matching since IDs may differ between host/client\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n * @param {number} tolerance - Position tolerance (default 5)\r\n * @returns {object|null} - Barrel entity or null\r\n */\r\nexport function findBarrelByPosition(x, y, tolerance = 5) {\r\n    return allBarrels.find(barrel => {\r\n        if (!barrel.exists() || barrel.isExploding) return false;\r\n        const dx = Math.abs(barrel.pos.x - x);\r\n        const dy = Math.abs(barrel.pos.y - y);\r\n        return dx <= tolerance && dy <= tolerance;\r\n    }) || null;\r\n}\r\n\r\n/**\r\n * Clear all barrels (for room transitions)\r\n */\r\nexport function clearAllBarrels() {\r\n    allBarrels.forEach(barrel => {\r\n        if (barrel.exists()) {\r\n            if (barrel.healthBarBg && barrel.healthBarBg.exists()) {\r\n                barrel.healthBarBg.destroy();\r\n            }\r\n            if (barrel.healthBarFill && barrel.healthBarFill.exists()) {\r\n                barrel.healthBarFill.destroy();\r\n            }\r\n            barrel.destroy();\r\n        }\r\n    });\r\n    allBarrels = [];\r\n}\r\n\r\n/**\r\n * Handle barrel collision with projectiles\r\n * Call this from the combat system\r\n */\r\nexport function handleProjectileBarrelCollision(k, projectile, barrel) {\r\n    if (!barrel.exists() || barrel.isExploding) return;\r\n\r\n    barrel.takeDamage(1);\r\n\r\n    // Destroy the projectile unless it pierces\r\n    if (!projectile.piercing || projectile.piercing <= 0) {\r\n        if (projectile.exists()) k.destroy(projectile);\r\n    }\r\n}\r\n\r\nexport { BARREL_CONFIG };\r\n","/**\r\n * Spatial Grid System\r\n *\r\n * Divides the game world into a grid of cells to efficiently query nearby entities.\r\n * Instead of checking all entities (O(n)), we only check entities in nearby cells.\r\n *\r\n * Performance improvement:\r\n * - Without grid: Check all N entities = O(n)\r\n * - With grid: Check only entities in nearby cells = O(1) average case\r\n *\r\n * Example:\r\n * - 100 entities spread across 10x10 grid = ~1 entity per cell\r\n * - Query nearby entities: Check 9 cells (3x3) = ~9 entities instead of 100\r\n * - 11x speedup!\r\n */\r\n\r\nexport class SpatialGrid {\r\n    /**\r\n     * Create a spatial grid\r\n     * @param {number} cellSize - Size of each grid cell in pixels (default: 128)\r\n     */\r\n    constructor(cellSize = 128) {\r\n        this.cellSize = cellSize;\r\n        this.cells = new Map(); // Map of \"x,y\" -> Set of entities\r\n        this.entityToCell = new Map(); // Map of entity -> \"x,y\" for fast removal\r\n    }\r\n\r\n    /**\r\n     * Get the cell key for a position\r\n     * @param {number} x - X coordinate\r\n     * @param {number} y - Y coordinate\r\n     * @returns {string} Cell key \"x,y\"\r\n     */\r\n    getCellKey(x, y) {\r\n        const cellX = Math.floor(x / this.cellSize);\r\n        const cellY = Math.floor(y / this.cellSize);\r\n        return `${cellX},${cellY}`;\r\n    }\r\n\r\n    /**\r\n     * Insert an entity into the grid\r\n     * @param {Object} entity - Entity with pos.x and pos.y\r\n     */\r\n    insert(entity) {\r\n        if (!entity || !entity.pos) return;\r\n\r\n        const key = this.getCellKey(entity.pos.x, entity.pos.y);\r\n\r\n        // Create cell if it doesn't exist\r\n        if (!this.cells.has(key)) {\r\n            this.cells.set(key, new Set());\r\n        }\r\n\r\n        // Add entity to cell\r\n        this.cells.get(key).add(entity);\r\n\r\n        // Track which cell this entity is in\r\n        this.entityToCell.set(entity, key);\r\n    }\r\n\r\n    /**\r\n     * Remove an entity from the grid\r\n     * @param {Object} entity - Entity to remove\r\n     */\r\n    remove(entity) {\r\n        if (!entity) return;\r\n\r\n        const key = this.entityToCell.get(entity);\r\n        if (!key) return;\r\n\r\n        // Remove from cell\r\n        const cell = this.cells.get(key);\r\n        if (cell) {\r\n            cell.delete(entity);\r\n            // Clean up empty cells to save memory\r\n            if (cell.size === 0) {\r\n                this.cells.delete(key);\r\n            }\r\n        }\r\n\r\n        // Remove tracking\r\n        this.entityToCell.delete(entity);\r\n    }\r\n\r\n    /**\r\n     * Update an entity's position in the grid\r\n     * Call this when an entity moves\r\n     * @param {Object} entity - Entity that moved\r\n     */\r\n    update(entity) {\r\n        if (!entity || !entity.pos) return;\r\n\r\n        const oldKey = this.entityToCell.get(entity);\r\n        const newKey = this.getCellKey(entity.pos.x, entity.pos.y);\r\n\r\n        // Only update if entity changed cells\r\n        if (oldKey !== newKey) {\r\n            this.remove(entity);\r\n            this.insert(entity);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get all entities within a radius of a point\r\n     * @param {number} x - Center X coordinate\r\n     * @param {number} y - Center Y coordinate\r\n     * @param {number} radius - Search radius\r\n     * @returns {Array} Array of entities within radius\r\n     */\r\n    getNearby(x, y, radius) {\r\n        const results = [];\r\n\r\n        // Calculate which cells to check\r\n        const cellRadius = Math.ceil(radius / this.cellSize);\r\n        const centerKey = this.getCellKey(x, y);\r\n        const [cx, cy] = centerKey.split(',').map(Number);\r\n\r\n        // Check this cell and all surrounding cells within radius\r\n        for (let dx = -cellRadius; dx <= cellRadius; dx++) {\r\n            for (let dy = -cellRadius; dy <= cellRadius; dy++) {\r\n                const key = `${cx + dx},${cy + dy}`;\r\n                const cell = this.cells.get(key);\r\n\r\n                if (cell) {\r\n                    // Add all entities from this cell\r\n                    results.push(...cell);\r\n                }\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Get all entities in a bounding box\r\n     * @param {number} minX - Minimum X coordinate\r\n     * @param {number} minY - Minimum Y coordinate\r\n     * @param {number} maxX - Maximum X coordinate\r\n     * @param {number} maxY - Maximum Y coordinate\r\n     * @returns {Array} Array of entities in bounding box\r\n     */\r\n    getInBounds(minX, minY, maxX, maxY) {\r\n        const results = [];\r\n\r\n        // Calculate cell range\r\n        const minCellX = Math.floor(minX / this.cellSize);\r\n        const minCellY = Math.floor(minY / this.cellSize);\r\n        const maxCellX = Math.floor(maxX / this.cellSize);\r\n        const maxCellY = Math.floor(maxY / this.cellSize);\r\n\r\n        // Check all cells in range\r\n        for (let cx = minCellX; cx <= maxCellX; cx++) {\r\n            for (let cy = minCellY; cy <= maxCellY; cy++) {\r\n                const key = `${cx},${cy}`;\r\n                const cell = this.cells.get(key);\r\n\r\n                if (cell) {\r\n                    results.push(...cell);\r\n                }\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Get all entities at a specific position (same cell)\r\n     * @param {number} x - X coordinate\r\n     * @param {number} y - Y coordinate\r\n     * @returns {Array} Array of entities in the same cell\r\n     */\r\n    getAt(x, y) {\r\n        const key = this.getCellKey(x, y);\r\n        const cell = this.cells.get(key);\r\n        return cell ? [...cell] : [];\r\n    }\r\n\r\n    /**\r\n     * Clear all entities from the grid\r\n     */\r\n    clear() {\r\n        this.cells.clear();\r\n        this.entityToCell.clear();\r\n    }\r\n\r\n    /**\r\n     * Get statistics about the grid (for debugging)\r\n     * @returns {Object} Grid statistics\r\n     */\r\n    getStats() {\r\n        let totalEntities = 0;\r\n        let maxEntitiesInCell = 0;\r\n        let minEntitiesInCell = Infinity;\r\n\r\n        this.cells.forEach(cell => {\r\n            const count = cell.size;\r\n            totalEntities += count;\r\n            maxEntitiesInCell = Math.max(maxEntitiesInCell, count);\r\n            minEntitiesInCell = Math.min(minEntitiesInCell, count);\r\n        });\r\n\r\n        return {\r\n            cellCount: this.cells.size,\r\n            totalEntities,\r\n            averageEntitiesPerCell: this.cells.size > 0 ? (totalEntities / this.cells.size).toFixed(2) : 0,\r\n            maxEntitiesInCell,\r\n            minEntitiesInCell: minEntitiesInCell === Infinity ? 0 : minEntitiesInCell,\r\n            cellSize: this.cellSize\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Helper function to rebuild a spatial grid from entity array\r\n * @param {SpatialGrid} grid - Grid to rebuild\r\n * @param {Array} entities - Array of entities to insert\r\n */\r\nexport function rebuildGrid(grid, entities) {\r\n    grid.clear();\r\n    entities.forEach(entity => grid.insert(entity));\r\n}\r\n","/**\r\n * Programmatic Bit Sound System\r\n * Generates retro-style sounds using Web Audio API\r\n */\r\n\r\n// Audio context singleton\r\nlet audioContext = null;\r\n\r\n// Master volume control\r\nlet masterVolume = 1.0;\r\n\r\n// Music volume control (separate from SFX)\r\nlet musicVolume = 1.0;\r\n\r\n// SFX volume control (separate from music)\r\nlet sfxVolume = 1.0;\r\n\r\n// Sound enabled flag\r\nlet soundEnabled = true;\r\n\r\n// UI sounds enabled (menu clicks, notifications)\r\nlet uiSoundsEnabled = true;\r\n\r\n// Combat sounds enabled (hit sounds, abilities)\r\nlet combatSoundsEnabled = true;\r\n\r\n// Music playback state\r\nlet currentMusic = null;\r\nlet currentMusicTrack = null;\r\nlet musicEnabled = true;\r\n\r\n// Music file paths (relative to public folder)\r\nconst MUSIC_TRACKS = {\r\n    menu: './audio/menu-theme.mp3',\r\n    combat: './audio/combat-theme.mp3',\r\n    defeat: './audio/defeat-theme.mp3'\r\n};\r\n\r\n// Preloaded audio buffers\r\nconst musicCache = {};\r\n\r\n/**\r\n * Initialize audio context (must be called after user interaction)\r\n */\r\nexport function initAudio() {\r\n  if (!audioContext) {\r\n    audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n  }\r\n  return audioContext;\r\n}\r\n\r\n/**\r\n * Resume audio context if suspended (required for browser autoplay policy)\r\n * Call this on first user interaction to enable audio\r\n */\r\nexport function resumeAudioContext() {\r\n  if (audioContext && audioContext.state === 'suspended') {\r\n    audioContext.resume().then(() => {\r\n      console.log('[Audio] AudioContext resumed');\r\n    }).catch(err => {\r\n      console.warn('[Audio] Failed to resume AudioContext:', err);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Get or create audio context\r\n */\r\nfunction getAudioContext() {\r\n  if (!audioContext) {\r\n    initAudio();\r\n  }\r\n  // Auto-resume if suspended\r\n  if (audioContext && audioContext.state === 'suspended') {\r\n    audioContext.resume();\r\n  }\r\n  return audioContext;\r\n}\r\n\r\n/**\r\n * Set master volume (0.0 to 1.0)\r\n */\r\nexport function setMasterVolume(volume) {\r\n  masterVolume = Math.max(0, Math.min(1, volume));\r\n  // Update music volume to reflect master change\r\n  if (currentMusic) {\r\n    currentMusic.volume = musicVolume * masterVolume;\r\n  }\r\n}\r\n\r\n/**\r\n * Get master volume\r\n */\r\nexport function getMasterVolume() {\r\n  return masterVolume;\r\n}\r\n\r\n/**\r\n * Set SFX volume (0.0 to 1.0)\r\n */\r\nexport function setSfxVolume(volume) {\r\n  sfxVolume = Math.max(0, Math.min(1, volume));\r\n}\r\n\r\n/**\r\n * Get SFX volume\r\n */\r\nexport function getSfxVolume() {\r\n  return sfxVolume;\r\n}\r\n\r\n/**\r\n * Enable or disable UI sounds\r\n */\r\nexport function setUiSoundsEnabled(enabled) {\r\n  uiSoundsEnabled = enabled;\r\n}\r\n\r\n/**\r\n * Enable or disable combat sounds\r\n */\r\nexport function setCombatSoundsEnabled(enabled) {\r\n  combatSoundsEnabled = enabled;\r\n}\r\n\r\n/**\r\n * Enable or disable sounds\r\n */\r\nexport function setSoundEnabled(enabled) {\r\n  soundEnabled = enabled;\r\n}\r\n\r\n/**\r\n * Play a simple tone\r\n * @param {number} frequency - Frequency in Hz\r\n * @param {number} duration - Duration in seconds\r\n * @param {string} type - Oscillator type ('sine', 'square', 'sawtooth', 'triangle')\r\n * @param {number} volume - Volume (0.0 to 1.0)\r\n * @param {object} options - Additional options (attack, decay, pitchBend, isUI, etc.)\r\n */\r\nfunction playTone(frequency, duration, type = 'square', volume = 0.3, options = {}) {\r\n  if (!soundEnabled) return;\r\n\r\n  // Check if this is a UI sound or combat sound and if those are disabled\r\n  if (options.isUI && !uiSoundsEnabled) return;\r\n  if (options.isCombat && !combatSoundsEnabled) return;\r\n\r\n  const ctx = getAudioContext();\r\n  const now = ctx.currentTime;\r\n\r\n  // Create oscillator\r\n  const osc = ctx.createOscillator();\r\n  osc.type = type;\r\n  osc.frequency.setValueAtTime(frequency, now);\r\n\r\n  // Pitch bend if specified\r\n  if (options.pitchBend) {\r\n    osc.frequency.exponentialRampToValueAtTime(\r\n      frequency * options.pitchBend,\r\n      now + duration\r\n    );\r\n  }\r\n\r\n  // Create gain node for volume envelope\r\n  const gainNode = ctx.createGain();\r\n  // Apply all volume multipliers: base volume * sfx volume * master volume\r\n  const finalVolume = volume * sfxVolume * masterVolume;\r\n\r\n  // Attack\r\n  const attack = options.attack || 0.01;\r\n  gainNode.gain.setValueAtTime(0, now);\r\n  gainNode.gain.linearRampToValueAtTime(finalVolume, now + attack);\r\n\r\n  // Decay/Release\r\n  const decay = options.decay || 0.1;\r\n  gainNode.gain.setValueAtTime(finalVolume, now + duration - decay);\r\n  gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);\r\n\r\n  // Connect nodes\r\n  osc.connect(gainNode);\r\n  gainNode.connect(ctx.destination);\r\n\r\n  // Start and stop\r\n  osc.start(now);\r\n  osc.stop(now + duration);\r\n}\r\n\r\n/**\r\n * Play white noise burst\r\n * @param {number} duration - Duration in seconds\r\n * @param {number} volume - Volume (0.0 to 1.0)\r\n * @param {object} options - Additional options\r\n */\r\nfunction playNoise(duration, volume = 0.3, options = {}) {\r\n  if (!soundEnabled) return;\r\n\r\n  // Check if this is a combat sound and if those are disabled\r\n  if (options.isCombat && !combatSoundsEnabled) return;\r\n\r\n  const ctx = getAudioContext();\r\n  const now = ctx.currentTime;\r\n\r\n  // Create buffer with white noise\r\n  const bufferSize = ctx.sampleRate * duration;\r\n  const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);\r\n  const data = buffer.getChannelData(0);\r\n\r\n  for (let i = 0; i < bufferSize; i++) {\r\n    data[i] = Math.random() * 2 - 1;\r\n  }\r\n\r\n  // Create source\r\n  const source = ctx.createBufferSource();\r\n  source.buffer = buffer;\r\n\r\n  // Create filter for colored noise\r\n  const filter = ctx.createBiquadFilter();\r\n  filter.type = options.filterType || 'lowpass';\r\n  filter.frequency.setValueAtTime(options.filterFreq || 2000, now);\r\n\r\n  // Create gain node\r\n  const gainNode = ctx.createGain();\r\n  // Apply all volume multipliers: base volume * sfx volume * master volume\r\n  const finalVolume = volume * sfxVolume * masterVolume;\r\n\r\n  const attack = options.attack || 0.01;\r\n  const decay = options.decay || 0.1;\r\n\r\n  gainNode.gain.setValueAtTime(0, now);\r\n  gainNode.gain.linearRampToValueAtTime(finalVolume, now + attack);\r\n  gainNode.gain.setValueAtTime(finalVolume, now + duration - decay);\r\n  gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);\r\n\r\n  // Connect nodes\r\n  source.connect(filter);\r\n  filter.connect(gainNode);\r\n  gainNode.connect(ctx.destination);\r\n\r\n  source.start(now);\r\n  source.stop(now + duration);\r\n}\r\n\r\n/**\r\n * Random variation helper\r\n */\r\nfunction vary(value, amount = 0.1) {\r\n  return value * (1 + (Math.random() - 0.5) * amount);\r\n}\r\n\r\n/**\r\n * Random choice helper\r\n */\r\nfunction choice(array) {\r\n  return array[Math.floor(Math.random() * array.length)];\r\n}\r\n\r\n// ==================== WEAPON FIRING SOUNDS ====================\r\n\r\n/**\r\n * Pistol fire sound\r\n */\r\nexport function playPistolFire() {\r\n  const variation = Math.random();\r\n\r\n  if (variation < 0.33) {\r\n    // Smooth pop with triangle wave\r\n    playTone(vary(280, 0.15), 0.08, 'triangle', 0.14, {\r\n      attack: 0.002,\r\n      decay: 0.05,\r\n      pitchBend: 0.65\r\n    });\r\n  } else if (variation < 0.66) {\r\n    // Softer shot with sine wave\r\n    playTone(vary(320, 0.15), 0.09, 'sine', 0.13, {\r\n      attack: 0.003,\r\n      decay: 0.06,\r\n      pitchBend: 0.7\r\n    });\r\n  } else {\r\n    // Crisp but pleasant with triangle\r\n    playTone(vary(300, 0.15), 0.07, 'triangle', 0.14, {\r\n      attack: 0.002,\r\n      decay: 0.04,\r\n      pitchBend: 0.6\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * SMG fire sound (rapid, lighter)\r\n */\r\nexport function playSMGFire() {\r\n  const variation = Math.random();\r\n\r\n  if (variation < 0.33) {\r\n    playTone(vary(220, 0.3), 0.04, 'triangle', 0.08, {\r\n      attack: 0.001,\r\n      decay: 0.025,\r\n      pitchBend: 0.5\r\n    });\r\n  } else if (variation < 0.66) {\r\n    playTone(vary(240, 0.3), 0.035, 'sine', 0.09, {\r\n      attack: 0.001,\r\n      decay: 0.02,\r\n      pitchBend: 0.6\r\n    });\r\n  } else {\r\n    playTone(vary(200, 0.3), 0.045, 'triangle', 0.08, {\r\n      attack: 0.001,\r\n      decay: 0.03,\r\n      pitchBend: 0.4\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Shotgun fire sound (deep boom with noise)\r\n */\r\nexport function playShotgunFire() {\r\n  // Soft thump - much more pleasant\r\n  const freq = vary(60, 0.15);\r\n  playTone(freq, 0.1, 'sine', 0.12, {\r\n    attack: 0.002,\r\n    decay: 0.08,\r\n    pitchBend: 0.4\r\n  });\r\n\r\n  // Gentle noise - reduced volume and filtered lower\r\n  playNoise(vary(0.04, 0.2), vary(0.12, 0.2), {\r\n    attack: 0.002,\r\n    decay: 0.06,\r\n    filterType: 'lowpass',\r\n    filterFreq: vary(800, 0.3)\r\n  });\r\n}\r\n\r\n/**\r\n * Sniper fire sound (sharp, high-impact)\r\n */\r\nexport function playSniperFire() {\r\n  // Clean crack with triangle wave\r\n  playTone(vary(350, 0.2), 0.05, 'triangle', 0.12, {\r\n    attack: 0.001,\r\n    decay: 0.03,\r\n    pitchBend: 0.3\r\n  });\r\n\r\n  // Low frequency thump\r\n  playTone(vary(50, 0.15), 0.1, 'sine', 0.1, {\r\n    attack: 0.001,\r\n    decay: 0.07,\r\n    pitchBend: 0.5\r\n  });\r\n}\r\n\r\n/**\r\n * Flamethrower sound (continuous crackle - call repeatedly)\r\n */\r\nexport function playFlamethrowerFire() {\r\n  playNoise(0.08, vary(0.15, 0.4), {\r\n    attack: 0.005,\r\n    decay: 0.04,\r\n    filterType: 'bandpass',\r\n    filterFreq: vary(800, 0.5)\r\n  });\r\n}\r\n\r\n/**\r\n * Explosive launcher sound\r\n */\r\nexport function playExplosiveFire() {\r\n  // Deep thump - softer\r\n  playTone(vary(55, 0.2), 0.15, 'sine', 0.1, {\r\n    attack: 0.002,\r\n    decay: 0.12,\r\n    pitchBend: 0.4\r\n  });\r\n\r\n  // Mid-range whomp - triangle for smoothness\r\n  playTone(vary(100, 0.2), 0.12, 'triangle', 0.08, {\r\n    attack: 0.005,\r\n    decay: 0.08,\r\n    pitchBend: 0.5\r\n  });\r\n}\r\n\r\n/**\r\n * Chain lightning sound\r\n */\r\nexport function playChainLightningFire() {\r\n  // Electric zap - ascending pitch, softer\r\n  playTone(vary(250, 0.3), 0.08, 'triangle', 0.1, {\r\n    attack: 0.001,\r\n    decay: 0.06,\r\n    pitchBend: 1.6\r\n  });\r\n\r\n  // Subtle crackle - much quieter\r\n  playNoise(vary(0.03, 0.3), 0.08, {\r\n    attack: 0.001,\r\n    decay: 0.04,\r\n    filterType: 'bandpass',\r\n    filterFreq: vary(2000, 0.4)\r\n  });\r\n}\r\n\r\n/**\r\n * Orbital weapon sound (whoosh)\r\n */\r\nexport function playOrbitalFire() {\r\n  playTone(vary(180, 0.4), 0.1, 'triangle', 0.14, {\r\n    attack: 0.02,\r\n    decay: 0.06,\r\n    pitchBend: 1.3\r\n  });\r\n}\r\n\r\n/**\r\n * Generic weapon fire (fallback)\r\n */\r\nexport function playGenericFire() {\r\n  playPistolFire();\r\n}\r\n\r\n// ==================== IMPACT SOUNDS ====================\r\n\r\n/**\r\n * Enemy hit sound - soft pop/thump\r\n */\r\nexport function playEnemyHit() {\r\n  const variation = Math.random();\r\n\r\n  if (variation < 0.25) {\r\n    // Soft pop 1\r\n    playTone(vary(280, 0.2), 0.06, 'sine', 0.12, {\r\n      attack: 0.002,\r\n      decay: 0.04,\r\n      pitchBend: 0.2\r\n    });\r\n  } else if (variation < 0.5) {\r\n    // Soft pop 2\r\n    playTone(vary(320, 0.2), 0.05, 'triangle', 0.12, {\r\n      attack: 0.002,\r\n      decay: 0.035,\r\n      pitchBend: 0.15\r\n    });\r\n  } else if (variation < 0.75) {\r\n    // Soft thump 1\r\n    playTone(vary(240, 0.2), 0.07, 'sine', 0.14, {\r\n      attack: 0.003,\r\n      decay: 0.05,\r\n      pitchBend: 0.25\r\n    });\r\n  } else {\r\n    // Soft thump 2\r\n    playTone(vary(360, 0.2), 0.05, 'triangle', 0.10, {\r\n      attack: 0.002,\r\n      decay: 0.03,\r\n      pitchBend: 0.1\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Player damage sound - softer but noticeable\r\n */\r\nexport function playPlayerHit() {\r\n  const variation = Math.random();\r\n\r\n  if (variation < 0.33) {\r\n    // Soft impact 1\r\n    playTone(vary(180, 0.2), 0.10, 'triangle', 0.18, {\r\n      attack: 0.003,\r\n      decay: 0.07,\r\n      pitchBend: 0.2\r\n    });\r\n    playTone(vary(400, 0.2), 0.06, 'sine', 0.10, {\r\n      attack: 0.005,\r\n      decay: 0.04,\r\n      pitchBend: 0.1\r\n    });\r\n  } else if (variation < 0.66) {\r\n    // Soft impact 2\r\n    playTone(vary(160, 0.2), 0.12, 'triangle', 0.18, {\r\n      attack: 0.003,\r\n      decay: 0.08,\r\n      pitchBend: 0.25\r\n    });\r\n    playTone(vary(320, 0.2), 0.07, 'sine', 0.12, {\r\n      attack: 0.005,\r\n      decay: 0.05,\r\n      pitchBend: 0.15\r\n    });\r\n  } else {\r\n    // Soft impact 3\r\n    playTone(vary(200, 0.2), 0.11, 'triangle', 0.18, {\r\n      attack: 0.003,\r\n      decay: 0.08,\r\n      pitchBend: 0.3\r\n    });\r\n    playTone(vary(440, 0.2), 0.05, 'sine', 0.08, {\r\n      attack: 0.005,\r\n      decay: 0.03,\r\n      pitchBend: 0.1\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Enemy death sound\r\n */\r\nexport function playEnemyDeath() {\r\n  const variation = Math.random();\r\n\r\n  if (variation < 0.33) {\r\n    // Descending death 1\r\n    playTone(vary(200, 0.2), 0.25, 'sawtooth', 0.2, {\r\n      attack: 0.01,\r\n      decay: 0.2,\r\n      pitchBend: 0.2\r\n    });\r\n  } else if (variation < 0.66) {\r\n    // Descending death 2\r\n    playTone(vary(180, 0.2), 0.3, 'square', 0.2, {\r\n      attack: 0.01,\r\n      decay: 0.25,\r\n      pitchBend: 0.15\r\n    });\r\n    playNoise(0.15, 0.12, {\r\n      attack: 0.05,\r\n      decay: 0.1,\r\n      filterFreq: vary(1500, 0.4)\r\n    });\r\n  } else {\r\n    // Descending death 3\r\n    playTone(vary(220, 0.2), 0.28, 'triangle', 0.2, {\r\n      attack: 0.01,\r\n      decay: 0.23,\r\n      pitchBend: 0.25\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Explosion sound\r\n */\r\nexport function playExplosion() {\r\n  const variation = Math.random();\r\n\r\n  // Deep bass boom\r\n  playTone(vary(50, 0.15), 0.3, 'sawtooth', 0.3, {\r\n    attack: 0.001,\r\n    decay: 0.25,\r\n    pitchBend: 0.3\r\n  });\r\n\r\n  // Mid-range explosion\r\n  playTone(vary(100, 0.2), 0.25, 'square', 0.25, {\r\n    attack: 0.005,\r\n    decay: 0.2,\r\n    pitchBend: 0.4\r\n  });\r\n\r\n  // Noise burst\r\n  playNoise(vary(0.3, 0.2), vary(0.25, 0.3), {\r\n    attack: 0.001,\r\n    decay: 0.25,\r\n    filterType: 'lowpass',\r\n    filterFreq: vary(1200, 0.5)\r\n  });\r\n}\r\n\r\n// ==================== UI & GAME EVENT SOUNDS ====================\r\n\r\n/**\r\n * XP pickup sound\r\n */\r\nexport function playXPPickup() {\r\n  const variation = Math.random();\r\n\r\n  if (variation < 0.33) {\r\n    playTone(vary(600, 0.2), 0.08, 'sine', 0.15, {\r\n      attack: 0.01,\r\n      decay: 0.05,\r\n      pitchBend: 1.2\r\n    });\r\n  } else if (variation < 0.66) {\r\n    playTone(vary(650, 0.2), 0.09, 'triangle', 0.15, {\r\n      attack: 0.01,\r\n      decay: 0.06,\r\n      pitchBend: 1.3\r\n    });\r\n  } else {\r\n    playTone(vary(550, 0.2), 0.1, 'sine', 0.15, {\r\n      attack: 0.01,\r\n      decay: 0.07,\r\n      pitchBend: 1.15\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Currency/cash pickup sound\r\n */\r\nexport function playCurrencyPickup() {\r\n  const variation = Math.random();\r\n\r\n  if (variation < 0.33) {\r\n    // Bright coin \"ching\" - two quick tones\r\n    playTone(vary(800, 0.2), 0.06, 'sine', 0.16, {\r\n      attack: 0.005,\r\n      decay: 0.04\r\n    });\r\n    setTimeout(() => {\r\n      playTone(vary(1000, 0.2), 0.05, 'triangle', 0.14, {\r\n        attack: 0.005,\r\n        decay: 0.03\r\n      });\r\n    }, 30);\r\n  } else if (variation < 0.66) {\r\n    // Metallic ping\r\n    playTone(vary(900, 0.2), 0.08, 'triangle', 0.16, {\r\n      attack: 0.005,\r\n      decay: 0.05,\r\n      pitchBend: 0.85\r\n    });\r\n    playTone(vary(1200, 0.2), 0.06, 'sine', 0.12, {\r\n      attack: 0.01,\r\n      decay: 0.04\r\n    });\r\n  } else {\r\n    // Cash register \"ka-ching\"\r\n    playTone(vary(750, 0.2), 0.05, 'square', 0.14, {\r\n      attack: 0.005,\r\n      decay: 0.03\r\n    });\r\n    setTimeout(() => {\r\n      playTone(vary(1100, 0.2), 0.07, 'sine', 0.16, {\r\n        attack: 0.005,\r\n        decay: 0.05\r\n      });\r\n    }, 40);\r\n  }\r\n}\r\n\r\n/**\r\n * Level up sound\r\n */\r\nexport function playLevelUp() {\r\n  const ctx = getAudioContext();\r\n  const now = ctx.currentTime;\r\n\r\n  // Ascending arpeggio\r\n  const baseFreq = 400;\r\n  const notes = [1, 1.25, 1.5, 2];\r\n\r\n  notes.forEach((mult, i) => {\r\n    setTimeout(() => {\r\n      playTone(baseFreq * mult, 0.15, 'square', 0.2, {\r\n        attack: 0.01,\r\n        decay: 0.1\r\n      });\r\n    }, i * 80);\r\n  });\r\n}\r\n\r\n/**\r\n * Door open/room transition sound\r\n */\r\nexport function playDoorOpen() {\r\n  const variation = Math.random();\r\n\r\n  // Ascending sweep\r\n  playTone(vary(200, 0.2), 0.25, 'sawtooth', 0.18, {\r\n    attack: 0.02,\r\n    decay: 0.15,\r\n    pitchBend: 1.6\r\n  });\r\n}\r\n\r\n/**\r\n * Menu select sound\r\n */\r\nexport function playMenuSelect() {\r\n  playTone(vary(500, 0.15), 0.08, 'square', 0.15, {\r\n    attack: 0.01,\r\n    decay: 0.05\r\n  });\r\n}\r\n\r\n/**\r\n * Menu navigation sound\r\n */\r\nexport function playMenuNav() {\r\n  playTone(vary(400, 0.15), 0.06, 'triangle', 0.12, {\r\n    attack: 0.01,\r\n    decay: 0.04\r\n  });\r\n}\r\n\r\n/**\r\n * Upgrade select sound\r\n */\r\nexport function playUpgradeSelect() {\r\n  // Two-tone chord\r\n  playTone(vary(500, 0.1), 0.2, 'square', 0.18, {\r\n    attack: 0.01,\r\n    decay: 0.15\r\n  });\r\n\r\n  setTimeout(() => {\r\n    playTone(vary(750, 0.1), 0.18, 'square', 0.15, {\r\n      attack: 0.01,\r\n      decay: 0.13\r\n    });\r\n  }, 50);\r\n}\r\n\r\n/**\r\n * Boss spawn sound\r\n */\r\nexport function playBossSpawn() {\r\n  // Deep ominous tone\r\n  playTone(vary(50, 0.1), 0.5, 'sawtooth', 0.25, {\r\n    attack: 0.05,\r\n    decay: 0.4,\r\n    pitchBend: 0.8\r\n  });\r\n\r\n  // High warning tone\r\n  setTimeout(() => {\r\n    playTone(vary(800, 0.2), 0.3, 'square', 0.2, {\r\n      attack: 0.01,\r\n      decay: 0.25\r\n    });\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Boss death sound\r\n */\r\nexport function playBossDeath() {\r\n  // Epic descending cascade\r\n  const baseFreq = 400;\r\n  for (let i = 0; i < 8; i++) {\r\n    setTimeout(() => {\r\n      playTone(baseFreq * (1 - i * 0.1), 0.15, 'sawtooth', 0.2, {\r\n        attack: 0.01,\r\n        decay: 0.1\r\n      });\r\n    }, i * 60);\r\n  }\r\n\r\n  // Final explosion\r\n  setTimeout(() => {\r\n    playExplosion();\r\n  }, 480);\r\n}\r\n\r\n/**\r\n * Achievement unlocked sound\r\n */\r\nexport function playAchievement() {\r\n  // Triumphant fanfare\r\n  const notes = [400, 500, 600, 800];\r\n  notes.forEach((freq, i) => {\r\n    setTimeout(() => {\r\n      playTone(freq, 0.2, 'square', 0.18, {\r\n        attack: 0.01,\r\n        decay: 0.15\r\n      });\r\n    }, i * 100);\r\n  });\r\n}\r\n\r\n/**\r\n * Purchase success sound\r\n */\r\nexport function playPurchaseSuccess() {\r\n  // Positive ascending chime\r\n  playTone(vary(600, 0.1), 0.15, 'sine', 0.2, {\r\n    attack: 0.01,\r\n    decay: 0.1\r\n  });\r\n\r\n  setTimeout(() => {\r\n    playTone(vary(800, 0.1), 0.2, 'sine', 0.18, {\r\n      attack: 0.01,\r\n      decay: 0.15\r\n    });\r\n  }, 80);\r\n}\r\n\r\n/**\r\n * Purchase error / insufficient funds sound\r\n */\r\nexport function playPurchaseError() {\r\n  // Negative buzz\r\n  playTone(vary(150, 0.1), 0.2, 'sawtooth', 0.2, {\r\n    attack: 0.01,\r\n    decay: 0.15,\r\n    pitchBend: 0.7\r\n  });\r\n\r\n  playNoise(0.1, 0.15, {\r\n    attack: 0.01,\r\n    decay: 0.08,\r\n    filterType: 'lowpass',\r\n    filterFreq: vary(500, 0.3)\r\n  });\r\n}\r\n\r\n/**\r\n * Pause sound\r\n */\r\nexport function playPause() {\r\n  playTone(vary(400, 0.1), 0.08, 'square', 0.15, {\r\n    attack: 0.01,\r\n    decay: 0.05,\r\n    pitchBend: 0.8\r\n  });\r\n}\r\n\r\n/**\r\n * Unpause sound\r\n */\r\nexport function playUnpause() {\r\n  playTone(vary(400, 0.1), 0.08, 'square', 0.15, {\r\n    attack: 0.01,\r\n    decay: 0.05,\r\n    pitchBend: 1.2\r\n  });\r\n}\r\n\r\n// ==================== WEAPON TYPE MAPPING ====================\r\n\r\n/**\r\n * Play weapon fire sound based on weapon type\r\n * @param {string} weaponType - The weapon type identifier\r\n */\r\nexport function playWeaponFire(weaponType) {\r\n  const weaponName = weaponType?.toLowerCase() || '';\r\n\r\n  if (weaponName.includes('pistol')) {\r\n    playPistolFire();\r\n  } else if (weaponName.includes('smg') || weaponName.includes('submachine')) {\r\n    playSMGFire();\r\n  } else if (weaponName.includes('shotgun')) {\r\n    playShotgunFire();\r\n  } else if (weaponName.includes('sniper') || weaponName.includes('rifle')) {\r\n    playSniperFire();\r\n  } else if (weaponName.includes('flame') || weaponName.includes('thrower')) {\r\n    playFlamethrowerFire();\r\n  } else if (weaponName.includes('explosive') || weaponName.includes('launcher') || weaponName.includes('rocket')) {\r\n    playExplosiveFire();\r\n  } else if (weaponName.includes('chain') || weaponName.includes('lightning')) {\r\n    playChainLightningFire();\r\n  } else if (weaponName.includes('orbital')) {\r\n    playOrbitalFire();\r\n  } else {\r\n    playGenericFire();\r\n  }\r\n}\r\n\r\n// Auto-initialize on first sound play attempt\r\nexport function ensureAudioContext() {\r\n  return getAudioContext();\r\n}\r\n\r\n// ==================== MUSIC PLAYBACK ====================\r\n\r\n/**\r\n * Set music volume (0.0 to 1.0)\r\n * @param {number} volume - Volume level\r\n */\r\nexport function setMusicVolume(volume) {\r\n    musicVolume = Math.max(0, Math.min(1, volume));\r\n    if (currentMusic) {\r\n        currentMusic.volume = musicVolume * masterVolume;\r\n    }\r\n}\r\n\r\n/**\r\n * Enable or disable music\r\n * @param {boolean} enabled\r\n */\r\nexport function setMusicEnabled(enabled) {\r\n    musicEnabled = enabled;\r\n    if (!enabled && currentMusic) {\r\n        stopMusic();\r\n    }\r\n}\r\n\r\n/**\r\n * Stop currently playing music\r\n */\r\nexport function stopMusic() {\r\n    if (currentMusic) {\r\n        currentMusic.pause();\r\n        currentMusic.currentTime = 0;\r\n        currentMusic = null;\r\n        currentMusicTrack = null;\r\n    }\r\n}\r\n\r\n/**\r\n * Play a music track\r\n * @param {string} trackName - 'menu' or 'combat'\r\n * @param {boolean} loop - Whether to loop the track\r\n */\r\nfunction playMusicTrack(trackName, loop = true) {\r\n    if (!musicEnabled) return;\r\n\r\n    // Don't restart if same track is already playing\r\n    if (currentMusicTrack === trackName && currentMusic && !currentMusic.paused) {\r\n        return;\r\n    }\r\n\r\n    // Stop current music\r\n    stopMusic();\r\n\r\n    const trackPath = MUSIC_TRACKS[trackName];\r\n    if (!trackPath) {\r\n        console.warn(`[Music] Unknown track: ${trackName}`);\r\n        return;\r\n    }\r\n\r\n    try {\r\n        // Use cached audio element or create new one\r\n        if (!musicCache[trackName]) {\r\n            musicCache[trackName] = new Audio(trackPath);\r\n        }\r\n\r\n        currentMusic = musicCache[trackName];\r\n        currentMusic.loop = loop;\r\n        currentMusic.volume = musicVolume * masterVolume;\r\n        currentMusicTrack = trackName;\r\n\r\n        // Play with error handling\r\n        const playPromise = currentMusic.play();\r\n        if (playPromise !== undefined) {\r\n            playPromise.catch(error => {\r\n                console.warn(`[Music] Playback failed for ${trackName}:`, error.message);\r\n            });\r\n        }\r\n    } catch (error) {\r\n        console.warn(`[Music] Failed to play ${trackName}:`, error.message);\r\n    }\r\n}\r\n\r\n/**\r\n * Play menu theme music\r\n */\r\nexport function playMenuMusic() {\r\n    playMusicTrack('menu');\r\n}\r\n\r\n/**\r\n * Play combat/gameplay theme music\r\n */\r\nexport function playCombatMusic() {\r\n    playMusicTrack('combat');\r\n}\r\n\r\n/**\r\n * Play defeat/game over theme music\r\n */\r\nexport function playDefeatMusic() {\r\n    playMusicTrack('defeat');\r\n}\r\n\r\n/**\r\n * Check if music is currently playing\r\n * @returns {boolean}\r\n */\r\nexport function isMusicPlaying() {\r\n    return currentMusic && !currentMusic.paused;\r\n}\r\n\r\n/**\r\n * Get current music track name\r\n * @returns {string|null}\r\n */\r\nexport function getCurrentMusicTrack() {\r\n    return currentMusicTrack;\r\n}\r\n","/**\r\n * Particle System\r\n *\r\n * Handles visual particle effects including:\r\n * - Blood splatters on damage\r\n * - Death explosions\r\n * - Hit impact effects\r\n * - Generic particle spawning\r\n * - Object pooling for performance\r\n */\r\n\r\nimport { getParticlePool } from './objectPool.js';\r\n\r\n/**\r\n * Create a single particle (with optional pooling)\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n * @param {Object} options - Particle options\r\n * @returns {Object} - Particle game object\r\n */\r\nfunction createParticle(k, x, y, options = {}) {\r\n    // Try to use object pool for better performance\r\n    const pool = getParticlePool();\r\n    if (pool) {\r\n        return pool.acquire(x, y, options);\r\n    }\r\n\r\n    // Fall back to direct creation if pool not available\r\n    const {\r\n        char = '*',\r\n        size = 12,\r\n        color = [255, 255, 255],\r\n        velocity = { x: 0, y: 0 },\r\n        gravity = 0,\r\n        lifetime = 1.0,\r\n        fadeStart = 0.3,\r\n        friction = 0.95,\r\n        zIndex = 100\r\n    } = options;\r\n\r\n    const particle = k.add([\r\n        k.text(char, { size }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...color),\r\n        k.z(zIndex),\r\n        'particle'\r\n    ]);\r\n\r\n    // Particle physics properties\r\n    particle.velocity = { x: velocity.x, y: velocity.y };\r\n    particle.gravity = gravity;\r\n    particle.friction = friction;\r\n    particle.lifetime = lifetime;\r\n    particle.fadeStart = fadeStart;\r\n    particle.age = 0;\r\n    particle.initialOpacity = 1.0;\r\n\r\n    return particle;\r\n}\r\n\r\n/**\r\n * Release a particle back to the pool or destroy it\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} particle - The particle to release\r\n */\r\nfunction releaseParticle(k, particle) {\r\n    const pool = getParticlePool();\r\n    if (pool && particle._pooled) {\r\n        pool.release(particle);\r\n    } else {\r\n        k.destroy(particle);\r\n    }\r\n}\r\n\r\n/**\r\n * Update all particles (call this in onUpdate)\r\n * @param {Object} k - Kaplay instance\r\n */\r\nexport function updateParticles(k) {\r\n    const particles = k.get('particle');\r\n\r\n    particles.forEach(particle => {\r\n        if (!particle.exists()) return;\r\n        if (particle.hidden) return; // Skip pooled hidden particles\r\n\r\n        // Update age\r\n        particle.age += k.dt();\r\n\r\n        // Check if particle should be released/destroyed\r\n        if (particle.age >= particle.lifetime) {\r\n            releaseParticle(k, particle);\r\n            return;\r\n        }\r\n\r\n        // Apply velocity\r\n        particle.pos.x += particle.velocity.x * k.dt() * 60;\r\n        particle.pos.y += particle.velocity.y * k.dt() * 60;\r\n\r\n        // Apply gravity\r\n        particle.velocity.y += particle.gravity * k.dt() * 60;\r\n\r\n        // Apply friction\r\n        particle.velocity.x *= particle.friction;\r\n        particle.velocity.y *= particle.friction;\r\n\r\n        // Fade out based on lifetime\r\n        const lifetimePercent = particle.age / particle.lifetime;\r\n        if (lifetimePercent >= particle.fadeStart) {\r\n            const fadePercent = (lifetimePercent - particle.fadeStart) / (1 - particle.fadeStart);\r\n            particle.opacity = particle.initialOpacity * (1 - fadePercent);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Spawn blood splatter particles\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n * @param {Object} options - Blood splatter options\r\n */\r\nexport function spawnBloodSplatter(k, x, y, options = {}) {\r\n    const {\r\n        count = 8,\r\n        color = [255, 50, 50],\r\n        speed = 2,\r\n        isCrit = false\r\n    } = options;\r\n\r\n    const chars = ['.', ',', \"'\", '`', '*'];\r\n    const actualCount = isCrit ? count * 1.5 : count;\r\n    const actualSpeed = isCrit ? speed * 1.5 : speed;\r\n    const actualColor = isCrit ? [255, 200, 0] : color;\r\n\r\n    for (let i = 0; i < actualCount; i++) {\r\n        // Random direction\r\n        const angle = (Math.PI * 2 * i) / actualCount + (Math.random() - 0.5) * 0.5;\r\n        const speedMult = 0.5 + Math.random() * 0.5;\r\n        const velocity = {\r\n            x: Math.cos(angle) * actualSpeed * speedMult,\r\n            y: Math.sin(angle) * actualSpeed * speedMult\r\n        };\r\n\r\n        createParticle(k, x, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 8 + Math.random() * 6,\r\n            color: actualColor,\r\n            velocity,\r\n            gravity: 0.15,\r\n            lifetime: 0.5 + Math.random() * 0.3,\r\n            fadeStart: 0.4,\r\n            friction: 0.92\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Spawn death explosion particles\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n * @param {Object} options - Death explosion options\r\n */\r\nexport function spawnDeathExplosion(k, x, y, options = {}) {\r\n    const {\r\n        count = 8,\r\n        color = [255, 100, 100],\r\n        speed = 2.5,\r\n        isBoss = false,\r\n        isMiniboss = false\r\n    } = options;\r\n\r\n    const chars = ['*', '+', ''];\r\n    const actualCount = isBoss ? count * 2 : (isMiniboss ? count * 1.5 : count);\r\n    const actualSpeed = isBoss ? speed * 1.5 : (isMiniboss ? speed * 1.2 : speed);\r\n\r\n    // Simple burst of particles\r\n    for (let i = 0; i < actualCount; i++) {\r\n        const angle = (Math.PI * 2 * i) / actualCount + (Math.random() - 0.5) * 0.3;\r\n        const speedMult = 0.6 + Math.random() * 0.4;\r\n        const velocity = {\r\n            x: Math.cos(angle) * actualSpeed * speedMult,\r\n            y: Math.sin(angle) * actualSpeed * speedMult\r\n        };\r\n\r\n        createParticle(k, x, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 10 + Math.random() * 6,\r\n            color,\r\n            velocity,\r\n            gravity: 0.1,\r\n            lifetime: 0.5 + Math.random() * 0.3,\r\n            fadeStart: 0.2,\r\n            friction: 0.92\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Spawn hit impact particles\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n * @param {Object} direction - Direction of impact {x, y}\r\n * @param {Object} options - Hit impact options\r\n */\r\nexport function spawnHitImpact(k, x, y, direction, options = {}) {\r\n    const {\r\n        count = 5,\r\n        color = [255, 255, 100],\r\n        speed = 2.5,\r\n        isCrit = false\r\n    } = options;\r\n\r\n    const chars = ['', '', '', ''];\r\n    const actualCount = isCrit ? count * 2 : count;\r\n    const actualColor = isCrit ? [255, 200, 0] : color;\r\n\r\n    // Normalize direction\r\n    const dirLen = Math.sqrt(direction.x * direction.x + direction.y * direction.y);\r\n    const dirNorm = dirLen > 0 ? { x: direction.x / dirLen, y: direction.y / dirLen } : { x: 1, y: 0 };\r\n\r\n    for (let i = 0; i < actualCount; i++) {\r\n        // Spread particles in a cone from impact direction\r\n        const spreadAngle = (Math.random() - 0.5) * Math.PI * 0.6; // 108 degree cone\r\n        const angle = Math.atan2(dirNorm.y, dirNorm.x) + spreadAngle;\r\n        const speedMult = 0.6 + Math.random() * 0.8;\r\n\r\n        const velocity = {\r\n            x: Math.cos(angle) * speed * speedMult,\r\n            y: Math.sin(angle) * speed * speedMult\r\n        };\r\n\r\n        createParticle(k, x, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 10 + Math.random() * 4,\r\n            color: actualColor,\r\n            velocity,\r\n            gravity: 0.05,\r\n            lifetime: 0.3 + Math.random() * 0.2,\r\n            fadeStart: 0.3,\r\n            friction: 0.88,\r\n            zIndex: 150\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Spawn generic particle burst\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n * @param {Object} options - Particle burst options\r\n */\r\nexport function spawnParticleBurst(k, x, y, options = {}) {\r\n    const {\r\n        count = 10,\r\n        char = '*',\r\n        color = [255, 255, 255],\r\n        speed = 2,\r\n        size = 12,\r\n        lifetime = 1.0,\r\n        gravity = 0.1,\r\n        friction = 0.95\r\n    } = options;\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        const angle = (Math.PI * 2 * i) / count + (Math.random() - 0.5) * 0.3;\r\n        const speedMult = 0.5 + Math.random() * 0.5;\r\n        const velocity = {\r\n            x: Math.cos(angle) * speed * speedMult,\r\n            y: Math.sin(angle) * speed * speedMult\r\n        };\r\n\r\n        createParticle(k, x, y, {\r\n            char,\r\n            size: size + Math.random() * 4,\r\n            color,\r\n            velocity,\r\n            gravity,\r\n            lifetime: lifetime + (Math.random() - 0.5) * 0.2,\r\n            fadeStart: 0.4,\r\n            friction\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Spawn XP collection particles (sparkles)\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n */\r\nexport function spawnXPSparkles(k, x, y) {\r\n    const chars = ['*', '+', ''];\r\n    const count = 5;\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        const angle = (Math.PI * 2 * i) / count;\r\n        const velocity = {\r\n            x: Math.cos(angle) * 1.5,\r\n            y: Math.sin(angle) * 1.5 - 1 // Slight upward bias\r\n        };\r\n\r\n        createParticle(k, x, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 8 + Math.random() * 4,\r\n            color: [100, 255, 100],\r\n            velocity,\r\n            gravity: -0.05, // Float upward\r\n            lifetime: 0.6 + Math.random() * 0.3,\r\n            fadeStart: 0.3,\r\n            friction: 0.96,\r\n            zIndex: 200\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Spawn level up particles\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n */\r\nexport function spawnLevelUpEffect(k, x, y) {\r\n    const chars = ['', '', '*', '+'];\r\n    const count = 20;\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        const angle = (Math.PI * 2 * i) / count;\r\n        const velocity = {\r\n            x: Math.cos(angle) * 3,\r\n            y: Math.sin(angle) * 3 - 1\r\n        };\r\n\r\n        createParticle(k, x, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 14 + Math.random() * 6,\r\n            color: [255, 255, 100],\r\n            velocity,\r\n            gravity: -0.1, // Float upward\r\n            lifetime: 1.2 + Math.random() * 0.4,\r\n            fadeStart: 0.5,\r\n            friction: 0.97,\r\n            zIndex: 250\r\n        });\r\n    }\r\n}\r\n\r\n// ============================================\r\n// COSMETIC EFFECTS\r\n// ============================================\r\n\r\n/**\r\n * Spawn a trail particle behind the player\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n * @param {string} trailType - Trail type key (trailFire, trailIce, etc.)\r\n * @param {Array} color - RGB color array or 'rainbow'\r\n */\r\nexport function spawnTrailParticle(k, x, y, trailType, color) {\r\n    const chars = {\r\n        trailFire: ['', '', '', ''],\r\n        trailIce: ['*', '', '', ''],\r\n        trailPoison: ['~', '', '', ''],\r\n        trailShadow: ['', '', '', ''],\r\n        trailRainbow: ['', '', '', '']\r\n    };\r\n\r\n    const trailChars = chars[trailType] || ['', '', '*'];\r\n    const char = trailChars[Math.floor(Math.random() * trailChars.length)];\r\n\r\n    // Handle rainbow color\r\n    let particleColor = color;\r\n    if (color === 'rainbow') {\r\n        const hue = (Date.now() * 0.1) % 360;\r\n        particleColor = hslToRgb(hue, 100, 60);\r\n    }\r\n\r\n    // Random slight offset\r\n    const offsetX = (Math.random() - 0.5) * 8;\r\n    const offsetY = (Math.random() - 0.5) * 8;\r\n\r\n    createParticle(k, x + offsetX, y + offsetY, {\r\n        char,\r\n        size: 10 + Math.random() * 6,\r\n        color: particleColor,\r\n        velocity: { x: (Math.random() - 0.5) * 0.3, y: (Math.random() - 0.5) * 0.3 },\r\n        gravity: trailType === 'trailFire' ? -0.02 : 0.01,\r\n        lifetime: 0.4 + Math.random() * 0.2,\r\n        fadeStart: 0.2,\r\n        friction: 0.98,\r\n        zIndex: -10\r\n    });\r\n}\r\n\r\n/**\r\n * Convert HSL to RGB (for rainbow effects)\r\n */\r\nfunction hslToRgb(h, s, l) {\r\n    s /= 100;\r\n    l /= 100;\r\n    const a = s * Math.min(l, 1 - l);\r\n    const f = n => {\r\n        const k = (n + h / 30) % 12;\r\n        return l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);\r\n    };\r\n    return [Math.round(f(0) * 255), Math.round(f(8) * 255), Math.round(f(4) * 255)];\r\n}\r\n\r\n/**\r\n * Create a glow entity around a target\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} target - Entity to glow around\r\n * @param {string} glowType - Glow type key (glowGold, glowCrimson, etc.)\r\n * @param {Array} color - RGB color array\r\n * @returns {Object} - Glow entity\r\n */\r\nexport function createGlowEffect(k, target, glowType, color) {\r\n    const glowEntity = k.add([\r\n        k.text('', { size: 48 }),\r\n        k.pos(target.pos.x, target.pos.y),\r\n        k.anchor('center'),\r\n        k.color(...color),\r\n        k.opacity(0.3),\r\n        k.z(-5),\r\n        'playerGlow'\r\n    ]);\r\n\r\n    // Store glow properties\r\n    glowEntity.target = target;\r\n    glowEntity.glowType = glowType;\r\n    glowEntity.pulseTime = 0;\r\n    glowEntity.baseOpacity = 0.25;\r\n\r\n    return glowEntity;\r\n}\r\n\r\n/**\r\n * Update glow effect (call in game loop)\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} glow - Glow entity\r\n */\r\nexport function updateGlowEffect(k, glow) {\r\n    if (!glow || !glow.exists() || !glow.target || !glow.target.exists()) {\r\n        if (glow && glow.exists()) k.destroy(glow);\r\n        return;\r\n    }\r\n\r\n    // Follow target\r\n    glow.pos = glow.target.pos.clone();\r\n\r\n    // Pulse effect\r\n    glow.pulseTime += k.dt() * 3;\r\n    const pulse = Math.sin(glow.pulseTime) * 0.1;\r\n    glow.opacity = glow.baseOpacity + pulse;\r\n\r\n    // Electric glow has a flicker\r\n    if (glow.glowType === 'glowElectric' && Math.random() < 0.05) {\r\n        glow.opacity = glow.baseOpacity + 0.3;\r\n    }\r\n}\r\n\r\n/**\r\n * Spawn cosmetic death effect\r\n * @param {Object} k - Kaplay instance\r\n * @param {number} x - X position\r\n * @param {number} y - Y position\r\n * @param {string} deathType - Death effect type\r\n * @param {Array} enemyColor - Enemy's color\r\n */\r\nexport function spawnCosmeticDeath(k, x, y, deathType, enemyColor = [255, 100, 100]) {\r\n    switch (deathType) {\r\n        case 'deathExplosion':\r\n            spawnExplosiveDeath(k, x, y, enemyColor);\r\n            break;\r\n        case 'deathDisintegrate':\r\n            spawnDisintegrateDeath(k, x, y, enemyColor);\r\n            break;\r\n        case 'deathVaporize':\r\n            spawnVaporizeDeath(k, x, y, enemyColor);\r\n            break;\r\n        case 'deathPixelate':\r\n            spawnPixelateDeath(k, x, y, enemyColor);\r\n            break;\r\n        case 'deathFireworks':\r\n            spawnFireworksDeath(k, x, y, enemyColor);\r\n            break;\r\n        default:\r\n            // Standard death - use existing spawnDeathExplosion\r\n            spawnDeathExplosion(k, x, y, { color: enemyColor });\r\n    }\r\n}\r\n\r\n/**\r\n * Explosive death - large burst with bright flash\r\n */\r\nfunction spawnExplosiveDeath(k, x, y, color) {\r\n    const chars = ['*', '#', '@', 'X', '+', ''];\r\n    const count = 20;\r\n\r\n    // Bright flash in center\r\n    const flash = k.add([\r\n        k.text('', { size: 40 }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(255, 255, 200),\r\n        k.opacity(1),\r\n        k.z(200),\r\n        'particle'\r\n    ]);\r\n    flash.age = 0;\r\n    flash.lifetime = 0.2;\r\n    flash.fadeStart = 0;\r\n    flash.velocity = { x: 0, y: 0 };\r\n    flash.gravity = 0;\r\n    flash.friction = 1;\r\n\r\n    // Explosion ring\r\n    for (let i = 0; i < count; i++) {\r\n        const angle = (Math.PI * 2 * i) / count;\r\n        const speed = 4 + Math.random() * 2;\r\n        createParticle(k, x, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 14 + Math.random() * 10,\r\n            color: [255, 200, 100],\r\n            velocity: { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed },\r\n            gravity: 0.05,\r\n            lifetime: 0.6 + Math.random() * 0.3,\r\n            fadeStart: 0.2,\r\n            friction: 0.92\r\n        });\r\n    }\r\n\r\n    // Secondary debris\r\n    for (let i = 0; i < count / 2; i++) {\r\n        const angle = Math.random() * Math.PI * 2;\r\n        const speed = 2 + Math.random() * 2;\r\n        createParticle(k, x, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 10 + Math.random() * 6,\r\n            color,\r\n            velocity: { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed },\r\n            gravity: 0.1,\r\n            lifetime: 0.8 + Math.random() * 0.4,\r\n            fadeStart: 0.3,\r\n            friction: 0.94\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Disintegrate death - particles fall and scatter\r\n */\r\nfunction spawnDisintegrateDeath(k, x, y, color) {\r\n    const chars = ['', '', '', '', '', ''];\r\n    const count = 25;\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        const offsetX = (Math.random() - 0.5) * 20;\r\n        const offsetY = (Math.random() - 0.5) * 20;\r\n        const angle = Math.random() * Math.PI * 2;\r\n        const speed = 0.5 + Math.random() * 1.5;\r\n\r\n        createParticle(k, x + offsetX, y + offsetY, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 8 + Math.random() * 8,\r\n            color: [color[0] * (0.6 + Math.random() * 0.4), color[1] * (0.6 + Math.random() * 0.4), color[2] * (0.6 + Math.random() * 0.4)],\r\n            velocity: { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed },\r\n            gravity: 0.2, // Heavy gravity - fall down\r\n            lifetime: 1.0 + Math.random() * 0.5,\r\n            fadeStart: 0.5,\r\n            friction: 0.96\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Vaporize death - particles rise and fade\r\n */\r\nfunction spawnVaporizeDeath(k, x, y, color) {\r\n    const chars = ['~', '', '', '', ''];\r\n    const count = 20;\r\n\r\n    // Smoke puff\r\n    for (let i = 0; i < count; i++) {\r\n        const offsetX = (Math.random() - 0.5) * 15;\r\n        const angle = Math.random() * Math.PI * 2;\r\n        const speed = 0.3 + Math.random() * 0.5;\r\n\r\n        createParticle(k, x + offsetX, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 10 + Math.random() * 10,\r\n            color: [Math.min(255, color[0] + 100), Math.min(255, color[1] + 100), Math.min(255, color[2] + 100)],\r\n            velocity: { x: Math.cos(angle) * speed, y: -1.5 - Math.random() * 1.5 }, // Rise upward\r\n            gravity: -0.05, // Negative gravity - float up\r\n            lifetime: 1.2 + Math.random() * 0.5,\r\n            fadeStart: 0.3,\r\n            friction: 0.98\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Pixelate death - square pixel particles\r\n */\r\nfunction spawnPixelateDeath(k, x, y, color) {\r\n    const chars = ['', '', '', '', '', ''];\r\n    const gridSize = 5;\r\n    const spacing = 6;\r\n\r\n    // Create a grid of pixels that scatter\r\n    for (let gx = -gridSize / 2; gx <= gridSize / 2; gx++) {\r\n        for (let gy = -gridSize / 2; gy <= gridSize / 2; gy++) {\r\n            const offsetX = gx * spacing;\r\n            const offsetY = gy * spacing;\r\n            const dist = Math.sqrt(gx * gx + gy * gy);\r\n            const angle = Math.atan2(gy, gx);\r\n            const speed = 1 + dist * 0.3 + Math.random() * 0.5;\r\n\r\n            createParticle(k, x + offsetX, y + offsetY, {\r\n                char: chars[Math.floor(Math.random() * chars.length)],\r\n                size: 8 + Math.random() * 4,\r\n                color,\r\n                velocity: { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed },\r\n                gravity: 0.08,\r\n                lifetime: 0.6 + Math.random() * 0.4,\r\n                fadeStart: 0.4,\r\n                friction: 0.94\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Fireworks death - colorful ring burst with bright core\r\n */\r\nfunction spawnFireworksDeath(k, x, y, color) {\r\n    const chars = ['*', '+', 'x', 'X', '#'];\r\n    const count = 12;\r\n    const speed = 3;\r\n\r\n    // Outer explosion ring\r\n    for (let i = 0; i < count; i++) {\r\n        const angle = (Math.PI * 2 * i) / count;\r\n        const speedMult = 0.7 + Math.random() * 0.6;\r\n        const velocity = {\r\n            x: Math.cos(angle) * speed * speedMult,\r\n            y: Math.sin(angle) * speed * speedMult\r\n        };\r\n\r\n        createParticle(k, x, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 12 + Math.random() * 8,\r\n            color,\r\n            velocity,\r\n            gravity: 0.1,\r\n            lifetime: 0.8 + Math.random() * 0.4,\r\n            fadeStart: 0.3,\r\n            friction: 0.94\r\n        });\r\n    }\r\n\r\n    // Inner explosion core with bright color\r\n    const coreCount = Math.floor(count / 2);\r\n    for (let i = 0; i < coreCount; i++) {\r\n        const angle = Math.random() * Math.PI * 2;\r\n        const speedMult = 0.3 + Math.random() * 0.4;\r\n        const velocity = {\r\n            x: Math.cos(angle) * speed * speedMult * 0.5,\r\n            y: Math.sin(angle) * speed * speedMult * 0.5\r\n        };\r\n\r\n        createParticle(k, x, y, {\r\n            char: chars[Math.floor(Math.random() * chars.length)],\r\n            size: 16 + Math.random() * 8,\r\n            color: [255, 200, 100],\r\n            velocity,\r\n            gravity: 0.05,\r\n            lifetime: 0.6 + Math.random() * 0.3,\r\n            fadeStart: 0.2,\r\n            friction: 0.9\r\n        });\r\n    }\r\n}\r\n","// Settings system - handles game settings and preferences\r\n\r\nconst SETTINGS_KEY = 'superSmashTexty_settings';\r\n\r\n// Default settings\r\nconst DEFAULT_SETTINGS = {\r\n    version: 1,\r\n    audio: {\r\n        masterVolume: 1.0, // 0.0 to 1.0\r\n        sfxVolume: 1.0,\r\n        musicVolume: 0.35, // 35% default for new players\r\n        uiSounds: true,\r\n        combatSounds: true\r\n    },\r\n    controls: {\r\n        // Key bindings (stored as key codes/names)\r\n        moveUp: 'w',\r\n        moveDown: 's',\r\n        moveLeft: 'a',\r\n        moveRight: 'd',\r\n        pause: 'escape',\r\n        interact: 'space'\r\n    },\r\n    visual: {\r\n        showParticles: true,\r\n        showScreenShake: true,\r\n        showHitFreeze: true,\r\n        showDamageNumbers: true,\r\n        compactHUD: false,\r\n        showFPS: false,\r\n        showTimer: true\r\n    },\r\n    gameplay: {\r\n        autoPause: false, // Auto-pause on level up\r\n        autoPickupCurrency: false,\r\n        autoPickupXP: false,\r\n        confirmBeforeQuit: true,\r\n        skipIntroAnimation: false\r\n    },\r\n    accessibility: {\r\n        colorblindMode: 'off', // 'off', 'deuteranopia', 'protanopia', 'tritanopia'\r\n        reducedMotion: false,\r\n        largeText: false,\r\n        highContrast: false\r\n    }\r\n};\r\n\r\n// Load settings from localStorage\r\nexport function loadSettings() {\r\n    try {\r\n        const saved = localStorage.getItem(SETTINGS_KEY);\r\n        if (saved) {\r\n            const data = JSON.parse(saved);\r\n            // Merge with defaults to handle missing fields\r\n            return mergeDeep(DEFAULT_SETTINGS, data);\r\n        }\r\n    } catch (e) {\r\n        console.error('Error loading settings:', e);\r\n    }\r\n    return { ...DEFAULT_SETTINGS };\r\n}\r\n\r\n// Deep merge helper\r\nfunction mergeDeep(target, source) {\r\n    const output = { ...target };\r\n    if (isObject(target) && isObject(source)) {\r\n        Object.keys(source).forEach(key => {\r\n            if (isObject(source[key])) {\r\n                if (!(key in target)) {\r\n                    Object.assign(output, { [key]: source[key] });\r\n                } else {\r\n                    output[key] = mergeDeep(target[key], source[key]);\r\n                }\r\n            } else {\r\n                Object.assign(output, { [key]: source[key] });\r\n            }\r\n        });\r\n    }\r\n    return output;\r\n}\r\n\r\nfunction isObject(item) {\r\n    return item && typeof item === 'object' && !Array.isArray(item);\r\n}\r\n\r\n// Save settings to localStorage\r\nexport function saveSettings(settings) {\r\n    try {\r\n        localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));\r\n        return true;\r\n    } catch (e) {\r\n        console.error('Error saving settings:', e);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Get current settings\r\nexport function getSettings() {\r\n    return loadSettings();\r\n}\r\n\r\n// Update a specific setting\r\nexport function updateSetting(category, key, value) {\r\n    const settings = loadSettings();\r\n    if (!settings[category]) {\r\n        settings[category] = {};\r\n    }\r\n    settings[category][key] = value;\r\n    saveSettings(settings);\r\n    return settings;\r\n}\r\n\r\n// Get a specific setting value\r\nexport function getSetting(category, key) {\r\n    const settings = loadSettings();\r\n    return settings[category]?.[key] ?? DEFAULT_SETTINGS[category]?.[key];\r\n}\r\n\r\n// Reset settings to defaults\r\nexport function resetSettings() {\r\n    saveSettings({ ...DEFAULT_SETTINGS });\r\n    return { ...DEFAULT_SETTINGS };\r\n}\r\n\r\n\r\n\r\n","// Visual Effects System - screen shake, hit freeze, and other juice effects\r\nimport { getSetting } from './settings.js';\r\n\r\nlet kInstance = null;\r\nlet originalCamPos = null;\r\nlet shakeTimer = 0;\r\nlet shakeIntensity = 0;\r\nlet inHitFreeze = false;\r\n\r\n// Rate limiting for screen shake to prevent performance issues\r\nlet lastShakeTime = 0;\r\nconst MIN_SHAKE_INTERVAL = 0.05; // Minimum 50ms between shake calls\r\n\r\n// Rate limiting for hit freeze\r\nlet lastFreezeTime = 0;\r\nconst MIN_FREEZE_INTERVAL = 100; // Minimum 100ms between freeze calls\r\n\r\n/**\r\n * Initialize the visual effects system\r\n * @param {object} k - Kaplay instance\r\n */\r\nexport function initVisualEffects(k) {\r\n    kInstance = k;\r\n}\r\n\r\n/**\r\n * Apply screen shake effect\r\n * @param {number} intensity - Shake intensity in pixels (default 5)\r\n * @param {number} duration - Shake duration in seconds (default 0.1)\r\n */\r\nexport function screenShake(intensity = 5, duration = 0.1) {\r\n    if (!kInstance) return;\r\n\r\n    // Check if screen shake is enabled in settings\r\n    if (!getSetting('visual', 'showScreenShake')) return;\r\n\r\n    // Rate limit screen shake to prevent performance issues\r\n    const currentTime = kInstance.time();\r\n    if (currentTime - lastShakeTime < MIN_SHAKE_INTERVAL) {\r\n        // Still allow extending duration/intensity of existing shake\r\n        if (shakeTimer > 0) {\r\n            shakeIntensity = Math.max(shakeIntensity, intensity);\r\n            shakeTimer = Math.max(shakeTimer, duration);\r\n        }\r\n        return;\r\n    }\r\n    lastShakeTime = currentTime;\r\n\r\n    // Store original position if not already shaking\r\n    if (shakeTimer <= 0) {\r\n        originalCamPos = kInstance.camPos();\r\n    }\r\n\r\n    // Set shake parameters (use max if already shaking)\r\n    shakeIntensity = Math.max(shakeIntensity, intensity);\r\n    shakeTimer = Math.max(shakeTimer, duration);\r\n}\r\n\r\n/**\r\n * Update screen shake (call this in onUpdate)\r\n * @param {number} dt - Delta time\r\n */\r\nexport function updateScreenShake(dt) {\r\n    if (!kInstance || shakeTimer <= 0) return;\r\n\r\n    shakeTimer -= dt;\r\n\r\n    if (shakeTimer > 0) {\r\n        // Apply random offset based on intensity\r\n        const offsetX = (Math.random() - 0.5) * 2 * shakeIntensity;\r\n        const offsetY = (Math.random() - 0.5) * 2 * shakeIntensity;\r\n\r\n        if (originalCamPos) {\r\n            kInstance.camPos(originalCamPos.x + offsetX, originalCamPos.y + offsetY);\r\n        }\r\n    } else {\r\n        // Restore original position\r\n        if (originalCamPos) {\r\n            kInstance.camPos(originalCamPos);\r\n        }\r\n        shakeIntensity = 0;\r\n        originalCamPos = null;\r\n    }\r\n}\r\n\r\n/**\r\n * Apply hit freeze effect (brief pause for impact)\r\n * @param {number} duration - Freeze duration in milliseconds (default 50)\r\n */\r\nexport function hitFreeze(duration = 50) {\r\n    if (!kInstance) return;\r\n\r\n    // Check if hit freeze is enabled in settings\r\n    if (!getSetting('visual', 'showHitFreeze')) return;\r\n\r\n    // Don't freeze if already paused or in freeze\r\n    if (kInstance.paused || inHitFreeze) return;\r\n\r\n    // Rate limit hit freeze to prevent performance issues\r\n    const currentTime = Date.now();\r\n    if (currentTime - lastFreezeTime < MIN_FREEZE_INTERVAL) {\r\n        return;\r\n    }\r\n    lastFreezeTime = currentTime;\r\n\r\n    // Pause the game briefly\r\n    kInstance.paused = true;\r\n    inHitFreeze = true;\r\n\r\n    // Resume after duration\r\n    setTimeout(() => {\r\n        // Only unpause if we were the ones who paused it\r\n        kInstance.paused = false;\r\n        inHitFreeze = false;\r\n    }, duration);\r\n}\r\n\r\n/**\r\n * Check if currently in hit freeze (for UI to distinguish from user pause)\r\n */\r\nexport function isInHitFreeze() {\r\n    return inHitFreeze;\r\n}\r\n\r\n/**\r\n * Combined effect for big hits (shake + freeze)\r\n * @param {object} options - Effect options\r\n * @param {number} options.shakeIntensity - Shake intensity (default 8)\r\n * @param {number} options.shakeDuration - Shake duration (default 0.15)\r\n * @param {number} options.freezeDuration - Freeze duration in ms (default 50)\r\n */\r\nexport function bigHitEffect(options = {}) {\r\n    const {\r\n        shakeIntensity = 8,\r\n        shakeDuration = 0.15,\r\n        freezeDuration = 50\r\n    } = options;\r\n\r\n    screenShake(shakeIntensity, shakeDuration);\r\n    hitFreeze(freezeDuration);\r\n}\r\n\r\n/**\r\n * Effect presets for different situations\r\n */\r\nexport const EffectPresets = {\r\n    // Player takes damage\r\n    playerHit: () => {\r\n        screenShake(6, 0.1);\r\n        hitFreeze(30);\r\n    },\r\n\r\n    // Critical hit landed\r\n    criticalHit: () => {\r\n        screenShake(4, 0.08);\r\n        hitFreeze(40);\r\n    },\r\n\r\n    // Boss takes damage\r\n    bossHit: () => {\r\n        screenShake(3, 0.05);\r\n    },\r\n\r\n    // Boss dies\r\n    bossDeath: () => {\r\n        screenShake(15, 0.3);\r\n        hitFreeze(100);\r\n    },\r\n\r\n    // Explosion\r\n    explosion: () => {\r\n        screenShake(10, 0.2);\r\n        hitFreeze(60);\r\n    },\r\n\r\n    // Player dies\r\n    playerDeath: () => {\r\n        screenShake(12, 0.25);\r\n        hitFreeze(150);\r\n    },\r\n\r\n    // Level up\r\n    levelUp: () => {\r\n        screenShake(5, 0.15);\r\n    },\r\n\r\n    // Small impact (enemy hit)\r\n    smallImpact: () => {\r\n        screenShake(2, 0.05);\r\n    }\r\n};\r\n\r\n/**\r\n * Reset visual effects state (call on scene change)\r\n */\r\nexport function resetVisualEffects() {\r\n    shakeTimer = 0;\r\n    shakeIntensity = 0;\r\n    if (kInstance && originalCamPos) {\r\n        kInstance.camPos(originalCamPos);\r\n    }\r\n    originalCamPos = null;\r\n    lastShakeTime = 0;\r\n    lastFreezeTime = 0;\r\n    inHitFreeze = false;\r\n}\r\n","/**\r\n * Combat System\r\n *\r\n * Handles all combat mechanics including:\r\n * - Autofire system for player weapons\r\n * - Projectile spawning with spread patterns\r\n * - Critical hit calculations\r\n * - Damage calculations with defense\r\n * - Orbital weapon mechanics\r\n * - Enemy collision and knockback\r\n * - Player damage and invulnerability frames\r\n */\r\n\r\n// Entity imports\r\nimport { createProjectile } from '../entities/projectile.js';\r\n\r\n// System imports\r\nimport { decrementPowerupAmmo } from './powerupWeapons.js';\r\nimport { broadcastDamageEvent, broadcastHealEvent, broadcastDodgeEvent, isMultiplayerActive, isHost, registerProjectile } from './multiplayerGame.js';\r\nimport { getAimInput } from './inputSystem.js';\r\n\r\n// Configuration imports\r\nimport {\r\n    COMBAT_CONFIG,\r\n    WEAPON_CONFIG,\r\n    rollCriticalHit,\r\n    calculateCriticalDamage,\r\n    calculateDamageAfterDefense\r\n} from '../config/constants.js';\r\n\r\n// Sound system imports\r\nimport {\r\n    playWeaponFire,\r\n    playEnemyHit,\r\n    playPlayerHit,\r\n    playExplosion\r\n} from './sounds.js';\r\n\r\n// Particle system imports\r\nimport {\r\n    spawnBloodSplatter,\r\n    spawnHitImpact,\r\n    spawnDeathExplosion\r\n} from './particleSystem.js';\r\n\r\n// Visual effects imports\r\nimport { screenShake, hitFreeze, EffectPresets } from './visualEffects.js';\r\n\r\n// Helper function to apply knockback while respecting collisions and room boundaries\r\nfunction applySafeKnockback(k, entity, knockbackDir, knockbackAmount) {\r\n    if (!entity || !entity.exists()) return;\r\n\r\n    const roomMargin = 20; // Keep entities away from room edges\r\n    const maxX = k.width() - roomMargin;\r\n    const maxY = k.height() - roomMargin;\r\n    const minX = roomMargin;\r\n    const minY = roomMargin;\r\n\r\n    // Calculate new position\r\n    const newX = entity.pos.x + knockbackDir.x * knockbackAmount;\r\n    const newY = entity.pos.y + knockbackDir.y * knockbackAmount;\r\n\r\n    // Constrain to room boundaries first\r\n    const boundedX = Math.max(minX, Math.min(maxX, newX));\r\n    const boundedY = Math.max(minY, Math.min(maxY, newY));\r\n\r\n    // Store original position\r\n    const originalX = entity.pos.x;\r\n    const originalY = entity.pos.y;\r\n\r\n    // Try to move to new position\r\n    entity.pos.x = boundedX;\r\n    entity.pos.y = boundedY;\r\n\r\n    // Check for collision with walls or obstacles\r\n    const walls = k.get('wall');\r\n    const obstacles = k.get('obstacle');\r\n    const allObstacles = [...walls, ...obstacles];\r\n\r\n    let colliding = false;\r\n    for (const obstacle of allObstacles) {\r\n        if (!obstacle.exists()) continue;\r\n\r\n        // Check if entity area overlaps with obstacle\r\n        if (entity.isColliding && entity.isColliding(obstacle)) {\r\n            colliding = true;\r\n            break;\r\n        }\r\n    }\r\n\r\n    // If colliding, revert to original position\r\n    if (colliding) {\r\n        entity.pos.x = originalX;\r\n        entity.pos.y = originalY;\r\n    }\r\n}\r\n\r\nexport function setupCombatSystem(k, player) {\r\n    let lastFireTime = 0;\r\n\r\n    // Initialize orbital weapons if applicable\r\n    if (player.weaponKey === 'orbital') {\r\n        initializeOrbitalWeapons(k, player);\r\n    }\r\n\r\n    // Autofire system\r\n    k.onUpdate(() => {\r\n        if (k.paused) return;\r\n\r\n        // Update player rotation based on gamepad/touch/mouse aim (always, even when not shooting)\r\n        if (!player.isRemote) {\r\n            const aimInput = getAimInput();\r\n            let toTarget;\r\n            let distance;\r\n\r\n            if (aimInput.active && (aimInput.x !== 0 || aimInput.y !== 0)) {\r\n                // Use gamepad/touch aim direction\r\n                toTarget = k.vec2(aimInput.x, aimInput.y);\r\n                distance = 1;\r\n            } else {\r\n                // Fall back to mouse position\r\n                const mousePos = k.mousePos();\r\n                toTarget = k.vec2(\r\n                    mousePos.x - player.pos.x,\r\n                    mousePos.y - player.pos.y\r\n                );\r\n                distance = toTarget.len();\r\n            }\r\n\r\n            if (distance > 0) {\r\n                // Convert to degrees for Kaplay's rotate component\r\n                const aimAngleDeg = Math.atan2(toTarget.y, toTarget.x) * (180 / Math.PI);\r\n                player.angle = aimAngleDeg;\r\n                if (player.outline && player.outline.exists()) {\r\n                    player.outline.angle = aimAngleDeg;\r\n                }\r\n            }\r\n        } else if (player.aimAngle !== undefined) {\r\n            // Remote player rotation from network (already in degrees)\r\n            player.angle = player.aimAngle;\r\n            if (player.outline && player.outline.exists()) {\r\n                player.outline.angle = player.aimAngle;\r\n            }\r\n        }\r\n\r\n        // Don't allow shooting if canShoot is false (e.g., player is dead)\r\n        if (player.canShoot === false) {\r\n            player.isShooting = false; // Track shooting state for multiplayer\r\n            return;\r\n        }\r\n\r\n        // Check if there are any enemies in the room (enemies, bosses, minibosses)\r\n        const enemies = k.get('enemy');\r\n        const bosses = k.get('boss');\r\n        const minibosses = k.get('miniboss');\r\n        const hasTargets = enemies.length > 0 || bosses.length > 0 || minibosses.length > 0;\r\n\r\n        // Don't shoot if there are no targets (except orbital weapons which are passive)\r\n        if (!hasTargets && player.weaponKey !== 'orbital') {\r\n            player.isShooting = false; // Track shooting state for multiplayer\r\n            return;\r\n        }\r\n\r\n        // Handle orbital weapons (passive, no firing needed)\r\n        if (player.weaponKey === 'orbital') {\r\n            updateOrbitalWeapons(k, player);\r\n            player.isShooting = false; // Orbital weapons don't shoot\r\n            return; // Orbital weapons don't fire projectiles\r\n        }\r\n\r\n        const time = k.time();\r\n\r\n        let baseDirection;\r\n        let shouldFire = false;\r\n\r\n        // For remote players, use their aimAngle from network\r\n        // For local players, use mouse position\r\n        if (player.isRemote) {\r\n            // Remote player: in multiplayer, projectiles are spawned on the host only\r\n            // Remote players don't spawn projectiles on clients to avoid duplicates\r\n            if (isMultiplayerActive() && !isHost()) {\r\n                player.isShooting = false;\r\n                return; // Projectiles for remote players are handled by host\r\n            }\r\n\r\n            // Host: use aimAngle from network input for remote players\r\n            if (player.aimAngle !== undefined && player.isShooting) {\r\n                const angleRad = player.aimAngle * (Math.PI / 180);\r\n                baseDirection = k.vec2(Math.cos(angleRad), Math.sin(angleRad));\r\n                shouldFire = true;\r\n            } else {\r\n                player.isShooting = false;\r\n                return; // No aim angle or not shooting\r\n            }\r\n        } else {\r\n            // Local player: check for gamepad/touch aim first, then fall back to mouse\r\n            const aimInput = getAimInput();\r\n\r\n            let toTarget;\r\n            let distance;\r\n\r\n            if (aimInput.active && (aimInput.x !== 0 || aimInput.y !== 0)) {\r\n                // Use gamepad/touch aim direction (already normalized by input system)\r\n                toTarget = k.vec2(aimInput.x, aimInput.y);\r\n                distance = 1; // Always has distance when active\r\n            } else {\r\n                // Fall back to mouse position\r\n                const mousePos = k.mousePos();\r\n                toTarget = k.vec2(\r\n                    mousePos.x - player.pos.x,\r\n                    mousePos.y - player.pos.y\r\n                );\r\n                distance = toTarget.len();\r\n            }\r\n\r\n            // Track aim angle for multiplayer (angle in degrees from player to target)\r\n            if (distance > 0) {\r\n                player.aimAngle = Math.atan2(toTarget.y, toTarget.x) * (180 / Math.PI);\r\n                baseDirection = toTarget.unit();\r\n\r\n                // In multiplayer as client, don't spawn projectiles locally\r\n                // Only the host spawns projectiles for all players\r\n                if (isMultiplayerActive() && !isHost()) {\r\n                    player.isShooting = distance > 0 && player.canShoot;\r\n                    return; // Host will spawn projectiles based on our input\r\n                }\r\n\r\n                shouldFire = true;\r\n            } else {\r\n                player.aimAngle = 0;\r\n                player.isShooting = false;\r\n                return; // No aim input\r\n            }\r\n\r\n            // Track shooting state for multiplayer\r\n            player.isShooting = distance > 0 && player.canShoot;\r\n        }\r\n\r\n        if (shouldFire && baseDirection) {\r\n            \r\n            // Calculate effective fire rate (with bulletTime bonus if moving)\r\n            let effectiveFireRate = player.fireRate;\r\n            if (player.bulletTimeEnabled && player.bulletTimeBonus && player.move) {\r\n                const isMoving = player.move.x !== 0 || player.move.y !== 0;\r\n                if (isMoving) {\r\n                    effectiveFireRate = player.fireRate * (1 + player.bulletTimeBonus);\r\n                }\r\n            }\r\n\r\n            // Speed Demon synergy: +fire rate per speed stack\r\n            if (player.speedDemonEnabled && player.speedDemonFireRatePerStack) {\r\n                const speedStacks = player.upgradeStacks?.speed || 0;\r\n                if (speedStacks > 0) {\r\n                    effectiveFireRate = effectiveFireRate * (1 + speedStacks * player.speedDemonFireRatePerStack);\r\n                }\r\n            }\r\n\r\n            // Fire if enough time has passed\r\n            if (time - lastFireTime >= 1 / effectiveFireRate) {\r\n                const projectileCount = player.projectileCount || 1;\r\n                const spreadAngle = player.spreadAngle || 0;\r\n                \r\n                // Calculate spread directions\r\n                const directions = [];\r\n                if (projectileCount === 1) {\r\n                    directions.push(baseDirection);\r\n                } else if (spreadAngle > 0) {\r\n                    // Spread pattern (shotgun)\r\n                    const angleStep = projectileCount > 1 ? spreadAngle / (projectileCount - 1) : 0;\r\n                    const startAngle = -spreadAngle / 2;\r\n                    for (let i = 0; i < projectileCount; i++) {\r\n                        const angle = startAngle + (angleStep * i);\r\n                        const rad = angle * (Math.PI / 180);\r\n                        const cos = Math.cos(rad);\r\n                        const sin = Math.sin(rad);\r\n                        const dir = k.vec2(\r\n                            baseDirection.x * cos - baseDirection.y * sin,\r\n                            baseDirection.x * sin + baseDirection.y * cos\r\n                        );\r\n                        directions.push(dir.unit());\r\n                    }\r\n                } else {\r\n                    // Multi-shot without spread (all same direction)\r\n                    for (let i = 0; i < projectileCount; i++) {\r\n                        directions.push(baseDirection);\r\n                    }\r\n                }\r\n                \r\n                // Fire all projectiles\r\n                directions.forEach((direction, index) => {\r\n                    // Small delay for multi-shot without spread (staggered)\r\n                    const delay = spreadAngle === 0 && projectileCount > 1\r\n                        ? index * COMBAT_CONFIG.MULTISHOT_STAGGER_DELAY\r\n                        : 0;\r\n\r\n                    k.wait(delay, () => {\r\n                        // Check for critical hit\r\n                        const isCrit = rollCriticalHit(player.critChance || 0);\r\n                        let finalDamage = isCrit\r\n                            ? calculateCriticalDamage(player.projectileDamage, player.critDamage || 2.0)\r\n                            : player.projectileDamage;\r\n\r\n                        // Apply synergy bonuses (e.g., armor piercing)\r\n                        if (player.piercingDamageBonus && (player.piercing || 0) > 0) {\r\n                            finalDamage = Math.floor(finalDamage * player.piercingDamageBonus);\r\n                        }\r\n\r\n                        // Use weapon's character and color for projectiles\r\n                        let weaponRange = player.weaponRange || WEAPON_CONFIG.DEFAULT_WEAPON_RANGE;\r\n\r\n                        // Deadeye synergy: crits have +50% range\r\n                        if (isCrit && player.deadeyeEnabled && player.deadeyeRangeBonus) {\r\n                            weaponRange = weaponRange * (1 + player.deadeyeRangeBonus);\r\n                        }\r\n\r\n                        // Play weapon firing sound\r\n                        playWeaponFire(player.weaponKey);\r\n\r\n                        // Handle special weapon types\r\n                        if (player.weaponKey === 'flamethrower') {\r\n                            // Flamethrower - create projectile with burn DoT effect\r\n                            const projectile = createProjectile(k, player.pos.x, player.pos.y, direction,\r\n                                player.projectileSpeed, finalDamage,\r\n                                player.piercing || 0, player.obstaclePiercing || 0, isCrit, weaponRange);\r\n\r\n                            // Apply weapon visual properties\r\n                            if (player.weaponDef) {\r\n                                projectile.useWeaponVisual(player.weaponDef);\r\n                            }\r\n\r\n                            // Track projectile owner for kill attribution\r\n                            projectile.ownerSlotIndex = player.slotIndex;\r\n\r\n                            // Add burn DoT effect\r\n                            const burnDamagePerTick = Math.floor(finalDamage * 0.3); // 30% of hit damage per tick\r\n                            const burnDuration = 2.0; // 2 seconds of burn\r\n                            const dotMultiplier = player.fireDotMultiplier || 1.0;\r\n\r\n                            projectile.burnDamage = Math.floor(burnDamagePerTick * dotMultiplier);\r\n                            projectile.burnDuration = burnDuration;\r\n\r\n                            // Register projectile for multiplayer sync\r\n                            if (isMultiplayerActive() && isHost()) {\r\n                                registerProjectile(projectile, {\r\n                                    weaponKey: player.weaponKey,\r\n                                    burnDamage: projectile.burnDamage,\r\n                                    burnDuration: projectile.burnDuration\r\n                                });\r\n                            }\r\n                        } else if (player.weaponKey === 'explosive') {\r\n                            // Explosive launcher - create explosive projectile\r\n                            const projectile = createExplosiveProjectile(k, player.pos.x, player.pos.y, direction,\r\n                                player.projectileSpeed, finalDamage,\r\n                                player.explosionRadius, player.explosionDamage, weaponRange, isCrit);\r\n                            if (player.weaponDef) {\r\n                                projectile.useWeaponVisual(player.weaponDef);\r\n                            }\r\n\r\n                            // Track projectile owner for kill attribution\r\n                            projectile.ownerSlotIndex = player.slotIndex;\r\n\r\n                            // Register projectile for multiplayer sync\r\n                            if (isMultiplayerActive() && isHost()) {\r\n                                registerProjectile(projectile, {\r\n                                    weaponKey: player.weaponKey,\r\n                                    explosionRadius: projectile.explosionRadius,\r\n                                    explosionDamage: projectile.explosionDamage\r\n                                });\r\n                            }\r\n                        } else if (player.weaponKey === 'chainLightning') {\r\n                            // Chain lightning - create chaining projectile\r\n                            const projectile = createChainProjectile(k, player.pos.x, player.pos.y, direction,\r\n                                player.projectileSpeed, finalDamage,\r\n                                player.chainRange, player.maxJumps, player.chainDamageReduction, weaponRange, isCrit);\r\n                            if (player.weaponDef) {\r\n                                projectile.useWeaponVisual(player.weaponDef);\r\n                            }\r\n\r\n                            // Track projectile owner for kill attribution\r\n                            projectile.ownerSlotIndex = player.slotIndex;\r\n\r\n                            // Register projectile for multiplayer sync\r\n                            if (isMultiplayerActive() && isHost()) {\r\n                                registerProjectile(projectile, {\r\n                                    weaponKey: player.weaponKey,\r\n                                    chainRange: projectile.chainRange,\r\n                                    maxJumps: projectile.maxJumps,\r\n                                    chainDamageReduction: projectile.chainDamageReduction\r\n                                });\r\n                            }\r\n                        } else if (player.weaponKey === 'boomerang') {\r\n                            // Boomerang - create returning projectile\r\n                            const projectile = createProjectile(k, player.pos.x, player.pos.y, direction,\r\n                                player.projectileSpeed, finalDamage,\r\n                                player.piercing || 0, player.obstaclePiercing || 0, isCrit, weaponRange);\r\n\r\n                            // Set boomerang properties\r\n                            projectile.isBoomerang = true;\r\n                            projectile.ownerPlayer = player;\r\n                            projectile.returnSpeedMultiplier = player.weaponDef?.returnSpeedMultiplier || 1.2;\r\n\r\n                            if (player.weaponDef) {\r\n                                projectile.useWeaponVisual(player.weaponDef);\r\n                            }\r\n\r\n                            // Track projectile owner for kill attribution\r\n                            projectile.ownerSlotIndex = player.slotIndex;\r\n\r\n                            // Register projectile for multiplayer sync\r\n                            if (isMultiplayerActive() && isHost()) {\r\n                                registerProjectile(projectile, {\r\n                                    weaponKey: player.weaponKey,\r\n                                    isBoomerang: true\r\n                                });\r\n                            }\r\n                        } else {\r\n                            // Standard projectile\r\n                            const projectile = createProjectile(k, player.pos.x, player.pos.y, direction,\r\n                                player.projectileSpeed, finalDamage,\r\n                                player.piercing || 0, player.obstaclePiercing || 0, isCrit, weaponRange);\r\n\r\n                            // Apply weapon visual properties\r\n                            if (player.weaponDef) {\r\n                                projectile.useWeaponVisual(player.weaponDef);\r\n                            }\r\n\r\n                            // Track projectile owner for kill attribution\r\n                            projectile.ownerSlotIndex = player.slotIndex;\r\n\r\n                            // Register projectile for multiplayer sync\r\n                            if (isMultiplayerActive() && isHost()) {\r\n                                registerProjectile(projectile, {\r\n                                    weaponKey: player.weaponKey || 'pistol'\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n\r\n                lastFireTime = time;\r\n\r\n                // Decrement powerup weapon ammo if applicable\r\n                decrementPowerupAmmo(player);\r\n            }\r\n        }\r\n    });\r\n\r\n    // Collision: Projectile hits Wall (consolidated handler)\r\n    k.onCollide('projectile', 'wall', (projectile, wall) => {\r\n        if (k.paused) return;\r\n\r\n        // Handle explosive projectiles\r\n        if (projectile.isExplosive) {\r\n            explodeProjectile(k, projectile, projectile.pos.x, projectile.pos.y);\r\n            return;\r\n        }\r\n\r\n        // Check if projectile has already hit this obstacle (for obstacle piercing)\r\n        if (projectile.piercedObstacles && projectile.piercedObstacles.has(wall)) {\r\n            return; // Already hit this obstacle\r\n        }\r\n\r\n        // Check if projectile can pierce obstacles\r\n        if (projectile.obstaclePiercing > 0) {\r\n            // Track this obstacle for piercing\r\n            if (projectile.piercedObstacles) {\r\n                projectile.piercedObstacles.add(wall);\r\n            }\r\n\r\n            // Destroy projectile if it can't pierce anymore obstacles\r\n            // If obstaclePiercing = n, projectile can hit n+1 obstacles total\r\n            if (projectile.piercedObstacles.size > (projectile.obstaclePiercing || 0)) {\r\n                k.destroy(projectile);\r\n            }\r\n        } else {\r\n            // No obstacle piercing - destroy projectile\r\n            k.destroy(projectile);\r\n        }\r\n    });\r\n    \r\n    // Collision: Projectile hits Cover (check obstacle piercing)\r\n    k.onCollide('projectile', 'cover', (projectile, cover) => {\r\n        if (k.paused) return;\r\n        \r\n        // Cover allows projectiles through by default, but we can still track for piercing\r\n        // Only destroy if projectile has hit max obstacles\r\n        if (projectile.obstaclePiercing > 0 && projectile.piercedObstacles) {\r\n            if (projectile.piercedObstacles.has(cover)) {\r\n                return; // Already hit this obstacle\r\n            }\r\n            \r\n            projectile.piercedObstacles.add(cover);\r\n            \r\n            // Destroy projectile if it can't pierce anymore obstacles\r\n            if (projectile.piercedObstacles.size > (projectile.obstaclePiercing || 0)) {\r\n                k.destroy(projectile);\r\n            }\r\n        }\r\n        // If no obstacle piercing, projectile passes through cover (cover behavior)\r\n    });\r\n\r\n    // Collision: Projectile hits Obstacle (check obstacle piercing)\r\n    k.onCollide('projectile', 'obstacle', (projectile, obstacle) => {\r\n        if (k.paused) return;\r\n\r\n        // Explosive projectiles are handled separately\r\n        if (projectile.isExplosive) {\r\n            return;\r\n        }\r\n\r\n        // Check if projectile has already hit this obstacle (for obstacle piercing)\r\n        if (projectile.piercedObstacles && projectile.piercedObstacles.has(obstacle)) {\r\n            return; // Already hit this obstacle\r\n        }\r\n\r\n        // Check if projectile can pierce obstacles\r\n        if (projectile.obstaclePiercing > 0) {\r\n            // Track this obstacle for piercing\r\n            if (projectile.piercedObstacles) {\r\n                projectile.piercedObstacles.add(obstacle);\r\n            }\r\n\r\n            // Destroy projectile if it can't pierce anymore obstacles\r\n            if (projectile.piercedObstacles.size > (projectile.obstaclePiercing || 0)) {\r\n                k.destroy(projectile);\r\n            }\r\n        } else {\r\n            // No obstacle piercing - destroy projectile\r\n            k.destroy(projectile);\r\n        }\r\n    });\r\n\r\n    // Collision: Projectile hits Barrel (damages barrel, can cause explosion)\r\n    k.onCollide('projectile', 'barrel', (projectile, barrel) => {\r\n        if (k.paused) return;\r\n        if (!barrel.exists() || barrel.isExploding) return;\r\n\r\n        // Only player projectiles damage barrels\r\n        if (projectile.isEnemyProjectile || projectile.isBossProjectile) {\r\n            return;\r\n        }\r\n\r\n        // Damage the barrel\r\n        if (barrel.takeDamage) {\r\n            barrel.takeDamage(1);\r\n        }\r\n\r\n        // Handle projectile destruction based on piercing\r\n        if (projectile.piercing > 0 || projectile.obstaclePiercing > 0) {\r\n            // Piercing projectiles continue through\r\n            if (projectile.piercedObstacles) {\r\n                projectile.piercedObstacles.add(barrel);\r\n            }\r\n        } else if (!projectile.isExplosive) {\r\n            // Non-piercing, non-explosive projectiles are destroyed\r\n            if (projectile.exists()) k.destroy(projectile);\r\n        }\r\n    });\r\n\r\n    // Collision: Projectile hits Enemy (consolidated handler for all projectile types)\r\n    k.onCollide('projectile', 'enemy', (projectile, enemy) => {\r\n        if (k.paused) return;\r\n\r\n        // Only player projectiles can hit enemies (enemy/boss projectiles pass through)\r\n        if (projectile.isEnemyProjectile || projectile.isBossProjectile) {\r\n            return;\r\n        }\r\n\r\n        // Check if enemy reflects projectiles (reflector enemy type)\r\n        // Max 2 bounces to prevent infinite loops, damage reduced by 30% per bounce\r\n        const maxReflections = 2;\r\n        const reflectionCount = projectile.reflectionCount || 0;\r\n        if (enemy.reflectsProjectiles && !projectile.isReflected && reflectionCount < maxReflections) {\r\n            const reflectRoll = Math.random();\r\n            if (reflectRoll < (enemy.reflectChance || 0.4)) {\r\n                // Reflect the projectile back at the player\r\n                projectile.isReflected = true;\r\n                projectile.reflectionCount = reflectionCount + 1;\r\n                projectile.isEnemyProjectile = true; // Now damages player instead\r\n                projectile.direction = k.vec2(-projectile.direction.x, -projectile.direction.y); // Reverse direction\r\n                projectile.color = k.rgb(255, 100, 100); // Change color to indicate reflected\r\n                // Reduce damage by 30% per reflection to prevent reflected projectiles being too strong\r\n                projectile.damage = Math.floor(projectile.damage * 0.7);\r\n\r\n                // Visual feedback for reflection\r\n                const reflectEffect = k.add([\r\n                    k.text('*', { size: 20 }),\r\n                    k.pos(enemy.pos.x, enemy.pos.y),\r\n                    k.anchor('center'),\r\n                    k.color(200, 200, 255),\r\n                    k.opacity(1),\r\n                    k.lifespan(0.3),\r\n                    k.z(500)\r\n                ]);\r\n                return; // Don't damage the enemy\r\n            }\r\n        }\r\n\r\n        // Handle explosive projectiles\r\n        if (projectile.isExplosive) {\r\n            explodeProjectile(k, projectile, enemy.pos.x, enemy.pos.y);\r\n            return;\r\n        }\r\n\r\n        // Handle chain lightning projectiles\r\n        if (projectile.isChainLightning) {\r\n            // Check if already hit this enemy\r\n            if (projectile.chainedEnemies && projectile.chainedEnemies.has(enemy)) {\r\n                return;\r\n            }\r\n\r\n            // Only host deals damage in multiplayer\r\n            if (!isMultiplayerActive() || isHost()) {\r\n                // Calculate damage (reduces per jump)\r\n                const jumpCount = projectile.chainJumps || 0;\r\n                const damageReduction = 1 - (projectile.chainDamageReduction || 0.15) * jumpCount;\r\n                const finalDamage = Math.floor(projectile.damage * Math.max(0.1, damageReduction));\r\n\r\n                // Deal damage\r\n                if (enemy.takeDamage) {\r\n                    enemy.takeDamage(finalDamage);\r\n                } else {\r\n                    enemy.hurt(finalDamage);\r\n                }\r\n            }\r\n\r\n            // Track this enemy (visual tracking on all clients)\r\n            if (projectile.chainedEnemies) {\r\n                projectile.chainedEnemies.add(enemy);\r\n            }\r\n\r\n            // Chain to next enemy if jumps remaining (visual chaining on all clients)\r\n            if (projectile.chainJumps < projectile.maxJumps) {\r\n                chainToNextEnemy(k, projectile, enemy);\r\n            } else {\r\n                // No more jumps, destroy projectile\r\n                k.destroy(projectile);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Check if this projectile has already hit this enemy (for piercing)\r\n        if (projectile.piercedEnemies && projectile.piercedEnemies.has(enemy)) {\r\n            return; // Already hit this enemy\r\n        }\r\n\r\n        // In multiplayer, only host deals damage\r\n        // Clients just show visual effects\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            // Client: show visual feedback only\r\n            playEnemyHit();\r\n            spawnBloodSplatter(k, enemy.pos.x, enemy.pos.y, { isCrit: projectile.isCrit });\r\n\r\n            // Track for piercing and destroy projectile as needed\r\n            if (projectile.piercedEnemies) {\r\n                projectile.piercedEnemies.add(enemy);\r\n            }\r\n            if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\r\n                k.destroy(projectile);\r\n            }\r\n            return; // Skip damage dealing on client\r\n        }\r\n\r\n        // Host or singleplayer: deal damage\r\n        playEnemyHit();\r\n\r\n        // Calculate final damage with synergy bonuses\r\n        let finalDamage = projectile.damage;\r\n\r\n        // Executioner synergy: +100% damage to enemies below 25% HP\r\n        if (projectile.ownerSlotIndex !== undefined) {\r\n            const allPlayers = k.get('player');\r\n            const ownerPlayer = allPlayers.find(p => p.slotIndex === projectile.ownerSlotIndex);\r\n            if (ownerPlayer && ownerPlayer.executionerEnabled && ownerPlayer.executionerThreshold) {\r\n                const enemyHPPercent = enemy.hp() / (enemy.maxHealth || enemy.hp());\r\n                if (enemyHPPercent < ownerPlayer.executionerThreshold) {\r\n                    finalDamage = Math.floor(finalDamage * (1 + (ownerPlayer.executionerDamageBonus || 1.0)));\r\n                }\r\n            }\r\n        }\r\n\r\n        // Use takeDamage if available (handles armor/shields), otherwise use hurt\r\n        if (enemy.takeDamage) {\r\n            enemy.takeDamage(finalDamage);\r\n        } else {\r\n            enemy.hurt(finalDamage);\r\n        }\r\n\r\n        // Vampiric Rounds synergy: heal player on crit damage\r\n        if (projectile.isCrit && projectile.ownerSlotIndex !== undefined) {\r\n            // Find the player who owns this projectile\r\n            const allPlayers = k.get('player');\r\n            const ownerPlayer = allPlayers.find(p => p.slotIndex === projectile.ownerSlotIndex);\r\n            if (ownerPlayer && ownerPlayer.vampiricCrits && ownerPlayer.vampiricHealPercent) {\r\n                const healAmount = Math.floor(finalDamage * ownerPlayer.vampiricHealPercent);\r\n                if (healAmount > 0 && ownerPlayer.hp() < ownerPlayer.maxHealth) {\r\n                    const newHP = Math.min(ownerPlayer.maxHealth, ownerPlayer.hp() + healAmount);\r\n                    ownerPlayer.setHP(newHP);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Lifesteal upgrade: heal player on damage dealt\r\n        if (projectile.ownerSlotIndex !== undefined) {\r\n            const allPlayers = k.get('player');\r\n            const ownerPlayer = allPlayers.find(p => p.slotIndex === projectile.ownerSlotIndex);\r\n            if (ownerPlayer && ownerPlayer.lifestealPercent && ownerPlayer.lifestealPercent > 0) {\r\n                // Calculate lifesteal (Vampire Lord synergy multiplies on crits)\r\n                let lifestealMultiplier = ownerPlayer.lifestealPercent;\r\n                if (projectile.isCrit && ownerPlayer.vampireLordEnabled && ownerPlayer.vampireLordMultiplier) {\r\n                    lifestealMultiplier *= ownerPlayer.vampireLordMultiplier;\r\n                }\r\n                const healAmount = Math.floor(finalDamage * lifestealMultiplier);\r\n                if (healAmount > 0 && ownerPlayer.hp() < ownerPlayer.maxHealth) {\r\n                    const newHP = Math.min(ownerPlayer.maxHealth, ownerPlayer.hp() + healAmount);\r\n                    ownerPlayer.setHP(newHP);\r\n\r\n                    // Broadcast heal event for multiplayer\r\n                    if (isMultiplayerActive() && isHost()) {\r\n                        broadcastHealEvent({\r\n                            slotIndex: ownerPlayer.slotIndex,\r\n                            healAmount: healAmount,\r\n                            newHP: newHP,\r\n                            source: 'lifesteal'\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Track who last hit this enemy for kill attribution\r\n        if (projectile.ownerSlotIndex !== undefined) {\r\n            enemy.lastHitBySlot = projectile.ownerSlotIndex;\r\n\r\n            // Update survivalist combat time when dealing damage (not just taking damage)\r\n            const allPlayers = k.get('player');\r\n            const ownerPlayer = allPlayers.find(p => p.slotIndex === projectile.ownerSlotIndex);\r\n            if (ownerPlayer && ownerPlayer.survivalistEnabled) {\r\n                ownerPlayer.survivalistLastCombatTime = k.time();\r\n            }\r\n        }\r\n\r\n        // Broadcast damage event for multiplayer\r\n        if (isMultiplayerActive() && isHost()) {\r\n            broadcastDamageEvent({\r\n                targetId: enemy.mpEntityId,\r\n                targetType: 'enemy',\r\n                damage: finalDamage,\r\n                isCrit: projectile.isCrit || false,\r\n                x: enemy.pos.x,\r\n                y: enemy.pos.y\r\n            });\r\n        }\r\n\r\n        // Apply fire DoT if projectile has burn effect\r\n        if (projectile.burnDamage && projectile.burnDuration) {\r\n            enemy.burnDamage = projectile.burnDamage;\r\n            enemy.burnDuration = projectile.burnDuration;\r\n            enemy.burnTimer = 0;\r\n        }\r\n\r\n        // Spawn blood splatter particle effect\r\n        spawnBloodSplatter(k, enemy.pos.x, enemy.pos.y, { isCrit: projectile.isCrit });\r\n\r\n        // Track this enemy for piercing\r\n        if (projectile.piercedEnemies) {\r\n            projectile.piercedEnemies.add(enemy);\r\n        }\r\n\r\n        // Destroy projectile if it can't pierce anymore\r\n        // If piercing = n, projectile can hit n+1 enemies total\r\n        // piercing = 0: hit 1 enemy, piercing = 1: hit 2 enemies, etc.\r\n        if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\r\n            k.destroy(projectile);\r\n        }\r\n\r\n        // Knockback enemy away from projectile direction\r\n        const knockbackDir = k.vec2(\r\n            enemy.pos.x - projectile.pos.x,\r\n            enemy.pos.y - projectile.pos.y\r\n        );\r\n        const knockbackDist = knockbackDir.len();\r\n        if (knockbackDist > 0) {\r\n            const normalized = knockbackDir.unit();\r\n            const knockbackAmount = COMBAT_CONFIG.KNOCKBACK_ENEMY_FROM_PROJECTILE;\r\n            applySafeKnockback(k, enemy, normalized, knockbackAmount);\r\n        }\r\n\r\n        // Spawn hit impact particle effect\r\n        spawnHitImpact(k, enemy.pos.x, enemy.pos.y, knockbackDir, { isCrit: projectile.isCrit });\r\n\r\n        // Screen effects for crits\r\n        if (projectile.isCrit) {\r\n            EffectPresets.criticalHit();\r\n        }\r\n\r\n        // Visual feedback (different color for crits)\r\n        enemy.color = projectile.isCrit\r\n            ? k.rgb(...COMBAT_CONFIG.CRIT_COLOR)\r\n            : k.rgb(...COMBAT_CONFIG.HIT_COLOR);\r\n        k.wait(COMBAT_CONFIG.HIT_FLASH_DURATION, () => {\r\n            if (enemy.exists()) {\r\n                enemy.color = k.rgb(255, 100, 100);\r\n            }\r\n        });\r\n    });\r\n    \r\n    // Collision: Projectile hits Boss (consolidated handler for all projectile types)\r\n    k.onCollide('projectile', 'boss', (projectile, boss) => {\r\n        if (k.paused) return;\r\n\r\n        // Handle explosive projectiles\r\n        if (projectile.isExplosive) {\r\n            explodeProjectile(k, projectile, boss.pos.x, boss.pos.y);\r\n            return;\r\n        }\r\n\r\n        // Handle chain lightning projectiles\r\n        if (projectile.isChainLightning) {\r\n            // Check if already hit this boss\r\n            if (projectile.chainedEnemies && projectile.chainedEnemies.has(boss)) {\r\n                return;\r\n            }\r\n\r\n            // Only host deals damage in multiplayer\r\n            if (!isMultiplayerActive() || isHost()) {\r\n                // Calculate damage (reduces per jump)\r\n                const jumpCount = projectile.chainJumps || 0;\r\n                const damageReduction = 1 - (projectile.chainDamageReduction || 0.15) * jumpCount;\r\n                const finalDamage = Math.floor(projectile.damage * Math.max(0.1, damageReduction));\r\n\r\n                // Deal damage\r\n                if (boss.takeDamage) {\r\n                    boss.takeDamage(finalDamage);\r\n                } else {\r\n                    boss.hurt(finalDamage);\r\n                }\r\n            }\r\n\r\n            // Track this boss (visual tracking on all clients)\r\n            if (projectile.chainedEnemies) {\r\n                projectile.chainedEnemies.add(boss);\r\n            }\r\n\r\n            // Chain to next enemy if jumps remaining\r\n            k.wait(0.01, () => {\r\n                if (!projectile.exists()) return;\r\n                if (projectile.chainJumps < projectile.maxJumps) {\r\n                    chainToNextEnemy(k, projectile, boss);\r\n                } else {\r\n                    k.destroy(projectile);\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        // Handle regular projectiles\r\n        // Check if this projectile has already hit this boss (for piercing)\r\n        if (projectile.piercedEnemies && projectile.piercedEnemies.has(boss)) {\r\n            return;\r\n        }\r\n\r\n        // In multiplayer, only host deals damage\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            spawnBloodSplatter(k, boss.pos.x, boss.pos.y, { isCrit: projectile.isCrit });\r\n            const knockbackDir = k.vec2(boss.pos.x - projectile.pos.x, boss.pos.y - projectile.pos.y);\r\n            spawnHitImpact(k, boss.pos.x, boss.pos.y, knockbackDir, { isCrit: projectile.isCrit });\r\n\r\n            if (projectile.piercedEnemies) {\r\n                projectile.piercedEnemies.add(boss);\r\n            }\r\n            if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\r\n                k.destroy(projectile);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Host or singleplayer: deal damage\r\n        if (boss.takeDamage) {\r\n            boss.takeDamage(projectile.damage);\r\n        } else {\r\n            boss.hurt(projectile.damage);\r\n        }\r\n\r\n        // Track who last hit this boss for kill attribution\r\n        if (projectile.ownerSlotIndex !== undefined) {\r\n            boss.lastHitBySlot = projectile.ownerSlotIndex;\r\n        }\r\n\r\n        // Apply fire DoT\r\n        if (projectile.burnDamage && projectile.burnDuration) {\r\n            boss.burnDamage = projectile.burnDamage;\r\n            boss.burnDuration = projectile.burnDuration;\r\n            boss.burnTimer = 0;\r\n        }\r\n\r\n        spawnBloodSplatter(k, boss.pos.x, boss.pos.y, { isCrit: projectile.isCrit });\r\n\r\n        if (projectile.piercedEnemies) {\r\n            projectile.piercedEnemies.add(boss);\r\n        }\r\n\r\n        if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\r\n            k.destroy(projectile);\r\n        }\r\n\r\n        // Knockback\r\n        const knockbackDir = k.vec2(boss.pos.x - projectile.pos.x, boss.pos.y - projectile.pos.y);\r\n        if (knockbackDir.len() > 0) {\r\n            applySafeKnockback(k, boss, knockbackDir.unit(), COMBAT_CONFIG.KNOCKBACK_BOSS_FROM_PROJECTILE);\r\n        }\r\n\r\n        spawnHitImpact(k, boss.pos.x, boss.pos.y, knockbackDir, { isCrit: projectile.isCrit });\r\n\r\n        // Screen effects for boss hits and crits\r\n        if (projectile.isCrit) {\r\n            EffectPresets.criticalHit();\r\n        } else {\r\n            EffectPresets.bossHit();\r\n        }\r\n\r\n        boss.color = projectile.isCrit ? k.rgb(255, 200, 0) : k.rgb(255, 255, 255);\r\n        k.wait(0.1, () => {\r\n            if (boss.exists()) boss.updateVisual();\r\n        });\r\n    });\r\n\r\n    // Collision: Projectile hits Miniboss\r\n    k.onCollide('projectile', 'miniboss', (projectile, miniboss) => {\r\n        if (k.paused) return;\r\n\r\n        // Only player projectiles can hit minibosses\r\n        if (projectile.isEnemyProjectile || projectile.isBossProjectile) {\r\n            return;\r\n        }\r\n\r\n        // Check if this projectile has already hit this miniboss (for piercing)\r\n        if (projectile.piercedEnemies && projectile.piercedEnemies.has(miniboss)) {\r\n            return; // Already hit this miniboss\r\n        }\r\n\r\n        // In multiplayer, only host deals damage\r\n        // Clients just show visual effects\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            // Client: show visual feedback only\r\n            spawnBloodSplatter(k, miniboss.pos.x, miniboss.pos.y, { isCrit: projectile.isCrit });\r\n            const impactDir = k.vec2(miniboss.pos.x - projectile.pos.x, miniboss.pos.y - projectile.pos.y);\r\n            spawnHitImpact(k, miniboss.pos.x, miniboss.pos.y, impactDir, { isCrit: projectile.isCrit });\r\n\r\n            // Track for piercing and destroy projectile as needed\r\n            if (projectile.piercedEnemies) {\r\n                projectile.piercedEnemies.add(miniboss);\r\n            }\r\n            if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\r\n                k.destroy(projectile);\r\n            }\r\n            return; // Skip damage dealing on client\r\n        }\r\n\r\n        // Host or singleplayer: deal damage\r\n        // Calculate final damage (with crit)\r\n        let finalDamage = projectile.damage;\r\n        if (projectile.isCrit) {\r\n            finalDamage = Math.floor(finalDamage * 1.5); // 50% crit bonus\r\n        }\r\n\r\n        // Use takeDamage to handle armor/shields\r\n        if (miniboss.takeDamage) {\r\n            miniboss.takeDamage(finalDamage);\r\n        } else {\r\n            miniboss.hurt(finalDamage);\r\n        }\r\n\r\n        // Track who last hit this miniboss for kill attribution\r\n        if (projectile.ownerSlotIndex !== undefined) {\r\n            miniboss.lastHitBySlot = projectile.ownerSlotIndex;\r\n        }\r\n\r\n        // Apply fire DoT if projectile has burn effect\r\n        if (projectile.burnDamage && projectile.burnDuration) {\r\n            miniboss.burnDamage = projectile.burnDamage;\r\n            miniboss.burnDuration = projectile.burnDuration;\r\n            miniboss.burnTimer = 0;\r\n        }\r\n\r\n        // Spawn blood splatter particle effect\r\n        spawnBloodSplatter(k, miniboss.pos.x, miniboss.pos.y, { isCrit: projectile.isCrit });\r\n\r\n        // Spawn hit impact particle effect\r\n        const impactDir = k.vec2(miniboss.pos.x - projectile.pos.x, miniboss.pos.y - projectile.pos.y);\r\n        spawnHitImpact(k, miniboss.pos.x, miniboss.pos.y, impactDir, { isCrit: projectile.isCrit });\r\n\r\n        // Screen effects for crits\r\n        if (projectile.isCrit) {\r\n            EffectPresets.criticalHit();\r\n        }\r\n\r\n        // Track this miniboss for piercing\r\n        if (projectile.piercedEnemies) {\r\n            projectile.piercedEnemies.add(miniboss);\r\n        }\r\n        \r\n        // Destroy projectile if it can't pierce anymore\r\n        if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\r\n            k.destroy(projectile);\r\n        }\r\n        \r\n        // Visual feedback (different color for crits)\r\n        miniboss.color = projectile.isCrit ? k.rgb(255, 200, 0) : k.rgb(255, 255, 255);\r\n        k.wait(0.1, () => {\r\n            if (miniboss.exists()) {\r\n                // Restore miniboss color (will be updated by updateVisual if armor/shield changed)\r\n                miniboss.updateVisual();\r\n            }\r\n        });\r\n    });\r\n\r\n    // Collision: Enemy hits Player\r\n    k.onCollide('enemy', 'player', (enemy, player) => {\r\n        if (k.paused) return;\r\n\r\n        // Don't damage dead players\r\n        if (player.isDead || player.hp() <= 0) return;\r\n\r\n        // Check if player is invulnerable (immunity frames)\r\n        if (player.invulnerable) return;\r\n\r\n        // In multiplayer, only host processes damage\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            // Client: show visual feedback only\r\n            playPlayerHit();\r\n            spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\r\n            player.color = k.rgb(...COMBAT_CONFIG.HIT_COLOR);\r\n            return;\r\n        }\r\n\r\n        // Host or singleplayer: process damage\r\n        // Check for dodge chance (The Scout ability)\r\n        if (player.dodgeChance && Math.random() < player.dodgeChance) {\r\n            // Dodged! No damage taken\r\n            // Broadcast dodge event for multiplayer\r\n            if (isMultiplayerActive() && isHost()) {\r\n                broadcastDodgeEvent({\r\n                    slotIndex: player.slotIndex,\r\n                    x: player.pos.x,\r\n                    y: player.pos.y\r\n                });\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Play player hit sound and effects\r\n        playPlayerHit();\r\n        EffectPresets.playerHit();\r\n\r\n        // Apply damage with defense reduction (use enemy's damage if available)\r\n        const baseDamage = enemy.damage || COMBAT_CONFIG.BASE_ENEMY_DAMAGE;\r\n        const finalDamage = calculateDamageAfterDefense(baseDamage, player.defense || 0, player.damageReduction || 0);\r\n        player.hurt(finalDamage);\r\n\r\n        // Update survivalist combat time (for out-of-combat regen)\r\n        if (player.survivalistEnabled) {\r\n            player.survivalistLastCombatTime = k.time();\r\n        }\r\n\r\n        // Set invulnerability frames (don't reset timer if already invulnerable)\r\n        if (!player.invulnerable) {\r\n            player.invulnerable = true;\r\n            player.invulnerableTime = player.invulnerableDuration;\r\n        }\r\n\r\n        // Spawn blood splatter particle effect for player\r\n        spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\r\n\r\n        // Leech lifesteal: heal enemy when it hits player\r\n        if (enemy.lifesteal && enemy.exists()) {\r\n            const currentHP = enemy.hp();\r\n            const maxHP = enemy.maxHealth;\r\n            if (currentHP < maxHP) {\r\n                const newHP = Math.min(maxHP, currentHP + enemy.lifesteal);\r\n                enemy.setHP(newHP);\r\n            }\r\n        }\r\n\r\n        // Vampiric elite: heal enemy when it hits player\r\n        if (enemy.isVampiric && enemy.vampiricHealAmount && enemy.exists()) {\r\n            const currentHP = enemy.hp();\r\n            const maxHP = enemy.maxHealth;\r\n            if (currentHP < maxHP) {\r\n                const newHP = Math.min(maxHP, currentHP + enemy.vampiricHealAmount);\r\n                enemy.setHP(newHP);\r\n            }\r\n        }\r\n\r\n        // Thorns: reflect damage back to attacker\r\n        if (player.thornsPercent && player.thornsPercent > 0 && enemy.exists()) {\r\n            const thornsDamage = Math.floor(baseDamage * player.thornsPercent);\r\n            if (thornsDamage > 0) {\r\n                // If thorns ignores armor (from Retribution synergy), deal raw damage\r\n                if (player.thornsIgnoreArmor) {\r\n                    enemy.hurt(thornsDamage);\r\n                } else {\r\n                    // Normal thorns applies enemy's defense\r\n                    const reducedThornsDamage = Math.max(1, thornsDamage - (enemy.defense || 0));\r\n                    enemy.hurt(reducedThornsDamage);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Knockback enemy away from player (player doesn't move)\r\n        const knockbackDir = k.vec2(\r\n            enemy.pos.x - player.pos.x,\r\n            enemy.pos.y - player.pos.y\r\n        );\r\n        const knockbackDist = knockbackDir.len();\r\n        if (knockbackDist > 0) {\r\n            const normalized = knockbackDir.unit();\r\n            const knockbackAmount = COMBAT_CONFIG.KNOCKBACK_ENEMY;\r\n            applySafeKnockback(k, enemy, normalized, knockbackAmount);\r\n        }\r\n\r\n        // Initial hit flash (will be overridden by immunity flash)\r\n        player.color = k.rgb(...COMBAT_CONFIG.HIT_COLOR);\r\n    });\r\n    \r\n    // Collision: Miniboss hits Player\r\n    k.onCollide('miniboss', 'player', (miniboss, player) => {\r\n        if (k.paused) return;\r\n\r\n        // Don't damage dead players\r\n        if (player.isDead || player.hp() <= 0) return;\r\n\r\n        // Check if player is invulnerable (immunity frames)\r\n        if (player.invulnerable) return;\r\n\r\n        // In multiplayer, only host processes damage\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            // Client: show visual feedback only\r\n            playPlayerHit();\r\n            spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\r\n            player.color = k.rgb(255, 100, 100);\r\n            return;\r\n        }\r\n\r\n        // Host or singleplayer: process damage\r\n        // Check for dodge chance (The Scout ability)\r\n        if (player.dodgeChance && Math.random() < player.dodgeChance) {\r\n            // Dodged! No damage taken\r\n            // Broadcast dodge event for multiplayer\r\n            if (isMultiplayerActive() && isHost()) {\r\n                broadcastDodgeEvent({\r\n                    slotIndex: player.slotIndex,\r\n                    x: player.pos.x,\r\n                    y: player.pos.y\r\n                });\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Play player hit sound and effects\r\n        playPlayerHit();\r\n        EffectPresets.playerHit();\r\n\r\n        // Minibosses deal more damage than regular enemies but less than bosses\r\n        // Melee miniboss deals melee damage, others use base damage\r\n        let baseDamage = COMBAT_CONFIG.BASE_MINIBOSS_DAMAGE;\r\n        if (miniboss.type === 'brute' || miniboss.type === 'berserker' || miniboss.type === 'guardian') {\r\n            if (miniboss.meleeDamage) {\r\n                baseDamage = miniboss.meleeDamage;\r\n            }\r\n        }\r\n        const finalDamage = calculateDamageAfterDefense(baseDamage, player.defense || 0, player.damageReduction || 0);\r\n        player.hurt(finalDamage);\r\n\r\n        // Update survivalist combat time (for out-of-combat regen)\r\n        if (player.survivalistEnabled) {\r\n            player.survivalistLastCombatTime = k.time();\r\n        }\r\n\r\n        // Set invulnerability frames (don't reset timer if already invulnerable)\r\n        if (!player.invulnerable) {\r\n            player.invulnerable = true;\r\n            player.invulnerableTime = player.invulnerableDuration;\r\n        }\r\n\r\n        // Spawn blood splatter particle effect for player\r\n        spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\r\n\r\n        // Thorns: reflect damage back to miniboss\r\n        if (player.thornsPercent && player.thornsPercent > 0 && miniboss.exists()) {\r\n            const thornsDamage = Math.floor(baseDamage * player.thornsPercent);\r\n            if (thornsDamage > 0) {\r\n                // If thorns ignores armor (from Retribution synergy), deal raw damage\r\n                if (player.thornsIgnoreArmor) {\r\n                    if (miniboss.takeDamage) {\r\n                        miniboss.takeDamage(thornsDamage);\r\n                    } else {\r\n                        miniboss.hurt(thornsDamage);\r\n                    }\r\n                } else {\r\n                    // Normal thorns applies miniboss's defense\r\n                    const reducedThornsDamage = Math.max(1, thornsDamage - (miniboss.defense || 0));\r\n                    if (miniboss.takeDamage) {\r\n                        miniboss.takeDamage(reducedThornsDamage);\r\n                    } else {\r\n                        miniboss.hurt(reducedThornsDamage);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Knockback miniboss away from player (player doesn't move)\r\n        const knockbackDir = k.vec2(\r\n            miniboss.pos.x - player.pos.x,\r\n            miniboss.pos.y - player.pos.y\r\n        );\r\n        const knockbackDist = knockbackDir.len();\r\n        if (knockbackDist > 0) {\r\n            const normalized = knockbackDir.unit();\r\n            const knockbackAmount = COMBAT_CONFIG.KNOCKBACK_MINIBOSS;\r\n            applySafeKnockback(k, miniboss, normalized, knockbackAmount);\r\n        }\r\n\r\n        // Visual feedback\r\n        player.color = k.rgb(255, 100, 100);\r\n    });\r\n\r\n    // Collision: Boss hits Player\r\n    k.onCollide('boss', 'player', (boss, player) => {\r\n        if (k.paused) return;\r\n\r\n        // Don't damage dead players\r\n        if (player.isDead || player.hp() <= 0) return;\r\n\r\n        // Check if player is invulnerable (immunity frames)\r\n        if (player.invulnerable) return;\r\n\r\n        // In multiplayer, only host processes damage\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            // Client: show visual feedback only\r\n            playPlayerHit();\r\n            spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\r\n            player.color = k.rgb(255, 100, 100);\r\n            return;\r\n        }\r\n\r\n        // Host or singleplayer: process damage\r\n        // Check for dodge chance (The Scout ability)\r\n        if (player.dodgeChance && Math.random() < player.dodgeChance) {\r\n            // Dodged! No damage taken\r\n            // Broadcast dodge event for multiplayer\r\n            if (isMultiplayerActive() && isHost()) {\r\n                broadcastDodgeEvent({\r\n                    slotIndex: player.slotIndex,\r\n                    x: player.pos.x,\r\n                    y: player.pos.y\r\n                });\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Play player hit sound and effects\r\n        playPlayerHit();\r\n        EffectPresets.playerHit();\r\n\r\n        // Bosses deal more damage\r\n        // Melee guardian deals melee damage, others use base damage\r\n        let baseDamage = COMBAT_CONFIG.BASE_BOSS_DAMAGE;\r\n        if (boss.type === 'twinGuardianMelee' && boss.meleeDamage) {\r\n            const enrageMultiplier = boss.enraged ? COMBAT_CONFIG.BOSS_ENRAGE_DAMAGE_MULTIPLIER : 1.0;\r\n            baseDamage = boss.meleeDamage * enrageMultiplier;\r\n        }\r\n\r\n        const finalDamage = calculateDamageAfterDefense(baseDamage, player.defense || 0, player.damageReduction || 0);\r\n        player.hurt(finalDamage);\r\n\r\n        // Update survivalist combat time (for out-of-combat regen)\r\n        if (player.survivalistEnabled) {\r\n            player.survivalistLastCombatTime = k.time();\r\n        }\r\n\r\n        // Set invulnerability frames (don't reset timer if already invulnerable)\r\n        if (!player.invulnerable) {\r\n            player.invulnerable = true;\r\n            player.invulnerableTime = player.invulnerableDuration;\r\n        }\r\n\r\n        // Spawn blood splatter particle effect for player\r\n        spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\r\n\r\n        // Thorns: reflect damage back to boss\r\n        if (player.thornsPercent && player.thornsPercent > 0 && boss.exists()) {\r\n            const thornsDamage = Math.floor(baseDamage * player.thornsPercent);\r\n            if (thornsDamage > 0) {\r\n                // If thorns ignores armor (from Retribution synergy), deal raw damage\r\n                if (player.thornsIgnoreArmor) {\r\n                    if (boss.takeDamage) {\r\n                        boss.takeDamage(thornsDamage);\r\n                    } else {\r\n                        boss.hurt(thornsDamage);\r\n                    }\r\n                } else {\r\n                    // Normal thorns applies boss's defense\r\n                    const reducedThornsDamage = Math.max(1, thornsDamage - (boss.defense || 0));\r\n                    if (boss.takeDamage) {\r\n                        boss.takeDamage(reducedThornsDamage);\r\n                    } else {\r\n                        boss.hurt(reducedThornsDamage);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Knockback boss away from player (player doesn't move)\r\n        const knockbackDir = k.vec2(\r\n            boss.pos.x - player.pos.x,\r\n            boss.pos.y - player.pos.y\r\n        );\r\n        const knockbackDist = knockbackDir.len();\r\n        if (knockbackDist > 0) {\r\n            const normalized = knockbackDir.unit();\r\n            const knockbackAmount = COMBAT_CONFIG.KNOCKBACK_BOSS;\r\n            applySafeKnockback(k, boss, normalized, knockbackAmount);\r\n        }\r\n\r\n        // Initial hit flash (will be overridden by immunity flash)\r\n        player.color = k.rgb(255, 100, 100);\r\n    });\r\n\r\n    // Collision: Enemy/Boss Projectile hits Player\r\n    k.onCollide('projectile', 'player', (projectile, player) => {\r\n        if (k.paused) return;\r\n\r\n        // Only enemy/boss projectiles can hit player (player projectiles are handled separately)\r\n        if (!projectile.isBossProjectile && !projectile.isEnemyProjectile) return;\r\n\r\n        // Don't damage dead players\r\n        if (player.isDead || player.hp() <= 0) return;\r\n\r\n        // Check if player is invulnerable (immunity frames)\r\n        if (player.invulnerable) return;\r\n\r\n        // In multiplayer, only host processes damage\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            // Client: show visual feedback only\r\n            playPlayerHit();\r\n            spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\r\n            player.color = k.rgb(255, 100, 100);\r\n            k.destroy(projectile);\r\n            return;\r\n        }\r\n\r\n        // Host or singleplayer: process damage\r\n        // Check for dodge chance (The Scout ability)\r\n        if (player.dodgeChance && Math.random() < player.dodgeChance) {\r\n            // Dodged! No damage taken\r\n            k.destroy(projectile);\r\n            return;\r\n        }\r\n\r\n        // Play player hit sound and effects\r\n        playPlayerHit();\r\n        EffectPresets.playerHit();\r\n\r\n        // Apply damage with damage reduction (The Tank ability)\r\n        const damageAfterReduction = projectile.damage * (1 - (player.damageReduction || 0));\r\n        const finalDamage = Math.max(1, damageAfterReduction - (player.defense || 0));\r\n        player.hurt(finalDamage);\r\n\r\n        // Set invulnerability frames (don't reset timer if already invulnerable)\r\n        if (!player.invulnerable) {\r\n            player.invulnerable = true;\r\n            player.invulnerableTime = player.invulnerableDuration;\r\n        }\r\n\r\n        // Spawn blood splatter particle effect for player\r\n        spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\r\n\r\n        // Destroy projectile\r\n        k.destroy(projectile);\r\n        \r\n        // Initial hit flash (will be overridden by immunity flash)\r\n        player.color = k.rgb(255, 100, 100);\r\n    });\r\n    \r\n    // Collision: Orbital hits Enemy\r\n    k.onCollide('orbital', 'enemy', (orb, enemy) => {\r\n        if (k.paused) return;\r\n        if (!enemy.exists()) return;\r\n\r\n        // Check contact cooldown\r\n        if (orb.contactCooldown > 0) return;\r\n\r\n        // In multiplayer, only host deals damage\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            // Client: visual feedback only, skip damage\r\n            orb.contactCooldown = orb.contactCooldownDuration || 0.2;\r\n            return;\r\n        }\r\n\r\n        // Host or singleplayer: deal damage\r\n        enemy.hurt(orb.damage);\r\n\r\n        // Set contact cooldown\r\n        orb.contactCooldown = orb.contactCooldownDuration || 0.2;\r\n    });\r\n    \r\n    // Collision: Orbital hits Boss\r\n    k.onCollide('orbital', 'boss', (orb, boss) => {\r\n        if (k.paused) return;\r\n        if (!boss.exists()) return;\r\n\r\n        // Check contact cooldown\r\n        if (orb.contactCooldown > 0) return;\r\n\r\n        // In multiplayer, only host deals damage\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            // Client: visual feedback only, skip damage\r\n            orb.contactCooldown = orb.contactCooldownDuration || 0.2;\r\n            return;\r\n        }\r\n\r\n        // Host or singleplayer: deal damage\r\n        // Deal damage using boss's takeDamage method\r\n        if (boss.takeDamage) {\r\n            boss.takeDamage(orb.damage);\r\n        } else {\r\n            boss.hurt(orb.damage);\r\n        }\r\n\r\n        // Set contact cooldown\r\n        orb.contactCooldown = orb.contactCooldownDuration || 0.2;\r\n    });\r\n}\r\n\r\n// Initialize orbital weapons\r\nfunction initializeOrbitalWeapons(k, player) {\r\n    // Clean up any existing orbs first to prevent accumulation\r\n    if (player.orbitalOrbs && player.orbitalOrbs.length > 0) {\r\n        player.orbitalOrbs.forEach(orb => {\r\n            if (orb && orb.exists()) k.destroy(orb);\r\n        });\r\n    }\r\n\r\n    // Reset arrays\r\n    player.orbitalOrbs = [];\r\n    player.orbitalAngles = [];\r\n\r\n    const orbCount = player.projectileCount || 1;\r\n    const orbitRadius = player.orbitRadius || WEAPON_CONFIG.BASE_ORBIT_RADIUS;\r\n\r\n    // Create initial orbs\r\n    for (let i = 0; i < orbCount; i++) {\r\n        const angle = (360 / orbCount) * i; // Evenly space orbs\r\n        const rad = (angle * Math.PI) / 180;\r\n        const x = player.pos.x + Math.cos(rad) * orbitRadius;\r\n        const y = player.pos.y + Math.sin(rad) * orbitRadius;\r\n        \r\n        const orb = k.add([\r\n            k.text(player.weaponDef?.char || '', { size: 16 }),\r\n            k.pos(x, y),\r\n            k.anchor('center'),\r\n            k.color(...(player.weaponDef?.color || [100, 200, 255])),\r\n            k.area(),\r\n            'orbital',\r\n            'playerProjectile' // So it can damage enemies\r\n        ]);\r\n        \r\n        orb.damage = player.projectileDamage || 12;\r\n        orb.contactCooldown = 0; // Cooldown to prevent multiple hits per frame\r\n        orb.contactCooldownDuration = WEAPON_CONFIG.ORBITAL_CONTACT_COOLDOWN;\r\n        \r\n        player.orbitalOrbs.push(orb);\r\n        player.orbitalAngles.push(angle);\r\n    }\r\n}\r\n\r\n// Update orbital weapons rotation\r\nfunction updateOrbitalWeapons(k, player) {\r\n    // Reinitialize if needed (e.g., after upgrade)\r\n    if (player.orbitalNeedsReinit) {\r\n        // Clean up old orbs\r\n        if (player.orbitalOrbs) {\r\n            player.orbitalOrbs.forEach(orb => {\r\n                if (orb.exists()) orb.destroy();\r\n            });\r\n        }\r\n        player.orbitalOrbs = [];\r\n        player.orbitalAngles = [];\r\n        initializeOrbitalWeapons(k, player);\r\n        player.orbitalNeedsReinit = false;\r\n    }\r\n    \r\n    // Reinitialize if orbs are missing or count changed\r\n    const expectedOrbCount = player.projectileCount || 1;\r\n    if (!player.orbitalOrbs || player.orbitalOrbs.length !== expectedOrbCount) {\r\n        initializeOrbitalWeapons(k, player);\r\n    }\r\n    \r\n    if (!player.orbitalOrbs || !player.orbitalAngles) return;\r\n\r\n    const rotationSpeed = player.rotationSpeed || WEAPON_CONFIG.BASE_ROTATION_SPEED;\r\n    const orbitRadius = player.orbitRadius || WEAPON_CONFIG.BASE_ORBIT_RADIUS;\r\n    \r\n    // Update each orb\r\n    player.orbitalOrbs.forEach((orb, index) => {\r\n        if (!orb.exists()) return;\r\n        \r\n        // Update angle\r\n        player.orbitalAngles[index] = (player.orbitalAngles[index] + rotationSpeed * k.dt()) % 360;\r\n        const rad = (player.orbitalAngles[index] * Math.PI) / 180;\r\n        \r\n        // Update position\r\n        orb.pos.x = player.pos.x + Math.cos(rad) * orbitRadius;\r\n        orb.pos.y = player.pos.y + Math.sin(rad) * orbitRadius;\r\n        \r\n        // Update contact cooldown\r\n        if (orb.contactCooldown > 0) {\r\n            orb.contactCooldown -= k.dt();\r\n        }\r\n    });\r\n    \r\n    // Clean up destroyed orbs\r\n    player.orbitalOrbs = player.orbitalOrbs.filter(orb => orb.exists());\r\n    // Re-sync angles array if orbs were removed\r\n    if (player.orbitalOrbs.length !== player.orbitalAngles.length) {\r\n        player.orbitalAngles = player.orbitalAngles.slice(0, player.orbitalOrbs.length);\r\n    }\r\n}\r\n\r\n// Create explosive projectile\r\nfunction createExplosiveProjectile(k, x, y, direction, speed, damage, explosionRadius, explosionDamage, maxRange, isCrit = false) {\r\n    const projectile = createProjectile(k, x, y, direction, speed, damage, 0, 0, isCrit, maxRange);\r\n    projectile.isExplosive = true;\r\n    projectile.explosionRadius = explosionRadius || 50;\r\n    projectile.explosionDamage = explosionDamage || 15;\r\n\r\n    return projectile;\r\n}\r\n\r\n// Create chain lightning projectile\r\nfunction createChainProjectile(k, x, y, direction, speed, damage, chainRange, maxJumps, damageReduction, maxRange, isCrit = false) {\r\n    const projectile = createProjectile(k, x, y, direction, speed, damage, 0, 0, isCrit, maxRange);\r\n    projectile.isChainLightning = true;\r\n    projectile.chainRange = chainRange || 70;\r\n    projectile.maxJumps = maxJumps || 3;\r\n    projectile.chainDamageReduction = damageReduction || 0.15;\r\n    projectile.chainJumps = 0;\r\n    projectile.chainedEnemies = new Set(); // Track which enemies have been hit\r\n\r\n    return projectile;\r\n}\r\n\r\n// Explode projectile and deal area damage\r\nfunction explodeProjectile(k, projectile, x, y) {\r\n    if (!projectile.exists()) return;\r\n\r\n    // Play explosion sound and effects\r\n    playExplosion();\r\n    EffectPresets.explosion();\r\n\r\n    const explosionRadius = projectile.explosionRadius || 50;\r\n    const explosionDamage = projectile.explosionDamage || 15;\r\n\r\n    // Only host deals damage in multiplayer\r\n    if (!isMultiplayerActive() || isHost()) {\r\n        // Damage all enemies in radius\r\n        const enemies = k.get('enemy');\r\n        const bosses = k.get('boss');\r\n        const allTargets = [...enemies, ...bosses];\r\n\r\n        for (const target of allTargets) {\r\n            if (!target.exists()) continue;\r\n\r\n            const dist = k.vec2(\r\n                target.pos.x - x,\r\n                target.pos.y - y\r\n            ).len();\r\n\r\n            if (dist <= explosionRadius) {\r\n                if (target.takeDamage) {\r\n                    // Boss with armor system\r\n                    target.takeDamage(explosionDamage);\r\n                } else {\r\n                    // Regular enemy\r\n                    target.hurt(explosionDamage);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Visual explosion effect\r\n    const explosionText = k.add([\r\n        k.text('*', { size: 24 }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(255, 200, 0),\r\n        k.z(200)\r\n    ]);\r\n    k.wait(0.2, () => {\r\n        if (explosionText.exists()) k.destroy(explosionText);\r\n    });\r\n    \r\n    // Destroy projectile\r\n    k.destroy(projectile);\r\n}\r\n\r\n// Chain lightning to next enemy\r\nfunction chainToNextEnemy(k, projectile, currentEnemy) {\r\n    if (!projectile.exists()) return;\r\n    \r\n    const chainRange = projectile.chainRange || 70;\r\n    const enemies = k.get('enemy');\r\n    const bosses = k.get('boss');\r\n    const allTargets = [...enemies, ...bosses];\r\n    \r\n    // Find nearest enemy within chain range that hasn't been hit\r\n    let nearestEnemy = null;\r\n    let nearestDist = chainRange;\r\n    \r\n    for (const target of allTargets) {\r\n        if (!target.exists() || target === currentEnemy) continue;\r\n        if (projectile.chainedEnemies && projectile.chainedEnemies.has(target)) continue;\r\n        \r\n        const dist = k.vec2(\r\n            target.pos.x - currentEnemy.pos.x,\r\n            target.pos.y - currentEnemy.pos.y\r\n        ).len();\r\n        \r\n        if (dist <= chainRange && dist < nearestDist) {\r\n            nearestEnemy = target;\r\n            nearestDist = dist;\r\n        }\r\n    }\r\n    \r\n    if (nearestEnemy) {\r\n        // Chain to next enemy\r\n        projectile.chainJumps = (projectile.chainJumps || 0) + 1;\r\n        \r\n        // Visual chain effect - use a thin rotated rectangle as a line\r\n        const startPos = currentEnemy.pos;\r\n        const endPos = nearestEnemy.pos;\r\n        const distance = k.vec2(endPos.x - startPos.x, endPos.y - startPos.y).len();\r\n        const angle = Math.atan2(endPos.y - startPos.y, endPos.x - startPos.x);\r\n        const midX = (startPos.x + endPos.x) / 2;\r\n        const midY = (startPos.y + endPos.y) / 2;\r\n        \r\n        const chainLine = k.add([\r\n            k.rect(distance, 2), // Thin rectangle as line\r\n            k.pos(midX, midY),\r\n            k.anchor('center'),\r\n            k.rotate(angle),\r\n            k.color(255, 255, 100),\r\n            k.z(150)\r\n        ]);\r\n        k.wait(0.1, () => {\r\n            if (chainLine.exists()) k.destroy(chainLine);\r\n        });\r\n        \r\n        // Teleport projectile to next enemy position to trigger collision\r\n        projectile.pos.x = nearestEnemy.pos.x;\r\n        projectile.pos.y = nearestEnemy.pos.y;\r\n        \r\n        // The collision handler will be triggered automatically\r\n    } else {\r\n        // No more enemies in range, destroy projectile\r\n        k.destroy(projectile);\r\n    }\r\n}\r\n\r\n","/**\r\n * Tutorial System\r\n *\r\n * Shows helpful hints to new players on first occurrence.\r\n * Hints are stored in localStorage and only shown once.\r\n */\r\n\r\n// Tutorial hint definitions\r\nconst TUTORIAL_HINTS = {\r\n    movement: {\r\n        id: 'movement',\r\n        message: 'Use WASD to move',\r\n        duration: 3,\r\n        trigger: 'firstMove' // Triggered on game start\r\n    },\r\n    shooting: {\r\n        id: 'shooting',\r\n        message: 'Aim with mouse - autofire!',\r\n        duration: 3,\r\n        trigger: 'firstShoot' // Triggered when player starts shooting\r\n    },\r\n    levelUp: {\r\n        id: 'levelUp',\r\n        message: 'Choose upgrade with 1-3 or click',\r\n        duration: 4,\r\n        trigger: 'firstLevelUp' // Triggered on first level up\r\n    },\r\n    synergy: {\r\n        id: 'synergy',\r\n        message: 'Combine upgrades for bonuses!',\r\n        duration: 4,\r\n        trigger: 'firstSynergy' // Triggered when synergy is first activated\r\n    },\r\n    shop: {\r\n        id: 'shop',\r\n        message: 'Spend credits on permanent upgrades',\r\n        duration: 4,\r\n        trigger: 'firstShopVisit' // Triggered when visiting shop\r\n    }\r\n};\r\n\r\n// Storage key for tutorial progress\r\nconst TUTORIAL_STORAGE_KEY = 'superSmashTexty_tutorialProgress';\r\n\r\n// Currently displayed hint (to prevent duplicates)\r\nlet currentHint = null;\r\n\r\n/**\r\n * Load tutorial progress from localStorage\r\n * @returns {Object} Tutorial progress with hintsShown array\r\n */\r\nexport function loadTutorialProgress() {\r\n    try {\r\n        const stored = localStorage.getItem(TUTORIAL_STORAGE_KEY);\r\n        if (stored) {\r\n            return JSON.parse(stored);\r\n        }\r\n    } catch (e) {\r\n        console.warn('Failed to load tutorial progress:', e);\r\n    }\r\n\r\n    return { hintsShown: [] };\r\n}\r\n\r\n/**\r\n * Save tutorial progress to localStorage\r\n * @param {Object} progress - Tutorial progress to save\r\n */\r\nfunction saveTutorialProgress(progress) {\r\n    try {\r\n        localStorage.setItem(TUTORIAL_STORAGE_KEY, JSON.stringify(progress));\r\n    } catch (e) {\r\n        console.warn('Failed to save tutorial progress:', e);\r\n    }\r\n}\r\n\r\n/**\r\n * Check if a hint has been shown before\r\n * @param {string} hintId - Hint identifier\r\n * @returns {boolean} Whether the hint has been shown\r\n */\r\nexport function hasHintBeenShown(hintId) {\r\n    const progress = loadTutorialProgress();\r\n    return progress.hintsShown.includes(hintId);\r\n}\r\n\r\n/**\r\n * Mark a hint as shown\r\n * @param {string} hintId - Hint identifier\r\n */\r\nfunction markHintShown(hintId) {\r\n    const progress = loadTutorialProgress();\r\n    if (!progress.hintsShown.includes(hintId)) {\r\n        progress.hintsShown.push(hintId);\r\n        saveTutorialProgress(progress);\r\n    }\r\n}\r\n\r\n/**\r\n * Show a tutorial hint if it hasn't been shown before\r\n * @param {object} k - KAPLAY instance\r\n * @param {string} hintId - Hint identifier\r\n * @returns {boolean} Whether the hint was shown\r\n */\r\nexport function showHint(k, hintId) {\r\n    // Don't show if already showing a hint\r\n    if (currentHint) return false;\r\n\r\n    // Don't show if already shown before\r\n    if (hasHintBeenShown(hintId)) return false;\r\n\r\n    const hint = TUTORIAL_HINTS[hintId];\r\n    if (!hint) return false;\r\n\r\n    // Mark as shown\r\n    markHintShown(hintId);\r\n\r\n    // Create hint display\r\n    const hintBg = k.add([\r\n        k.rect(300, 40),\r\n        k.pos(k.width() / 2, 50),\r\n        k.anchor('center'),\r\n        k.color(0, 0, 0),\r\n        k.opacity(0.8),\r\n        k.fixed(),\r\n        k.z(700),\r\n        'tutorialHint'\r\n    ]);\r\n\r\n    const hintText = k.add([\r\n        k.text(hint.message, { size: 16 }),\r\n        k.pos(k.width() / 2, 50),\r\n        k.anchor('center'),\r\n        k.color(255, 255, 200),\r\n        k.fixed(),\r\n        k.z(701),\r\n        'tutorialHint'\r\n    ]);\r\n\r\n    currentHint = { bg: hintBg, text: hintText };\r\n\r\n    // Fade out after duration\r\n    k.wait(hint.duration, () => {\r\n        if (hintBg.exists()) k.destroy(hintBg);\r\n        if (hintText.exists()) k.destroy(hintText);\r\n        currentHint = null;\r\n    });\r\n\r\n    return true;\r\n}\r\n\r\n/**\r\n * Show movement hint (called at game start)\r\n * @param {object} k - KAPLAY instance\r\n */\r\nexport function showMovementHint(k) {\r\n    showHint(k, 'movement');\r\n}\r\n\r\n/**\r\n * Show shooting hint (called when player first shoots)\r\n * @param {object} k - KAPLAY instance\r\n */\r\nexport function showShootingHint(k) {\r\n    showHint(k, 'shooting');\r\n}\r\n\r\n/**\r\n * Show level up hint (called on first level up)\r\n * @param {object} k - KAPLAY instance\r\n */\r\nexport function showLevelUpHint(k) {\r\n    showHint(k, 'levelUp');\r\n}\r\n\r\n/**\r\n * Show synergy hint (called when synergy activates)\r\n * @param {object} k - KAPLAY instance\r\n */\r\nexport function showSynergyHint(k) {\r\n    showHint(k, 'synergy');\r\n}\r\n\r\n/**\r\n * Show shop hint (called when visiting shop)\r\n * @param {object} k - KAPLAY instance\r\n */\r\nexport function showShopHint(k) {\r\n    showHint(k, 'shop');\r\n}\r\n\r\n/**\r\n * Reset tutorial progress (for testing)\r\n */\r\nexport function resetTutorialProgress() {\r\n    saveTutorialProgress({ hintsShown: [] });\r\n}\r\n\r\n/**\r\n * Clear any currently displayed hint\r\n * @param {object} k - KAPLAY instance\r\n */\r\nexport function clearCurrentHint(k) {\r\n    if (currentHint) {\r\n        if (currentHint.bg && currentHint.bg.exists()) k.destroy(currentHint.bg);\r\n        if (currentHint.text && currentHint.text.exists()) k.destroy(currentHint.text);\r\n        currentHint = null;\r\n    }\r\n}\r\n","// Synergy system - handles upgrade combinations and special effects\r\nimport { showSynergyHint } from './tutorial.js';\r\n\r\n// Synergy definitions\r\n// Each synergy requires specific upgrades and applies a special effect\r\nexport const SYNERGIES = {\r\n    // Multi-shot + Spread Shot = Wider spread pattern\r\n    shotgun: {\r\n        name: 'Shotgun Blast',\r\n        description: 'Multi-Shot + Spread Shot: Wider spread angle',\r\n        required: ['multiShot', 'spreadShot'],\r\n        apply: (player) => {\r\n            // Increase spread angle when both upgrades are present\r\n            if (player.spreadAngle > 0 && player.projectileCount > 1) {\r\n                player.spreadAngle = (player.spreadAngle || 0) * 1.5; // 50% wider spread\r\n            }\r\n        }\r\n    },\r\n    \r\n    // Piercing + Multi-shot = Multiple piercing projectiles\r\n    volley: {\r\n        name: 'Piercing Volley',\r\n        description: 'Piercing + Multi-Shot: All projectiles pierce',\r\n        required: ['piercing', 'multiShot'],\r\n        apply: (player) => {\r\n            // Ensure all projectiles from multi-shot have piercing\r\n            // This is already handled by the combat system, but we can add bonus\r\n            if (player.piercing > 0 && player.projectileCount > 1) {\r\n                player.piercing = (player.piercing || 0) + 1; // Bonus piercing\r\n            }\r\n        }\r\n    },\r\n    \r\n    // Crit Chance + Crit Damage = Enhanced critical system\r\n    criticalMaster: {\r\n        name: 'Critical Master',\r\n        description: 'Critical Strike + Critical Power: +25% crit chance, +100% crit damage',\r\n        required: ['critChance', 'critDamage'],\r\n        apply: (player) => {\r\n            if (player.critChance > 0 && player.critDamage > 2.0) {\r\n                player.critChance = (player.critChance || 0) + 0.25; // Bonus crit chance\r\n                player.critDamage = (player.critDamage || 2.0) + 1.0; // Bonus crit damage\r\n            }\r\n        }\r\n    },\r\n    \r\n    // Multi-shot + Fire Rate = Rapid multi-fire\r\n    barrage: {\r\n        name: 'Barrage',\r\n        description: 'Multi-Shot + Fire Rate: Faster multi-projectile firing',\r\n        required: ['multiShot', 'fireRate'],\r\n        apply: (player) => {\r\n            if (player.projectileCount > 1) {\r\n                player.fireRate = (player.fireRate || 1.5) * 1.3; // 30% faster fire rate\r\n            }\r\n        }\r\n    },\r\n    \r\n    // Piercing + Damage = Armor-piercing rounds\r\n    armorPiercing: {\r\n        name: 'Armor Piercing',\r\n        description: 'Piercing + Damage Boost: Piercing projectiles deal +50% damage',\r\n        required: ['piercing', 'damage'],\r\n        apply: (player) => {\r\n            if (player.piercing > 0) {\r\n                // Store bonus damage for piercing projectiles\r\n                player.piercingDamageBonus = 1.5; // 50% bonus\r\n            }\r\n        }\r\n    },\r\n    \r\n    // Defense + Health = Tank build\r\n    tank: {\r\n        name: 'Tank',\r\n        description: 'Armor + Max Health: +50% max health, +5 defense',\r\n        required: ['defense', 'health'],\r\n        apply: (player) => {\r\n            player.maxHealth = Math.floor(player.maxHealth * 1.5); // 50% more health\r\n            player.setHP(Math.floor(player.hp() * 1.5)); // Scale current HP too\r\n            player.defense = (player.defense || 0) + 5; // Bonus defense\r\n        }\r\n    },\r\n    \r\n    // Speed + Pickup Radius = Loot vacuum\r\n    vacuum: {\r\n        name: 'Loot Vacuum',\r\n        description: 'Movement Speed + Pickup Radius: +100% pickup radius',\r\n        required: ['speed', 'pickupRadius'],\r\n        apply: (player) => {\r\n            if (player.pickupRadius > 0) {\r\n                player.pickupRadius = Math.floor(player.pickupRadius * 2.0); // Double radius\r\n            }\r\n        }\r\n    },\r\n    \r\n    // XP Gain + Pickup Radius = XP magnet\r\n    xpMagnet: {\r\n        name: 'XP Magnet',\r\n        description: 'XP Gain + Pickup Radius: +50% XP multiplier',\r\n        required: ['xpGain', 'pickupRadius'],\r\n        apply: (player) => {\r\n            if (player.xpMultiplier) {\r\n                player.xpMultiplier = (player.xpMultiplier || 1) + 0.5; // 50% more XP\r\n            }\r\n        }\r\n    },\r\n\r\n    // NEW SYNERGIES\r\n\r\n    // Glass Canon: Trade health for massive damage\r\n    glassCannon: {\r\n        name: 'Glass Cannon',\r\n        description: 'Damage x3 + Health: -25% max HP, +100% damage',\r\n        required: ['damage', 'damage', 'damage', 'health'], // Requires 3x damage upgrades\r\n        requiredCounts: { damage: 3, health: 1 }, // Alternative counting method\r\n        apply: (player) => {\r\n            // Only apply if player has at least 3 damage upgrades\r\n            const damageStacks = player.upgradeStacks?.damage || 0;\r\n            if (damageStacks >= 3) {\r\n                // Reduce max HP by 25%\r\n                const newMaxHealth = Math.floor(player.maxHealth * 0.75);\r\n                player.maxHealth = newMaxHealth;\r\n\r\n                // Ensure player HP doesn't drop below 25% of new max (safety threshold)\r\n                // This prevents the synergy from leaving the player in a near-death state\r\n                const minSafeHP = Math.max(1, Math.floor(newMaxHealth * 0.25));\r\n                const newHP = Math.max(minSafeHP, Math.min(player.hp(), newMaxHealth));\r\n                player.setHP(newHP);\r\n\r\n                // Double damage (+100%)\r\n                player.projectileDamage = Math.floor(player.projectileDamage * 2);\r\n            }\r\n        }\r\n    },\r\n\r\n    // Vampiric Rounds: Heal on critical hits\r\n    vampiricRounds: {\r\n        name: 'Vampiric Rounds',\r\n        description: 'Crit Chance + Crit Damage + Health: Heal 5% of crit damage',\r\n        required: ['critChance', 'critDamage', 'health'],\r\n        apply: (player) => {\r\n            // Enable vampiric healing on crits\r\n            player.vampiricCrits = true;\r\n            player.vampiricHealPercent = 0.05; // 5% of crit damage healed\r\n        }\r\n    },\r\n\r\n    // Bullet Time: Faster fire rate while moving\r\n    bulletTime: {\r\n        name: 'Bullet Time',\r\n        description: 'Speed + Fire Rate: +20% fire rate while moving',\r\n        required: ['speed', 'fireRate'],\r\n        apply: (player) => {\r\n            // Enable bullet time effect\r\n            player.bulletTimeEnabled = true;\r\n            player.bulletTimeBonus = 0.2; // +20% fire rate while moving\r\n        }\r\n    },\r\n\r\n    // ========================================\r\n    // NEW SYNERGIES\r\n    // ========================================\r\n\r\n    // Berserker: Power boost at low health\r\n    berserker: {\r\n        name: 'Berserker',\r\n        description: 'Damage x3 + Speed x2: +50% damage/speed below 30% HP',\r\n        requiredCounts: { damage: 3, speed: 2 },\r\n        apply: (player) => {\r\n            player.berserkerEnabled = true;\r\n            player.berserkerThreshold = 0.3; // Below 30% HP\r\n            player.berserkerDamageBonus = 0.5; // +50% damage\r\n            player.berserkerSpeedBonus = 0.5; // +50% speed\r\n        }\r\n    },\r\n\r\n    // Deadeye: Extended crit range\r\n    deadeye: {\r\n        name: 'Deadeye',\r\n        description: 'Crit x2 + Range x2: Crits have +50% range',\r\n        requiredCounts: { critChance: 2, range: 2 },\r\n        apply: (player) => {\r\n            player.deadeyeEnabled = true;\r\n            player.deadeyeRangeBonus = 0.5; // +50% range on crits\r\n        }\r\n    },\r\n\r\n    // Survivalist: Out of combat regen\r\n    survivor: {\r\n        name: 'Survivalist',\r\n        description: 'Health x2 + Defense x2: Regen 1% HP/sec out of combat',\r\n        requiredCounts: { health: 2, defense: 2 },\r\n        apply: (player) => {\r\n            player.survivalistEnabled = true;\r\n            player.survivalistRegenPercent = 0.01; // 1% HP per second\r\n            player.survivalistCombatCooldown = 3.0; // 3 seconds out of combat\r\n            player.survivalistLastCombatTime = 0;\r\n        }\r\n    },\r\n\r\n    // Retribution: Thorns ignore armor\r\n    thornMaster: {\r\n        name: 'Retribution',\r\n        description: 'Thorns x3 + Defense x2: Thorns ignore enemy armor',\r\n        requiredCounts: { thorns: 3, defense: 2 },\r\n        apply: (player) => {\r\n            player.thornsIgnoreArmor = true;\r\n            // Also boost thorns damage by 50%\r\n            player.thornsPercent = (player.thornsPercent || 0) * 1.5;\r\n        }\r\n    },\r\n\r\n    // Vampire Lord: Enhanced lifesteal on crits\r\n    vampireLord: {\r\n        name: 'Vampire Lord',\r\n        description: 'Lifesteal x3 + Crit Dmg x2: Crits heal 3x lifesteal',\r\n        requiredCounts: { lifesteal: 3, critDamage: 2 },\r\n        apply: (player) => {\r\n            player.vampireLordEnabled = true;\r\n            player.vampireLordMultiplier = 3; // 3x lifesteal on crits\r\n        }\r\n    },\r\n\r\n    // Executioner: Execute low health enemies\r\n    executioner: {\r\n        name: 'Executioner',\r\n        description: 'Damage x2 + Piercing x2: +100% damage to enemies <25% HP',\r\n        requiredCounts: { damage: 2, piercing: 2 },\r\n        apply: (player) => {\r\n            player.executionerEnabled = true;\r\n            player.executionerThreshold = 0.25; // Below 25% HP\r\n            player.executionerDamageBonus = 1.0; // +100% damage\r\n        }\r\n    },\r\n\r\n    // Speed Demon: Fire rate scales with speed\r\n    speedDemon: {\r\n        name: 'Speed Demon',\r\n        description: 'Speed x3 + Fire Rate x2: +1% fire rate per speed stack',\r\n        requiredCounts: { speed: 3, fireRate: 2 },\r\n        apply: (player) => {\r\n            player.speedDemonEnabled = true;\r\n            player.speedDemonFireRatePerStack = 0.01; // +1% fire rate per speed stack\r\n        }\r\n    },\r\n\r\n    // Fortress: Complete immunity during invulnerability\r\n    fortress: {\r\n        name: 'Fortress',\r\n        description: 'Health x3 + Invuln x2: Immunity blocks all damage sources',\r\n        requiredCounts: { health: 3, invulnTime: 2 },\r\n        apply: (player) => {\r\n            player.fortressEnabled = true;\r\n            // Also extend invulnerability duration by 50%\r\n            player.invulnerableDuration = (player.invulnerableDuration || 1.0) * 1.5;\r\n        }\r\n    }\r\n};\r\n\r\n// Track player's selected upgrades\r\nexport function trackUpgrade(player, upgradeKey) {\r\n    if (!player.selectedUpgrades) {\r\n        player.selectedUpgrades = new Set();\r\n    }\r\n    player.selectedUpgrades.add(upgradeKey);\r\n}\r\n\r\n// Check and apply synergies\r\nexport function checkAndApplySynergies(k, player) {\r\n    if (!player.selectedUpgrades || player.selectedUpgrades.size < 2) {\r\n        return; // Need at least 2 upgrades for synergies\r\n    }\r\n\r\n    const activeSynergies = [];\r\n\r\n    // Check each synergy\r\n    for (const [synergyKey, synergy] of Object.entries(SYNERGIES)) {\r\n        let hasAllRequired = false;\r\n\r\n        // Check if synergy uses requiredCounts (for synergies needing multiple stacks of same upgrade)\r\n        if (synergy.requiredCounts) {\r\n            hasAllRequired = true;\r\n            for (const [upgradeKey, count] of Object.entries(synergy.requiredCounts)) {\r\n                const stacks = player.upgradeStacks?.[upgradeKey] || 0;\r\n                if (stacks < count) {\r\n                    hasAllRequired = false;\r\n                    break;\r\n                }\r\n            }\r\n        } else {\r\n            // Standard check - player has all required upgrades (any count)\r\n            hasAllRequired = synergy.required.every(upgradeKey =>\r\n                player.selectedUpgrades.has(upgradeKey)\r\n            );\r\n        }\r\n\r\n        if (hasAllRequired) {\r\n            // Check if synergy is already active (prevent double application)\r\n            if (!player.activeSynergies) {\r\n                player.activeSynergies = new Set();\r\n            }\r\n\r\n            if (!player.activeSynergies.has(synergyKey)) {\r\n                // Apply synergy effect\r\n                synergy.apply(player);\r\n                player.activeSynergies.add(synergyKey);\r\n                activeSynergies.push(synergy);\r\n\r\n                // Show tutorial hint for synergies\r\n                showSynergyHint(k);\r\n\r\n                // Show synergy notification\r\n                showSynergyNotification(k, synergy);\r\n            }\r\n        }\r\n    }\r\n\r\n    return activeSynergies;\r\n}\r\n\r\n// Show synergy notification\r\nfunction showSynergyNotification(k, synergy) {\r\n    const notification = k.add([\r\n        k.text(`SYNERGY: ${synergy.name}`, { size: 20 }),\r\n        k.pos(k.width() / 2, 150),\r\n        k.anchor('center'),\r\n        k.color(255, 200, 0), // Gold color for synergies\r\n        k.fixed(),\r\n        k.z(600)\r\n    ]);\r\n    \r\n    const desc = k.add([\r\n        k.text(synergy.description, { size: 14 }),\r\n        k.pos(k.width() / 2, 175),\r\n        k.anchor('center'),\r\n        k.color(200, 200, 100),\r\n        k.fixed(),\r\n        k.z(600)\r\n    ]);\r\n    \r\n    // Fade out after 3 seconds\r\n    k.wait(3, () => {\r\n        if (notification.exists()) {\r\n            k.destroy(notification);\r\n            k.destroy(desc);\r\n        }\r\n    });\r\n}\r\n\r\n// Get active synergies for a player\r\nexport function getActiveSynergies(player) {\r\n    if (!player.activeSynergies) {\r\n        return [];\r\n    }\r\n\r\n    return Array.from(player.activeSynergies).map(key => ({\r\n        key,\r\n        ...SYNERGIES[key]\r\n    }));\r\n}\r\n\r\n/**\r\n * Reapply all active synergies silently (for room transitions)\r\n * This should be called AFTER recalculateAllUpgrades() to restore synergy bonuses\r\n * that were overwritten by the upgrade recalculation.\r\n * @param {Object} player - The player entity\r\n */\r\nexport function reapplySynergies(player) {\r\n    if (!player.activeSynergies || player.activeSynergies.size === 0) {\r\n        return;\r\n    }\r\n\r\n    // Reapply each active synergy\r\n    for (const synergyKey of player.activeSynergies) {\r\n        const synergy = SYNERGIES[synergyKey];\r\n        if (synergy && synergy.apply) {\r\n            synergy.apply(player);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","// Upgrade draft UI scene\r\nimport { getRandomUpgrades, applyUpgrade, getUpgradeDescription } from '../systems/upgrades.js';\r\nimport { trackUpgrade, checkAndApplySynergies } from '../systems/synergies.js';\r\nimport { playUpgradeSelect } from '../systems/sounds.js';\r\nimport { isMultiplayerActive, getUpgradeRNG, broadcastUpgradeSelected, broadcastSynergyActivated } from '../systems/multiplayerGame.js';\r\nimport { getPermanentUpgradeLevel } from '../systems/metaProgression.js';\r\nimport {\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS\r\n} from '../config/uiConfig.js';\r\n\r\n// Track if upgrade draft is currently showing\r\nlet upgradeDraftActive = false;\r\n\r\nexport function showUpgradeDraft(k, player, onSelect, playerName = null, levelOverride = null, rerollsAvailable = null) {\r\n    // Don't show if already showing\r\n    if (upgradeDraftActive) return;\r\n\r\n    // Mark upgrade draft as active\r\n    upgradeDraftActive = true;\r\n\r\n    // Pause the game (but not in multiplayer mode)\r\n    const inMultiplayer = isMultiplayerActive();\r\n    if (!inMultiplayer) {\r\n        k.paused = true;\r\n    }\r\n\r\n    // Save tooltip state and hide it (accessed from k.gameData if available)\r\n    if (k.gameData && k.gameData.saveTooltipState && k.gameData.hideTooltip) {\r\n        k.gameData.tooltipSavedState = k.gameData.saveTooltipState();\r\n        k.gameData.hideTooltip();\r\n    }\r\n\r\n    // Save current minimap mode (accessed from k.gameData if available)\r\n    if (k.gameData && k.gameData.minimap) {\r\n        k.gameData.minimapSavedMode = k.gameData.minimap.mode;\r\n        // Set minimap to maximized for better visibility during upgrade selection\r\n        if (k.gameData.minimap.mode !== 'maximized') {\r\n            k.gameData.minimap.mode = 'maximized';\r\n            k.gameData.minimap.update();\r\n        }\r\n    }\r\n\r\n    // Get permanent upgrade levels for Tough Choices and Mulligan\r\n    const toughChoicesLevel = getPermanentUpgradeLevel('toughChoices');\r\n    const mulliganLevel = getPermanentUpgradeLevel('mulligan');\r\n\r\n    // Calculate number of upgrade options (base 3 + toughChoices level)\r\n    const numUpgradeOptions = 3 + toughChoicesLevel;\r\n\r\n    // Track rerolls remaining for this draft\r\n    // Use passed rerollsAvailable if provided (per-run persistence), otherwise fallback to mulliganLevel\r\n    let rerollsRemaining = rerollsAvailable !== null ? rerollsAvailable : mulliganLevel;\r\n    let rerollSeed = 0; // Increment each reroll for different results\r\n\r\n    // Get random upgrades (weapon-aware)\r\n    // In multiplayer, use seeded RNG for deterministic upgrade generation\r\n    // Use levelOverride if provided to ensure different upgrades for sequential level ups\r\n    function generateUpgrades() {\r\n        let upgradeRng = null;\r\n        if (isMultiplayerActive()) {\r\n            const playerIndex = player.playerIndex !== undefined ? player.playerIndex : 0;\r\n            const playerLevel = levelOverride || player.level || 1;\r\n            upgradeRng = getUpgradeRNG(playerIndex, playerLevel + rerollSeed * 100);\r\n        }\r\n        return getRandomUpgrades(numUpgradeOptions, player, upgradeRng);\r\n    }\r\n\r\n    let upgrades = generateUpgrades();\r\n\r\n    // Create overlay background\r\n    const overlay = k.add([\r\n        k.rect(k.width(), k.height()),\r\n        k.pos(0, 0),\r\n        k.anchor('topleft'),\r\n        k.color(...UI_COLORS.BG_DARK),\r\n        k.opacity(0.9),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL),\r\n        'upgradeOverlay'\r\n    ]);\r\n\r\n    // Title - show player name in multiplayer\r\n    const titleText = inMultiplayer && playerName\r\n        ? `${playerName} - Level Up! Choose an Upgrade`\r\n        : 'Level Up! Choose an Upgrade';\r\n    const title = k.add([\r\n        k.text(titleText, { size: UI_TEXT_SIZES.TITLE }),\r\n        k.pos(k.width() / 2, 80),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.WARNING),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 1),\r\n        'upgradeUI'\r\n    ]);\r\n\r\n    // Function to create upgrade cards (called on initial and reroll)\r\n    function createUpgradeCards() {\r\n        // Clear existing cards\r\n        k.get('upgradeCard').forEach(obj => k.destroy(obj));\r\n\r\n        // Dynamic card sizing based on number of options\r\n        const baseCardWidth = 200;\r\n        const baseCardHeight = 150;\r\n        const maxTotalWidth = k.width() - 40; // Leave margins\r\n\r\n        // Calculate card size and spacing based on number of upgrades\r\n        let cardWidth, cardHeight, spacing;\r\n        if (upgrades.length <= 3) {\r\n            cardWidth = baseCardWidth;\r\n            cardHeight = baseCardHeight;\r\n            spacing = 250;\r\n        } else if (upgrades.length <= 5) {\r\n            cardWidth = 160;\r\n            cardHeight = 130;\r\n            spacing = 180;\r\n        } else {\r\n            // For 6+ cards, scale down further\r\n            const availableWidth = maxTotalWidth / upgrades.length;\r\n            cardWidth = Math.min(140, availableWidth - 10);\r\n            cardHeight = 120;\r\n            spacing = cardWidth + 10;\r\n        }\r\n\r\n        const startX = k.width() / 2 - (spacing * (upgrades.length - 1)) / 2;\r\n        const cardY = k.height() / 2;\r\n\r\n        const cards = [];\r\n\r\n        upgrades.forEach((upgrade, index) => {\r\n            const cardX = startX + (index * spacing);\r\n\r\n            // Card background\r\n            const cardBg = k.add([\r\n                k.rect(cardWidth, cardHeight),\r\n                k.pos(cardX, cardY),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.BG_MEDIUM),\r\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 1),\r\n                k.area(),\r\n                'upgradeUI',\r\n                'upgradeCard'\r\n            ]);\r\n\r\n            // Upgrade icon (scale based on card size)\r\n            const iconSize = cardWidth <= 140 ? 32 : 48;\r\n            if (upgrade.icon) {\r\n                const iconColor = upgrade.category === 'passive'\r\n                    ? UI_COLORS.SUCCESS\r\n                    : (upgrade.weaponKey ? UI_COLORS.WARNING : UI_COLORS.INFO);\r\n\r\n                k.add([\r\n                    k.text(upgrade.icon, { size: iconSize }),\r\n                    k.pos(cardX, cardY - cardHeight/3),\r\n                    k.anchor('center'),\r\n                    k.color(...iconColor),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.MODAL + 2),\r\n                    'upgradeUI',\r\n                    'upgradeCard'\r\n                ]);\r\n            }\r\n\r\n            // Upgrade name (scale text size based on card width)\r\n            const nameSize = cardWidth <= 140 ? 12 : UI_TEXT_SIZES.BUTTON;\r\n            k.add([\r\n                k.text(upgrade.name, { size: nameSize, width: cardWidth - 10 }),\r\n                k.pos(cardX, cardY - 5),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 2),\r\n                'upgradeUI',\r\n                'upgradeCard'\r\n            ]);\r\n\r\n            // Upgrade description (scale text size based on card width)\r\n            const descSize = cardWidth <= 140 ? 10 : UI_TEXT_SIZES.BODY;\r\n            const description = getUpgradeDescription(upgrade, player);\r\n            k.add([\r\n                k.text(description, { size: descSize, width: cardWidth - 10 }),\r\n                k.pos(cardX, cardY + 25),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 2),\r\n                'upgradeUI',\r\n                'upgradeCard'\r\n            ]);\r\n\r\n            // Selection number (top-right corner of card)\r\n            const numSize = cardWidth <= 140 ? 14 : UI_TEXT_SIZES.HEADER;\r\n            k.add([\r\n                k.text(`${index + 1}`, { size: numSize }),\r\n                k.pos(cardX + cardWidth / 2 - 15, cardY - cardHeight / 2 + 12),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.WARNING),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 2),\r\n                'upgradeUI',\r\n                'upgradeCard'\r\n            ]);\r\n\r\n            cards.push({\r\n                card: cardBg,\r\n                upgrade: upgrade,\r\n                index: index\r\n            });\r\n\r\n            // Make card clickable\r\n            cardBg.onClick(() => {\r\n                if (!upgradeDraftActive) return;\r\n                selectUpgrade(index);\r\n            });\r\n        });\r\n\r\n        return cards;\r\n    }\r\n\r\n    // Create initial cards\r\n    let cards = createUpgradeCards();\r\n\r\n    // Create reroll button if player has rerolls\r\n    let rerollText = null;\r\n    if (mulliganLevel > 0) {\r\n        const rerollButton = k.add([\r\n            k.rect(120, 35),\r\n            k.pos(k.width() / 2, k.height() - 60),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_MEDIUM),\r\n            k.outline(2, k.rgb(...UI_COLORS.WARNING)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1),\r\n            k.area(),\r\n            'upgradeUI'\r\n        ]);\r\n\r\n        // Using parentheses instead of square brackets to avoid KAPLAY styled text tag parsing\r\n        rerollText = k.add([\r\n            k.text(`(R) Reroll (${rerollsRemaining})`, { size: 14 }),\r\n            k.pos(k.width() / 2, k.height() - 60),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.WARNING),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 2),\r\n            'upgradeUI'\r\n        ]);\r\n\r\n        rerollButton.onClick(() => {\r\n            if (upgradeDraftActive && rerollsRemaining > 0) {\r\n                performReroll();\r\n            }\r\n        });\r\n    }\r\n\r\n    // Reroll function\r\n    function performReroll() {\r\n        if (rerollsRemaining <= 0) return;\r\n\r\n        rerollsRemaining--;\r\n        rerollSeed++;\r\n        upgrades = generateUpgrades();\r\n        cards = createUpgradeCards();\r\n\r\n        // Update reroll button text\r\n        if (rerollText && rerollText.exists()) {\r\n            rerollText.text = `(R) Reroll (${rerollsRemaining})`;\r\n            if (rerollsRemaining === 0) {\r\n                rerollText.color = k.rgb(...UI_COLORS.TEXT_SECONDARY);\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Selection function\r\n    function selectUpgrade(index) {\r\n        if (!upgradeDraftActive) return; // Prevent double-selection\r\n\r\n        const selected = upgrades[index];\r\n\r\n        // Play upgrade selection sound\r\n        playUpgradeSelect();\r\n\r\n        // Mark upgrade draft as inactive first to prevent re-entry\r\n        upgradeDraftActive = false;\r\n\r\n        // Note: Key handlers don't need to be removed - they check upgradeDraftActive flag\r\n        // and will return early if the draft is not active\r\n\r\n        // Apply upgrade\r\n        applyUpgrade(player, selected.key);\r\n\r\n        // Track upgrade for synergies\r\n        trackUpgrade(player, selected.key);\r\n\r\n        // Check and apply synergies\r\n        const activatedSynergies = checkAndApplySynergies(k, player);\r\n\r\n        // Broadcast upgrade selection in multiplayer\r\n        if (isMultiplayerActive() && player.slotIndex !== undefined) {\r\n            broadcastUpgradeSelected(player.slotIndex, selected.key);\r\n\r\n            // Broadcast synergy activation if any synergies were activated\r\n            if (activatedSynergies && activatedSynergies.length > 0) {\r\n                const synergyNames = activatedSynergies.map(s => s.name);\r\n                broadcastSynergyActivated(player.slotIndex, synergyNames);\r\n            }\r\n        }\r\n\r\n        // Remove UI\r\n        k.get('upgradeUI').forEach(obj => k.destroy(obj));\r\n        k.get('upgradeOverlay').forEach(obj => k.destroy(obj));\r\n\r\n        // Restore minimap mode\r\n        if (k.gameData && k.gameData.minimap && k.gameData.minimapSavedMode !== undefined) {\r\n            k.gameData.minimap.mode = k.gameData.minimapSavedMode;\r\n            k.gameData.minimap.update();\r\n            k.gameData.minimapSavedMode = undefined;\r\n        }\r\n\r\n        // Unpause game (unless in multiplayer - game should stay unpaused)\r\n        if (!inMultiplayer) {\r\n            k.paused = false;\r\n        }\r\n\r\n        // Restore tooltip state after unpausing\r\n        if (k.gameData && k.gameData.restoreTooltipState && k.gameData.tooltipSavedState) {\r\n            k.gameData.restoreTooltipState(k.gameData.tooltipSavedState);\r\n            k.gameData.tooltipSavedState = undefined;\r\n        }\r\n        \r\n        // Callback (call after unpausing)\r\n        // Pass remaining rerolls so game state can be updated for per-run persistence\r\n        k.wait(0.1, () => {\r\n            if (onSelect) {\r\n                onSelect(selected, rerollsRemaining);\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Keyboard selection (1-9, 0 for 10)\r\n    k.onKeyPress('1', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 1) selectUpgrade(0);\r\n    });\r\n    k.onKeyPress('2', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 2) selectUpgrade(1);\r\n    });\r\n    k.onKeyPress('3', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 3) selectUpgrade(2);\r\n    });\r\n    k.onKeyPress('4', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 4) selectUpgrade(3);\r\n    });\r\n    k.onKeyPress('5', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 5) selectUpgrade(4);\r\n    });\r\n    k.onKeyPress('6', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 6) selectUpgrade(5);\r\n    });\r\n    k.onKeyPress('7', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 7) selectUpgrade(6);\r\n    });\r\n    k.onKeyPress('8', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 8) selectUpgrade(7);\r\n    });\r\n    k.onKeyPress('9', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 9) selectUpgrade(8);\r\n    });\r\n    k.onKeyPress('0', () => {\r\n        if (upgradeDraftActive && upgrades.length >= 10) selectUpgrade(9);\r\n    });\r\n\r\n    // Reroll key handler\r\n    k.onKeyPress('r', () => {\r\n        if (upgradeDraftActive && rerollsRemaining > 0) {\r\n            performReroll();\r\n        }\r\n    });\r\n}\r\n\r\n// Export function to check if upgrade draft is active (for pause menu)\r\nexport function isUpgradeDraftActive() {\r\n    return upgradeDraftActive;\r\n}\r\n\r\n","/**\r\n * Progression System\r\n *\r\n * Handles player progression mechanics:\r\n * - XP gain and multipliers\r\n * - Level up calculations and scaling\r\n * - Upgrade draft triggering on level up\r\n * - Visual feedback for level ups\r\n * - XP scaling per level\r\n */\r\n\r\n// Scene imports\r\nimport { showUpgradeDraft } from '../scenes/upgradeDraft.js';\r\n\r\n// Configuration imports\r\nimport { PROGRESSION_CONFIG } from '../config/constants.js';\r\n\r\n// Sound system imports\r\nimport { playLevelUp } from './sounds.js';\r\n\r\n// Multiplayer imports\r\nimport { broadcastLevelUpQueued, isHost } from './multiplayerGame.js';\r\n\r\nexport function setupProgressionSystem(k, player, reviveAllPlayersCallback = null, isMultiplayer = false) {\r\n    let levelUpInProgress = false;\r\n\r\n    // Track pending level ups for multiplayer (queue them for after room clear)\r\n    player.pendingLevelUps = player.pendingLevelUps || [];\r\n\r\n    // Add XP to player\r\n    player.addXP = function(amount) {\r\n        if (k.paused || levelUpInProgress) return; // Don't add XP while paused or leveling up\r\n\r\n        // Apply XP multiplier if it exists\r\n        const multiplier = player.xpMultiplier || 1;\r\n        const adjustedAmount = Math.floor(amount * multiplier);\r\n\r\n        player.xp += adjustedAmount;\r\n\r\n        // Check for level up (with safety bounds to prevent infinite loops)\r\n        while (player.xp >= player.xpToNext && !levelUpInProgress && player.xpToNext > 0) {\r\n            levelUpInProgress = true;\r\n            player.xp -= player.xpToNext;\r\n            player.level++;\r\n            const newLevel = player.level;\r\n            // Safety clamp: ensure xpToNext is always at least 1\r\n            player.xpToNext = Math.max(1, Math.floor(player.xpToNext * PROGRESSION_CONFIG.XP_SCALING_FACTOR));\r\n\r\n            // Show level up notification and draft directly\r\n            handleLevelUp(k, player, newLevel);\r\n        }\r\n    };\r\n\r\n    // Handle level up\r\n    function handleLevelUp(k, player, level) {\r\n        // Don't process if already paused (prevents issues)\r\n        if (k.paused && !isMultiplayer) {\r\n            levelUpInProgress = false;\r\n            return;\r\n        }\r\n\r\n        // Play level up sound\r\n        playLevelUp();\r\n\r\n        // Note: Revives now only happen on room completion, not on level up\r\n\r\n        // Show level up notification\r\n        const notification = k.add([\r\n            k.text(`Level ${level}!`, { size: 24 }),\r\n            k.pos(k.width() / 2, PROGRESSION_CONFIG.LEVEL_UP_NOTIFICATION_Y),\r\n            k.anchor('center'),\r\n            k.color(255, 255, 100),\r\n            k.fixed(),\r\n            k.z(1000) // High z-index to show above other UI\r\n        ]);\r\n\r\n        // In multiplayer: queue locally and broadcast to sync with others\r\n        if (isMultiplayer && player.slotIndex !== undefined) {\r\n            // Broadcast to notify everyone\r\n            broadcastLevelUpQueued(player.slotIndex, level);\r\n\r\n            // Both host and client queue locally for their own player\r\n            player.pendingLevelUps.push(level);\r\n        } else {\r\n            // Single player: queue locally\r\n            player.pendingLevelUps.push(level);\r\n        }\r\n\r\n        k.wait(PROGRESSION_CONFIG.LEVEL_UP_NOTIFICATION_DURATION, () => {\r\n            if (notification.exists()) k.destroy(notification);\r\n            levelUpInProgress = false;\r\n        });\r\n    }\r\n\r\n    // Return function to manually trigger upgrade selection\r\n    return {\r\n        processPendingLevelUp: () => {\r\n            if (player.pendingLevelUps.length > 0 && !levelUpInProgress) {\r\n                levelUpInProgress = true;\r\n                const level = player.pendingLevelUps.shift(); // Take first pending level\r\n                const playerName = player.playerName || (player.isRemote ? `Player ${player.slotIndex + 1}` : 'You');\r\n                showUpgradeDraft(k, player, () => {\r\n                    levelUpInProgress = false;\r\n                }, isMultiplayer ? playerName : null, level);\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\n","/**\r\n * Enemy Spawn System\r\n *\r\n * Handles enemy selection and spawning logic:\r\n * - Weighted random selection based on floor\r\n * - Floor-specific enemy pools (5 per floor)\r\n * - Progressive difficulty (enemies get harder each floor)\r\n * - Balanced variety within each floor\r\n * - Mix of different enemy types and behaviors\r\n */\r\n\r\n// Enemy spawn weights by floor\r\n// Each floor has 5 enemy types with different weights\r\nconst ENEMY_SPAWN_WEIGHTS = {\r\n    1: {\r\n        rusher: 25,    // Basic Rusher \r\n        shooter: 20,   // Basic Shooter \r\n        zombie: 20,    // Zombie \r\n        slime: 15,     // Slime \r\n        bat: 20        // Bat \r\n    },\r\n    2: {\r\n        charger: 18,   // Charger \r\n        turret: 12,    // Turret \r\n        heavyTank: 18, // Heavy Tank \r\n        zippy: 18,     // Zippy \r\n        exploder: 20,  // Exploder \r\n        splitter: 14   // Intern  - Splits into 2 smaller copies on death\r\n    },\r\n    3: {\r\n        mage: 15,        // Mage \r\n        shieldBearer: 12, // Shield Bearer \r\n        golem: 12,       // Golem \r\n        wraith: 12,      // Wraith \r\n        spawner: 12,     // Spawner \r\n        buffer: 15,      // Buffer \r\n        orbiter: 7,      // Orbiter  - Walks perimeter, explodes into shrapnel\r\n        phaser: 8,       // Ghost Writer  - Phases through obstacles\r\n        mimic: 7         // Stunt Double @ - Copies player movement\r\n    },\r\n    4: {\r\n        healer: 18,     // Healer \r\n        teleporter: 15, // Teleporter \r\n        freezer: 18,    // Freezer \r\n        leech: 20,      // Leech \r\n        reflector: 14,  // Mirror Master  - Reflects projectiles\r\n        bomber: 15      // Demolitions Expert  - Launches homing bombs\r\n    }\r\n};\r\n\r\n// Get default weights for floors beyond defined\r\nfunction getDefaultWeights() {\r\n    return {\r\n        basic: 15,\r\n        rusher: 25,\r\n        tank: 30,\r\n        fast: 30\r\n    };\r\n}\r\n\r\n// Weighted random selection\r\nfunction weightedRandom(weights, rng = null) {\r\n    const total = Object.values(weights).reduce((sum, weight) => sum + weight, 0);\r\n    // Use seeded RNG if provided (for multiplayer sync), otherwise Math.random\r\n    let random = (rng ? rng.next() : Math.random()) * total;\r\n\r\n    for (const [type, weight] of Object.entries(weights)) {\r\n        random -= weight;\r\n        if (random <= 0) {\r\n            return type;\r\n        }\r\n    }\r\n\r\n    // Fallback (shouldn't happen)\r\n    return Object.keys(weights)[0];\r\n}\r\n\r\n// Get random enemy type for a given floor\r\n// Pass rng parameter for multiplayer to ensure consistent spawns across clients\r\nexport function getRandomEnemyType(floor = 1, rng = null) {\r\n    const weights = ENEMY_SPAWN_WEIGHTS[floor] || getDefaultWeights();\r\n    return weightedRandom(weights, rng);\r\n}\r\n\r\n\r\n","/**\r\n * Elite Enemy System\r\n *\r\n * Handles elite enemy modifiers:\r\n * - Swift: Yellow tint, +50% speed\r\n * - Armored: Blue tint, +100% HP, 25% damage reduction\r\n * - Vampiric: Red tint, heals 10 HP on hitting player\r\n *\r\n * Elite spawn chance: 10-15% on floor 2+\r\n */\r\n\r\n// Elite modifier definitions\r\nexport const ELITE_MODIFIERS = {\r\n    swift: {\r\n        name: 'Swift',\r\n        prefix: '',\r\n        color: [255, 255, 100], // Yellow tint\r\n        apply: (enemy) => {\r\n            enemy.speed = Math.floor(enemy.speed * 1.5); // +50% speed\r\n        }\r\n    },\r\n    armored: {\r\n        name: 'Armored',\r\n        prefix: '',\r\n        color: [100, 150, 255], // Blue tint\r\n        apply: (enemy) => {\r\n            // +100% HP\r\n            enemy.maxHealth = Math.floor(enemy.maxHealth * 2);\r\n            enemy.setHP(enemy.maxHealth);\r\n            // +25% damage reduction\r\n            enemy.damageReduction = (enemy.damageReduction || 0) + 0.25;\r\n        }\r\n    },\r\n    vampiric: {\r\n        name: 'Vampiric',\r\n        prefix: '',\r\n        color: [255, 100, 100], // Red tint\r\n        apply: (enemy) => {\r\n            // Mark as vampiric - heals on hit\r\n            enemy.isVampiric = true;\r\n            enemy.vampiricHealAmount = 10;\r\n        }\r\n    }\r\n};\r\n\r\n// Elite spawn configuration by floor\r\nconst ELITE_CONFIG = {\r\n    2: { spawnChance: 0.10 }, // 10% chance on floor 2\r\n    3: { spawnChance: 0.12 }, // 12% chance on floor 3\r\n    4: { spawnChance: 0.15 }  // 15% chance on floor 4+\r\n};\r\n\r\n/**\r\n * Check if an enemy should be elite based on floor\r\n * @param {number} floor - Current floor number\r\n * @param {object} rng - Optional seeded RNG for multiplayer sync\r\n * @returns {boolean} Whether the enemy should be elite\r\n */\r\nexport function shouldSpawnElite(floor, rng = null) {\r\n    if (floor < 2) return false; // No elites on floor 1\r\n\r\n    const config = ELITE_CONFIG[floor] || ELITE_CONFIG[4]; // Default to floor 4+ config\r\n    const roll = rng ? rng.next() : Math.random();\r\n\r\n    return roll < config.spawnChance;\r\n}\r\n\r\n/**\r\n * Get a random elite modifier\r\n * @param {object} rng - Optional seeded RNG for multiplayer sync\r\n * @returns {string} Elite modifier key\r\n */\r\nexport function getRandomEliteModifier(rng = null) {\r\n    const modifiers = Object.keys(ELITE_MODIFIERS);\r\n    const roll = rng ? rng.next() : Math.random();\r\n    const index = Math.floor(roll * modifiers.length);\r\n\r\n    return modifiers[index];\r\n}\r\n\r\n/**\r\n * Apply elite modifier to an enemy\r\n * @param {object} k - KAPLAY instance\r\n * @param {object} enemy - Enemy entity\r\n * @param {string} modifierKey - Elite modifier key\r\n */\r\nexport function applyEliteModifier(k, enemy, modifierKey) {\r\n    const modifier = ELITE_MODIFIERS[modifierKey];\r\n    if (!modifier) return;\r\n\r\n    // Mark as elite\r\n    enemy.isElite = true;\r\n    enemy.eliteModifier = modifierKey;\r\n\r\n    // Apply stat changes\r\n    modifier.apply(enemy);\r\n\r\n    // Update visual - add prefix and change color\r\n    const newChar = `${modifier.prefix}${enemy.coreChar}`;\r\n    enemy.coreChar = newChar;\r\n    enemy.text = newChar;\r\n\r\n    // Update color\r\n    enemy.originalColor = modifier.color;\r\n    enemy.color = k.rgb(...modifier.color);\r\n\r\n    // Increase XP value for elites (+50%)\r\n    enemy.xpValue = Math.floor(enemy.xpValue * 1.5);\r\n\r\n    // Update visual\r\n    if (enemy.updateVisual) {\r\n        enemy.updateVisual();\r\n    }\r\n}\r\n\r\n/**\r\n * Create an elite enemy (combines shouldSpawnElite check and application)\r\n * @param {object} k - KAPLAY instance\r\n * @param {object} enemy - Enemy entity\r\n * @param {number} floor - Current floor number\r\n * @param {object} rng - Optional seeded RNG for multiplayer sync\r\n * @returns {boolean} Whether the enemy became elite\r\n */\r\nexport function tryMakeElite(k, enemy, floor, rng = null) {\r\n    // Never make bosses elite - they're already powerful enough\r\n    if (enemy.isBoss || enemy.isBossEnemy) {\r\n        return false;\r\n    }\r\n\r\n    if (!shouldSpawnElite(floor, rng)) {\r\n        return false;\r\n    }\r\n\r\n    const modifierKey = getRandomEliteModifier(rng);\r\n    applyEliteModifier(k, enemy, modifierKey);\r\n\r\n    return true;\r\n}\r\n","/**\r\n * Room Generation System\r\n *\r\n * Handles procedural room generation and layout:\r\n * - Room templates with obstacle layouts\r\n * - Weighted random template selection by floor\r\n * - Two obstacle types: walls (block all) and cover (block movement only)\r\n * - Explosive barrel placement for tactical gameplay\r\n * - Floor-based color theming\r\n * - Safe spawn zone enforcement\r\n * - Progressive complexity (more obstacles on higher floors)\r\n * - Obstacle boundary constraints\r\n * - Room-to-room variation\r\n */\r\n\r\n// Room configuration\r\nconst ROOM_WIDTH = 800;\r\nconst ROOM_HEIGHT = 600;\r\nconst ROOM_MARGIN = 20;\r\n\r\n// Track last used template to avoid repetition\r\nlet lastRoomTemplate = null;\r\n\r\n/**\r\n * Room template definitions\r\n * Each template defines:\r\n * - obstacles: Array of {x, y, width, height, type, char}\r\n *   - type: 'wall' (blocks everything) or 'cover' (blocks movement, projectiles pass)\r\n * - barrels: Array of {x, y} positions for explosive barrels\r\n * - spawnDoors: Optional door position overrides\r\n * - name: Template identifier\r\n * - floorAffinity: Array of floor numbers this template favors (optional)\r\n */\r\n\r\nexport const ROOM_TEMPLATES = {\r\n    // === FLOOR 1: Urban Streets - Simple layouts, learning experience ===\r\n    empty: {\r\n        name: 'Empty Room',\r\n        obstacles: [],\r\n        barrels: [],\r\n        spawnDoors: null,\r\n        floorAffinity: [1]\r\n    },\r\n    streetCorners: {\r\n        name: 'Street Corners',\r\n        obstacles: [\r\n            { x: 150, y: 150, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 650, y: 150, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 150, y: 450, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 650, y: 450, width: 50, height: 50, type: 'cover', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 300, y: 200 },\r\n            { x: 500, y: 400 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [1]\r\n    },\r\n    alleyway: {\r\n        name: 'Alleyway',\r\n        obstacles: [\r\n            { x: 200, y: 200, width: 30, height: 200, type: 'wall', char: '' },\r\n            { x: 600, y: 200, width: 30, height: 200, type: 'wall', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 250, y: 250 },\r\n            { x: 550, y: 350 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [1]\r\n    },\r\n\r\n    // === FLOOR 2: Industrial Complex - More cover, hazards ===\r\n    factoryFloor: {\r\n        name: 'Factory Floor',\r\n        obstacles: [\r\n            { x: 200, y: 180, width: 80, height: 40, type: 'wall', char: '' },\r\n            { x: 600, y: 180, width: 80, height: 40, type: 'wall', char: '' },\r\n            { x: 200, y: 420, width: 80, height: 40, type: 'wall', char: '' },\r\n            { x: 600, y: 420, width: 80, height: 40, type: 'wall', char: '' },\r\n            { x: 400, y: 300, width: 60, height: 60, type: 'wall', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 150, y: 300 },\r\n            { x: 650, y: 300 },\r\n            { x: 400, y: 200 },\r\n            { x: 400, y: 400 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [2]\r\n    },\r\n    assemblyLine: {\r\n        name: 'Assembly Line',\r\n        obstacles: [\r\n            { x: 250, y: 250, width: 300, height: 25, type: 'wall', char: '' },\r\n            { x: 250, y: 350, width: 300, height: 25, type: 'wall', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 150, y: 300 },\r\n            { x: 650, y: 300 },\r\n            { x: 400, y: 150 },\r\n            { x: 400, y: 450 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [2]\r\n    },\r\n    storageYard: {\r\n        name: 'Storage Yard',\r\n        obstacles: [\r\n            { x: 180, y: 180, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 620, y: 180, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 180, y: 420, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 620, y: 420, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 320, y: 300, width: 40, height: 40, type: 'cover', char: '' },\r\n            { x: 480, y: 300, width: 40, height: 40, type: 'cover', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 250, y: 250 },\r\n            { x: 550, y: 250 },\r\n            { x: 250, y: 350 },\r\n            { x: 550, y: 350 },\r\n            { x: 400, y: 200 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [2]\r\n    },\r\n\r\n    // === FLOOR 3: Cyber Station - Tech layouts, precision required ===\r\n    serverRoom: {\r\n        name: 'Server Room',\r\n        obstacles: [\r\n            { x: 200, y: 150, width: 30, height: 300, type: 'wall', char: '' },\r\n            { x: 350, y: 150, width: 30, height: 300, type: 'wall', char: '' },\r\n            { x: 500, y: 150, width: 30, height: 300, type: 'wall', char: '' },\r\n            { x: 650, y: 150, width: 30, height: 300, type: 'wall', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 275, y: 200 },\r\n            { x: 425, y: 400 },\r\n            { x: 575, y: 250 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [3]\r\n    },\r\n    controlCenter: {\r\n        name: 'Control Center',\r\n        obstacles: [\r\n            { x: 400, y: 200, width: 120, height: 80, type: 'wall', char: '' },\r\n            { x: 200, y: 350, width: 60, height: 60, type: 'cover', char: '' },\r\n            { x: 600, y: 350, width: 60, height: 60, type: 'cover', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 300, y: 200 },\r\n            { x: 500, y: 200 },\r\n            { x: 400, y: 450 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [3]\r\n    },\r\n    dataVault: {\r\n        name: 'Data Vault',\r\n        obstacles: [\r\n            { x: 250, y: 200, width: 40, height: 40, type: 'wall', char: '' },\r\n            { x: 550, y: 200, width: 40, height: 40, type: 'wall', char: '' },\r\n            { x: 250, y: 400, width: 40, height: 40, type: 'wall', char: '' },\r\n            { x: 550, y: 400, width: 40, height: 40, type: 'wall', char: '' },\r\n            { x: 400, y: 300, width: 100, height: 100, type: 'wall', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 180, y: 300 },\r\n            { x: 620, y: 300 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [3]\r\n    },\r\n\r\n    // === FLOOR 4: Alien Vessel - Organic, unpredictable ===\r\n    hiveCluster: {\r\n        name: 'Hive Cluster',\r\n        obstacles: [\r\n            { x: 300, y: 180, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 500, y: 180, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 200, y: 300, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 600, y: 300, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 300, y: 420, width: 50, height: 50, type: 'cover', char: '' },\r\n            { x: 500, y: 420, width: 50, height: 50, type: 'cover', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 400, y: 180 },\r\n            { x: 400, y: 420 },\r\n            { x: 250, y: 300 },\r\n            { x: 550, y: 300 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [4]\r\n    },\r\n    bioLab: {\r\n        name: 'Bio Lab',\r\n        obstacles: [\r\n            { x: 300, y: 250, width: 200, height: 30, type: 'wall', char: '' },\r\n            { x: 300, y: 350, width: 200, height: 30, type: 'wall', char: '' },\r\n            { x: 400, y: 300, width: 30, height: 130, type: 'wall', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 200, y: 200 },\r\n            { x: 600, y: 200 },\r\n            { x: 200, y: 400 },\r\n            { x: 600, y: 400 },\r\n            { x: 400, y: 150 },\r\n            { x: 400, y: 450 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [4]\r\n    },\r\n    xenoNest: {\r\n        name: 'Xeno Nest',\r\n        obstacles: [\r\n            { x: 400, y: 300, width: 80, height: 80, type: 'wall', char: '' },\r\n            { x: 250, y: 200, width: 35, height: 35, type: 'cover', char: '' },\r\n            { x: 550, y: 200, width: 35, height: 35, type: 'cover', char: '' },\r\n            { x: 250, y: 400, width: 35, height: 35, type: 'cover', char: '' },\r\n            { x: 550, y: 400, width: 35, height: 35, type: 'cover', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 180, y: 150 },\r\n            { x: 620, y: 150 },\r\n            { x: 180, y: 450 },\r\n            { x: 620, y: 450 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: [4]\r\n    },\r\n\r\n    // === Universal templates (work on any floor) ===\r\n    centerPillar: {\r\n        name: 'Center Pillar',\r\n        obstacles: [\r\n            { x: 400, y: 200, width: 60, height: 60, type: 'wall', char: '#' },\r\n            { x: 400, y: 400, width: 60, height: 60, type: 'wall', char: '#' }\r\n        ],\r\n        barrels: [\r\n            { x: 250, y: 300 },\r\n            { x: 550, y: 300 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: null // Works on all floors\r\n    },\r\n    corners: {\r\n        name: 'Corner Cover',\r\n        obstacles: [\r\n            { x: 150, y: 150, width: 40, height: 40, type: 'cover', char: '' },\r\n            { x: 650, y: 150, width: 40, height: 40, type: 'cover', char: '' },\r\n            { x: 150, y: 450, width: 40, height: 40, type: 'cover', char: '' },\r\n            { x: 650, y: 450, width: 40, height: 40, type: 'cover', char: '' }\r\n        ],\r\n        barrels: [\r\n            { x: 400, y: 200 },\r\n            { x: 400, y: 400 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: null\r\n    },\r\n    hallway: {\r\n        name: 'Hallway',\r\n        obstacles: [\r\n            { x: 200, y: 250, width: 400, height: 20, type: 'wall', char: '#' },\r\n            { x: 200, y: 330, width: 400, height: 20, type: 'wall', char: '#' }\r\n        ],\r\n        barrels: [\r\n            { x: 150, y: 290 },\r\n            { x: 650, y: 290 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: null\r\n    },\r\n    cross: {\r\n        name: 'Cross Pattern',\r\n        obstacles: [\r\n            { x: 350, y: 200, width: 100, height: 20, type: 'wall', char: '#' },\r\n            { x: 390, y: 200, width: 20, height: 200, type: 'wall', char: '#' }\r\n        ],\r\n        barrels: [\r\n            { x: 250, y: 200 },\r\n            { x: 550, y: 200 },\r\n            { x: 250, y: 400 },\r\n            { x: 550, y: 400 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: null\r\n    },\r\n    barrelRoom: {\r\n        name: 'Barrel Room',\r\n        obstacles: [\r\n            { x: 400, y: 300, width: 50, height: 50, type: 'cover', char: '' }\r\n        ],\r\n        barrels: [\r\n            // Strategic barrel cluster - chain reaction opportunity!\r\n            { x: 250, y: 200 },\r\n            { x: 300, y: 200 },\r\n            { x: 275, y: 250 },\r\n            { x: 500, y: 400 },\r\n            { x: 550, y: 400 },\r\n            { x: 525, y: 350 },\r\n            // Corner barrels\r\n            { x: 150, y: 150 },\r\n            { x: 650, y: 450 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: null\r\n    },\r\n    scattered: {\r\n        name: 'Scattered Obstacles',\r\n        obstacles: [\r\n            { x: 250, y: 200, width: 30, height: 30, type: 'cover', char: '' },\r\n            { x: 550, y: 250, width: 30, height: 30, type: 'cover', char: '' },\r\n            { x: 350, y: 400, width: 50, height: 30, type: 'wall', char: '#' },\r\n            { x: 150, y: 350, width: 30, height: 50, type: 'wall', char: '#' }\r\n        ],\r\n        barrels: [\r\n            { x: 450, y: 200 },\r\n            { x: 250, y: 400 },\r\n            { x: 600, y: 350 }\r\n        ],\r\n        spawnDoors: null,\r\n        floorAffinity: null\r\n    }\r\n};\r\n\r\n/**\r\n * Constrain obstacle position to stay within room boundaries\r\n * @param {number} x - Obstacle center x position\r\n * @param {number} y - Obstacle center y position\r\n * @param {number} width - Obstacle width\r\n * @param {number} height - Obstacle height\r\n * @returns {object} - Clamped {x, y} position\r\n */\r\nexport function constrainObstacleToRoom(x, y, width, height) {\r\n    const halfWidth = width / 2;\r\n    const halfHeight = height / 2;\r\n\r\n    // Calculate boundaries (accounting for obstacle size)\r\n    const minX = ROOM_MARGIN + halfWidth;\r\n    const maxX = ROOM_WIDTH - ROOM_MARGIN - halfWidth;\r\n    const minY = ROOM_MARGIN + halfHeight;\r\n    const maxY = ROOM_HEIGHT - ROOM_MARGIN - halfHeight;\r\n\r\n    // Clamp position\r\n    const clampedX = Math.max(minX, Math.min(maxX, x));\r\n    const clampedY = Math.max(minY, Math.min(maxY, y));\r\n\r\n    return { x: clampedX, y: clampedY };\r\n}\r\n\r\n// Get color scheme for floor (visual progression)\r\n// Each floor has a distinct color palette matching its theme\r\nexport function getFloorColors(k, floor) {\r\n    // Floor-specific color palettes matching floorTheming.js\r\n    const floorPalettes = {\r\n        1: { // Urban Streets - cool gray asphalt tones\r\n            wall: [55, 55, 65],\r\n            obstacle: [70, 70, 80],\r\n            cover: [85, 85, 95]\r\n        },\r\n        2: { // Industrial Complex - rusty brown-orange tones\r\n            wall: [75, 60, 50],\r\n            obstacle: [90, 70, 55],\r\n            cover: [100, 80, 65]\r\n        },\r\n        3: { // Cyber Station - cool blue steel tones\r\n            wall: [45, 55, 75],\r\n            obstacle: [55, 70, 95],\r\n            cover: [65, 85, 115]\r\n        },\r\n        4: { // Alien Vessel - deep purple organic tones\r\n            wall: [60, 45, 70],\r\n            obstacle: [75, 55, 85],\r\n            cover: [90, 65, 100]\r\n        },\r\n        5: { // The Void - eldritch purple-black tones\r\n            wall: [35, 30, 45],\r\n            obstacle: [45, 38, 55],\r\n            cover: [55, 45, 65]\r\n        }\r\n    };\r\n\r\n    // Get palette for current floor (default to void for floor 5+)\r\n    const palette = floorPalettes[Math.min(floor, 5)] || floorPalettes[5];\r\n\r\n    return {\r\n        wallColor: k.rgb(...palette.wall),\r\n        obstacleColor: k.rgb(...palette.obstacle),\r\n        coverColor: k.rgb(...palette.cover)\r\n    };\r\n}\r\n\r\n// Get random room template\r\nexport function getRandomRoomTemplate(rng = null) {\r\n    const templates = Object.keys(ROOM_TEMPLATES);\r\n    const randomIndex = rng\r\n        ? rng.range(0, templates.length)\r\n        : Math.floor(Math.random() * templates.length);\r\n    const randomKey = templates[randomIndex];\r\n    return {\r\n        key: randomKey,\r\n        ...ROOM_TEMPLATES[randomKey]\r\n    };\r\n}\r\n\r\n// Get weighted random room template (favors floor-specific templates)\r\n// Avoids repeating the same template consecutively\r\n// @param {number} floor - Floor number (for difficulty scaling and template selection)\r\n// @param {SeededRandom} rng - Optional seeded RNG for multiplayer synchronization\r\nexport function getWeightedRoomTemplate(floor, rng = null) {\r\n    const allTemplates = Object.keys(ROOM_TEMPLATES);\r\n\r\n    // Filter out the last template to avoid repetition\r\n    const availableTemplates = lastRoomTemplate\r\n        ? allTemplates.filter(key => key !== lastRoomTemplate)\r\n        : allTemplates;\r\n\r\n    // Separate floor-specific and universal templates\r\n    const floorSpecific = [];\r\n    const universal = [];\r\n\r\n    availableTemplates.forEach(key => {\r\n        const template = ROOM_TEMPLATES[key];\r\n        if (template.floorAffinity === null) {\r\n            universal.push(key);\r\n        } else if (template.floorAffinity.includes(floor)) {\r\n            floorSpecific.push(key);\r\n        }\r\n    });\r\n\r\n    // 70% chance to use floor-specific template if available\r\n    const useFloorSpecific = floorSpecific.length > 0 &&\r\n        ((rng ? rng.next() : Math.random()) < 0.7);\r\n\r\n    const templatePool = useFloorSpecific ? floorSpecific :\r\n        (universal.length > 0 ? universal : availableTemplates);\r\n\r\n    // If somehow we filtered everything (shouldn't happen), use all templates\r\n    const finalPool = templatePool.length > 0 ? templatePool : allTemplates;\r\n\r\n    // Select random template from pool\r\n    const randomIndex = rng\r\n        ? rng.range(0, finalPool.length)\r\n        : Math.floor(Math.random() * finalPool.length);\r\n    const randomKey = finalPool[randomIndex];\r\n\r\n    // Update last template tracker\r\n    lastRoomTemplate = randomKey;\r\n\r\n    return {\r\n        key: randomKey,\r\n        ...ROOM_TEMPLATES[randomKey]\r\n    };\r\n}\r\n\r\n/**\r\n * Get barrel spawn positions for a room template\r\n * @param {string} templateKey - Template key\r\n * @param {SeededRandom} rng - Optional seeded RNG\r\n * @param {number} floor - Floor number (affects barrel count)\r\n * @returns {Array} - Array of {x, y} barrel positions\r\n */\r\nexport function getBarrelPositions(templateKey, rng = null, floor = 1) {\r\n    const template = ROOM_TEMPLATES[templateKey];\r\n    if (!template || !template.barrels || template.barrels.length === 0) {\r\n        return [];\r\n    }\r\n\r\n    // Base barrel positions from template\r\n    let positions = [...template.barrels];\r\n\r\n    // On higher floors, potentially add extra barrels\r\n    if (floor >= 2) {\r\n        const extraChance = rng ? rng.next() : Math.random();\r\n        if (extraChance < 0.3 + (floor * 0.1)) {\r\n            // Add a random extra barrel\r\n            const extraX = 100 + (rng ? rng.next() : Math.random()) * 600;\r\n            const extraY = 100 + (rng ? rng.next() : Math.random()) * 400;\r\n            positions.push({ x: extraX, y: extraY });\r\n        }\r\n    }\r\n\r\n    // On floor 1, reduce barrels to help new players\r\n    if (floor === 1) {\r\n        const reduceChance = rng ? rng.next() : Math.random();\r\n        if (reduceChance < 0.5 && positions.length > 1) {\r\n            positions = positions.slice(0, Math.ceil(positions.length / 2));\r\n        }\r\n    }\r\n\r\n    return positions;\r\n}\r\n\r\n// Reset room template history (call when starting new run)\r\nexport function resetRoomTemplateHistory() {\r\n    lastRoomTemplate = null;\r\n}\r\n\r\n// Get room template by specific key (for multiplayer sync)\r\nexport function getRoomTemplateByKey(key) {\r\n    if (!ROOM_TEMPLATES[key]) {\r\n        console.warn(`Unknown room template key: ${key}, falling back to empty`);\r\n        return {\r\n            key: 'empty',\r\n            ...ROOM_TEMPLATES.empty\r\n        };\r\n    }\r\n\r\n    // Update last template tracker for consistency\r\n    lastRoomTemplate = key;\r\n\r\n    return {\r\n        key: key,\r\n        ...ROOM_TEMPLATES[key]\r\n    };\r\n}\r\n\r\n","// Achievement checking system - checks and unlocks achievements based on stats\r\n\r\nimport { getSaveStats, unlockAchievement, isAchievementUnlocked, getUnlockedAchievements, getSaveData } from './metaProgression.js';\r\nimport { ACHIEVEMENTS } from '../data/achievements.js';\r\nimport { playAchievement } from './sounds.js';\r\nimport { showAchievementToast, initToastSystem } from './toastNotifications.js';\r\nimport { CHARACTER_UNLOCKS, PERMANENT_UPGRADE_UNLOCKS } from '../data/unlocks.js';\r\nimport { isMultiplayerActive, getLocalPlayerSlot, broadcastAchievementUnlocked } from './multiplayerGame.js';\r\n\r\n// Track achievements unlocked during the current run\r\nlet runUnlockedAchievements = [];\r\n\r\n// Track run-specific data for challenge achievements\r\nlet runChallengeData = {\r\n    floorDamageTaken: {},    // Tracks damage taken per floor\r\n    runStartTime: 0,         // When the run started\r\n    bossesKilledThisRun: 0,  // Bosses killed in current run\r\n    currentBossNoDamage: true, // Did we take damage during current boss fight\r\n    bossStartHP: 0           // HP at start of boss fight\r\n};\r\n\r\n// Store kaplay instance for showing toasts from event functions\r\nlet kInstance = null;\r\n\r\n/**\r\n * Helper function to unlock an achievement and show toast immediately\r\n * @param {string} achievementId - Achievement ID to unlock\r\n * @returns {boolean} True if newly unlocked\r\n */\r\nfunction unlockAndNotify(achievementId) {\r\n    if (isAchievementUnlocked(achievementId)) return false;\r\n\r\n    if (unlockAchievement(achievementId)) {\r\n        runUnlockedAchievements.push(achievementId);\r\n\r\n        // Show toast immediately if we have a kaplay instance\r\n        if (kInstance) {\r\n            const achievement = ACHIEVEMENTS[achievementId];\r\n            if (achievement) {\r\n                playAchievement();\r\n                showAchievementToast(achievement);\r\n\r\n                // Broadcast in multiplayer\r\n                if (isMultiplayerActive()) {\r\n                    broadcastAchievementUnlocked(achievementId, getLocalPlayerSlot());\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Initialize achievement checker for a new run\r\n * @param {Object} k - Kaplay instance for toast notifications\r\n */\r\nexport function initAchievementChecker(k) {\r\n    runUnlockedAchievements = [];\r\n    runChallengeData = {\r\n        floorDamageTaken: {},\r\n        runStartTime: Date.now(),\r\n        bossesKilledThisRun: 0,\r\n        currentBossNoDamage: true,\r\n        bossStartHP: 0\r\n    };\r\n\r\n    // Store kaplay instance for showing toasts from event functions\r\n    kInstance = k;\r\n\r\n    // Initialize toast system\r\n    if (k) {\r\n        initToastSystem(k);\r\n    }\r\n}\r\n\r\n/**\r\n * Get achievements unlocked during the current run\r\n * @returns {Array} Array of achievement IDs unlocked this run\r\n */\r\nexport function getRunUnlockedAchievements() {\r\n    return [...runUnlockedAchievements];\r\n}\r\n\r\n/**\r\n * Clear run-unlocked achievements (call when starting new run)\r\n */\r\nexport function clearRunUnlockedAchievements() {\r\n    runUnlockedAchievements = [];\r\n}\r\n\r\n/**\r\n * Track damage taken on a floor (for perfectFloor achievement)\r\n * @param {number} floor - Current floor number\r\n * @param {number} damage - Damage taken\r\n */\r\nexport function trackFloorDamage(floor, damage) {\r\n    if (!runChallengeData.floorDamageTaken[floor]) {\r\n        runChallengeData.floorDamageTaken[floor] = 0;\r\n    }\r\n    runChallengeData.floorDamageTaken[floor] += damage;\r\n}\r\n\r\n/**\r\n * Check if a floor was completed without taking damage\r\n * @param {number} floor - Floor number that was completed\r\n * @returns {boolean} True if no damage was taken\r\n */\r\nexport function wasFloorPerfect(floor) {\r\n    return !runChallengeData.floorDamageTaken[floor] || runChallengeData.floorDamageTaken[floor] === 0;\r\n}\r\n\r\n/**\r\n * Start tracking a boss fight (for noHitBoss achievement)\r\n * @param {number} playerHP - Player's HP at boss fight start\r\n */\r\nexport function startBossFight(playerHP) {\r\n    runChallengeData.currentBossNoDamage = true;\r\n    runChallengeData.bossStartHP = playerHP;\r\n}\r\n\r\n/**\r\n * Track damage during boss fight\r\n */\r\nexport function trackBossDamage() {\r\n    runChallengeData.currentBossNoDamage = false;\r\n}\r\n\r\n/**\r\n * Called when a boss is defeated\r\n * @param {number} playerCurrentHP - Player's current HP when boss died\r\n * @param {number} playerMaxHP - Player's max HP\r\n */\r\nexport function onBossDefeated(playerCurrentHP, playerMaxHP) {\r\n    runChallengeData.bossesKilledThisRun++;\r\n\r\n    // Check noHitBoss achievement\r\n    if (runChallengeData.currentBossNoDamage) {\r\n        unlockAndNotify('noHitBoss');\r\n    }\r\n\r\n    // Check glassCannonWin achievement (below 25% HP)\r\n    const hpPercent = playerCurrentHP / playerMaxHP;\r\n    if (hpPercent < 0.25) {\r\n        unlockAndNotify('glassCannonWin');\r\n    }\r\n\r\n    // Check bossRush achievement (3 bosses in one run)\r\n    if (runChallengeData.bossesKilledThisRun >= 3) {\r\n        unlockAndNotify('bossRush');\r\n    }\r\n\r\n    // Reset boss tracking for next boss\r\n    runChallengeData.currentBossNoDamage = true;\r\n    runChallengeData.bossStartHP = playerCurrentHP;\r\n}\r\n\r\n/**\r\n * Called when a floor is completed\r\n * @param {number} floor - Floor that was completed\r\n */\r\nexport function onFloorCompleted(floor) {\r\n    // Check perfectFloor achievement\r\n    if (wasFloorPerfect(floor)) {\r\n        unlockAndNotify('perfectFloor');\r\n    }\r\n\r\n    // Check speedRunner achievement (Floor 3 in under 5 minutes)\r\n    if (floor >= 3) {\r\n        const runDuration = (Date.now() - runChallengeData.runStartTime) / 1000;\r\n        if (runDuration < 300) { // 5 minutes = 300 seconds\r\n            unlockAndNotify('speedRunner');\r\n        }\r\n    }\r\n\r\n    // Initialize damage tracking for next floor\r\n    runChallengeData.floorDamageTaken[floor + 1] = 0;\r\n}\r\n\r\n/**\r\n * Called when a synergy is activated (for firstSynergy achievement)\r\n */\r\nexport function onSynergyActivated() {\r\n    unlockAndNotify('firstSynergy');\r\n}\r\n\r\n/**\r\n * Check if all characters are unlocked (for allCharacters achievement)\r\n */\r\nexport function checkAllCharactersUnlocked() {\r\n    const saveData = getSaveData();\r\n    const unlockedCharacters = saveData.unlocks?.characters || ['survivor'];\r\n    const totalCharacters = Object.keys(CHARACTER_UNLOCKS).length;\r\n\r\n    if (unlockedCharacters.length >= totalCharacters) {\r\n        unlockAndNotify('allCharacters');\r\n    }\r\n}\r\n\r\n/**\r\n * Check if any permanent upgrade is maxed (for maxUpgrade achievement)\r\n */\r\nexport function checkMaxUpgrade() {\r\n    const saveData = getSaveData();\r\n    const upgradeLevels = saveData.permanentUpgradeLevels || {};\r\n\r\n    for (const [key, upgrade] of Object.entries(PERMANENT_UPGRADE_UNLOCKS)) {\r\n        const currentLevel = upgradeLevels[key] || 0;\r\n        const maxLevel = upgrade.maxLevel || 1;\r\n\r\n        if (currentLevel >= maxLevel) {\r\n            unlockAndNotify('maxUpgrade');\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n// Check all achievements based on current stats\r\n// Can be called during gameplay or at game over\r\n// @param {Object} k - Kaplay instance (optional, uses stored instance if not provided)\r\n// @param {Object} currentRunStats - Optional current run stats to augment saved stats\r\n//   { floor, enemiesKilled, bossesKilled, level, currencyEarned }\r\nexport function checkAchievements(k, currentRunStats = null) {\r\n    // Update kInstance if provided (for showing toasts)\r\n    if (k) {\r\n        kInstance = k;\r\n        initToastSystem(k);\r\n    }\r\n\r\n    const savedStats = getSaveStats();\r\n\r\n    // Merge saved stats with current run stats if provided\r\n    const stats = {\r\n        bestFloor: Math.max(savedStats.bestFloor || 0, currentRunStats?.floor || 0),\r\n        totalEnemiesKilled: (savedStats.totalEnemiesKilled || 0) + (currentRunStats?.enemiesKilled || 0),\r\n        totalBossesKilled: (savedStats.totalBossesKilled || 0) + (currentRunStats?.bossesKilled || 0),\r\n        totalRuns: savedStats.totalRuns || 0,\r\n        bestLevel: Math.max(savedStats.bestLevel || 0, currentRunStats?.level || 0),\r\n        totalCurrencyEarned: (savedStats.totalCurrencyEarned || 0) + (currentRunStats?.currencyEarned || 0)\r\n    };\r\n\r\n    const newlyUnlocked = [];\r\n\r\n    // Helper to check and unlock with notification\r\n    const check = (condition, achievementId) => {\r\n        if (condition && unlockAndNotify(achievementId)) {\r\n            newlyUnlocked.push(achievementId);\r\n        }\r\n    };\r\n\r\n    // Floor progression achievements\r\n    check(stats.bestFloor >= 2, 'floor2');\r\n    check(stats.bestFloor >= 3, 'floor3');\r\n    check(stats.bestFloor >= 5, 'floor5');\r\n    check(stats.bestFloor >= 10, 'floor10');\r\n    check(stats.bestFloor >= 15, 'floor15');\r\n    check(stats.bestFloor >= 20, 'floor20');\r\n\r\n    // Combat achievements\r\n    check(stats.totalEnemiesKilled >= 1, 'firstKill');\r\n    check(stats.totalEnemiesKilled >= 100, 'kill100');\r\n    check(stats.totalEnemiesKilled >= 500, 'kill500');\r\n    check(stats.totalEnemiesKilled >= 1000, 'kill1000');\r\n    check(stats.totalEnemiesKilled >= 5000, 'kill5000');\r\n    check(stats.totalEnemiesKilled >= 10000, 'kill10000');\r\n\r\n    // Boss achievements\r\n    check(stats.totalBossesKilled >= 1, 'firstBoss');\r\n    check(stats.totalBossesKilled >= 5, 'boss5');\r\n    check(stats.totalBossesKilled >= 10, 'boss10');\r\n    check(stats.totalBossesKilled >= 25, 'boss25');\r\n    check(stats.totalBossesKilled >= 50, 'boss50');\r\n\r\n    // Run achievements\r\n    check(stats.totalRuns >= 1, 'firstRun');\r\n    check(stats.totalRuns >= 10, 'run10');\r\n    check(stats.totalRuns >= 50, 'run50');\r\n    check(stats.totalRuns >= 100, 'run100');\r\n\r\n    // Upgrade achievements (best level in a run)\r\n    check(stats.bestLevel >= 10, 'level10');\r\n    check(stats.bestLevel >= 20, 'level20');\r\n    check(stats.bestLevel >= 30, 'level30');\r\n    check(stats.bestLevel >= 50, 'level50');\r\n\r\n    // Currency achievements\r\n    check(stats.totalCurrencyEarned >= 100, 'earn100');\r\n    check(stats.totalCurrencyEarned >= 500, 'earn500');\r\n    check(stats.totalCurrencyEarned >= 1000, 'earn1000');\r\n    check(stats.totalCurrencyEarned >= 5000, 'earn5000');\r\n    check(stats.totalCurrencyEarned >= 10000, 'earn10000');\r\n\r\n    return newlyUnlocked;\r\n}\r\n\r\n/**\r\n * Get all achievement info with unlock status for display\r\n * @returns {Array} Array of achievement objects with unlocked status\r\n */\r\nexport function getAllAchievementsWithStatus() {\r\n    const unlockedIds = getUnlockedAchievements();\r\n\r\n    return Object.values(ACHIEVEMENTS).map(achievement => ({\r\n        ...achievement,\r\n        isUnlocked: unlockedIds.includes(achievement.id)\r\n    }));\r\n}\r\n","/**\r\n * Floor Map System - Smash TV Style Room Grid\r\n *\r\n * Generates a grid-based floor layout with:\r\n * - Start room on the left\r\n * - Boss room on the right\r\n * - Procedurally connected rooms in between\r\n * - Guaranteed path from start to boss\r\n * - No backtracking (can only go right, up, down)\r\n */\r\n\r\nimport { getWeightedRoomTemplate } from './roomGeneration.js';\r\nimport { getRandomEnemyType } from './enemySpawn.js';\r\n\r\n/**\r\n * Room node in the grid\r\n */\r\nclass RoomNode {\r\n    constructor(x, y, type = 'combat') {\r\n        this.position = { x, y };\r\n        this.type = type; // 'start', 'combat', 'boss'\r\n        this.template = null; // Room template (assigned later)\r\n        this.connections = {\r\n            up: false,\r\n            down: false,\r\n            right: false\r\n            // Note: No 'left' - backtracking not allowed\r\n        };\r\n        this.visited = false;\r\n        this.cleared = false;\r\n        this.enemyTypes = [];\r\n        this.isBossRoom = type === 'boss';\r\n    }\r\n\r\n    /**\r\n     * Get position key for this room\r\n     */\r\n    getKey() {\r\n        return `${this.position.x},${this.position.y}`;\r\n    }\r\n\r\n    /**\r\n     * Get adjacent position for a given direction\r\n     */\r\n    getAdjacentPosition(direction) {\r\n        const { x, y } = this.position;\r\n        switch (direction) {\r\n            case 'up': return { x, y: y - 1 };\r\n            case 'down': return { x, y: y + 1 };\r\n            case 'right': return { x: x + 1, y };\r\n            default: return null;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Floor Map - manages the entire grid of rooms for a floor\r\n */\r\nexport class FloorMap {\r\n    constructor(floor, width = 6, height = 3, rng = null) {\r\n        this.floor = floor;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.grid = []; // 2D array of RoomNodes (or null)\r\n        this.rooms = new Map(); // Map of \"x,y\" -> RoomNode\r\n        this.startPosition = null;\r\n        this.bossPosition = null;\r\n        this.currentPosition = null;\r\n        this.visitedRooms = new Set();\r\n        this.rng = rng; // Seeded RNG for multiplayer synchronization\r\n\r\n        this.generate();\r\n    }\r\n\r\n    /**\r\n     * Get a random number (0-1) using seeded RNG if available, otherwise Math.random\r\n     * @returns {number} Random number between 0 and 1\r\n     */\r\n    random() {\r\n        return this.rng ? this.rng.next() : Math.random();\r\n    }\r\n\r\n    /**\r\n     * Get a random integer in range [min, max)\r\n     * @param {number} min - Minimum value (inclusive)\r\n     * @param {number} max - Maximum value (exclusive)\r\n     * @returns {number} Random integer\r\n     */\r\n    randomRange(min, max) {\r\n        return this.rng ? this.rng.range(min, max) : Math.floor(Math.random() * (max - min)) + min;\r\n    }\r\n\r\n    /**\r\n     * Generate the floor map\r\n     */\r\n    generate() {\r\n        // Initialize empty grid\r\n        this.grid = Array(this.height).fill(null).map(() => Array(this.width).fill(null));\r\n\r\n        // Step 1: Place start and boss rooms\r\n        const midRow = Math.floor(this.height / 2);\r\n        this.startPosition = { x: 0, y: midRow };\r\n\r\n        // Boss can be in any row on the rightmost column\r\n        const bossRow = this.height === 1 ? 0 : this.randomRange(0, this.height);\r\n        this.bossPosition = { x: this.width - 1, y: bossRow };\r\n\r\n        // Create start room\r\n        const startRoom = new RoomNode(0, midRow, 'start');\r\n        this.setRoom(0, midRow, startRoom);\r\n\r\n        // Create boss room\r\n        const bossRoom = new RoomNode(this.width - 1, bossRow, 'boss');\r\n        this.setRoom(this.width - 1, bossRow, bossRoom);\r\n\r\n        // Step 2: Generate guaranteed main path from start to boss\r\n        this.generateMainPath();\r\n\r\n        // Step 3: Add branch rooms for choices (20-40% additional rooms)\r\n        this.addBranchRooms();\r\n\r\n        // Step 4: Establish connections between adjacent rooms\r\n        this.establishConnections();\r\n\r\n        // Step 5: Assign room templates and enemy types\r\n        this.assignRoomProperties();\r\n\r\n        // Step 6: Validate the map\r\n        this.validate();\r\n\r\n        // Set current position to start\r\n        this.currentPosition = { ...this.startPosition };\r\n        this.markRoomVisited(this.startPosition.x, this.startPosition.y);\r\n    }\r\n\r\n    /**\r\n     * Generate the main guaranteed path from start to boss\r\n     */\r\n    generateMainPath() {\r\n        const path = this.findPath(this.startPosition, this.bossPosition);\r\n\r\n        // Create rooms along the path\r\n        for (const pos of path) {\r\n            if (!this.getRoom(pos.x, pos.y)) {\r\n                const room = new RoomNode(pos.x, pos.y, 'combat');\r\n                this.setRoom(pos.x, pos.y, room);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Find a path from start to end using simple pathfinding\r\n     * Only moves RIGHT, UP, or DOWN\r\n     */\r\n    findPath(start, end) {\r\n        const path = [];\r\n        let current = { ...start };\r\n\r\n        while (current.x < end.x || current.y !== end.y) {\r\n            path.push({ ...current });\r\n\r\n            // Prefer moving right\r\n            if (current.x < end.x) {\r\n                // Occasionally move up/down to reach target row\r\n                if (current.y !== end.y && this.random() < 0.3) {\r\n                    current.y += current.y < end.y ? 1 : -1;\r\n                } else {\r\n                    current.x += 1;\r\n                }\r\n            } else {\r\n                // Move vertically to reach target row\r\n                current.y += current.y < end.y ? 1 : -1;\r\n            }\r\n        }\r\n\r\n        path.push({ ...end });\r\n        return path;\r\n    }\r\n\r\n    /**\r\n     * Add branch rooms to create choices for the player\r\n     */\r\n    addBranchRooms() {\r\n        const maxBranches = Math.floor((this.width * this.height) * 0.3); // 30% of grid\r\n        let branchesAdded = 0;\r\n\r\n        // Try to add branches adjacent to existing rooms\r\n        for (let x = 1; x < this.width - 1; x++) {\r\n            for (let y = 0; y < this.height; y++) {\r\n                if (branchesAdded >= maxBranches) break;\r\n\r\n                // Skip if room already exists\r\n                if (this.getRoom(x, y)) continue;\r\n\r\n                // Check if adjacent to an existing room (to the left)\r\n                const hasLeftNeighbor = x > 0 && this.getRoom(x - 1, y);\r\n                if (hasLeftNeighbor && this.random() < 0.5) {\r\n                    const room = new RoomNode(x, y, 'combat');\r\n                    this.setRoom(x, y, room);\r\n                    branchesAdded++;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Establish connections between adjacent rooms\r\n     */\r\n    establishConnections() {\r\n        for (let x = 0; x < this.width; x++) {\r\n            for (let y = 0; y < this.height; y++) {\r\n                const room = this.getRoom(x, y);\r\n                if (!room) continue;\r\n\r\n                // Check right\r\n                if (x < this.width - 1 && this.getRoom(x + 1, y)) {\r\n                    room.connections.right = true;\r\n                }\r\n\r\n                // Check up\r\n                if (y > 0 && this.getRoom(x, y - 1)) {\r\n                    room.connections.up = true;\r\n                }\r\n\r\n                // Check down\r\n                if (y < this.height - 1 && this.getRoom(x, y + 1)) {\r\n                    room.connections.down = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Assign room templates and enemy types based on floor\r\n     */\r\n    assignRoomProperties() {\r\n        for (let x = 0; x < this.width; x++) {\r\n            for (let y = 0; y < this.height; y++) {\r\n                const room = this.getRoom(x, y);\r\n                if (!room) continue;\r\n\r\n                // Assign template (except boss room which uses special template)\r\n                if (room.type !== 'boss') {\r\n                    room.template = getWeightedRoomTemplate(this.floor, this.rng);\r\n                }\r\n\r\n                // Assign enemy types for combat rooms\r\n                if (room.type === 'combat') {\r\n                    const enemyCount = this.randomRange(3, 6); // 3-5 enemy types\r\n                    room.enemyTypes = [];\r\n                    for (let i = 0; i < enemyCount; i++) {\r\n                        // Use seeded RNG for multiplayer consistency\r\n                        room.enemyTypes.push(getRandomEnemyType(this.floor, this.rng));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Validate the map (ensure boss is reachable)\r\n     */\r\n    validate() {\r\n        // BFS to check if boss is reachable from start\r\n        const visited = new Set();\r\n        const queue = [this.startPosition];\r\n        visited.add(`${this.startPosition.x},${this.startPosition.y}`);\r\n\r\n        while (queue.length > 0) {\r\n            const pos = queue.shift();\r\n            const room = this.getRoom(pos.x, pos.y);\r\n\r\n            if (!room) continue;\r\n\r\n            // Check if we reached the boss\r\n            if (room.type === 'boss') {\r\n                console.log('[FloorMap] Validation passed: Boss is reachable');\r\n                return true;\r\n            }\r\n\r\n            // Add connected rooms to queue\r\n            const directions = ['up', 'down', 'right'];\r\n            for (const dir of directions) {\r\n                if (room.connections[dir]) {\r\n                    const nextPos = room.getAdjacentPosition(dir);\r\n                    const key = `${nextPos.x},${nextPos.y}`;\r\n                    if (!visited.has(key)) {\r\n                        visited.add(key);\r\n                        queue.push(nextPos);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        console.error('[FloorMap] Validation failed: Boss is not reachable!');\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Get room at position\r\n     */\r\n    getRoom(x, y) {\r\n        if (x < 0 || x >= this.width || y < 0 || y >= this.height) {\r\n            return null;\r\n        }\r\n        return this.grid[y][x];\r\n    }\r\n\r\n    /**\r\n     * Set room at position\r\n     */\r\n    setRoom(x, y, room) {\r\n        if (x < 0 || x >= this.width || y < 0 || y >= this.height) {\r\n            return;\r\n        }\r\n        this.grid[y][x] = room;\r\n        this.rooms.set(room.getKey(), room);\r\n    }\r\n\r\n    /**\r\n     * Get current room\r\n     */\r\n    getCurrentRoom() {\r\n        return this.getRoom(this.currentPosition.x, this.currentPosition.y);\r\n    }\r\n\r\n    /**\r\n     * Get available exits from current room (unvisited only)\r\n     */\r\n    getAvailableExits() {\r\n        const room = this.getCurrentRoom();\r\n        if (!room) return [];\r\n\r\n        const exits = [];\r\n        const directions = ['up', 'down', 'right'];\r\n\r\n        for (const dir of directions) {\r\n            if (room.connections[dir]) {\r\n                const nextPos = room.getAdjacentPosition(dir);\r\n                const nextRoom = this.getRoom(nextPos.x, nextPos.y);\r\n\r\n                // Only include if room exists and hasn't been visited\r\n                if (nextRoom && !nextRoom.visited) {\r\n                    exits.push({\r\n                        direction: dir,\r\n                        position: nextPos,\r\n                        room: nextRoom\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return exits;\r\n    }\r\n\r\n    /**\r\n     * Mark room as visited\r\n     */\r\n    markRoomVisited(x, y) {\r\n        const room = this.getRoom(x, y);\r\n        if (room) {\r\n            room.visited = true;\r\n            this.visitedRooms.add(room.getKey());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Mark room as cleared\r\n     */\r\n    markRoomCleared(x, y) {\r\n        const room = this.getRoom(x, y);\r\n        if (room) {\r\n            room.cleared = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Move to adjacent room\r\n     */\r\n    moveToRoom(direction) {\r\n        const currentRoom = this.getCurrentRoom();\r\n        if (!currentRoom || !currentRoom.connections[direction]) {\r\n            console.warn(`[FloorMap] Cannot move ${direction} from current position`);\r\n            return false;\r\n        }\r\n\r\n        const nextPos = currentRoom.getAdjacentPosition(direction);\r\n        const nextRoom = this.getRoom(nextPos.x, nextPos.y);\r\n\r\n        if (!nextRoom) {\r\n            console.warn(`[FloorMap] No room found at ${nextPos.x}, ${nextPos.y}`);\r\n            return false;\r\n        }\r\n\r\n        // Update current position\r\n        this.currentPosition = nextPos;\r\n        this.markRoomVisited(nextPos.x, nextPos.y);\r\n\r\n        console.log(`[FloorMap] Moved to room (${nextPos.x}, ${nextPos.y})`);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Get total number of rooms\r\n     */\r\n    getTotalRooms() {\r\n        return this.rooms.size;\r\n    }\r\n\r\n    /**\r\n     * Get number of visited rooms\r\n     */\r\n    getVisitedCount() {\r\n        return this.visitedRooms.size;\r\n    }\r\n\r\n    /**\r\n     * Get grid for minimap display\r\n     */\r\n    getGridForMinimap() {\r\n        const minimapGrid = [];\r\n\r\n        for (let y = 0; y < this.height; y++) {\r\n            const row = [];\r\n            for (let x = 0; x < this.width; x++) {\r\n                const room = this.getRoom(x, y);\r\n\r\n                if (!room) {\r\n                    row.push({ type: 'empty' });\r\n                } else if (x === this.currentPosition.x && y === this.currentPosition.y) {\r\n                    row.push({ type: 'current', room });\r\n                } else if (room.visited) {\r\n                    row.push({ type: 'visited', room });\r\n                } else if (this.isRoomRevealed(x, y)) {\r\n                    row.push({ type: 'revealed', room });\r\n                } else {\r\n                    row.push({ type: 'hidden' });\r\n                }\r\n            }\r\n            minimapGrid.push(row);\r\n        }\r\n\r\n        return minimapGrid;\r\n    }\r\n\r\n    /**\r\n     * Check if a room should be revealed on minimap\r\n     * (adjacent to visited rooms)\r\n     */\r\n    isRoomRevealed(x, y) {\r\n        const room = this.getRoom(x, y);\r\n        if (!room) return false;\r\n\r\n        // Check if any adjacent room is visited\r\n        const directions = [\r\n            { dx: -1, dy: 0 }, // left (shows rooms behind)\r\n            { dx: 1, dy: 0 },  // right\r\n            { dx: 0, dy: -1 }, // up\r\n            { dx: 0, dy: 1 }   // down\r\n        ];\r\n\r\n        for (const { dx, dy } of directions) {\r\n            const adjRoom = this.getRoom(x + dx, y + dy);\r\n            if (adjRoom && adjRoom.visited) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Debug: Print grid to console\r\n     */\r\n    debugPrint() {\r\n        console.log(`\\n[FloorMap] Floor ${this.floor} - ${this.width}x${this.height}`);\r\n        console.log(`Start: (${this.startPosition.x}, ${this.startPosition.y})`);\r\n        console.log(`Boss: (${this.bossPosition.x}, ${this.bossPosition.y})`);\r\n        console.log(`Current: (${this.currentPosition.x}, ${this.currentPosition.y})`);\r\n        console.log(`Rooms: ${this.getTotalRooms()}, Visited: ${this.getVisitedCount()}\\n`);\r\n\r\n        for (let y = 0; y < this.height; y++) {\r\n            let row = '';\r\n            for (let x = 0; x < this.width; x++) {\r\n                const room = this.getRoom(x, y);\r\n                if (!room) {\r\n                    row += '[ ]';\r\n                } else if (room.type === 'start') {\r\n                    row += '[S]';\r\n                } else if (room.type === 'boss') {\r\n                    row += '[B]';\r\n                } else if (x === this.currentPosition.x && y === this.currentPosition.y) {\r\n                    row += '[]';\r\n                } else if (room.visited) {\r\n                    row += '[]';\r\n                } else {\r\n                    row += '[R]';\r\n                }\r\n                row += ' ';\r\n            }\r\n            console.log(row);\r\n        }\r\n\r\n        // Show connections\r\n        console.log('\\nConnections:');\r\n        for (const [key, room] of this.rooms) {\r\n            const connections = [];\r\n            if (room.connections.up) connections.push('');\r\n            if (room.connections.down) connections.push('');\r\n            if (room.connections.right) connections.push('');\r\n            console.log(`  (${room.position.x}, ${room.position.y}): ${connections.join(', ') || 'none'}`);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Helper function to create a floor map for a given floor number\r\n * @param {number} floor - Floor number\r\n * @param {SeededRandom} rng - Optional seeded RNG for multiplayer synchronization\r\n * @returns {FloorMap} Generated floor map\r\n */\r\nexport function generateFloorMap(floor, rng = null) {\r\n    // Adjust grid size based on floor for more complex layouts per floor\r\n    // Floor 1: 4x3 (small), Floor 2: 5x3, Floor 3: 6x4, etc.\r\n    const width = Math.min(3 + floor, 10); // 4-10 columns\r\n    const height = Math.min(2 + Math.floor(floor / 2), 6); // 3-6 rows\r\n\r\n    const floorMap = new FloorMap(floor, width, height, rng);\r\n    floorMap.debugPrint();\r\n\r\n    return floorMap;\r\n}\r\n","/**\r\n * Minimap UI Component\r\n *\r\n * Displays a compact or expanded view of the floor grid\r\n * Shows player position, visited rooms, and available paths\r\n *\r\n * Design: All states anchor to top-right with consistent margins\r\n */\r\n\r\nimport { playMenuNav } from './sounds.js';\r\n\r\n/**\r\n * Minimap display modes\r\n */\r\nconst MINIMAP_MODE = {\r\n    MINIMIZED: 'minimized',  // Just a map button\r\n    OPEN: 'open',            // Small minimap (no legend)\r\n    MAXIMIZED: 'maximized'   // Large minimap with legend\r\n};\r\n\r\n/**\r\n * UI Layout Constants\r\n */\r\nconst LAYOUT = {\r\n    MARGIN_RIGHT: 12,      // Distance from right edge\r\n    MARGIN_TOP: 32,        // Below credits counter (at y: 6)\r\n    BUTTON_SIZE: 38,       // Minimized button size\r\n    OPEN_WIDTH: 130,       // Open state width\r\n    OPEN_HEIGHT: 85,       // Open state height\r\n    MAX_MIN_WIDTH: 200,    // Maximized minimum width\r\n    MAX_MIN_HEIGHT: 160,   // Maximized minimum height\r\n    CELL_SIZE_SMALL: 11,   // Grid cell size for open state\r\n    CELL_SIZE_LARGE: 16,   // Grid cell size for maximized state\r\n    CORNER_RADIUS: 4,      // Rounded corner visual (simulated)\r\n    Z_BASE: 900,           // Base z-index\r\n    Z_TEXT: 901,           // Text z-index\r\n    Z_ICON: 902,           // Icon/badge z-index\r\n};\r\n\r\n/**\r\n * Color Palette\r\n */\r\nconst COLORS = {\r\n    BG_DARK: [18, 18, 28],\r\n    BG_PANEL: [25, 25, 40],\r\n    BG_HEADER: [35, 35, 55],\r\n    BORDER: [80, 120, 180],\r\n    BORDER_HOVER: [120, 160, 220],\r\n    TEXT_TITLE: [200, 210, 255],\r\n    TEXT_MUTED: [140, 140, 160],\r\n    ICON_MAP: [130, 160, 220],\r\n    BADGE_FLOOR: [255, 220, 80],\r\n    CURRENT: [255, 255, 100],\r\n    VISITED: [80, 220, 100],\r\n    AVAILABLE: [120, 120, 140],\r\n    BOSS: [255, 90, 90],\r\n    HIDDEN: [50, 50, 70],\r\n    CELL_BG: [30, 30, 45],\r\n    CELL_BORDER: [45, 45, 60],\r\n};\r\n\r\n/**\r\n * Minimap UI Manager\r\n */\r\nexport class Minimap {\r\n    constructor(k, floorMap) {\r\n        this.k = k;\r\n        this.floorMap = floorMap;\r\n        this.mode = MINIMAP_MODE.MINIMIZED;\r\n        this.elements = [];\r\n        this.isHovered = false;\r\n\r\n        // Only render if floorMap is valid\r\n        if (this.floorMap && typeof this.floorMap.getGridForMinimap === 'function') {\r\n            this.render();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the right anchor X position (consistent for all states)\r\n     */\r\n    getRightX() {\r\n        return this.k.width() - LAYOUT.MARGIN_RIGHT;\r\n    }\r\n\r\n    /**\r\n     * Get the top Y position (consistent for all states)\r\n     */\r\n    getTopY() {\r\n        return LAYOUT.MARGIN_TOP;\r\n    }\r\n\r\n    /**\r\n     * Cycle through minimap modes: minimized  open  maximized  minimized\r\n     */\r\n    toggle() {\r\n        try {\r\n            playMenuNav();\r\n        } catch (e) {\r\n            console.warn('[Minimap] Sound playback failed:', e);\r\n        }\r\n\r\n        if (this.mode === MINIMAP_MODE.MINIMIZED) {\r\n            this.mode = MINIMAP_MODE.OPEN;\r\n        } else if (this.mode === MINIMAP_MODE.OPEN) {\r\n            this.mode = MINIMAP_MODE.MAXIMIZED;\r\n        } else {\r\n            this.mode = MINIMAP_MODE.MINIMIZED;\r\n        }\r\n\r\n        this.k.wait(0, () => {\r\n            this.update();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update minimap display\r\n     */\r\n    update() {\r\n        this.clear();\r\n        this.render();\r\n    }\r\n\r\n    /**\r\n     * Clear all minimap elements\r\n     */\r\n    clear() {\r\n        this.elements.forEach(el => {\r\n            if (el.exists()) {\r\n                this.k.destroy(el);\r\n            }\r\n        });\r\n        this.elements = [];\r\n    }\r\n\r\n    /**\r\n     * Render minimap based on current mode\r\n     */\r\n    render() {\r\n        if (this.mode === MINIMAP_MODE.MINIMIZED) {\r\n            this.renderMinimized();\r\n        } else if (this.mode === MINIMAP_MODE.OPEN) {\r\n            this.renderOpen();\r\n        } else {\r\n            this.renderMaximized();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create a clickable background panel with hover effect\r\n     */\r\n    createPanel(width, height, x, y) {\r\n        const bg = this.k.add([\r\n            this.k.rect(width, height),\r\n            this.k.pos(x, y),\r\n            this.k.anchor('topright'),\r\n            this.k.color(...COLORS.BG_PANEL),\r\n            this.k.outline(2, this.k.rgb(...COLORS.BORDER)),\r\n            this.k.fixed(),\r\n            this.k.z(LAYOUT.Z_BASE),\r\n            this.k.area(),\r\n            this.k.opacity(0.95),\r\n            'minimap'\r\n        ]);\r\n\r\n        bg.onHover(() => {\r\n            bg.outline.color = this.k.rgb(...COLORS.BORDER_HOVER);\r\n            bg.outline.width = 3;\r\n        });\r\n\r\n        bg.onHoverEnd(() => {\r\n            bg.outline.color = this.k.rgb(...COLORS.BORDER);\r\n            bg.outline.width = 2;\r\n        });\r\n\r\n        bg.onClick(() => this.toggle());\r\n        this.elements.push(bg);\r\n        return bg;\r\n    }\r\n\r\n    /**\r\n     * Render minimized state - compact map button\r\n     */\r\n    renderMinimized() {\r\n        const x = this.getRightX();\r\n        const y = this.getTopY();\r\n        const size = LAYOUT.BUTTON_SIZE;\r\n\r\n        // Button background\r\n        this.createPanel(size, size, x, y);\r\n\r\n        // Calculate center of button (panel anchored topright, so center is left and down from anchor)\r\n        const centerX = x - size / 2;\r\n        const centerY = y + size / 2;\r\n\r\n        // Map icon\r\n        const icon = this.k.add([\r\n            this.k.text('', { size: 22 }),\r\n            this.k.pos(centerX, centerY),\r\n            this.k.anchor('center'),\r\n            this.k.color(...COLORS.ICON_MAP),\r\n            this.k.fixed(),\r\n            this.k.z(LAYOUT.Z_TEXT),\r\n            'minimap'\r\n        ]);\r\n        this.elements.push(icon);\r\n\r\n        // Floor number badge (top-left corner of button)\r\n        const badge = this.k.add([\r\n            this.k.text(`F${this.floorMap.floor}`, { size: 9 }),\r\n            this.k.pos(x - size + 4, y + 4),\r\n            this.k.anchor('topleft'),\r\n            this.k.color(...COLORS.BADGE_FLOOR),\r\n            this.k.fixed(),\r\n            this.k.z(LAYOUT.Z_ICON),\r\n            'minimap'\r\n        ]);\r\n        this.elements.push(badge);\r\n    }\r\n\r\n    /**\r\n     * Render open state - compact minimap without legend\r\n     */\r\n    renderOpen() {\r\n        const x = this.getRightX();\r\n        const y = this.getTopY();\r\n        const width = LAYOUT.OPEN_WIDTH;\r\n        const height = LAYOUT.OPEN_HEIGHT;\r\n        const cellSize = LAYOUT.CELL_SIZE_SMALL;\r\n        const grid = this.floorMap.getGridForMinimap();\r\n\r\n        // Safety check for empty grid\r\n        if (!grid || grid.length === 0 || !grid[0]) {\r\n            this.renderMinimized();\r\n            return;\r\n        }\r\n\r\n        // Background panel\r\n        this.createPanel(width, height, x, y);\r\n\r\n        // Header bar\r\n        const headerHeight = 18;\r\n        const header = this.k.add([\r\n            this.k.rect(width - 4, headerHeight),\r\n            this.k.pos(x - 2, y + 2),\r\n            this.k.anchor('topright'),\r\n            this.k.color(...COLORS.BG_HEADER),\r\n            this.k.fixed(),\r\n            this.k.z(LAYOUT.Z_TEXT),\r\n            'minimap'\r\n        ]);\r\n        this.elements.push(header);\r\n\r\n        // Title\r\n        const title = this.k.add([\r\n            this.k.text(`Floor ${this.floorMap.floor}`, { size: 10 }),\r\n            this.k.pos(x - width / 2, y + 2 + headerHeight / 2),\r\n            this.k.anchor('center'),\r\n            this.k.color(...COLORS.TEXT_TITLE),\r\n            this.k.fixed(),\r\n            this.k.z(LAYOUT.Z_ICON),\r\n            'minimap'\r\n        ]);\r\n        this.elements.push(title);\r\n\r\n        // Grid area\r\n        const gridWidth = grid[0].length * cellSize;\r\n        const gridHeight = grid.length * cellSize;\r\n        const gridStartX = x - width / 2 - gridWidth / 2;\r\n        const gridStartY = y + headerHeight + 8;\r\n\r\n        this.renderGrid(grid, gridStartX, gridStartY, cellSize, false);\r\n\r\n        // Room counter at bottom\r\n        const counter = this.k.add([\r\n            this.k.text(`${this.floorMap.getVisitedCount()}/${this.floorMap.getTotalRooms()} rooms`, { size: 8 }),\r\n            this.k.pos(x - width / 2, y + height - 8),\r\n            this.k.anchor('center'),\r\n            this.k.color(...COLORS.TEXT_MUTED),\r\n            this.k.fixed(),\r\n            this.k.z(LAYOUT.Z_TEXT),\r\n            'minimap'\r\n        ]);\r\n        this.elements.push(counter);\r\n    }\r\n\r\n    /**\r\n     * Render maximized state - full minimap with legend\r\n     */\r\n    renderMaximized() {\r\n        const x = this.getRightX();\r\n        const y = this.getTopY();\r\n        const cellSize = LAYOUT.CELL_SIZE_LARGE;\r\n        const grid = this.floorMap.getGridForMinimap();\r\n\r\n        // Safety check for empty grid\r\n        if (!grid || grid.length === 0 || !grid[0]) {\r\n            this.renderMinimized();\r\n            return;\r\n        }\r\n\r\n        // Calculate dimensions based on grid\r\n        const gridWidth = grid[0].length * cellSize;\r\n        const gridHeight = grid.length * cellSize;\r\n        const legendHeight = 70;\r\n        const headerHeight = 26;\r\n        const padding = 16;\r\n\r\n        const width = Math.max(LAYOUT.MAX_MIN_WIDTH, gridWidth + padding * 2);\r\n        const height = Math.max(LAYOUT.MAX_MIN_HEIGHT, gridHeight + headerHeight + legendHeight + padding);\r\n\r\n        // Ensure it stays on screen (left edge)\r\n        const safeWidth = Math.min(width, this.k.width() - LAYOUT.MARGIN_RIGHT - 10);\r\n\r\n        // Background panel\r\n        this.createPanel(safeWidth, height, x, y);\r\n\r\n        // Header bar\r\n        const header = this.k.add([\r\n            this.k.rect(safeWidth - 4, headerHeight),\r\n            this.k.pos(x - 2, y + 2),\r\n            this.k.anchor('topright'),\r\n            this.k.color(...COLORS.BG_HEADER),\r\n            this.k.fixed(),\r\n            this.k.z(LAYOUT.Z_TEXT),\r\n            'minimap'\r\n        ]);\r\n        this.elements.push(header);\r\n\r\n        // Title with room count\r\n        const title = this.k.add([\r\n            this.k.text(`FLOOR ${this.floorMap.floor}    ${this.floorMap.getVisitedCount()}/${this.floorMap.getTotalRooms()}`, { size: 11 }),\r\n            this.k.pos(x - safeWidth / 2, y + 2 + headerHeight / 2),\r\n            this.k.anchor('center'),\r\n            this.k.color(...COLORS.TEXT_TITLE),\r\n            this.k.fixed(),\r\n            this.k.z(LAYOUT.Z_ICON),\r\n            'minimap'\r\n        ]);\r\n        this.elements.push(title);\r\n\r\n        // Grid area (centered)\r\n        const actualGridWidth = Math.min(gridWidth, safeWidth - padding * 2);\r\n        const gridStartX = x - safeWidth / 2 - actualGridWidth / 2;\r\n        const gridStartY = y + headerHeight + 12;\r\n\r\n        this.renderGrid(grid, gridStartX, gridStartY, cellSize, true);\r\n\r\n        // Legend section\r\n        const legendY = gridStartY + gridHeight + 12;\r\n        this.renderLegend(x - safeWidth + padding, legendY);\r\n    }\r\n\r\n    /**\r\n     * Render the room grid\r\n     */\r\n    renderGrid(grid, startX, startY, cellSize, showBackground) {\r\n        for (let row = 0; row < grid.length; row++) {\r\n            for (let col = 0; col < grid[row].length; col++) {\r\n                const cell = grid[row][col];\r\n                const cellX = startX + col * cellSize;\r\n                const cellY = startY + row * cellSize;\r\n\r\n                if (cell.type === 'empty') continue;\r\n\r\n                // Cell background (only in maximized)\r\n                if (showBackground) {\r\n                    const cellBg = this.k.add([\r\n                        this.k.rect(cellSize - 2, cellSize - 2),\r\n                        this.k.pos(cellX, cellY),\r\n                        this.k.anchor('topleft'),\r\n                        this.k.color(...COLORS.CELL_BG),\r\n                        this.k.outline(1, this.k.rgb(...COLORS.CELL_BORDER)),\r\n                        this.k.fixed(),\r\n                        this.k.z(LAYOUT.Z_TEXT),\r\n                        'minimap'\r\n                    ]);\r\n                    this.elements.push(cellBg);\r\n                }\r\n\r\n                // Cell icon\r\n                const { char, color } = this.getCellDisplay(cell);\r\n                if (char) {\r\n                    const fontSize = showBackground ? 12 : 9;\r\n                    const cellText = this.k.add([\r\n                        this.k.text(char, { size: fontSize }),\r\n                        this.k.pos(cellX + cellSize / 2 - 1, cellY + cellSize / 2 - 1),\r\n                        this.k.anchor('center'),\r\n                        this.k.color(...color),\r\n                        this.k.fixed(),\r\n                        this.k.z(LAYOUT.Z_ICON),\r\n                        'minimap'\r\n                    ]);\r\n                    this.elements.push(cellText);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get display character and color for a cell\r\n     */\r\n    getCellDisplay(cell) {\r\n        switch (cell.type) {\r\n            case 'current':\r\n                return { char: '', color: COLORS.CURRENT };\r\n            case 'visited':\r\n                return cell.room.isBossRoom\r\n                    ? { char: 'B', color: COLORS.BOSS }\r\n                    : { char: '', color: COLORS.VISITED };\r\n            case 'revealed':\r\n                return cell.room.isBossRoom\r\n                    ? { char: 'B', color: [...COLORS.BOSS.map(c => Math.min(255, c + 50))] }\r\n                    : { char: '', color: COLORS.AVAILABLE };\r\n            case 'hidden':\r\n                return { char: '', color: COLORS.HIDDEN };\r\n            default:\r\n                return { char: '', color: [100, 100, 100] };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Render the legend section\r\n     */\r\n    renderLegend(startX, startY) {\r\n        const legends = [\r\n            { char: '', label: 'Current', color: COLORS.CURRENT },\r\n            { char: '', label: 'Cleared', color: COLORS.VISITED },\r\n            { char: '', label: 'Available', color: COLORS.AVAILABLE },\r\n            { char: 'B', label: 'Boss', color: COLORS.BOSS }\r\n        ];\r\n\r\n        // Arrange in 2x2 grid for compact layout\r\n        const colWidth = 80;\r\n        const rowHeight = 14;\r\n\r\n        legends.forEach((legend, i) => {\r\n            const col = i % 2;\r\n            const row = Math.floor(i / 2);\r\n            const itemX = startX + col * colWidth;\r\n            const itemY = startY + row * rowHeight;\r\n\r\n            const symbol = this.k.add([\r\n                this.k.text(legend.char, { size: 10 }),\r\n                this.k.pos(itemX, itemY),\r\n                this.k.anchor('topleft'),\r\n                this.k.color(...legend.color),\r\n                this.k.fixed(),\r\n                this.k.z(LAYOUT.Z_ICON),\r\n                'minimap'\r\n            ]);\r\n            this.elements.push(symbol);\r\n\r\n            const label = this.k.add([\r\n                this.k.text(legend.label, { size: 8 }),\r\n                this.k.pos(itemX + 14, itemY + 1),\r\n                this.k.anchor('topleft'),\r\n                this.k.color(...COLORS.TEXT_MUTED),\r\n                this.k.fixed(),\r\n                this.k.z(LAYOUT.Z_ICON),\r\n                'minimap'\r\n            ]);\r\n            this.elements.push(label);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Cleanup - destroy all minimap elements\r\n     */\r\n    destroy() {\r\n        this.clear();\r\n    }\r\n}\r\n\r\n/**\r\n * Create and initialize minimap\r\n */\r\nexport function createMinimap(k, floorMap) {\r\n    return new Minimap(k, floorMap);\r\n}\r\n","/**\r\n * Floor Theming System\r\n *\r\n * Adds cosmetic floor decorations that vary by floor theme.\r\n * Each floor has a distinct personality with unique:\r\n * - Visual decorations and patterns\r\n * - Color schemes\r\n * - Environmental storytelling\r\n * Decorations are purely visual and don't impact gameplay clarity.\r\n */\r\n\r\n// Floor theme definitions - Each floor tells a story\r\nconst FLOOR_THEMES = {\r\n    city: {\r\n        name: 'Urban Streets',\r\n        description: 'Abandoned city blocks overrun by chaos',\r\n        floors: [1],\r\n        decorations: [\r\n            // Road markings - faded crosswalks and lanes\r\n            { char: '', pattern: 'horizontal_lines', density: 'medium', opacity: 0.18 },\r\n            { char: '', pattern: 'vertical_lines', density: 'low', opacity: 0.15 },\r\n            // Manholes and storm drains\r\n            { char: '', pattern: 'scattered', count: 4, opacity: 0.22 },\r\n            { char: '', pattern: 'scattered', count: 3, opacity: 0.18 },\r\n            // Debris and cracks in pavement\r\n            { char: '', pattern: 'random', count: 12, opacity: 0.12 },\r\n            { char: '', pattern: 'random', count: 12, opacity: 0.12 },\r\n            // Trash and litter\r\n            { char: '', pattern: 'random', count: 6, opacity: 0.1 },\r\n            // Broken glass reflections\r\n            { char: '', pattern: 'scattered', count: 15, opacity: 0.08 }\r\n        ],\r\n        baseColor: [55, 55, 65], // Cool gray asphalt\r\n        ambientColor: [70, 70, 80] // Dim streetlight glow\r\n    },\r\n    mechanical: {\r\n        name: 'Industrial Complex',\r\n        description: 'Rusted factories and hazardous machinery',\r\n        floors: [2],\r\n        decorations: [\r\n            // Heavy metal plating - factory floor\r\n            { char: '', pattern: 'horizontal_lines', density: 'high', opacity: 0.15 },\r\n            { char: '', pattern: 'grid', spacing: 70, opacity: 0.18 },\r\n            // Grates and ventilation\r\n            { char: '', pattern: 'scattered', count: 5, opacity: 0.22 },\r\n            { char: '', pattern: 'scattered', count: 4, opacity: 0.2 },\r\n            // Rivets and bolts\r\n            { char: '', pattern: 'edges', count: 16, opacity: 0.16 },\r\n            { char: '', pattern: 'corners', opacity: 0.24 },\r\n            // Oil stains and rust\r\n            { char: '', pattern: 'random', count: 10, opacity: 0.1 },\r\n            // Caution markings\r\n            { char: '', pattern: 'scattered', count: 2, opacity: 0.15 },\r\n            // Pipes running along floor\r\n            { char: '', pattern: 'horizontal_lines', density: 'low', opacity: 0.12 }\r\n        ],\r\n        baseColor: [75, 60, 50], // Rusty brown-orange\r\n        ambientColor: [90, 75, 60] // Warm industrial lighting\r\n    },\r\n    futuristic: {\r\n        name: 'Cyber Station',\r\n        description: 'High-tech facility with malfunctioning systems',\r\n        floors: [3],\r\n        decorations: [\r\n            // Clean panel seams - futuristic flooring\r\n            { char: '', pattern: 'vertical_lines', density: 'medium', opacity: 0.16 },\r\n            { char: '', pattern: 'horizontal_lines', density: 'medium', opacity: 0.16 },\r\n            // Holographic floor panels\r\n            { char: '', pattern: 'grid', spacing: 90, opacity: 0.14 },\r\n            { char: '', pattern: 'scattered', count: 6, opacity: 0.18 },\r\n            // Data nodes and access points\r\n            { char: '', pattern: 'corners', opacity: 0.22 },\r\n            { char: '', pattern: 'scattered', count: 8, opacity: 0.16 },\r\n            // Circuit traces\r\n            { char: '', pattern: 'grid', spacing: 150, opacity: 0.1 },\r\n            // Flickering indicators\r\n            { char: '', pattern: 'random', count: 5, opacity: 0.12 },\r\n            // Light strips\r\n            { char: '', pattern: 'edges', count: 20, opacity: 0.15 }\r\n        ],\r\n        baseColor: [45, 55, 75], // Cool blue steel\r\n        ambientColor: [60, 80, 120] // Neon blue glow\r\n    },\r\n    alien: {\r\n        name: 'Alien Vessel',\r\n        description: 'Otherworldly organic ship interior',\r\n        floors: [4],\r\n        decorations: [\r\n            // Organic pulsing patterns\r\n            { char: '', pattern: 'wavy_lines', density: 'medium', opacity: 0.15 },\r\n            { char: '~', pattern: 'random', count: 20, opacity: 0.12 },\r\n            // Bio-luminescent nodes\r\n            { char: '', pattern: 'scattered', count: 5, opacity: 0.2 },\r\n            { char: '', pattern: 'grid', spacing: 110, opacity: 0.16 },\r\n            // Alien symbols and markings\r\n            { char: '', pattern: 'corners', opacity: 0.2 },\r\n            { char: '', pattern: 'scattered', count: 6, opacity: 0.16 },\r\n            // Membrane textures\r\n            { char: '', pattern: 'random', count: 12, opacity: 0.1 },\r\n            // Spore-like particles\r\n            { char: '', pattern: 'scattered', count: 15, opacity: 0.08 },\r\n            // Veins/tendrils pattern\r\n            { char: '', pattern: 'random', count: 8, opacity: 0.12 },\r\n            { char: '', pattern: 'random', count: 8, opacity: 0.12 }\r\n        ],\r\n        baseColor: [60, 45, 70], // Deep purple organic\r\n        ambientColor: [80, 60, 100] // Bioluminescent purple glow\r\n    },\r\n    // Future floors (5+) - extend the theming\r\n    void: {\r\n        name: 'The Void',\r\n        description: 'Reality breaks down at the edge of existence',\r\n        floors: [5, 6, 7, 8],\r\n        decorations: [\r\n            // Static and glitches\r\n            { char: '', pattern: 'random', count: 25, opacity: 0.15 },\r\n            { char: '', pattern: 'random', count: 15, opacity: 0.12 },\r\n            // Fragmented reality\r\n            { char: '', pattern: 'scattered', count: 8, opacity: 0.18 },\r\n            { char: '', pattern: 'grid', spacing: 120, opacity: 0.14 },\r\n            // Dimensional tears\r\n            { char: '', pattern: 'corners', opacity: 0.2 },\r\n            { char: '', pattern: 'scattered', count: 10, opacity: 0.16 },\r\n            // Entropy patterns\r\n            { char: '', pattern: 'random', count: 20, opacity: 0.1 },\r\n            { char: '', pattern: 'random', count: 20, opacity: 0.1 }\r\n        ],\r\n        baseColor: [35, 30, 45], // Deep void purple-black\r\n        ambientColor: [50, 40, 70] // Eldritch glow\r\n    }\r\n};\r\n\r\n/**\r\n * Get theme for current floor\r\n * @param {number} floor - Current floor number\r\n * @returns {object} - Floor theme configuration\r\n */\r\nexport function getFloorTheme(floor) {\r\n    for (const [key, theme] of Object.entries(FLOOR_THEMES)) {\r\n        if (theme.floors.includes(floor)) {\r\n            return { key, ...theme };\r\n        }\r\n    }\r\n    // Default to first available theme or city theme\r\n    return { key: 'city', ...FLOOR_THEMES.city };\r\n}\r\n\r\n/**\r\n * Generate floor decorations for the current room\r\n * @param {object} k - Kaplay instance\r\n * @param {number} floor - Current floor\r\n * @param {number} roomWidth - Room width\r\n * @param {number} roomHeight - Room height\r\n * @returns {Array} - Array of decoration objects to add to scene\r\n */\r\nexport function generateFloorDecorations(k, floor, roomWidth = 800, roomHeight = 600) {\r\n    const theme = getFloorTheme(floor);\r\n    const decorations = [];\r\n    const margin = 30; // Keep decorations away from edges\r\n\r\n    theme.decorations.forEach(deco => {\r\n        const baseColor = theme.baseColor;\r\n        const color = k.rgb(\r\n            baseColor[0] + (Math.random() - 0.5) * 20,\r\n            baseColor[1] + (Math.random() - 0.5) * 20,\r\n            baseColor[2] + (Math.random() - 0.5) * 20\r\n        );\r\n\r\n        switch (deco.pattern) {\r\n            case 'horizontal_lines': {\r\n                const spacing = deco.density === 'high' ? 40 : deco.density === 'medium' ? 80 : 120;\r\n                for (let y = margin; y < roomHeight - margin; y += spacing) {\r\n                    decorations.push({\r\n                        char: deco.char,\r\n                        x: roomWidth / 2,\r\n                        y: y + (Math.random() - 0.5) * 20,\r\n                        color: color,\r\n                        opacity: deco.opacity,\r\n                        size: 12\r\n                    });\r\n                }\r\n                break;\r\n            }\r\n            case 'vertical_lines': {\r\n                const spacing = deco.density === 'high' ? 40 : deco.density === 'medium' ? 80 : 120;\r\n                for (let x = margin; x < roomWidth - margin; x += spacing) {\r\n                    decorations.push({\r\n                        char: deco.char,\r\n                        x: x + (Math.random() - 0.5) * 20,\r\n                        y: roomHeight / 2,\r\n                        color: color,\r\n                        opacity: deco.opacity,\r\n                        size: 12\r\n                    });\r\n                }\r\n                break;\r\n            }\r\n            case 'wavy_lines': {\r\n                const spacing = 60;\r\n                for (let y = margin; y < roomHeight - margin; y += spacing) {\r\n                    for (let x = margin; x < roomWidth - margin; x += 40) {\r\n                        decorations.push({\r\n                            char: deco.char,\r\n                            x: x + Math.sin(y * 0.05) * 15,\r\n                            y: y,\r\n                            color: color,\r\n                            opacity: deco.opacity,\r\n                            size: 10\r\n                        });\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case 'grid': {\r\n                const spacing = deco.spacing || 80;\r\n                for (let y = margin; y < roomHeight - margin; y += spacing) {\r\n                    for (let x = margin; x < roomWidth - margin; x += spacing) {\r\n                        decorations.push({\r\n                            char: deco.char,\r\n                            x: x + (Math.random() - 0.5) * 10,\r\n                            y: y + (Math.random() - 0.5) * 10,\r\n                            color: color,\r\n                            opacity: deco.opacity,\r\n                            size: 14\r\n                        });\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case 'scattered': {\r\n                const count = deco.count || 5;\r\n                for (let i = 0; i < count; i++) {\r\n                    decorations.push({\r\n                        char: deco.char,\r\n                        x: margin + Math.random() * (roomWidth - margin * 2),\r\n                        y: margin + Math.random() * (roomHeight - margin * 2),\r\n                        color: color,\r\n                        opacity: deco.opacity,\r\n                        size: 16\r\n                    });\r\n                }\r\n                break;\r\n            }\r\n            case 'random': {\r\n                const count = deco.count || 10;\r\n                for (let i = 0; i < count; i++) {\r\n                    decorations.push({\r\n                        char: deco.char,\r\n                        x: margin + Math.random() * (roomWidth - margin * 2),\r\n                        y: margin + Math.random() * (roomHeight - margin * 2),\r\n                        color: color,\r\n                        opacity: deco.opacity,\r\n                        size: 10 + Math.random() * 6\r\n                    });\r\n                }\r\n                break;\r\n            }\r\n            case 'corners': {\r\n                const positions = [\r\n                    { x: margin + 40, y: margin + 40 },\r\n                    { x: roomWidth - margin - 40, y: margin + 40 },\r\n                    { x: margin + 40, y: roomHeight - margin - 40 },\r\n                    { x: roomWidth - margin - 40, y: roomHeight - margin - 40 }\r\n                ];\r\n                positions.forEach(pos => {\r\n                    decorations.push({\r\n                        char: deco.char,\r\n                        x: pos.x,\r\n                        y: pos.y,\r\n                        color: color,\r\n                        opacity: deco.opacity,\r\n                        size: 18\r\n                    });\r\n                });\r\n                break;\r\n            }\r\n            case 'edges': {\r\n                const count = deco.count || 8;\r\n                const perSide = Math.floor(count / 4);\r\n                // Top edge\r\n                for (let i = 0; i < perSide; i++) {\r\n                    decorations.push({\r\n                        char: deco.char,\r\n                        x: (roomWidth / perSide) * i + roomWidth / (perSide * 2),\r\n                        y: margin + 20,\r\n                        color: color,\r\n                        opacity: deco.opacity,\r\n                        size: 12\r\n                    });\r\n                }\r\n                // Bottom edge\r\n                for (let i = 0; i < perSide; i++) {\r\n                    decorations.push({\r\n                        char: deco.char,\r\n                        x: (roomWidth / perSide) * i + roomWidth / (perSide * 2),\r\n                        y: roomHeight - margin - 20,\r\n                        color: color,\r\n                        opacity: deco.opacity,\r\n                        size: 12\r\n                    });\r\n                }\r\n                // Left edge\r\n                for (let i = 0; i < perSide; i++) {\r\n                    decorations.push({\r\n                        char: deco.char,\r\n                        x: margin + 20,\r\n                        y: (roomHeight / perSide) * i + roomHeight / (perSide * 2),\r\n                        color: color,\r\n                        opacity: deco.opacity,\r\n                        size: 12\r\n                    });\r\n                }\r\n                // Right edge\r\n                for (let i = 0; i < perSide; i++) {\r\n                    decorations.push({\r\n                        char: deco.char,\r\n                        x: roomWidth - margin - 20,\r\n                        y: (roomHeight / perSide) * i + roomHeight / (perSide * 2),\r\n                        color: color,\r\n                        opacity: deco.opacity,\r\n                        size: 12\r\n                    });\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    });\r\n\r\n    return decorations;\r\n}\r\n\r\n/**\r\n * Render floor decorations in the game scene\r\n * @param {object} k - Kaplay instance\r\n * @param {number} floor - Current floor\r\n * @param {number} roomWidth - Room width\r\n * @param {number} roomHeight - Room height\r\n */\r\nexport function renderFloorDecorations(k, floor, roomWidth = 800, roomHeight = 600) {\r\n    const decorations = generateFloorDecorations(k, floor, roomWidth, roomHeight);\r\n\r\n    decorations.forEach(deco => {\r\n        k.add([\r\n            k.text(deco.char, { size: deco.size }),\r\n            k.pos(deco.x, deco.y),\r\n            k.color(deco.color),\r\n            k.opacity(deco.opacity),\r\n            k.z(0), // Behind everything else\r\n            'floorDecoration'\r\n        ]);\r\n    });\r\n}\r\n","/**\r\n * Game State Manager\r\n *\r\n * Centralized, serializable game state for single and multiplayer support.\r\n * All game state is stored here and can be synchronized across clients.\r\n *\r\n * Design Philosophy:\r\n * - Single source of truth\r\n * - Fully serializable (JSON.stringify-able)\r\n * - No KAPLAY objects in state (pure data only)\r\n * - Support for multiple players\r\n * - Deterministic updates\r\n */\r\n\r\nimport { PROGRESSION_CONFIG } from '../config/constants.js';\r\n\r\n/**\r\n * Player state for a single player\r\n */\r\nexport class PlayerState {\r\n    constructor(playerId, characterKey) {\r\n        this.playerId = playerId; // Unique player ID\r\n        this.characterKey = characterKey; // Character type key\r\n\r\n        // Position & movement\r\n        this.x = 400;\r\n        this.y = 300;\r\n        this.velocityX = 0;\r\n        this.velocityY = 0;\r\n\r\n        // Stats (will be initialized from character data)\r\n        this.health = 100;\r\n        this.maxHealth = 100;\r\n        this.speed = 150;\r\n\r\n        // Progression\r\n        this.level = PROGRESSION_CONFIG.STARTING_LEVEL;\r\n        this.xp = PROGRESSION_CONFIG.STARTING_XP;\r\n        this.xpToNext = PROGRESSION_CONFIG.BASE_XP_TO_NEXT_LEVEL;\r\n        this.xpMultiplier = 1.0;\r\n\r\n        // Weapon & Combat\r\n        this.weaponKey = 'pistol';\r\n        this.fireRate = 1.5;\r\n        this.projectileSpeed = 300;\r\n        this.projectileDamage = 10;\r\n        this.projectileCount = 1;\r\n        this.piercing = 0;\r\n        this.obstaclePiercing = 0;\r\n        this.critChance = 0.05;\r\n        this.critDamage = 2.0;\r\n        this.spreadAngle = 0;\r\n        this.weaponRange = 600;\r\n\r\n        // Passive stats\r\n        this.pickupRadius = 30;\r\n        this.defense = 0;\r\n        this.damageReduction = 0;\r\n        this.dodgeChance = 0;\r\n\r\n        // State flags\r\n        this.invulnerable = false;\r\n        this.invulnerableTime = 0;\r\n        this.slowed = false;\r\n        this.isDead = false;\r\n\r\n        // Upgrades\r\n        this.weapons = []; // Array of equipped weapon keys\r\n        this.passiveUpgrades = []; // Array of passive upgrade keys\r\n        this.upgradeStacks = {}; // { upgradeKey: count }\r\n\r\n        // Input state (for this player)\r\n        this.input = {\r\n            moveX: 0, // -1, 0, 1\r\n            moveY: 0, // -1, 0, 1\r\n            aimX: 0, // Mouse position X\r\n            aimY: 0, // Mouse position Y\r\n            firing: false\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Serialize player state to JSON\r\n     */\r\n    toJSON() {\r\n        return {\r\n            playerId: this.playerId,\r\n            characterKey: this.characterKey,\r\n            x: this.x,\r\n            y: this.y,\r\n            velocityX: this.velocityX,\r\n            velocityY: this.velocityY,\r\n            health: this.health,\r\n            maxHealth: this.maxHealth,\r\n            speed: this.speed,\r\n            level: this.level,\r\n            xp: this.xp,\r\n            xpToNext: this.xpToNext,\r\n            xpMultiplier: this.xpMultiplier,\r\n            weaponKey: this.weaponKey,\r\n            fireRate: this.fireRate,\r\n            projectileSpeed: this.projectileSpeed,\r\n            projectileDamage: this.projectileDamage,\r\n            projectileCount: this.projectileCount,\r\n            piercing: this.piercing,\r\n            obstaclePiercing: this.obstaclePiercing,\r\n            critChance: this.critChance,\r\n            critDamage: this.critDamage,\r\n            spreadAngle: this.spreadAngle,\r\n            weaponRange: this.weaponRange,\r\n            pickupRadius: this.pickupRadius,\r\n            defense: this.defense,\r\n            damageReduction: this.damageReduction,\r\n            dodgeChance: this.dodgeChance,\r\n            invulnerable: this.invulnerable,\r\n            invulnerableTime: this.invulnerableTime,\r\n            slowed: this.slowed,\r\n            isDead: this.isDead,\r\n            weapons: this.weapons,\r\n            passiveUpgrades: this.passiveUpgrades,\r\n            upgradeStacks: this.upgradeStacks\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create PlayerState from JSON\r\n     */\r\n    static fromJSON(json) {\r\n        const player = new PlayerState(json.playerId, json.characterKey);\r\n        Object.assign(player, json);\r\n        return player;\r\n    }\r\n}\r\n\r\n/**\r\n * Entity state (enemies, projectiles, pickups)\r\n */\r\nexport class EntityState {\r\n    constructor(id, type, x, y, data = {}) {\r\n        this.id = id; // Unique entity ID\r\n        this.type = type; // 'enemy', 'boss', 'miniboss', 'projectile', 'pickup', 'door', 'obstacle'\r\n        this.x = x;\r\n        this.y = y;\r\n        this.data = data; // Type-specific data\r\n        this.removed = false; // Mark for removal\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            id: this.id,\r\n            type: this.type,\r\n            x: this.x,\r\n            y: this.y,\r\n            data: this.data,\r\n            removed: this.removed\r\n        };\r\n    }\r\n\r\n    static fromJSON(json) {\r\n        return new EntityState(json.id, json.type, json.x, json.y, json.data);\r\n    }\r\n}\r\n\r\n/**\r\n * Main Game State\r\n * Contains all game state for single or multiplayer\r\n */\r\nexport class GameState {\r\n    constructor() {\r\n        // Game session info\r\n        this.sessionId = this.generateId();\r\n        this.gameMode = 'singleplayer'; // 'singleplayer' | 'coop'\r\n        this.isPaused = false;\r\n\r\n        // World state\r\n        this.currentFloor = 1;\r\n        this.currentRoom = 1;\r\n        this.roomCleared = false;\r\n        this.floorComplete = false;\r\n\r\n        // Players (supports 1-4 players)\r\n        this.players = new Map(); // playerId -> PlayerState\r\n        this.localPlayerId = null; // Which player is controlled locally\r\n\r\n        // Entities\r\n        this.entities = new Map(); // entityId -> EntityState\r\n        this.nextEntityId = 1;\r\n\r\n        // Room state\r\n        this.doors = []; // Door positions and states\r\n        this.obstacles = []; // Obstacle positions\r\n\r\n        // Meta progression (persistent across runs)\r\n        this.credits = 0;\r\n        this.totalCreditsEarned = 0;\r\n\r\n        // Game time\r\n        this.gameTime = 0; // Total game time in seconds\r\n        this.deltaTime = 0; // Time since last frame\r\n    }\r\n\r\n    /**\r\n     * Add a player to the game\r\n     */\r\n    addPlayer(playerId, characterKey) {\r\n        const player = new PlayerState(playerId, characterKey);\r\n        this.players.set(playerId, player);\r\n\r\n        // Set as local player if first player\r\n        if (this.localPlayerId === null) {\r\n            this.localPlayerId = playerId;\r\n        }\r\n\r\n        return player;\r\n    }\r\n\r\n    /**\r\n     * Get player by ID\r\n     */\r\n    getPlayer(playerId) {\r\n        return this.players.get(playerId);\r\n    }\r\n\r\n    /**\r\n     * Get local player (the player controlled by this client)\r\n     */\r\n    getLocalPlayer() {\r\n        return this.players.get(this.localPlayerId);\r\n    }\r\n\r\n    /**\r\n     * Get all players\r\n     */\r\n    getAllPlayers() {\r\n        return Array.from(this.players.values());\r\n    }\r\n\r\n    /**\r\n     * Add an entity to the game\r\n     */\r\n    addEntity(type, x, y, data = {}) {\r\n        const id = this.generateEntityId();\r\n        const entity = new EntityState(id, type, x, y, data);\r\n        this.entities.set(id, entity);\r\n        return entity;\r\n    }\r\n\r\n    /**\r\n     * Get entity by ID\r\n     */\r\n    getEntity(id) {\r\n        return this.entities.get(id);\r\n    }\r\n\r\n    /**\r\n     * Get all entities of a specific type\r\n     */\r\n    getEntitiesByType(type) {\r\n        return Array.from(this.entities.values()).filter(e => e.type === type && !e.removed);\r\n    }\r\n\r\n    /**\r\n     * Remove entity\r\n     */\r\n    removeEntity(id) {\r\n        const entity = this.entities.get(id);\r\n        if (entity) {\r\n            entity.removed = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clean up removed entities\r\n     */\r\n    cleanupRemovedEntities() {\r\n        for (const [id, entity] of this.entities.entries()) {\r\n            if (entity.removed) {\r\n                this.entities.delete(id);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update game time\r\n     */\r\n    updateTime(dt) {\r\n        this.deltaTime = dt;\r\n        this.gameTime += dt;\r\n    }\r\n\r\n    /**\r\n     * Progress to next room\r\n     */\r\n    nextRoom() {\r\n        this.currentRoom++;\r\n        this.roomCleared = false;\r\n    }\r\n\r\n    /**\r\n     * Progress to next floor\r\n     */\r\n    nextFloor() {\r\n        this.currentFloor++;\r\n        this.currentRoom = 1;\r\n        this.floorComplete = false;\r\n        this.roomCleared = false;\r\n    }\r\n\r\n    /**\r\n     * Mark current room as cleared\r\n     */\r\n    clearRoom() {\r\n        this.roomCleared = true;\r\n    }\r\n\r\n    /**\r\n     * Generate unique ID\r\n     */\r\n    generateId() {\r\n        return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    /**\r\n     * Generate unique entity ID\r\n     */\r\n    generateEntityId() {\r\n        return this.nextEntityId++;\r\n    }\r\n\r\n    /**\r\n     * Serialize entire game state to JSON\r\n     * This can be sent over network or saved to disk\r\n     */\r\n    toJSON() {\r\n        return {\r\n            sessionId: this.sessionId,\r\n            gameMode: this.gameMode,\r\n            isPaused: this.isPaused,\r\n            currentFloor: this.currentFloor,\r\n            currentRoom: this.currentRoom,\r\n            roomCleared: this.roomCleared,\r\n            players: Array.from(this.players.entries()).map(([id, player]) => [id, player.toJSON()]),\r\n            entities: Array.from(this.entities.entries()).map(([id, entity]) => [id, entity.toJSON()]),\r\n            doors: this.doors,\r\n            obstacles: this.obstacles,\r\n            gameTime: this.gameTime,\r\n            localPlayerId: this.localPlayerId,\r\n            nextEntityId: this.nextEntityId\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create GameState from JSON\r\n     * Used for loading saves or receiving state from server\r\n     */\r\n    static fromJSON(json) {\r\n        const state = new GameState();\r\n        state.sessionId = json.sessionId;\r\n        state.gameMode = json.gameMode;\r\n        state.isPaused = json.isPaused;\r\n        state.currentFloor = json.currentFloor;\r\n        state.currentRoom = json.currentRoom;\r\n        state.roomCleared = json.roomCleared;\r\n        state.gameTime = json.gameTime;\r\n        state.localPlayerId = json.localPlayerId;\r\n        state.nextEntityId = json.nextEntityId;\r\n\r\n        // Restore players\r\n        state.players = new Map(json.players.map(([id, playerJson]) =>\r\n            [id, PlayerState.fromJSON(playerJson)]\r\n        ));\r\n\r\n        // Restore entities\r\n        state.entities = new Map(json.entities.map(([id, entityJson]) =>\r\n            [id, EntityState.fromJSON(entityJson)]\r\n        ));\r\n\r\n        state.doors = json.doors;\r\n        state.obstacles = json.obstacles;\r\n\r\n        return state;\r\n    }\r\n\r\n    /**\r\n     * Create a snapshot of current state (for rollback/replay)\r\n     */\r\n    snapshot() {\r\n        return JSON.parse(JSON.stringify(this.toJSON()));\r\n    }\r\n\r\n    /**\r\n     * Reset state for new game\r\n     */\r\n    reset() {\r\n        this.currentFloor = 1;\r\n        this.currentRoom = 1;\r\n        this.roomCleared = false;\r\n        this.floorComplete = false;\r\n        this.players.clear();\r\n        this.entities.clear();\r\n        this.doors = [];\r\n        this.obstacles = [];\r\n        this.gameTime = 0;\r\n        this.nextEntityId = 1;\r\n    }\r\n}\r\n\r\n/**\r\n * Singleton State Manager\r\n * Provides global access to game state\r\n */\r\nclass StateManager {\r\n    constructor() {\r\n        this.gameState = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize new game state\r\n     */\r\n    init(gameMode = 'singleplayer') {\r\n        this.gameState = new GameState();\r\n        this.gameState.gameMode = gameMode;\r\n        return this.gameState;\r\n    }\r\n\r\n    /**\r\n     * Get current game state\r\n     */\r\n    getState() {\r\n        if (!this.gameState) {\r\n            throw new Error('GameState not initialized! Call StateManager.init() first.');\r\n        }\r\n        return this.gameState;\r\n    }\r\n\r\n    /**\r\n     * Load state from JSON\r\n     */\r\n    loadState(json) {\r\n        this.gameState = GameState.fromJSON(json);\r\n        return this.gameState;\r\n    }\r\n\r\n    /**\r\n     * Clear state\r\n     */\r\n    clear() {\r\n        this.gameState = null;\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const stateManager = new StateManager();\r\n","/**\r\n * Input Manager\r\n *\r\n * Handles input from local and remote players.\r\n * Decouples input collection from game logic for:\r\n * - Deterministic gameplay\r\n * - Multiplayer support\r\n * - Input recording/replay\r\n * - Client prediction\r\n *\r\n * Input Flow:\r\n * 1. Collect inputs from keyboard/mouse (local player)\r\n * 2. Queue inputs with timestamps\r\n * 3. Game logic processes inputs each frame\r\n * 4. (Future) Send local inputs to server, receive remote inputs\r\n */\r\n\r\n/**\r\n * Input state for a single player in a single frame\r\n */\r\nexport class PlayerInput {\r\n    constructor(playerId, frameNumber, timestamp) {\r\n        this.playerId = playerId;\r\n        this.frameNumber = frameNumber;\r\n        this.timestamp = timestamp;\r\n\r\n        // Movement input (-1, 0, 1 for each axis)\r\n        this.moveX = 0;\r\n        this.moveY = 0;\r\n\r\n        // Aim input (world coordinates)\r\n        this.aimX = 0;\r\n        this.aimY = 0;\r\n\r\n        // Action flags\r\n        this.firing = false;\r\n        this.pause = false;\r\n        this.interact = false; // For doors, chests, etc.\r\n    }\r\n\r\n    /**\r\n     * Serialize input to JSON\r\n     */\r\n    toJSON() {\r\n        return {\r\n            playerId: this.playerId,\r\n            frameNumber: this.frameNumber,\r\n            timestamp: this.timestamp,\r\n            moveX: this.moveX,\r\n            moveY: this.moveY,\r\n            aimX: this.aimX,\r\n            aimY: this.aimY,\r\n            firing: this.firing,\r\n            pause: this.pause,\r\n            interact: this.interact\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create PlayerInput from JSON\r\n     */\r\n    static fromJSON(json) {\r\n        const input = new PlayerInput(json.playerId, json.frameNumber, json.timestamp);\r\n        Object.assign(input, json);\r\n        return input;\r\n    }\r\n}\r\n\r\n/**\r\n * Input Manager\r\n * Collects and manages inputs from all players\r\n */\r\nexport class InputManager {\r\n    constructor() {\r\n        // Current frame number\r\n        this.frameNumber = 0;\r\n\r\n        // Input queues per player\r\n        this.inputQueues = new Map(); // playerId -> PlayerInput[]\r\n\r\n        // Current inputs for this frame (one per player)\r\n        this.currentInputs = new Map(); // playerId -> PlayerInput\r\n\r\n        // Input history for rollback (keep last N frames)\r\n        this.inputHistory = []; // Array of Map<playerId, PlayerInput>\r\n        this.maxHistoryFrames = 120; // Keep 2 seconds at 60fps\r\n\r\n        // Keyboard state tracking\r\n        this.keysPressed = new Set();\r\n\r\n        // Mouse state\r\n        this.mouseX = 0;\r\n        this.mouseY = 0;\r\n        this.mousePressed = false;\r\n\r\n        // Event handler references for cleanup (memory leak fix)\r\n        this.eventHandlers = [];\r\n    }\r\n\r\n    /**\r\n     * Initialize input manager with KAPLAY context\r\n     */\r\n    init(k) {\r\n        this.k = k;\r\n        this.setupKeyboardListeners();\r\n        this.setupMouseListeners();\r\n    }\r\n\r\n    /**\r\n     * Setup keyboard event listeners\r\n     */\r\n    setupKeyboardListeners() {\r\n        const k = this.k;\r\n\r\n        // Movement keys\r\n        const movementKeys = ['w', 'a', 's', 'd', 'up', 'down', 'left', 'right'];\r\n\r\n        movementKeys.forEach(key => {\r\n            this.eventHandlers.push(k.onKeyPress(key, () => {\r\n                this.keysPressed.add(key);\r\n            }));\r\n\r\n            this.eventHandlers.push(k.onKeyRelease(key, () => {\r\n                this.keysPressed.delete(key);\r\n            }));\r\n        });\r\n\r\n        // Pause\r\n        this.eventHandlers.push(k.onKeyPress('escape', () => {\r\n            this.onPausePressed();\r\n        }));\r\n\r\n        // Interact (for doors, etc.)\r\n        this.eventHandlers.push(k.onKeyPress('space', () => {\r\n            this.onInteractPressed();\r\n        }));\r\n        this.eventHandlers.push(k.onKeyPress('e', () => {\r\n            this.onInteractPressed();\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Setup mouse event listeners\r\n     */\r\n    setupMouseListeners() {\r\n        const k = this.k;\r\n\r\n        this.eventHandlers.push(k.onMouseMove((pos) => {\r\n            this.mouseX = pos.x;\r\n            this.mouseY = pos.y;\r\n        }));\r\n\r\n        this.eventHandlers.push(k.onMousePress(() => {\r\n            this.mousePressed = true;\r\n        }));\r\n\r\n        this.eventHandlers.push(k.onMouseRelease(() => {\r\n            this.mousePressed = false;\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Collect input for local player\r\n     */\r\n    collectLocalInput(playerId) {\r\n        const input = new PlayerInput(playerId, this.frameNumber, Date.now());\r\n\r\n        // Movement input\r\n        input.moveX = this.getMoveX();\r\n        input.moveY = this.getMoveY();\r\n\r\n        // Aim input\r\n        input.aimX = this.mouseX;\r\n        input.aimY = this.mouseY;\r\n\r\n        // Firing (for now, always fire if autofire)\r\n        // In the future, this could be mouse button\r\n        input.firing = true;\r\n\r\n        return input;\r\n    }\r\n\r\n    /**\r\n     * Get horizontal movement input (-1, 0, 1)\r\n     */\r\n    getMoveX() {\r\n        let moveX = 0;\r\n        if (this.keysPressed.has('a') || this.keysPressed.has('left')) {\r\n            moveX -= 1;\r\n        }\r\n        if (this.keysPressed.has('d') || this.keysPressed.has('right')) {\r\n            moveX += 1;\r\n        }\r\n        return moveX;\r\n    }\r\n\r\n    /**\r\n     * Get vertical movement input (-1, 0, 1)\r\n     */\r\n    getMoveY() {\r\n        let moveY = 0;\r\n        if (this.keysPressed.has('w') || this.keysPressed.has('up')) {\r\n            moveY -= 1;\r\n        }\r\n        if (this.keysPressed.has('s') || this.keysPressed.has('down')) {\r\n            moveY += 1;\r\n        }\r\n        return moveY;\r\n    }\r\n\r\n    /**\r\n     * Called when pause key is pressed\r\n     */\r\n    onPausePressed() {\r\n        // Handle pause in game logic\r\n        // For now, just set a flag\r\n        this.pauseRequested = true;\r\n    }\r\n\r\n    /**\r\n     * Called when interact key is pressed\r\n     */\r\n    onInteractPressed() {\r\n        this.interactRequested = true;\r\n    }\r\n\r\n    /**\r\n     * Queue input for a player\r\n     * Used for remote player inputs received from network\r\n     */\r\n    queueInput(input) {\r\n        if (!this.inputQueues.has(input.playerId)) {\r\n            this.inputQueues.set(input.playerId, []);\r\n        }\r\n        this.inputQueues.get(input.playerId).push(input);\r\n    }\r\n\r\n    /**\r\n     * Get inputs for all players for current frame\r\n     * This is called each game tick\r\n     */\r\n    getInputsForFrame(playerIds) {\r\n        const inputs = new Map();\r\n\r\n        for (const playerId of playerIds) {\r\n            // Check if we have queued input for this player\r\n            const queue = this.inputQueues.get(playerId);\r\n            let input;\r\n\r\n            if (queue && queue.length > 0) {\r\n                // Get next input from queue (for remote players)\r\n                input = queue.shift();\r\n            } else {\r\n                // Collect local input (for local player)\r\n                input = this.collectLocalInput(playerId);\r\n            }\r\n\r\n            inputs.set(playerId, input);\r\n        }\r\n\r\n        // Save current inputs\r\n        this.currentInputs = inputs;\r\n\r\n        // Add to history\r\n        this.inputHistory.push(new Map(inputs));\r\n        if (this.inputHistory.length > this.maxHistoryFrames) {\r\n            this.inputHistory.shift();\r\n        }\r\n\r\n        this.frameNumber++;\r\n\r\n        return inputs;\r\n    }\r\n\r\n    /**\r\n     * Get input for specific player in current frame\r\n     */\r\n    getPlayerInput(playerId) {\r\n        return this.currentInputs.get(playerId);\r\n    }\r\n\r\n    /**\r\n     * Get input history for rollback/replay\r\n     */\r\n    getInputHistory() {\r\n        return this.inputHistory;\r\n    }\r\n\r\n    /**\r\n     * Clear input state\r\n     */\r\n    clear() {\r\n        // Cancel all event handlers (memory leak fix)\r\n        this.eventHandlers.forEach(handler => {\r\n            if (handler && handler.cancel) {\r\n                handler.cancel();\r\n            }\r\n        });\r\n        this.eventHandlers = [];\r\n\r\n        this.frameNumber = 0;\r\n        this.inputQueues.clear();\r\n        this.currentInputs.clear();\r\n        this.inputHistory = [];\r\n        this.keysPressed.clear();\r\n        this.pauseRequested = false;\r\n        this.interactRequested = false;\r\n    }\r\n\r\n    /**\r\n     * Reset frame-specific flags\r\n     */\r\n    resetFrameFlags() {\r\n        this.pauseRequested = false;\r\n        this.interactRequested = false;\r\n    }\r\n}\r\n\r\n/**\r\n * Singleton Input Manager\r\n */\r\nclass InputManagerSingleton {\r\n    constructor() {\r\n        this.inputManager = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize input manager\r\n     */\r\n    init(k) {\r\n        this.inputManager = new InputManager();\r\n        this.inputManager.init(k);\r\n        return this.inputManager;\r\n    }\r\n\r\n    /**\r\n     * Get current input manager\r\n     */\r\n    getManager() {\r\n        if (!this.inputManager) {\r\n            throw new Error('InputManager not initialized! Call InputManager.init() first.');\r\n        }\r\n        return this.inputManager;\r\n    }\r\n\r\n    /**\r\n     * Clear input manager\r\n     */\r\n    clear() {\r\n        if (this.inputManager) {\r\n            this.inputManager.clear();\r\n        }\r\n        this.inputManager = null;\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const inputManager = new InputManagerSingleton();\r\n","/**\r\n * Network Manager\r\n *\r\n * Abstraction layer for multiplayer networking.\r\n * Currently a placeholder/interface for future implementation.\r\n *\r\n * Future implementations could use:\r\n * - WebRTC (peer-to-peer)\r\n * - WebSocket (client-server)\r\n * - Photon, Colyseus, or other game networking libraries\r\n *\r\n * For now, this provides the interface and defaults to local-only mode.\r\n */\r\n\r\n/**\r\n * Network message types\r\n */\r\nexport const MessageType = {\r\n    // Connection\r\n    CONNECT: 'connect',\r\n    DISCONNECT: 'disconnect',\r\n\r\n    // Game state\r\n    STATE_SYNC: 'state_sync',\r\n    STATE_UPDATE: 'state_update',\r\n\r\n    // Player input\r\n    INPUT: 'input',\r\n    INPUT_ACK: 'input_ack',\r\n\r\n    // Game events\r\n    PLAYER_JOINED: 'player_joined',\r\n    PLAYER_LEFT: 'player_left',\r\n    GAME_START: 'game_start',\r\n    GAME_END: 'game_end',\r\n\r\n    // Chat (future)\r\n    CHAT_MESSAGE: 'chat_message'\r\n};\r\n\r\n/**\r\n * Network message\r\n */\r\nexport class NetworkMessage {\r\n    constructor(type, data, senderId = null) {\r\n        this.type = type;\r\n        this.data = data;\r\n        this.senderId = senderId;\r\n        this.timestamp = Date.now();\r\n    }\r\n\r\n    toJSON() {\r\n        return {\r\n            type: this.type,\r\n            data: this.data,\r\n            senderId: this.senderId,\r\n            timestamp: this.timestamp\r\n        };\r\n    }\r\n\r\n    static fromJSON(json) {\r\n        const msg = new NetworkMessage(json.type, json.data, json.senderId);\r\n        msg.timestamp = json.timestamp;\r\n        return msg;\r\n    }\r\n}\r\n\r\n/**\r\n * Network Manager\r\n * Handles all network communication for multiplayer\r\n */\r\nexport class NetworkManager {\r\n    constructor() {\r\n        // Connection state\r\n        this.isConnected = false;\r\n        this.isHost = false;\r\n        this.localPlayerId = null;\r\n        this.sessionId = null;\r\n\r\n        // Connected players\r\n        this.players = new Map(); // playerId -> playerInfo\r\n\r\n        // Message queue\r\n        this.messageQueue = [];\r\n\r\n        // Event handlers\r\n        this.eventHandlers = new Map();\r\n\r\n        // Network mode\r\n        this.mode = 'local'; // 'local' | 'client' | 'host'\r\n    }\r\n\r\n    /**\r\n     * Initialize network manager\r\n     */\r\n    init(mode = 'local') {\r\n        this.mode = mode;\r\n        this.localPlayerId = this.generatePlayerId();\r\n\r\n        // For local mode, immediately \"connect\"\r\n        if (mode === 'local') {\r\n            this.isConnected = true;\r\n            this.isHost = true;\r\n            this.sessionId = this.generateSessionId();\r\n            this.addPlayer(this.localPlayerId, { name: 'Player 1', isLocal: true });\r\n        }\r\n\r\n        return this.localPlayerId;\r\n    }\r\n\r\n    /**\r\n     * Connect to a game session\r\n     * Future: Implement actual WebRTC/WebSocket connection\r\n     */\r\n    async connect(sessionId = null) {\r\n        if (this.mode === 'local') {\r\n            // Already connected in local mode\r\n            return true;\r\n        }\r\n\r\n        // TODO: Implement actual network connection\r\n        // For now, just simulate connection\r\n        this.isConnected = true;\r\n        this.sessionId = sessionId || this.generateSessionId();\r\n\r\n        this.emit('connected', { sessionId: this.sessionId });\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Disconnect from game session\r\n     */\r\n    disconnect() {\r\n        if (this.isConnected) {\r\n            this.emit('disconnected');\r\n\r\n            // TODO: Close actual network connection\r\n\r\n            this.isConnected = false;\r\n            this.players.clear();\r\n            this.messageQueue = [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send message to remote players\r\n     * Future: Implement actual network send\r\n     */\r\n    send(type, data) {\r\n        const message = new NetworkMessage(type, data, this.localPlayerId);\r\n\r\n        if (this.mode === 'local') {\r\n            // In local mode, no need to send anywhere\r\n            return;\r\n        }\r\n\r\n        // TODO: Implement actual network send\r\n        // For now, just log\r\n        console.log('[Network] Send:', message);\r\n\r\n        // Simulate message send\r\n        this.messageQueue.push(message);\r\n    }\r\n\r\n    /**\r\n     * Broadcast message to all players\r\n     */\r\n    broadcast(type, data) {\r\n        this.send(type, data);\r\n    }\r\n\r\n    /**\r\n     * Send message to specific player\r\n     */\r\n    sendTo(playerId, type, data) {\r\n        const message = new NetworkMessage(type, data, this.localPlayerId);\r\n        // TODO: Implement targeted send\r\n        console.log(`[Network] SendTo ${playerId}:`, message);\r\n    }\r\n\r\n    /**\r\n     * Receive and process messages\r\n     * Called each frame to process incoming messages\r\n     */\r\n    receive() {\r\n        const messages = [...this.messageQueue];\r\n        this.messageQueue = [];\r\n\r\n        for (const message of messages) {\r\n            this.handleMessage(message);\r\n        }\r\n\r\n        return messages;\r\n    }\r\n\r\n    /**\r\n     * Handle incoming message\r\n     */\r\n    handleMessage(message) {\r\n        // Emit event for message type\r\n        this.emit(message.type, message.data, message.senderId);\r\n\r\n        // Handle specific message types\r\n        switch (message.type) {\r\n            case MessageType.PLAYER_JOINED:\r\n                this.addPlayer(message.senderId, message.data);\r\n                break;\r\n            case MessageType.PLAYER_LEFT:\r\n                this.removePlayer(message.senderId);\r\n                break;\r\n            // Add more handlers as needed\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add player to session\r\n     */\r\n    addPlayer(playerId, playerInfo) {\r\n        this.players.set(playerId, {\r\n            id: playerId,\r\n            ...playerInfo,\r\n            joinedAt: Date.now()\r\n        });\r\n\r\n        this.emit('playerJoined', { playerId, playerInfo });\r\n    }\r\n\r\n    /**\r\n     * Remove player from session\r\n     */\r\n    removePlayer(playerId) {\r\n        const playerInfo = this.players.get(playerId);\r\n        this.players.delete(playerId);\r\n\r\n        this.emit('playerLeft', { playerId, playerInfo });\r\n    }\r\n\r\n    /**\r\n     * Get all connected players\r\n     */\r\n    getPlayers() {\r\n        return Array.from(this.players.values());\r\n    }\r\n\r\n    /**\r\n     * Check if player is connected\r\n     */\r\n    isPlayerConnected(playerId) {\r\n        return this.players.has(playerId);\r\n    }\r\n\r\n    /**\r\n     * Register event handler\r\n     */\r\n    on(eventType, handler) {\r\n        if (!this.eventHandlers.has(eventType)) {\r\n            this.eventHandlers.set(eventType, []);\r\n        }\r\n        this.eventHandlers.get(eventType).push(handler);\r\n    }\r\n\r\n    /**\r\n     * Unregister event handler\r\n     */\r\n    off(eventType, handler) {\r\n        if (this.eventHandlers.has(eventType)) {\r\n            const handlers = this.eventHandlers.get(eventType);\r\n            const index = handlers.indexOf(handler);\r\n            if (index > -1) {\r\n                handlers.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Emit event\r\n     */\r\n    emit(eventType, data, senderId = null) {\r\n        if (this.eventHandlers.has(eventType)) {\r\n            const handlers = this.eventHandlers.get(eventType);\r\n            for (const handler of handlers) {\r\n                handler(data, senderId);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generate unique player ID\r\n     */\r\n    generatePlayerId() {\r\n        return `player-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    /**\r\n     * Generate unique session ID\r\n     */\r\n    generateSessionId() {\r\n        return `session-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n    }\r\n\r\n    /**\r\n     * Get latency/ping (future)\r\n     */\r\n    getPing() {\r\n        return 0; // Local mode has no latency\r\n    }\r\n\r\n    /**\r\n     * Check if this client is the host\r\n     */\r\n    isHostClient() {\r\n        return this.isHost;\r\n    }\r\n\r\n    /**\r\n     * Get local player ID\r\n     */\r\n    getLocalPlayerId() {\r\n        return this.localPlayerId;\r\n    }\r\n\r\n    /**\r\n     * Clear network state\r\n     */\r\n    clear() {\r\n        this.disconnect();\r\n        this.eventHandlers.clear();\r\n    }\r\n}\r\n\r\n/**\r\n * Singleton Network Manager\r\n */\r\nclass NetworkManagerSingleton {\r\n    constructor() {\r\n        this.networkManager = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize network manager\r\n     */\r\n    init(mode = 'local') {\r\n        this.networkManager = new NetworkManager();\r\n        return this.networkManager.init(mode);\r\n    }\r\n\r\n    /**\r\n     * Get current network manager\r\n     */\r\n    getManager() {\r\n        if (!this.networkManager) {\r\n            throw new Error('NetworkManager not initialized! Call NetworkManager.init() first.');\r\n        }\r\n        return this.networkManager;\r\n    }\r\n\r\n    /**\r\n     * Clear network manager\r\n     */\r\n    clear() {\r\n        if (this.networkManager) {\r\n            this.networkManager.clear();\r\n        }\r\n        this.networkManager = null;\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const networkManager = new NetworkManagerSingleton();\r\n","/**\r\n * Main Game Scene\r\n *\r\n * Handles the core gameplay loop including:\r\n * - Room generation and progression\r\n * - Enemy spawning and combat\r\n * - Boss encounters\r\n * - Player state management\r\n * - HUD and UI rendering\r\n *\r\n * Architecture:\r\n * - NEW: Integrates with centralized GameState for multiplayer support\r\n * - LEGACY: Maintains backward compatibility with existing systems\r\n */\r\n\r\n// Entity imports\r\nimport { createPlayer } from '../entities/player.js';\r\nimport { createEnemy } from '../entities/enemy.js';\r\nimport { createBoss, createTwinGuardians } from '../entities/boss.js';\r\nimport { createMiniboss } from '../entities/miniboss.js';\r\nimport { createXPPickup, createCurrencyPickup, getRandomCurrencyIcon, createPowerupWeaponPickup } from '../entities/pickup.js';\r\nimport { createDoor } from '../entities/door.js';\r\nimport { createObstacle } from '../entities/obstacle.js';\r\nimport { createProjectile } from '../entities/projectile.js';\r\nimport { createBarrel, clearAllBarrels, handleProjectileBarrelCollision, findBarrelByPosition, getAllBarrels } from '../entities/barrel.js';\r\n\r\n// System imports\r\nimport { SpatialGrid } from '../systems/spatialGrid.js';\r\nimport { initObjectPools, clearAllPools } from '../systems/objectPool.js';\r\nimport { setupCombatSystem } from '../systems/combat.js';\r\nimport { setupProgressionSystem } from '../systems/progression.js';\r\nimport { getRandomEnemyType } from '../systems/enemySpawn.js';\r\nimport { tryMakeElite } from '../systems/eliteSystem.js';\r\nimport { showMovementHint, showLevelUpHint } from '../systems/tutorial.js';\r\nimport { SeededRandom } from '../utils/seededRandom.js';\r\nimport { getWeightedRoomTemplate, getFloorColors, constrainObstacleToRoom, resetRoomTemplateHistory, getRoomTemplateByKey, getBarrelPositions } from '../systems/roomGeneration.js';\r\nimport { checkAndApplySynergies, trackUpgrade, reapplySynergies } from '../systems/synergies.js';\r\nimport { UPGRADES, recalculateAllUpgrades, applyUpgrade } from '../systems/upgrades.js';\r\nimport { updateRunStats, calculateCurrencyEarned, addCurrency, getCurrency, getPermanentUpgradeLevel, checkFloorUnlocks, recordRun, consumeBoosters, getEquippedCosmetics } from '../systems/metaProgression.js';\r\nimport { RUN_BOOSTER_UNLOCKS, COSMETIC_UNLOCKS } from '../data/unlocks.js';\r\nimport { checkAchievements, initAchievementChecker } from '../systems/achievementChecker.js';\r\nimport { isUpgradeDraftActive, showUpgradeDraft } from './upgradeDraft.js';\r\nimport { updateParticles, spawnBloodSplatter, spawnHitImpact, spawnDeathExplosion, spawnTrailParticle, createGlowEffect, updateGlowEffect, spawnCosmeticDeath } from '../systems/particleSystem.js';\r\nimport { playXPPickup, playCurrencyPickup, playDoorOpen, playBossSpawn, playBossDeath, playEnemyDeath, playPause, playUnpause, initAudio, playCombatMusic } from '../systems/sounds.js';\r\nimport { initVisualEffects, updateScreenShake, resetVisualEffects, EffectPresets, isInHitFreeze } from '../systems/visualEffects.js';\r\nimport { generateFloorMap } from '../systems/floorMap.js';\r\nimport { createMinimap } from '../systems/minimap.js';\r\nimport { renderFloorDecorations, getFloorTheme } from '../systems/floorTheming.js';\r\nimport { POWERUP_WEAPONS, rollPowerupDrop, applyPowerupWeapon, getPowerupDisplay, updatePowerupWeapon, restoreOriginalWeapon } from '../systems/powerupWeapons.js';\r\nimport { getParty, getPartySize } from '../systems/partySystem.js';\r\nimport { initMultiplayerGame, registerPlayer, registerEnemy, updateMultiplayer, isMultiplayerActive, cleanupMultiplayer, getPlayerCount, getRoomRNG, getFloorRNG, setCurrentFloor, setCurrentRoom, broadcastGameSeed, isHost, broadcastPauseState, sendPauseRequest, broadcastDeathEvent, broadcastRoomCompletion, broadcastGameOver, broadcastXPGain, broadcastCurrencyGain, broadcastPlayerDeath, broadcastRoomTransition, sendEnemyDeath, broadcastPowerupWeaponApplied, broadcastLevelUpQueued, broadcastHostQuit, getAndClearPendingXP, broadcastEmote, getFirstRoomTemplateKey, hasGameSeed, onGameSeedReceived, broadcastObstacles, broadcastHealEvent, broadcastRevivalEvent } from '../systems/multiplayerGame.js';\r\nimport { onMessage, offMessage, getNetworkInfo, broadcast } from '../systems/networkSystem.js';\r\nimport { initInputSystem, initTouchControls } from '../systems/inputSystem.js';\r\n\r\n// Data imports\r\nimport { BOSS_TYPES, getBossDefinition } from '../data/bosses.js';\r\nimport { MINIBOSS_TYPES, getMinibossDefinition } from '../data/minibosses.js';\r\n\r\n// Config imports\r\nimport { PICKUP_CONFIG } from '../config/constants.js';\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS,\r\n    UI_TERMS,\r\n    formatHealth,\r\n    formatXP,\r\n    formatFloorRoom\r\n} from '../config/uiConfig.js';\r\n\r\n// NEW ARCHITECTURE: Core systems for multiplayer support\r\nimport { stateManager } from '../core/GameState.js';\r\nimport { inputManager } from '../core/InputManager.js';\r\nimport { networkManager } from '../core/NetworkManager.js';\r\n\r\n// Game state (persists across scene reloads)\r\nlet gameState = {\r\n    currentFloor: 1,\r\n    currentRoom: 1,\r\n    playerStats: null, // Store player stats between rooms\r\n    entryDirection: null, // Direction player entered from (opposite of exit direction)\r\n    floorMap: null, // NEW: Floor map grid system\r\n    minimap: null, // NEW: Minimap UI instance\r\n    rerollsRemaining: 0, // Per-run rerolls from Mulligan upgrade\r\n    playersRevivedThisRun: new Set(), // Track which players have been revived (one revival per player per run)\r\n    // Daily run state\r\n    isDailyRun: false,\r\n    dailyCharacter: null,\r\n    dailySeed: null,\r\n    dailyRNG: null // Seeded RNG for daily run\r\n};\r\n\r\n// Run statistics (reset on new game)\r\nlet runStats = {\r\n    floorsReached: 1,\r\n    roomsCleared: 0,\r\n    enemiesKilled: 0,\r\n    bossesKilled: 0\r\n};\r\n\r\n// Flag to prevent duplicate client message handler registration (memory leak fix)\r\nlet gameSceneMessageHandlersRegistered = false;\r\n\r\n// Apply permanent upgrades to player\r\n// If upgradeLevels is provided, use those; otherwise use local storage (for local player)\r\nfunction applyPermanentUpgrades(k, player, upgradeLevels = null) {\r\n    // For remote players (upgradeLevels provided), use 0 as fallback to avoid using wrong player's data\r\n    // For local player (upgradeLevels null), read from local storage\r\n    const useLocalStorage = upgradeLevels === null;\r\n\r\n    // Apply starting health upgrades\r\n    const healthLevel = useLocalStorage\r\n        ? getPermanentUpgradeLevel('startingHealth')\r\n        : (upgradeLevels?.startingHealth || 0);\r\n    if (healthLevel > 0) {\r\n        player.maxHealth += healthLevel * 10;\r\n        player.setHP(player.maxHealth); // Full health\r\n    }\r\n\r\n    // Apply starting damage upgrades\r\n    const damageLevel = useLocalStorage\r\n        ? getPermanentUpgradeLevel('startingDamage')\r\n        : (upgradeLevels?.startingDamage || 0);\r\n    if (damageLevel > 0) {\r\n        player.projectileDamage += damageLevel;\r\n    }\r\n\r\n    // Apply starting speed upgrades\r\n    const speedLevel = useLocalStorage\r\n        ? getPermanentUpgradeLevel('startingSpeed')\r\n        : (upgradeLevels?.startingSpeed || 0);\r\n    if (speedLevel > 0) {\r\n        player.speed += speedLevel * 10;\r\n    }\r\n}\r\n\r\n/**\r\n * Apply purchased run boosters to player at game start\r\n * Boosters are consumed when the run starts\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} player - Player entity\r\n * @param {Object} gameState - Game state to track active booster effects\r\n */\r\nfunction applyRunBoosters(k, player, gameState) {\r\n    // Consume all purchased boosters\r\n    const boosters = consumeBoosters();\r\n    if (boosters.length === 0) return;\r\n\r\n    // Initialize booster tracking\r\n    gameState.activeBoosters = [];\r\n    gameState.creditMultiplier = 1.0;\r\n\r\n    boosters.forEach(booster => {\r\n        const boosterDef = RUN_BOOSTER_UNLOCKS[booster.key];\r\n        if (!boosterDef || !boosterDef.effect) return;\r\n\r\n        const effect = boosterDef.effect;\r\n\r\n        switch (effect.type) {\r\n            case 'startingHealth':\r\n                // Health Pack: Add bonus HP\r\n                player.maxHealth += effect.value;\r\n                player.setHP(player.hp() + effect.value);\r\n                break;\r\n\r\n            case 'tempDamage':\r\n                // Damage Amp: +X% damage for first floor\r\n                player.projectileDamage = Math.floor(player.projectileDamage * (1 + effect.value));\r\n                gameState.activeBoosters.push({ type: 'tempDamage', value: effect.value, duration: effect.duration });\r\n                break;\r\n\r\n            case 'tempSpeed':\r\n                // Speed Serum: +X% speed for first floor\r\n                player.speed = Math.floor(player.speed * (1 + effect.value));\r\n                player.originalSpeed = player.speed;\r\n                gameState.activeBoosters.push({ type: 'tempSpeed', value: effect.value, duration: effect.duration });\r\n                break;\r\n\r\n            case 'creditMultiplier':\r\n                // Wealth Charm: +X% credits for run\r\n                gameState.creditMultiplier = (gameState.creditMultiplier || 1) + effect.value;\r\n                break;\r\n\r\n            case 'tempCrit':\r\n                // Lucky Coin: +X% crit chance for first floor\r\n                player.critChance = (player.critChance || 0) + effect.value;\r\n                gameState.activeBoosters.push({ type: 'tempCrit', value: effect.value, duration: effect.duration });\r\n                break;\r\n\r\n            case 'tempDefense':\r\n                // Armor Plating: +X% damage reduction for first floor\r\n                player.damageReduction = (player.damageReduction || 0) + effect.value;\r\n                gameState.activeBoosters.push({ type: 'tempDefense', value: effect.value, duration: effect.duration });\r\n                break;\r\n\r\n            case 'tempXP':\r\n                // XP Booster: +X% XP for first floor\r\n                player.xpMultiplier = (player.xpMultiplier || 1) * (1 + effect.value);\r\n                gameState.activeBoosters.push({ type: 'tempXP', value: effect.value, duration: effect.duration });\r\n                break;\r\n\r\n            case 'autoRevive':\r\n                // Emergency Revive: Auto-revive once at X% HP\r\n                player.autoRevive = { health: effect.value, uses: effect.uses };\r\n                break;\r\n        }\r\n    });\r\n\r\n    // Show notification if boosters were applied\r\n    if (boosters.length > 0) {\r\n        const boosterText = k.add([\r\n            k.text(`${boosters.length} Booster${boosters.length > 1 ? 's' : ''} Active!`, { size: 18 }),\r\n            k.pos(k.width() / 2, 100),\r\n            k.anchor('center'),\r\n            k.color(100, 255, 150),\r\n            k.fixed(),\r\n            k.z(2000),\r\n            k.opacity(1)\r\n        ]);\r\n\r\n        // Fade out after 2 seconds\r\n        k.wait(2, () => {\r\n            if (boosterText.exists()) {\r\n                k.tween(boosterText.opacity, 0, 0.5, (val) => boosterText.opacity = val, k.easings.easeOutQuad).onEnd(() => {\r\n                    if (boosterText.exists()) k.destroy(boosterText);\r\n                });\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport function setupGameScene(k) {\r\n    k.scene('game', (args) => {\r\n        // Start combat music\r\n        playCombatMusic();\r\n\r\n        // ==========================================\r\n        // NEW ARCHITECTURE INITIALIZATION\r\n        // ==========================================\r\n\r\n        // Initialize new systems on first run or reset\r\n        if (args?.resetState) {\r\n            // Initialize network manager (local mode by default)\r\n            const playerId = networkManager.init('local');\r\n\r\n            // Initialize input manager\r\n            inputManager.init(k);\r\n\r\n            // Initialize game state\r\n            const state = stateManager.init('singleplayer');\r\n\r\n            // Add local player to state\r\n            // TODO: Get selected character from menu\r\n            const characterKey = 'survivor'; // Default for now\r\n            state.addPlayer(playerId, characterKey);\r\n        }\r\n\r\n        // Get current game state (for both new and continuing games)\r\n        const state = stateManager.getState();\r\n\r\n        // ==========================================\r\n        // GAMEPAD & TOUCH CONTROLS\r\n        // ==========================================\r\n        // Initialize gamepad polling and touch controls for mobile/controller support\r\n        initInputSystem(k);\r\n        initTouchControls(k);\r\n\r\n        // ==========================================\r\n        // LEGACY STATE (keeping for now)\r\n        // ==========================================\r\n\r\n        // Clear barrels from previous room/run\r\n        clearAllBarrels();\r\n\r\n        // Always ensure game starts unpaused (fixes freeze when quitting from pause menu)\r\n        k.paused = false;\r\n\r\n        // Reset game state on new game (when coming from menu)\r\n        if (args?.resetState) {\r\n            gameState.currentFloor = 1;\r\n            gameState.currentRoom = 1;\r\n            gameState.playerStats = null;\r\n            gameState.allPlayerStats = null; // Clear multiplayer stats\r\n            gameState.entryDirection = null;\r\n            gameState.floorMap = null; // Clear old floor map\r\n            gameState.playersRevivedThisRun = new Set(); // Reset revival tracking\r\n            resetRoomTemplateHistory(); // Reset room template variation\r\n\r\n            // Handle daily run state\r\n            gameState.isDailyRun = args?.isDailyRun || false;\r\n            gameState.dailyCharacter = args?.dailyCharacter || null;\r\n            gameState.dailySeed = args?.dailySeed || null;\r\n            gameState.dailyRNG = gameState.isDailyRun && gameState.dailySeed\r\n                ? new SeededRandom(gameState.dailySeed)\r\n                : null;\r\n\r\n            if (gameState.isDailyRun) {\r\n                console.log('[DailyRun] Starting daily run with character:', gameState.dailyCharacter, 'seed:', gameState.dailySeed);\r\n            }\r\n\r\n            // Reset run statistics\r\n            runStats = {\r\n                floorsReached: 1,\r\n                roomsCleared: 0,\r\n                enemiesKilled: 0,\r\n                bossesKilled: 0,\r\n                killsByType: {},\r\n                startTime: Date.now() // Track run start time\r\n            };\r\n\r\n            // Initialize achievement checker for new run (clears previous run's achievements)\r\n            initAchievementChecker(k);\r\n\r\n            // Initialize per-run rerolls from Mulligan permanent upgrade\r\n            const mulliganLevel = getPermanentUpgradeLevel('mulligan');\r\n            gameState.rerollsRemaining = mulliganLevel;\r\n            // Reset client message handler registration flag (allows re-registration on new game)\r\n            gameSceneMessageHandlersRegistered = false;\r\n\r\n            // Show tutorial movement hint for new players\r\n            k.wait(1.0, () => showMovementHint(k));\r\n            // Reset weapon detail saved state\r\n            if (k.gameData) {\r\n                k.gameData.weaponDetailSavedState = undefined;\r\n            }\r\n        }\r\n\r\n        // Use persistent game state\r\n        let currentFloor = gameState.currentFloor;\r\n        let currentRoom = gameState.currentRoom;\r\n\r\n        // Track event handlers for cleanup (memory leak fix)\r\n        const eventHandlers = {\r\n            updates: [],\r\n            keyPresses: []\r\n        };\r\n\r\n        // Flag to prevent duplicate door transitions (used in message handler and update loop)\r\n        let doorEntered = false;\r\n\r\n        // Room state variables (declared early for use in onMessage callbacks)\r\n        let roomCompleted = false;\r\n        const spawnDoors = [];\r\n        let reviveAllPlayers = null; // Function defined later, but declared early for callbacks\r\n\r\n        // Initialize spatial grids for performance optimization (see src/systems/spatialGrid.js)\r\n        const spatialGrids = {\r\n            enemies: new SpatialGrid(128),    // Grid for enemies, bosses, minibosses\r\n            obstacles: new SpatialGrid(128),  // Grid for obstacles (walls, decorations)\r\n            pickups: new SpatialGrid(128)     // Grid for pickups (XP, currency, powerups)\r\n        };\r\n\r\n        // Initialize visual effects system\r\n        initVisualEffects(k);\r\n        resetVisualEffects();\r\n\r\n        // Get party size early for multiplayer checks throughout the scene\r\n        const partySize = getPartySize();\r\n\r\n        // Helper function to get seeded RNG for the current room\r\n        // Priority: daily run > multiplayer > random (for single player consistency)\r\n        function getSeededRoomRNG() {\r\n            if (gameState.isDailyRun && gameState.dailySeed) {\r\n                // Create room-specific seed for daily runs\r\n                const roomSeed = gameState.dailySeed + currentFloor * 10000 + currentRoom * 100;\r\n                return new SeededRandom(roomSeed);\r\n            } else if (partySize > 1) {\r\n                return getRoomRNG();\r\n            }\r\n            return null; // Single player non-daily: use Math.random()\r\n        }\r\n\r\n        // Helper function to generate floor map and minimap\r\n        const generateFloorMapAndMinimap = () => {\r\n            // Set current floor for seeded RNG in multiplayer\r\n            if (partySize > 1) {\r\n                setCurrentFloor(currentFloor);\r\n                console.log('[Multiplayer] Generating floor map with seed:', hasGameSeed() ? 'valid' : 'invalid (0)');\r\n            }\r\n\r\n            // Use seeded RNG for multiplayer to ensure same floor layout on all clients\r\n            const floorRng = partySize > 1 ? getFloorRNG() : null;\r\n            gameState.floorMap = generateFloorMap(currentFloor, floorRng);\r\n\r\n            // Destroy old minimap if it exists\r\n            if (gameState.minimap) {\r\n                gameState.minimap.destroy();\r\n            }\r\n\r\n            // Create new minimap\r\n            gameState.minimap = createMinimap(k, gameState.floorMap);\r\n            // Update k.gameData reference\r\n            if (k.gameData) {\r\n                k.gameData.minimap = gameState.minimap;\r\n            }\r\n        };\r\n\r\n        // Generate floor map if starting new floor or no map exists\r\n        // For multiplayer clients, this will be regenerated when game_seed arrives\r\n        if (!gameState.floorMap || gameState.floorMap.floor !== currentFloor) {\r\n            // For single player or if we're host, generate immediately\r\n            // For clients, generate with placeholder (will be regenerated when seed arrives)\r\n            generateFloorMapAndMinimap();\r\n        } else {\r\n            // Update minimap if it exists\r\n            if (gameState.minimap) {\r\n                gameState.minimap.update();\r\n            }\r\n        }\r\n        \r\n        // Update run stats for floors reached\r\n        if (currentFloor > runStats.floorsReached) {\r\n            runStats.floorsReached = currentFloor;\r\n        }\r\n\r\n        // Floor names (TV station tiers)\r\n        const floorNames = {\r\n            1: 'Public Access',\r\n            2: 'Local Affiliate',\r\n            3: 'Cable Network',\r\n            4: 'Premium Channel',\r\n            5: 'Streaming Giant',\r\n            6: 'Global Broadcast',\r\n            7: 'Galactic Signal'\r\n        };\r\n        const getFloorName = (floor) => floorNames[floor] || `Network ${floor}`;\r\n\r\n        // Show floor title when entering a new floor (room 1)\r\n        if (currentRoom === 1) {\r\n            const floorTitle = k.add([\r\n                k.text(`Floor ${currentFloor}`, { size: 32 }),\r\n                k.pos(k.width() / 2, k.height() / 3),\r\n                k.anchor('center'),\r\n                k.color(255, 255, 255),\r\n                k.opacity(1),\r\n                k.fixed(),\r\n                k.z(3000)\r\n            ]);\r\n\r\n            const floorSubtitle = k.add([\r\n                k.text(getFloorName(currentFloor), { size: 20 }),\r\n                k.pos(k.width() / 2, k.height() / 3 + 40),\r\n                k.anchor('center'),\r\n                k.color(200, 200, 255),\r\n                k.opacity(1),\r\n                k.fixed(),\r\n                k.z(3000)\r\n            ]);\r\n\r\n            // Fade out after delay\r\n            k.wait(2, () => {\r\n                if (floorTitle.exists()) {\r\n                    floorTitle.onUpdate(() => {\r\n                        floorTitle.opacity -= 0.02;\r\n                        if (floorTitle.opacity <= 0) k.destroy(floorTitle);\r\n                    });\r\n                }\r\n                if (floorSubtitle.exists()) {\r\n                    floorSubtitle.onUpdate(() => {\r\n                        floorSubtitle.opacity -= 0.02;\r\n                        if (floorSubtitle.opacity <= 0) k.destroy(floorSubtitle);\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        // Calculate player spawn position based on entry direction\r\n        // If entering from a door, spawn at that door position\r\n        // Otherwise (new game), spawn at center\r\n        const doorMargin = 30;\r\n        let playerSpawnX = k.width() / 2;\r\n        let playerSpawnY = k.height() / 2;\r\n        \r\n        if (gameState.entryDirection) {\r\n            // Spawn player at the door they entered from\r\n            switch (gameState.entryDirection) {\r\n                case 'north':\r\n                    playerSpawnX = k.width() / 2;\r\n                    playerSpawnY = doorMargin;\r\n                    break;\r\n                case 'south':\r\n                    playerSpawnX = k.width() / 2;\r\n                    playerSpawnY = k.height() - doorMargin;\r\n                    break;\r\n                case 'west':\r\n                    playerSpawnX = doorMargin;\r\n                    playerSpawnY = k.height() / 2;\r\n                    break;\r\n                case 'east':\r\n                    playerSpawnX = k.width() - doorMargin;\r\n                    playerSpawnY = k.height() / 2;\r\n                    break;\r\n            }\r\n        }\r\n        \r\n        // Create player\r\n        let player;\r\n        // For daily runs, always use the daily character (even on room transitions)\r\n        const characterOverride = gameState.isDailyRun ? gameState.dailyCharacter : null;\r\n        if (gameState.playerStats) {\r\n            // Restore player with previous stats\r\n            player = createPlayer(k, playerSpawnX, playerSpawnY, characterOverride);\r\n            // Restore stats\r\n            Object.assign(player, gameState.playerStats);\r\n            // CRITICAL: Local player is NEVER remote - host's saved stats may have isRemote: true\r\n            const wasRemote = player.isRemote;\r\n            player.isRemote = false;\r\n            if (wasRemote) {\r\n                console.log('[Room Transition] Fixed isRemote flag - local player was incorrectly marked as remote');\r\n            }\r\n            // Restore health to current HP (not max)\r\n            player.setHP(gameState.playerStats.currentHP || player.maxHealth);\r\n            // Restore synergy tracking\r\n            if (gameState.playerStats.selectedUpgrades) {\r\n                player.selectedUpgrades = new Set(gameState.playerStats.selectedUpgrades);\r\n            }\r\n            if (gameState.playerStats.activeSynergies) {\r\n                player.activeSynergies = new Set(gameState.playerStats.activeSynergies);\r\n            }\r\n            // Restore pending level ups\r\n            if (gameState.playerStats.pendingLevelUps) {\r\n                player.pendingLevelUps = [...gameState.playerStats.pendingLevelUps];\r\n            }\r\n            // CRITICAL: Recalculate all upgrades to ensure they're properly applied\r\n            if (player.upgradeStacks && Object.keys(player.upgradeStacks).length > 0) {\r\n                recalculateAllUpgrades(player);\r\n            }\r\n\r\n            // CRITICAL: Reapply synergies after upgrade recalculation\r\n            // Synergy bonuses are multiplicative and get overwritten by recalculateAllUpgrades\r\n            if (player.activeSynergies && player.activeSynergies.size > 0) {\r\n                reapplySynergies(player);\r\n                // CRITICAL: Restore HP after synergy reapplication\r\n                // Some synergies (Tank, Glass Cannon) modify HP when applied, but we want\r\n                // to preserve the player's saved HP, not re-apply the HP modification\r\n                const savedHP = gameState.playerStats.currentHP || player.maxHealth;\r\n                player.setHP(Math.min(savedHP, player.maxHealth));\r\n            }\r\n\r\n            // CRITICAL: Reinitialize orbital weapons if player has them\r\n            // Orbital orbs are entities that get destroyed on room transition\r\n            if (player.powerupWeapon === 'orbital' || player.weaponKey === 'orbital') {\r\n                player.orbitalOrbs = [];\r\n                player.orbitalAngles = [];\r\n                player.orbitalNeedsReinit = true;\r\n            }\r\n\r\n            // Reset slow debuff state (enemies don't persist across rooms)\r\n            player.slowed = false;\r\n\r\n            // CRITICAL: Reset control flags after room transition\r\n            // If player is alive, ensure they can move and shoot\r\n            if (!player.isDead) {\r\n                player.canMove = true;\r\n                player.canShoot = true;\r\n                player.opacity = 1;\r\n                if (player.outline && player.outline.exists()) {\r\n                    player.outline.opacity = 1;\r\n                }\r\n            } else {\r\n                // Player is dead - set death visual state\r\n                player.canMove = false;\r\n                player.canShoot = false;\r\n                player.opacity = 0.5;\r\n                if (player.outline && player.outline.exists()) {\r\n                    player.outline.opacity = 0.5;\r\n                }\r\n            }\r\n\r\n            // Recreate cosmetic effects on room transition (glow entity was destroyed)\r\n            if (gameState.equippedCosmetics) {\r\n                // Recreate glow effect\r\n                if (gameState.equippedCosmetics.glow && gameState.equippedCosmetics.glow !== 'glowNone' && !player.isDead) {\r\n                    const glowDef = COSMETIC_UNLOCKS[gameState.equippedCosmetics.glow];\r\n                    if (glowDef && glowDef.color) {\r\n                        player.glowEffect = createGlowEffect(k, player, gameState.equippedCosmetics.glow, glowDef.color);\r\n                    }\r\n                }\r\n                // Restore trail info (properties persist on player object)\r\n                if (gameState.equippedCosmetics.trail && gameState.equippedCosmetics.trail !== 'trailNone') {\r\n                    const trailDef = COSMETIC_UNLOCKS[gameState.equippedCosmetics.trail];\r\n                    if (trailDef) {\r\n                        player.trailType = gameState.equippedCosmetics.trail;\r\n                        player.trailColor = trailDef.color;\r\n                        player.trailTimer = 0;\r\n                        player.lastTrailPos = { x: player.pos.x, y: player.pos.y };\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            // New game - create fresh player\r\n            // For daily runs, use the locked daily character\r\n            const characterOverride = gameState.isDailyRun ? gameState.dailyCharacter : null;\r\n            player = createPlayer(k, playerSpawnX, playerSpawnY, characterOverride);\r\n\r\n            // Apply permanent upgrades\r\n            applyPermanentUpgrades(k, player);\r\n\r\n            // Apply run boosters (consumables purchased in shop)\r\n            applyRunBoosters(k, player, gameState);\r\n\r\n            // Setup cosmetic effects (trails, glows, death effects)\r\n            const equippedCosmetics = getEquippedCosmetics();\r\n            gameState.equippedCosmetics = equippedCosmetics;\r\n\r\n            // Create glow effect if one is equipped\r\n            if (equippedCosmetics.glow && equippedCosmetics.glow !== 'glowNone') {\r\n                const glowDef = COSMETIC_UNLOCKS[equippedCosmetics.glow];\r\n                if (glowDef && glowDef.color) {\r\n                    player.glowEffect = createGlowEffect(k, player, equippedCosmetics.glow, glowDef.color);\r\n                }\r\n            }\r\n\r\n            // Store trail info on player for update loop\r\n            if (equippedCosmetics.trail && equippedCosmetics.trail !== 'trailNone') {\r\n                const trailDef = COSMETIC_UNLOCKS[equippedCosmetics.trail];\r\n                if (trailDef) {\r\n                    player.trailType = equippedCosmetics.trail;\r\n                    player.trailColor = trailDef.color;\r\n                    player.trailTimer = 0;\r\n                    player.lastTrailPos = { x: player.pos.x, y: player.pos.y };\r\n                }\r\n            }\r\n\r\n            // Initialize per-player run stats\r\n            player.runStats = {\r\n                kills: 0,\r\n                deaths: 0,\r\n                revives: 0,\r\n                damageTaken: 0,\r\n                damageDealt: 0,\r\n                creditsPickedUp: 0,\r\n                xpPickedUp: 0,\r\n                bossesKilled: 0\r\n            };\r\n        }\r\n        \r\n        // ==========================================\r\n        // MULTIPLAYER: Initialize multiplayer game if party has multiple players\r\n        // ==========================================\r\n        const party = getParty();\r\n        const networkInfo = getNetworkInfo();\r\n        // Initialize players array indexed by slot (not by push order)\r\n        let players = new Array(party.maxSlots || 4).fill(null);\r\n\r\n        if (partySize > 1 && networkInfo.isInitialized) {\r\n            // Find local player slot\r\n            const localSlot = party.slots.findIndex(slot => slot.isLocal);\r\n\r\n            // Initialize multiplayer system with kaplay instance\r\n            initMultiplayerGame(party.isHost, localSlot, k);\r\n\r\n            // Broadcast game seed to clients (host only) to ensure synchronized RNG\r\n            if (party.isHost) {\r\n                // Select first room template and include it with game seed\r\n                const roomRng = getRoomRNG();\r\n                const firstRoomTemplate = getWeightedRoomTemplate(currentFloor, roomRng);\r\n                gameState.roomTemplateKey = firstRoomTemplate.key;\r\n                console.log('[Multiplayer] Host selected first room template:', firstRoomTemplate.key);\r\n                broadcastGameSeed(firstRoomTemplate.key);\r\n            }\r\n\r\n            // Regenerate floor map with correct seed for multiplayer\r\n            if (party.isHost) {\r\n                // Host: regenerate with the newly created seed\r\n                generateFloorMapAndMinimap();\r\n            } else {\r\n                // Client: regenerate when game_seed arrives\r\n                // For now, generate with current seed (will be 0)\r\n                // Then regenerate when we receive the actual seed\r\n                onGameSeedReceived(() => {\r\n                    console.log('[Multiplayer] Client received seed, regenerating floor map');\r\n                    generateFloorMapAndMinimap();\r\n                });\r\n            }\r\n\r\n            // Set slot index and name on local player\r\n            player.slotIndex = localSlot;\r\n            player.playerName = party.slots[localSlot].playerName;\r\n\r\n            // Adjust local player position to match slot index (for consistent multiplayer positioning)\r\n            const localOffsetX = localSlot * 30;\r\n            player.pos.x = playerSpawnX + localOffsetX;\r\n\r\n            // Register local player at their slot index\r\n            registerPlayer(localSlot, player);\r\n            players[localSlot] = player;\r\n\r\n            // Spawn additional players for other party members\r\n            party.slots.forEach((slot, index) => {\r\n                if (index !== localSlot && slot.playerId !== null) {\r\n                    // Spawn remote player with their selected character\r\n                    // Use absolute slot index for consistent positioning across all clients\r\n                    const offsetX = index * 30; // Absolute offset based on slot index\r\n                    const remotePlayer = createPlayer(k, playerSpawnX + offsetX, playerSpawnY, slot.selectedCharacter);\r\n\r\n                    // Mark as remote player (disable local input)\r\n                    remotePlayer.isRemote = true;\r\n                    remotePlayer.slotIndex = index;\r\n                    remotePlayer.playerName = slot.playerName;\r\n\r\n                    // Restore remote player stats if available\r\n                    if (gameState.allPlayerStats && gameState.allPlayerStats.length > 0) {\r\n                        const savedStats = gameState.allPlayerStats.find(stats => stats.slotIndex === index);\r\n                        if (savedStats) {\r\n                            Object.assign(remotePlayer, savedStats);\r\n                            \r\n                            // IMPORTANT: Re-affirm isRemote after restoring stats, as host's isRemote status (false)\r\n                            // can overwrite the client's setting for the remote player object.\r\n                            remotePlayer.isRemote = true; \r\n                            \r\n                            remotePlayer.setHP(savedStats.currentHP || remotePlayer.maxHealth);\r\n\r\n                            // Restore synergy tracking\r\n                            if (savedStats.selectedUpgrades) {\r\n                                remotePlayer.selectedUpgrades = new Set(savedStats.selectedUpgrades);\r\n                            }\r\n                            if (savedStats.activeSynergies) {\r\n                                remotePlayer.activeSynergies = new Set(savedStats.activeSynergies);\r\n                            }\r\n                            // Restore pending level ups\r\n                            if (savedStats.pendingLevelUps) {\r\n                                remotePlayer.pendingLevelUps = [...savedStats.pendingLevelUps];\r\n                            }\r\n\r\n                            // Recalculate upgrades\r\n                            if (remotePlayer.upgradeStacks && Object.keys(remotePlayer.upgradeStacks).length > 0) {\r\n                                recalculateAllUpgrades(remotePlayer);\r\n                            }\r\n\r\n                            // Reapply synergies after upgrade recalculation\r\n                            if (remotePlayer.activeSynergies && remotePlayer.activeSynergies.size > 0) {\r\n                                reapplySynergies(remotePlayer);\r\n                                // Restore HP after synergy reapplication\r\n                                const savedHP = savedStats.currentHP || remotePlayer.maxHealth;\r\n                                remotePlayer.setHP(Math.min(savedHP, remotePlayer.maxHealth));\r\n                            }\r\n\r\n                            // Reinitialize orbital weapons if player has them\r\n                            if (remotePlayer.powerupWeapon === 'orbital' || remotePlayer.weaponKey === 'orbital') {\r\n                                remotePlayer.orbitalOrbs = [];\r\n                                remotePlayer.orbitalAngles = [];\r\n                                remotePlayer.orbitalNeedsReinit = true;\r\n                            }\r\n\r\n                            // Reset slow debuff state\r\n                            remotePlayer.slowed = false;\r\n\r\n                            // CRITICAL: Reset control flags after room transition\r\n                            // If player is alive, ensure they can move and shoot\r\n                            if (!remotePlayer.isDead) {\r\n                                remotePlayer.canMove = true;\r\n                                remotePlayer.canShoot = true;\r\n                                remotePlayer.opacity = 1;\r\n                                if (remotePlayer.outline && remotePlayer.outline.exists()) {\r\n                                    remotePlayer.outline.opacity = 1;\r\n                                }\r\n                            } else {\r\n                                // Player is dead - set death visual state\r\n                                remotePlayer.canMove = false;\r\n                                remotePlayer.canShoot = false;\r\n                                remotePlayer.opacity = 0.5;\r\n                                if (remotePlayer.outline && remotePlayer.outline.exists()) {\r\n                                    remotePlayer.outline.opacity = 0.5;\r\n                                }\r\n                            }\r\n                        }\r\n                    } else {\r\n                        // No saved stats - apply permanent upgrades to new remote player\r\n                        // Use the slot's permanent upgrade levels (from their save data)\r\n                        applyPermanentUpgrades(k, remotePlayer, slot.permanentUpgradeLevels);\r\n                    }\r\n\r\n                    // Setup combat system for remote player (uses network input)\r\n                    setupCombatSystem(k, remotePlayer);\r\n\r\n                    // Setup progression system for remote player (for XP/level ups)\r\n                    // Note: reviveAllPlayers callback is passed as null here, will be handled globally\r\n                    setupProgressionSystem(k, remotePlayer, null, true);\r\n\r\n                    // Register remote player at their slot index\r\n                    registerPlayer(index, remotePlayer);\r\n                    players[index] = remotePlayer;\r\n\r\n                    // Add onDeath callback for remote players (host only) to check game over\r\n                    if (party.isHost) {\r\n                        remotePlayer.onDeath(() => {\r\n                            // Set death state\r\n                            remotePlayer.isDead = true;\r\n                            remotePlayer.canMove = false;\r\n                            remotePlayer.canShoot = false;\r\n                            remotePlayer.opacity = 0.5;\r\n                            if (remotePlayer.outline && remotePlayer.outline.exists()) {\r\n                                remotePlayer.outline.opacity = 0.5;\r\n                            }\r\n\r\n                            // Check if all players are dead\r\n                            const anyPlayerAlive = players.some(p =>\r\n                                p && p.exists() && p.hp() > 0 && !p.isDead\r\n                            );\r\n\r\n                            if (!anyPlayerAlive) {\r\n                                // All players dead - trigger game over\r\n                                const currencyEarned = calculateCurrencyEarned(runStats);\r\n                                const fullRunStats = {\r\n                                    ...runStats,\r\n                                    level: player.level,\r\n                                    currencyEarned: currencyEarned\r\n                                };\r\n                                updateRunStats(fullRunStats);\r\n                                addCurrency(currencyEarned);\r\n                                checkAchievements(k);\r\n\r\n                                // Gather party stats for game over screen\r\n                                const partyStats = players.filter(p => p && p.exists()).map(p => ({\r\n                                    name: p.playerName || 'Player',\r\n                                    level: p.level || 1,\r\n                                    characterData: p.characterData,\r\n                                    kills: p.runStats?.kills || 0,\r\n                                    deaths: p.runStats?.deaths || 0,\r\n                                    revives: p.runStats?.revives || 0,\r\n                                    damageTaken: p.runStats?.damageTaken || 0,\r\n                                    damageDealt: p.runStats?.damageDealt || 0,\r\n                                    xpCollected: p.runStats?.xpPickedUp || 0,\r\n                                    creditsPickedUp: p.runStats?.creditsPickedUp || 0,\r\n                                    bossesKilled: p.runStats?.bossesKilled || 0\r\n                                }));\r\n\r\n                                if (isMultiplayerActive()) {\r\n                                    broadcastGameOver(runStats, currencyEarned, partyStats);\r\n                                    cleanupMultiplayer();\r\n                                }\r\n\r\n                                k.go('gameOver', {\r\n                                    runStats: { ...runStats },\r\n                                    currencyEarned: currencyEarned,\r\n                                    partyStats: partyStats,\r\n                                    isDailyRun: gameState.isDailyRun,\r\n                                    dailyCharacter: gameState.dailyCharacter\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    // Add name tag above remote player\r\n                    const nameTag = k.add([\r\n                        k.text(slot.playerName, { size: 10 }),\r\n                        k.pos(0, -30),\r\n                        k.color(150, 150, 255),\r\n                        k.z(100)\r\n                    ]);\r\n\r\n                    // Health bar components (shown when player is hurt)\r\n                    const healthBarWidth = 40;\r\n                    const healthBarHeight = 4;\r\n                    const healthBarOffset = -40; // Below name tag\r\n\r\n                    const healthBarBg = k.add([\r\n                        k.rect(healthBarWidth, healthBarHeight),\r\n                        k.pos(remotePlayer.pos.x, remotePlayer.pos.y + healthBarOffset),\r\n                        k.anchor('center'),\r\n                        k.color(50, 50, 50),\r\n                        k.z(100),\r\n                        'playerHealthBar'\r\n                    ]);\r\n\r\n                    const healthBar = k.add([\r\n                        k.rect(healthBarWidth, healthBarHeight),\r\n                        k.pos(remotePlayer.pos.x, remotePlayer.pos.y + healthBarOffset),\r\n                        k.anchor('center'),\r\n                        k.color(100, 255, 100), // Green for friendly players\r\n                        k.z(101),\r\n                        'playerHealthBar'\r\n                    ]);\r\n\r\n                    // Link health bars to player\r\n                    remotePlayer.healthBarBg = healthBarBg;\r\n                    remotePlayer.healthBar = healthBar;\r\n\r\n                    // Initially hide health bars\r\n                    healthBarBg.hidden = true;\r\n                    healthBar.hidden = true;\r\n\r\n                    // Make name tag and health bars follow player\r\n                    nameTag.onUpdate(() => {\r\n                        if (remotePlayer.exists()) {\r\n                            nameTag.pos = k.vec2(remotePlayer.pos.x, remotePlayer.pos.y - 30);\r\n\r\n                            // Update health bar position and visibility\r\n                            const healthPercent = remotePlayer.hp() / remotePlayer.maxHealth;\r\n                            const isHurt = healthPercent < 1.0 && healthPercent > 0;\r\n\r\n                            if (isHurt) {\r\n                                // Show and update health bars\r\n                                healthBarBg.hidden = false;\r\n                                healthBar.hidden = false;\r\n\r\n                                // Update position\r\n                                healthBarBg.pos.x = remotePlayer.pos.x;\r\n                                healthBarBg.pos.y = remotePlayer.pos.y + healthBarOffset;\r\n                                healthBar.pos.x = remotePlayer.pos.x;\r\n                                healthBar.pos.y = remotePlayer.pos.y + healthBarOffset;\r\n\r\n                                // Update health bar width - use k.use() to replace the rect component\r\n                                const barWidth = Math.max(1, healthBarWidth * healthPercent);\r\n                                healthBar.use(k.rect(barWidth, healthBarHeight));\r\n                                healthBar.pos.x = remotePlayer.pos.x - (healthBarWidth - barWidth) / 2;\r\n                            } else {\r\n                                // Hide health bars when at full health\r\n                                healthBarBg.hidden = true;\r\n                                healthBar.hidden = true;\r\n                            }\r\n                        } else {\r\n                            nameTag.destroy();\r\n                            if (healthBarBg.exists()) healthBarBg.destroy();\r\n                            if (healthBar.exists()) healthBar.destroy();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            // Listen for room transition from host (client only)\r\n            if (!isHost()) {\r\n                // Prevent duplicate handler registration (memory leak fix)\r\n                if (!gameSceneMessageHandlersRegistered) {\r\n                    gameSceneMessageHandlersRegistered = true;\r\n\r\n                onMessage('room_transition', (data) => {\r\n\r\n                    // Update gameState to match host's entry direction for consistent spawn positions\r\n                    gameState.entryDirection = data.entryDirection;\r\n\r\n                    // Save player stats to gameState so they persist across scene reload\r\n                    if (data.allPlayerStats) {\r\n                        gameState.allPlayerStats = data.allPlayerStats;\r\n                        // Find local player stats by matching slot index (not by isRemote flag!)\r\n                        // Recalculate localSlot from party to ensure it's current\r\n                        const currentParty = getParty();\r\n                        const currentLocalSlot = currentParty.slots.findIndex(slot => slot.isLocal);\r\n                        // Filter out null entries first to avoid errors\r\n                        const localPlayerStats = data.allPlayerStats.find(stats => stats && stats.slotIndex === currentLocalSlot);\r\n                        if (localPlayerStats) {\r\n                            gameState.playerStats = localPlayerStats;\r\n                            console.log('[Multiplayer] Client restored stats for slot', currentLocalSlot, 'level:', localPlayerStats.level);\r\n                        } else {\r\n                            console.warn('[Multiplayer] Client could not find stats for local slot', currentLocalSlot, 'in', data.allPlayerStats);\r\n                        }\r\n                    }\r\n\r\n                    // Sync room template key from host\r\n                    if (data.roomTemplateKey) {\r\n                        gameState.roomTemplateKey = data.roomTemplateKey;\r\n                        console.log('[Multiplayer] Client received room template:', data.roomTemplateKey);\r\n                    }\r\n\r\n                    // Sync floor number - check if we're advancing to a new floor\r\n                    if (data.currentFloor && data.currentFloor !== gameState.currentFloor) {\r\n                        console.log(`[Multiplayer] Floor advancement: ${gameState.currentFloor} -> ${data.currentFloor}`);\r\n                        gameState.currentFloor = data.currentFloor;\r\n                        // Clear floor map so it regenerates for the new floor\r\n                        gameState.floorMap = null;\r\n                        gameState.entryDirection = null; // Start from center on new floor\r\n                    } else if (data.gridDirection && gameState.floorMap) {\r\n                        // Sync floor map position with host (normal room transition)\r\n                        gameState.floorMap.moveToRoom(data.gridDirection);\r\n                    }\r\n\r\n                    // Prevent duplicate transitions\r\n                    if (doorEntered) return;\r\n                    doorEntered = true;\r\n\r\n                    // Play door sound for client\r\n                    playDoorOpen();\r\n\r\n                    // Transition to next room (same as handleDoorEntry but without broadcasting)\r\n                    // Note: We DON'T call handleDoorEntry because that would save stats again\r\n                    // and broadcast another room_transition. Just transition the scene.\r\n                    k.go('game');\r\n                });\r\n\r\n                onMessage('room_completed', () => {\r\n                    roomCompleted = true;\r\n\r\n                    // Revive all dead players (same as host)\r\n                    reviveAllPlayers();\r\n\r\n                    // Update doors to show they're open\r\n                    spawnDoors.forEach(door => {\r\n                        if (door.exists() && !door.blocked) {\r\n                            door.open = true;\r\n                            door.isSpawnDoor = false;\r\n                            door.updateVisual();\r\n                        }\r\n                    });\r\n\r\n                    // Special handling for boss rooms: unblock the north door\r\n                    if (isBossRoom) {\r\n                        const northDoor = spawnDoors.find(d => d.direction === 'north');\r\n                        if (northDoor && northDoor.exists()) {\r\n                            northDoor.blocked = false;\r\n                            northDoor.open = true;\r\n                            northDoor.isSpawnDoor = false;\r\n                            northDoor.isFloorExit = true;\r\n                            northDoor.updateVisual();\r\n                        }\r\n                    }\r\n\r\n                    // Update minimap to reflect room clear\r\n                    if (gameState.minimap) {\r\n                        gameState.minimap.update();\r\n                    }\r\n\r\n                    // Show completion message (same as host)\r\n                    const completionText = isBossRoom\r\n                        ? `BOSS DEFEATED! Floor ${currentFloor} Complete! Enter a door to continue`\r\n                        : 'Room Cleared! Enter a door to continue';\r\n                    const completionMsg = k.add([\r\n                        k.text(completionText, { size: 20 }),\r\n                        k.pos(k.width() / 2, k.height() - 40),\r\n                        k.anchor('center'),\r\n                        k.color(100, 255, 100),\r\n                        k.fixed(),\r\n                        k.z(500)\r\n                    ]);\r\n\r\n                    k.wait(5, () => {\r\n                        if (completionMsg.exists()) {\r\n                            k.destroy(completionMsg);\r\n                        }\r\n                    });\r\n\r\n                    // Note: Level ups are now manually triggered via button, not auto-shown\r\n                    // processPendingLevelUps();\r\n                });\r\n\r\n                // Listen for obstacle data from host\r\n                onMessage('obstacle_data', (data) => {\r\n                    console.log('[Multiplayer] Client received obstacle data:', data.obstacles.length, 'obstacles');\r\n\r\n                    // Clear any existing obstacles (in case of resync)\r\n                    k.get('obstacle').forEach(obj => k.destroy(obj));\r\n\r\n                    // Create obstacles from host data\r\n                    data.obstacles.forEach(obsData => {\r\n                        // Color comes as array, convert to k.rgb()\r\n                        const color = Array.isArray(obsData.color)\r\n                            ? k.rgb(obsData.color[0], obsData.color[1], obsData.color[2])\r\n                            : obsData.color;\r\n                        createObstacle(\r\n                            k,\r\n                            obsData.x,\r\n                            obsData.y,\r\n                            obsData.width,\r\n                            obsData.height,\r\n                            obsData.type,\r\n                            obsData.char,\r\n                            color\r\n                        );\r\n                    });\r\n                });\r\n\r\n                // Listen for door states from host\r\n                onMessage('door_states', (doorStates) => {\r\n                    console.log('[Multiplayer] Client received door states:', doorStates);\r\n\r\n                    // Update door blocked states (spawnDoors is defined later in scene)\r\n                    if (typeof spawnDoors !== 'undefined' && spawnDoors.length > 0) {\r\n                        spawnDoors.forEach(door => {\r\n                            if (doorStates.hasOwnProperty(door.direction)) {\r\n                                door.blocked = doorStates[door.direction];\r\n                                door.updateVisual();\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n\r\n                // Listen for game over event from host\r\n                onMessage('game_over', (data) => {\r\n                    // Calculate currency earned (use host's value if provided)\r\n                    const currencyEarned = data.currencyEarned || calculateCurrencyEarned(data.runStats || runStats);\r\n\r\n                    // Update persistent stats and add currency\r\n                    // Use runStats from host (data.runStats) instead of local runStats (which is empty for clients)\r\n                    const fullRunStats = {\r\n                        ...(data.runStats || runStats),\r\n                        level: player.level,\r\n                        currencyEarned: currencyEarned\r\n                    };\r\n                    updateRunStats(fullRunStats);\r\n                    addCurrency(currencyEarned);\r\n\r\n                    // Check for achievements\r\n                    checkAchievements(k);\r\n\r\n                    // Cleanup multiplayer\r\n                    cleanupMultiplayer();\r\n\r\n                    // Go to game over scene\r\n                    k.go('gameOver', {\r\n                        runStats: { ...(data.runStats || runStats) },\r\n                        currencyEarned: currencyEarned,\r\n                        partyStats: data.partyStats || [],\r\n                        isDailyRun: gameState.isDailyRun,\r\n                        dailyCharacter: gameState.dailyCharacter\r\n                    });\r\n                });\r\n\r\n                // Listen for powerup weapon application from host\r\n                onMessage('powerup_weapon_applied', (data) => {\r\n                    // Apply powerup to all players (client-side visual update)\r\n                    // The actual weapon stats will be synced via game_state\r\n                    players.forEach(p => {\r\n                        if (!p || !p.exists()) return;\r\n                        applyPowerupWeapon(p, data.powerupKey);\r\n                    });\r\n                });\r\n\r\n                // Listen for upgrade selection from host/clients\r\n                onMessage('upgrade_selected', (data) => {\r\n                    // Skip if this is our own upgrade - we already applied it locally in upgradeDraft\r\n                    if (data.slotIndex === localSlot) {\r\n                        return;\r\n                    }\r\n                    // Find the player who selected the upgrade (remote player)\r\n                    const upgradingPlayer = players.find(p => p.slotIndex === data.slotIndex);\r\n                    if (upgradingPlayer && upgradingPlayer.exists()) {\r\n                        // Apply upgrade locally (stats will sync via game_state but this is immediate)\r\n                        applyUpgrade(upgradingPlayer, data.upgradeKey);\r\n                        trackUpgrade(upgradingPlayer, data.upgradeKey);\r\n                        checkAndApplySynergies(k, upgradingPlayer);\r\n                    }\r\n                });\r\n\r\n                // Listen for level up queued events\r\n                onMessage('level_up_queued', (data) => {\r\n                    // Skip if this is our own level up - we already queued it locally\r\n                    if (data.slotIndex === localSlot) {\r\n                        return;\r\n                    }\r\n                    // Find the player who leveled up (remote player)\r\n                    const leveledPlayer = players.find(p => p.slotIndex === data.slotIndex);\r\n                    if (leveledPlayer && leveledPlayer.exists()) {\r\n                        // Update the player's level to match (critical for saving stats)\r\n                        leveledPlayer.level = data.level;\r\n\r\n                        // Initialize pendingLevelUps if needed\r\n                        if (!leveledPlayer.pendingLevelUps) {\r\n                            leveledPlayer.pendingLevelUps = [];\r\n                        }\r\n                        // Queue the level up\r\n                        if (!leveledPlayer.pendingLevelUps.includes(data.level)) {\r\n                            leveledPlayer.pendingLevelUps.push(data.level);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                // Listen for synergy activation\r\n                onMessage('synergy_activated', (data) => {\r\n                    // Skip if this is our own synergy - we already applied it locally\r\n                    if (data.slotIndex === localSlot) {\r\n                        return;\r\n                    }\r\n                    // Find the player who activated synergies (remote player)\r\n                    const synergyPlayer = players.find(p => p.slotIndex === data.slotIndex);\r\n                    if (synergyPlayer && synergyPlayer.exists()) {\r\n                        // Apply synergies immediately\r\n                        checkAndApplySynergies(k, synergyPlayer);\r\n                    }\r\n                });\r\n\r\n                // Listen for powerup weapon expiration\r\n                onMessage('powerup_expired', (data) => {\r\n                    // Find the player whose powerup expired\r\n                    const expiringPlayer = players.find(p => p.slotIndex === data.slotIndex);\r\n                    if (expiringPlayer && expiringPlayer.exists()) {\r\n                        // Restore original weapon\r\n                        restoreOriginalWeapon(expiringPlayer);\r\n                    }\r\n                });\r\n\r\n                // Handle player heal events from host (lifesteal, regen, etc.)\r\n                onMessage('player_healed', (data) => {\r\n                    const healedPlayer = players.find(p => p.slotIndex === data.slotIndex);\r\n                    if (healedPlayer && healedPlayer.exists()) {\r\n                        healedPlayer.setHP(data.newHP);\r\n                    }\r\n                });\r\n\r\n                // Handle player dodge events from host\r\n                onMessage('player_dodged', (data) => {\r\n                    const dodgingPlayer = players.find(p => p.slotIndex === data.slotIndex);\r\n                    if (dodgingPlayer && dodgingPlayer.exists()) {\r\n                        // Show dodge visual feedback\r\n                        const dodgeText = k.add([\r\n                            k.text('DODGE!', { size: 14 }),\r\n                            k.pos(data.x, data.y - 30),\r\n                            k.anchor('center'),\r\n                            k.color(100, 200, 255),\r\n                            k.opacity(1),\r\n                            k.z(500)\r\n                        ]);\r\n\r\n                        // Fade out and destroy\r\n                        let elapsed = 0;\r\n                        dodgeText.onUpdate(() => {\r\n                            elapsed += k.dt();\r\n                            dodgeText.pos.y -= 30 * k.dt();\r\n                            dodgeText.opacity = Math.max(0, 1 - elapsed / 0.8);\r\n                            if (elapsed >= 0.8) {\r\n                                k.destroy(dodgeText);\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n                } // End of handler registration guard\r\n            }\r\n        } else {\r\n            // Single player mode - add player at slot 0\r\n            player.slotIndex = 0;\r\n            players[0] = player;\r\n        }\r\n\r\n        // Filter out null entries from players array for iteration\r\n        // But keep the array slot-indexed for direct access\r\n        const activePlayers = players.filter(p => p !== null);\r\n\r\n        // ==========================================\r\n        // EMOTES: Display emotes above player heads\r\n        // ==========================================\r\n\r\n        // Function to show emote above a player\r\n        function showEmote(targetPlayer, emoteType) {\r\n            if (!targetPlayer || !targetPlayer.exists()) return;\r\n\r\n            const emoteChar = emoteType === 'exclamation' ? '!' : '';\r\n            const emoteColor = emoteType === 'exclamation' ? [255, 255, 0] : [255, 100, 150];\r\n\r\n            // Create emote text\r\n            const emote = k.add([\r\n                k.text(emoteChar, { size: 24 }),\r\n                k.pos(targetPlayer.pos.x, targetPlayer.pos.y - 50),\r\n                k.anchor('center'),\r\n                k.color(...emoteColor),\r\n                k.opacity(1),\r\n                k.scale(1),\r\n                k.z(1000),\r\n                'emote'\r\n            ]);\r\n\r\n            // Animate: float up and fade out\r\n            let elapsed = 0;\r\n            const duration = 1.5;\r\n\r\n            emote.onUpdate(() => {\r\n                elapsed += k.dt();\r\n\r\n                // Follow player horizontally, float up\r\n                emote.pos.x = targetPlayer.pos.x;\r\n                emote.pos.y = targetPlayer.pos.y - 50 - (elapsed * 30);\r\n\r\n                // Scale animation (pop in, then shrink)\r\n                if (elapsed < 0.2) {\r\n                    emote.scale = k.vec2(1 + elapsed * 2);\r\n                } else {\r\n                    emote.scale = k.vec2(1.4 - (elapsed - 0.2) * 0.3);\r\n                }\r\n\r\n                // Fade out in last portion\r\n                if (elapsed > duration * 0.6) {\r\n                    emote.opacity = 1 - ((elapsed - duration * 0.6) / (duration * 0.4));\r\n                }\r\n\r\n                // Remove when done\r\n                if (elapsed >= duration) {\r\n                    k.destroy(emote);\r\n                }\r\n            });\r\n        }\r\n\r\n        // Key handlers for emotes (local player only)\r\n        let lastEmoteTime = 0;\r\n        const EMOTE_COOLDOWN = 0.1; // seconds\r\n\r\n        k.onKeyPress('q', () => {\r\n            if (player.isDead) return;\r\n\r\n            // Check cooldown\r\n            const now = k.time();\r\n            if (now - lastEmoteTime < EMOTE_COOLDOWN) return;\r\n            lastEmoteTime = now;\r\n\r\n            // Show locally\r\n            showEmote(player, 'exclamation');\r\n\r\n            // Broadcast to others in multiplayer\r\n            if (isMultiplayerActive()) {\r\n                broadcastEmote(player.slotIndex, 'exclamation');\r\n            }\r\n        });\r\n\r\n        k.onKeyPress('e', () => {\r\n            if (player.isDead) return;\r\n\r\n            // Check cooldown\r\n            const now = k.time();\r\n            if (now - lastEmoteTime < EMOTE_COOLDOWN) return;\r\n            lastEmoteTime = now;\r\n\r\n            // Show locally\r\n            showEmote(player, 'heart');\r\n\r\n            // Broadcast to others in multiplayer\r\n            if (isMultiplayerActive()) {\r\n                broadcastEmote(player.slotIndex, 'heart');\r\n            }\r\n        });\r\n\r\n        // Handle emotes from other players in multiplayer\r\n        if (partySize > 1) {\r\n            onMessage('player_emote', (data) => {\r\n                // Find the player who sent the emote\r\n                const emotingPlayer = players[data.slotIndex];\r\n                if (emotingPlayer && emotingPlayer.exists()) {\r\n                    showEmote(emotingPlayer, data.emoteType);\r\n                }\r\n            });\r\n        }\r\n\r\n        // ==========================================\r\n        // NEW ARCHITECTURE: Sync player entity with PlayerState\r\n        // ==========================================\r\n\r\n        // Get the local player state\r\n        const localPlayerId = state.localPlayerId;\r\n        const playerState = state.getPlayer(localPlayerId);\r\n\r\n        // Sync player entity properties to PlayerState\r\n        if (playerState) {\r\n            // Position\r\n            playerState.x = player.pos.x;\r\n            playerState.y = player.pos.y;\r\n\r\n            // Stats\r\n            playerState.health = player.hp();\r\n            playerState.maxHealth = player.maxHealth;\r\n            playerState.speed = player.speed;\r\n\r\n            // Progression\r\n            playerState.level = player.level;\r\n            playerState.xp = player.xp;\r\n            playerState.xpToNext = player.xpToNext;\r\n            playerState.xpMultiplier = player.xpMultiplier || 1.0;\r\n\r\n            // Weapon & Combat\r\n            playerState.weaponKey = 'pistol'; // TODO: sync actual weapon\r\n            playerState.fireRate = player.fireRate;\r\n            playerState.projectileSpeed = player.projectileSpeed;\r\n            playerState.projectileDamage = player.projectileDamage;\r\n            playerState.projectileCount = player.projectileCount || 1;\r\n            playerState.piercing = player.piercing || 0;\r\n            playerState.obstaclePiercing = player.obstaclePiercing || 0;\r\n            playerState.critChance = player.critChance || 0.05;\r\n            playerState.critDamage = player.critDamage || 2.0;\r\n            playerState.spreadAngle = player.spreadAngle || 0;\r\n            playerState.weaponRange = player.weaponRange || 600;\r\n\r\n            // Passive stats\r\n            playerState.pickupRadius = player.pickupRadius;\r\n            playerState.defense = player.defense || 0;\r\n            playerState.damageReduction = player.damageReduction || 0;\r\n            playerState.dodgeChance = player.dodgeChance || 0;\r\n        }\r\n\r\n        // ==========================================\r\n        // MULTIPLAYER: Revival system - revive all dead players on level up\r\n        // ==========================================\r\n        reviveAllPlayers = () => {\r\n            // Only in multiplayer with multiple players\r\n            if (partySize <= 1) return;\r\n\r\n            // Check if Second Wind is purchased (required for revivals)\r\n            const secondWindLevel = getPermanentUpgradeLevel('secondWind');\r\n            if (secondWindLevel <= 0) return; // No Second Wind = no revivals\r\n\r\n            let revivedCount = 0;\r\n            players.forEach((p, index) => {\r\n                if (!p) return; // Skip null entries\r\n\r\n                // Check if player is dead (hp <= 0 or destroyed)\r\n                if ((p.exists() && p.hp() <= 0) || (p.exists() && p.isDead)) {\r\n                    // One revival per player per run - check if already revived\r\n                    const playerKey = `player_${index}`;\r\n                    if (gameState.playersRevivedThisRun.has(playerKey)) {\r\n                        return; // Already revived this run, skip\r\n                    }\r\n\r\n                    // Mark as revived for this run\r\n                    gameState.playersRevivedThisRun.add(playerKey);\r\n\r\n                    // Revive player at 5% health + 5% per Second Wind level\r\n                    const revivePercent = 0.05 + (secondWindLevel * 0.05);\r\n                    const reviveHealth = Math.max(1, Math.floor(p.maxHealth * revivePercent));\r\n                    p.setHP(reviveHealth);\r\n                    p.isDead = false;\r\n\r\n                    // Re-enable movement and shooting (for all players, including remote ones on host)\r\n                    p.canMove = true;\r\n                    p.canShoot = true;\r\n\r\n                    // Show revival effect with HP percentage\r\n                    const reviveHealthPercent = Math.round(revivePercent * 100);\r\n                    const reviveEffect = k.add([\r\n                        k.text(` REVIVED (${reviveHealthPercent}% HP) `, { size: 16 }),\r\n                        k.pos(p.pos.x, p.pos.y - 40),\r\n                        k.anchor('center'),\r\n                        k.color(100, 255, 100),\r\n                        k.opacity(1), // Required for lifespan component\r\n                        k.lifespan(2),\r\n                        k.z(1000)\r\n                    ]);\r\n\r\n                    // Animate rising and fading\r\n                    reviveEffect.onUpdate(() => {\r\n                        reviveEffect.pos.y -= 30 * k.dt();\r\n                        reviveEffect.opacity -= 0.5 * k.dt();\r\n                    });\r\n\r\n                    // Restore visual state\r\n                    p.opacity = 1; // Restore full opacity\r\n                    if (p.characterData && p.characterData.color) {\r\n                        p.color = k.rgb(...p.characterData.color);\r\n                    }\r\n                    if (p.outline && p.outline.exists()) {\r\n                        p.outline.opacity = 1;\r\n                    }\r\n\r\n                    revivedCount++;\r\n                }\r\n            });\r\n\r\n            // Clear all enemy projectiles when revival happens to prevent instant re-death\r\n            if (revivedCount > 0) {\r\n                k.get('projectile').forEach(proj => {\r\n                    if (proj.isEnemyProjectile || proj.isBossProjectile) {\r\n                        k.destroy(proj);\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Broadcast revival event in multiplayer\r\n            if (revivedCount > 0 && isMultiplayerActive() && isHost()) {\r\n                broadcastRevivalEvent();\r\n            }\r\n        };\r\n\r\n        // Setup systems\r\n        setupCombatSystem(k, player);\r\n        const progressionSystem = setupProgressionSystem(k, player, reviveAllPlayers, partySize > 1);\r\n\r\n        // CRITICAL: Final safety check - ensure local player has controls enabled if alive\r\n        // This runs after all initialization to guarantee player can move and shoot\r\n        if (!player.isDead) {\r\n            player.canMove = true;\r\n            player.canShoot = true;\r\n        }\r\n\r\n        // Apply any pending XP accumulated while in upgrade draft screen (multiplayer)\r\n        if (partySize > 1) {\r\n            const pendingXP = getAndClearPendingXP();\r\n            if (pendingXP > 0 && player.addXP) {\r\n                console.log('[Multiplayer] Applying pending XP:', pendingXP);\r\n                player.addXP(pendingXP);\r\n            }\r\n        }\r\n\r\n        // Re-apply synergies if loading from saved state\r\n        if (gameState.playerStats && gameState.playerStats.selectedUpgrades) {\r\n            // Wait a frame to ensure player is fully initialized\r\n            k.wait(0.1, () => {\r\n                checkAndApplySynergies(k, player);\r\n            });\r\n        }\r\n        \r\n        // Get room template from floor map (or fallback to weighted generation)\r\n        const currentRoomNode = gameState.floorMap.getCurrentRoom();\r\n        const isBossRoom = currentRoomNode ? currentRoomNode.isBossRoom : (currentRoom === 3);\r\n        let roomTemplate;\r\n\r\n        if (partySize > 1 && gameState.roomTemplateKey) {\r\n            // Multiplayer: use the stored template key (synced from host transition)\r\n            // This takes priority over floor map template for subsequent rooms\r\n            roomTemplate = getRoomTemplateByKey(gameState.roomTemplateKey);\r\n            console.log('[Multiplayer] Using synced template:', gameState.roomTemplateKey);\r\n            // Clear the key after use so next room gets a fresh selection\r\n            gameState.roomTemplateKey = null;\r\n        } else if (partySize > 1 && !hasGameSeed()) {\r\n            // Multiplayer client before seed arrived: use firstRoomTemplateKey or fallback\r\n            const firstRoomKey = getFirstRoomTemplateKey();\r\n            if (firstRoomKey) {\r\n                roomTemplate = getRoomTemplateByKey(firstRoomKey);\r\n                console.log('[Multiplayer] Client using first room template:', firstRoomKey);\r\n            } else {\r\n                // Fallback - shouldn't normally happen since scene reloads when seed arrives\r\n                console.warn('[Multiplayer] No seed or template key available, using fallback');\r\n                const roomRng = getRoomRNG();\r\n                roomTemplate = getWeightedRoomTemplate(currentFloor, roomRng);\r\n            }\r\n        } else if (currentRoomNode && currentRoomNode.template) {\r\n            // Use floor map template (for single player or multiplayer with correct seed)\r\n            roomTemplate = currentRoomNode.template;\r\n        } else {\r\n            // Fallback to weighted generation\r\n            roomTemplate = getWeightedRoomTemplate(currentFloor, getSeededRoomRNG());\r\n        }\r\n        const floorColors = getFloorColors(k, currentFloor);\r\n        const margin = 20;\r\n\r\n        // Floor decorations (cosmetic theming based on floor)\r\n        renderFloorDecorations(k, currentFloor, k.width(), k.height());\r\n\r\n        // Room boundaries (visual) - use floor-based colors\r\n        k.add([\r\n            k.rect(k.width() - margin * 2, 2),\r\n            k.pos(k.width() / 2, margin),\r\n            k.anchor('center'),\r\n            k.color(floorColors.wallColor),\r\n            k.fixed()\r\n        ]);\r\n        k.add([\r\n            k.rect(k.width() - margin * 2, 2),\r\n            k.pos(k.width() / 2, k.height() - margin),\r\n            k.anchor('center'),\r\n            k.color(floorColors.wallColor),\r\n            k.fixed()\r\n        ]);\r\n        k.add([\r\n            k.rect(2, k.height() - margin * 2),\r\n            k.pos(margin, k.height() / 2),\r\n            k.anchor('center'),\r\n            k.color(floorColors.wallColor),\r\n            k.fixed()\r\n        ]);\r\n        k.add([\r\n            k.rect(2, k.height() - margin * 2),\r\n            k.pos(k.width() - margin, k.height() / 2),\r\n            k.anchor('center'),\r\n            k.color(floorColors.wallColor),\r\n            k.fixed()\r\n        ]);\r\n        \r\n        // Create obstacles from room template\r\n        // Skip obstacles in first room of first floor for better new player experience\r\n        const isFirstRoom = currentRoom === 1 && currentFloor === 1;\r\n        \r\n        // Safe zone around player spawn and entrance door\r\n        const safeZoneRadius = 80; // Minimum distance from spawn\r\n        \r\n        // Calculate entrance door position (where player entered from)\r\n        let entranceDoorX = k.width() / 2;\r\n        let entranceDoorY = k.height() / 2;\r\n        if (gameState.entryDirection) {\r\n            switch (gameState.entryDirection) {\r\n                case 'north':\r\n                    entranceDoorX = k.width() / 2;\r\n                    entranceDoorY = doorMargin;\r\n                    break;\r\n                case 'south':\r\n                    entranceDoorX = k.width() / 2;\r\n                    entranceDoorY = k.height() - doorMargin;\r\n                    break;\r\n                case 'west':\r\n                    entranceDoorX = doorMargin;\r\n                    entranceDoorY = k.height() / 2;\r\n                    break;\r\n                case 'east':\r\n                    entranceDoorX = k.width() - doorMargin;\r\n                    entranceDoorY = k.height() / 2;\r\n                    break;\r\n            }\r\n        }\r\n        \r\n        const obstacles = [];\r\n        const obstacleDataForBroadcast = [];\r\n\r\n        // Only create obstacles on host (or single player) - clients receive from host\r\n        const shouldCreateObstacles = partySize <= 1 || isHost();\r\n\r\n        if (!isFirstRoom && shouldCreateObstacles) {\r\n            roomTemplate.obstacles.forEach(obs => {\r\n            // Check if obstacle would overlap with player spawn safe zone\r\n            const distanceToSpawn = Math.sqrt(\r\n                Math.pow(obs.x - playerSpawnX, 2) +\r\n                Math.pow(obs.y - playerSpawnY, 2)\r\n            );\r\n\r\n            // Check if obstacle would block entrance door\r\n            const distanceToEntrance = Math.sqrt(\r\n                Math.pow(obs.x - entranceDoorX, 2) +\r\n                Math.pow(obs.y - entranceDoorY, 2)\r\n            );\r\n\r\n            const obstacleRadius = Math.max(obs.width, obs.height) / 2;\r\n\r\n            // Skip obstacle if it's too close to spawn or entrance door\r\n            if (distanceToSpawn < safeZoneRadius + obstacleRadius ||\r\n                distanceToEntrance < safeZoneRadius + obstacleRadius) {\r\n                return; // Skip this obstacle\r\n            }\r\n\r\n            // Constrain obstacle position to room boundaries\r\n            const constrainedPos = constrainObstacleToRoom(obs.x, obs.y, obs.width, obs.height);\r\n\r\n            const obstacleColor = obs.type === 'wall'\r\n                ? floorColors.obstacleColor\r\n                : floorColors.coverColor;\r\n            const obstacle = createObstacle(\r\n                k,\r\n                constrainedPos.x,\r\n                constrainedPos.y,\r\n                obs.width,\r\n                obs.height,\r\n                obs.type,\r\n                obs.char || '#',\r\n                obstacleColor\r\n            );\r\n            obstacles.push(obstacle);\r\n\r\n            // Collect data for broadcast to clients\r\n            if (partySize > 1 && isHost()) {\r\n                // Convert color to array for network serialization\r\n                let colorArray = null;\r\n                if (obstacleColor) {\r\n                    if (Array.isArray(obstacleColor)) {\r\n                        colorArray = obstacleColor;\r\n                    } else if (obstacleColor.r !== undefined) {\r\n                        colorArray = [obstacleColor.r, obstacleColor.g, obstacleColor.b];\r\n                    }\r\n                }\r\n                obstacleDataForBroadcast.push({\r\n                    x: constrainedPos.x,\r\n                    y: constrainedPos.y,\r\n                    width: obs.width,\r\n                    height: obs.height,\r\n                    type: obs.type,\r\n                    char: obs.char || '#',\r\n                    color: colorArray\r\n                });\r\n            }\r\n            });\r\n\r\n            // Broadcast obstacles to clients (with small delay to ensure client has loaded)\r\n            if (partySize > 1 && isHost()) {\r\n                k.wait(0.1, () => {\r\n                    broadcastObstacles(obstacleDataForBroadcast);\r\n                });\r\n            }\r\n        }\r\n\r\n        // Spawn explosive barrels (not in first room or boss rooms)\r\n        if (!isFirstRoom && !isBossRoom && shouldCreateObstacles) {\r\n            const barrelPositions = getBarrelPositions(roomTemplate.key, getSeededRoomRNG(), currentFloor);\r\n\r\n            barrelPositions.forEach(pos => {\r\n                // Check if barrel would overlap with player spawn or entrance\r\n                const distToSpawn = Math.sqrt(\r\n                    Math.pow(pos.x - playerSpawnX, 2) +\r\n                    Math.pow(pos.y - playerSpawnY, 2)\r\n                );\r\n                const distToEntrance = Math.sqrt(\r\n                    Math.pow(pos.x - entranceDoorX, 2) +\r\n                    Math.pow(pos.y - entranceDoorY, 2)\r\n                );\r\n\r\n                // Skip if too close to spawn or entrance\r\n                if (distToSpawn < safeZoneRadius + 25 || distToEntrance < safeZoneRadius + 25) {\r\n                    return;\r\n                }\r\n\r\n                // Check for overlap with obstacles\r\n                let overlapsObstacle = false;\r\n                obstacles.forEach(obs => {\r\n                    if (!obs.exists()) return;\r\n                    const dist = Math.sqrt(\r\n                        Math.pow(pos.x - obs.pos.x, 2) +\r\n                        Math.pow(pos.y - obs.pos.y, 2)\r\n                    );\r\n                    if (dist < 50) overlapsObstacle = true;\r\n                });\r\n\r\n                if (!overlapsObstacle) {\r\n                    createBarrel(k, pos.x, pos.y);\r\n                }\r\n            });\r\n        }\r\n\r\n        // HUD\r\n        // Top-left panel background (outside room boundary)\r\n        const topLeftPanelBg = k.add([\r\n            k.rect(82, 22),\r\n            k.pos(8, 2),\r\n            k.color(0, 0, 0),\r\n            k.opacity(0.6),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BG)\r\n        ]);\r\n\r\n        // Enemy counter with skull icon (top left - outside room)\r\n        const enemyIcon = k.add([\r\n            k.text('', { size: UI_TEXT_SIZES.HUD }),\r\n            k.pos(20, 6),\r\n            k.color(...UI_COLORS.WARNING),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        const enemiesCounter = k.add([\r\n            k.text('0/0', { size: UI_TEXT_SIZES.HUD }),\r\n            k.pos(40, 6),\r\n            k.color(...UI_COLORS.WARNING),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Top-right panel background (outside room boundary)\r\n        const topRightPanelBg = k.add([\r\n            k.rect(85, 22),\r\n            k.pos(k.width() - 10, 2),\r\n            k.anchor('topright'),\r\n            k.color(0, 0, 0),\r\n            k.opacity(0.6),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BG - 1)\r\n        ]);\r\n\r\n        // Credit counter (top right - outside room) - z-layer 950 to appear above minimap\r\n        const creditIcon = k.add([\r\n            k.text('$', { size: UI_TEXT_SIZES.LABEL }),\r\n            k.pos(k.width() - 20, 6),\r\n            k.anchor('topright'),\r\n            k.color(255, 215, 0), // Gold color\r\n            k.fixed(),\r\n            k.z(950)\r\n        ]);\r\n\r\n        const creditText = k.add([\r\n            k.text('0', { size: UI_TEXT_SIZES.HUD }),\r\n            k.pos(k.width() - 40, 6),\r\n            k.anchor('topright'),\r\n            k.color(255, 215, 0), // Gold color to match icon\r\n            k.fixed(),\r\n            k.z(950)\r\n        ]);\r\n\r\n        // Multiplayer Connection Indicator (only show if multiplayer is active)\r\n        let connectionIndicator = null;\r\n        let connectionText = null;\r\n        if (isMultiplayerActive()) {\r\n            const playerCount = getPlayerCount();\r\n            const statusColor = networkInfo.isHost ? [100, 255, 100] : [100, 200, 255];\r\n            const statusText = networkInfo.isHost ? 'HOST' : 'CLIENT';\r\n\r\n            connectionIndicator = k.add([\r\n                k.circle(4),\r\n                k.pos(20, 70),\r\n                k.color(...statusColor),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            connectionText = k.add([\r\n                k.text(`${statusText} (${playerCount}P)`, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                k.pos(30, 70),\r\n                k.anchor('left'),\r\n                k.color(...statusColor),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n        }\r\n\r\n        // XP Bar (bottom of screen, below room boundary)\r\n        const xpBarWidth = k.width() - 40;\r\n        const xpBarHeight = 15; // Reduced by 25% from 20\r\n        const xpBarY = k.height() - 18;\r\n\r\n        const xpBarBg = k.add([\r\n            k.rect(xpBarWidth, xpBarHeight),\r\n            k.pos(20, xpBarY),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.outline(2, k.rgb(...UI_COLORS.TEXT_DISABLED)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BG)\r\n        ]);\r\n\r\n        // Initialize XP bar with player's current progress\r\n        const initialXpProgress = player.xpToNext > 0 ? player.xp / player.xpToNext : 0;\r\n        const initialXpWidth = Math.max(0, (xpBarWidth - 34) * initialXpProgress);\r\n\r\n        const xpBarFill = k.add([\r\n            k.rect(initialXpWidth, xpBarHeight - 4),\r\n            k.pos(58, xpBarY + 2), // Start after level badge (adjusted for larger badge)\r\n            k.color(100, 200, 255), // Light blue XP color (matches pickup)\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BG + 1)\r\n        ]);\r\n\r\n        const xpBarText = k.add([\r\n            k.text(formatXP(player.xp || 0, player.xpToNext || 10), { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(k.width() / 2, xpBarY + xpBarHeight / 2),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Level badge (circular frame on left end of XP bar)\r\n        const levelBadgeSize = 36; // 30% bigger (was 28)\r\n        const levelBadgeX = 20 + levelBadgeSize / 2;\r\n        const levelBadgeY = xpBarY + xpBarHeight / 2;\r\n\r\n        const levelBadgeBg = k.add([\r\n            k.circle(levelBadgeSize / 2),\r\n            k.pos(levelBadgeX, levelBadgeY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_MEDIUM),\r\n            k.outline(2, k.rgb(100, 200, 255)), // Light blue outline to match XP\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BG + 2)\r\n        ]);\r\n\r\n        const levelText = k.add([\r\n            k.text(`${player.level || 1}`, { size: UI_TEXT_SIZES.BODY }), // 30% bigger (was SMALL)\r\n            k.pos(levelBadgeX, levelBadgeY),\r\n            k.anchor('center'),\r\n            k.color(255, 255, 255), // White text for better visibility\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BG + 3) // Above the badge background\r\n        ]);\r\n\r\n        // Player Health Bar (follows player when damaged, shown below player)\r\n        const playerHealthBarWidth = 40; // Reduced from 60 to 40\r\n        const playerHealthBarHeight = 8;\r\n        const playerHealthBarOffsetY = 25; // Below player\r\n\r\n        const playerHealthBarBg = k.add([\r\n            k.rect(playerHealthBarWidth, playerHealthBarHeight),\r\n            k.pos(0, 0),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.outline(1, k.rgb(...UI_COLORS.TEXT_DISABLED)),\r\n            k.z(UI_Z_LAYERS.OVERLAY)\r\n        ]);\r\n\r\n        const playerHealthBarFill = k.add([\r\n            k.rect(playerHealthBarWidth - 2, playerHealthBarHeight - 2),\r\n            k.pos(0, 0),\r\n            k.anchor('center'), // Use center anchor for proper width updates\r\n            k.color(100, 255, 100), // Green health color\r\n            k.z(UI_Z_LAYERS.OVERLAY + 1)\r\n        ]);\r\n\r\n        // Initially hide player health bar (only show when damaged)\r\n        playerHealthBarBg.hidden = true;\r\n        playerHealthBarFill.hidden = true;\r\n\r\n        // ==========================================\r\n        // WEAPON INDICATOR (Bottom Left - Icon Only)\r\n        // ==========================================\r\n        const weaponIconSize = 48;\r\n        const weaponIconX = 25;\r\n        const weaponIconY = k.height() - 85; // Above XP bar (moved up to avoid overlap)\r\n\r\n        const weaponIconBg = k.add([\r\n            k.rect(weaponIconSize, weaponIconSize),\r\n            k.pos(weaponIconX, weaponIconY),\r\n            k.color(0, 0, 0),\r\n            k.opacity(0.8),\r\n            k.outline(2, k.rgb(150, 150, 150)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BG)\r\n        ]);\r\n\r\n        const weaponIconText = k.add([\r\n            k.text('', { size: 32 }),\r\n            k.pos(weaponIconX + weaponIconSize / 2, weaponIconY + weaponIconSize / 2),\r\n            k.anchor('center'),\r\n            k.color(255, 255, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Weapon detail popup (shown on click or when paused)\r\n        const weaponDetailWidth = 220;\r\n        const weaponDetailHeight = 90;\r\n\r\n        const weaponDetailBg = k.add([\r\n            k.rect(weaponDetailWidth, weaponDetailHeight),\r\n            k.pos(weaponIconX, weaponIconY - weaponDetailHeight - 10),\r\n            k.color(0, 0, 0),\r\n            k.opacity(0.9),\r\n            k.outline(2, k.rgb(200, 200, 200)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 5)\r\n        ]);\r\n\r\n        const weaponDetailIcon = k.add([\r\n            k.text('', { size: 24 }),\r\n            k.pos(weaponIconX + 15, weaponIconY - weaponDetailHeight - 10 + 15),\r\n            k.color(255, 255, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\r\n        ]);\r\n\r\n        const weaponDetailName = k.add([\r\n            k.text('Basic Pistol', { size: UI_TEXT_SIZES.SMALL, width: 160 }), // Width constraint to prevent overflow\r\n            k.pos(weaponIconX + 50, weaponIconY - weaponDetailHeight - 10 + 10),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\r\n        ]);\r\n\r\n        const weaponDetailDamage = k.add([\r\n            k.text('DMG: 10', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(weaponIconX + 50, weaponIconY - weaponDetailHeight - 10 + 30),\r\n            k.color(255, 150, 150),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\r\n        ]);\r\n\r\n        const weaponDetailFireRate = k.add([\r\n            k.text('RATE: 3.75/s', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(weaponIconX + 50, weaponIconY - weaponDetailHeight - 10 + 47),\r\n            k.color(150, 200, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\r\n        ]);\r\n\r\n        const weaponDetailDPS = k.add([\r\n            k.text('DPS: 37.5', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(weaponIconX + 50, weaponIconY - weaponDetailHeight - 10 + 64),\r\n            k.color(255, 255, 150),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\r\n        ]);\r\n\r\n        // Initially hide weapon detail popup\r\n        weaponDetailBg.hidden = true;\r\n        weaponDetailIcon.hidden = true;\r\n        weaponDetailName.hidden = true;\r\n        weaponDetailDamage.hidden = true;\r\n        weaponDetailFireRate.hidden = true;\r\n        weaponDetailDPS.hidden = true;\r\n\r\n        // Track weapon detail state (reset to minimized on new game)\r\n        let weaponDetailState = false; // false = minimized, true = maximized\r\n        // Reset state on new game\r\n        if (args?.resetState) {\r\n            weaponDetailState = false;\r\n        }\r\n        \r\n        // Click handler for weapon icon\r\n        weaponIconBg.onClick(() => {\r\n            weaponDetailState = !weaponDetailState;\r\n            weaponDetailBg.hidden = !weaponDetailBg.hidden;\r\n            weaponDetailIcon.hidden = !weaponDetailIcon.hidden;\r\n            weaponDetailName.hidden = !weaponDetailName.hidden;\r\n            weaponDetailDamage.hidden = !weaponDetailDamage.hidden;\r\n            weaponDetailFireRate.hidden = !weaponDetailFireRate.hidden;\r\n            weaponDetailDPS.hidden = !weaponDetailDPS.hidden;\r\n        });\r\n\r\n        // ==========================================\r\n        // POWERUP WEAPON INDICATOR (Above Main Weapon - Bottom Left)\r\n        // ==========================================\r\n        const powerupIconSize = 40;\r\n        const powerupIconX = weaponIconX;\r\n        const powerupIconY = weaponIconY - powerupIconSize - 10; // Above weapon icon\r\n\r\n        const powerupIconBg = k.add([\r\n            k.rect(powerupIconSize, powerupIconSize),\r\n            k.pos(powerupIconX, powerupIconY),\r\n            k.color(0, 0, 0),\r\n            k.opacity(0.8),\r\n            k.outline(2, k.rgb(200, 200, 50)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BG)\r\n        ]);\r\n\r\n        const powerupIconText = k.add([\r\n            k.text('', { size: 28 }),\r\n            k.pos(powerupIconX + powerupIconSize / 2, powerupIconY + powerupIconSize / 2),\r\n            k.anchor('center'),\r\n            k.color(255, 255, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        const powerupAmmoText = k.add([\r\n            k.text('20', { size: 14 }),\r\n            k.pos(powerupIconX + powerupIconSize + 5, powerupIconY + powerupIconSize / 2),\r\n            k.anchor('left'),\r\n            k.color(255, 255, 150),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Initially hide powerup indicator (only show when player has powerup)\r\n        powerupIconBg.hidden = true;\r\n        powerupIconText.hidden = true;\r\n        powerupAmmoText.hidden = true;\r\n\r\n        // ==========================================\r\n        // ACTIVE BUFFS/UPGRADES DISPLAY (Near Weapon - Bottom Left)\r\n        // ==========================================\r\n        const buffsDisplayX = weaponIconX + weaponIconSize + 10; // Right of weapon icon\r\n        const buffsDisplayY = weaponIconY;\r\n        const buffIconSize = 32;\r\n        const buffIconSpacing = 40;\r\n\r\n        // Container for buff icons (will be populated dynamically)\r\n        const activeBuffIcons = [];\r\n\r\n        // Function to update buff display\r\n        function updateBuffDisplay() {\r\n            // Clear existing buff icons\r\n            activeBuffIcons.forEach(icon => {\r\n                if (icon.exists()) k.destroy(icon);\r\n            });\r\n            activeBuffIcons.length = 0;\r\n\r\n            if (!player.exists()) return;\r\n\r\n            // Collect all upgrades with their stacks\r\n            const upgradesWithStacks = [];\r\n\r\n            // Add weapon upgrades\r\n            if (player.upgradeStacks) {\r\n                Object.entries(player.upgradeStacks).forEach(([key, stacks]) => {\r\n                    if (stacks > 0) {\r\n                        upgradesWithStacks.push({ key, stacks });\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Position buffs horizontally from weapon icon\r\n            // Create buff icons\r\n            upgradesWithStacks.forEach((upgrade, index) => {\r\n                const xPos = buffsDisplayX + index * buffIconSpacing;\r\n\r\n                // Get upgrade definition for icon\r\n                const upgradeDef = UPGRADES[upgrade.key];\r\n                if (!upgradeDef) return;\r\n\r\n                // Background\r\n                const bg = k.add([\r\n                    k.rect(buffIconSize, buffIconSize),\r\n                    k.pos(xPos, buffsDisplayY),\r\n                    k.color(0, 0, 0),\r\n                    k.opacity(0.7),\r\n                    k.outline(1, k.rgb(150, 150, 150)),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_BG)\r\n                ]);\r\n\r\n                // Icon\r\n                const icon = k.add([\r\n                    k.text(upgradeDef.icon, { size: 20 }),\r\n                    k.pos(xPos + buffIconSize / 2, buffsDisplayY + buffIconSize / 2),\r\n                    k.anchor('center'),\r\n                    k.color(255, 255, 255),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n\r\n                // Stack count\r\n                const stackText = k.add([\r\n                    k.text(upgrade.stacks.toString(), { size: 10 }),\r\n                    k.pos(xPos + buffIconSize - 4, buffsDisplayY + buffIconSize - 4),\r\n                    k.anchor('botright'),\r\n                    k.color(255, 255, 100),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT + 1)\r\n                ]);\r\n\r\n                activeBuffIcons.push(bg, icon, stackText);\r\n            });\r\n        }\r\n\r\n        // ==========================================\r\n        // LEVEL UP BUTTON (Bottom Right)\r\n        // ==========================================\r\n        const levelUpButtonSize = 50;\r\n        const levelUpButtonX = k.width() - levelUpButtonSize - 25;\r\n        const levelUpButtonY = k.height() - levelUpButtonSize - 25;\r\n\r\n        const levelUpButtonBg = k.add([\r\n            k.rect(levelUpButtonSize, levelUpButtonSize),\r\n            k.pos(levelUpButtonX, levelUpButtonY),\r\n            k.color(100, 200, 255), // Light blue background\r\n            k.opacity(0.9),\r\n            k.outline(3, k.rgb(255, 255, 255)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 5)\r\n        ]);\r\n\r\n        const levelUpButtonText = k.add([\r\n            k.text('+', { size: 36 }),\r\n            k.pos(levelUpButtonX + levelUpButtonSize / 2, levelUpButtonY + levelUpButtonSize / 2),\r\n            k.anchor('center'),\r\n            k.color(255, 255, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\r\n        ]);\r\n\r\n        // Badge for showing count > 1 (top-right corner of button)\r\n        const levelUpCountBadgeSize = 20;\r\n        const levelUpCountBadgeX = levelUpButtonX + levelUpButtonSize - levelUpCountBadgeSize / 2;\r\n        const levelUpCountBadgeY = levelUpButtonY - levelUpCountBadgeSize / 2;\r\n\r\n        const levelUpCountBadge = k.add([\r\n            k.circle(levelUpCountBadgeSize / 2),\r\n            k.pos(levelUpCountBadgeX, levelUpCountBadgeY),\r\n            k.anchor('center'),\r\n            k.color(255, 50, 50), // Red badge\r\n            k.outline(2, k.rgb(255, 255, 255)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 7)\r\n        ]);\r\n\r\n        const levelUpCountText = k.add([\r\n            k.text('2', { size: 12 }),\r\n            k.pos(levelUpCountBadgeX, levelUpCountBadgeY),\r\n            k.anchor('center'),\r\n            k.color(255, 255, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 8)\r\n        ]);\r\n\r\n        // Initially hide level up button (only show when player has pending level ups)\r\n        levelUpButtonBg.hidden = true;\r\n        levelUpButtonText.hidden = true;\r\n        levelUpCountBadge.hidden = true;\r\n        levelUpCountText.hidden = true;\r\n\r\n        // Click handler for level up button\r\n        levelUpButtonBg.onClick(() => {\r\n            if (progressionSystem && player.pendingLevelUps && player.pendingLevelUps.length > 0) {\r\n                progressionSystem.processPendingLevelUp();\r\n            }\r\n        });\r\n\r\n        // Pulsing glow effect for level up button\r\n        let levelUpGlowTime = 0;\r\n        levelUpButtonBg.onUpdate(() => {\r\n            if (levelUpButtonBg.hidden) return;\r\n\r\n            levelUpGlowTime += k.dt() * 4; // Speed of pulse\r\n            const pulse = (Math.sin(levelUpGlowTime) + 1) / 2; // 0 to 1\r\n\r\n            // Pulse the outline thickness and brightness\r\n            const outlineSize = 3 + pulse * 3; // 3 to 6\r\n            const brightness = 200 + pulse * 55; // 200 to 255\r\n            levelUpButtonBg.outline.width = outlineSize;\r\n            levelUpButtonBg.outline.color = k.rgb(brightness, brightness, 100 + pulse * 155);\r\n\r\n            // Subtle scale pulse\r\n            const scale = 1 + pulse * 0.05;\r\n            levelUpButtonBg.scale = k.vec2(scale, scale);\r\n            levelUpButtonText.scale = k.vec2(scale, scale);\r\n        });\r\n\r\n        // ==========================================\r\n        // TOOLTIP SYSTEM\r\n        // ==========================================\r\n        const tooltip = k.add([\r\n            k.rect(200, 60),\r\n            k.pos(0, 0),\r\n            k.color(0, 0, 0),\r\n            k.opacity(0.9),\r\n            k.outline(2, k.rgb(200, 200, 200)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 10)\r\n        ]);\r\n\r\n        const tooltipText = k.add([\r\n            k.text('', { size: UI_TEXT_SIZES.SMALL, width: 190 }),\r\n            k.pos(5, 5),\r\n            k.color(255, 255, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 11)\r\n        ]);\r\n\r\n        tooltip.hidden = true;\r\n        tooltipText.hidden = true;\r\n\r\n        // Tooltip data for HUD elements\r\n        const tooltipData = {\r\n            level: () => `Level ${player.level}\\nXP: ${player.xp}/${player.xpToNext}\\nProgress: ${Math.floor((player.xp / player.xpToNext) * 100)}%`,\r\n            enemies: () => {\r\n                const remaining = k.get('enemy').length + k.get('miniboss').length;\r\n                return `Enemies Remaining\\nClear all to progress\\nKills this run: ${runStats.enemiesKilled}`;\r\n            },\r\n            currency: () => `Total Credits: ${getCurrency()}\\nUse in shop between floors\\nEarn by killing enemies`,\r\n            weapon: () => {\r\n                const weaponDef = player.weaponDef;\r\n                if (!weaponDef) return 'No weapon equipped';\r\n                return `${weaponDef.name}\\nDamage: ${player.projectileDamage}\\nFire Rate: ${player.fireRate.toFixed(2)}/s\\nDPS: ${(player.projectileDamage * player.fireRate).toFixed(1)}`;\r\n            },\r\n            health: () => `Health: ${Math.floor(player.hp())}/${player.maxHealth}\\nDamage Reduction: ${Math.floor(player.damageReduction * 100)}%`\r\n        };\r\n\r\n        // Show tooltip on hover\r\n        function showTooltip(key, x, y) {\r\n            const data = tooltipData[key];\r\n            if (!data) return;\r\n\r\n            const text = data();\r\n            tooltipText.text = text;\r\n\r\n            // Position tooltip near mouse but keep on screen\r\n            tooltip.pos.x = Math.min(x + 10, k.width() - 210);\r\n            tooltip.pos.y = Math.min(y + 10, k.height() - 70);\r\n            tooltipText.pos.x = tooltip.pos.x + 5;\r\n            tooltipText.pos.y = tooltip.pos.y + 5;\r\n\r\n            tooltip.hidden = false;\r\n            tooltipText.hidden = false;\r\n        }\r\n\r\n        function hideTooltip() {\r\n            tooltip.hidden = true;\r\n            tooltipText.hidden = true;\r\n        }\r\n\r\n        function saveTooltipState() {\r\n            return {\r\n                hidden: tooltip.hidden,\r\n                text: tooltipText.text,\r\n                tooltipX: tooltip.pos.x,\r\n                tooltipY: tooltip.pos.y,\r\n                textX: tooltipText.pos.x,\r\n                textY: tooltipText.pos.y\r\n            };\r\n        }\r\n\r\n        function restoreTooltipState(state) {\r\n            if (!state) return;\r\n            tooltip.hidden = state.hidden;\r\n            tooltipText.hidden = state.hidden;\r\n            tooltipText.text = state.text;\r\n            tooltip.pos.x = state.tooltipX;\r\n            tooltip.pos.y = state.tooltipY;\r\n            tooltipText.pos.x = state.textX;\r\n            tooltipText.pos.y = state.textY;\r\n        }\r\n\r\n        // Export tooltip functions so they can be called from other modules\r\n        k.gameData = k.gameData || {};\r\n        k.gameData.hideTooltip = hideTooltip;\r\n        k.gameData.saveTooltipState = saveTooltipState;\r\n        k.gameData.restoreTooltipState = restoreTooltipState;\r\n        k.gameData.minimap = gameState.minimap;\r\n\r\n        // Initialize object pools for performance optimization\r\n        initObjectPools(k);\r\n\r\n        // Export spatial grids for global access (used by combat.js for optimized queries)\r\n        k.gameData.spatialGrids = spatialGrids;\r\n\r\n        // Cache alive players for optimized enemy targeting (updated each frame)\r\n        k.gameData.alivePlayers = [];\r\n\r\n        // Track split enemies for accurate counter\r\n        k.gameData.additionalEnemiesFromSplits = 0;\r\n        k.gameData.incrementSplitEnemies = (count) => {\r\n            additionalEnemiesFromSplits += count;\r\n            k.gameData.additionalEnemiesFromSplits = additionalEnemiesFromSplits;\r\n        };\r\n        k.gameData.minimapSavedMode = undefined;\r\n        k.gameData.tooltipSavedState = undefined;\r\n\r\n        // Rebuild spatial grids each frame for fast spatial queries\r\n        // Note: Rebuilding is O(n), but enables O(1) queries instead of O(n) per query\r\n        // With multiple queries per frame (collision, explosions, pickups), this is a net win\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            // Cache alive players for optimized enemy targeting\r\n            k.gameData.alivePlayers = k.get('player').filter(p => !p.isDead && p.exists());\r\n\r\n            // Rebuild enemy grid (includes enemies, bosses, minibosses)\r\n            spatialGrids.enemies.clear();\r\n            k.get('enemy').forEach(e => spatialGrids.enemies.insert(e));\r\n            k.get('boss').forEach(b => spatialGrids.enemies.insert(b));\r\n            k.get('miniboss').forEach(m => spatialGrids.enemies.insert(m));\r\n\r\n            // Rebuild pickup grid (includes XP, currency, powerup weapons)\r\n            spatialGrids.pickups.clear();\r\n            k.get('xpPickup').forEach(p => spatialGrids.pickups.insert(p));\r\n            k.get('currencyPickup').forEach(p => spatialGrids.pickups.insert(p));\r\n            k.get('powerupWeaponPickup').forEach(p => spatialGrids.pickups.insert(p));\r\n\r\n            // Obstacles are static, so we only rebuild when entering a new room\r\n            // (We'll add obstacle insertion in room generation code later)\r\n        }));\r\n\r\n        // Update screen shake effect\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            updateScreenShake(k.dt());\r\n        }));\r\n\r\n        // Update synergy effects (berserker, survivalist)\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (k.paused || !player.exists() || player.isDead) return;\r\n\r\n            const dt = k.dt();\r\n\r\n            // Berserker synergy: +50% damage/speed below 30% HP\r\n            // Uses multiplier approach to avoid issues with upgrades changing base stats\r\n            if (player.berserkerEnabled) {\r\n                const hpPercent = player.hp() / player.maxHealth;\r\n                const isBelowThreshold = hpPercent < (player.berserkerThreshold || 0.3);\r\n                const speedMultiplier = 1 + (player.berserkerSpeedBonus || 0.5);\r\n                const damageMultiplier = 1 + (player.berserkerDamageBonus || 0.5);\r\n\r\n                if (isBelowThreshold && !player.berserkerActive) {\r\n                    // Activate berserker mode - apply multiplier to current stats\r\n                    player.berserkerActive = true;\r\n                    player.speed = Math.floor(player.speed * speedMultiplier);\r\n                    player.projectileDamage = Math.floor(player.projectileDamage * damageMultiplier);\r\n                } else if (!isBelowThreshold && player.berserkerActive) {\r\n                    // Deactivate berserker mode - remove multiplier from current stats\r\n                    player.berserkerActive = false;\r\n                    player.speed = Math.floor(player.speed / speedMultiplier);\r\n                    player.projectileDamage = Math.floor(player.projectileDamage / damageMultiplier);\r\n                }\r\n            }\r\n\r\n            // Survivalist synergy: regen 1% HP/sec when out of combat\r\n            if (player.survivalistEnabled) {\r\n                // Update last combat time when player takes damage or deals damage\r\n                // (This is set in combat.js when player takes damage)\r\n\r\n                const timeSinceCombat = k.time() - (player.survivalistLastCombatTime || 0);\r\n                const cooldown = player.survivalistCombatCooldown || 3.0;\r\n\r\n                if (timeSinceCombat >= cooldown && player.hp() < player.maxHealth) {\r\n                    // Out of combat long enough - regenerate\r\n                    const regenPercent = player.survivalistRegenPercent || 0.01;\r\n                    const regenAmount = player.maxHealth * regenPercent * dt;\r\n\r\n                    // Accumulate fractional regen\r\n                    player.survivalistRegenAccum = (player.survivalistRegenAccum || 0) + regenAmount;\r\n\r\n                    if (player.survivalistRegenAccum >= 1) {\r\n                        const healAmount = Math.floor(player.survivalistRegenAccum);\r\n                        player.survivalistRegenAccum -= healAmount;\r\n                        const newHP = Math.min(player.maxHealth, player.hp() + healAmount);\r\n                        player.setHP(newHP);\r\n\r\n                        // Broadcast heal for multiplayer sync\r\n                        if (isMultiplayerActive() && isHost()) {\r\n                            broadcastHealEvent({\r\n                                slotIndex: player.slotIndex,\r\n                                healAmount: healAmount,\r\n                                newHP: newHP,\r\n                                source: 'survivalist'\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }));\r\n\r\n        // Update cosmetic effects (trails, glows)\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (k.paused || !player.exists() || player.isDead) return;\r\n\r\n            const dt = k.dt();\r\n\r\n            // Update glow effect\r\n            if (player.glowEffect) {\r\n                updateGlowEffect(k, player.glowEffect);\r\n            }\r\n\r\n            // Spawn trail particles when player moves\r\n            if (player.trailType && player.trailColor) {\r\n                player.trailTimer = (player.trailTimer || 0) + dt;\r\n                const trailInterval = 0.05; // Spawn trail every 50ms\r\n\r\n                // Check if player has moved\r\n                const dx = player.pos.x - (player.lastTrailPos?.x || player.pos.x);\r\n                const dy = player.pos.y - (player.lastTrailPos?.y || player.pos.y);\r\n                const distMoved = Math.sqrt(dx * dx + dy * dy);\r\n\r\n                if (player.trailTimer >= trailInterval && distMoved > 2) {\r\n                    spawnTrailParticle(k, player.pos.x, player.pos.y, player.trailType, player.trailColor);\r\n                    player.trailTimer = 0;\r\n                    player.lastTrailPos = { x: player.pos.x, y: player.pos.y };\r\n                }\r\n            }\r\n        }));\r\n\r\n        // Hover detection for tooltips\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            // Don't show tooltips when paused or during upgrade draft\r\n            if (k.paused || isUpgradeDraftActive()) {\r\n                return;\r\n            }\r\n\r\n            const mousePos = k.mousePos();\r\n            let hovering = false;\r\n\r\n            // Check level text\r\n            if (mousePos.x >= 20 && mousePos.x <= 180 && mousePos.y >= 20 && mousePos.y <= 35) {\r\n                showTooltip('level', mousePos.x, mousePos.y);\r\n                hovering = true;\r\n            }\r\n            // Check enemy counter\r\n            else if (mousePos.x >= 20 && mousePos.x <= 180 && mousePos.y >= 40 && mousePos.y <= 55 && !enemiesCounter.hidden) {\r\n                showTooltip('enemies', mousePos.x, mousePos.y);\r\n                hovering = true;\r\n            }\r\n            // Check credit counter\r\n            else if (mousePos.x >= k.width() - 130 && mousePos.x <= k.width() - 10 && mousePos.y >= 10 && mousePos.y <= 50) {\r\n                showTooltip('currency', mousePos.x, mousePos.y);\r\n                hovering = true;\r\n            }\r\n            // Check weapon panel\r\n            else if (mousePos.x >= weaponIconX && mousePos.x <= weaponIconX + weaponIconSize &&\r\n                     mousePos.y >= weaponIconY && mousePos.y <= weaponIconY + weaponIconSize) {\r\n                showTooltip('weapon', mousePos.x, mousePos.y);\r\n                hovering = true;\r\n            }\r\n            // Health bar tooltip removed - health bar moves with player\r\n\r\n            if (!hovering) {\r\n                hideTooltip();\r\n            }\r\n        }));\r\n\r\n        // Boss HUD elements (only shown when boss exists)\r\n        const bossNameText = k.add([\r\n            k.text('', { size: UI_TEXT_SIZES.LABEL }),\r\n            k.pos(k.width() / 2, 20),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BOSS_NAME),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY)\r\n        ]);\r\n\r\n        const bossHealthBarBg = k.add([\r\n            k.rect(300, 20),\r\n            k.pos(k.width() / 2, 45),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.outline(2, k.rgb(...UI_COLORS.TEXT_DISABLED)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY)\r\n        ]);\r\n\r\n        const bossHealthBar = k.add([\r\n            k.rect(296, 16),\r\n            k.pos(k.width() / 2, 45),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.HEALTH_LOW),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 1)\r\n        ]);\r\n\r\n        const bossArmorBarBg = k.add([\r\n            k.rect(300, 12),\r\n            k.pos(k.width() / 2, 65),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.outline(2, k.rgb(...UI_COLORS.TEXT_DISABLED)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY)\r\n        ]);\r\n\r\n        const bossArmorBar = k.add([\r\n            k.rect(296, 8),\r\n            k.pos(k.width() / 2, 65),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 1)\r\n        ]);\r\n\r\n        const bossHealthText = k.add([\r\n            k.text('', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2, 45),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n        ]);\r\n\r\n        const bossArmorText = k.add([\r\n            k.text('', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2, 65),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n        ]);\r\n\r\n        // Shield bar (above armor bar)\r\n        const bossShieldBarBg = k.add([\r\n            k.rect(300, 12),\r\n            k.pos(k.width() / 2, 85),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.outline(2, k.rgb(...UI_COLORS.TEXT_DISABLED)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY)\r\n        ]);\r\n\r\n        const bossShieldBar = k.add([\r\n            k.rect(296, 8),\r\n            k.pos(k.width() / 2, 85),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.XP_BAR),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 1)\r\n        ]);\r\n\r\n        const bossShieldText = k.add([\r\n            k.text('', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2, 85),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n        ]);\r\n        \r\n        // Initially hide boss HUD\r\n        bossNameText.hidden = true;\r\n        bossHealthBarBg.hidden = true;\r\n        bossHealthBar.hidden = true;\r\n        bossArmorBarBg.hidden = true;\r\n        bossArmorBar.hidden = true;\r\n        bossHealthText.hidden = true;\r\n        bossArmorText.hidden = true;\r\n        bossShieldBarBg.hidden = true;\r\n        bossShieldBar.hidden = true;\r\n        bossShieldText.hidden = true;\r\n        \r\n        // Update particle system\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (k.paused) return;\r\n            updateParticles(k);\r\n        }));\r\n\r\n        // Update multiplayer system\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (k.paused) return;\r\n            if (isMultiplayerActive()) {\r\n                updateMultiplayer(k.dt());\r\n            }\r\n        }));\r\n\r\n        // Update HUD\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            const currentHP = player.exists() ? player.hp() : 0;\r\n            const healthPercent = player.maxHealth > 0 ? currentHP / player.maxHealth : 1;\r\n\r\n            // Update level text (just show the number)\r\n            levelText.text = `${player.level || 1}`;\r\n\r\n            // Update XP bar\r\n            const xpProgress = player.xpToNext > 0 ? player.xp / player.xpToNext : 0;\r\n            xpBarFill.width = Math.max(0, (xpBarWidth - 34) * xpProgress); // Account for level badge space\r\n            xpBarText.text = formatXP(player.xp, player.xpToNext);\r\n\r\n            // Update credit counter\r\n            creditText.text = getCurrency().toString();\r\n\r\n            // Update player health bar (follows player, only show when damaged)\r\n            if (healthPercent < 1 && player.exists()) {\r\n                playerHealthBarBg.hidden = false;\r\n                playerHealthBarFill.hidden = false;\r\n\r\n                // Position below player\r\n                const healthBarX = player.pos.x;\r\n                const healthBarY = player.pos.y + playerHealthBarOffsetY;\r\n                playerHealthBarBg.pos = k.vec2(healthBarX, healthBarY);\r\n\r\n                // Update health bar width - use k.use() to replace the rect component\r\n                const fillWidth = Math.max(1, (playerHealthBarWidth - 2) * healthPercent);\r\n                playerHealthBarFill.use(k.rect(fillWidth, playerHealthBarHeight - 2));\r\n\r\n                // Position fill aligned to left edge of background\r\n                const fillBarX = healthBarX - (playerHealthBarWidth / 2) + 1 + (fillWidth / 2);\r\n                playerHealthBarFill.pos = k.vec2(fillBarX, healthBarY);\r\n\r\n                // Color based on health percentage\r\n                if (healthPercent > 0.6) {\r\n                    playerHealthBarFill.color = k.rgb(100, 255, 100); // Green\r\n                } else if (healthPercent > 0.3) {\r\n                    playerHealthBarFill.color = k.rgb(255, 200, 0); // Yellow/Orange\r\n                } else {\r\n                    playerHealthBarFill.color = k.rgb(255, 50, 50); // Red\r\n                }\r\n            } else {\r\n                playerHealthBarBg.hidden = true;\r\n                playerHealthBarFill.hidden = true;\r\n            }\r\n\r\n            // Update enemies counter (only show in regular rooms, not boss rooms)\r\n            if (!isBossRoom && !roomCompleted) {\r\n                const currentEnemies = k.get('enemy').length;\r\n                // Include split enemies in total count\r\n                const totalEnemies = enemiesToSpawn + additionalEnemiesFromSplits + (isMinibossRoom ? 1 : 0); // Include miniboss and split enemies\r\n                const currentMinibosses = k.get('miniboss').length;\r\n                // Calculate remaining: current alive + not yet spawned\r\n                const remainingEnemies = currentEnemies + currentMinibosses + Math.max(0, totalEnemies - enemiesSpawned - additionalEnemiesFromSplits - (isMinibossRoom && minibossSpawned ? 1 : 0));\r\n                enemiesCounter.text = `${remainingEnemies}/${totalEnemies}`;\r\n                enemiesCounter.hidden = false;\r\n                enemyIcon.hidden = false;\r\n            } else {\r\n                enemiesCounter.hidden = true;\r\n                enemyIcon.hidden = true;\r\n            }\r\n\r\n            // Update weapon indicator\r\n            if (player.exists() && player.weaponDef) {\r\n                const weaponDef = player.weaponDef;\r\n                const dps = (player.projectileDamage * player.fireRate).toFixed(1);\r\n\r\n                // Update weapon icon\r\n                weaponIconText.text = weaponDef.icon || '';\r\n                weaponIconText.color = k.rgb(...weaponDef.color);\r\n\r\n                // Update weapon detail popup info (always update, even when hidden)\r\n                weaponDetailIcon.text = weaponDef.icon || '';\r\n                weaponDetailIcon.color = k.rgb(...weaponDef.color);\r\n                weaponDetailName.text = weaponDef.name;\r\n                // Ensure name color is always white/primary (explicitly set to prevent color issues)\r\n                weaponDetailName.color = k.rgb(...UI_COLORS.TEXT_PRIMARY);\r\n                weaponDetailDamage.text = `DMG: ${player.projectileDamage}`;\r\n                weaponDetailFireRate.text = `RATE: ${player.fireRate.toFixed(2)}/s`;\r\n                weaponDetailDPS.text = `DPS: ${dps}`;\r\n\r\n                // Show weapon details when paused (save state before showing)\r\n                // But NOT during hit freeze - only show on actual user pause\r\n                if (k.paused && !isInHitFreeze()) {\r\n                    // Save current state before forcing it visible\r\n                    if (k.gameData.weaponDetailSavedState === undefined) {\r\n                        k.gameData.weaponDetailSavedState = weaponDetailState;\r\n                    }\r\n                    // Force visible when paused (regardless of saved state)\r\n                    weaponDetailBg.hidden = false;\r\n                    weaponDetailIcon.hidden = false;\r\n                    weaponDetailName.hidden = false;\r\n                    weaponDetailDamage.hidden = false;\r\n                    weaponDetailFireRate.hidden = false;\r\n                    weaponDetailDPS.hidden = false;\r\n                } else {\r\n                    // When not paused, respect the weaponDetailState\r\n                    weaponDetailBg.hidden = !weaponDetailState;\r\n                    weaponDetailIcon.hidden = !weaponDetailState;\r\n                    weaponDetailName.hidden = !weaponDetailState;\r\n                    weaponDetailDamage.hidden = !weaponDetailState;\r\n                    weaponDetailFireRate.hidden = !weaponDetailState;\r\n                    weaponDetailDPS.hidden = !weaponDetailState;\r\n                }\r\n            }\r\n\r\n            // Update powerup weapon indicator and countdown\r\n            if (player.exists()) {\r\n                // Update time-based powerups\r\n                updatePowerupWeapon(player, k.dt());\r\n\r\n                // Update powerup HUD display\r\n                const powerupDisplay = getPowerupDisplay(player);\r\n                if (powerupDisplay) {\r\n                    // Show powerup indicator\r\n                    powerupIconBg.hidden = false;\r\n                    powerupIconText.hidden = false;\r\n                    powerupAmmoText.hidden = false;\r\n\r\n                    // Update icon and color\r\n                    powerupIconText.text = powerupDisplay.icon;\r\n                    powerupIconText.color = k.rgb(...powerupDisplay.color);\r\n                    powerupIconBg.outline.color = k.rgb(...powerupDisplay.color);\r\n\r\n                    // Update ammo/duration text\r\n                    if (powerupDisplay.isAmmoBased) {\r\n                        powerupAmmoText.text = `${powerupDisplay.ammo}`;\r\n                    } else if (powerupDisplay.isTimeBased) {\r\n                        powerupAmmoText.text = `${Math.ceil(powerupDisplay.duration)}s`;\r\n                    }\r\n                } else {\r\n                    // Hide powerup indicator\r\n                    powerupIconBg.hidden = true;\r\n                    powerupIconText.hidden = true;\r\n                    powerupAmmoText.hidden = true;\r\n                }\r\n            }\r\n\r\n            // Update buff display (call periodically, not every frame for performance)\r\n            if (k.time() % 0.5 < k.dt()) {\r\n                updateBuffDisplay();\r\n            }\r\n\r\n            // Update level up button visibility and count\r\n            if (player.exists() && player.pendingLevelUps && player.pendingLevelUps.length > 0) {\r\n                // Show button\r\n                levelUpButtonBg.hidden = false;\r\n                levelUpButtonText.hidden = false;\r\n\r\n                // Show/hide count badge based on pending level ups\r\n                const pendingCount = player.pendingLevelUps.length;\r\n                if (pendingCount > 1) {\r\n                    levelUpCountBadge.hidden = false;\r\n                    levelUpCountText.hidden = false;\r\n                    levelUpCountText.text = pendingCount.toString();\r\n                } else {\r\n                    levelUpCountBadge.hidden = true;\r\n                    levelUpCountText.hidden = true;\r\n                }\r\n            } else {\r\n                // Hide button when no pending level ups\r\n                levelUpButtonBg.hidden = true;\r\n                levelUpButtonText.hidden = true;\r\n                levelUpCountBadge.hidden = true;\r\n                levelUpCountText.hidden = true;\r\n            }\r\n\r\n            // Update boss HUD\r\n            const bosses = k.get('boss');\r\n            const twinGuardians = bosses.filter(b => b.type === 'twinGuardianMelee' || b.type === 'twinGuardianRanged');\r\n            \r\n            if (twinGuardians.length > 0) {\r\n                // Special handling for Twin Guardians - show combined health\r\n                const meleeGuardian = twinGuardians.find(b => b.type === 'twinGuardianMelee');\r\n                const rangedGuardian = twinGuardians.find(b => b.type === 'twinGuardianRanged');\r\n                \r\n                if (meleeGuardian && rangedGuardian && (meleeGuardian.exists() || rangedGuardian.exists())) {\r\n                    // Show boss HUD\r\n                    bossNameText.hidden = false;\r\n                    bossNameText.text = 'THE CO-HOSTS';\r\n                    \r\n                    // Calculate combined health\r\n                    const meleeHP = meleeGuardian.exists() ? meleeGuardian.hp() : 0;\r\n                    const rangedHP = rangedGuardian.exists() ? rangedGuardian.hp() : 0;\r\n                    const totalHP = meleeHP + rangedHP;\r\n                    const totalMaxHP = (meleeGuardian.maxHealth || 0) + (rangedGuardian.maxHealth || 0);\r\n                    \r\n                    // Show combined health bar\r\n                    const healthPercent = totalMaxHP > 0 ? Math.max(0, Math.min(1, totalHP / totalMaxHP)) : 0;\r\n                    bossHealthBar.width = 296 * healthPercent;\r\n                    bossHealthBar.pos.x = k.width() / 2 - (296 * (1 - healthPercent)) / 2;\r\n                    bossHealthText.text = `${Math.max(0, Math.floor(totalHP))}/${totalMaxHP}`;\r\n                    bossHealthBarBg.hidden = false;\r\n                    bossHealthBar.hidden = false;\r\n                    bossHealthText.hidden = false;\r\n                    \r\n                    // Show shields if either has shields\r\n                    const meleeShield = meleeGuardian.exists() ? (meleeGuardian.shieldHealth || 0) : 0;\r\n                    const rangedShield = rangedGuardian.exists() ? (rangedGuardian.shieldHealth || 0) : 0;\r\n                    const totalShield = meleeShield + rangedShield;\r\n                    const totalMaxShield = (meleeGuardian.maxShieldHealth || 0) + (rangedGuardian.maxShieldHealth || 0);\r\n                    \r\n                    if (totalMaxShield > 0) {\r\n                        const shieldPercent = Math.max(0, Math.min(1, totalShield / totalMaxShield));\r\n                        bossShieldBar.width = 296 * shieldPercent;\r\n                        bossShieldBar.pos.x = k.width() / 2 - (296 * (1 - shieldPercent)) / 2;\r\n                        bossShieldText.text = `Shield: ${Math.max(0, Math.floor(totalShield))}/${totalMaxShield}`;\r\n                        bossShieldBarBg.hidden = false;\r\n                        bossShieldBar.hidden = false;\r\n                        bossShieldText.hidden = false;\r\n                    } else {\r\n                        bossShieldBarBg.hidden = true;\r\n                        bossShieldBar.hidden = true;\r\n                        bossShieldText.hidden = true;\r\n                    }\r\n                    \r\n                    // Show armor if either has armor\r\n                    const meleeArmor = meleeGuardian.exists() ? (meleeGuardian.armorHealth || 0) : 0;\r\n                    const rangedArmor = rangedGuardian.exists() ? (rangedGuardian.armorHealth || 0) : 0;\r\n                    const totalArmor = meleeArmor + rangedArmor;\r\n                    const totalMaxArmor = (meleeGuardian.maxArmorHealth || 0) + (rangedGuardian.maxArmorHealth || 0);\r\n                    \r\n                    if (totalMaxArmor > 0) {\r\n                        const armorPercent = Math.max(0, Math.min(1, totalArmor / totalMaxArmor));\r\n                        bossArmorBar.width = 296 * armorPercent;\r\n                        bossArmorBar.pos.x = k.width() / 2 - (296 * (1 - armorPercent)) / 2;\r\n                        bossArmorText.text = `Armor: ${Math.max(0, Math.floor(totalArmor))}/${totalMaxArmor}`;\r\n                        bossArmorBarBg.hidden = false;\r\n                        bossArmorBar.hidden = false;\r\n                        bossArmorText.hidden = false;\r\n                    } else {\r\n                        bossArmorBarBg.hidden = true;\r\n                        bossArmorBar.hidden = true;\r\n                        bossArmorText.hidden = true;\r\n                    }\r\n                    \r\n                    // Change health bar color based on health percentage\r\n                    if (healthPercent > 0.6) {\r\n                        bossHealthBar.color = k.rgb(255, 50, 50); // Red\r\n                    } else if (healthPercent > 0.3) {\r\n                        bossHealthBar.color = k.rgb(255, 150, 50); // Orange\r\n                    } else {\r\n                        bossHealthBar.color = k.rgb(255, 200, 0); // Yellow (critical)\r\n                    }\r\n                } else {\r\n                    // One guardian dead, show remaining one\r\n                    const remainingBoss = meleeGuardian?.exists() ? meleeGuardian : rangedGuardian;\r\n                    if (remainingBoss) {\r\n                        const bossHP = remainingBoss.hp();\r\n                        const bossMaxHP = remainingBoss.maxHealth;\r\n                        const bossShieldHP = remainingBoss.shieldHealth || 0;\r\n                        const bossMaxShieldHP = remainingBoss.maxShieldHealth || 0;\r\n                        const bossArmorHP = remainingBoss.armorHealth || 0;\r\n                        const bossMaxArmorHP = remainingBoss.maxArmorHealth || 0;\r\n                        \r\n                        bossNameText.hidden = false;\r\n                        bossNameText.text = remainingBoss.enraged ? 'THE CO-HOSTS (ENRAGED)' : 'THE CO-HOSTS';\r\n                        \r\n                        const healthPercent = Math.max(0, Math.min(1, bossHP / bossMaxHP));\r\n                        bossHealthBar.width = 296 * healthPercent;\r\n                        bossHealthBar.pos.x = k.width() / 2 - (296 * (1 - healthPercent)) / 2;\r\n                        bossHealthText.text = `${Math.max(0, Math.floor(bossHP))}/${bossMaxHP}`;\r\n                        bossHealthBarBg.hidden = false;\r\n                        bossHealthBar.hidden = false;\r\n                        bossHealthText.hidden = false;\r\n                        \r\n                        // Show shields\r\n                        if (bossMaxShieldHP > 0) {\r\n                            const shieldPercent = Math.max(0, Math.min(1, bossShieldHP / bossMaxShieldHP));\r\n                            bossShieldBar.width = 296 * shieldPercent;\r\n                            bossShieldBar.pos.x = k.width() / 2 - (296 * (1 - shieldPercent)) / 2;\r\n                            bossShieldText.text = `Shield: ${Math.max(0, Math.floor(bossShieldHP))}/${bossMaxShieldHP}`;\r\n                            bossShieldBarBg.hidden = false;\r\n                            bossShieldBar.hidden = false;\r\n                            bossShieldText.hidden = false;\r\n                        } else {\r\n                            bossShieldBarBg.hidden = true;\r\n                            bossShieldBar.hidden = true;\r\n                            bossShieldText.hidden = true;\r\n                        }\r\n                        \r\n                        if (bossMaxArmorHP > 0) {\r\n                            const armorPercent = Math.max(0, Math.min(1, bossArmorHP / bossMaxArmorHP));\r\n                            bossArmorBar.width = 296 * armorPercent;\r\n                            bossArmorBar.pos.x = k.width() / 2 - (296 * (1 - armorPercent)) / 2;\r\n                            bossArmorText.text = `Armor: ${Math.max(0, Math.floor(bossArmorHP))}/${bossMaxArmorHP}`;\r\n                            bossArmorBarBg.hidden = false;\r\n                            bossArmorBar.hidden = false;\r\n                            bossArmorText.hidden = false;\r\n                        } else {\r\n                            bossArmorBarBg.hidden = true;\r\n                            bossArmorBar.hidden = true;\r\n                            bossArmorText.hidden = true;\r\n                        }\r\n                        \r\n                        if (healthPercent > 0.6) {\r\n                            bossHealthBar.color = k.rgb(255, 50, 50);\r\n                        } else if (healthPercent > 0.3) {\r\n                            bossHealthBar.color = k.rgb(255, 150, 50);\r\n                        } else {\r\n                            bossHealthBar.color = k.rgb(255, 200, 0);\r\n                        }\r\n                    } else {\r\n                        // Both dead, hide HUD\r\n                        bossNameText.hidden = true;\r\n                        bossHealthBarBg.hidden = true;\r\n                        bossHealthBar.hidden = true;\r\n                        bossArmorBarBg.hidden = true;\r\n                        bossArmorBar.hidden = true;\r\n                        bossHealthText.hidden = true;\r\n                        bossArmorText.hidden = true;\r\n                    }\r\n                }\r\n            } else if (bosses.length > 0 && bosses[0].exists()) {\r\n                // Regular single boss\r\n                const boss = bosses[0];\r\n                const bossHP = boss.hp();\r\n                const bossMaxHP = boss.maxHealth;\r\n                const bossShieldHP = boss.shieldHealth || 0;\r\n                const bossMaxShieldHP = boss.maxShieldHealth || 0;\r\n                const bossArmorHP = boss.armorHealth || 0;\r\n                const bossMaxArmorHP = boss.maxArmorHealth || 0;\r\n                \r\n                // Get boss name from data files\r\n                let bossName = 'BOSS';\r\n                if (boss.type === 'twinGuardianMelee' || boss.type === 'twinGuardianRanged') {\r\n                    bossName = 'THE CO-HOSTS';\r\n                } else if (BOSS_TYPES[boss.type]?.name) {\r\n                    bossName = `THE ${BOSS_TYPES[boss.type].name.toUpperCase()}`;\r\n                }\r\n                \r\n                // Show boss HUD\r\n                bossNameText.hidden = false;\r\n                bossHealthBarBg.hidden = false;\r\n                bossHealthBar.hidden = false;\r\n                bossArmorBarBg.hidden = false;\r\n                bossArmorBar.hidden = false;\r\n                bossHealthText.hidden = false;\r\n                bossArmorText.hidden = false;\r\n                \r\n                // Update boss name\r\n                bossNameText.text = bossName;\r\n                \r\n                // Update health bar\r\n                const healthPercent = Math.max(0, Math.min(1, bossHP / bossMaxHP));\r\n                bossHealthBar.width = 296 * healthPercent;\r\n                bossHealthBar.pos.x = k.width() / 2 - (296 * (1 - healthPercent)) / 2;\r\n                bossHealthText.text = `${Math.max(0, Math.floor(bossHP))}/${bossMaxHP}`;\r\n                \r\n                // Update shield bar (only show if shields exist)\r\n                if (bossMaxShieldHP > 0) {\r\n                    const shieldPercent = Math.max(0, Math.min(1, bossShieldHP / bossMaxShieldHP));\r\n                    bossShieldBar.width = 296 * shieldPercent;\r\n                    bossShieldBar.pos.x = k.width() / 2 - (296 * (1 - shieldPercent)) / 2;\r\n                    bossShieldText.text = `Shield: ${Math.max(0, Math.floor(bossShieldHP))}/${bossMaxShieldHP}`;\r\n                    bossShieldBarBg.hidden = false;\r\n                    bossShieldBar.hidden = false;\r\n                    bossShieldText.hidden = false;\r\n                } else {\r\n                    bossShieldBarBg.hidden = true;\r\n                    bossShieldBar.hidden = true;\r\n                    bossShieldText.hidden = true;\r\n                }\r\n                \r\n                // Update armor bar (only show if armor exists)\r\n                if (bossMaxArmorHP > 0) {\r\n                    const armorPercent = Math.max(0, Math.min(1, bossArmorHP / bossMaxArmorHP));\r\n                    bossArmorBar.width = 296 * armorPercent;\r\n                    bossArmorBar.pos.x = k.width() / 2 - (296 * (1 - armorPercent)) / 2;\r\n                    bossArmorText.text = `Armor: ${Math.max(0, Math.floor(bossArmorHP))}/${bossMaxArmorHP}`;\r\n                    bossArmorBarBg.hidden = false;\r\n                    bossArmorBar.hidden = false;\r\n                    bossArmorText.hidden = false;\r\n                } else {\r\n                    bossArmorBarBg.hidden = true;\r\n                    bossArmorBar.hidden = true;\r\n                    bossArmorText.hidden = true;\r\n                }\r\n                \r\n                // Change health bar color based on health percentage\r\n                if (healthPercent > 0.6) {\r\n                    bossHealthBar.color = k.rgb(255, 50, 50); // Red\r\n                } else if (healthPercent > 0.3) {\r\n                    bossHealthBar.color = k.rgb(255, 150, 50); // Orange\r\n                } else {\r\n                    bossHealthBar.color = k.rgb(255, 200, 0); // Yellow (critical)\r\n                }\r\n            } else {\r\n                // Hide boss HUD when no boss\r\n                bossNameText.hidden = true;\r\n                bossHealthBarBg.hidden = true;\r\n                bossHealthBar.hidden = true;\r\n                bossArmorBarBg.hidden = true;\r\n                bossArmorBar.hidden = true;\r\n                bossHealthText.hidden = true;\r\n                bossArmorText.hidden = true;\r\n                bossShieldBarBg.hidden = true;\r\n                bossShieldBar.hidden = true;\r\n                bossShieldText.hidden = true;\r\n            }\r\n        }));\r\n\r\n        // ==========================================\r\n        // NEW ARCHITECTURE: Continuous sync of player entity to PlayerState\r\n        // ==========================================\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (!player.exists() || k.paused) return;\r\n\r\n            const playerState = state.getPlayer(localPlayerId);\r\n            if (!playerState) return;\r\n\r\n            // Update position\r\n            playerState.x = player.pos.x;\r\n            playerState.y = player.pos.y;\r\n            playerState.velocityX = 0; // TODO: track actual velocity\r\n            playerState.velocityY = 0;\r\n\r\n            // Update health\r\n            playerState.health = player.hp();\r\n            playerState.maxHealth = player.maxHealth;\r\n\r\n            // Update progression (in case of level up or XP gain)\r\n            playerState.level = player.level;\r\n            playerState.xp = player.xp;\r\n            playerState.xpToNext = player.xpToNext;\r\n\r\n            // Update combat stats (in case of upgrades)\r\n            playerState.projectileDamage = player.projectileDamage;\r\n            playerState.fireRate = player.fireRate;\r\n            playerState.projectileSpeed = player.projectileSpeed;\r\n            playerState.projectileCount = player.projectileCount || 1;\r\n            playerState.piercing = player.piercing || 0;\r\n            playerState.critChance = player.critChance || 0.05;\r\n            playerState.critDamage = player.critDamage || 2.0;\r\n\r\n            // Update passive stats\r\n            playerState.pickupRadius = player.pickupRadius;\r\n            playerState.defense = player.defense || 0;\r\n\r\n            // Update state flags\r\n            // Use player.isDead flag if set, otherwise fall back to HP check\r\n            playerState.isDead = player.isDead || !player.exists() || player.hp() <= 0;\r\n            playerState.invulnerable = player.invulnerable || false;\r\n\r\n            // Update state time\r\n            state.updateTime(k.dt());\r\n        }));\r\n\r\n        // ==========================================\r\n        // NEW ARCHITECTURE: Sync room/floor state\r\n        // ==========================================\r\n        // Sync legacy gameState to new state system\r\n        state.currentFloor = currentFloor;\r\n        state.currentRoom = currentRoom;\r\n        state.roomCleared = false;\r\n\r\n        // ==========================================\r\n        // NEW ARCHITECTURE: InputManager integration\r\n        // ==========================================\r\n        // Start collecting inputs for the local player each frame\r\n        // (Running in parallel with legacy input for now)\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (k.paused) return;\r\n\r\n            // Get input manager\r\n            const inputMgr = inputManager.getManager();\r\n\r\n            // Collect inputs for this frame\r\n            const inputs = inputMgr.getInputsForFrame([localPlayerId]);\r\n\r\n            // Get input for local player\r\n            const playerInput = inputs.get(localPlayerId);\r\n        }));\r\n\r\n        // ==========================================\r\n        // LEGACY STATE (keeping for now)\r\n        // ==========================================\r\n\r\n        // Room state (roomCompleted declared early for onMessage callbacks)\r\n        let enemiesToSpawn = isBossRoom ? 0 : (24 + (currentFloor - 1) * 6); // No regular enemies in boss rooms (3x multiplier)\r\n        let enemiesSpawned = 0;\r\n        let initialSpawnDelay = 2; // Wait before first spawn\r\n        let bossSpawned = false;\r\n        let minibossSpawned = false;\r\n        let isMinibossRoom = false; // Track if this room has a miniboss\r\n        let entranceDoorExclusionTime = 4; // Seconds to exclude entrance door from enemy spawning (3-5 seconds)\r\n        let roomStartTime = 0; // Track when room started\r\n        let additionalEnemiesFromSplits = 0; // Track extra enemies created by splitting (e.g., slimes)\r\n        \r\n        // Determine if this room should have a miniboss (random chance, not in boss rooms)\r\n        // 15% chance for miniboss room, increases with floor\r\n        // Use seeded RNG for multiplayer consistency, daily runs, or single player\r\n        const roomRng = getSeededRoomRNG() || new SeededRandom(Date.now());\r\n        if (!isBossRoom && currentRoom !== 1) { // Don't spawn miniboss in first room or boss room\r\n            const minibossChance = 0.15 + (currentFloor - 1) * 0.05; // 15% base, +5% per floor\r\n            isMinibossRoom = roomRng.next() < minibossChance;\r\n        }\r\n\r\n        // If miniboss room, reduce normal enemy count\r\n        if (isMinibossRoom) {\r\n            enemiesToSpawn = Math.floor(enemiesToSpawn * 0.5); // Half normal enemies\r\n        }\r\n\r\n        // Get random miniboss type for floor\r\n        // Use seeded RNG for multiplayer consistency\r\n        function getRandomMinibossType(floor, rng) {\r\n            const minibossTypes = ['brute', 'sentinel', 'berserker', 'guardian', 'warlock'];\r\n            // Weight certain types by floor\r\n            if (floor >= 3) {\r\n                // Higher floors get more variety\r\n                return minibossTypes[rng.range(0, minibossTypes.length)];\r\n            } else {\r\n                // Lower floors get simpler types\r\n                const simpleTypes = ['brute', 'berserker', 'guardian'];\r\n                return simpleTypes[rng.range(0, simpleTypes.length)];\r\n            }\r\n        }\r\n        \r\n        // Determine boss type based on floor\r\n        function getBossTypeForFloor(floor) {\r\n            const bossMap = {\r\n                1: 'gatekeeper',\r\n                2: 'swarmQueen',\r\n                3: 'twinGuardian',\r\n                // Default to gatekeeper for floors beyond 3 (can expand later)\r\n            };\r\n            return bossMap[floor] || 'gatekeeper';\r\n        }\r\n        \r\n        // Spawn doors - create at room start for enemy spawning (spawnDoors declared early for onMessage callbacks)\r\n        // doorMargin already declared above for player spawn calculation\r\n\r\n        // Map grid directions to door directions (grid uses up/down/right, doors use north/south/east/west)\r\n        const gridToDoorDirection = {\r\n            'up': 'north',\r\n            'down': 'south',\r\n            'right': 'east'\r\n        };\r\n\r\n        // Get all door positions (we'll determine which are open/blocked based on floor map)\r\n        const allDoorPositions = [\r\n            { x: k.width() / 2, y: doorMargin, direction: 'north', gridDir: 'up' },\r\n            { x: k.width() / 2, y: k.height() - doorMargin, direction: 'south', gridDir: 'down' },\r\n            { x: doorMargin, y: k.height() / 2, direction: 'west', gridDir: null }, // West is always blocked (no backtracking)\r\n            { x: k.width() - doorMargin, y: k.height() / 2, direction: 'east', gridDir: 'right' }\r\n        ];\r\n\r\n        // Get available exits from floor map (only shows unvisited connected rooms)\r\n        const availableExits = gameState.floorMap ? gameState.floorMap.getAvailableExits() : [];\r\n        const availableGridDirs = new Set(availableExits.map(exit => exit.direction));\r\n\r\n        // Create all doors and determine which are blocked\r\n        allDoorPositions.forEach(pos => {\r\n            const spawnDoor = createDoor(k, pos.x, pos.y, pos.direction);\r\n            spawnDoor.open = false;\r\n            spawnDoor.isSpawnDoor = true; // Mark as spawn door\r\n            spawnDoor.gridDirection = pos.gridDir; // Store grid direction for later reference\r\n\r\n            // Block doors that don't lead to available rooms\r\n            // West door is always blocked (no backtracking)\r\n            // Other doors are blocked if not in available exits\r\n            if (pos.gridDir === null || !availableGridDirs.has(pos.gridDir)) {\r\n                spawnDoor.blocked = true;\r\n            }\r\n\r\n            spawnDoor.updateVisual(); // Update appearance based on state\r\n            spawnDoors.push(spawnDoor);\r\n        });\r\n\r\n        // Broadcast door states to clients (with small delay to ensure client has loaded)\r\n        if (partySize > 1 && isHost()) {\r\n            k.wait(0.1, () => {\r\n                const doorStates = {};\r\n                spawnDoors.forEach(door => {\r\n                    doorStates[door.direction] = door.blocked;\r\n                });\r\n                broadcast('door_states', doorStates);\r\n            });\r\n        }\r\n\r\n        // Spawn enemies periodically\r\n        let enemySpawnTimer = 0;\r\n        const enemySpawnInterval = 0.33; // seconds between spawns (3x faster spawn rate)\r\n        \r\n        // Track room start time for entrance door exclusion (after first frame)\r\n        let roomStartTimeSet = false;\r\n\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (k.paused || roomCompleted) return;\r\n\r\n            // Set room start time on first update\r\n            if (!roomStartTimeSet) {\r\n                roomStartTime = k.time();\r\n                roomStartTimeSet = true;\r\n            }\r\n            \r\n            // Boss room logic\r\n            if (isBossRoom) {\r\n                // Spawn boss if not already spawned (only host spawns in multiplayer)\r\n                if (!bossSpawned && (!isMultiplayerActive() || isHost())) {\r\n                    bossSpawned = true;\r\n                    const bossType = getBossTypeForFloor(currentFloor);\r\n\r\n                    // Use seeded RNG for boss spawn position in multiplayer\r\n                    const bossRng = getSeededRoomRNG();\r\n\r\n                    // Special handling for Twin Guardians - spawn from opposite doors\r\n                    if (bossType === 'twinGuardian') {\r\n                        // Strategy: Spawn guardians from opposite sides for dramatic entrance\r\n                        // Exclude the door player entered from to avoid spawning on top of player\r\n                        const availableDoors = spawnDoors.filter(d => d.direction !== gameState.entryDirection);\r\n                        let door1, door2;\r\n\r\n                        if (availableDoors.length >= 2) {\r\n                            // Step 1: Randomize available doors\r\n                            // Use Fisher-Yates shuffle with seeded RNG if in multiplayer\r\n                            const shuffled = [...availableDoors];\r\n                            for (let i = shuffled.length - 1; i > 0; i--) {\r\n                                const j = bossRng ? bossRng.range(0, i + 1) : Math.floor(Math.random() * (i + 1));\r\n                                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\r\n                            }\r\n                            door1 = shuffled[0];\r\n\r\n                            // Step 2: Find the door directly opposite to door1 for maximum dramatic effect\r\n                            const oppositeMap = {\r\n                                'north': 'south',\r\n                                'south': 'north',\r\n                                'east': 'west',\r\n                                'west': 'east'\r\n                            };\r\n\r\n                            // Try to find exact opposite door, fallback to second random door if not found\r\n                            door2 = availableDoors.find(d => d.direction === oppositeMap[door1.direction]) || shuffled[1];\r\n                        } else {\r\n                            // Fallback: Not enough doors available (shouldn't happen normally)\r\n                            // Just use any two available doors\r\n                            door1 = spawnDoors[0];\r\n                            door2 = spawnDoors[spawnDoors.length > 1 ? 1 : 0];\r\n                        }\r\n\r\n                        const twinGuardians = createTwinGuardians(k, door1, door2, currentFloor, bossRng);\r\n\r\n                        // Register bosses for multiplayer\r\n                        if (isMultiplayerActive() && isHost()) {\r\n                            // Twin Guardians returns an array of both guardians\r\n                            if (Array.isArray(twinGuardians)) {\r\n                                twinGuardians.forEach(guardian => {\r\n                                    registerEnemy(guardian, { type: 'twinGuardian', floor: currentFloor });\r\n                                });\r\n                            } else if (twinGuardians) {\r\n                                // Fallback if it returns a single entity\r\n                                registerEnemy(twinGuardians, { type: 'twinGuardian', floor: currentFloor });\r\n                            }\r\n                        }\r\n\r\n                        // Play boss spawn sound\r\n                        playBossSpawn();\r\n\r\n                        // Show boss announcement\r\n                        const announcement = k.add([\r\n                            k.text('THE CO-HOSTS', { size: 32 }),\r\n                            k.pos(k.width() / 2, k.height() / 2 - 100),\r\n                            k.anchor('center'),\r\n                            k.color(255, 100, 100),\r\n                            k.fixed()\r\n                        ]);\r\n                        k.wait(2, () => {\r\n                            if (announcement.exists()) k.destroy(announcement);\r\n                        });\r\n                    } else {\r\n                        // Regular boss spawning\r\n                        // Spawn boss at a door (prefer top door, or random door)\r\n                        // Avoid spawning at entrance door if player entered from one\r\n                        let bossSpawnDoor = spawnDoors.find(d => d.direction === 'north');\r\n                        if (!bossSpawnDoor || (gameState.entryDirection === 'north' && spawnDoors.length > 1)) {\r\n                            // If top door is entrance or doesn't exist, pick random non-entrance door\r\n                            const availableDoors = spawnDoors.filter(d => d.direction !== gameState.entryDirection);\r\n                            if (availableDoors.length > 0) {\r\n                                const doorIndex = bossRng\r\n                                    ? bossRng.range(0, availableDoors.length)\r\n                                    : Math.floor(Math.random() * availableDoors.length);\r\n                                bossSpawnDoor = availableDoors[doorIndex];\r\n                            } else {\r\n                                // Fallback to any door\r\n                                const doorIndex = bossRng\r\n                                    ? bossRng.range(0, spawnDoors.length)\r\n                                    : Math.floor(Math.random() * spawnDoors.length);\r\n                                bossSpawnDoor = spawnDoors[doorIndex];\r\n                            }\r\n                        }\r\n\r\n                        const bossX = bossSpawnDoor ? bossSpawnDoor.pos.x : k.width() / 2;\r\n                        const bossY = bossSpawnDoor ? bossSpawnDoor.pos.y : k.height() / 2;\r\n                        const boss = createBoss(k, bossX, bossY, bossType, currentFloor, bossRng);\r\n\r\n                        // Register boss for multiplayer\r\n                        if (isMultiplayerActive() && isHost()) {\r\n                            registerEnemy(boss, { type: bossType, floor: currentFloor, isBoss: true });\r\n                        }\r\n\r\n                        // Play boss spawn sound\r\n                        playBossSpawn();\r\n\r\n                        // Show boss announcement\r\n                        let bossName = 'BOSS';\r\n                        if (bossType === 'twinGuardian') {\r\n                            bossName = 'THE CO-HOSTS';\r\n                        } else if (BOSS_TYPES[bossType]?.name) {\r\n                            bossName = `THE ${BOSS_TYPES[bossType].name.toUpperCase()}`;\r\n                        }\r\n                        const announcement = k.add([\r\n                            k.text(bossName, { size: 32 }),\r\n                            k.pos(k.width() / 2, k.height() / 2 - 100),\r\n                            k.anchor('center'),\r\n                            k.color(255, 100, 100),\r\n                            k.fixed()\r\n                        ]);\r\n                        k.wait(2, () => {\r\n                            if (announcement.exists()) k.destroy(announcement);\r\n                        });\r\n                    }\r\n                }\r\n                \r\n                // Check if boss is defeated (only host checks in multiplayer)\r\n                if (!isMultiplayerActive() || isHost()) {\r\n                    const bosses = k.get('boss');\r\n                    const bossMinions = k.get('enemy').filter(e => e.isBossMinion); // Check for boss minions\r\n                    // Room completes when boss and all boss minions are defeated\r\n                    if (bosses.length === 0 && bossMinions.length === 0 && !roomCompleted) {\r\n                        roomCompleted = true;\r\n                        handleRoomCompletion();\r\n                    }\r\n                }\r\n                return; // Skip regular enemy spawning in boss rooms\r\n            }\r\n            \r\n            // Miniboss room logic\r\n            // Only host spawns miniboss (clients receive via spawn_entity messages)\r\n            if (isMinibossRoom && !minibossSpawned && (!isMultiplayerActive() || isHost())) {\r\n                // Spawn miniboss after a short delay\r\n                if (k.time() - roomStartTime >= 1.0) {\r\n                    minibossSpawned = true;\r\n                    const minibossType = getRandomMinibossType(currentFloor, roomRng);\r\n\r\n                    // Use seeded RNG for miniboss spawn position in multiplayer\r\n                    const minibossRng = getSeededRoomRNG();\r\n\r\n                    // Spawn miniboss at a random door (avoid entrance door)\r\n                    const availableDoors = spawnDoors.filter(d => d.direction !== gameState.entryDirection);\r\n                    const doorsToUse = availableDoors.length > 0 ? availableDoors : spawnDoors;\r\n                    const doorIndex = minibossRng\r\n                        ? minibossRng.range(0, doorsToUse.length)\r\n                        : Math.floor(Math.random() * doorsToUse.length);\r\n                    const randomDoor = doorsToUse[doorIndex];\r\n\r\n                    const minibossX = randomDoor.pos.x;\r\n                    const minibossY = randomDoor.pos.y;\r\n                    const miniboss = createMiniboss(k, minibossX, minibossY, minibossType, currentFloor);\r\n\r\n                    // Register miniboss for multiplayer sync (only if host)\r\n                    if (isMultiplayerActive() && isHost()) {\r\n                        registerEnemy(miniboss, { type: minibossType, floor: currentFloor });\r\n                    }\r\n\r\n                    // Show miniboss announcement\r\n                    const minibossName = MINIBOSS_TYPES[minibossType]?.name || 'MINIBOSS';\r\n                    const announcement = k.add([\r\n                        k.text(`MINIBOSS: ${minibossName.toUpperCase()}`, { size: 24 }),\r\n                        k.pos(k.width() / 2, k.height() / 2 - 100),\r\n                        k.anchor('center'),\r\n                        k.color(255, 200, 100),\r\n                        k.fixed()\r\n                    ]);\r\n                    k.wait(1.5, () => {\r\n                        if (announcement.exists()) k.destroy(announcement);\r\n                    });\r\n                }\r\n            }\r\n            \r\n            // Regular room logic\r\n            // Check if all enemies and minibosses are defeated\r\n            const currentEnemies = k.get('enemy').length;\r\n            const currentMinibosses = k.get('miniboss').length;\r\n            const allEnemiesSpawned = enemiesSpawned >= enemiesToSpawn;\r\n            const allDefeated = allEnemiesSpawned && currentEnemies === 0 && currentMinibosses === 0;\r\n\r\n            // Only host checks for room completion in multiplayer\r\n            if (allDefeated && !roomCompleted && (!isMultiplayerActive() || isHost())) {\r\n                roomCompleted = true;\r\n                handleRoomCompletion();\r\n            }\r\n            \r\n            // Spawn enemies if we haven't reached the limit\r\n            // Only host spawns enemies (clients receive via spawn_entity messages)\r\n            if (enemiesSpawned < enemiesToSpawn && (!isMultiplayerActive() || isHost())) {\r\n                enemySpawnTimer += k.dt();\r\n                \r\n                // Initial delay before first spawn\r\n                if (enemiesSpawned === 0 && enemySpawnTimer < initialSpawnDelay) {\r\n                    return;\r\n                }\r\n                \r\n                if (enemySpawnTimer >= enemySpawnInterval) {\r\n                    enemySpawnTimer = 0;\r\n                    enemiesSpawned++;\r\n\r\n                    // Get spawn RNG (seeded by room + spawn wave number for multiplayer sync)\r\n                    const spawnRng = getSeededRoomRNG();\r\n\r\n                    // Use consistent seed for this specific spawn\r\n                    if (spawnRng) {\r\n                        // Advance RNG state based on spawn number for unique but deterministic spawns\r\n                        for (let i = 0; i < enemiesSpawned - 1; i++) {\r\n                            spawnRng.next(); // Consume RNG state to make each spawn unique\r\n                        }\r\n                    }\r\n\r\n                    // Spawn enemy from random spawn door\r\n                    // Strategy: Give player breathing room at start by not spawning at entrance\r\n                    if (spawnDoors.length > 0) {\r\n                        const timeSinceRoomStart = k.time() - roomStartTime;\r\n\r\n                        // Exclude entrance door for first few seconds to avoid overwhelming player\r\n                        // This gives them time to assess the room and prepare\r\n                        const excludeEntranceDoor = gameState.entryDirection &&\r\n                                                   timeSinceRoomStart < entranceDoorExclusionTime;\r\n\r\n                        // Filter out entrance door if we're in the exclusion period\r\n                        const availableDoors = excludeEntranceDoor\r\n                            ? spawnDoors.filter(door => door.direction !== gameState.entryDirection)\r\n                            : spawnDoors;\r\n\r\n                        // Safety check: If all doors are excluded (shouldn't happen), use all doors\r\n                        const doorsToUse = availableDoors.length > 0 ? availableDoors : spawnDoors;\r\n\r\n                        // Use seeded RNG for door selection in multiplayer\r\n                        const doorIndex = spawnRng\r\n                            ? spawnRng.range(0, doorsToUse.length)\r\n                            : Math.floor(Math.random() * doorsToUse.length);\r\n                        const randomDoor = doorsToUse[doorIndex];\r\n                        const spawnX = randomDoor.pos.x;\r\n                        const spawnY = randomDoor.pos.y;\r\n\r\n                        // Add slight random offset to avoid stacking (seeded in multiplayer)\r\n                        const offset = 15;\r\n                        const offsetX = spawnX + (spawnRng ? (spawnRng.next() - 0.5) : (Math.random() - 0.5)) * offset;\r\n                        const offsetY = spawnY + (spawnRng ? (spawnRng.next() - 0.5) : (Math.random() - 0.5)) * offset;\r\n\r\n                        // Spawn random enemy type based on floor (host will broadcast this)\r\n                        // Use seeded RNG in multiplayer to ensure consistent enemy types\r\n                        const enemyType = getRandomEnemyType(currentFloor, spawnRng);\r\n                        const enemy = createEnemy(k, offsetX, offsetY, enemyType, currentFloor, spawnRng);\r\n\r\n                        // Try to make elite (10-15% chance on floor 2+)\r\n                        tryMakeElite(k, enemy, currentFloor, spawnRng);\r\n\r\n                        // Register enemy for multiplayer sync (only if host)\r\n                        if (isMultiplayerActive() && isHost()) {\r\n                            registerEnemy(enemy, { type: enemyType, floor: currentFloor, isElite: enemy.isElite, eliteModifier: enemy.eliteModifier });\r\n                        }\r\n                    } else {\r\n                        // Fallback to edge spawning if no doors (shouldn't happen)\r\n                        // Use seeded RNG in multiplayer\r\n                        const side = spawnRng ? spawnRng.range(0, 4) : Math.floor(k.rand(0, 4));\r\n                        let x, y;\r\n\r\n                        switch (side) {\r\n                            case 0: // Top\r\n                                x = spawnRng ? spawnRng.rangeFloat(margin, k.width() - margin) : k.rand(margin, k.width() - margin);\r\n                                y = margin;\r\n                                break;\r\n                            case 1: // Right\r\n                                x = k.width() - margin;\r\n                                y = spawnRng ? spawnRng.rangeFloat(margin, k.height() - margin) : k.rand(margin, k.height() - margin);\r\n                                break;\r\n                            case 2: // Bottom\r\n                                x = spawnRng ? spawnRng.rangeFloat(margin, k.width() - margin) : k.rand(margin, k.width() - margin);\r\n                                y = k.height() - margin;\r\n                                break;\r\n                            case 3: // Left\r\n                                x = margin;\r\n                                y = spawnRng ? spawnRng.rangeFloat(margin, k.height() - margin) : k.rand(margin, k.height() - margin);\r\n                                break;\r\n                        }\r\n\r\n                        // Use seeded RNG in multiplayer to ensure consistent enemy types\r\n                        const enemyType = getRandomEnemyType(currentFloor, spawnRng);\r\n                        const enemy = createEnemy(k, x, y, enemyType, currentFloor, spawnRng);\r\n\r\n                        // Try to make elite (10-15% chance on floor 2+)\r\n                        tryMakeElite(k, enemy, currentFloor, spawnRng);\r\n\r\n                        // Register enemy for multiplayer sync (only if host)\r\n                        if (isMultiplayerActive() && isHost()) {\r\n                            registerEnemy(enemy, { type: enemyType, floor: currentFloor, isElite: enemy.isElite, eliteModifier: enemy.eliteModifier });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }));\r\n\r\n        // Update enemy death handling\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (k.paused) return;\r\n            \r\n            k.get('enemy').forEach(enemy => {\r\n                if (enemy.hp() <= 0 && !enemy.isDead) {\r\n                    enemy.isDead = true;\r\n                    const xpValue = enemy.xpValue;\r\n                    const posX = enemy.pos.x;\r\n                    const posY = enemy.pos.y;\r\n\r\n                    // Clean up health bars before destroying enemy\r\n                    if (enemy.cleanupHealthBars) {\r\n                        enemy.cleanupHealthBars();\r\n                    }\r\n\r\n                    // Handle explosion (damage nearby entities)\r\n                    if (enemy.explodes && enemy.explosionRadius) {\r\n                        const explosionRadius = enemy.explosionRadius;\r\n                        const explosionDamage = enemy.explosionDamage || 15;\r\n\r\n                        // Damage player if in range\r\n                        if (player.exists()) {\r\n                            const distToPlayer = Math.sqrt(\r\n                                Math.pow(player.pos.x - posX, 2) +\r\n                                Math.pow(player.pos.y - posY, 2)\r\n                            );\r\n                            if (distToPlayer <= explosionRadius) {\r\n                                player.takeDamage(explosionDamage);\r\n                            }\r\n                        }\r\n\r\n                        // Damage other enemies in range (optimized with spatial grid)\r\n                        // OLD: k.get('enemy').forEach() - checks ALL enemies (O(n))\r\n                        // NEW: getNearby() - only checks enemies in nearby grid cells (O(1))\r\n                        const nearbyEnemies = spatialGrids.enemies.getNearby(posX, posY, explosionRadius);\r\n                        nearbyEnemies.forEach(other => {\r\n                            if (other === enemy || !other.exists()) return;\r\n                            // Use squared distance to avoid expensive sqrt\r\n                            const dx = other.pos.x - posX;\r\n                            const dy = other.pos.y - posY;\r\n                            const distSq = dx * dx + dy * dy;\r\n                            if (distSq <= explosionRadius * explosionRadius) {\r\n                                other.hurt(explosionDamage);\r\n                            }\r\n                        });\r\n\r\n                        // Spawn larger explosion particle for exploding enemies\r\n                        spawnDeathExplosion(k, posX, posY, {\r\n                            color: [255, 150, 50],\r\n                            scale: 1.5\r\n                        });\r\n                    } else {\r\n                        // Use cosmetic death effect if equipped, otherwise default\r\n                        const deathEffect = gameState.equippedCosmetics?.death;\r\n                        const enemyColor = enemy.originalColor || [255, 100, 100];\r\n                        if (deathEffect && deathEffect !== 'deathNone') {\r\n                            spawnCosmeticDeath(k, posX, posY, deathEffect, enemyColor);\r\n                        } else {\r\n                            spawnDeathExplosion(k, posX, posY, { color: enemyColor });\r\n                        }\r\n                    }\r\n\r\n                    // Handle shrapnel (projectiles in all directions)\r\n                    if (enemy.shrapnel && enemy.shrapnelCount) {\r\n                        const shrapnelCount = enemy.shrapnelCount;\r\n                        const angleStep = (Math.PI * 2) / shrapnelCount;\r\n                        const shrapnelSpeed = 250;\r\n                        const shrapnelDamage = Math.floor((enemy.explosionDamage || 15) * 0.6);\r\n\r\n                        for (let i = 0; i < shrapnelCount; i++) {\r\n                            const angle = angleStep * i;\r\n                            const direction = k.vec2(Math.cos(angle), Math.sin(angle));\r\n                            const projectile = createProjectile(\r\n                                k,\r\n                                posX,\r\n                                posY,\r\n                                direction,\r\n                                shrapnelSpeed,\r\n                                shrapnelDamage,\r\n                                0, // piercing\r\n                                0, // obstaclePiercing\r\n                                false // isCrit\r\n                            );\r\n                            projectile.isEnemyProjectile = true;\r\n                            projectile.color = k.rgb(...enemy.originalColor);\r\n                        }\r\n                    }\r\n\r\n                    // Clean up health bars before destroying enemy\r\n                    if (enemy.cleanupHealthBars && typeof enemy.cleanupHealthBars === 'function') {\r\n                        enemy.cleanupHealthBars();\r\n                    }\r\n\r\n                    // Broadcast enemy death to all players (host broadcasts to clients, client sends to host)\r\n                    if (isMultiplayerActive() && enemy.mpEntityId) {\r\n                        if (isHost()) {\r\n                            // Host broadcasts death to all clients\r\n                            broadcastDeathEvent({\r\n                                entityId: enemy.mpEntityId,\r\n                                entityType: 'enemy',\r\n                                x: posX,\r\n                                y: posY\r\n                            });\r\n                        } else {\r\n                            // Client sends death notification to host\r\n                            // The host will then broadcast to all clients\r\n                            sendEnemyDeath({\r\n                                entityId: enemy.mpEntityId,\r\n                                entityType: 'enemy',\r\n                                x: posX,\r\n                                y: posY\r\n                            });\r\n                        }\r\n                    }\r\n\r\n                    k.destroy(enemy);\r\n\r\n                    // Play enemy death sound\r\n                    playEnemyDeath();\r\n\r\n                    // Track enemy kill by type\r\n                    runStats.enemiesKilled++;\r\n                    const enemyType = enemy.type || enemy.enemyType || 'basic';\r\n                    runStats.killsByType[enemyType] = (runStats.killsByType[enemyType] || 0) + 1;\r\n\r\n                    // Track kill for the player who last hit this enemy\r\n                    const killerSlot = enemy.lastHitBySlot;\r\n                    if (killerSlot !== undefined && players[killerSlot] && players[killerSlot].runStats) {\r\n                        players[killerSlot].runStats.kills++;\r\n                    } else if (player.runStats) {\r\n                        // Fallback to local player if no killer tracked\r\n                        player.runStats.kills++;\r\n                    }\r\n\r\n                    // Only spawn pickups if we're the host (or not in multiplayer)\r\n                    // Pickups will be broadcast to clients via registerPickup()\r\n                    if (!isMultiplayerActive() || isHost()) {\r\n                        // Get loot RNG (seeded for multiplayer to ensure consistent drops)\r\n                        const lootRng = getSeededRoomRNG();\r\n\r\n                        // Spawn XP pickup at enemy position\r\n                        // Note: createXPPickup handles multiplayer registration internally\r\n                        const xpPickup = createXPPickup(k, posX, posY, xpValue);\r\n\r\n                        // Spawn currency drops (1-3 coins with random currency icons)\r\n                        const currencyDropCount = lootRng ? lootRng.range(1, 4) : Math.floor(Math.random() * 3) + 1;\r\n                        const currencyValue = 1; // Each coin is worth 1 currency\r\n                        for (let i = 0; i < currencyDropCount; i++) {\r\n                            // Spread drops slightly\r\n                            const offsetX = lootRng ? (lootRng.next() - 0.5) * 20 : (Math.random() - 0.5) * 20;\r\n                            const offsetY = lootRng ? (lootRng.next() - 0.5) * 20 : (Math.random() - 0.5) * 20;\r\n                            const icon = getRandomCurrencyIcon();\r\n                            // Note: createCurrencyPickup handles multiplayer registration internally\r\n                            const currencyPickup = createCurrencyPickup(k, posX + offsetX, posY + offsetY, currencyValue, icon);\r\n                        }\r\n\r\n                        // Check for powerup weapon drop\r\n                        const powerupDrop = rollPowerupDrop(enemy.type, currentFloor);\r\n                        if (powerupDrop) {\r\n                            // Offset slightly to avoid overlap with other pickups\r\n                            const offsetX = lootRng ? (lootRng.next() - 0.5) * 30 : (Math.random() - 0.5) * 30;\r\n                            const offsetY = lootRng ? (lootRng.next() - 0.5) * 30 : (Math.random() - 0.5) * 30;\r\n                            // Note: createPowerupWeaponPickup handles multiplayer registration internally\r\n                            const powerupPickup = createPowerupWeaponPickup(k, posX + offsetX, posY + offsetY, powerupDrop);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            \r\n            // Update miniboss death handling\r\n            k.get('miniboss').forEach(miniboss => {\r\n                if (miniboss.hp() <= 0 && !miniboss.isDead) {\r\n                    miniboss.isDead = true;\r\n                    const xpValue = miniboss.xpValue;\r\n                    const posX = miniboss.pos.x;\r\n                    const posY = miniboss.pos.y;\r\n\r\n                    // Spawn death explosion particle effect for miniboss\r\n                    spawnDeathExplosion(k, posX, posY, { color: [255, 150, 100], isMiniboss: true });\r\n\r\n                    k.destroy(miniboss);\r\n\r\n                    // Play enemy death sound (louder for miniboss)\r\n                    playEnemyDeath();\r\n\r\n                    // Track miniboss kill by type (counts as enemy too)\r\n                    runStats.enemiesKilled++;\r\n                    const minibossType = miniboss.type || 'miniboss';\r\n                    runStats.killsByType[minibossType] = (runStats.killsByType[minibossType] || 0) + 1;\r\n\r\n                    // Track kill for the player who last hit this miniboss\r\n                    const minibossKillerSlot = miniboss.lastHitBySlot;\r\n                    if (minibossKillerSlot !== undefined && players[minibossKillerSlot] && players[minibossKillerSlot].runStats) {\r\n                        players[minibossKillerSlot].runStats.kills++;\r\n                    } else if (player.runStats) {\r\n                        // Fallback to local player if no killer tracked\r\n                        player.runStats.kills++;\r\n                    }\r\n\r\n                    // Only spawn pickups if we're the host (or not in multiplayer)\r\n                    if (!isMultiplayerActive() || isHost()) {\r\n                        // Get loot RNG (seeded for multiplayer)\r\n                        const lootRng = getSeededRoomRNG();\r\n\r\n                        // Spawn XP pickup at miniboss position (minibosses give more XP than regular enemies)\r\n                        // Note: createXPPickup handles multiplayer registration internally\r\n                        const xpPickup = createXPPickup(k, posX, posY, xpValue);\r\n\r\n                        // Spawn currency drops (10-15 coins with random currency icons)\r\n                        const minibossCurrencyCount = lootRng ? lootRng.range(10, 16) : Math.floor(Math.random() * 6) + 10;\r\n                        const minibossCurrencyValue = 1; // Each coin is worth 1 currency\r\n                        for (let i = 0; i < minibossCurrencyCount; i++) {\r\n                            // Spread drops in a circle\r\n                            const angle = (Math.PI * 2 / minibossCurrencyCount) * i;\r\n                            const radius = lootRng ? (30 + lootRng.next() * 20) : (30 + Math.random() * 20);\r\n                            const offsetX = Math.cos(angle) * radius;\r\n                            const offsetY = Math.sin(angle) * radius;\r\n                            // Note: createCurrencyPickup handles multiplayer registration internally\r\n                            const currencyPickup = createCurrencyPickup(k, posX + offsetX, posY + offsetY, minibossCurrencyValue);\r\n                        }\r\n                    }\r\n\r\n                    // Miniboss death effects (visual feedback)\r\n                    const deathText = k.add([\r\n                        k.text('MINIBOSS DEFEATED!', { size: 20 }),\r\n                        k.pos(posX, posY - 30),\r\n                        k.anchor('center'),\r\n                        k.color(255, 200, 100),\r\n                        k.fixed()\r\n                    ]);\r\n                    k.wait(1.0, () => {\r\n                        if (deathText.exists()) k.destroy(deathText);\r\n                    });\r\n                }\r\n            });\r\n            \r\n            // Update boss death handling\r\n            k.get('boss').forEach(boss => {\r\n                if (boss.hp() <= 0 && !boss.isDead) {\r\n                    boss.isDead = true;\r\n                    const xpValue = boss.xpValue;\r\n                    const posX = boss.pos.x;\r\n                    const posY = boss.pos.y;\r\n\r\n                    // Spawn death explosion particle effect for boss\r\n                    spawnDeathExplosion(k, posX, posY, { color: [255, 200, 100], isBoss: true });\r\n\r\n                    k.destroy(boss);\r\n\r\n                    // Play boss death sound\r\n                    playBossDeath();\r\n\r\n                    // Track boss kill by type (counts as enemy too)\r\n                    runStats.enemiesKilled++;\r\n                    runStats.bossesKilled++;\r\n                    const bossType = boss.type || 'boss';\r\n                    runStats.killsByType[bossType] = (runStats.killsByType[bossType] || 0) + 1;\r\n\r\n                    // Track kill for the player who last hit this boss\r\n                    const bossKillerSlot = boss.lastHitBySlot;\r\n                    if (bossKillerSlot !== undefined && players[bossKillerSlot] && players[bossKillerSlot].runStats) {\r\n                        players[bossKillerSlot].runStats.kills++;\r\n                        players[bossKillerSlot].runStats.bossesKilled++;\r\n                    } else if (player.runStats) {\r\n                        // Fallback to local player if no killer tracked\r\n                        player.runStats.kills++;\r\n                        player.runStats.bossesKilled++;\r\n                    }\r\n\r\n                    // Only spawn pickups if we're the host (or not in multiplayer)\r\n                    if (!isMultiplayerActive() || isHost()) {\r\n                        // Get loot RNG (seeded for multiplayer)\r\n                        const lootRng = getSeededRoomRNG();\r\n\r\n                        // Spawn XP pickup at boss position (bosses give more XP)\r\n                        // Note: createXPPickup handles multiplayer registration internally\r\n                        const xpPickup = createXPPickup(k, posX, posY, xpValue);\r\n\r\n                        // Spawn currency drops (20-30 coins with SAME currency icon)\r\n                        const bossCurrencyCount = lootRng ? lootRng.range(20, 31) : Math.floor(Math.random() * 11) + 20;\r\n                        const bossCurrencyValue = 1; // Each coin is worth 1 currency\r\n                        const bossCurrencyIcon = getRandomCurrencyIcon(); // Pick ONE icon for all boss drops\r\n                        for (let i = 0; i < bossCurrencyCount; i++) {\r\n                            // Spread drops in a large circle\r\n                            const angle = (Math.PI * 2 / bossCurrencyCount) * i;\r\n                            const radius = lootRng ? (40 + lootRng.next() * 30) : (40 + Math.random() * 30);\r\n                            const offsetX = Math.cos(angle) * radius;\r\n                            const offsetY = Math.sin(angle) * radius;\r\n                            // Use the same icon for all boss drops\r\n                            // Note: createCurrencyPickup handles multiplayer registration internally\r\n                            const currencyPickup = createCurrencyPickup(k, posX + offsetX, posY + offsetY, bossCurrencyValue, bossCurrencyIcon);\r\n                        }\r\n                    }\r\n\r\n                    // Boss death effects (visual feedback)\r\n                    const deathText = k.add([\r\n                        k.text('BOSS DEFEATED!', { size: 24 }),\r\n                        k.pos(posX, posY - 30),\r\n                        k.anchor('center'),\r\n                        k.color(255, 255, 100),\r\n                        k.fixed()\r\n                    ]);\r\n                    k.wait(1.5, () => {\r\n                        if (deathText.exists()) k.destroy(deathText);\r\n                    });\r\n                }\r\n            });\r\n        }));\r\n\r\n        // Handle XP pickup magnetization and collection\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (!player.exists() || k.paused) return;\r\n\r\n            // OPTIMIZATION: Instead of checking ALL pickups, only check pickups near players\r\n            // Get nearby pickups using spatial grid (much faster than k.get('xpPickup'))\r\n            const pickupCheckRadius = player.pickupRadius * 1.5; // Add buffer for safety\r\n            const nearbyPickups = new Set(); // Use Set to avoid duplicates in multiplayer\r\n\r\n            // In single player, only check near the player\r\n            if (partySize === 1) {\r\n                spatialGrids.pickups.getNearby(player.pos.x, player.pos.y, pickupCheckRadius).forEach(p => {\r\n                    if (p.is && p.is('xpPickup')) nearbyPickups.add(p);\r\n                });\r\n            } else {\r\n                // In multiplayer, check near ALL players\r\n                players.forEach(p => {\r\n                    if (!p || !p.exists() || p.isDead) return;\r\n                    spatialGrids.pickups.getNearby(p.pos.x, p.pos.y, pickupCheckRadius).forEach(pickup => {\r\n                        if (pickup.is && pickup.is('xpPickup')) nearbyPickups.add(pickup);\r\n                    });\r\n                });\r\n            }\r\n\r\n            nearbyPickups.forEach(pickup => {\r\n                if (pickup.collected) return;\r\n\r\n                // In multiplayer, check distance to ALL players\r\n                // In single player, only check local player\r\n                let closestPlayer = player;\r\n                let closestDistance = k.vec2(\r\n                    player.pos.x - pickup.pos.x,\r\n                    player.pos.y - pickup.pos.y\r\n                ).len();\r\n\r\n                if (partySize > 1) {\r\n                    // Check all players to find the closest one\r\n                    players.forEach(p => {\r\n                        if (!p || !p.exists() || p.isDead) return;\r\n                        const dist = k.vec2(\r\n                            p.pos.x - pickup.pos.x,\r\n                            p.pos.y - pickup.pos.y\r\n                        ).len();\r\n                        if (dist < closestDistance) {\r\n                            closestDistance = dist;\r\n                            closestPlayer = p;\r\n                        }\r\n                    });\r\n                }\r\n\r\n                // Start magnetizing if within pickup radius (once started, never stops)\r\n                if (!pickup.magnetizing && closestDistance <= closestPlayer.pickupRadius) {\r\n                    pickup.magnetizing = true;\r\n                    pickup.targetPlayer = closestPlayer;\r\n                }\r\n\r\n                // Auto-collect if very close (collection radius is smaller than pickup radius)\r\n                // In multiplayer, only the host handles pickup collection to ensure all players get rewards\r\n                if (closestDistance <= PICKUP_CONFIG.COLLECTION_RADIUS && !pickup.collected) {\r\n                    // In multiplayer, only host collects pickups\r\n                    if (isMultiplayerActive() && !isHost()) {\r\n                        return; // Skip on clients - host will handle collection\r\n                    }\r\n\r\n                    pickup.collected = true; // Set flag FIRST to prevent race conditions\r\n                    playXPPickup();\r\n\r\n                    // In multiplayer, give XP to all players (shared XP)\r\n                    if (partySize > 1) {\r\n                        // HOST: Give XP to local host player and broadcast to clients\r\n                        if (isHost()) {\r\n                            // Give XP to local player\r\n                            if (player.exists() && !player.isDead && player.addXP) {\r\n                                player.addXP(pickup.value);\r\n                            }\r\n                            // Broadcast XP gain to clients\r\n                            broadcastXPGain(pickup.value);\r\n                        } else {\r\n                            // CLIENT: Give XP to local client player (handled by xp_gain broadcast)\r\n                            // Don't add XP here - will be added when receiving broadcast\r\n                        }\r\n                    } else {\r\n                        // Single player: just give to local player\r\n                        player.addXP(pickup.value);\r\n                    }\r\n\r\n                    pickup.isFlyingToUI = true;\r\n                }\r\n            });\r\n        }));\r\n\r\n        // Handle currency pickup magnetization and collection\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (!player.exists() || k.paused) return;\r\n\r\n            // OPTIMIZATION: Only check pickups near players (using spatial grid)\r\n            const pickupCheckRadius = player.pickupRadius * 1.5;\r\n            const nearbyPickups = new Set();\r\n\r\n            if (partySize === 1) {\r\n                spatialGrids.pickups.getNearby(player.pos.x, player.pos.y, pickupCheckRadius).forEach(p => {\r\n                    if (p.is && p.is('currencyPickup')) nearbyPickups.add(p);\r\n                });\r\n            } else {\r\n                players.forEach(p => {\r\n                    if (!p || !p.exists() || p.isDead) return;\r\n                    spatialGrids.pickups.getNearby(p.pos.x, p.pos.y, pickupCheckRadius).forEach(pickup => {\r\n                        if (pickup.is && pickup.is('currencyPickup')) nearbyPickups.add(pickup);\r\n                    });\r\n                });\r\n            }\r\n\r\n            nearbyPickups.forEach(pickup => {\r\n                if (pickup.collected) return;\r\n\r\n                // In multiplayer, check distance to ALL players\r\n                // In single player, only check local player\r\n                let closestPlayer = player;\r\n                let closestDistance = k.vec2(\r\n                    player.pos.x - pickup.pos.x,\r\n                    player.pos.y - pickup.pos.y\r\n                ).len();\r\n\r\n                if (partySize > 1) {\r\n                    // Check all players to find the closest one\r\n                    players.forEach(p => {\r\n                        if (!p || !p.exists() || p.isDead) return;\r\n                        const dist = k.vec2(\r\n                            p.pos.x - pickup.pos.x,\r\n                            p.pos.y - pickup.pos.y\r\n                        ).len();\r\n                        if (dist < closestDistance) {\r\n                            closestDistance = dist;\r\n                            closestPlayer = p;\r\n                        }\r\n                    });\r\n                }\r\n\r\n                // Start magnetizing if within pickup radius (once started, never stops)\r\n                if (!pickup.magnetizing && closestDistance <= closestPlayer.pickupRadius) {\r\n                    pickup.magnetizing = true;\r\n                    pickup.targetPlayer = closestPlayer;\r\n                }\r\n\r\n                // Auto-collect if very close (collection radius is smaller than pickup radius)\r\n                // In multiplayer, only the host handles pickup collection\r\n                if (closestDistance <= PICKUP_CONFIG.COLLECTION_RADIUS && !pickup.collected) {\r\n                    // In multiplayer, only host collects pickups\r\n                    if (isMultiplayerActive() && !isHost()) {\r\n                        return; // Skip on clients - host will handle collection\r\n                    }\r\n\r\n                    pickup.collected = true; // Set flag FIRST to prevent race conditions\r\n                    playCurrencyPickup(); // Coin/cash pickup sound\r\n\r\n                    // In multiplayer, currency is shared (everyone gets it)\r\n                    // Currency is persistent across the run, so just add once\r\n                    addCurrency(pickup.value); // Add currency to persistent storage\r\n\r\n                    // Track credits picked up for the player who collected it\r\n                    if (closestPlayer && closestPlayer.runStats) {\r\n                        closestPlayer.runStats.creditsPickedUp += pickup.value;\r\n                    }\r\n\r\n                    // Broadcast currency gain to clients\r\n                    if (isMultiplayerActive()) {\r\n                        broadcastCurrencyGain(pickup.value);\r\n                    }\r\n\r\n                    pickup.isFlyingToUI = true;\r\n                }\r\n            });\r\n\r\n            // Handle powerup weapon pickup collection (optimized with spatial grid)\r\n            const nearbyPowerups = spatialGrids.pickups.getNearby(player.pos.x, player.pos.y, player.pickupRadius * 1.5);\r\n            nearbyPowerups.forEach(pickup => {\r\n                if (!pickup.is || !pickup.is('powerupWeaponPickup')) return;\r\n                if (pickup.collected) return;\r\n\r\n                const distance = k.vec2(\r\n                    player.pos.x - pickup.pos.x,\r\n                    player.pos.y - pickup.pos.y\r\n                ).len();\r\n\r\n                // Start magnetizing if within pickup radius (once started, never stops)\r\n                if (!pickup.magnetizing && distance <= player.pickupRadius) {\r\n                    pickup.magnetizing = true;\r\n                    pickup.targetPlayer = player;\r\n                }\r\n\r\n                // Auto-collect if very close (collection radius is smaller than pickup radius)\r\n                if (distance <= PICKUP_CONFIG.COLLECTION_RADIUS && !pickup.collected) {\r\n                    // In multiplayer, only host collects pickups\r\n                    if (isMultiplayerActive() && !isHost()) {\r\n                        return; // Skip on clients - host will handle collection\r\n                    }\r\n\r\n                    pickup.collected = true; // Set flag FIRST to prevent race conditions\r\n                    playCurrencyPickup(); // Use currency pickup sound for now\r\n\r\n                    // Apply powerup weapon to player (in multiplayer, applies to all players)\r\n                    if (isMultiplayerActive() && isHost()) {\r\n                        // Apply powerup to all players in party\r\n                        const allPlayers = k.get('player');\r\n                        allPlayers.forEach(p => {\r\n                            applyPowerupWeapon(p, pickup.powerupKey);\r\n                        });\r\n                        // Broadcast powerup application to all clients\r\n                        broadcastPowerupWeaponApplied(pickup.powerupKey);\r\n                    } else {\r\n                        // Singleplayer: apply to local player only\r\n                        applyPowerupWeapon(player, pickup.powerupKey);\r\n                    }\r\n\r\n                    // Visual feedback - flash effect\r\n                    const powerup = POWERUP_WEAPONS[pickup.powerupKey];\r\n                    const flash = k.add([\r\n                        k.text(powerup.icon, { size: 32 }),\r\n                        k.pos(player.pos.x, player.pos.y - 30),\r\n                        k.color(...powerup.color),\r\n                        k.anchor('center'),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT + 1),\r\n                        k.opacity(1)\r\n                    ]);\r\n\r\n                    // Animate flash fading and rising\r\n                    let flashAge = 0;\r\n                    flash.onUpdate(() => {\r\n                        flashAge += k.dt();\r\n                        flash.pos.y -= 50 * k.dt();\r\n                        flash.opacity = Math.max(0, 1 - flashAge / 0.8);\r\n                        if (flashAge >= 0.8) {\r\n                            k.destroy(flash);\r\n                        }\r\n                    });\r\n\r\n                    k.destroy(pickup);\r\n                }\r\n            });\r\n        }));\r\n\r\n        // Track door progress circle for multiplayer\r\n        let doorProgressCircle = null;\r\n        let doorProgressBg = null;\r\n        let doorProgressTime = 0;\r\n        let doorProgressDoor = null;\r\n        let doorProgressIsForced = false;\r\n        const DOOR_PROGRESS_DURATION = 0.5; // seconds when all players present\r\n        const DOOR_FORCE_DURATION = 10; // seconds when only host (force advance)\r\n\r\n        // Client-side: listen for door progress updates from host\r\n        if (isMultiplayerActive() && !isHost()) {\r\n            onMessage('door_progress', (data) => {\r\n                if (data.clear) {\r\n                    // Clear progress UI\r\n                    if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\r\n                    if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\r\n                    doorProgressBg = null;\r\n                    doorProgressCircle = null;\r\n                    return;\r\n                }\r\n\r\n                // Create UI if it doesn't exist\r\n                if (!doorProgressBg || !doorProgressBg.exists()) {\r\n                    doorProgressBg = k.add([\r\n                        k.circle(20),\r\n                        k.pos(data.doorX, data.doorY),\r\n                        k.anchor('center'),\r\n                        k.color(80, 80, 80),\r\n                        k.opacity(0.8),\r\n                        k.z(200),\r\n                        'doorProgress'\r\n                    ]);\r\n\r\n                    doorProgressCircle = k.add([\r\n                        k.circle(18),\r\n                        k.pos(data.doorX, data.doorY),\r\n                        k.anchor('center'),\r\n                        k.color(data.isForced ? 255 : 100, data.isForced ? 200 : 255, data.isForced ? 0 : 100),\r\n                        k.opacity(0),\r\n                        k.z(201),\r\n                        'doorProgress'\r\n                    ]);\r\n                }\r\n\r\n                // Update progress visual\r\n                if (doorProgressCircle && doorProgressCircle.exists()) {\r\n                    doorProgressCircle.opacity = data.progress;\r\n                    doorProgressCircle.scale = k.vec2(data.progress, data.progress);\r\n                    // Update color if mode changed\r\n                    doorProgressCircle.color = k.rgb(\r\n                        data.isForced ? 255 : 100,\r\n                        data.isForced ? 200 : 255,\r\n                        data.isForced ? 0 : 100\r\n                    );\r\n                }\r\n            });\r\n\r\n            // Client-side: listen for barrel damage from host\r\n            onMessage('barrel_damage', (data) => {\r\n                const barrel = findBarrelByPosition(data.x, data.y);\r\n                if (barrel && barrel.exists() && !barrel.isExploding) {\r\n                    // Sync health directly (more reliable than applying damage)\r\n                    barrel.currentHealth = data.currentHealth;\r\n                    barrel.updateHealthBar();\r\n                }\r\n            });\r\n\r\n            // Client-side: listen for barrel explosions from host\r\n            onMessage('barrel_explode', (data) => {\r\n                const barrel = findBarrelByPosition(data.x, data.y);\r\n                if (barrel && barrel.exists() && !barrel.isExploding) {\r\n                    // Trigger local explosion (won't broadcast since we're not host)\r\n                    barrel.explode();\r\n                }\r\n            });\r\n        }\r\n\r\n        // Handle door interaction (proximity-based)\r\n        eventHandlers.updates.push(k.onUpdate(() => {\r\n            if (!player.exists() || k.paused || doorEntered || isUpgradeDraftActive()) return;\r\n\r\n            // In multiplayer, only HOST checks for door transitions\r\n            // Clients wait for room_transition broadcast from host\r\n            if (isMultiplayerActive() && !isHost()) {\r\n                return; // Clients don't check doors - wait for host signal\r\n            }\r\n\r\n            k.get('door').forEach(door => {\r\n                // Only interact with exit doors (not spawn doors, not blocked doors)\r\n                if (!door.open || doorEntered || door.isSpawnDoor || door.blocked) return;\r\n\r\n                // In multiplayer, check player positions\r\n                if (partySize > 1) {\r\n                    let hostInRange = false;\r\n                    let allPlayersInRange = true;\r\n\r\n                    players.forEach((p, index) => {\r\n                        if (!p || !p.exists()) return;\r\n                        if (p.isDead || p.hp() <= 0) return;\r\n\r\n                        const distance = k.vec2(\r\n                            p.pos.x - door.pos.x,\r\n                            p.pos.y - door.pos.y\r\n                        ).len();\r\n\r\n                        const inRange = distance <= 40;\r\n                        if (index === 0) hostInRange = inRange;\r\n                        if (!inRange) allPlayersInRange = false;\r\n                    });\r\n\r\n                    const shouldShowProgress = allPlayersInRange || hostInRange;\r\n                    const isForced = hostInRange && !allPlayersInRange;\r\n                    const duration = isForced ? DOOR_FORCE_DURATION : DOOR_PROGRESS_DURATION;\r\n\r\n                    if (shouldShowProgress) {\r\n                        // Reset if new door or mode changed\r\n                        if (doorProgressDoor !== door || doorProgressIsForced !== isForced) {\r\n                            doorProgressTime = 0;\r\n                            doorProgressDoor = door;\r\n                            doorProgressIsForced = isForced;\r\n\r\n                            if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\r\n                            if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\r\n\r\n                            doorProgressBg = k.add([\r\n                                k.circle(20),\r\n                                k.pos(door.pos.x, door.pos.y),\r\n                                k.anchor('center'),\r\n                                k.color(80, 80, 80),\r\n                                k.opacity(0.8),\r\n                                k.z(200),\r\n                                'doorProgress'\r\n                            ]);\r\n\r\n                            doorProgressCircle = k.add([\r\n                                k.circle(18),\r\n                                k.pos(door.pos.x, door.pos.y),\r\n                                k.anchor('center'),\r\n                                k.color(isForced ? 255 : 100, isForced ? 200 : 255, isForced ? 0 : 100),\r\n                                k.opacity(0),\r\n                                k.z(201),\r\n                                'doorProgress'\r\n                            ]);\r\n                        }\r\n\r\n                        doorProgressTime += k.dt();\r\n                        const progress = Math.min(doorProgressTime / duration, 1);\r\n\r\n                        if (doorProgressCircle && doorProgressCircle.exists()) {\r\n                            doorProgressCircle.opacity = progress;\r\n                            doorProgressCircle.scale = k.vec2(progress, progress);\r\n                        }\r\n\r\n                        // Broadcast to clients\r\n                        if (isMultiplayerActive()) {\r\n                            broadcast('door_progress', {\r\n                                doorX: door.pos.x,\r\n                                doorY: door.pos.y,\r\n                                progress: progress,\r\n                                isForced: isForced\r\n                            });\r\n                        }\r\n\r\n                        if (progress >= 1) {\r\n                            doorEntered = true;\r\n                            playDoorOpen();\r\n                            if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\r\n                            if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\r\n                            doorProgressDoor = null;\r\n                            if (isMultiplayerActive()) {\r\n                                broadcast('door_progress', { progress: 0, clear: true });\r\n                            }\r\n                            handleDoorEntry(door.direction);\r\n                        }\r\n                    } else if (doorProgressDoor === door) {\r\n                        doorProgressTime = 0;\r\n                        doorProgressDoor = null;\r\n                        doorProgressIsForced = false;\r\n                        if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\r\n                        if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\r\n                        if (isMultiplayerActive()) {\r\n                            broadcast('door_progress', { progress: 0, clear: true });\r\n                        }\r\n                    }\r\n                } else {\r\n                    // Single player: use progress bar like multiplayer\r\n                    // Skip if player is dead (prevent race condition with game over)\r\n                    if (player.isDead || player.hp() <= 0) return;\r\n\r\n                    const distance = k.vec2(\r\n                        player.pos.x - door.pos.x,\r\n                        player.pos.y - door.pos.y\r\n                    ).len();\r\n\r\n                    const inRange = distance <= 40;\r\n\r\n                    if (inRange) {\r\n                        // Initialize progress bar if new door\r\n                        if (doorProgressDoor !== door) {\r\n                            doorProgressTime = 0;\r\n                            doorProgressDoor = door;\r\n                            doorProgressIsForced = false;\r\n\r\n                            if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\r\n                            if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\r\n\r\n                            doorProgressBg = k.add([\r\n                                k.circle(20),\r\n                                k.pos(door.pos.x, door.pos.y),\r\n                                k.anchor('center'),\r\n                                k.color(80, 80, 80),\r\n                                k.opacity(0.8),\r\n                                k.z(200),\r\n                                'doorProgress'\r\n                            ]);\r\n\r\n                            doorProgressCircle = k.add([\r\n                                k.circle(18),\r\n                                k.pos(door.pos.x, door.pos.y),\r\n                                k.anchor('center'),\r\n                                k.color(100, 255, 100), // Green for single player\r\n                                k.opacity(0),\r\n                                k.z(201),\r\n                                'doorProgress'\r\n                            ]);\r\n                        }\r\n\r\n                        doorProgressTime += k.dt();\r\n                        const progress = Math.min(doorProgressTime / DOOR_PROGRESS_DURATION, 1);\r\n\r\n                        if (doorProgressCircle && doorProgressCircle.exists()) {\r\n                            doorProgressCircle.opacity = progress;\r\n                            doorProgressCircle.scale = k.vec2(progress, progress);\r\n                        }\r\n\r\n                        if (progress >= 1) {\r\n                            doorEntered = true;\r\n                            playDoorOpen();\r\n                            if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\r\n                            if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\r\n                            doorProgressDoor = null;\r\n                            handleDoorEntry(door.direction);\r\n                        }\r\n                    } else if (doorProgressDoor === door) {\r\n                        // Player left door range - reset progress\r\n                        doorProgressTime = 0;\r\n                        doorProgressDoor = null;\r\n                        doorProgressIsForced = false;\r\n                        if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\r\n                        if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (!doorProgressDoor && doorProgressBg && doorProgressBg.exists()) {\r\n                k.destroy(doorProgressBg);\r\n                k.destroy(doorProgressCircle);\r\n            }\r\n        }));\r\n\r\n        // Spawn reward pickups when room is cleared\r\n        function spawnRoomClearRewards() {\r\n            if (!player.exists()) return;\r\n\r\n            // Determine spawn position (center of room)\r\n            const centerX = k.width() / 2;\r\n            const centerY = k.height() / 2;\r\n\r\n            // Calculate rewards based on floor and whether it's a boss room\r\n            const baseXP = 5;\r\n            const baseCurrency = 3;\r\n\r\n            // Boss rooms give more rewards\r\n            const xpMultiplier = isBossRoom ? 3 : 1;\r\n            const currencyMultiplier = isBossRoom ? 4 : 1;\r\n\r\n            // Floor scaling\r\n            const floorBonus = currentFloor * 0.5;\r\n\r\n            const numXPPickups = Math.floor((baseXP + floorBonus) * xpMultiplier);\r\n            const numCurrencyPickups = Math.floor((baseCurrency + floorBonus) * currencyMultiplier);\r\n\r\n            // Use seeded RNG for multiplayer consistency\r\n            const rewardRng = getSeededRoomRNG();\r\n\r\n            // Spawn XP pickups in a spread pattern\r\n            for (let i = 0; i < numXPPickups; i++) {\r\n                const angle = (Math.PI * 2 * i) / numXPPickups + (rewardRng ? rewardRng.next() : Math.random()) * 0.3;\r\n                const distance = 40 + (rewardRng ? rewardRng.next() : Math.random()) * 60;\r\n                const x = centerX + Math.cos(angle) * distance;\r\n                const y = centerY + Math.sin(angle) * distance;\r\n\r\n                // Each XP pickup is worth more on higher floors\r\n                const xpValue = Math.floor(1 + currentFloor * 0.5);\r\n                // Note: createXPPickup handles multiplayer registration internally\r\n                const xpPickup = createXPPickup(k, x, y, xpValue);\r\n            }\r\n\r\n            // Spawn currency pickups in a spread pattern\r\n            for (let i = 0; i < numCurrencyPickups; i++) {\r\n                const angle = (Math.PI * 2 * i) / numCurrencyPickups + (rewardRng ? rewardRng.next() : Math.random()) * 0.3 + 0.5;\r\n                const distance = 50 + (rewardRng ? rewardRng.next() : Math.random()) * 70;\r\n                const x = centerX + Math.cos(angle) * distance;\r\n                const y = centerY + Math.sin(angle) * distance;\r\n\r\n                // Each currency pickup is worth more on higher floors\r\n                const currencyValue = Math.floor(1 + currentFloor * 0.3);\r\n                const icon = getRandomCurrencyIcon();\r\n                // Note: createCurrencyPickup handles multiplayer registration internally\r\n                const currencyPickup = createCurrencyPickup(k, x, y, currencyValue, icon);\r\n            }\r\n\r\n            // Extra bonus for boss rooms - spawn a few powerup weapons\r\n            if (isBossRoom) {\r\n                const powerupKeys = Object.keys(POWERUP_WEAPONS);\r\n                const numPowerups = 1 + Math.floor((rewardRng ? rewardRng.next() : Math.random()) * 2); // 1-2 powerups\r\n\r\n                for (let i = 0; i < numPowerups; i++) {\r\n                    const angle = (rewardRng ? rewardRng.next() : Math.random()) * Math.PI * 2;\r\n                    const distance = 80 + (rewardRng ? rewardRng.next() : Math.random()) * 40;\r\n                    const x = centerX + Math.cos(angle) * distance;\r\n                    const y = centerY + Math.sin(angle) * distance;\r\n\r\n                    const randomPowerup = powerupKeys[Math.floor((rewardRng ? rewardRng.next() : Math.random()) * powerupKeys.length)];\r\n                    // Note: createPowerupWeaponPickup handles multiplayer registration internally\r\n                    const powerupPickup = createPowerupWeaponPickup(k, x, y, randomPowerup);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Process pending level ups for all players sequentially\r\n        function processPendingLevelUps() {\r\n            // Build a queue of all pending level ups from all players\r\n            const levelUpQueue = [];\r\n\r\n            players.forEach((p) => {\r\n                if (!p) return; // Skip null entries\r\n                if (p.exists() && p.pendingLevelUps && p.pendingLevelUps.length > 0) {\r\n                    p.pendingLevelUps.forEach(level => {\r\n                        levelUpQueue.push({ player: p, level: level });\r\n                    });\r\n                    // Clear the pending level ups now that we've queued them\r\n                    p.pendingLevelUps = [];\r\n                }\r\n            });\r\n\r\n            // If no pending level ups, return early\r\n            if (levelUpQueue.length === 0) {\r\n                return;\r\n            }\r\n\r\n            // Process level ups sequentially\r\n            let currentIndex = 0;\r\n\r\n            function showNextLevelUp() {\r\n                if (currentIndex >= levelUpQueue.length) {\r\n                    return;\r\n                }\r\n\r\n                const { player: levelUpPlayer, level } = levelUpQueue[currentIndex];\r\n                currentIndex++;\r\n\r\n                // Determine player name for display\r\n                const playerName = levelUpPlayer.playerName || (levelUpPlayer.isRemote ? `Player ${levelUpPlayer.slotIndex + 1}` : 'You');\r\n\r\n                // Show tutorial hint for level up\r\n                showLevelUpHint(k);\r\n\r\n                // Show upgrade draft for this player (pass level for proper RNG seeding)\r\n                // Pass per-run rerolls remaining from gameState\r\n                showUpgradeDraft(k, levelUpPlayer, (selected, remainingRerolls) => {\r\n                    // Update gameState with remaining rerolls for per-run persistence\r\n                    if (remainingRerolls !== undefined) {\r\n                        gameState.rerollsRemaining = remainingRerolls;\r\n                    }\r\n                    // Callback when upgrade is selected - show next level up\r\n                    showNextLevelUp();\r\n                }, playerName, level, gameState.rerollsRemaining);\r\n            }\r\n\r\n            // Start showing level ups\r\n            showNextLevelUp();\r\n        }\r\n\r\n        // Handle room completion\r\n        function handleRoomCompletion() {\r\n            // ==========================================\r\n            // NEW ARCHITECTURE: Update state on room completion\r\n            // ==========================================\r\n            state.roomCleared = true;\r\n            state.clearRoom();\r\n\r\n            // Broadcast room completion to clients in multiplayer\r\n            if (isMultiplayerActive() && isHost()) {\r\n                broadcastRoomCompletion();\r\n            }\r\n\r\n            // Revive all dead players in multiplayer\r\n            if (partySize > 1) {\r\n                reviveAllPlayers();\r\n            }\r\n\r\n            // Note: Level ups are now manually triggered via button, not auto-shown\r\n            // if (partySize > 1) {\r\n            //     processPendingLevelUps();\r\n            // }\r\n\r\n            // ==========================================\r\n            // LEGACY STATE\r\n            // ==========================================\r\n            // Track room cleared\r\n            runStats.roomsCleared++;\r\n\r\n            // Check achievements with current run stats (for in-game toasts)\r\n            const playerLevel = player.exists() ? player.level : 1;\r\n            checkAchievements(k, {\r\n                floor: gameState.currentFloor,\r\n                enemiesKilled: runStats.enemiesKilled,\r\n                bossesKilled: runStats.bossesKilled,\r\n                level: playerLevel,\r\n                currencyEarned: 0 // Currency is calculated at game over\r\n            });\r\n\r\n            // Mark room as cleared in floor map\r\n            if (gameState.floorMap && currentRoomNode) {\r\n                gameState.floorMap.markRoomCleared(currentRoomNode.position.x, currentRoomNode.position.y);\r\n            }\r\n\r\n            // Convert spawn doors to exit doors (but keep blocked doors blocked)\r\n            spawnDoors.forEach(door => {\r\n                if (door.exists() && !door.blocked) {\r\n                    door.open = true;\r\n                    door.isSpawnDoor = false; // No longer a spawn door\r\n                    door.updateVisual(); // Refresh door appearance\r\n                }\r\n            });\r\n\r\n            // Special handling for boss rooms: unblock the north door for floor advancement\r\n            // Boss rooms have all doors blocked initially since there are no unvisited rooms\r\n            if (isBossRoom) {\r\n                const northDoor = spawnDoors.find(d => d.direction === 'north');\r\n                if (northDoor && northDoor.exists()) {\r\n                    northDoor.blocked = false;\r\n                    northDoor.open = true;\r\n                    northDoor.isSpawnDoor = false;\r\n                    northDoor.isFloorExit = true; // Mark as floor exit for visual distinction\r\n                    northDoor.updateVisual();\r\n                }\r\n            }\r\n\r\n            // Update minimap to reflect room clear\r\n            if (gameState.minimap) {\r\n                gameState.minimap.update();\r\n            }\r\n\r\n            // Spawn reward pickups (only host spawns in multiplayer)!\r\n            if (!isMultiplayerActive() || isHost()) {\r\n                spawnRoomClearRewards();\r\n            }\r\n\r\n            // Show completion message (different for boss rooms)\r\n            const completionText = isBossRoom \r\n                ? `BOSS DEFEATED! Floor ${currentFloor} Complete! Enter a door to continue`\r\n                : 'Room Cleared! Enter a door to continue';\r\n            const completionMsg = k.add([\r\n                k.text(completionText, { size: 20 }),\r\n                k.pos(k.width() / 2, k.height() - 40),\r\n                k.anchor('center'),\r\n                k.color(100, 255, 100),\r\n                k.fixed(),\r\n                k.z(500)\r\n            ]);\r\n            \r\n            // Remove message after 5 seconds\r\n            k.wait(5, () => {\r\n                if (completionMsg.exists()) {\r\n                    k.destroy(completionMsg);\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Handle door entry\r\n        function handleDoorEntry(direction) {\r\n            // Save ALL players' stats before transitioning (critical for multiplayer)\r\n            gameState.allPlayerStats = players.map((p, index) => {\r\n                if (!p || !p.exists()) return null;\r\n\r\n                return {\r\n                    slotIndex: p.slotIndex !== undefined ? p.slotIndex : index, // Use player's actual slot\r\n                    playerName: p.playerName,\r\n                    isRemote: p.isRemote || false,\r\n                    isDead: p.isDead || false,\r\n                    level: p.level,\r\n                    xp: p.xp,\r\n                    xpToNext: p.xpToNext,\r\n                    maxHealth: p.maxHealth,\r\n                    currentHP: p.hp(),\r\n                    speed: p.slowed ? p.originalSpeed : p.speed, // Save unslowed speed\r\n                    originalSpeed: p.originalSpeed || p.speed,\r\n                    slowed: false, // Always reset slow state on room transition\r\n                    fireRate: p.fireRate,\r\n                    projectileSpeed: p.projectileSpeed,\r\n                    projectileDamage: p.projectileDamage,\r\n                    pickupRadius: p.pickupRadius,\r\n                    xpMultiplier: p.xpMultiplier || 1,\r\n                    // Character key (needed for daily runs and character-specific logic)\r\n                    characterKey: p.characterKey,\r\n                    // Character abilities\r\n                    dodgeChance: p.dodgeChance || 0,\r\n                    damageReduction: p.damageReduction || 0,\r\n                    fireDotMultiplier: p.fireDotMultiplier || 1,\r\n                    invulnerableDuration: p.invulnerableDuration || 1.0,\r\n                    // Advanced weapon stats\r\n                    projectileCount: p.projectileCount || 1,\r\n                    piercing: p.piercing || 0,\r\n                    obstaclePiercing: p.obstaclePiercing || 0,\r\n                    critChance: p.critChance || 0,\r\n                    critDamage: p.critDamage || 2.0,\r\n                    spreadAngle: p.spreadAngle || 0,\r\n                    defense: p.defense || 0,\r\n                    weaponRange: p.weaponRange || 600,\r\n                    // Upgrades (CRITICAL: preserve between rooms)\r\n                    weapons: p.weapons || [],\r\n                    passiveUpgrades: p.passiveUpgrades || [],\r\n                    upgradeStacks: p.upgradeStacks || {},\r\n                    // Synergy tracking\r\n                    selectedUpgrades: p.selectedUpgrades ? Array.from(p.selectedUpgrades) : [],\r\n                    activeSynergies: p.activeSynergies ? Array.from(p.activeSynergies) : [],\r\n                    piercingDamageBonus: p.piercingDamageBonus || 1.0,\r\n                    // Character data (needed for recalculating upgrades)\r\n                    characterData: p.characterData,\r\n                    weaponDef: p.weaponDef,\r\n                    baseProjectileDamage: p.baseProjectileDamage,\r\n                    baseFireRate: p.baseFireRate,\r\n                    baseProjectileSpeed: p.baseProjectileSpeed,\r\n                    // Pending level ups (preserve across room transitions)\r\n                    pendingLevelUps: p.pendingLevelUps || [],\r\n                    // Powerup weapon state\r\n                    powerupWeapon: p.powerupWeapon || null,\r\n                    powerupAmmo: p.powerupAmmo !== undefined ? p.powerupAmmo : null,\r\n                    powerupDuration: p.powerupDuration !== undefined ? p.powerupDuration : null,\r\n                    originalWeapon: p.originalWeapon || null,\r\n                    weaponKey: p.weaponKey,\r\n                    weaponCategory: p.weaponCategory,\r\n                    // Weapon-specific properties (for orbital, explosive, chain weapons)\r\n                    orbitRadius: p.orbitRadius,\r\n                    rotationSpeed: p.rotationSpeed,\r\n                    explosionRadius: p.explosionRadius,\r\n                    explosionDamage: p.explosionDamage,\r\n                    chainRange: p.chainRange,\r\n                    maxJumps: p.maxJumps,\r\n                    chainDamageReduction: p.chainDamageReduction,\r\n                    // Synergy-specific properties\r\n                    thornsPercent: p.thornsPercent || 0,\r\n                    thornsIgnoreArmor: p.thornsIgnoreArmor || false,\r\n                    // Per-player run stats for game over screen\r\n                    runStats: p.runStats || {\r\n                        kills: 0,\r\n                        deaths: 0,\r\n                        revives: 0,\r\n                        damageTaken: 0,\r\n                        damageDealt: 0,\r\n                        creditsPickedUp: 0,\r\n                        xpPickedUp: 0,\r\n                        bossesKilled: 0\r\n                    }\r\n                };\r\n            }).filter(stats => stats !== null);\r\n\r\n            // Also save local player stats for backward compatibility\r\n            const localPlayerStats = gameState.allPlayerStats.find(stats => !stats.isRemote);\r\n            if (localPlayerStats) {\r\n                gameState.playerStats = localPlayerStats;\r\n            }\r\n\r\n            // Calculate entry direction for next room (opposite of exit direction)\r\n            // If player exits north, they enter from south in next room\r\n            const entryDirectionMap = {\r\n                'north': 'south',\r\n                'south': 'north',\r\n                'west': 'east',\r\n                'east': 'west'\r\n            };\r\n            gameState.entryDirection = entryDirectionMap[direction] || null;\r\n\r\n            // ==========================================\r\n            // FLOOR MAP NAVIGATION\r\n            // ==========================================\r\n            // Map door direction to grid direction (needed for broadcast)\r\n            const doorToGridDirection = {\r\n                'north': 'up',\r\n                'south': 'down',\r\n                'east': 'right'\r\n            };\r\n            const gridDirection = doorToGridDirection[direction];\r\n\r\n            if (gameState.floorMap) {\r\n                // Check if we need to advance to next floor (boss defeated)\r\n                // This must be checked BEFORE trying to move, since boss room north door\r\n                // is used for floor advancement and doesn't have a floor map connection\r\n                const isFloorAdvancement = currentRoomNode && currentRoomNode.isBossRoom && currentRoomNode.cleared;\r\n\r\n                if (isFloorAdvancement) {\r\n                    // Floor advancement - going through north door after defeating boss\r\n                    currentFloor++;\r\n\r\n                    // Check for character unlocks based on floor completion\r\n                    const unlocked = checkFloorUnlocks(currentFloor - 1);\r\n                    if (unlocked) {\r\n                        // Show unlock notification (could be enhanced later)\r\n                        const unlockText = k.add([\r\n                            k.text('NEW CHARACTER UNLOCKED!', { size: 24 }),\r\n                            k.pos(k.width() / 2, k.height() / 2 - 50),\r\n                            k.anchor('center'),\r\n                            k.color(100, 255, 100),\r\n                            k.z(300)\r\n                        ]);\r\n                        k.wait(3, () => {\r\n                            if (unlockText.exists()) k.destroy(unlockText);\r\n                        });\r\n                    }\r\n\r\n                    // Reset floor map and room counter for new floor\r\n                    gameState.floorMap = null;\r\n                    gameState.entryDirection = null; // Start from center on new floor\r\n                    currentRoom = 1; // Reset room counter for new floor\r\n\r\n                    // Update new state system for floor transition\r\n                    state.nextFloor();\r\n                } else {\r\n                    // Normal room movement within the floor\r\n                    if (gridDirection) {\r\n                        // Try to move in the floor map\r\n                        const moved = gameState.floorMap.moveToRoom(gridDirection);\r\n                        if (!moved) {\r\n                            console.error('[Game] Failed to move in floor map - should not happen!');\r\n                            // Fallback to old room increment\r\n                            currentRoom++;\r\n                        } else {\r\n                            // Successfully moved\r\n                            currentRoom = gameState.floorMap.getVisitedCount();\r\n                        }\r\n                    } else {\r\n                        console.warn('[Game] Invalid door direction:', direction);\r\n                        currentRoom++;\r\n                    }\r\n\r\n                    // Update new state system for room transition\r\n                    state.nextRoom();\r\n                }\r\n            } else {\r\n                // ==========================================\r\n                // LEGACY ROOM PROGRESSION (fallback if no floor map)\r\n                // ==========================================\r\n                currentRoom++;\r\n\r\n                // Every 3 rooms, advance to next floor\r\n                if (currentRoom > 3) {\r\n                    currentFloor++;\r\n\r\n                    // Check for character unlocks based on floor completion\r\n                    const unlocked = checkFloorUnlocks(currentFloor - 1);\r\n                    if (unlocked) {\r\n                        // Show unlock notification (could be enhanced later)\r\n                        const unlockText = k.add([\r\n                            k.text('NEW CHARACTER UNLOCKED!', { size: 24 }),\r\n                            k.pos(k.width() / 2, k.height() / 2 - 50),\r\n                            k.anchor('center'),\r\n                            k.color(100, 255, 100),\r\n                            k.z(300)\r\n                        ]);\r\n                        k.wait(3, () => {\r\n                            if (unlockText.exists()) k.destroy(unlockText);\r\n                        });\r\n                    }\r\n                    currentRoom = 1;\r\n                    // Reset entry direction when starting new floor (player enters from center on floor start)\r\n                    gameState.entryDirection = null;\r\n\r\n                    // Update new state system for floor transition\r\n                    state.nextFloor();\r\n                } else {\r\n                    // Just advancing to next room\r\n                    state.nextRoom();\r\n                }\r\n            }\r\n\r\n            // ==========================================\r\n            // LEGACY STATE (keeping for now)\r\n            // ==========================================\r\n            // Update persistent state\r\n            gameState.currentFloor = currentFloor;\r\n            gameState.currentRoom = currentRoom;\r\n\r\n            // In multiplayer, broadcast room transition to sync spawn positions and player stats\r\n            if (isMultiplayerActive() && isHost()) {\r\n                // Preselect next room template so we can send it to clients\r\n                const roomRng = getRoomRNG();\r\n                const nextTemplate = getWeightedRoomTemplate(currentFloor, roomRng);\r\n                gameState.roomTemplateKey = nextTemplate.key;\r\n                console.log('[Multiplayer] Host selected next room template:', nextTemplate.key);\r\n\r\n                broadcastRoomTransition(gameState.entryDirection, gameState.allPlayerStats, gridDirection, currentFloor, gameState.roomTemplateKey);\r\n            }\r\n\r\n            // Restart game scene with new room/floor\r\n            k.go('game');\r\n        }\r\n        \r\n        // Game over on player death\r\n        player.onDeath(() => {\r\n            // Cleanup orbital weapons if they exist\r\n            if (player.orbitalOrbs) {\r\n                player.orbitalOrbs.forEach(orb => {\r\n                    if (orb.exists()) k.destroy(orb);\r\n                });\r\n                player.orbitalOrbs = [];\r\n            }\r\n\r\n            // Cleanup glow effect\r\n            if (player.glowEffect && player.glowEffect.exists()) {\r\n                k.destroy(player.glowEffect);\r\n                player.glowEffect = null;\r\n            }\r\n\r\n            // In multiplayer, don't end the game immediately - only host checks if all players are dead\r\n            if (partySize > 1) {\r\n                // Broadcast player death FIRST to prevent race conditions\r\n                if (isMultiplayerActive() && player.slotIndex !== undefined) {\r\n                    broadcastPlayerDeath(player.slotIndex);\r\n                }\r\n\r\n                // Then set death state locally\r\n                player.isDead = true;\r\n                player.canMove = false;\r\n                player.canShoot = false;\r\n\r\n                // Visual indication of death (semi-transparent)\r\n                player.opacity = 0.5;\r\n                if (player.outline && player.outline.exists()) {\r\n                    player.outline.opacity = 0.5;\r\n                }\r\n\r\n                // Only host checks if all players are dead\r\n                if (!isHost()) {\r\n                    return; // Clients don't trigger game over, wait for host event\r\n                }\r\n\r\n                // Check if any other players are still alive (host only)\r\n                const anyPlayerAlive = players.some(p =>\r\n                    p && p.exists() && p.hp() > 0 && !p.isDead\r\n                );\r\n\r\n                if (anyPlayerAlive) {\r\n                    return; // Don't go to game over - other players are still alive\r\n                }\r\n                // Host continues to trigger game over and broadcast to clients\r\n            }\r\n\r\n            // Single player or host: game over as normal\r\n            // Calculate currency earned\r\n            const currencyEarned = calculateCurrencyEarned(runStats);\r\n\r\n            // Add level and currency to run stats for achievement checking\r\n            const fullRunStats = {\r\n                ...runStats,\r\n                level: player.level,\r\n                currencyEarned: currencyEarned\r\n            };\r\n\r\n            // Update persistent stats and add currency\r\n            updateRunStats(fullRunStats);\r\n            addCurrency(currencyEarned);\r\n\r\n            // Record run to history\r\n            const runDuration = runStats.startTime ? Math.floor((Date.now() - runStats.startTime) / 1000) : 0;\r\n            recordRun({\r\n                character: player.characterData?.key || 'survivor',\r\n                weapon: player.weaponKey || 'pistol',\r\n                floorsReached: runStats.floorsReached,\r\n                roomsCleared: runStats.roomsCleared,\r\n                enemiesKilled: runStats.enemiesKilled,\r\n                bossesKilled: runStats.bossesKilled,\r\n                level: player.level || 1,\r\n                currencyEarned: currencyEarned,\r\n                duration: runDuration,\r\n                deathCause: 'Enemy',\r\n                upgrades: player.selectedUpgrades ? Array.from(player.selectedUpgrades) : [],\r\n                synergies: player.activeSynergies ? Array.from(player.activeSynergies) : []\r\n            });\r\n\r\n            // Check for achievements\r\n            checkAchievements(k);\r\n\r\n            // Gather party stats for game over screen\r\n            const partyStats = players.filter(p => p && p.exists()).map(p => ({\r\n                name: p.playerName || 'Player',\r\n                level: p.level || 1,\r\n                characterData: p.characterData,\r\n                kills: p.runStats?.kills || 0,\r\n                deaths: p.runStats?.deaths || 0,\r\n                revives: p.runStats?.revives || 0,\r\n                damageTaken: p.runStats?.damageTaken || 0,\r\n                damageDealt: p.runStats?.damageDealt || 0,\r\n                xpCollected: p.runStats?.xpPickedUp || 0,\r\n                creditsPickedUp: p.runStats?.creditsPickedUp || 0,\r\n                bossesKilled: p.runStats?.bossesKilled || 0\r\n            }));\r\n\r\n            // Broadcast game over to clients (if host in multiplayer)\r\n            if (isMultiplayerActive() && isHost()) {\r\n                broadcastGameOver(runStats, currencyEarned, partyStats);\r\n            }\r\n\r\n            // Cleanup multiplayer\r\n            if (isMultiplayerActive()) {\r\n                cleanupMultiplayer();\r\n            }\r\n\r\n            // Pass run stats to game over scene\r\n            k.go('gameOver', {\r\n                runStats: { ...runStats },\r\n                currencyEarned: currencyEarned,\r\n                partyStats: partyStats,\r\n                isDailyRun: gameState.isDailyRun,\r\n                dailyCharacter: gameState.dailyCharacter\r\n            });\r\n        });\r\n        \r\n        // Pause overlay - styled modal backdrop\r\n        const pauseOverlay = k.add([\r\n            k.rect(300, 260),\r\n            k.pos(k.width() / 2, k.height() / 2),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.opacity(0.95),\r\n            k.outline(3, k.rgb(...UI_COLORS.BORDER)),\r\n            k.fixed(),\r\n            k.z(2000),\r\n            'pauseOverlay'\r\n        ]);\r\n\r\n        // Paused title with H1 styling\r\n        const pauseText = k.add([\r\n            k.text('PAUSED', { size: UI_TEXT_SIZES.H1 * 2 }),\r\n            k.pos(k.width() / 2, k.height() / 2 - 95),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(2001),\r\n            'pauseText'\r\n        ]);\r\n\r\n        // Pause menu buttons using standardized sizes\r\n        const pauseCenterY = k.height() / 2;\r\n        const pauseButtonSpacing = 55;\r\n        const { LG, SM } = UI_SIZES.BUTTON;\r\n\r\n        // Resume button (LG size - primary CTA)\r\n        const resumeButton = k.add([\r\n            k.rect(LG.width, LG.height),\r\n            k.pos(k.width() / 2, pauseCenterY - 20),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.SUCCESS),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(2001),\r\n            'pauseButton'\r\n        ]);\r\n\r\n        const resumeText = k.add([\r\n            k.text('RESUME', { size: UI_TEXT_SIZES.H2 }),\r\n            k.pos(k.width() / 2, pauseCenterY - 20),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(2002),\r\n            'pauseButton'\r\n        ]);\r\n\r\n        // Quit to Menu button (SM size - danger action)\r\n        const quitButton = k.add([\r\n            k.rect(SM.width, SM.height),\r\n            k.pos(k.width() / 2, pauseCenterY + 45),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.DANGER),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(2001),\r\n            'pauseButton'\r\n        ]);\r\n\r\n        const quitText = k.add([\r\n            k.text('QUIT', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2, pauseCenterY + 45),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(2002),\r\n            'pauseButton'\r\n        ]);\r\n        \r\n        // Initially hide pause overlay\r\n        pauseOverlay.hidden = true;\r\n        pauseText.hidden = true;\r\n        k.get('pauseButton').forEach(btn => btn.hidden = true);\r\n\r\n        // Helper function to update pause UI (used by both local and network pause)\r\n        const updatePauseUI = (paused) => {\r\n            if (paused) {\r\n                playPause();\r\n                // Save tooltip state and hide it\r\n                if (k.gameData && k.gameData.saveTooltipState && k.gameData.hideTooltip) {\r\n                    k.gameData.tooltipSavedState = k.gameData.saveTooltipState();\r\n                    k.gameData.hideTooltip();\r\n                }\r\n                // Save current minimap mode and expand it\r\n                if (k.gameData && k.gameData.minimap) {\r\n                    k.gameData.minimapSavedMode = k.gameData.minimap.mode;\r\n                    if (k.gameData.minimap.mode !== 'maximized') {\r\n                        k.gameData.minimap.mode = 'maximized';\r\n                        k.gameData.minimap.update();\r\n                    }\r\n                }\r\n                // Save weapon detail state before showing it\r\n                if (k.gameData.weaponDetailSavedState === undefined) {\r\n                    k.gameData.weaponDetailSavedState = weaponDetailState;\r\n                }\r\n            } else {\r\n                playUnpause();\r\n                // Restore minimap mode\r\n                if (k.gameData && k.gameData.minimap && k.gameData.minimapSavedMode !== undefined) {\r\n                    k.gameData.minimap.mode = k.gameData.minimapSavedMode;\r\n                    k.gameData.minimap.update();\r\n                    k.gameData.minimapSavedMode = undefined;\r\n                }\r\n                // Restore tooltip state\r\n                if (k.gameData && k.gameData.restoreTooltipState && k.gameData.tooltipSavedState) {\r\n                    k.gameData.restoreTooltipState(k.gameData.tooltipSavedState);\r\n                    k.gameData.tooltipSavedState = undefined;\r\n                }\r\n                // Restore weapon detail state\r\n                if (k.gameData && k.gameData.weaponDetailSavedState !== undefined) {\r\n                    weaponDetailState = k.gameData.weaponDetailSavedState;\r\n                    weaponDetailBg.hidden = !weaponDetailState;\r\n                    weaponDetailIcon.hidden = !weaponDetailState;\r\n                    weaponDetailName.hidden = !weaponDetailState;\r\n                    weaponDetailDamage.hidden = !weaponDetailState;\r\n                    weaponDetailFireRate.hidden = !weaponDetailState;\r\n                    weaponDetailDPS.hidden = !weaponDetailState;\r\n                    k.gameData.weaponDetailSavedState = undefined;\r\n                }\r\n            }\r\n\r\n            // Update UI visibility\r\n            pauseOverlay.hidden = !paused;\r\n            pauseText.hidden = !paused;\r\n            k.get('pauseButton').forEach(btn => btn.hidden = !paused);\r\n        };\r\n\r\n        // Register pause UI update callback for network synchronization\r\n        k.gameData.updatePauseUI = updatePauseUI;\r\n        \r\n        // Button handlers\r\n        resumeButton.onClick(() => {\r\n            // Only allow clicking when pause menu is visible\r\n            if (!k.paused || resumeButton.hidden) return;\r\n\r\n            k.paused = false;\r\n            // Restore minimap mode\r\n            if (k.gameData && k.gameData.minimap && k.gameData.minimapSavedMode !== undefined) {\r\n                k.gameData.minimap.mode = k.gameData.minimapSavedMode;\r\n                k.gameData.minimap.update();\r\n                k.gameData.minimapSavedMode = undefined;\r\n            }\r\n            // Restore tooltip state\r\n            if (k.gameData && k.gameData.restoreTooltipState && k.gameData.tooltipSavedState) {\r\n                k.gameData.restoreTooltipState(k.gameData.tooltipSavedState);\r\n                k.gameData.tooltipSavedState = undefined;\r\n            }\r\n            // Restore weapon detail state\r\n            if (k.gameData && k.gameData.weaponDetailSavedState !== undefined) {\r\n                weaponDetailState = k.gameData.weaponDetailSavedState;\r\n                weaponDetailBg.hidden = !weaponDetailState;\r\n                weaponDetailIcon.hidden = !weaponDetailState;\r\n                weaponDetailName.hidden = !weaponDetailState;\r\n                weaponDetailDamage.hidden = !weaponDetailState;\r\n                weaponDetailFireRate.hidden = !weaponDetailState;\r\n                weaponDetailDPS.hidden = !weaponDetailState;\r\n                k.gameData.weaponDetailSavedState = undefined;\r\n            }\r\n            playUnpause();\r\n            pauseOverlay.hidden = true;\r\n            pauseText.hidden = true;\r\n            k.get('pauseButton').forEach(btn => btn.hidden = true);\r\n        });\r\n\r\n        quitButton.onClick(() => {\r\n            // Only allow clicking when pause menu is visible\r\n            if (!k.paused || quitButton.hidden) return;\r\n\r\n            // Handle multiplayer quit logic\r\n            if (isMultiplayerActive()) {\r\n                if (isHost()) {\r\n                    // Host: broadcast quit to all clients, then quit\r\n                    broadcastHostQuit();\r\n                    cleanupMultiplayer();\r\n                    gameState.currentFloor = 1;\r\n                    gameState.currentRoom = 1;\r\n                    gameState.playerStats = null;\r\n                    k.go('menu');\r\n                } else {\r\n                    // Client: show confirmation dialog\r\n                    const confirmOverlay = k.add([\r\n                        k.rect(k.width(), k.height()),\r\n                        k.pos(0, 0),\r\n                        k.color(0, 0, 0),\r\n                        k.opacity(0.8),\r\n                        k.fixed(),\r\n                        k.z(3000),\r\n                        'confirmDialog'\r\n                    ]);\r\n\r\n                    const confirmText = k.add([\r\n                        k.text('Leave party and return to menu?', { size: 20 }),\r\n                        k.pos(k.width() / 2, k.height() / 2 - 50),\r\n                        k.anchor('center'),\r\n                        k.color(255, 255, 255),\r\n                        k.fixed(),\r\n                        k.z(3001),\r\n                        'confirmDialog'\r\n                    ]);\r\n\r\n                    const yesButton = k.add([\r\n                        k.rect(100, 40),\r\n                        k.pos(k.width() / 2 - 60, k.height() / 2 + 10),\r\n                        k.anchor('center'),\r\n                        k.color(50, 150, 50),\r\n                        k.outline(2, k.rgb(100, 200, 100)),\r\n                        k.area(),\r\n                        k.fixed(),\r\n                        k.z(3001),\r\n                        'confirmDialog'\r\n                    ]);\r\n\r\n                    k.add([\r\n                        k.text('Yes', { size: 16 }),\r\n                        k.pos(k.width() / 2 - 60, k.height() / 2 + 10),\r\n                        k.anchor('center'),\r\n                        k.color(255, 255, 255),\r\n                        k.fixed(),\r\n                        k.z(3002),\r\n                        'confirmDialog'\r\n                    ]);\r\n\r\n                    const noButton = k.add([\r\n                        k.rect(100, 40),\r\n                        k.pos(k.width() / 2 + 60, k.height() / 2 + 10),\r\n                        k.anchor('center'),\r\n                        k.color(150, 50, 50),\r\n                        k.outline(2, k.rgb(200, 100, 100)),\r\n                        k.area(),\r\n                        k.fixed(),\r\n                        k.z(3001),\r\n                        'confirmDialog'\r\n                    ]);\r\n\r\n                    k.add([\r\n                        k.text('No', { size: 16 }),\r\n                        k.pos(k.width() / 2 + 60, k.height() / 2 + 10),\r\n                        k.anchor('center'),\r\n                        k.color(255, 255, 255),\r\n                        k.fixed(),\r\n                        k.z(3002),\r\n                        'confirmDialog'\r\n                    ]);\r\n\r\n                    yesButton.onClick(() => {\r\n                        k.get('confirmDialog').forEach(e => k.destroy(e));\r\n                        cleanupMultiplayer();\r\n                        gameState.currentFloor = 1;\r\n                        gameState.currentRoom = 1;\r\n                        gameState.playerStats = null;\r\n                        k.go('menu');\r\n                    });\r\n\r\n                    noButton.onClick(() => {\r\n                        k.get('confirmDialog').forEach(e => k.destroy(e));\r\n                    });\r\n                }\r\n            } else {\r\n                // Single player: just quit\r\n                gameState.currentFloor = 1;\r\n                gameState.currentRoom = 1;\r\n                gameState.playerStats = null;\r\n                k.go('menu');\r\n            }\r\n        });\r\n        \r\n        // Toggle minimap with 'M' key\r\n        eventHandlers.keyPresses.push(k.onKeyPress('m', () => {\r\n            if (gameState.minimap && !k.paused) {\r\n                gameState.minimap.toggle();\r\n            }\r\n        }));\r\n\r\n        // Pause\r\n        eventHandlers.keyPresses.push(k.onKeyPress('escape', () => {\r\n            // Don't allow pause menu if upgrade draft is showing\r\n            if (isUpgradeDraftActive()) {\r\n                return; // Prevent escape key from interfering with upgrade selection\r\n            }\r\n\r\n            // In multiplayer, only host changes pause state locally\r\n            // Clients send request and wait for host response\r\n            if (isMultiplayerActive()) {\r\n                if (isHost()) {\r\n                    // Host: change pause state and broadcast to all clients\r\n                    k.paused = !k.paused;\r\n                    broadcastPauseState(k.paused);\r\n                    updatePauseUI(k.paused);\r\n                } else {\r\n                    // Client: send pause request to host (don't change local state yet)\r\n                    // The pause_state message from host will update our state\r\n                    sendPauseRequest(!k.paused);\r\n                }\r\n            } else {\r\n                // Single-player: change pause state directly\r\n                k.paused = !k.paused;\r\n                updatePauseUI(k.paused);\r\n            }\r\n        }));\r\n\r\n        // Auto-pause on window blur (solo mode only)\r\n        const handleGameBlur = () => {\r\n            // Only auto-pause in solo mode\r\n            if (isMultiplayerActive()) return;\r\n            // Don't pause if already paused or upgrade draft is showing\r\n            if (k.paused || isUpgradeDraftActive()) return;\r\n\r\n            k.paused = true;\r\n            updatePauseUI(true);\r\n        };\r\n        window.addEventListener('blur', handleGameBlur);\r\n\r\n        // Clean up blur listener on scene leave\r\n        k.onSceneLeave(() => {\r\n            window.removeEventListener('blur', handleGameBlur);\r\n        });\r\n\r\n        // Cleanup event handlers on scene leave (memory leak fix)\r\n        k.onSceneLeave(() => {\r\n            // Cancel all update handlers with error protection\r\n            eventHandlers.updates.forEach(handler => {\r\n                try {\r\n                    if (handler && handler.cancel) handler.cancel();\r\n                } catch (err) {\r\n                    console.warn('[Game] Error canceling update handler:', err);\r\n                }\r\n            });\r\n\r\n            // Cancel all keypress handlers with error protection\r\n            eventHandlers.keyPresses.forEach(handler => {\r\n                try {\r\n                    if (handler && handler.cancel) handler.cancel();\r\n                } catch (err) {\r\n                    console.warn('[Game] Error canceling keypress handler:', err);\r\n                }\r\n            });\r\n\r\n            // Unregister network message handlers (if client)\r\n            if (!isHost() && isMultiplayerActive()) {\r\n                try {\r\n                    offMessage('room_transition');\r\n                    offMessage('room_completed');\r\n                    offMessage('game_over');\r\n                } catch (err) {\r\n                    console.warn('[Game] Error unregistering message handlers:', err);\r\n                }\r\n                // Reset the flag to allow re-registration\r\n                gameSceneMessageHandlersRegistered = false;\r\n            }\r\n\r\n            // Destroy minimap on scene leave to prevent lingering elements\r\n            if (gameState.minimap) {\r\n                gameState.minimap.destroy();\r\n                gameState.minimap = null;\r\n            }\r\n\r\n            // Clear object pools on scene leave\r\n            clearAllPools();\r\n        });\r\n    });\r\n}\r\n\r\n","// Portrait definitions and unlock conditions\r\n// Portraits are cosmetic profile images unlocked through gameplay\r\n\r\n/**\r\n * Portrait categories for organization\r\n */\r\nexport const PORTRAIT_CATEGORIES = {\r\n    LEVEL: 'level',      // Unlocked by reaching player levels\r\n    CHARACTER: 'character', // Unlocked by unlocking characters\r\n    ACHIEVEMENT: 'achievement', // Unlocked by achievements\r\n    SPECIAL: 'special'   // Unlocked by special conditions\r\n};\r\n\r\n/**\r\n * Portrait definitions\r\n * Each portrait has:\r\n * - id: Unique identifier\r\n * - name: Display name\r\n * - icon: ASCII character or emoji to display\r\n * - category: Category for organization\r\n * - unlockCondition: How to unlock this portrait\r\n * - description: Flavor text\r\n */\r\nexport const PORTRAITS = {\r\n    // ============ DEFAULT ============\r\n    default: {\r\n        id: 'default',\r\n        name: 'Rookie',\r\n        icon: '',\r\n        color: [200, 200, 200],\r\n        category: PORTRAIT_CATEGORIES.LEVEL,\r\n        unlockCondition: { type: 'default' },\r\n        description: 'Everyone starts somewhere.'\r\n    },\r\n\r\n    // ============ LEVEL-BASED ============\r\n    veteran: {\r\n        id: 'veteran',\r\n        name: 'Veteran',\r\n        icon: '',\r\n        color: [100, 200, 255],\r\n        category: PORTRAIT_CATEGORIES.LEVEL,\r\n        unlockCondition: { type: 'level', value: 10 },\r\n        description: 'A seasoned competitor with many battles under their belt.'\r\n    },\r\n    elite: {\r\n        id: 'elite',\r\n        name: 'Elite',\r\n        icon: '',\r\n        color: [255, 200, 100],\r\n        category: PORTRAIT_CATEGORIES.LEVEL,\r\n        unlockCondition: { type: 'level', value: 25 },\r\n        description: 'Among the top performers in the arena.'\r\n    },\r\n    legend: {\r\n        id: 'legend',\r\n        name: 'Legend',\r\n        icon: '',\r\n        color: [255, 100, 255],\r\n        category: PORTRAIT_CATEGORIES.LEVEL,\r\n        unlockCondition: { type: 'level', value: 50 },\r\n        description: 'A living legend whose name echoes through the halls.'\r\n    },\r\n    champion: {\r\n        id: 'champion',\r\n        name: 'Champion',\r\n        icon: '',\r\n        color: [255, 215, 0],\r\n        category: PORTRAIT_CATEGORIES.LEVEL,\r\n        unlockCondition: { type: 'level', value: 75 },\r\n        description: 'A true champion who has conquered all challenges.'\r\n    },\r\n    immortal: {\r\n        id: 'immortal',\r\n        name: 'Immortal',\r\n        icon: '',\r\n        color: [200, 255, 255],\r\n        category: PORTRAIT_CATEGORIES.LEVEL,\r\n        unlockCondition: { type: 'level', value: 100 },\r\n        description: 'Transcended mortality. A god among players.'\r\n    },\r\n\r\n    // ============ CHARACTER-BASED ============\r\n    survivor: {\r\n        id: 'survivor',\r\n        name: 'Survivor',\r\n        icon: '',\r\n        color: [100, 200, 100],\r\n        category: PORTRAIT_CATEGORIES.CHARACTER,\r\n        unlockCondition: { type: 'character', value: 'survivor' },\r\n        description: 'The default hero. Never gives up.'\r\n    },\r\n    berserker: {\r\n        id: 'berserker',\r\n        name: 'Berserker',\r\n        icon: '',\r\n        color: [255, 100, 100],\r\n        category: PORTRAIT_CATEGORIES.CHARACTER,\r\n        unlockCondition: { type: 'character', value: 'berserker' },\r\n        description: 'Rage incarnate. Pain is just fuel.'\r\n    },\r\n    ranger: {\r\n        id: 'ranger',\r\n        name: 'Ranger',\r\n        icon: '',\r\n        color: [100, 255, 150],\r\n        category: PORTRAIT_CATEGORIES.CHARACTER,\r\n        unlockCondition: { type: 'character', value: 'ranger' },\r\n        description: 'Swift and precise. Death from a distance.'\r\n    },\r\n    mage: {\r\n        id: 'mage',\r\n        name: 'Mage',\r\n        icon: '',\r\n        color: [200, 100, 255],\r\n        category: PORTRAIT_CATEGORIES.CHARACTER,\r\n        unlockCondition: { type: 'character', value: 'mage' },\r\n        description: 'Master of the arcane arts.'\r\n    },\r\n    tank: {\r\n        id: 'tank',\r\n        name: 'Tank',\r\n        icon: '',\r\n        color: [150, 150, 200],\r\n        category: PORTRAIT_CATEGORIES.CHARACTER,\r\n        unlockCondition: { type: 'character', value: 'tank' },\r\n        description: 'An immovable wall. Nothing gets through.'\r\n    },\r\n    assassin: {\r\n        id: 'assassin',\r\n        name: 'Assassin',\r\n        icon: '',\r\n        color: [150, 100, 150],\r\n        category: PORTRAIT_CATEGORIES.CHARACTER,\r\n        unlockCondition: { type: 'character', value: 'assassin' },\r\n        description: 'Silent. Deadly. Gone before you know it.'\r\n    },\r\n\r\n    // ============ ACHIEVEMENT-BASED ============\r\n    boss_slayer: {\r\n        id: 'boss_slayer',\r\n        name: 'Boss Slayer',\r\n        icon: '',\r\n        color: [255, 180, 50],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'totalBossesKilled', value: 100 },\r\n        description: 'Has ended the reign of 100 bosses.'\r\n    },\r\n    speedrunner: {\r\n        id: 'speedrunner',\r\n        name: 'Speedrunner',\r\n        icon: '',\r\n        color: [255, 255, 100],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'fastestRunTime', value: 600, comparison: 'lessThan' },\r\n        description: 'Completed a run in under 10 minutes.'\r\n    },\r\n    perfectionist: {\r\n        id: 'perfectionist',\r\n        name: 'Perfectionist',\r\n        icon: '',\r\n        color: [255, 255, 255],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'achievement', value: 'flawless_run' },\r\n        description: 'Completed a run without taking damage.'\r\n    },\r\n    grinder: {\r\n        id: 'grinder',\r\n        name: 'Grinder',\r\n        icon: '',\r\n        color: [200, 150, 100],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'totalRuns', value: 100 },\r\n        description: 'Has completed 100 runs. Dedication personified.'\r\n    },\r\n    collector: {\r\n        id: 'collector',\r\n        name: 'Collector',\r\n        icon: '',\r\n        color: [255, 215, 0],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'totalCurrencyEarned', value: 10000 },\r\n        description: 'Has earned 10,000 credits total.'\r\n    },\r\n    exterminator: {\r\n        id: 'exterminator',\r\n        name: 'Exterminator',\r\n        icon: '',\r\n        color: [200, 50, 50],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'totalEnemiesKilled', value: 10000 },\r\n        description: 'Has eliminated 10,000 enemies.'\r\n    },\r\n    explorer: {\r\n        id: 'explorer',\r\n        name: 'Explorer',\r\n        icon: '',\r\n        color: [100, 180, 100],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'bestFloor', value: 5 },\r\n        description: 'Reached floor 5. The journey begins.'\r\n    },\r\n    delver: {\r\n        id: 'delver',\r\n        name: 'Delver',\r\n        icon: '',\r\n        color: [180, 140, 100],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'bestFloor', value: 10 },\r\n        description: 'Reached floor 10. Deep into the unknown.'\r\n    },\r\n    abyssal: {\r\n        id: 'abyssal',\r\n        name: 'Abyssal',\r\n        icon: '',\r\n        color: [80, 50, 150],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'bestFloor', value: 20 },\r\n        description: 'Reached floor 20. Touched the abyss.'\r\n    },\r\n    slayer: {\r\n        id: 'slayer',\r\n        name: 'Slayer',\r\n        icon: '',\r\n        color: [200, 80, 80],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'totalBossesKilled', value: 25 },\r\n        description: 'Has slain 25 bosses.'\r\n    },\r\n    warrior: {\r\n        id: 'warrior',\r\n        name: 'Warrior',\r\n        icon: '',\r\n        color: [150, 150, 200],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'totalEnemiesKilled', value: 1000 },\r\n        description: 'Has defeated 1,000 enemies.'\r\n    },\r\n    rich: {\r\n        id: 'rich',\r\n        name: 'Wealthy',\r\n        icon: '',\r\n        color: [100, 200, 255],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'totalCurrencyEarned', value: 50000 },\r\n        description: 'Has earned 50,000 credits. Living large.'\r\n    },\r\n    dedicated: {\r\n        id: 'dedicated',\r\n        name: 'Dedicated',\r\n        icon: '',\r\n        color: [150, 100, 200],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'totalRuns', value: 50 },\r\n        description: 'Has completed 50 runs. Committed to the grind.'\r\n    },\r\n    marathoner: {\r\n        id: 'marathoner',\r\n        name: 'Marathoner',\r\n        icon: '',\r\n        color: [100, 200, 150],\r\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\r\n        unlockCondition: { type: 'stat', stat: 'totalRoomsCleared', value: 500 },\r\n        description: 'Has cleared 500 rooms. Endurance personified.'\r\n    }\r\n};\r\n\r\n/**\r\n * Get portrait by ID\r\n * @param {string} id - Portrait ID\r\n * @returns {Object|null} Portrait data or null\r\n */\r\nexport function getPortraitById(id) {\r\n    return PORTRAITS[id] || null;\r\n}\r\n\r\n/**\r\n * Get all portraits\r\n * @returns {Array} Array of all portrait objects\r\n */\r\nexport function getAllPortraits() {\r\n    return Object.values(PORTRAITS);\r\n}\r\n\r\n/**\r\n * Get portraits by category\r\n * @param {string} category - Category to filter by\r\n * @returns {Array} Array of portrait objects in that category\r\n */\r\nexport function getPortraitsByCategory(category) {\r\n    return Object.values(PORTRAITS).filter(p => p.category === category);\r\n}\r\n\r\n/**\r\n * Check if a portrait's unlock condition is met\r\n * @param {string} portraitId - Portrait ID\r\n * @param {Object} saveData - Player save data\r\n * @returns {boolean} True if unlocked\r\n */\r\nexport function checkPortraitUnlockCondition(portraitId, saveData) {\r\n    const portrait = PORTRAITS[portraitId];\r\n    if (!portrait) return false;\r\n\r\n    const condition = portrait.unlockCondition;\r\n\r\n    switch (condition.type) {\r\n        case 'default':\r\n            return true;\r\n\r\n        case 'level':\r\n            // Calculate level from XP\r\n            const level = Math.floor(Math.sqrt((saveData.totalXP || 0) / 100)) + 1;\r\n            return level >= condition.value;\r\n\r\n        case 'character':\r\n            return saveData.unlocks?.characters?.includes(condition.value) || false;\r\n\r\n        case 'achievement':\r\n            return saveData.achievements?.includes(condition.value) || false;\r\n\r\n        case 'stat':\r\n            const statValue = saveData.stats?.[condition.stat] || 0;\r\n            if (condition.comparison === 'lessThan') {\r\n                // For speedrunner: needs to have a valid time AND be under the threshold\r\n                return statValue > 0 && statValue < condition.value;\r\n            }\r\n            return statValue >= condition.value;\r\n\r\n        default:\r\n            return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Get unlock progress for a portrait\r\n * @param {string} portraitId - Portrait ID\r\n * @param {Object} saveData - Player save data\r\n * @returns {Object} Progress info with current, required, and percentage\r\n */\r\nexport function getPortraitUnlockProgress(portraitId, saveData) {\r\n    const portrait = PORTRAITS[portraitId];\r\n    if (!portrait) return { current: 0, required: 1, percentage: 0 };\r\n\r\n    const condition = portrait.unlockCondition;\r\n\r\n    switch (condition.type) {\r\n        case 'default':\r\n            return { current: 1, required: 1, percentage: 1 };\r\n\r\n        case 'level':\r\n            const level = Math.floor(Math.sqrt((saveData.totalXP || 0) / 100)) + 1;\r\n            return {\r\n                current: level,\r\n                required: condition.value,\r\n                percentage: Math.min(1, level / condition.value)\r\n            };\r\n\r\n        case 'character':\r\n            const hasChar = saveData.unlocks?.characters?.includes(condition.value) || false;\r\n            return {\r\n                current: hasChar ? 1 : 0,\r\n                required: 1,\r\n                percentage: hasChar ? 1 : 0\r\n            };\r\n\r\n        case 'achievement':\r\n            const hasAch = saveData.achievements?.includes(condition.value) || false;\r\n            return {\r\n                current: hasAch ? 1 : 0,\r\n                required: 1,\r\n                percentage: hasAch ? 1 : 0\r\n            };\r\n\r\n        case 'stat':\r\n            const statValue = saveData.stats?.[condition.stat] || 0;\r\n            if (condition.comparison === 'lessThan') {\r\n                // Can't really show progress for \"less than\" conditions\r\n                return {\r\n                    current: statValue || 'N/A',\r\n                    required: `< ${condition.value}`,\r\n                    percentage: statValue > 0 && statValue < condition.value ? 1 : 0\r\n                };\r\n            }\r\n            return {\r\n                current: statValue,\r\n                required: condition.value,\r\n                percentage: Math.min(1, statValue / condition.value)\r\n            };\r\n\r\n        default:\r\n            return { current: 0, required: 1, percentage: 0 };\r\n    }\r\n}\r\n\r\n/**\r\n * Get description of unlock condition\r\n * @param {string} portraitId - Portrait ID\r\n * @returns {string} Human-readable unlock condition\r\n */\r\nexport function getPortraitUnlockDescription(portraitId) {\r\n    const portrait = PORTRAITS[portraitId];\r\n    if (!portrait) return 'Unknown';\r\n\r\n    const condition = portrait.unlockCondition;\r\n\r\n    switch (condition.type) {\r\n        case 'default':\r\n            return 'Unlocked by default';\r\n        case 'level':\r\n            return `Reach Level ${condition.value}`;\r\n        case 'character':\r\n            return `Unlock the ${condition.value.charAt(0).toUpperCase() + condition.value.slice(1)} character`;\r\n        case 'achievement':\r\n            return `Complete the \"${condition.value}\" achievement`;\r\n        case 'stat':\r\n            const statNames = {\r\n                totalBossesKilled: 'bosses killed',\r\n                totalRuns: 'runs completed',\r\n                totalCurrencyEarned: 'credits earned',\r\n                totalEnemiesKilled: 'enemies killed',\r\n                fastestRunTime: 'second run'\r\n            };\r\n            const statName = statNames[condition.stat] || condition.stat;\r\n            if (condition.comparison === 'lessThan') {\r\n                return `Complete a run in under ${Math.floor(condition.value / 60)} minutes`;\r\n            }\r\n            return `${condition.value.toLocaleString()} ${statName}`;\r\n        default:\r\n            return 'Unknown condition';\r\n    }\r\n}\r\n","/**\r\n * Daily Runs System\r\n *\r\n * Provides daily seeded challenges where:\r\n * - Same date = same seed = same character + room layout\r\n * - Character is locked (can't change)\r\n * - Score saves to daily leaderboard\r\n * - One attempt per day (can view leaderboard after completion)\r\n */\r\n\r\nimport { SeededRandom, seedFromString } from '../utils/seededRandom.js';\r\n\r\n// Storage key for daily run data\r\nconst DAILY_RUN_STORAGE_KEY = 'superSmashTextyDailyRuns';\r\n\r\n// Available characters for daily runs (includes ALL characters, even locked ones)\r\nconst DAILY_CHARACTERS = ['survivor', 'scout', 'tank', 'sniper', 'pyro', 'bomber', 'engineer', 'vampire', 'berserker', 'ghost'];\r\n\r\n/**\r\n * Get today's date string in ISO format (YYYY-MM-DD)\r\n * @returns {string} - Today's date\r\n */\r\nexport function getTodayDateString() {\r\n    return new Date().toISOString().split('T')[0];\r\n}\r\n\r\n/**\r\n * Get the seed for a specific date's daily run\r\n * @param {string} date - Date string (YYYY-MM-DD), defaults to today\r\n * @returns {number} - Deterministic seed for the date\r\n */\r\nexport function getDailySeed(date = null) {\r\n    const dateStr = date || getTodayDateString();\r\n    return seedFromString(dateStr + 'SuperSmashTexty');\r\n}\r\n\r\n/**\r\n * Get today's daily seed\r\n * @returns {number} - Today's daily seed\r\n */\r\nexport function getTodayDailySeed() {\r\n    return getDailySeed(getTodayDateString());\r\n}\r\n\r\n/**\r\n * Get the character for a specific date's daily run\r\n * @param {string} date - Date string (YYYY-MM-DD), defaults to today\r\n * @returns {string} - Character key for the daily run\r\n */\r\nexport function getDailyCharacter(date = null) {\r\n    const seed = getDailySeed(date);\r\n    const rng = new SeededRandom(seed);\r\n    return rng.choose(DAILY_CHARACTERS);\r\n}\r\n\r\n/**\r\n * Get today's daily character\r\n * @returns {string} - Today's daily character\r\n */\r\nexport function getTodayDailyCharacter() {\r\n    return getDailyCharacter(getTodayDateString());\r\n}\r\n\r\n/**\r\n * Get stored daily run data\r\n * @returns {Object} - Daily run data\r\n */\r\nfunction getDailyRunData() {\r\n    try {\r\n        const data = localStorage.getItem(DAILY_RUN_STORAGE_KEY);\r\n        return data ? JSON.parse(data) : { completedDays: {}, attempts: {} };\r\n    } catch (e) {\r\n        console.warn('[DailyRuns] Failed to parse daily run data:', e);\r\n        return { completedDays: {}, attempts: {} };\r\n    }\r\n}\r\n\r\n/**\r\n * Save daily run data\r\n * @param {Object} data - Data to save\r\n */\r\nfunction saveDailyRunData(data) {\r\n    try {\r\n        localStorage.setItem(DAILY_RUN_STORAGE_KEY, JSON.stringify(data));\r\n    } catch (e) {\r\n        console.warn('[DailyRuns] Failed to save daily run data:', e);\r\n    }\r\n}\r\n\r\n/**\r\n * Check if today's daily run has been completed\r\n * @returns {boolean} - True if already completed today\r\n */\r\nexport function hasCompletedDailyToday() {\r\n    const data = getDailyRunData();\r\n    const today = getTodayDateString();\r\n    return !!data.completedDays[today];\r\n}\r\n\r\n/**\r\n * Check if a specific date's daily run has been completed\r\n * @param {string} date - Date string (YYYY-MM-DD)\r\n * @returns {boolean} - True if completed\r\n */\r\nexport function hasCompletedDaily(date) {\r\n    const data = getDailyRunData();\r\n    return !!data.completedDays[date];\r\n}\r\n\r\n/**\r\n * Get completion data for a specific date\r\n * @param {string} date - Date string (YYYY-MM-DD)\r\n * @returns {Object|null} - Completion data or null\r\n */\r\nexport function getDailyCompletion(date) {\r\n    const data = getDailyRunData();\r\n    return data.completedDays[date] || null;\r\n}\r\n\r\n/**\r\n * Get today's completion data\r\n * @returns {Object|null} - Completion data or null\r\n */\r\nexport function getTodayCompletion() {\r\n    return getDailyCompletion(getTodayDateString());\r\n}\r\n\r\n/**\r\n * Mark a daily run as completed\r\n * @param {Object} runStats - Stats from the completed run\r\n * @param {number} runStats.score - Final score\r\n * @param {number} runStats.floor - Floor reached\r\n * @param {string} runStats.character - Character used\r\n * @param {number} runStats.duration - Run duration in seconds\r\n * @returns {Object} - Completion result with rank\r\n */\r\nexport function markDailyCompleted(runStats) {\r\n    const data = getDailyRunData();\r\n    const today = getTodayDateString();\r\n\r\n    // Store completion data\r\n    const completion = {\r\n        date: today,\r\n        score: runStats.score || 0,\r\n        floor: runStats.floor || 1,\r\n        character: runStats.character || getTodayDailyCharacter(),\r\n        duration: runStats.duration || 0,\r\n        completedAt: Date.now()\r\n    };\r\n\r\n    data.completedDays[today] = completion;\r\n    saveDailyRunData(data);\r\n\r\n    console.log('[DailyRuns] Marked daily completed:', completion);\r\n\r\n    return completion;\r\n}\r\n\r\n/**\r\n * Get attempt count for today\r\n * @returns {number} - Number of attempts today\r\n */\r\nexport function getTodayAttemptCount() {\r\n    const data = getDailyRunData();\r\n    const today = getTodayDateString();\r\n    return data.attempts[today] || 0;\r\n}\r\n\r\n/**\r\n * Increment attempt count for today\r\n */\r\nexport function incrementAttemptCount() {\r\n    const data = getDailyRunData();\r\n    const today = getTodayDateString();\r\n    data.attempts[today] = (data.attempts[today] || 0) + 1;\r\n    saveDailyRunData(data);\r\n}\r\n\r\n/**\r\n * Get daily run info for display\r\n * @returns {Object} - Daily run info\r\n */\r\nexport function getDailyRunInfo() {\r\n    const today = getTodayDateString();\r\n    const seed = getDailySeed(today);\r\n    const character = getDailyCharacter(today);\r\n    const completed = hasCompletedDailyToday();\r\n    const completion = getTodayCompletion();\r\n    const attempts = getTodayAttemptCount();\r\n\r\n    return {\r\n        date: today,\r\n        seed: seed,\r\n        character: character,\r\n        completed: completed,\r\n        completion: completion,\r\n        attempts: attempts\r\n    };\r\n}\r\n\r\n/**\r\n * Create a seeded RNG for the daily run\r\n * @param {string} date - Date string, defaults to today\r\n * @returns {SeededRandom} - Seeded RNG instance\r\n */\r\nexport function createDailyRNG(date = null) {\r\n    const seed = getDailySeed(date);\r\n    return new SeededRandom(seed);\r\n}\r\n\r\n/**\r\n * Get historical daily runs (last N days)\r\n * @param {number} days - Number of days to look back\r\n * @returns {Array} - Array of daily run completions\r\n */\r\nexport function getDailyHistory(days = 7) {\r\n    const data = getDailyRunData();\r\n    const history = [];\r\n    const today = new Date();\r\n\r\n    for (let i = 0; i < days; i++) {\r\n        const date = new Date(today);\r\n        date.setDate(date.getDate() - i);\r\n        const dateStr = date.toISOString().split('T')[0];\r\n\r\n        if (data.completedDays[dateStr]) {\r\n            history.push({\r\n                date: dateStr,\r\n                ...data.completedDays[dateStr]\r\n            });\r\n        }\r\n    }\r\n\r\n    return history;\r\n}\r\n\r\n/**\r\n * Clean up old daily run data (keep last 30 days)\r\n */\r\nexport function cleanupOldDailyData() {\r\n    const data = getDailyRunData();\r\n    const cutoffDate = new Date();\r\n    cutoffDate.setDate(cutoffDate.getDate() - 30);\r\n    const cutoffStr = cutoffDate.toISOString().split('T')[0];\r\n\r\n    let cleaned = false;\r\n\r\n    // Clean old completions\r\n    for (const date of Object.keys(data.completedDays)) {\r\n        if (date < cutoffStr) {\r\n            delete data.completedDays[date];\r\n            cleaned = true;\r\n        }\r\n    }\r\n\r\n    // Clean old attempts\r\n    for (const date of Object.keys(data.attempts)) {\r\n        if (date < cutoffStr) {\r\n            delete data.attempts[date];\r\n            cleaned = true;\r\n        }\r\n    }\r\n\r\n    if (cleaned) {\r\n        saveDailyRunData(data);\r\n        console.log('[DailyRuns] Cleaned up old daily run data');\r\n    }\r\n}\r\n","// Main menu scene\r\nimport { getCurrency, getCurrencyName, getPlayerName, getSelectedCharacter, isUnlocked, addCurrency, getPlayerLevel, getXPProgress, getTotalXP, getXPForNextLevel, getSelectedPortrait } from '../systems/metaProgression.js';\r\nimport { PORTRAITS, getPortraitById } from '../data/portraits.js';\r\nimport { initParty, getPartyDisplayInfo, isMultiplayerAvailable, broadcastGameStart, getPartySize, getDisplayInviteCode, getParty, toggleReady, isLocalPlayerReady, getCountdownState, areAllPlayersReady, broadcastPartyEmote, onPartyEmote, offPartyEmote, getActiveEmote, requestPlayerProfile } from '../systems/partySystem.js';\r\nimport { initAudio, resumeAudioContext, playMenuSelect, playMenuNav, playMenuMusic, setMusicVolume, setMasterVolume, setSfxVolume, setUiSoundsEnabled, setCombatSoundsEnabled } from '../systems/sounds.js';\r\nimport { getSettings } from '../systems/settings.js';\r\nimport { CHARACTER_UNLOCKS } from '../data/unlocks.js';\r\nimport { getDailyRunInfo, hasCompletedDailyToday, getTodayDailyCharacter } from '../systems/dailyRuns.js';\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_SPACING,\r\n    UI_BUTTON,\r\n    UI_Z_LAYERS,\r\n    formatButtonText,\r\n    createCreditIndicator\r\n} from '../config/uiConfig.js';\r\n\r\n// Layout constants for three-column grid\r\nconst LAYOUT = {\r\n    LEFT_COLUMN_X: 20,\r\n    LEFT_COLUMN_WIDTH: 200,\r\n    RIGHT_COLUMN_WIDTH: 200,\r\n    PANEL_PADDING: 10,\r\n    TOP_MARGIN: 20\r\n};\r\n\r\n/**\r\n * Create an interactive menu button\r\n */\r\nfunction createMenuButton(k, text, x, y, width = UI_BUTTON.WIDTH, height = UI_BUTTON.HEIGHT, fontSize = UI_TEXT_SIZES.BUTTON) {\r\n    const primaryColor = UI_COLORS.SECONDARY;\r\n    const hoverColor = UI_COLORS.SECONDARY_HOVER;\r\n    const textColor = UI_COLORS.TEXT_PRIMARY;\r\n    const borderColor = UI_COLORS.BORDER;\r\n\r\n    const bg = k.add([\r\n        k.rect(width, height),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...primaryColor),\r\n        k.outline(2, k.rgb(...borderColor)),\r\n        k.area(),\r\n        k.fixed(),\r\n        k.scale(1),\r\n        k.z(UI_Z_LAYERS.UI_ELEMENTS),\r\n        'menuButton'\r\n    ]);\r\n\r\n    const formattedText = formatButtonText(text);\r\n    const label = k.add([\r\n        k.text(formattedText, { size: fontSize }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...textColor),\r\n        k.fixed(),\r\n        k.scale(1),\r\n        k.z(UI_Z_LAYERS.UI_TEXT),\r\n        'menuButtonText'\r\n    ]);\r\n\r\n    bg.originalColor = [...primaryColor];\r\n    bg.hoverColor = [...hoverColor];\r\n    bg.borderColor = [...borderColor];\r\n    bg.isHovered = false;\r\n    bg.disabled = false;\r\n    bg.label = label;\r\n    bg.labels = [label];\r\n\r\n    bg.onHoverUpdate(() => {\r\n        if (bg.disabled) return;\r\n        if (!bg.isHovered) {\r\n            bg.isHovered = true;\r\n            playMenuNav();\r\n        }\r\n        bg.color = k.rgb(...bg.hoverColor);\r\n        bg.outline.color = k.rgb(...UI_COLORS.BORDER_HOVER);\r\n        bg.scale = k.vec2(UI_BUTTON.HOVER_SCALE, UI_BUTTON.HOVER_SCALE);\r\n        label.scale = k.vec2(UI_BUTTON.HOVER_SCALE, UI_BUTTON.HOVER_SCALE);\r\n    });\r\n\r\n    bg.onHoverEnd(() => {\r\n        if (bg.disabled) return;\r\n        bg.isHovered = false;\r\n        bg.color = k.rgb(...bg.originalColor);\r\n        bg.outline.color = k.rgb(...bg.borderColor);\r\n        bg.scale = k.vec2(1, 1);\r\n        label.scale = k.vec2(1, 1);\r\n    });\r\n\r\n    bg.setDisabled = (isDisabled) => {\r\n        bg.disabled = isDisabled;\r\n        if (isDisabled) {\r\n            bg.color = k.rgb(...UI_COLORS.BG_DISABLED);\r\n            label.color = k.rgb(...UI_COLORS.TEXT_DISABLED);\r\n        } else {\r\n            bg.color = k.rgb(...bg.originalColor);\r\n            label.color = k.rgb(...textColor);\r\n        }\r\n    };\r\n\r\n    return bg;\r\n}\r\n\r\n// Helper function to convert HSL to RGB\r\nfunction hslToRgb(h, s, l) {\r\n    s /= 100;\r\n    l /= 100;\r\n    const c = (1 - Math.abs(2 * l - 1)) * s;\r\n    const x = c * (1 - Math.abs((h / 60) % 2 - 1));\r\n    const m = l - c / 2;\r\n    let r = 0, g = 0, b = 0;\r\n    if (h >= 0 && h < 60) { r = c; g = x; b = 0; }\r\n    else if (h >= 60 && h < 120) { r = x; g = c; b = 0; }\r\n    else if (h >= 120 && h < 180) { r = 0; g = c; b = x; }\r\n    else if (h >= 180 && h < 240) { r = 0; g = x; b = c; }\r\n    else if (h >= 240 && h < 300) { r = x; g = 0; b = c; }\r\n    else if (h >= 300 && h < 360) { r = c; g = 0; b = x; }\r\n    return [\r\n        Math.round((r + m) * 255),\r\n        Math.round((g + m) * 255),\r\n        Math.round((b + m) * 255)\r\n    ];\r\n}\r\n\r\nexport function setupMenuScene(k) {\r\n    k.scene('menu', () => {\r\n        initAudio();\r\n\r\n        // Apply saved audio settings\r\n        const settings = getSettings();\r\n        setMasterVolume(settings.audio.masterVolume);\r\n        setMusicVolume(settings.audio.musicVolume);\r\n        setSfxVolume(settings.audio.sfxVolume);\r\n\r\n        // Apply UI/Combat sound toggles if they exist in settings\r\n        if (settings.audio.uiSounds !== undefined) {\r\n            setUiSoundsEnabled(settings.audio.uiSounds);\r\n        }\r\n        if (settings.audio.combatSounds !== undefined) {\r\n            setCombatSoundsEnabled(settings.audio.combatSounds);\r\n        }\r\n\r\n        // Resume audio context on first user interaction (browser autoplay policy)\r\n        let audioResumed = false;\r\n        const resumeAudio = () => {\r\n            if (!audioResumed) {\r\n                audioResumed = true;\r\n                resumeAudioContext();\r\n                // Try playing music again after context resumes\r\n                playMenuMusic();\r\n            }\r\n        };\r\n        k.onClick(resumeAudio);\r\n        k.onKeyPress(resumeAudio);\r\n\r\n        // Start menu music\r\n        playMenuMusic();\r\n\r\n        const currency = getCurrency();\r\n        const currencyName = getCurrencyName();\r\n\r\n        // Calculate layout dimensions\r\n        const rightColumnX = k.width() - LAYOUT.RIGHT_COLUMN_WIDTH - LAYOUT.LEFT_COLUMN_X;\r\n        const centerX = k.width() / 2;\r\n\r\n        // Background\r\n        k.add([\r\n            k.rect(k.width(), k.height()),\r\n            k.pos(0, 0),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.z(UI_Z_LAYERS.BACKGROUND)\r\n        ]);\r\n\r\n        // Decorative borders\r\n        k.add([\r\n            k.rect(k.width(), 4),\r\n            k.pos(0, 0),\r\n            k.color(...UI_COLORS.BORDER),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\r\n        ]);\r\n        k.add([\r\n            k.rect(k.width(), 4),\r\n            k.pos(0, k.height() - 4),\r\n            k.color(...UI_COLORS.BORDER),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\r\n        ]);\r\n\r\n        // ==========================================\r\n        // PROFILE CARD (Top-left, aligned with Daily Run on right)\r\n        // ==========================================\r\n        const profileCardX = LAYOUT.LEFT_COLUMN_X;\r\n        const profileCardY = LAYOUT.TOP_MARGIN + 50; // Align with daily run panel\r\n        const profileCardWidth = LAYOUT.LEFT_COLUMN_WIDTH;\r\n        const profileCardHeight = 75; // Compact height - just portrait, name, level, XP bar\r\n\r\n        // Profile card background (clickable)\r\n        const profileCardBg = k.add([\r\n            k.rect(profileCardWidth, profileCardHeight),\r\n            k.pos(profileCardX, profileCardY),\r\n            k.color(...UI_COLORS.BG_MEDIUM),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND),\r\n            'profileCard'\r\n        ]);\r\n\r\n        // Portrait\r\n        const portrait = getPortraitById(getSelectedPortrait()) || PORTRAITS.default;\r\n        const portraitSize = 45;\r\n        const portraitX = profileCardX + 32;\r\n        const portraitY = profileCardY + profileCardHeight / 2;\r\n\r\n        k.add([\r\n            k.rect(portraitSize, portraitSize),\r\n            k.pos(portraitX, portraitY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_LIGHT),\r\n            k.outline(2, k.rgb(...(portrait.color || [200, 200, 200]))),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\r\n        ]);\r\n\r\n        k.add([\r\n            k.text(portrait.icon, { size: 24 }),\r\n            k.pos(portraitX, portraitY),\r\n            k.anchor('center'),\r\n            k.color(...(portrait.color || [200, 200, 200])),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Player name (with fallback for null/undefined)\r\n        const playerName = getPlayerName() || 'Player';\r\n        const displayName = playerName.length > 16 ? playerName.substring(0, 16) + '..' : playerName;\r\n        const infoX = portraitX + portraitSize / 2 + 10;\r\n        k.add([\r\n            k.text(displayName, { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(infoX, profileCardY + 15),\r\n            k.anchor('left'),\r\n            k.color(...UI_COLORS.GOLD),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Level\r\n        const playerLevel = getPlayerLevel();\r\n        k.add([\r\n            k.text(`Lv.${playerLevel}`, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(infoX, profileCardY + 32),\r\n            k.anchor('left'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // XP progress bar\r\n        const xpProgress = getXPProgress();\r\n        const xpBarWidth = profileCardWidth - 75;\r\n        const xpBarHeight = 8;\r\n        const xpBarX = infoX;\r\n        const xpBarY = profileCardY + 50;\r\n\r\n        // Bar background\r\n        k.add([\r\n            k.rect(xpBarWidth, xpBarHeight),\r\n            k.pos(xpBarX, xpBarY),\r\n            k.anchor('left'),\r\n            k.color(40, 40, 60),\r\n            k.outline(1, k.rgb(60, 60, 80)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\r\n        ]);\r\n\r\n        // Bar fill (ensure minimum width of 2 to avoid rendering issues)\r\n        const xpFillWidth = Math.max(2, xpBarWidth * xpProgress);\r\n        k.add([\r\n            k.rect(xpFillWidth, xpBarHeight - 2),\r\n            k.pos(xpBarX + 1, xpBarY),\r\n            k.anchor('left'),\r\n            k.color(100, 180, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n\r\n        // XP percentage (centered on top of the bar)\r\n        k.add([\r\n            k.text(`${Math.round(xpProgress * 100)}%`, { size: 9 }),\r\n            k.pos(xpBarX + xpBarWidth / 2, xpBarY),\r\n            k.anchor('center'),\r\n            k.color(255, 255, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Profile card click handler\r\n        profileCardBg.onClick(() => {\r\n            playMenuSelect();\r\n            k.go('profile');\r\n        });\r\n\r\n        profileCardBg.onHoverUpdate(() => {\r\n            profileCardBg.color = k.rgb(...UI_COLORS.BG_LIGHT);\r\n        });\r\n        profileCardBg.onHoverEnd(() => {\r\n            profileCardBg.color = k.rgb(...UI_COLORS.BG_MEDIUM);\r\n        });\r\n\r\n        // ==========================================\r\n        // LEFT COLUMN: Party Panel (Below Profile)\r\n        // ==========================================\r\n        initParty(k);\r\n\r\n        const partyPanelX = LAYOUT.LEFT_COLUMN_X;\r\n        const partyPanelY = profileCardY + profileCardHeight + 10;\r\n        const partyPanelWidth = LAYOUT.LEFT_COLUMN_WIDTH;\r\n        const slotHeight = 24;\r\n        const slotSpacing = 3;\r\n        const titlePadding = 8;\r\n        const partyPanelHeight = titlePadding + (slotHeight * 4) + (slotSpacing * 3) + 55;\r\n\r\n        // Party panel background\r\n        k.add([\r\n            k.rect(partyPanelWidth, partyPanelHeight),\r\n            k.pos(partyPanelX, partyPanelY),\r\n            k.color(...UI_COLORS.BG_MEDIUM),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\r\n        ]);\r\n\r\n        const slotsStartY = partyPanelY + titlePadding;\r\n        const slotElements = [];\r\n\r\n        function updatePartySlots() {\r\n            slotElements.forEach(elements => {\r\n                elements.forEach(el => {\r\n                    if (el.exists()) k.destroy(el);\r\n                });\r\n            });\r\n            slotElements.length = 0;\r\n\r\n            const partySlots = getPartyDisplayInfo();\r\n\r\n            partySlots.forEach((slot, index) => {\r\n                const slotY = slotsStartY + (index * (slotHeight + slotSpacing));\r\n                const elementsForThisSlot = [];\r\n\r\n                // Make non-empty, non-local slots clickable to view profile\r\n                const isClickable = !slot.isEmpty && !slot.isLocal;\r\n\r\n                const slotBg = k.add([\r\n                    k.rect(partyPanelWidth - 16, slotHeight),\r\n                    k.pos(partyPanelX + 8, slotY),\r\n                    k.color(slot.isEmpty ? UI_COLORS.BG_DARK : UI_COLORS.BG_LIGHT),\r\n                    k.outline(1, k.rgb(...UI_COLORS.TEXT_DISABLED)),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_BACKGROUND + 1),\r\n                    isClickable ? k.area() : null,\r\n                    'partySlotUI'\r\n                ].filter(Boolean));\r\n                elementsForThisSlot.push(slotBg);\r\n\r\n                // Click handler to view other player's profile\r\n                if (isClickable) {\r\n                    slotBg.onClick(() => {\r\n                        playMenuSelect();\r\n                        // Request profile data and navigate to profile scene\r\n                        requestPlayerProfile(index, (profileData) => {\r\n                            if (profileData) {\r\n                                k.go('profile', { externalProfile: profileData });\r\n                            } else {\r\n                                console.warn('Failed to load profile for slot', index);\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    slotBg.onHoverUpdate(() => {\r\n                        slotBg.color = k.rgb(80, 90, 110);\r\n                    });\r\n                    slotBg.onHoverEnd(() => {\r\n                        slotBg.color = k.rgb(...UI_COLORS.BG_LIGHT);\r\n                    });\r\n                }\r\n\r\n                // Show portrait emoji for players, slot number for empty slots\r\n                let slotIcon = `${slot.slotNumber}`;\r\n                if (!slot.isEmpty) {\r\n                    // Use the synced portrait from party data\r\n                    const portrait = getPortraitById(slot.selectedPortrait) || PORTRAITS.default;\r\n                    slotIcon = portrait.icon;\r\n                }\r\n                const slotIconEl = k.add([\r\n                    k.text(slotIcon, { size: slot.isEmpty ? UI_TEXT_SIZES.SMALL : UI_TEXT_SIZES.SMALL + 2 }),\r\n                    k.pos(partyPanelX + 18, slotY + slotHeight / 2),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT),\r\n                    'partySlotUI'\r\n                ]);\r\n                elementsForThisSlot.push(slotIconEl);\r\n\r\n                if (!slot.isEmpty) {\r\n                    const charData = CHARACTER_UNLOCKS[slot.selectedCharacter] || CHARACTER_UNLOCKS['survivor'];\r\n                    const charIcon = k.add([\r\n                        k.text(charData.char, { size: UI_TEXT_SIZES.SMALL }),\r\n                        k.pos(partyPanelX + 38, slotY + slotHeight / 2),\r\n                        k.anchor('left'),\r\n                        k.color(...charData.color),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT),\r\n                        'partySlotUI'\r\n                    ]);\r\n                    elementsForThisSlot.push(charIcon);\r\n                }\r\n\r\n                const nameText = k.add([\r\n                    k.text(slot.playerName.substring(0, 16), { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                    k.pos(partyPanelX + (slot.isEmpty ? 32 : 55), slotY + slotHeight / 2),\r\n                    k.anchor('left'),\r\n                    k.color(slot.isEmpty ? UI_COLORS.TEXT_DISABLED : (slot.isLocal ? UI_COLORS.GOLD : UI_COLORS.TEXT_PRIMARY)),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT),\r\n                    'partySlotUI'\r\n                ]);\r\n                elementsForThisSlot.push(nameText);\r\n\r\n                if (!slot.isEmpty) {\r\n                    const readyIcon = slot.isReady ? '' : '';\r\n                    const readyColor = slot.isReady ? UI_COLORS.SUCCESS : UI_COLORS.TEXT_DISABLED;\r\n                    const readyText = k.add([\r\n                        k.text(readyIcon, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                        k.pos(partyPanelX + partyPanelWidth - 14, slotY + slotHeight / 2),\r\n                        k.anchor('center'),\r\n                        k.color(...readyColor),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT),\r\n                        'partySlotUI'\r\n                    ]);\r\n                    elementsForThisSlot.push(readyText);\r\n\r\n                    // Show active emote if any\r\n                    const activeEmote = getActiveEmote(index);\r\n                    if (activeEmote) {\r\n                        const emoteChar = activeEmote === 'exclamation' ? '!' : '';\r\n                        const emoteColor = activeEmote === 'exclamation' ? [255, 255, 0] : [255, 100, 150];\r\n                        const emoteText = k.add([\r\n                            k.text(emoteChar, { size: UI_TEXT_SIZES.SMALL + 2 }),\r\n                            k.pos(partyPanelX + partyPanelWidth - 28, slotY + slotHeight / 2),\r\n                            k.anchor('center'),\r\n                            k.color(...emoteColor),\r\n                            k.fixed(),\r\n                            k.z(UI_Z_LAYERS.UI_TEXT + 1),\r\n                            'partySlotUI'\r\n                        ]);\r\n                        elementsForThisSlot.push(emoteText);\r\n                    }\r\n                }\r\n\r\n                if (slot.isDisconnected) {\r\n                    const dcText = k.add([\r\n                        k.text('', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                        k.pos(partyPanelX + partyPanelWidth - 28, slotY + slotHeight / 2),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.WARNING),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT),\r\n                        'partySlotUI'\r\n                    ]);\r\n                    elementsForThisSlot.push(dcText);\r\n                }\r\n\r\n                slotElements.push(elementsForThisSlot);\r\n            });\r\n        }\r\n\r\n        updatePartySlots();\r\n\r\n        let lastPartyCheck = 0;\r\n        k.onUpdate(() => {\r\n            lastPartyCheck += k.dt();\r\n            if (lastPartyCheck >= 1.0) {\r\n                lastPartyCheck = 0;\r\n                updatePartySlots();\r\n                if (typeof updateStartButtonState === 'function') {\r\n                    updateStartButtonState();\r\n                }\r\n            }\r\n        });\r\n\r\n        // Invite code section\r\n        const inviteCodeY = slotsStartY + (4 * (slotHeight + slotSpacing)) + 6;\r\n\r\n        k.add([\r\n            k.text('Code:', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(partyPanelX + 8, inviteCodeY),\r\n            k.anchor('left'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        const inviteCode = getDisplayInviteCode();\r\n        const inviteCodeDisplay = k.add([\r\n            k.text(inviteCode, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(partyPanelX + partyPanelWidth - 8, inviteCodeY),\r\n            k.anchor('right'),\r\n            k.color(inviteCode === 'OFFLINE' ? [...UI_COLORS.TEXT_DISABLED] : [...UI_COLORS.GOLD]),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        let hasValidCode = inviteCode !== 'OFFLINE';\r\n        inviteCodeDisplay.onUpdate(() => {\r\n            if (!hasValidCode) {\r\n                const currentCode = getDisplayInviteCode();\r\n                if (currentCode && currentCode !== 'OFFLINE') {\r\n                    inviteCodeDisplay.text = currentCode;\r\n                    inviteCodeDisplay.color = k.rgb(...UI_COLORS.GOLD);\r\n                    hasValidCode = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        // Join Party button\r\n        const joinButtonY = inviteCodeY + 22;\r\n        const joinButton = createMenuButton(\r\n            k, 'JOIN PARTY', partyPanelX + partyPanelWidth / 2, joinButtonY,\r\n            partyPanelWidth - 20, 28, UI_TEXT_SIZES.SMALL\r\n        );\r\n        joinButton.onClick(() => {\r\n            playMenuSelect();\r\n            k.go('joinParty');\r\n        });\r\n\r\n        // Ready button (only visible in party)\r\n        const readyButtonY = joinButtonY + 30;\r\n        let readyButtonElements = [];\r\n        let countdownDisplay = null;\r\n        // Track state to avoid unnecessary UI rebuilds\r\n        let lastReadyState = { partySize: 0, isReady: false, countdownActive: false, countdownSeconds: 0 };\r\n\r\n        function updateReadyButton(forceUpdate = false) {\r\n            const partySize = getPartySize();\r\n            const countdown = getCountdownState();\r\n            const isReady = isLocalPlayerReady();\r\n            const countdownSeconds = countdown.active ? Math.ceil(countdown.timeRemaining / 1000) : 0;\r\n\r\n            // Only rebuild UI if state actually changed (performance optimization)\r\n            if (!forceUpdate &&\r\n                lastReadyState.partySize === partySize &&\r\n                lastReadyState.isReady === isReady &&\r\n                lastReadyState.countdownActive === countdown.active &&\r\n                lastReadyState.countdownSeconds === countdownSeconds) {\r\n                return; // No change, skip UI rebuild\r\n            }\r\n\r\n            // Update tracked state\r\n            lastReadyState = { partySize, isReady, countdownActive: countdown.active, countdownSeconds };\r\n\r\n            // Clean up existing elements\r\n            readyButtonElements.forEach(el => {\r\n                if (el.exists()) k.destroy(el);\r\n            });\r\n            readyButtonElements = [];\r\n            if (countdownDisplay && countdownDisplay.exists()) {\r\n                k.destroy(countdownDisplay);\r\n                countdownDisplay = null;\r\n            }\r\n\r\n            if (partySize >= 2) {\r\n                const readyBg = k.add([\r\n                    k.rect(partyPanelWidth - 20, 24),\r\n                    k.pos(partyPanelX + partyPanelWidth / 2, readyButtonY),\r\n                    k.anchor('center'),\r\n                    k.color(isReady ? 100 : 60, isReady ? 150 : 80, isReady ? 100 : 120),\r\n                    k.outline(2, k.rgb(isReady ? 100 : 80, isReady ? 200 : 120, isReady ? 100 : 180)),\r\n                    k.area(),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS),\r\n                    'readyButtonUI'\r\n                ]);\r\n                readyButtonElements.push(readyBg);\r\n\r\n                const readyLabel = k.add([\r\n                    k.text(isReady ? ' READY' : 'READY UP', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                    k.pos(partyPanelX + partyPanelWidth / 2, readyButtonY),\r\n                    k.anchor('center'),\r\n                    k.color(isReady ? 150 : 100, isReady ? 255 : 150, isReady ? 150 : 200),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT),\r\n                    'readyButtonUI'\r\n                ]);\r\n                readyButtonElements.push(readyLabel);\r\n\r\n                readyBg.onClick(() => {\r\n                    playMenuSelect();\r\n                    toggleReady();\r\n                    updateReadyButton(true); // Force update after click\r\n                    updatePartySlots();\r\n                });\r\n\r\n                if (countdown.active) {\r\n                    countdownDisplay = k.add([\r\n                        k.text(`Starting in ${countdownSeconds}...`, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                        k.pos(partyPanelX + partyPanelWidth / 2, readyButtonY + 20),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.SUCCESS),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT),\r\n                        'countdownUI'\r\n                    ]);\r\n                }\r\n            }\r\n        }\r\n\r\n        updateReadyButton(true); // Initial render\r\n\r\n        let lastCountdownCheck = 0;\r\n        k.onUpdate(() => {\r\n            lastCountdownCheck += k.dt();\r\n            if (lastCountdownCheck < 0.1) return;\r\n            lastCountdownCheck = 0;\r\n\r\n            const countdown = getCountdownState();\r\n            const partySize = getPartySize();\r\n\r\n            // Only call updateReadyButton when in party - it will check if rebuild is needed\r\n            if (partySize >= 2) {\r\n                updateReadyButton();\r\n            }\r\n\r\n            if (countdown.active && countdown.timeRemaining <= 0) {\r\n                const party = getParty();\r\n                if (party.isHost) {\r\n                    playMenuSelect();\r\n                    broadcastGameStart();\r\n                    k.go('game', { resetState: true });\r\n                }\r\n            }\r\n        });\r\n\r\n        // ==========================================\r\n        // DAILY RUN PANEL (Top-right, below credits)\r\n        // ==========================================\r\n        const dailyPanelWidth = LAYOUT.RIGHT_COLUMN_WIDTH;\r\n        const dailyPanelHeight = 120;\r\n        const dailyPanelX = rightColumnX;\r\n        const dailyRunY = LAYOUT.TOP_MARGIN + 50; // Move down to avoid overlap with credits\r\n        const dailyInfo = getDailyRunInfo();\r\n        const dailyChar = CHARACTER_UNLOCKS[dailyInfo.character] || CHARACTER_UNLOCKS.survivor;\r\n\r\n        k.add([\r\n            k.rect(dailyPanelWidth, dailyPanelHeight),\r\n            k.pos(dailyPanelX, dailyRunY),\r\n            k.color(...UI_COLORS.BG_MEDIUM),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\r\n        ]);\r\n\r\n        k.add([\r\n            k.text('DAILY RUN', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 12),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        k.add([\r\n            k.text(dailyChar.char, { size: 28 }),\r\n            k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 45),\r\n            k.anchor('center'),\r\n            k.color(...dailyChar.color),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        k.add([\r\n            k.text(dailyChar.name, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 68),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        const initialPartySize = getPartySize();\r\n        const dailyDisabledInMultiplayer = initialPartySize > 1;\r\n\r\n        if (dailyInfo.completed) {\r\n            k.add([\r\n                k.text('COMPLETED', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 95),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.SUCCESS),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n        } else if (dailyDisabledInMultiplayer) {\r\n            k.add([\r\n                k.text('SOLO ONLY', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 95),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_DISABLED),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n        } else {\r\n            const dailyPlayButton = k.add([\r\n                k.rect(dailyPanelWidth - 40, 28),\r\n                k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 95),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.SECONDARY),\r\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n\r\n            k.add([\r\n                k.text('PLAY', { size: UI_TEXT_SIZES.SMALL }),\r\n                k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 95),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            dailyPlayButton.onClick(() => {\r\n                if (getPartySize() > 1) return;\r\n                playMenuSelect();\r\n                k.go('game', {\r\n                    resetState: true,\r\n                    isDailyRun: true,\r\n                    dailyCharacter: dailyInfo.character,\r\n                    dailySeed: dailyInfo.seed,\r\n                    dailyDate: dailyInfo.date\r\n                });\r\n            });\r\n\r\n            dailyPlayButton.onHoverUpdate(() => {\r\n                dailyPlayButton.color = k.rgb(...UI_COLORS.SECONDARY_HOVER);\r\n            });\r\n            dailyPlayButton.onHoverEnd(() => {\r\n                dailyPlayButton.color = k.rgb(...UI_COLORS.SECONDARY);\r\n            });\r\n        }\r\n\r\n        // ==========================================\r\n        // RIGHT COLUMN: Credits + Leaderboards\r\n        // ==========================================\r\n\r\n        // Credits display (top right of center area)\r\n        const creditIndicator = createCreditIndicator(k, currency, currencyName);\r\n\r\n        // Leaderboards panel (below daily run panel on right)\r\n        const leaderboardsY = dailyRunY + dailyPanelHeight + 15;\r\n        const leaderboardsPanelHeight = 100;\r\n\r\n        k.add([\r\n            k.rect(LAYOUT.RIGHT_COLUMN_WIDTH, leaderboardsPanelHeight),\r\n            k.pos(rightColumnX, leaderboardsY),\r\n            k.color(...UI_COLORS.BG_MEDIUM),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND),\r\n            'leaderboardsPanel'\r\n        ]);\r\n\r\n        k.add([\r\n            k.text('LEADERBOARDS', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(rightColumnX + LAYOUT.RIGHT_COLUMN_WIDTH / 2, leaderboardsY + 15),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        k.add([\r\n            k.text('', { size: 32 }),\r\n            k.pos(rightColumnX + LAYOUT.RIGHT_COLUMN_WIDTH / 2, leaderboardsY + 50),\r\n            k.anchor('center'),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        k.add([\r\n            k.text('VIEW', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(rightColumnX + LAYOUT.RIGHT_COLUMN_WIDTH / 2, leaderboardsY + 80),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        const leaderboardsPanel = k.get('leaderboardsPanel')[0];\r\n        if (leaderboardsPanel) {\r\n            leaderboardsPanel.onClick(() => {\r\n                playMenuSelect();\r\n                k.go('leaderboards');\r\n            });\r\n            leaderboardsPanel.onHoverUpdate(() => {\r\n                leaderboardsPanel.color = k.rgb(...UI_COLORS.BG_LIGHT);\r\n            });\r\n            leaderboardsPanel.onHoverEnd(() => {\r\n                leaderboardsPanel.color = k.rgb(...UI_COLORS.BG_MEDIUM);\r\n            });\r\n        }\r\n\r\n        // ==========================================\r\n        // CENTER: Title + Main Buttons\r\n        // ==========================================\r\n\r\n        // ASCII Art Title with Animation\r\n        const titleY = 160;\r\n        const asciiTitle = [\r\n            '     ',\r\n            '   ',\r\n            '     ',\r\n            '      ',\r\n            '       ',\r\n            '         ',\r\n            '',\r\n            '       ',\r\n            '   ',\r\n            '',\r\n            '',\r\n            '      ',\r\n            '         ',\r\n            '',\r\n            '     ',\r\n            ' ',\r\n            '                  ',\r\n            '                    ',\r\n            '                   ',\r\n            '                    '\r\n        ];\r\n\r\n        const titleLines = [];\r\n        const lineSpacing = 12;\r\n        const startY = titleY - (asciiTitle.length * lineSpacing) / 2;\r\n\r\n        asciiTitle.forEach((line, index) => {\r\n            const titleLine = k.add([\r\n                k.text(line, { size: 10, font: 'monospace' }),\r\n                k.pos(centerX, startY + index * lineSpacing),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                k.z(UI_Z_LAYERS.UI_TEXT),\r\n                'titleLine'\r\n            ]);\r\n            titleLines.push(titleLine);\r\n        });\r\n\r\n        // Animated color wave effect for title\r\n        let colorTime = 0;\r\n        k.onUpdate(() => {\r\n            colorTime += k.dt();\r\n            titleLines.forEach((line, index) => {\r\n                const hue = (colorTime * 50 + index * 20) % 360;\r\n                const color = hslToRgb(hue, 80, 60);\r\n                line.color = k.rgb(...color);\r\n\r\n                const offset = Math.sin(colorTime * 2 + index * 0.3) * 2;\r\n                line.pos.y = startY + index * lineSpacing + offset;\r\n\r\n                // Glitch effect (random chance)\r\n                if (Math.random() < 0.001) {\r\n                    line.pos.x = centerX + (Math.random() - 0.5) * 10;\r\n                    k.wait(0.1, () => {\r\n                        if (line.exists()) {\r\n                            line.pos.x = centerX;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        });\r\n\r\n        // Main buttons - centered column using standardized sizes\r\n        const buttonStartY = 310;\r\n        const buttonSpacing = 55;\r\n        const { XL, LG } = UI_SIZES.BUTTON;\r\n\r\n        const playButton = createMenuButton(\r\n            k, 'ACTION!', centerX, buttonStartY,\r\n            XL.width, XL.height, UI_TEXT_SIZES.H1\r\n        );\r\n        playButton.onClick(() => {\r\n            if (playButton.disabled) return;\r\n            playMenuSelect();\r\n            const partySize = getPartySize();\r\n            if (partySize > 1) {\r\n                broadcastGameStart();\r\n            }\r\n            k.go('game', { resetState: true });\r\n        });\r\n\r\n        function updateStartButtonState() {\r\n            const party = getParty();\r\n            const partySize = getPartySize();\r\n            const shouldDisable = partySize > 1 && !party.isHost;\r\n            playButton.setDisabled(shouldDisable);\r\n        }\r\n        updateStartButtonState();\r\n\r\n        const characterButton = createMenuButton(\r\n            k, 'CONTESTANTS', centerX, buttonStartY + buttonSpacing,\r\n            LG.width, LG.height, UI_TEXT_SIZES.H2\r\n        );\r\n        characterButton.onClick(() => {\r\n            playMenuSelect();\r\n            k.go('characterSelect');\r\n        });\r\n\r\n        // Selected character icon next to button\r\n        const selectedCharKey = getSelectedCharacter();\r\n        const selectedCharData = CHARACTER_UNLOCKS[selectedCharKey];\r\n        if (selectedCharData) {\r\n            const isCharUnlocked = isUnlocked('characters', selectedCharKey) || selectedCharData.unlockedByDefault;\r\n            const charDisplayX = centerX + LG.width / 2 + 35;\r\n            const charDisplayY = buttonStartY + buttonSpacing;\r\n            const charDisplaySize = 45;\r\n\r\n            const charDisplayBg = k.add([\r\n                k.rect(charDisplaySize, charDisplaySize),\r\n                k.pos(charDisplayX, charDisplayY),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.BG_MEDIUM),\r\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_BACKGROUND)\r\n            ]);\r\n\r\n            const charDisplayIcon = k.add([\r\n                k.text(selectedCharData.char, { size: 28 }),\r\n                k.pos(charDisplayX, charDisplayY),\r\n                k.anchor('center'),\r\n                k.color(...(isCharUnlocked ? selectedCharData.color : UI_COLORS.BG_DISABLED)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            charDisplayBg.onClick(() => {\r\n                playMenuSelect();\r\n                k.go('characterSelect');\r\n            });\r\n\r\n            charDisplayBg.onHoverUpdate(() => {\r\n                charDisplayBg.color = k.rgb(...UI_COLORS.BG_LIGHT);\r\n                charDisplayIcon.scale = k.vec2(1.1);\r\n            });\r\n            charDisplayBg.onHoverEnd(() => {\r\n                charDisplayBg.color = k.rgb(...UI_COLORS.BG_MEDIUM);\r\n                charDisplayIcon.scale = k.vec2(1);\r\n            });\r\n        }\r\n\r\n        const shopButton = createMenuButton(\r\n            k, 'MERCH', centerX, buttonStartY + buttonSpacing * 2,\r\n            LG.width, LG.height, UI_TEXT_SIZES.H2\r\n        );\r\n        shopButton.onClick(() => {\r\n            playMenuSelect();\r\n            k.go('shop');\r\n        });\r\n\r\n        const statisticsButton = createMenuButton(\r\n            k, 'RATINGS', centerX, buttonStartY + buttonSpacing * 3,\r\n            LG.width, LG.height, UI_TEXT_SIZES.H2\r\n        );\r\n        statisticsButton.onClick(() => {\r\n            playMenuSelect();\r\n            k.go('statistics');\r\n        });\r\n\r\n        const settingsButton = createMenuButton(\r\n            k, 'OPTIONS', centerX, buttonStartY + buttonSpacing * 4,\r\n            LG.width, LG.height, UI_TEXT_SIZES.H2\r\n        );\r\n        settingsButton.onClick(() => {\r\n            playMenuSelect();\r\n            k.go('settings');\r\n        });\r\n\r\n        // Animate button colors\r\n        const menuButtons = [playButton, characterButton, shopButton, statisticsButton, settingsButton];\r\n        let buttonColorTime = 0;\r\n        k.onUpdate(() => {\r\n            buttonColorTime += k.dt();\r\n            menuButtons.forEach((button, index) => {\r\n                if (!button.exists() || button.isHovered) return;\r\n                const hue = (buttonColorTime * 60 + index * 50) % 360;\r\n                const color = hslToRgb(hue, 70, 50);\r\n                try {\r\n                    button.color = k.rgb(color[0], color[1], color[2]);\r\n                    button.originalColor = color;\r\n                } catch (e) {}\r\n            });\r\n        });\r\n\r\n        // Keyboard shortcuts\r\n        const spaceHandler = k.onKeyPress('space', () => {\r\n            if (!playButton.disabled) {\r\n                playMenuSelect();\r\n                k.go('game', { resetState: true });\r\n            }\r\n        });\r\n        const cHandler = k.onKeyPress('c', () => { playMenuNav(); k.go('characterSelect'); });\r\n        const sHandler = k.onKeyPress('s', () => { playMenuNav(); k.go('shop'); });\r\n        const oHandler = k.onKeyPress('o', () => { playMenuNav(); k.go('settings'); });\r\n        const tHandler = k.onKeyPress('t', () => { playMenuNav(); k.go('statistics'); });\r\n\r\n        // Emote key handlers (Q and E)\r\n        let lastEmoteTime = 0;\r\n        const EMOTE_COOLDOWN = 0.5; // seconds (longer cooldown for menu)\r\n\r\n        const qHandler = k.onKeyPress('q', () => {\r\n            const now = k.time();\r\n            if (now - lastEmoteTime < EMOTE_COOLDOWN) return;\r\n            lastEmoteTime = now;\r\n            broadcastPartyEmote('exclamation');\r\n            updatePartySlots();\r\n        });\r\n\r\n        const eHandler = k.onKeyPress('e', () => {\r\n            const now = k.time();\r\n            if (now - lastEmoteTime < EMOTE_COOLDOWN) return;\r\n            lastEmoteTime = now;\r\n            broadcastPartyEmote('heart');\r\n            updatePartySlots();\r\n        });\r\n\r\n        // Listen for emotes from other players and update display\r\n        const emoteCallback = (slotIndex, emoteType) => {\r\n            updatePartySlots();\r\n        };\r\n        onPartyEmote(emoteCallback);\r\n\r\n        k.onSceneLeave(() => {\r\n            spaceHandler.cancel();\r\n            cHandler.cancel();\r\n            sHandler.cancel();\r\n            oHandler.cancel();\r\n            tHandler.cancel();\r\n            qHandler.cancel();\r\n            eHandler.cancel();\r\n            offPartyEmote(emoteCallback);\r\n        });\r\n\r\n        // ==========================================\r\n        // Background decorations (reduced)\r\n        // ==========================================\r\n\r\n        // Falling particles\r\n        for (let i = 0; i < 12; i++) {\r\n            const particle = k.add([\r\n                k.text(['*', '+', ''][Math.floor(Math.random() * 3)], { size: 12 }),\r\n                k.pos(Math.random() * k.width(), Math.random() * k.height()),\r\n                k.color(...UI_COLORS.BG_LIGHT),\r\n                k.opacity(0.2 + Math.random() * 0.2),\r\n                k.z(UI_Z_LAYERS.PARTICLES)\r\n            ]);\r\n\r\n            particle.speed = 15 + Math.random() * 25;\r\n            particle.onUpdate(() => {\r\n                particle.pos.y += particle.speed * k.dt();\r\n                if (particle.pos.y > k.height()) {\r\n                    particle.pos.y = 0;\r\n                    particle.pos.x = Math.random() * k.width();\r\n                }\r\n            });\r\n        }\r\n\r\n        // Pulsing patterns\r\n        const patterns = ['', '', '', ''];\r\n        for (let i = 0; i < 8; i++) {\r\n            const pattern = k.add([\r\n                k.text(patterns[Math.floor(Math.random() * patterns.length)], { size: 16 }),\r\n                k.pos(Math.random() * k.width(), Math.random() * k.height()),\r\n                k.color(...UI_COLORS.BG_LIGHT),\r\n                k.opacity(0.1),\r\n                k.scale(1),\r\n                k.z(UI_Z_LAYERS.PARTICLES)\r\n            ]);\r\n\r\n            pattern.pulseTime = Math.random() * Math.PI * 2;\r\n            pattern.pulseSpeed = 1 + Math.random() * 1.5;\r\n\r\n            pattern.onUpdate(() => {\r\n                pattern.pulseTime += k.dt() * pattern.pulseSpeed;\r\n                const scale = 0.8 + Math.sin(pattern.pulseTime) * 0.2;\r\n                pattern.scale = k.vec2(scale, scale);\r\n                pattern.opacity = 0.08 + Math.abs(Math.sin(pattern.pulseTime)) * 0.1;\r\n            });\r\n        }\r\n\r\n        // ==========================================\r\n        // Version number (Micro text, bottom-right)\r\n        // DO NOT REMOVE: Auto-version from vite.config.js\r\n        // See GIT_WORKFLOW.md \"Automatic Version Numbering\"\r\n        // ==========================================\r\n        k.add([\r\n            k.text(__APP_VERSION__, { size: UI_TEXT_SIZES.MICRO }),\r\n            k.pos(k.width() - 10, k.height() - 10),\r\n            k.anchor('botright'),\r\n            k.color(...UI_COLORS.TEXT_DISABLED),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // ==========================================\r\n        // EASTER EGG: Golden enemy flyby\r\n        // ==========================================\r\n        k.loop(12, () => {\r\n            if (Math.random() < 0.12) {\r\n                const startY = 100 + Math.random() * (k.height() - 200);\r\n                const direction = Math.random() < 0.5 ? 1 : -1;\r\n                const startX = direction > 0 ? -50 : k.width() + 50;\r\n\r\n                const goldenEnemy = k.add([\r\n                    k.text('$', { size: 24 }),\r\n                    k.pos(startX, startY),\r\n                    k.color(...UI_COLORS.GOLD),\r\n                    k.area({ scale: 2.5 }),\r\n                    k.anchor('center'),\r\n                    k.scale(1),\r\n                    k.z(UI_Z_LAYERS.PARTICLES + 1),\r\n                    'goldenEnemy'\r\n                ]);\r\n\r\n                goldenEnemy.speed = 150 + Math.random() * 100;\r\n                goldenEnemy.direction = direction;\r\n                goldenEnemy.pulseTime = 0;\r\n\r\n                goldenEnemy.onClick(() => {\r\n                    if (!goldenEnemy.exists()) return;\r\n                    addCurrency(1);\r\n\r\n                    for (let i = 0; i < 8; i++) {\r\n                        const angle = (Math.PI * 2 * i) / 8;\r\n                        const particle = k.add([\r\n                            k.text(['$', ''][Math.floor(Math.random() * 2)], { size: 12 }),\r\n                            k.pos(goldenEnemy.pos.x, goldenEnemy.pos.y),\r\n                            k.color(...UI_COLORS.GOLD),\r\n                            k.opacity(1),\r\n                            k.z(UI_Z_LAYERS.PARTICLES + 2)\r\n                        ]);\r\n\r\n                        const speed = 80 + Math.random() * 60;\r\n                        particle.velocity = k.vec2(Math.cos(angle) * speed, Math.sin(angle) * speed);\r\n                        particle.life = 0.8;\r\n\r\n                        particle.onUpdate(() => {\r\n                            particle.pos = particle.pos.add(particle.velocity.scale(k.dt()));\r\n                            particle.life -= k.dt();\r\n                            particle.opacity = particle.life / 0.8;\r\n                            if (particle.life <= 0) k.destroy(particle);\r\n                        });\r\n                    }\r\n\r\n                    const rewardText = k.add([\r\n                        k.text('+$1', { size: 18 }),\r\n                        k.pos(goldenEnemy.pos.x, goldenEnemy.pos.y),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.SUCCESS),\r\n                        k.opacity(1),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n\r\n                    rewardText.life = 1.2;\r\n                    rewardText.onUpdate(() => {\r\n                        rewardText.pos.y -= 40 * k.dt();\r\n                        rewardText.life -= k.dt();\r\n                        rewardText.opacity = rewardText.life / 1.2;\r\n                        if (rewardText.life <= 0) k.destroy(rewardText);\r\n                    });\r\n\r\n                    k.destroy(goldenEnemy);\r\n                    k.wait(0.1, () => k.go('menu'));\r\n                });\r\n\r\n                goldenEnemy.onUpdate(() => {\r\n                    goldenEnemy.pos.x += goldenEnemy.speed * goldenEnemy.direction * k.dt();\r\n                    goldenEnemy.pulseTime += k.dt();\r\n                    const pulse = Math.sin(goldenEnemy.pulseTime * 8) * 0.15;\r\n                    goldenEnemy.scale = k.vec2(1 + pulse, 1 + pulse);\r\n\r\n                    if ((goldenEnemy.direction > 0 && goldenEnemy.pos.x > k.width() + 100) ||\r\n                        (goldenEnemy.direction < 0 && goldenEnemy.pos.x < -100)) {\r\n                        k.destroy(goldenEnemy);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    });\r\n}\r\n","/**\r\n * Achievement Detail Modal Component\r\n * Displays detailed achievement information with progress tracking\r\n */\r\n\r\nimport { UI_Z_LAYERS, UI_COLORS, UI_TEXT_SIZES } from '../config/uiConfig.js';\r\nimport { ACHIEVEMENT_COLORS, getAchievementProgress, getAchievementReward } from '../data/achievements.js';\r\nimport { CHARACTER_UNLOCKS, WEAPON_UNLOCKS, COSMETIC_UNLOCKS } from '../data/unlocks.js';\r\nimport { getSaveStats, isAchievementUnlocked, getCurrencyName } from '../systems/metaProgression.js';\r\nimport { playMenuNav } from '../systems/sounds.js';\r\n\r\n/**\r\n * Get characters unlocked by a specific achievement\r\n * @param {string} achievementId - The achievement ID to check\r\n * @returns {Array} Array of character objects that this achievement unlocks\r\n */\r\nfunction getCharactersUnlockedByAchievement(achievementId) {\r\n    const characters = [];\r\n    for (const [key, char] of Object.entries(CHARACTER_UNLOCKS)) {\r\n        if (char.unlockRequirement?.type === 'achievement' && char.unlockRequirement?.value === achievementId) {\r\n            characters.push({ key, ...char });\r\n        }\r\n    }\r\n    return characters;\r\n}\r\n\r\n// Modal state\r\nlet modalState = {\r\n    isOpen: false,\r\n    elements: [],\r\n    k: null,\r\n    onClose: null\r\n};\r\n\r\n/**\r\n * Show the achievement detail modal\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} achievement - Achievement data object\r\n * @param {Function} onClose - Optional callback when modal is closed\r\n */\r\nexport function showAchievementModal(k, achievement, onClose = null) {\r\n    if (modalState.isOpen) {\r\n        closeAchievementModal();\r\n    }\r\n\r\n    modalState.k = k;\r\n    modalState.isOpen = true;\r\n    modalState.onClose = onClose;\r\n    modalState.elements = [];\r\n\r\n    const stats = getSaveStats();\r\n    const isUnlocked = isAchievementUnlocked(achievement.id);\r\n    const progress = getAchievementProgress(achievement.id, stats);\r\n    const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\r\n\r\n    // Modal dimensions - taller to fit unlocks and progress info\r\n    const modalWidth = 420;\r\n    const modalHeight = 400;\r\n    const centerX = k.width() / 2;\r\n    const centerY = k.height() / 2;\r\n\r\n    // Overlay background (darkens the screen)\r\n    const overlay = k.add([\r\n        k.rect(k.width(), k.height()),\r\n        k.pos(0, 0),\r\n        k.color(0, 0, 0),\r\n        k.opacity(0.7),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL - 1),\r\n        k.area(),\r\n        'achievementModalOverlay'\r\n    ]);\r\n    modalState.elements.push(overlay);\r\n\r\n    // Close modal on overlay click\r\n    overlay.onClick(() => {\r\n        closeAchievementModal();\r\n    });\r\n\r\n    // Modal background\r\n    const modalBg = k.add([\r\n        k.rect(modalWidth, modalHeight),\r\n        k.pos(centerX, centerY),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.BG_MEDIUM),\r\n        k.outline(3, k.rgb(...difficultyColor)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL),\r\n        'achievementModal'\r\n    ]);\r\n    modalState.elements.push(modalBg);\r\n\r\n    // Achievement name\r\n    const nameText = k.add([\r\n        k.text(achievement.name, { size: UI_TEXT_SIZES.HEADER }),\r\n        k.pos(centerX, centerY - 130),\r\n        k.anchor('center'),\r\n        k.color(...(isUnlocked ? difficultyColor : UI_COLORS.TEXT_DISABLED)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 1),\r\n        'achievementModal'\r\n    ]);\r\n    modalState.elements.push(nameText);\r\n\r\n    // Icon (large)\r\n    const iconBg = k.add([\r\n        k.rect(64, 64),\r\n        k.pos(centerX, centerY - 70),\r\n        k.anchor('center'),\r\n        k.color(isUnlocked ? 50 : 30, isUnlocked ? 50 : 30, isUnlocked ? 60 : 30),\r\n        k.outline(2, k.rgb(...(isUnlocked ? difficultyColor : UI_COLORS.TEXT_DISABLED))),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 1),\r\n        'achievementModal'\r\n    ]);\r\n    modalState.elements.push(iconBg);\r\n\r\n    const iconText = k.add([\r\n        k.text(achievement.icon, { size: 36 }),\r\n        k.pos(centerX, centerY - 70),\r\n        k.anchor('center'),\r\n        k.color(...(isUnlocked ? [255, 255, 255] : [80, 80, 80])),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 2),\r\n        'achievementModal'\r\n    ]);\r\n    modalState.elements.push(iconText);\r\n\r\n    // Description\r\n    const descText = k.add([\r\n        k.text(achievement.description, { size: UI_TEXT_SIZES.BODY, width: modalWidth - 40 }),\r\n        k.pos(centerX, centerY - 25),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_SECONDARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 1),\r\n        'achievementModal'\r\n    ]);\r\n    modalState.elements.push(descText);\r\n\r\n    // Build unlocks summary for display\r\n    const characterUnlocks = getCharactersUnlockedByAchievement(achievement.id);\r\n    const hasShopUnlocks = achievement.unlocks && achievement.unlocks.length > 0;\r\n    const hasCharacterUnlocks = characterUnlocks.length > 0;\r\n\r\n    // Show what this achievement unlocks (repurposed from hint)\r\n    if (hasCharacterUnlocks || hasShopUnlocks) {\r\n        const unlockParts = [];\r\n\r\n        // Add character names\r\n        characterUnlocks.forEach(char => {\r\n            unlockParts.push(`${char.char} ${char.name}`);\r\n        });\r\n\r\n        // Add shop item names\r\n        if (hasShopUnlocks) {\r\n            achievement.unlocks.forEach(unlockKey => {\r\n                const weapon = WEAPON_UNLOCKS[unlockKey];\r\n                const cosmetic = COSMETIC_UNLOCKS[unlockKey];\r\n                if (weapon) {\r\n                    unlockParts.push(weapon.name);\r\n                } else if (cosmetic) {\r\n                    unlockParts.push(cosmetic.name);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (unlockParts.length > 0) {\r\n            const unlocksText = k.add([\r\n                k.text(`Unlocks: ${unlockParts.join(', ')}`, { size: UI_TEXT_SIZES.SMALL, width: modalWidth - 40 }),\r\n                k.pos(centerX, centerY + 5),\r\n                k.anchor('center'),\r\n                k.color(...(isUnlocked ? UI_COLORS.SUCCESS : UI_COLORS.GOLD)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 1),\r\n                'achievementModal'\r\n            ]);\r\n            modalState.elements.push(unlocksText);\r\n        }\r\n    }\r\n\r\n    // Progress bar (if applicable)\r\n    const hasUnlocks = hasCharacterUnlocks || hasShopUnlocks;\r\n    const progressBaseY = hasUnlocks ? centerY + 35 : centerY + 25;\r\n\r\n    if (progress && !isUnlocked) {\r\n        const progressBarWidth = 280;\r\n        const progressBarHeight = 20;\r\n        const progressY = progressBaseY;\r\n\r\n        // Progress bar background\r\n        const progressBg = k.add([\r\n            k.rect(progressBarWidth, progressBarHeight),\r\n            k.pos(centerX, progressY),\r\n            k.anchor('center'),\r\n            k.color(30, 30, 40),\r\n            k.outline(2, k.rgb(80, 80, 100)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1),\r\n            'achievementModal'\r\n        ]);\r\n        modalState.elements.push(progressBg);\r\n\r\n        // Progress bar fill\r\n        const fillWidth = Math.max(4, progressBarWidth * progress.progress);\r\n        const progressFill = k.add([\r\n            k.rect(fillWidth, progressBarHeight - 4),\r\n            k.pos(centerX - progressBarWidth / 2 + fillWidth / 2, progressY),\r\n            k.anchor('center'),\r\n            k.color(...difficultyColor),\r\n            k.opacity(0.8),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 2),\r\n            'achievementModal'\r\n        ]);\r\n        modalState.elements.push(progressFill);\r\n\r\n        // Progress text\r\n        const progressText = k.add([\r\n            k.text(`${progress.current}/${progress.target} (${progress.percentage}%)`, { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(centerX, progressY + 25),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_TERTIARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1),\r\n            'achievementModal'\r\n        ]);\r\n        modalState.elements.push(progressText);\r\n    } else if (isUnlocked) {\r\n        // Show \"UNLOCKED\" status\r\n        const unlockedText = k.add([\r\n            k.text('UNLOCKED', { size: UI_TEXT_SIZES.LABEL }),\r\n            k.pos(centerX, progressBaseY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.SUCCESS),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1),\r\n            'achievementModal'\r\n        ]);\r\n        modalState.elements.push(unlockedText);\r\n    }\r\n\r\n    // Credit reward section (simplified - unlocks now shown above)\r\n    const creditReward = getAchievementReward(achievement);\r\n\r\n    if (creditReward > 0) {\r\n        const rewardY = progressBaseY + (isUnlocked ? 35 : (progress ? 55 : 35));\r\n\r\n        const rewardLabel = k.add([\r\n            k.text('-- REWARD --', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(centerX, rewardY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.GOLD),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1),\r\n            'achievementModal'\r\n        ]);\r\n        modalState.elements.push(rewardLabel);\r\n\r\n        const currencyName = getCurrencyName();\r\n        const rewardText = k.add([\r\n            k.text(`${currencyName}${creditReward}`, { size: UI_TEXT_SIZES.H2 }),\r\n            k.pos(centerX, rewardY + 25),\r\n            k.anchor('center'),\r\n            k.color(...(isUnlocked ? UI_COLORS.SUCCESS : UI_COLORS.GOLD)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1),\r\n            'achievementModal'\r\n        ]);\r\n        modalState.elements.push(rewardText);\r\n    }\r\n\r\n    // Difficulty badge - positioned near bottom of modal\r\n    // Using lenticular brackets instead of square brackets to avoid KAPLAY styled text tag parsing\r\n    const difficultyName = achievement.difficulty.charAt(0).toUpperCase() + achievement.difficulty.slice(1);\r\n    const difficultyBadge = k.add([\r\n        k.text(`${difficultyName}`, { size: UI_TEXT_SIZES.SMALL }),\r\n        k.pos(centerX, centerY + modalHeight / 2 - 60),\r\n        k.anchor('center'),\r\n        k.color(...difficultyColor),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 1),\r\n        'achievementModal'\r\n    ]);\r\n    modalState.elements.push(difficultyBadge);\r\n\r\n    // Close button\r\n    const closeButton = k.add([\r\n        k.rect(80, 30),\r\n        k.pos(centerX, centerY + modalHeight / 2 - 30),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.NEUTRAL),\r\n        k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n        k.area(),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 1),\r\n        'achievementModal'\r\n    ]);\r\n    modalState.elements.push(closeButton);\r\n\r\n    const closeText = k.add([\r\n        k.text('CLOSE', { size: UI_TEXT_SIZES.SMALL }),\r\n        k.pos(centerX, centerY + modalHeight / 2 - 30),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_SECONDARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 2),\r\n        'achievementModal'\r\n    ]);\r\n    modalState.elements.push(closeText);\r\n\r\n    closeButton.onClick(() => {\r\n        playMenuNav();\r\n        closeAchievementModal();\r\n    });\r\n\r\n    // Close on escape key\r\n    const escHandler = k.onKeyPress('escape', () => {\r\n        closeAchievementModal();\r\n    });\r\n    modalState.escHandler = escHandler;\r\n}\r\n\r\n/**\r\n * Close the achievement modal\r\n */\r\nexport function closeAchievementModal() {\r\n    if (!modalState.isOpen) return;\r\n\r\n    const k = modalState.k;\r\n    if (!k) return;\r\n\r\n    // Destroy all modal elements\r\n    modalState.elements.forEach(element => {\r\n        if (element && element.exists && element.exists()) {\r\n            k.destroy(element);\r\n        }\r\n    });\r\n    modalState.elements = [];\r\n\r\n    // Cancel escape handler\r\n    if (modalState.escHandler) {\r\n        modalState.escHandler.cancel();\r\n        modalState.escHandler = null;\r\n    }\r\n\r\n    modalState.isOpen = false;\r\n\r\n    // Call onClose callback\r\n    if (modalState.onClose) {\r\n        modalState.onClose();\r\n        modalState.onClose = null;\r\n    }\r\n}\r\n\r\n/**\r\n * Check if modal is currently open\r\n * @returns {boolean}\r\n */\r\nexport function isAchievementModalOpen() {\r\n    return modalState.isOpen;\r\n}\r\n","/**\r\n * Online Leaderboards System\r\n *\r\n * Integrates with Dreamlo API for global leaderboards.\r\n * Provides async submission and retrieval with caching.\r\n *\r\n * SECURITY LIMITATIONS (Accepted for casual browser game):\r\n * - Private API key is exposed in client-side code (anyone can view source)\r\n * - No server-side validation (scores can be spoofed via direct API calls)\r\n * - Client-side validation only (basic sanity checks, easily bypassed)\r\n *\r\n * For a competitive game, these would need:\r\n * - Server-side proxy to hide API keys\r\n * - Server-side score validation\r\n * - Anti-cheat measures\r\n */\r\n\r\n// Dreamlo API configuration - Two leaderboards\r\nconst LEADERBOARDS = {\r\n    allTime: {\r\n        publicKey: '696eba6f8f40bb1184b6c60f',\r\n        privateKey: 'YRU5IdY0w0uJvRF8cb9S1A21WwOAek3kyr3RcOYHbdYA'\r\n    },\r\n    daily: {\r\n        publicKey: '696ff2ee8f40bb1184b8cc92',\r\n        privateKey: 'SgdqIaI_fkWUlRVwoWLQlA1yEXBc-33UKZYWPWJcOX6Q'\r\n    }\r\n};\r\n\r\n// IMPORTANT: Dreamlo free tier only supports HTTP, not HTTPS.\r\n// Since the game is deployed on HTTPS (GitHub Pages), we need a CORS proxy.\r\n// The proxy routes: HTTPS (our game) -> Proxy -> HTTP (Dreamlo)\r\n//\r\n// Current proxy: corsproxy.io (free, public, browser-only)\r\n// For production, consider: Cloudflare Workers, Vercel Edge Functions, or Dreamlo paid tier\r\nconst CORS_PROXY = 'https://corsproxy.io/?';\r\nconst DREAMLO_RAW_URL = 'http://dreamlo.com/lb';\r\n\r\n/**\r\n * Build a proxied URL for Dreamlo API calls\r\n * @param {string} path - Path to append (e.g., \"/publicKey/json\")\r\n * @returns {string} - Full proxied URL\r\n */\r\nfunction buildProxiedUrl(path) {\r\n    return `${CORS_PROXY}${encodeURIComponent(DREAMLO_RAW_URL + path)}`;\r\n}\r\n\r\n// Cache configuration - separate cache for each board type\r\nconst CACHE_DURATION_MS = 60000; // 1 minute cache\r\nconst leaderboardCaches = {\r\n    allTime: { data: null, timestamp: 0 },\r\n    daily: { data: null, timestamp: 0 }\r\n};\r\n\r\n// Request timeout\r\nconst REQUEST_TIMEOUT_MS = 5000;\r\n\r\n/**\r\n * Sanitize player name for API submission\r\n * - Alphanumeric, underscores, and hyphens only\r\n * - Max 20 characters\r\n * @param {string} name - Raw player name\r\n * @returns {string} - Sanitized name\r\n */\r\nfunction sanitizeName(name) {\r\n    if (!name) return 'Anonymous';\r\n    // Remove special characters, keep alphanumeric, underscore, hyphen\r\n    const sanitized = name.replace(/[^a-zA-Z0-9_-]/g, '').substring(0, 20);\r\n    return sanitized || 'Anonymous';\r\n}\r\n\r\n/**\r\n * Validate score is reasonable (basic sanity check)\r\n * @param {number} score - Score to validate\r\n * @returns {boolean} - Whether score seems valid\r\n */\r\nfunction isValidScore(score) {\r\n    // Score should be a positive number, not absurdly high\r\n    // Max realistic score: ~100 floors * 1000 + 1000 kills * 10 + 100 bosses * 500 + 30000 time bonus\r\n    const MAX_REASONABLE_SCORE = 200000;\r\n    return typeof score === 'number' && score > 0 && score <= MAX_REASONABLE_SCORE;\r\n}\r\n\r\n/**\r\n * Fetch with timeout\r\n * @param {string} url - URL to fetch\r\n * @param {number} timeout - Timeout in ms\r\n * @returns {Promise<Response>}\r\n */\r\nasync function fetchWithTimeout(url, timeout = REQUEST_TIMEOUT_MS) {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n    try {\r\n        const response = await fetch(url, { signal: controller.signal });\r\n        clearTimeout(timeoutId);\r\n        return response;\r\n    } catch (error) {\r\n        clearTimeout(timeoutId);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Submit score to online leaderboard (non-blocking)\r\n * @param {Object} entry - Score entry\r\n * @param {string} entry.name - Player name\r\n * @param {number} entry.score - Score value\r\n * @param {number} entry.floor - Floor reached\r\n * @param {string} entry.character - Character used\r\n * @param {number} entry.time - Duration in seconds\r\n * @param {string} entry.date - Date string (YYYY-MM-DD)\r\n * @param {string} boardType - Which board to submit to ('allTime' or 'daily')\r\n * @returns {Promise<boolean>} - Whether submission succeeded\r\n */\r\nexport async function submitOnlineScore(entry, boardType = 'allTime') {\r\n    try {\r\n        // Validate score\r\n        if (!isValidScore(entry.score)) {\r\n            console.warn('[OnlineLeaderboards] Invalid score, skipping submission:', entry.score);\r\n            return false;\r\n        }\r\n\r\n        const board = LEADERBOARDS[boardType];\r\n        if (!board) {\r\n            console.warn('[OnlineLeaderboards] Unknown board type:', boardType);\r\n            return false;\r\n        }\r\n\r\n        const name = sanitizeName(entry.name);\r\n        const score = Math.floor(entry.score);\r\n        const seconds = Math.floor(entry.time || 0);\r\n\r\n        // Extra data: floor|character|date (pipe-delimited)\r\n        const text = `${entry.floor || 1}|${entry.character || 'unknown'}|${entry.date || ''}`;\r\n\r\n        // Dreamlo add URL format: /lb/{privateKey}/add/{name}/{score}/{seconds}/{text}\r\n        const path = `/${board.privateKey}/add/${encodeURIComponent(name)}/${score}/${seconds}/${encodeURIComponent(text)}`;\r\n        const url = buildProxiedUrl(path);\r\n\r\n        console.log(`[OnlineLeaderboards] Submitting score to ${boardType}:`, { name, score, floor: entry.floor });\r\n\r\n        const response = await fetchWithTimeout(url);\r\n\r\n        if (response.ok) {\r\n            console.log(`[OnlineLeaderboards] Score submitted to ${boardType} successfully`);\r\n            // Invalidate cache for this board on successful submission\r\n            leaderboardCaches[boardType].data = null;\r\n            leaderboardCaches[boardType].timestamp = 0;\r\n            return true;\r\n        } else {\r\n            console.warn('[OnlineLeaderboards] Submission failed with status:', response.status);\r\n            return false;\r\n        }\r\n    } catch (error) {\r\n        if (error.name === 'AbortError') {\r\n            console.warn('[OnlineLeaderboards] Submission timed out');\r\n        } else {\r\n            console.warn('[OnlineLeaderboards] Submission error:', error.message);\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Submit score to daily leaderboard (convenience wrapper)\r\n * @param {Object} entry - Score entry (same format as submitOnlineScore)\r\n * @returns {Promise<boolean>} - Whether submission succeeded\r\n */\r\nexport async function submitDailyScore(entry) {\r\n    return submitOnlineScore(entry, 'daily');\r\n}\r\n\r\n/**\r\n * Parse Dreamlo entry into standard format\r\n * @param {Object} entry - Raw Dreamlo entry\r\n * @returns {Object} - Parsed entry\r\n */\r\nfunction parseEntry(entry) {\r\n    // Parse text field: \"floor|character|date\"\r\n    const textParts = (entry.text || '').split('|');\r\n\r\n    return {\r\n        name: entry.name || 'Anonymous',\r\n        score: parseInt(entry.score, 10) || 0,\r\n        time: parseInt(entry.seconds, 10) || 0,\r\n        floor: parseInt(textParts[0], 10) || 1,\r\n        character: textParts[1] || 'survivor',\r\n        date: textParts[2] || ''\r\n    };\r\n}\r\n\r\n/**\r\n * Get online leaderboard\r\n * @param {number} limit - Max entries to return\r\n * @param {string} boardType - Which board to fetch ('allTime' or 'daily')\r\n * @returns {Promise<Object>} - { entries: [], totalCount: number, error: string|null }\r\n */\r\nexport async function getOnlineLeaderboard(limit = 10, boardType = 'allTime') {\r\n    try {\r\n        const board = LEADERBOARDS[boardType];\r\n        if (!board) {\r\n            console.warn('[OnlineLeaderboards] Unknown board type:', boardType);\r\n            return { entries: [], totalCount: 0, error: 'Unknown board type' };\r\n        }\r\n\r\n        const cache = leaderboardCaches[boardType];\r\n\r\n        // Check cache first\r\n        const now = Date.now();\r\n        if (cache.data && (now - cache.timestamp) < CACHE_DURATION_MS) {\r\n            console.log(`[OnlineLeaderboards] Using cached ${boardType} leaderboard`);\r\n            return {\r\n                entries: cache.data.slice(0, limit),\r\n                totalCount: cache.data.length,\r\n                error: null\r\n            };\r\n        }\r\n\r\n        // Dreamlo JSON URL: /lb/{publicKey}/json\r\n        const url = buildProxiedUrl(`/${board.publicKey}/json`);\r\n\r\n        console.log(`[OnlineLeaderboards] Fetching ${boardType} leaderboard...`);\r\n\r\n        const response = await fetchWithTimeout(url);\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        // Parse Dreamlo response format\r\n        // Format: { dreamlo: { leaderboard: { entry: [...] or entry: {} for single } } }\r\n        let entries = [];\r\n\r\n        if (data?.dreamlo?.leaderboard?.entry) {\r\n            const rawEntries = data.dreamlo.leaderboard.entry;\r\n            // Handle single entry (object) vs multiple (array)\r\n            if (Array.isArray(rawEntries)) {\r\n                entries = rawEntries.map(parseEntry);\r\n            } else {\r\n                entries = [parseEntry(rawEntries)];\r\n            }\r\n        }\r\n\r\n        // Update cache\r\n        cache.data = entries;\r\n        cache.timestamp = now;\r\n\r\n        console.log(`[OnlineLeaderboards] Fetched ${entries.length} entries from ${boardType}`);\r\n\r\n        return {\r\n            entries: entries.slice(0, limit),\r\n            totalCount: entries.length,\r\n            error: null\r\n        };\r\n    } catch (error) {\r\n        if (error.name === 'AbortError') {\r\n            console.warn('[OnlineLeaderboards] Fetch timed out');\r\n            return { entries: [], totalCount: 0, error: 'Connection timed out' };\r\n        }\r\n        console.warn('[OnlineLeaderboards] Fetch error:', error.message);\r\n        return { entries: [], totalCount: 0, error: 'Could not connect to server' };\r\n    }\r\n}\r\n\r\n/**\r\n * Get daily online leaderboard filtered by today's date\r\n * @param {number} limit - Max entries to return\r\n * @param {string} todayDate - Today's date string (YYYY-MM-DD) for filtering\r\n * @returns {Promise<Object>} - { entries: [], totalCount: number, error: string|null }\r\n */\r\nexport async function getDailyOnlineLeaderboard(limit = 10, todayDate) {\r\n    // Fetch all entries from daily board\r\n    const result = await getOnlineLeaderboard(1000, 'daily');\r\n\r\n    if (result.error) {\r\n        return result;\r\n    }\r\n\r\n    // Filter entries to only show today's date\r\n    const todayEntries = result.entries.filter(entry => entry.date === todayDate);\r\n\r\n    return {\r\n        entries: todayEntries.slice(0, limit),\r\n        totalCount: todayEntries.length,\r\n        error: null\r\n    };\r\n}\r\n\r\n/**\r\n * Get player's global rank and total players\r\n * @param {string} playerName - Player name to find\r\n * @param {number} playerScore - Player's score (for comparison if not in top entries)\r\n * @returns {Promise<Object>} - { rank: number|null, total: number, error: string|null }\r\n */\r\nexport async function getGlobalRank(playerName, playerScore) {\r\n    try {\r\n        const result = await getOnlineLeaderboard(1000); // Get more entries for accurate rank\r\n\r\n        if (result.error) {\r\n            return { rank: null, total: 0, error: result.error };\r\n        }\r\n\r\n        const sanitizedName = sanitizeName(playerName);\r\n\r\n        // Find player in entries\r\n        const playerIndex = result.entries.findIndex(e =>\r\n            e.name.toLowerCase() === sanitizedName.toLowerCase()\r\n        );\r\n\r\n        if (playerIndex >= 0) {\r\n            return {\r\n                rank: playerIndex + 1,\r\n                total: result.totalCount,\r\n                error: null\r\n            };\r\n        }\r\n\r\n        // Player not found in leaderboard - estimate rank based on score\r\n        // Count how many scores are higher than player's score\r\n        const higherScores = result.entries.filter(e => e.score > playerScore).length;\r\n\r\n        return {\r\n            rank: higherScores + 1,\r\n            total: result.totalCount + 1, // +1 to include the player\r\n            error: null\r\n        };\r\n    } catch (error) {\r\n        console.warn('[OnlineLeaderboards] Error getting rank:', error.message);\r\n        return { rank: null, total: 0, error: 'Could not determine rank' };\r\n    }\r\n}\r\n\r\n/**\r\n * Clear the leaderboard cache (useful after submission)\r\n * @param {string} boardType - Optional board type to clear ('allTime' or 'daily'), clears all if not specified\r\n */\r\nexport function clearCache(boardType = null) {\r\n    if (boardType && leaderboardCaches[boardType]) {\r\n        leaderboardCaches[boardType].data = null;\r\n        leaderboardCaches[boardType].timestamp = 0;\r\n    } else {\r\n        // Clear all caches\r\n        Object.keys(leaderboardCaches).forEach(key => {\r\n            leaderboardCaches[key].data = null;\r\n            leaderboardCaches[key].timestamp = 0;\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Check if online leaderboards are available (basic connectivity check)\r\n * @returns {Promise<boolean>}\r\n */\r\nexport async function checkOnlineAvailability() {\r\n    try {\r\n        const result = await getOnlineLeaderboard(1);\r\n        return result.error === null;\r\n    } catch {\r\n        return false;\r\n    }\r\n}\r\n","/**\r\n * Leaderboard System\r\n *\r\n * Manages local leaderboards for:\r\n * - Daily runs (per date)\r\n * - All-time high scores\r\n * - Personal bests (per character)\r\n *\r\n * All data persisted to localStorage.\r\n */\r\n\r\nimport { getTodayDateString } from './dailyRuns.js';\r\nimport { getPlayerName } from './metaProgression.js';\r\nimport { submitOnlineScore } from './onlineLeaderboards.js';\r\n\r\nconst STORAGE_KEY = 'superSmashTextyLeaderboards';\r\nconst MAX_DAILY_ENTRIES = 100;\r\nconst MAX_ALLTIME_ENTRIES = 100;\r\n\r\n/**\r\n * Get all leaderboard data\r\n * @returns {Object} - Leaderboard data structure\r\n */\r\nexport function getLeaderboards() {\r\n    try {\r\n        const data = localStorage.getItem(STORAGE_KEY);\r\n        const parsed = data ? JSON.parse(data) : null;\r\n\r\n        // Ensure proper structure\r\n        return {\r\n            daily: parsed?.daily || {},      // { \"2026-01-18\": [{ name, score, floor, character, time }] }\r\n            allTime: parsed?.allTime || [],  // [{ name, score, floor, character, date }]\r\n            personal: parsed?.personal || {} // { character: { bestFloor, bestScore, bestTime } }\r\n        };\r\n    } catch (e) {\r\n        console.warn('[Leaderboards] Failed to load leaderboards:', e);\r\n        return { daily: {}, allTime: [], personal: {} };\r\n    }\r\n}\r\n\r\n/**\r\n * Save leaderboard data\r\n * @param {Object} data - Data to save\r\n */\r\nfunction saveLeaderboards(data) {\r\n    try {\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\r\n    } catch (e) {\r\n        console.warn('[Leaderboards] Failed to save leaderboards:', e);\r\n    }\r\n}\r\n\r\n/**\r\n * Calculate score from run stats\r\n * @param {Object} stats - Run statistics\r\n * @param {number} stats.floorsReached - Number of floors cleared\r\n * @param {number} stats.enemiesKilled - Total enemies killed\r\n * @param {number} stats.bossesKilled - Total bosses killed\r\n * @param {number} stats.duration - Run duration in seconds\r\n * @returns {number} - Calculated score\r\n */\r\nexport function calculateScore(stats) {\r\n    const floorScore = (stats.floorsReached || 1) * 1000;\r\n    const enemyScore = (stats.enemiesKilled || 0) * 10;\r\n    const bossScore = (stats.bossesKilled || 0) * 500;\r\n\r\n    // Time bonus: Max 30000 points, decreases by 50 per second\r\n    const duration = stats.duration || 0;\r\n    const timeBonus = Math.max(0, 30000 - Math.floor(duration * 50));\r\n\r\n    return floorScore + enemyScore + bossScore + timeBonus;\r\n}\r\n\r\n/**\r\n * Submit a score to leaderboards\r\n * @param {Object} runData - Run data to submit\r\n * @param {number} runData.score - Final score\r\n * @param {number} runData.floor - Floor reached\r\n * @param {string} runData.character - Character used\r\n * @param {number} runData.time - Run duration in seconds\r\n * @param {boolean} runData.isDaily - Whether this is a daily run\r\n * @param {string} runData.date - Date of the run (YYYY-MM-DD)\r\n * @returns {Object} - Result { rank, isNewBest, dailyRank }\r\n */\r\nexport function submitScore(runData) {\r\n    const data = getLeaderboards();\r\n    const playerName = getPlayerName() || 'Anonymous';\r\n    const date = runData.date || getTodayDateString();\r\n\r\n    const entry = {\r\n        name: playerName,\r\n        score: runData.score || 0,\r\n        floor: runData.floor || 1,\r\n        character: runData.character || 'survivor',\r\n        time: runData.time || 0,\r\n        date: date,\r\n        timestamp: Date.now()\r\n    };\r\n\r\n    let result = {\r\n        rank: null,\r\n        isNewBest: false,\r\n        dailyRank: null,\r\n        isNewPersonalBest: false\r\n    };\r\n\r\n    // Add to daily leaderboard if it's a daily run\r\n    if (runData.isDaily) {\r\n        if (!data.daily[date]) {\r\n            data.daily[date] = [];\r\n        }\r\n\r\n        data.daily[date].push(entry);\r\n        data.daily[date].sort((a, b) => b.score - a.score);\r\n\r\n        // Trim to max entries\r\n        if (data.daily[date].length > MAX_DAILY_ENTRIES) {\r\n            data.daily[date] = data.daily[date].slice(0, MAX_DAILY_ENTRIES);\r\n        }\r\n\r\n        // Find rank (1-indexed)\r\n        result.dailyRank = data.daily[date].findIndex(e =>\r\n            e.timestamp === entry.timestamp && e.name === entry.name\r\n        ) + 1;\r\n\r\n        if (result.dailyRank === 0 || result.dailyRank > MAX_DAILY_ENTRIES) {\r\n            result.dailyRank = null;\r\n        }\r\n    }\r\n\r\n    // Add to all-time leaderboard\r\n    data.allTime.push(entry);\r\n    data.allTime.sort((a, b) => b.score - a.score);\r\n\r\n    // Trim to max entries\r\n    if (data.allTime.length > MAX_ALLTIME_ENTRIES) {\r\n        data.allTime = data.allTime.slice(0, MAX_ALLTIME_ENTRIES);\r\n    }\r\n\r\n    // Find all-time rank (1-indexed)\r\n    result.rank = data.allTime.findIndex(e =>\r\n        e.timestamp === entry.timestamp && e.name === entry.name\r\n    ) + 1;\r\n\r\n    if (result.rank === 0 || result.rank > MAX_ALLTIME_ENTRIES) {\r\n        result.rank = null;\r\n    }\r\n\r\n    // Update personal bests\r\n    const char = entry.character;\r\n    if (!data.personal[char]) {\r\n        data.personal[char] = {\r\n            bestScore: 0,\r\n            bestFloor: 0,\r\n            bestTime: Infinity\r\n        };\r\n    }\r\n\r\n    const personal = data.personal[char];\r\n\r\n    if (entry.score > personal.bestScore) {\r\n        personal.bestScore = entry.score;\r\n        result.isNewBest = true;\r\n        result.isNewPersonalBest = true;\r\n    }\r\n\r\n    if (entry.floor > personal.bestFloor) {\r\n        personal.bestFloor = entry.floor;\r\n        result.isNewPersonalBest = true;\r\n    }\r\n\r\n    // Best time only counts if they reached a minimum floor\r\n    if (entry.floor >= 3 && entry.time < personal.bestTime) {\r\n        personal.bestTime = entry.time;\r\n        result.isNewPersonalBest = true;\r\n    }\r\n\r\n    saveLeaderboards(data);\r\n\r\n    console.log('[Leaderboards] Score submitted:', entry, 'Result:', result);\r\n\r\n    // Submit to online leaderboard (non-blocking, fire and forget)\r\n    submitOnlineScore(entry).catch(err => {\r\n        console.warn('[Leaderboards] Online submission failed:', err);\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Get daily leaderboard for a specific date\r\n * @param {string} date - Date string (YYYY-MM-DD)\r\n * @param {number} limit - Max entries to return\r\n * @returns {Array} - Sorted leaderboard entries\r\n */\r\nexport function getDailyLeaderboard(date = null, limit = 10) {\r\n    const data = getLeaderboards();\r\n    const targetDate = date || getTodayDateString();\r\n    const entries = data.daily[targetDate] || [];\r\n\r\n    return entries.slice(0, limit);\r\n}\r\n\r\n/**\r\n * Get all-time leaderboard\r\n * @param {number} limit - Max entries to return\r\n * @returns {Array} - Sorted leaderboard entries\r\n */\r\nexport function getAllTimeLeaderboard(limit = 10) {\r\n    const data = getLeaderboards();\r\n    return data.allTime.slice(0, limit);\r\n}\r\n\r\n/**\r\n * Get personal bests\r\n * @returns {Object} - Personal bests by character\r\n */\r\nexport function getPersonalBests() {\r\n    const data = getLeaderboards();\r\n    return data.personal;\r\n}\r\n\r\n/**\r\n * Get personal best for a specific character\r\n * @param {string} character - Character key\r\n * @returns {Object|null} - Personal best data or null\r\n */\r\nexport function getCharacterPersonalBest(character) {\r\n    const data = getLeaderboards();\r\n    return data.personal[character] || null;\r\n}\r\n\r\n/**\r\n * Get player's rank in a daily leaderboard\r\n * @param {string} date - Date string\r\n * @returns {number|null} - Player's rank or null if not found\r\n */\r\nexport function getPlayerDailyRank(date = null) {\r\n    const targetDate = date || getTodayDateString();\r\n    const playerName = getPlayerName() || 'Anonymous';\r\n    const leaderboard = getDailyLeaderboard(targetDate, 100);\r\n\r\n    const index = leaderboard.findIndex(e => e.name === playerName);\r\n    return index >= 0 ? index + 1 : null;\r\n}\r\n\r\n/**\r\n * Get player's all-time rank\r\n * @returns {number|null} - Player's rank or null if not found\r\n */\r\nexport function getPlayerAllTimeRank() {\r\n    const playerName = getPlayerName() || 'Anonymous';\r\n    const leaderboard = getAllTimeLeaderboard(100);\r\n\r\n    const index = leaderboard.findIndex(e => e.name === playerName);\r\n    return index >= 0 ? index + 1 : null;\r\n}\r\n\r\n/**\r\n * Get player's best score entry in all-time leaderboard\r\n * @returns {Object|null} - Best entry or null\r\n */\r\nexport function getPlayerBestEntry() {\r\n    const playerName = getPlayerName() || 'Anonymous';\r\n    const leaderboard = getAllTimeLeaderboard(100);\r\n\r\n    return leaderboard.find(e => e.name === playerName) || null;\r\n}\r\n\r\n/**\r\n * Format time for display\r\n * @param {number} seconds - Duration in seconds\r\n * @returns {string} - Formatted time (MM:SS)\r\n */\r\nexport function formatTime(seconds) {\r\n    if (seconds === Infinity || seconds === undefined || seconds === null) {\r\n        return '--:--';\r\n    }\r\n\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n}\r\n\r\n/**\r\n * Format score for display\r\n * @param {number} score - Score value\r\n * @returns {string} - Formatted score with commas\r\n */\r\nexport function formatScore(score) {\r\n    return (score || 0).toLocaleString();\r\n}\r\n\r\n/**\r\n * Clean up old daily leaderboards (keep last 30 days)\r\n */\r\nexport function cleanupOldLeaderboards() {\r\n    const data = getLeaderboards();\r\n    const cutoffDate = new Date();\r\n    cutoffDate.setDate(cutoffDate.getDate() - 30);\r\n    const cutoffStr = cutoffDate.toISOString().split('T')[0];\r\n\r\n    let cleaned = false;\r\n\r\n    for (const date of Object.keys(data.daily)) {\r\n        if (date < cutoffStr) {\r\n            delete data.daily[date];\r\n            cleaned = true;\r\n        }\r\n    }\r\n\r\n    if (cleaned) {\r\n        saveLeaderboards(data);\r\n        console.log('[Leaderboards] Cleaned up old daily leaderboards');\r\n    }\r\n}\r\n\r\n/**\r\n * Get recent high scores (last 7 days)\r\n * @param {number} limit - Max entries per day\r\n * @returns {Array} - Array of { date, entries }\r\n */\r\nexport function getRecentHighScores(limit = 3) {\r\n    const data = getLeaderboards();\r\n    const today = new Date();\r\n    const results = [];\r\n\r\n    for (let i = 0; i < 7; i++) {\r\n        const date = new Date(today);\r\n        date.setDate(date.getDate() - i);\r\n        const dateStr = date.toISOString().split('T')[0];\r\n\r\n        if (data.daily[dateStr] && data.daily[dateStr].length > 0) {\r\n            results.push({\r\n                date: dateStr,\r\n                entries: data.daily[dateStr].slice(0, limit)\r\n            });\r\n        }\r\n    }\r\n\r\n    return results;\r\n}\r\n","/**\r\n * Reusable UI Component Factories\r\n *\r\n * Centralized component creation for consistent UI across all game scenes\r\n */\r\n\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_SPACING,\r\n    UI_Z_LAYERS,\r\n    formatButtonText\r\n} from './uiConfig.js';\r\nimport { playMenuNav, playMenuSelect } from '../systems/sounds.js';\r\n\r\n// =============================================================================\r\n// BUTTON COMPONENT\r\n// =============================================================================\r\n\r\n/**\r\n * Create a standardized button with hover states\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} options - Configuration options\r\n * @param {string} options.text - Button text\r\n * @param {string} options.size - Button size: 'XS', 'SM', 'MD', 'LG', 'XL'\r\n * @param {string} options.variant - Color variant: 'primary', 'secondary', 'danger', 'neutral', 'gold'\r\n * @param {number} options.x - X position\r\n * @param {number} options.y - Y position\r\n * @param {Function} options.onClick - Click handler\r\n * @param {boolean} options.disabled - Whether button is disabled\r\n * @returns {Object} - Button object with bg, label, and control methods\r\n */\r\nexport function createButton(k, options = {}) {\r\n    const {\r\n        text = 'Button',\r\n        size = 'MD',\r\n        variant = 'secondary',\r\n        x = 0,\r\n        y = 0,\r\n        onClick = null,\r\n        disabled = false\r\n    } = options;\r\n\r\n    // Get dimensions from size\r\n    const dimensions = UI_SIZES.BUTTON[size] || UI_SIZES.BUTTON.MD;\r\n    const { width, height } = dimensions;\r\n\r\n    // Get colors from variant\r\n    const variantColors = {\r\n        primary: { bg: UI_COLORS.PRIMARY, hover: UI_COLORS.PRIMARY_HOVER },\r\n        secondary: { bg: UI_COLORS.SECONDARY, hover: UI_COLORS.SECONDARY_HOVER },\r\n        danger: { bg: UI_COLORS.DANGER, hover: UI_COLORS.DANGER_HOVER },\r\n        neutral: { bg: UI_COLORS.NEUTRAL, hover: UI_COLORS.NEUTRAL_HOVER },\r\n        gold: { bg: UI_COLORS.GOLD, hover: UI_COLORS.GOLD_HOVER },\r\n        tertiary: { bg: UI_COLORS.TERTIARY, hover: UI_COLORS.TERTIARY_HOVER }\r\n    };\r\n\r\n    const colors = variantColors[variant] || variantColors.secondary;\r\n\r\n    // Text size based on button size\r\n    const textSizes = {\r\n        XS: UI_TEXT_SIZES.TINY,\r\n        SM: UI_TEXT_SIZES.SMALL,\r\n        MD: UI_TEXT_SIZES.BODY,\r\n        LG: UI_TEXT_SIZES.H2,\r\n        XL: UI_TEXT_SIZES.H1\r\n    };\r\n    const textSize = textSizes[size] || UI_TEXT_SIZES.BODY;\r\n\r\n    // Create button background\r\n    const bg = k.add([\r\n        k.rect(width, height),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...(disabled ? UI_COLORS.BG_DISABLED : colors.bg)),\r\n        k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n        k.area(),\r\n        k.fixed(),\r\n        k.scale(1),\r\n        k.z(UI_Z_LAYERS.UI_ELEMENTS),\r\n        'uiButton'\r\n    ]);\r\n\r\n    // Create button label\r\n    const label = k.add([\r\n        k.text(formatButtonText(text), { size: textSize }),\r\n        k.pos(x, y),\r\n        k.anchor('center'),\r\n        k.color(...(disabled ? UI_COLORS.TEXT_DISABLED : UI_COLORS.TEXT_PRIMARY)),\r\n        k.fixed(),\r\n        k.scale(1),\r\n        k.z(UI_Z_LAYERS.UI_TEXT),\r\n        'uiButtonText'\r\n    ]);\r\n\r\n    // Store state on bg\r\n    bg.isHovered = false;\r\n    bg.isDisabled = disabled;\r\n    bg.originalColor = [...colors.bg];\r\n    bg.hoverColor = [...colors.hover];\r\n    bg.label = label;\r\n\r\n    // Hover effects\r\n    bg.onHoverUpdate(() => {\r\n        if (bg.isDisabled) return;\r\n        if (!bg.isHovered) {\r\n            bg.isHovered = true;\r\n            playMenuNav();\r\n        }\r\n        bg.color = k.rgb(...bg.hoverColor);\r\n        bg.outline.color = k.rgb(...UI_COLORS.BORDER_HOVER);\r\n        bg.scale = k.vec2(1.02, 1.02);\r\n        label.scale = k.vec2(1.02, 1.02);\r\n    });\r\n\r\n    bg.onHoverEnd(() => {\r\n        if (bg.isDisabled) return;\r\n        bg.isHovered = false;\r\n        bg.color = k.rgb(...bg.originalColor);\r\n        bg.outline.color = k.rgb(...UI_COLORS.BORDER);\r\n        bg.scale = k.vec2(1, 1);\r\n        label.scale = k.vec2(1, 1);\r\n    });\r\n\r\n    // Click handler\r\n    if (onClick) {\r\n        bg.onClick(() => {\r\n            if (bg.isDisabled) return;\r\n            playMenuSelect();\r\n            onClick();\r\n        });\r\n    }\r\n\r\n    // Methods\r\n    const setDisabled = (isDisabled) => {\r\n        bg.isDisabled = isDisabled;\r\n        if (isDisabled) {\r\n            bg.color = k.rgb(...UI_COLORS.BG_DISABLED);\r\n            label.color = k.rgb(...UI_COLORS.TEXT_DISABLED);\r\n        } else {\r\n            bg.color = k.rgb(...bg.originalColor);\r\n            label.color = k.rgb(...UI_COLORS.TEXT_PRIMARY);\r\n        }\r\n    };\r\n\r\n    const setText = (newText) => {\r\n        label.text = formatButtonText(newText);\r\n    };\r\n\r\n    const destroy = () => {\r\n        if (bg.exists()) k.destroy(bg);\r\n        if (label.exists()) k.destroy(label);\r\n    };\r\n\r\n    return {\r\n        bg,\r\n        label,\r\n        setDisabled,\r\n        setText,\r\n        destroy\r\n    };\r\n}\r\n\r\n// =============================================================================\r\n// CARD COMPONENT\r\n// =============================================================================\r\n\r\n/**\r\n * Create a styled card container\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} options - Configuration options\r\n * @param {string} options.size - Card size: 'FULL', 'HALF', 'ICON'\r\n * @param {number} options.x - X position\r\n * @param {number} options.y - Y position\r\n * @param {string} options.title - Optional card title\r\n * @param {string} options.status - Optional status: 'default', 'success', 'warning', 'error', 'selected'\r\n * @returns {Object} - Card object with elements and content area info\r\n */\r\nexport function createCard(k, options = {}) {\r\n    const {\r\n        size = 'FULL',\r\n        x = 0,\r\n        y = 0,\r\n        title = null,\r\n        status = 'default'\r\n    } = options;\r\n\r\n    // Get dimensions from size\r\n    const dimensions = UI_SIZES.CARD[size] || UI_SIZES.CARD.FULL;\r\n    const { width, height } = dimensions;\r\n\r\n    // Get border color from status\r\n    const statusColors = {\r\n        default: UI_COLORS.BORDER,\r\n        success: UI_COLORS.SUCCESS,\r\n        warning: UI_COLORS.WARNING,\r\n        error: UI_COLORS.ERROR,\r\n        selected: UI_COLORS.BORDER_ACTIVE\r\n    };\r\n    const borderColor = statusColors[status] || statusColors.default;\r\n\r\n    // Background color\r\n    const bgColor = status === 'selected' ? UI_COLORS.BG_LIGHT : UI_COLORS.BG_MEDIUM;\r\n\r\n    const elements = [];\r\n\r\n    // Card background\r\n    const bg = k.add([\r\n        k.rect(width, height),\r\n        k.pos(x, y),\r\n        k.anchor('topleft'),\r\n        k.color(...bgColor),\r\n        k.outline(2, k.rgb(...borderColor)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n    ]);\r\n    elements.push(bg);\r\n\r\n    // Title if provided\r\n    let titleElement = null;\r\n    let contentStartY = y + UI_SPACING.SM;\r\n\r\n    if (title) {\r\n        titleElement = k.add([\r\n            k.text(title, { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(x + UI_SPACING.SM, y + UI_SPACING.SM),\r\n            k.anchor('topleft'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n        elements.push(titleElement);\r\n        contentStartY = y + UI_SPACING.SM + UI_TEXT_SIZES.SMALL + UI_SPACING.XS;\r\n    }\r\n\r\n    // Methods\r\n    const setStatus = (newStatus) => {\r\n        const newBorderColor = statusColors[newStatus] || statusColors.default;\r\n        const newBgColor = newStatus === 'selected' ? UI_COLORS.BG_LIGHT : UI_COLORS.BG_MEDIUM;\r\n        bg.color = k.rgb(...newBgColor);\r\n        bg.outline.color = k.rgb(...newBorderColor);\r\n    };\r\n\r\n    const destroy = () => {\r\n        elements.forEach(el => {\r\n            if (el.exists()) k.destroy(el);\r\n        });\r\n    };\r\n\r\n    return {\r\n        bg,\r\n        title: titleElement,\r\n        elements,\r\n        contentArea: {\r\n            x: x + UI_SPACING.SM,\r\n            y: contentStartY,\r\n            width: width - UI_SPACING.SM * 2,\r\n            height: height - (contentStartY - y) - UI_SPACING.SM\r\n        },\r\n        setStatus,\r\n        destroy\r\n    };\r\n}\r\n\r\n// =============================================================================\r\n// TAB SYSTEM COMPONENT\r\n// =============================================================================\r\n\r\n/**\r\n * Create a tab navigation system\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} options - Configuration options\r\n * @param {Array} options.tabs - Array of { key, label } objects\r\n * @param {string} options.activeTab - Currently active tab key\r\n * @param {number} options.y - Y position\r\n * @param {Function} options.onSelect - Callback when tab is selected\r\n * @returns {Object} - Tab system object with elements and control methods\r\n */\r\nexport function createTabs(k, options = {}) {\r\n    const {\r\n        tabs = [],\r\n        activeTab = tabs[0]?.key,\r\n        y = 80,\r\n        onSelect = null\r\n    } = options;\r\n\r\n    const tabWidth = 85;\r\n    const tabHeight = 30;\r\n    const tabSpacing = 95;\r\n\r\n    // Calculate centered positions\r\n    const totalWidth = (tabs.length - 1) * tabSpacing;\r\n    const firstTabX = k.width() / 2 - totalWidth / 2;\r\n\r\n    const elements = [];\r\n    const tabElements = [];\r\n\r\n    tabs.forEach((tab, index) => {\r\n        const tabX = firstTabX + index * tabSpacing;\r\n        const isActive = activeTab === tab.key;\r\n\r\n        const tabBg = k.add([\r\n            k.rect(tabWidth, tabHeight),\r\n            k.pos(tabX, y),\r\n            k.anchor('center'),\r\n            k.color(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM)),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n\r\n        const tabLabel = k.add([\r\n            k.text(tab.label, { size: UI_TEXT_SIZES.BODY }),\r\n            k.pos(tabX, y),\r\n            k.anchor('center'),\r\n            k.color(...(isActive ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_TERTIARY)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        tabBg.onClick(() => {\r\n            playMenuNav();\r\n            if (onSelect) {\r\n                onSelect(tab.key);\r\n            }\r\n        });\r\n\r\n        elements.push(tabBg, tabLabel);\r\n        tabElements.push({ bg: tabBg, label: tabLabel, key: tab.key });\r\n    });\r\n\r\n    // Update active tab visually\r\n    const setActiveTab = (newActiveKey) => {\r\n        tabElements.forEach(tab => {\r\n            const isActive = tab.key === newActiveKey;\r\n            tab.bg.color = k.rgb(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM));\r\n            tab.label.color = k.rgb(...(isActive ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_TERTIARY));\r\n        });\r\n    };\r\n\r\n    const destroy = () => {\r\n        elements.forEach(el => {\r\n            if (el.exists()) k.destroy(el);\r\n        });\r\n    };\r\n\r\n    return {\r\n        elements,\r\n        tabElements,\r\n        setActiveTab,\r\n        destroy\r\n    };\r\n}\r\n\r\n// =============================================================================\r\n// MODAL COMPONENT\r\n// =============================================================================\r\n\r\n/**\r\n * Create a modal dialog\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} options - Configuration options\r\n * @param {string} options.title - Modal title\r\n * @param {string} options.content - Modal content text\r\n * @param {Array} options.buttons - Array of { text, variant, onClick } objects\r\n * @returns {Object} - Modal object with elements and close method\r\n */\r\nexport function createModal(k, options = {}) {\r\n    const {\r\n        title = 'Modal',\r\n        content = '',\r\n        buttons = [{ text: 'OK', variant: 'primary', onClick: null }]\r\n    } = options;\r\n\r\n    const modalWidth = 400;\r\n    const modalHeight = 200;\r\n    const elements = [];\r\n\r\n    // Overlay background\r\n    const overlay = k.add([\r\n        k.rect(k.width(), k.height()),\r\n        k.pos(0, 0),\r\n        k.color(0, 0, 0),\r\n        k.opacity(0.7),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL - 1)\r\n    ]);\r\n    elements.push(overlay);\r\n\r\n    // Modal background\r\n    const bg = k.add([\r\n        k.rect(modalWidth, modalHeight),\r\n        k.pos(k.width() / 2, k.height() / 2),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.BG_MEDIUM),\r\n        k.outline(3, k.rgb(...UI_COLORS.BORDER)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL)\r\n    ]);\r\n    elements.push(bg);\r\n\r\n    // Title\r\n    const titleEl = k.add([\r\n        k.text(title, { size: UI_TEXT_SIZES.H2 }),\r\n        k.pos(k.width() / 2, k.height() / 2 - 60),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 1)\r\n    ]);\r\n    elements.push(titleEl);\r\n\r\n    // Content\r\n    const contentEl = k.add([\r\n        k.text(content, { size: UI_TEXT_SIZES.SMALL, width: modalWidth - 40 }),\r\n        k.pos(k.width() / 2, k.height() / 2 - 10),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_SECONDARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.MODAL + 1)\r\n    ]);\r\n    elements.push(contentEl);\r\n\r\n    // Buttons\r\n    const buttonY = k.height() / 2 + 50;\r\n    const buttonSpacing = 120;\r\n    const startX = k.width() / 2 - ((buttons.length - 1) * buttonSpacing) / 2;\r\n\r\n    buttons.forEach((btn, index) => {\r\n        const buttonX = startX + index * buttonSpacing;\r\n        const button = createButton(k, {\r\n            text: btn.text,\r\n            size: 'SM',\r\n            variant: btn.variant || 'secondary',\r\n            x: buttonX,\r\n            y: buttonY,\r\n            onClick: () => {\r\n                if (btn.onClick) btn.onClick();\r\n                close();\r\n            }\r\n        });\r\n        elements.push(button.bg, button.label);\r\n    });\r\n\r\n    // Close method\r\n    const close = () => {\r\n        elements.forEach(el => {\r\n            if (el && el.exists && el.exists()) {\r\n                k.destroy(el);\r\n            }\r\n        });\r\n    };\r\n\r\n    // Allow clicking overlay to close\r\n    overlay.onClick(close);\r\n\r\n    // Escape to close\r\n    const escHandler = k.onKeyPress('escape', () => {\r\n        close();\r\n        escHandler.cancel();\r\n    });\r\n\r\n    return {\r\n        elements,\r\n        close\r\n    };\r\n}\r\n\r\n// =============================================================================\r\n// STAT BAR COMPONENT (for character stats display)\r\n// =============================================================================\r\n\r\n/**\r\n * Get color based on percentage (red at 0%, yellow at 50%, green at 100%)\r\n * @param {number} percent - Value from 0 to 1\r\n * @returns {Array} RGB color array\r\n */\r\nfunction getPercentageColor(percent) {\r\n    // Clamp to 0-1\r\n    percent = Math.max(0, Math.min(1, percent));\r\n\r\n    if (percent < 0.5) {\r\n        // Red to Yellow (0% to 50%)\r\n        const t = percent * 2; // 0 to 1\r\n        return [255, Math.round(200 * t), 50];\r\n    } else {\r\n        // Yellow to Green (50% to 100%)\r\n        const t = (percent - 0.5) * 2; // 0 to 1\r\n        return [Math.round(255 * (1 - t)), 200 + Math.round(55 * t), 50 + Math.round(100 * t)];\r\n    }\r\n}\r\n\r\n/**\r\n * Create a labeled stat bar\r\n * @param {Object} k - Kaplay instance\r\n * @param {Object} options - Configuration options\r\n * @param {string} options.label - Stat label\r\n * @param {number} options.value - Current value\r\n * @param {number} options.maxValue - Maximum value for the bar\r\n * @param {number} options.x - X position\r\n * @param {number} options.y - Y position\r\n * @param {number} options.width - Bar width\r\n * @param {Array} options.color - Fill color (ignored if usePercentageColor is true)\r\n * @param {boolean} options.usePercentageColor - If true, color bar based on fill % (red=low, green=high)\r\n * @returns {Object} - Object with elements and update method\r\n */\r\nexport function createStatBar(k, options = {}) {\r\n    const {\r\n        label = '',\r\n        value = 0,\r\n        maxValue = 100,\r\n        x = 0,\r\n        y = 0,\r\n        width = 80,\r\n        color = UI_COLORS.PRIMARY,\r\n        usePercentageColor = false\r\n    } = options;\r\n\r\n    const elements = [];\r\n    const barHeight = 6;\r\n\r\n    // Calculate fill color\r\n    const percent = value / maxValue;\r\n    const fillColor = usePercentageColor ? getPercentageColor(percent) : color;\r\n\r\n    // Label\r\n    const labelEl = k.add([\r\n        k.text(label, { size: UI_TEXT_SIZES.TINY }),\r\n        k.pos(x, y),\r\n        k.anchor('topleft'),\r\n        k.color(...UI_COLORS.TEXT_SECONDARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_TEXT)\r\n    ]);\r\n    elements.push(labelEl);\r\n\r\n    // Bar background\r\n    const barBg = k.add([\r\n        k.rect(width, barHeight),\r\n        k.pos(x, y + 14),\r\n        k.anchor('topleft'),\r\n        k.color(...UI_COLORS.BG_DARK),\r\n        k.outline(1, k.rgb(50, 50, 60)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n    ]);\r\n    elements.push(barBg);\r\n\r\n    // Bar fill\r\n    const fillWidth = Math.max(0, (width - 2) * percent);\r\n    const barFill = k.add([\r\n        k.rect(fillWidth, barHeight - 2),\r\n        k.pos(x + 1, y + 15),\r\n        k.anchor('topleft'),\r\n        k.color(...fillColor),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\r\n    ]);\r\n    elements.push(barFill);\r\n\r\n    // Value text\r\n    const valueEl = k.add([\r\n        k.text(`${value}`, { size: UI_TEXT_SIZES.MICRO }),\r\n        k.pos(x + width + 4, y + 10),\r\n        k.anchor('left'),\r\n        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.UI_TEXT)\r\n    ]);\r\n    elements.push(valueEl);\r\n\r\n    const updateValue = (newValue) => {\r\n        const clampedValue = Math.max(0, Math.min(maxValue, newValue));\r\n        const newPercent = clampedValue / maxValue;\r\n        barFill.width = Math.max(0, (width - 2) * newPercent);\r\n        valueEl.text = `${clampedValue}`;\r\n        if (usePercentageColor) {\r\n            const newColor = getPercentageColor(newPercent);\r\n            barFill.color = k.rgb(...newColor);\r\n        }\r\n    };\r\n\r\n    const destroy = () => {\r\n        elements.forEach(el => {\r\n            if (el.exists()) k.destroy(el);\r\n        });\r\n    };\r\n\r\n    return {\r\n        elements,\r\n        updateValue,\r\n        destroy\r\n    };\r\n}\r\n","// Game over scene - TV Station themed with player comparison table and currency animation\r\nimport { getCurrency, getCurrencyName, getSaveData, getSelectedCharacter, getPlayerName, calculateRunXP, addXP, getPlayerLevel, getXPProgress, getTotalXP, getXPForNextLevel } from '../systems/metaProgression.js';\r\nimport { playMenuSelect, playMenuNav, stopMusic, playDefeatMusic } from '../systems/sounds.js';\r\nimport { isMultiplayerActive, isHost } from '../systems/multiplayerGame.js';\r\nimport { onMessage, offMessage, broadcast } from '../systems/networkSystem.js';\r\nimport { ENEMY_TYPES } from '../data/enemies.js';\r\nimport { MINIBOSS_TYPES } from '../data/minibosses.js';\r\nimport { BOSS_TYPES } from '../data/bosses.js';\r\nimport { ACHIEVEMENTS, ACHIEVEMENT_COLORS } from '../data/achievements.js';\r\nimport { getRunUnlockedAchievements } from '../systems/achievementChecker.js';\r\nimport { showAchievementModal, isAchievementModalOpen } from '../components/achievementModal.js';\r\nimport { calculateScore, submitScore, formatScore } from '../systems/leaderboards.js';\r\nimport { getGlobalRank, submitOnlineScore, submitDailyScore } from '../systems/onlineLeaderboards.js';\r\nimport { markDailyCompleted, getTodayDateString } from '../systems/dailyRuns.js';\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS,\r\n    UI_TERMS,\r\n    createProgressBar\r\n} from '../config/uiConfig.js';\r\nimport { createButton } from '../config/uiComponents.js';\r\n\r\n// Get enemy name from data files, with fallback to type key\r\nfunction getEnemyName(type) {\r\n    if (ENEMY_TYPES[type]?.name) return ENEMY_TYPES[type].name;\r\n    if (MINIBOSS_TYPES[type]?.name) return MINIBOSS_TYPES[type].name;\r\n    if (BOSS_TYPES[type]?.name) return BOSS_TYPES[type].name;\r\n    return type;\r\n}\r\n\r\n// Get enemy character for display\r\nfunction getEnemyChar(type) {\r\n    return ENEMY_TYPES[type]?.char || MINIBOSS_TYPES[type]?.char || BOSS_TYPES[type]?.char || 'E';\r\n}\r\n\r\n// Get enemy color for display\r\nfunction getEnemyColor(type) {\r\n    return ENEMY_TYPES[type]?.color || MINIBOSS_TYPES[type]?.color || BOSS_TYPES[type]?.color || [255, 100, 100];\r\n}\r\n\r\n// Currency icons for variety (gold themed)\r\nconst CURRENCY_ICONS = ['$', '', '', '', ''];\r\n\r\n// Award definitions\r\nconst AWARDS = [\r\n    { id: 'slayer', title: 'Slayer', icon: '', desc: 'Most enemy kills', check: (stats) => stats.kills || 0, color: [255, 100, 100] },\r\n    { id: 'collector', title: 'Hoarder', icon: '', desc: 'Most credits collected', check: (stats) => stats.creditsPickedUp || 0, color: [255, 215, 0] },\r\n    { id: 'bossBuster', title: 'Boss Buster', icon: '', desc: 'Most bosses defeated', check: (stats) => stats.bossesKilled || 0, color: [255, 150, 50] }\r\n];\r\n\r\nexport function setupGameOverScene(k) {\r\n    k.scene('gameOver', (args) => {\r\n        // Stop combat music, play defeat music\r\n        stopMusic();\r\n        playDefeatMusic();\r\n\r\n        const runStats = args?.runStats || {\r\n            floorsReached: 1,\r\n            roomsCleared: 0,\r\n            enemiesKilled: 0,\r\n            bossesKilled: 0,\r\n            killsByType: {}\r\n        };\r\n        const currencyEarned = args?.currencyEarned || 0;\r\n        const totalCurrency = getCurrency();\r\n        const saveData = getSaveData();\r\n        const currencyName = getCurrencyName();\r\n        const partyStats = args?.partyStats || [];\r\n        const isDailyRun = args?.isDailyRun || false;\r\n        const dailyCharacter = args?.dailyCharacter || null;\r\n        // Use the date from when the daily run started, not when it ended (handles midnight boundary)\r\n        const runDate = args?.dailyDate || getTodayDateString();\r\n\r\n        // Calculate duration\r\n        const duration = runStats.startTime ? (Date.now() - runStats.startTime) / 1000 : 0;\r\n\r\n        // Calculate and submit score\r\n        const score = calculateScore({\r\n            floorsReached: runStats.floorsReached || 1,\r\n            enemiesKilled: runStats.enemiesKilled || 0,\r\n            bossesKilled: runStats.bossesKilled || 0,\r\n            duration: duration\r\n        });\r\n\r\n        const character = dailyCharacter || getSelectedCharacter() || 'survivor';\r\n\r\n        // Submit to local leaderboards\r\n        const leaderboardResult = submitScore({\r\n            score: score,\r\n            floor: runStats.floorsReached || 1,\r\n            character: character,\r\n            time: duration,\r\n            isDaily: isDailyRun,\r\n            date: runDate\r\n        });\r\n\r\n        // Submit to global online leaderboards (all players submit their own scores)\r\n        const playerName = getPlayerName() || 'Anonymous';\r\n        const inMultiplayer = isMultiplayerActive();\r\n\r\n        // All players submit to online leaderboards - each player's score matters\r\n        const onlineScoreEntry = {\r\n            name: playerName,\r\n            score: score,\r\n            floor: runStats.floorsReached || 1,\r\n            character: character,\r\n            time: duration,\r\n            date: runDate\r\n        };\r\n\r\n        // Always submit to global all-time board\r\n        submitOnlineScore(onlineScoreEntry, 'allTime');\r\n\r\n        // Also submit to daily board if this is a daily run\r\n        if (isDailyRun) {\r\n            submitDailyScore(onlineScoreEntry);\r\n        }\r\n\r\n        // Mark daily as completed if it was a daily run\r\n        if (isDailyRun) {\r\n            markDailyCompleted({\r\n                score: score,\r\n                floor: runStats.floorsReached || 1,\r\n                character: character,\r\n                duration: duration\r\n            });\r\n        }\r\n\r\n        // Calculate total credits from all players\r\n        const totalTeamCredits = partyStats.length > 0\r\n            ? partyStats.reduce((sum, p) => sum + (p.creditsPickedUp || 0), 0)\r\n            : currencyEarned;\r\n\r\n        // Get achievements unlocked this run\r\n        const unlockedAchievementIds = getRunUnlockedAchievements();\r\n\r\n        // Calculate and award XP for this run\r\n        const xpEarned = calculateRunXP({\r\n            floorsReached: runStats.floorsReached || 1,\r\n            enemiesKilled: runStats.enemiesKilled || 0,\r\n            bossesKilled: runStats.bossesKilled || 0,\r\n            isDailyRun: isDailyRun\r\n        });\r\n        const xpResult = addXP(xpEarned);\r\n        const leveledUp = xpResult.levelsGained > 0;\r\n\r\n        // Background overlay\r\n        k.add([\r\n            k.rect(k.width(), k.height()),\r\n            k.pos(0, 0),\r\n            k.anchor('topleft'),\r\n            k.color(20, 15, 25),\r\n            k.opacity(0.98),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.OVERLAY)\r\n        ]);\r\n\r\n        // ==========================================\r\n        // HEADER SECTION - Title, Score, Rankings\r\n        // ==========================================\r\n        const headerY = 25;\r\n\r\n        // Title\r\n        k.add([\r\n            k.text('BROADCAST TERMINATED', { size: 28 }),\r\n            k.pos(k.width() / 2, headerY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.DANGER),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // Score display - large and centered\r\n        k.add([\r\n            k.text(`SCORE: ${formatScore(score)}`, { size: 22 }),\r\n            k.pos(k.width() / 2, headerY + 32),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.GOLD),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // Run summary - compact horizontal\r\n        k.add([\r\n            k.text(`Floor ${runStats.floorsReached} | ${runStats.roomsCleared} Rooms | ${runStats.enemiesKilled} Kills | ${Math.floor(duration)}s`, { size: 12 }),\r\n            k.pos(k.width() / 2, headerY + 54),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // ==========================================\r\n        // RANKINGS ROW - Below header, above table\r\n        // ==========================================\r\n        const rankRowY = headerY + 75;\r\n\r\n        // Build rank display strings\r\n        let localRankText = '';\r\n        if (isDailyRun && leaderboardResult.dailyRank) {\r\n            localRankText = `Daily #${leaderboardResult.dailyRank}`;\r\n            if (leaderboardResult.dailyRank === 1) localRankText += ' NEW RECORD!';\r\n        } else if (leaderboardResult.rank) {\r\n            localRankText = `All-Time #${leaderboardResult.rank}`;\r\n            if (leaderboardResult.isNewBest) localRankText += ' PERSONAL BEST!';\r\n        }\r\n\r\n        if (localRankText) {\r\n            k.add([\r\n                k.text(localRankText, { size: 14 }),\r\n                k.pos(k.width() / 2 - 120, rankRowY),\r\n                k.anchor('center'),\r\n                k.color(...(leaderboardResult.isNewBest ? UI_COLORS.SUCCESS : UI_COLORS.TEXT_PRIMARY)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL)\r\n            ]);\r\n        }\r\n\r\n        // Global rank - fetched async\r\n        const globalRankLabel = k.add([\r\n            k.text('Global: ...', { size: 14 }),\r\n            k.pos(k.width() / 2 + 120, rankRowY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_DISABLED),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        getGlobalRank(playerName, score).then(result => {\r\n            if (!globalRankLabel.exists()) return;\r\n            if (result.error) {\r\n                globalRankLabel.text = 'Global: offline';\r\n            } else if (result.rank) {\r\n                globalRankLabel.text = `Global #${result.rank} of ${result.total}`;\r\n                globalRankLabel.color = k.rgb(...UI_COLORS.GOLD);\r\n            } else {\r\n                globalRankLabel.text = 'Global: unranked';\r\n            }\r\n        });\r\n\r\n        // ==========================================\r\n        // PLAYER COMPARISON TABLE\r\n        // ==========================================\r\n        const tableStartY = rankRowY + 30;\r\n        const numPlayers = Math.max(partyStats.length, 1);\r\n\r\n        // Build player data\r\n        const playersToShow = partyStats.length > 0 ? partyStats : [{\r\n            name: playerName,\r\n            characterData: { char: '@', color: [255, 255, 255] },\r\n            kills: runStats.enemiesKilled,\r\n            creditsPickedUp: currencyEarned,\r\n            bossesKilled: runStats.bossesKilled,\r\n            achievements: unlockedAchievementIds // For single player, all achievements belong to them\r\n        }];\r\n\r\n        // Calculate awards - for single player, award all qualifying awards\r\n        // For multiplayer, only the best player for each category gets the award\r\n        const awardWinners = {};\r\n        if (playersToShow.length === 1) {\r\n            // Single player gets all awards they qualify for\r\n            const player = playersToShow[0];\r\n            AWARDS.forEach(award => {\r\n                const value = award.check(player);\r\n                if (value > 0) {\r\n                    if (!awardWinners[player.name]) {\r\n                        awardWinners[player.name] = [];\r\n                    }\r\n                    awardWinners[player.name].push(award);\r\n                }\r\n            });\r\n        } else {\r\n            // Multiplayer: only best player for each award\r\n            AWARDS.forEach(award => {\r\n                let bestPlayer = null;\r\n                let bestValue = 0;\r\n                playersToShow.forEach(player => {\r\n                    const value = award.check(player);\r\n                    if (value > bestValue) {\r\n                        bestValue = value;\r\n                        bestPlayer = player;\r\n                    }\r\n                });\r\n                if (bestPlayer && bestValue > 0) {\r\n                    if (!awardWinners[bestPlayer.name]) {\r\n                        awardWinners[bestPlayer.name] = [];\r\n                    }\r\n                    awardWinners[bestPlayer.name].push(award);\r\n                }\r\n            });\r\n        }\r\n\r\n        // Table layout constants - leave room for kill panel on right\r\n        const killPanelReservedWidth = 210; // 180px panel + 30px gap\r\n        const tableWidth = Math.min(k.width() - killPanelReservedWidth - 30, 500);\r\n        const tableX = 20;\r\n        const colWidth = (tableWidth - 80) / numPlayers; // 80px for label column\r\n        const rowHeight = 28;\r\n        const labelColWidth = 80;\r\n\r\n        // Table background\r\n        const tableHeight = rowHeight * 7 + 10; // 7 rows + padding\r\n        k.add([\r\n            k.rect(tableWidth, tableHeight),\r\n            k.pos(tableX, tableStartY),\r\n            k.color(30, 25, 35),\r\n            k.outline(2, k.rgb(60, 50, 80)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // Table header row (player names with icons)\r\n        let currentY = tableStartY + 8;\r\n\r\n        // Row labels\r\n        const rowLabels = ['', 'Kills', 'Credits', 'Bosses', 'Awards', 'Achievements'];\r\n\r\n        // Header row - Player icons and names\r\n        playersToShow.forEach((player, idx) => {\r\n            const colX = tableX + labelColWidth + idx * colWidth + colWidth / 2;\r\n\r\n            // Character icon\r\n            const charIcon = player.characterData?.char || '@';\r\n            const charColor = player.characterData?.color || [255, 255, 255];\r\n\r\n            k.add([\r\n                k.text(charIcon, { size: 20 }),\r\n                k.pos(colX, currentY + 3),\r\n                k.anchor('center'),\r\n                k.color(...charColor),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 1)\r\n            ]);\r\n\r\n            // Player name (below icon)\r\n            const maxNameLen = numPlayers <= 2 ? 16 : (numPlayers === 3 ? 12 : 10);\r\n            const displayName = (player.name || `P${idx + 1}`).substring(0, maxNameLen);\r\n            k.add([\r\n                k.text(displayName, { size: 11 }),\r\n                k.pos(colX, currentY + 20),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.GOLD),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 1)\r\n            ]);\r\n        });\r\n        currentY += rowHeight + 8;\r\n\r\n        // Data rows\r\n        const rowData = [\r\n            { label: 'Kills', getValue: (p) => p.kills || 0, color: UI_COLORS.DANGER },\r\n            { label: 'Credits', getValue: (p) => p.creditsPickedUp || 0, color: UI_COLORS.GOLD },\r\n            { label: 'Bosses', getValue: (p) => p.bossesKilled || 0, color: [255, 150, 50] }\r\n        ];\r\n\r\n        rowData.forEach(row => {\r\n            // Row label\r\n            k.add([\r\n                k.text(row.label, { size: 12 }),\r\n                k.pos(tableX + 10, currentY),\r\n                k.anchor('left'),\r\n                k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 1)\r\n            ]);\r\n\r\n            // Values for each player\r\n            playersToShow.forEach((player, idx) => {\r\n                const colX = tableX + labelColWidth + idx * colWidth + colWidth / 2;\r\n                const value = row.getValue(player);\r\n\r\n                k.add([\r\n                    k.text(String(value), { size: 14 }),\r\n                    k.pos(colX, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...row.color),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.MODAL + 1)\r\n                ]);\r\n            });\r\n\r\n            currentY += rowHeight;\r\n        });\r\n\r\n        // Awards row\r\n        k.add([\r\n            k.text('Awards', { size: 12 }),\r\n            k.pos(tableX + 10, currentY),\r\n            k.anchor('left'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1)\r\n        ]);\r\n\r\n        // Helper to show award info modal\r\n        let activeAwardModal = null;\r\n        function showAwardModal(award, player) {\r\n            // Remove any existing modal\r\n            if (activeAwardModal) {\r\n                activeAwardModal.forEach(e => { if (e.exists()) k.destroy(e); });\r\n            }\r\n\r\n            const modalWidth = 220;\r\n            const modalHeight = 100;\r\n            const modalX = k.width() / 2;\r\n            const modalY = k.height() / 2;\r\n\r\n            const elements = [];\r\n\r\n            // Modal background\r\n            elements.push(k.add([\r\n                k.rect(modalWidth, modalHeight),\r\n                k.pos(modalX, modalY),\r\n                k.anchor('center'),\r\n                k.color(30, 25, 40),\r\n                k.outline(3, k.rgb(...award.color)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 100)\r\n            ]));\r\n\r\n            // Award icon\r\n            elements.push(k.add([\r\n                k.text(award.icon, { size: 28 }),\r\n                k.pos(modalX, modalY - 28),\r\n                k.anchor('center'),\r\n                k.color(...award.color),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 101)\r\n            ]));\r\n\r\n            // Award title\r\n            elements.push(k.add([\r\n                k.text(award.title, { size: 16 }),\r\n                k.pos(modalX, modalY),\r\n                k.anchor('center'),\r\n                k.color(255, 255, 255),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 101)\r\n            ]));\r\n\r\n            // Award description\r\n            elements.push(k.add([\r\n                k.text(award.desc, { size: 11 }),\r\n                k.pos(modalX, modalY + 18),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 101)\r\n            ]));\r\n\r\n            // Player who earned it (if applicable)\r\n            const earnedText = numPlayers > 1 ? `Earned by ${player.name}` : 'Earned this run';\r\n            elements.push(k.add([\r\n                k.text(earnedText, { size: 10 }),\r\n                k.pos(modalX, modalY + 34),\r\n                k.anchor('center'),\r\n                k.color(150, 150, 180),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 101)\r\n            ]));\r\n\r\n            activeAwardModal = elements;\r\n\r\n            // Close on click anywhere after a short delay\r\n            k.wait(0.1, () => {\r\n                const closeHandler = k.onClick(() => {\r\n                    closeHandler.cancel();\r\n                    if (activeAwardModal) {\r\n                        activeAwardModal.forEach(e => { if (e.exists()) k.destroy(e); });\r\n                        activeAwardModal = null;\r\n                    }\r\n                });\r\n            });\r\n        }\r\n\r\n        playersToShow.forEach((player, idx) => {\r\n            const colX = tableX + labelColWidth + idx * colWidth + colWidth / 2;\r\n            const playerAwards = awardWinners[player.name] || [];\r\n\r\n            if (playerAwards.length > 0) {\r\n                // Create individual clickable award icons\r\n                const iconSize = 22;\r\n                const iconSpacing = 4;\r\n                const totalWidth = playerAwards.length * iconSize + (playerAwards.length - 1) * iconSpacing;\r\n                const startX = colX - totalWidth / 2 + iconSize / 2;\r\n\r\n                playerAwards.forEach((award, awardIdx) => {\r\n                    const awardX = startX + awardIdx * (iconSize + iconSpacing);\r\n\r\n                    // Award icon box (clickable)\r\n                    const awardBox = k.add([\r\n                        k.rect(iconSize, iconSize),\r\n                        k.pos(awardX, currentY),\r\n                        k.anchor('center'),\r\n                        k.color(40, 35, 50),\r\n                        k.outline(2, k.rgb(...award.color)),\r\n                        k.area(),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.MODAL + 1)\r\n                    ]);\r\n\r\n                    k.add([\r\n                        k.text(award.icon, { size: 12 }),\r\n                        k.pos(awardX, currentY),\r\n                        k.anchor('center'),\r\n                        k.color(255, 220, 100),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.MODAL + 2)\r\n                    ]);\r\n\r\n                    awardBox.onClick(() => {\r\n                        playMenuNav();\r\n                        showAwardModal(award, player);\r\n                    });\r\n                    awardBox.cursor = 'pointer';\r\n                });\r\n            } else {\r\n                k.add([\r\n                    k.text('-', { size: 14 }),\r\n                    k.pos(colX, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_DISABLED),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.MODAL + 1)\r\n                ]);\r\n            }\r\n        });\r\n        currentY += rowHeight;\r\n\r\n        // Achievements row - clickable icons\r\n        k.add([\r\n            k.text('Unlocks', { size: 12 }),\r\n            k.pos(tableX + 10, currentY),\r\n            k.anchor('left'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1)\r\n        ]);\r\n\r\n        playersToShow.forEach((player, idx) => {\r\n            const colX = tableX + labelColWidth + idx * colWidth + colWidth / 2;\r\n\r\n            // For multiplayer, achievements would be per-player\r\n            // For single player, show all achievements\r\n            const playerAchievements = player.achievements || (idx === 0 ? unlockedAchievementIds : []);\r\n\r\n            if (playerAchievements.length > 0) {\r\n                const maxIcons = Math.min(playerAchievements.length, 3);\r\n                const iconSize = 22;\r\n                const iconSpacing = 4;\r\n                const totalWidth = maxIcons * iconSize + (maxIcons - 1) * iconSpacing;\r\n                const startX = colX - totalWidth / 2 + iconSize / 2;\r\n\r\n                playerAchievements.slice(0, maxIcons).forEach((achId, achIdx) => {\r\n                    const achievement = ACHIEVEMENTS[achId];\r\n                    if (!achievement) return;\r\n\r\n                    const achX = startX + achIdx * (iconSize + iconSpacing);\r\n                    const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\r\n\r\n                    // Achievement icon box\r\n                    const achBox = k.add([\r\n                        k.rect(iconSize, iconSize),\r\n                        k.pos(achX, currentY),\r\n                        k.anchor('center'),\r\n                        k.color(40, 35, 50),\r\n                        k.outline(2, k.rgb(...difficultyColor)),\r\n                        k.area(),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.MODAL + 1)\r\n                    ]);\r\n\r\n                    k.add([\r\n                        k.text(achievement.icon, { size: 12 }),\r\n                        k.pos(achX, currentY),\r\n                        k.anchor('center'),\r\n                        k.color(255, 255, 255),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.MODAL + 2)\r\n                    ]);\r\n\r\n                    achBox.onClick(() => {\r\n                        playMenuNav();\r\n                        showAchievementModal(k, achievement);\r\n                    });\r\n                    achBox.cursor = 'pointer';\r\n                });\r\n\r\n                // Show +N more if needed\r\n                if (playerAchievements.length > maxIcons) {\r\n                    const moreCount = playerAchievements.length - maxIcons;\r\n                    const moreX = startX + maxIcons * (iconSize + iconSpacing);\r\n                    k.add([\r\n                        k.text(`+${moreCount}`, { size: 10 }),\r\n                        k.pos(moreX, currentY),\r\n                        k.anchor('left'),\r\n                        k.color(200, 180, 100),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.MODAL + 1)\r\n                    ]);\r\n                }\r\n            } else {\r\n                k.add([\r\n                    k.text('-', { size: 14 }),\r\n                    k.pos(colX, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_DISABLED),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.MODAL + 1)\r\n                ]);\r\n            }\r\n        });\r\n\r\n        // ==========================================\r\n        // MONEY BUCKET ANIMATION - Below table\r\n        // ==========================================\r\n        const bucketSectionY = tableStartY + tableHeight + 15;\r\n        // Calculate bucket width based on available space and player count\r\n        // Solo play gets a larger, more prominent bucket\r\n        const maxBucketWidth = numPlayers === 1 ? 240 : (numPlayers === 2 ? 180 : (numPlayers === 3 ? 140 : 110));\r\n        const bucketSpacing = 10;\r\n        // Ensure buckets fit within table width\r\n        const availableWidth = tableWidth - 20; // 10px padding on each side\r\n        const calculatedBucketWidth = (availableWidth - (numPlayers - 1) * bucketSpacing) / numPlayers;\r\n        const bucketWidth = Math.min(maxBucketWidth, calculatedBucketWidth);\r\n        // Taller bucket for solo play\r\n        const bucketHeight = numPlayers === 1 ? 100 : 80;\r\n        const totalBucketsWidth = numPlayers * bucketWidth + (numPlayers - 1) * bucketSpacing;\r\n        const bucketStartX = tableX + (tableWidth - totalBucketsWidth) / 2 + bucketWidth / 2;\r\n\r\n        const playerBuckets = [];\r\n\r\n        playersToShow.forEach((player, index) => {\r\n            const bucketX = bucketStartX + index * (bucketWidth + bucketSpacing);\r\n            const credits = player.creditsPickedUp || 0;\r\n\r\n            // Bucket container\r\n            k.add([\r\n                k.rect(bucketWidth - 10, bucketHeight),\r\n                k.pos(bucketX, bucketSectionY + bucketHeight / 2),\r\n                k.anchor('center'),\r\n                k.outline(3, k.rgb(...UI_COLORS.TEXT_DISABLED)),\r\n                k.color(0, 0, 0),\r\n                k.opacity(0.5),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL)\r\n            ]);\r\n\r\n            // Currency label below bucket - larger for solo play\r\n            const labelSize = numPlayers === 1 ? 20 : 16;\r\n            const currencyLabel = k.add([\r\n                k.text(`0 ${currencyName}`, { size: labelSize }),\r\n                k.pos(bucketX, bucketSectionY + bucketHeight + 16),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.GOLD),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 10)\r\n            ]);\r\n\r\n            playerBuckets.push({\r\n                x: bucketX,\r\n                y: bucketSectionY,\r\n                width: bucketWidth - 10,\r\n                height: bucketHeight,\r\n                credits: credits,\r\n                label: currencyLabel,\r\n                particles: [],\r\n                spawnedCount: 0,\r\n                displayedCount: 0\r\n            });\r\n        });\r\n\r\n        // Currency drop animation\r\n        // Solo play gets more particles for a more impressive display\r\n        const maxParticlesPerPlayer = numPlayers === 1 ? 50 : 35;\r\n        const particleSpawnDelay = 0.06;\r\n        const particleFallSpeed = 280;\r\n        let animationTimer = 0;\r\n        const animationStartDelay = 0.5;\r\n\r\n        k.onUpdate(() => {\r\n            animationTimer += k.dt();\r\n            if (animationTimer < animationStartDelay) return;\r\n\r\n            playerBuckets.forEach((bucket, bucketIndex) => {\r\n                if (bucket.credits <= 0) return;\r\n\r\n                const targetParticles = Math.min(bucket.credits, maxParticlesPerPlayer);\r\n                const particleValue = bucket.credits / targetParticles;\r\n\r\n                const spawnTime = (animationTimer - animationStartDelay) - (bucketIndex * 0.12);\r\n                const targetSpawned = Math.floor(spawnTime / particleSpawnDelay);\r\n\r\n                while (bucket.spawnedCount < targetParticles && bucket.spawnedCount < targetSpawned) {\r\n                    const startX = bucket.x + (Math.random() - 0.5) * (bucket.width - 16);\r\n                    const startY = bucket.y - 30 - Math.random() * 25;\r\n                    const icon = CURRENCY_ICONS[Math.floor(Math.random() * CURRENCY_ICONS.length)];\r\n\r\n                    const particle = k.add([\r\n                        k.text(icon, { size: 14 }),\r\n                        k.pos(startX, startY),\r\n                        k.anchor('center'),\r\n                        k.color(255, 215, 0),\r\n                        k.opacity(1),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.MODAL + 5),\r\n                        'currencyParticle',\r\n                        {\r\n                            velocity: particleFallSpeed + Math.random() * 60,\r\n                            landed: false,\r\n                            value: particleValue\r\n                        }\r\n                    ]);\r\n\r\n                    bucket.particles.push(particle);\r\n                    bucket.spawnedCount++;\r\n                }\r\n\r\n                // Update particles\r\n                bucket.particles.forEach(particle => {\r\n                    if (!particle.exists() || particle.landed) return;\r\n\r\n                    particle.pos.y += particle.velocity * k.dt();\r\n\r\n                    const bucketBottom = bucket.y + bucket.height - 6;\r\n                    const stackHeight = bucket.particles.filter(p => p.landed).length * 1.5;\r\n                    const landingY = bucketBottom - stackHeight;\r\n\r\n                    if (particle.pos.y >= landingY) {\r\n                        particle.pos.y = landingY;\r\n                        particle.landed = true;\r\n                        bucket.displayedCount += particle.value;\r\n                        bucket.label.text = `${Math.floor(bucket.displayedCount)} ${currencyName}`;\r\n                        particle.opacity = 0.85;\r\n                    }\r\n                });\r\n            });\r\n        });\r\n\r\n        // ==========================================\r\n        // KILL BREAKDOWN - Right side panel\r\n        // ==========================================\r\n        const killPanelX = k.width() - 110;\r\n        const killPanelY = tableStartY;\r\n        const killPanelWidth = 180;\r\n        const killPanelHeight = tableHeight + bucketHeight + 30;\r\n\r\n        // Kill panel background\r\n        k.add([\r\n            k.rect(killPanelWidth, killPanelHeight),\r\n            k.pos(killPanelX - killPanelWidth / 2, killPanelY),\r\n            k.color(25, 20, 30),\r\n            k.outline(2, k.rgb(50, 40, 60)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // Kill panel title\r\n        k.add([\r\n            k.text('STAFF', { size: 14 }),\r\n            k.pos(killPanelX, killPanelY + 12),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1)\r\n        ]);\r\n        k.add([\r\n            k.text('TERMINATED', { size: 14 }),\r\n            k.pos(killPanelX, killPanelY + 26),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1)\r\n        ]);\r\n\r\n        // Kill list\r\n        const killsByType = runStats.killsByType || {};\r\n        const sortedKills = Object.entries(killsByType)\r\n            .filter(([_, count]) => count > 0)\r\n            .sort((a, b) => b[1] - a[1]);\r\n\r\n        let killY = killPanelY + 48;\r\n        const killSpacing = 20;\r\n        const maxKillsToShow = Math.floor((killPanelHeight - 60) / killSpacing);\r\n\r\n        if (sortedKills.length === 0) {\r\n            k.add([\r\n                k.text('No staff', { size: 12 }),\r\n                k.pos(killPanelX, killY + 10),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_DISABLED),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 1)\r\n            ]);\r\n            k.add([\r\n                k.text('harmed', { size: 12 }),\r\n                k.pos(killPanelX, killY + 24),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_DISABLED),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.MODAL + 1)\r\n            ]);\r\n        } else {\r\n            const showCount = Math.min(sortedKills.length, maxKillsToShow);\r\n\r\n            for (let i = 0; i < showCount; i++) {\r\n                const [type, count] = sortedKills[i];\r\n                const char = getEnemyChar(type);\r\n                const color = getEnemyColor(type);\r\n\r\n                // Enemy icon\r\n                k.add([\r\n                    k.text(char, { size: 14 }),\r\n                    k.pos(killPanelX - 70, killY),\r\n                    k.anchor('center'),\r\n                    k.color(...color),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.MODAL + 1)\r\n                ]);\r\n\r\n                // Enemy name - wider panel allows more characters\r\n                const name = getEnemyName(type);\r\n                const shortName = name.length > 14 ? name.substring(0, 12) + '..' : name;\r\n                k.add([\r\n                    k.text(shortName, { size: 10 }),\r\n                    k.pos(killPanelX - 50, killY),\r\n                    k.anchor('left'),\r\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.MODAL + 1)\r\n                ]);\r\n\r\n                // Count\r\n                k.add([\r\n                    k.text(`x${count}`, { size: 11 }),\r\n                    k.pos(killPanelX + 70, killY),\r\n                    k.anchor('right'),\r\n                    k.color(...UI_COLORS.DANGER),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.MODAL + 1)\r\n                ]);\r\n\r\n                killY += killSpacing;\r\n            }\r\n\r\n            if (sortedKills.length > showCount) {\r\n                const remaining = sortedKills.slice(showCount).reduce((sum, [_, c]) => sum + c, 0);\r\n                k.add([\r\n                    k.text(`+${remaining} more`, { size: 10 }),\r\n                    k.pos(killPanelX, killY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_DISABLED),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.MODAL + 1)\r\n                ]);\r\n            }\r\n        }\r\n\r\n        // ==========================================\r\n        // FOOTER - Totals and Controls\r\n        // ==========================================\r\n        const footerY = k.height() - 90;\r\n\r\n        // Team earnings (left side)\r\n        k.add([\r\n            k.text(`+${totalTeamCredits} ${currencyName}`, { size: 16 }),\r\n            k.pos(k.width() / 2 - 100, footerY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.GOLD),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // XP earned (right side)\r\n        const xpColor = leveledUp ? UI_COLORS.SUCCESS : [150, 200, 255];\r\n        const xpText = leveledUp\r\n            ? `+${xpEarned} XP (LEVEL UP!)`\r\n            : `+${xpEarned} XP`;\r\n        k.add([\r\n            k.text(xpText, { size: 16 }),\r\n            k.pos(k.width() / 2 + 100, footerY),\r\n            k.anchor('center'),\r\n            k.color(...xpColor),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // Level and progress bar\r\n        const currentLevel = getPlayerLevel();\r\n        const xpProgress = getXPProgress();\r\n        const currentXP = getTotalXP();\r\n        const nextLevelXP = getXPForNextLevel();\r\n\r\n        k.add([\r\n            k.text(`Level ${currentLevel}`, { size: 12 }),\r\n            k.pos(k.width() / 2, footerY + 18),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // XP progress bar\r\n        const barWidth = 200;\r\n        const barHeight = 8;\r\n        const barX = k.width() / 2;\r\n        const barY = footerY + 32;\r\n\r\n        // Bar background\r\n        k.add([\r\n            k.rect(barWidth, barHeight),\r\n            k.pos(barX, barY),\r\n            k.anchor('center'),\r\n            k.color(40, 40, 60),\r\n            k.outline(1, k.rgb(80, 80, 100)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // Bar fill (ensure minimum width of 2 to avoid rendering issues)\r\n        const xpFillWidth = Math.max(2, barWidth * xpProgress);\r\n        k.add([\r\n            k.rect(xpFillWidth, barHeight - 2),\r\n            k.pos(barX - barWidth / 2 + xpFillWidth / 2 + 1, barY),\r\n            k.anchor('center'),\r\n            k.color(100, 180, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL + 1)\r\n        ]);\r\n\r\n        // XP numbers\r\n        k.add([\r\n            k.text(`${currentXP} / ${nextLevelXP} XP`, { size: 10 }),\r\n            k.pos(k.width() / 2, barY + 12),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        // Buttons - centered with proper spacing\r\n        const isHostPlayer = isHost();\r\n        const buttonY = k.height() - 30;\r\n        const { MD, SM } = UI_SIZES.BUTTON;\r\n        const buttonGap = 20;\r\n\r\n        const playAgainEnabled = !inMultiplayer || isHostPlayer;\r\n        const playAgainText = inMultiplayer && !isHostPlayer ? 'Waiting...' : 'PLAY AGAIN';\r\n\r\n        // Use MD size for play again (more reasonable) and SM for menu\r\n        const playAgainWidth = MD.width;\r\n        const playAgainHeight = MD.height;\r\n        const menuWidth = SM.width;\r\n        const menuHeight = SM.height;\r\n\r\n        // Center both buttons together\r\n        const totalButtonWidth = playAgainWidth + buttonGap + menuWidth;\r\n        const buttonsStartX = k.width() / 2 - totalButtonWidth / 2;\r\n\r\n        // Play Again button\r\n        const playAgainBg = k.add([\r\n            k.rect(playAgainWidth, playAgainHeight),\r\n            k.pos(buttonsStartX + playAgainWidth / 2, buttonY),\r\n            k.anchor('center'),\r\n            k.color(...(playAgainEnabled ? UI_COLORS.SUCCESS : UI_COLORS.BG_DISABLED)),\r\n            k.outline(2, k.rgb(...(playAgainEnabled ? UI_COLORS.BORDER : UI_COLORS.BG_DARK))),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.scale(1),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        const playAgainLabel = k.add([\r\n            k.text(playAgainText, { size: UI_TEXT_SIZES.H2 }),\r\n            k.pos(buttonsStartX + playAgainWidth / 2, buttonY),\r\n            k.anchor('center'),\r\n            k.color(...(playAgainEnabled ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_DISABLED)),\r\n            k.fixed(),\r\n            k.scale(1),\r\n            k.z(UI_Z_LAYERS.MODAL + 1)\r\n        ]);\r\n\r\n        // Menu button\r\n        const menuBg = k.add([\r\n            k.rect(menuWidth, menuHeight),\r\n            k.pos(buttonsStartX + playAgainWidth + buttonGap + menuWidth / 2, buttonY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.NEUTRAL),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.scale(1),\r\n            k.z(UI_Z_LAYERS.MODAL)\r\n        ]);\r\n\r\n        const menuLabel = k.add([\r\n            k.text('MENU', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(buttonsStartX + playAgainWidth + buttonGap + menuWidth / 2, buttonY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.scale(1),\r\n            k.z(UI_Z_LAYERS.MODAL + 1)\r\n        ]);\r\n\r\n        // Button hover effects\r\n        if (playAgainEnabled) {\r\n            playAgainBg.onHoverUpdate(() => {\r\n                playAgainBg.color = k.rgb(...(UI_COLORS.SUCCESS_HOVER || [80, 180, 80]));\r\n                playAgainBg.scale = k.vec2(1.02, 1.02);\r\n                playAgainLabel.scale = k.vec2(1.02, 1.02);\r\n            });\r\n            playAgainBg.onHoverEnd(() => {\r\n                playAgainBg.color = k.rgb(...UI_COLORS.SUCCESS);\r\n                playAgainBg.scale = k.vec2(1, 1);\r\n                playAgainLabel.scale = k.vec2(1, 1);\r\n            });\r\n        }\r\n\r\n        menuBg.onHoverUpdate(() => {\r\n            menuBg.color = k.rgb(...UI_COLORS.NEUTRAL_HOVER);\r\n            menuBg.scale = k.vec2(1.02, 1.02);\r\n            menuLabel.scale = k.vec2(1.02, 1.02);\r\n        });\r\n        menuBg.onHoverEnd(() => {\r\n            menuBg.color = k.rgb(...UI_COLORS.NEUTRAL);\r\n            menuBg.scale = k.vec2(1, 1);\r\n            menuLabel.scale = k.vec2(1, 1);\r\n        });\r\n\r\n        // Button click handlers\r\n        if (playAgainEnabled) {\r\n            playAgainBg.onClick(() => {\r\n                playMenuSelect();\r\n                if (inMultiplayer && isHostPlayer) {\r\n                    broadcast('game_restart', {});\r\n                }\r\n                k.go('game', { resetState: true });\r\n            });\r\n        }\r\n\r\n        menuBg.onClick(() => {\r\n            playMenuNav();\r\n            if (inMultiplayer && !isHostPlayer) {\r\n                offMessage('game_restart');\r\n            }\r\n            k.go('menu');\r\n        });\r\n\r\n        // Network handlers\r\n        if (inMultiplayer && !isHostPlayer) {\r\n            onMessage('game_restart', () => {\r\n                playMenuSelect();\r\n                offMessage('game_restart');\r\n                k.go('game', { resetState: true });\r\n            });\r\n        }\r\n\r\n        // Keyboard shortcuts\r\n        k.onKeyPress('space', () => {\r\n            if (inMultiplayer && !isHostPlayer) return;\r\n            playMenuSelect();\r\n            if (inMultiplayer && isHostPlayer) {\r\n                broadcast('game_restart', {});\r\n            }\r\n            k.go('game', { resetState: true });\r\n        });\r\n\r\n        k.onKeyPress('escape', () => {\r\n            // Don't navigate away if achievement modal is open (it handles its own escape)\r\n            if (isAchievementModalOpen()) return;\r\n            playMenuNav();\r\n            if (inMultiplayer && !isHostPlayer) {\r\n                offMessage('game_restart');\r\n            }\r\n            k.go('menu');\r\n        });\r\n    });\r\n}\r\n","// Shop scene - allows players to purchase unlocks\r\nimport { getCurrency, getCurrencyName, isUnlocked, purchaseUnlock, purchasePermanentUpgrade, getPermanentUpgradeLevel, getTotalRefundableCredits, refundAllPermanentUpgrades, refundSinglePermanentUpgrade, isItemAchievementUnlockedSync, isAchievementUnlocked, purchaseBooster, getActiveBoostersCount, getEquippedCosmetic, setEquippedCosmetic, getSaveStats } from '../systems/metaProgression.js';\r\nimport { getUnlocksForCategory, getUnlockInfo, CHARACTER_UNLOCKS, WEAPON_UNLOCKS, PERMANENT_UPGRADE_UNLOCKS, COSMETIC_UNLOCKS, RUN_BOOSTER_UNLOCKS } from '../data/unlocks.js';\r\nimport { getAchievementById, getAchievementProgress } from '../data/achievements.js';\r\nimport { showAchievementModal, isAchievementModalOpen } from '../components/achievementModal.js';\r\nimport { playPurchaseSuccess, playPurchaseError, playMenuNav } from '../systems/sounds.js';\r\nimport {\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS,\r\n    formatButtonText,\r\n    createCreditIndicator,\r\n    createMenuParticles,\r\n    createAnimatedTitle\r\n} from '../config/uiConfig.js';\r\n\r\nexport function setupShopScene(k) {\r\n    k.scene('shop', () => {\r\n        // Prevent context menu on right-click\r\n        const preventContextMenu = (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        };\r\n        document.addEventListener('contextmenu', preventContextMenu);\r\n        \r\n        // Cleanup on scene leave\r\n        k.onSceneLeave(() => {\r\n            document.removeEventListener('contextmenu', preventContextMenu);\r\n        });\r\n        \r\n        const currency = getCurrency();\r\n        const currencyName = getCurrencyName();\r\n        \r\n        // Current category tab\r\n        let currentCategory = 'permanentUpgrades'; // Start with permanent upgrades since they're most useful\r\n        \r\n        // Background\r\n        k.add([\r\n            k.rect(k.width(), k.height()),\r\n            k.pos(0, 0),\r\n            k.anchor('topleft'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.BACKGROUND)\r\n        ]);\r\n\r\n        // Background particle effects\r\n        createMenuParticles(k, { patternCount: 10, particleCount: 15 });\r\n\r\n        // Title (moved up to avoid collision with tabs)\r\n        createAnimatedTitle(k, 'MERCH', k.width() / 2, 35, 8);\r\n\r\n        // Currency display (standardized)\r\n        const creditIndicator = createCreditIndicator(k, currency, currencyName);\r\n\r\n        // Category tabs\r\n        const tabY = 80;\r\n        const tabSpacing = 95;\r\n        const tabWidth = 85;\r\n        const tabHeight = 30;\r\n\r\n        const categories = [\r\n            { key: 'permanentUpgrades', label: 'Upgrades' },\r\n            { key: 'boosters', label: 'Boosters' },\r\n            { key: 'cosmetics', label: 'Cosmetics' },\r\n            { key: 'weapons', label: 'Weapons' },\r\n            { key: 'characters', label: 'Chars' }\r\n        ];\r\n        \r\n        // Calculate centered positions for tabs (same as Statistics and Settings menus)\r\n        const totalTabWidth = (categories.length - 1) * tabSpacing;\r\n        const firstTabX = k.width() / 2 - totalTabWidth / 2;\r\n        \r\n        const tabButtons = [];\r\n        categories.forEach((cat, index) => {\r\n            const tabX = firstTabX + index * tabSpacing;\r\n            const isActive = currentCategory === cat.key;\r\n            \r\n            const tabBg = k.add([\r\n                k.rect(tabWidth, tabHeight),\r\n                k.pos(tabX, tabY),\r\n                k.anchor('center'),\r\n                k.color(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM)),\r\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n\r\n            const tabLabel = k.add([\r\n                k.text(cat.label, { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(tabX, tabY),\r\n                k.anchor('center'),\r\n                k.color(...(isActive ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_TERTIARY)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            \r\n            tabBg.onClick(() => {\r\n                playMenuNav();\r\n                currentCategory = cat.key;\r\n                currentPage = 0; // Reset to first page when switching tabs\r\n                refreshShop();\r\n            });\r\n            \r\n            tabButtons.push({ bg: tabBg, label: tabLabel, category: cat.key });\r\n        });\r\n        \r\n        // Content area\r\n        const contentY = 130;\r\n        const contentHeight = k.height() - contentY - 100; // Leave room for pagination\r\n        let unlockItems = [];\r\n\r\n        // Pagination state\r\n        let currentPage = 0;\r\n        const ITEMS_PER_PAGE = 6; // 2 columns x 3 rows\r\n        let paginationItems = []; // Store pagination UI elements\r\n\r\n        // Flag to prevent multiple simultaneous purchases\r\n        let isPurchasing = false;\r\n\r\n        // Flag to prevent double-handling of pagination clicks in same frame\r\n        let paginationClickHandled = false;\r\n        \r\n        // Refresh shop display\r\n        function refreshShop() {\r\n            // Update currency display\r\n            const currentCurrency = getCurrency();\r\n            creditIndicator.updateCurrency(currentCurrency);\r\n            \r\n            // Update tab visuals\r\n            tabButtons.forEach(tab => {\r\n                const isActive = currentCategory === tab.category;\r\n                tab.bg.color = k.rgb(\r\n                    isActive ? 100 : 50,\r\n                    isActive ? 100 : 50,\r\n                    isActive ? 150 : 80\r\n                );\r\n                tab.label.color = k.rgb(\r\n                    isActive ? 255 : 150,\r\n                    isActive ? 255 : 150,\r\n                    isActive ? 255 : 150\r\n                );\r\n            });\r\n            \r\n            // Update refund button visibility\r\n            updateRefundButton();\r\n            \r\n            // Clear existing items\r\n            unlockItems.forEach(item => {\r\n                if (item.exists()) k.destroy(item);\r\n            });\r\n            unlockItems = [];\r\n\r\n            // Clear pagination items\r\n            paginationItems.forEach(item => {\r\n                if (item.exists()) k.destroy(item);\r\n            });\r\n            paginationItems = [];\r\n\r\n            // Get unlocks for current category\r\n            const unlocks = getUnlocksForCategory(currentCategory);\r\n            const unlockKeys = Object.keys(unlocks);\r\n            \r\n            // Filter out default unlocks if they're not interesting to show\r\n            const displayUnlocks = unlockKeys.filter(key => {\r\n                const unlock = unlocks[key];\r\n                // Show all permanent upgrades and boosters\r\n                if (currentCategory === 'permanentUpgrades') return true;\r\n                if (currentCategory === 'boosters') return true; // Always show boosters (consumables)\r\n                // For cosmetics, show all non-defaults\r\n                if (currentCategory === 'cosmetics') return !unlock.unlockedByDefault;\r\n                // For characters/weapons, only show non-default\r\n                return !unlock.unlockedByDefault;\r\n            });\r\n            \r\n            if (displayUnlocks.length === 0) {\r\n                // No unlocks available in this category\r\n                const noItemsText = k.add([\r\n                    k.text('No items available in this category yet.', { size: 18 }),\r\n                    k.pos(k.width() / 2, contentY + 50),\r\n                    k.anchor('center'),\r\n                    k.color(150, 150, 150),\r\n                    k.fixed(),\r\n                    k.z(1000)\r\n                ]);\r\n                unlockItems.push(noItemsText);\r\n                return;\r\n            }\r\n            \r\n            // Pagination calculations\r\n            const totalPages = Math.ceil(displayUnlocks.length / ITEMS_PER_PAGE);\r\n            // Clamp currentPage to valid range\r\n            if (currentPage >= totalPages) currentPage = Math.max(0, totalPages - 1);\r\n\r\n            // Get items for current page\r\n            const startIndex = currentPage * ITEMS_PER_PAGE;\r\n            const pageItems = displayUnlocks.slice(startIndex, startIndex + ITEMS_PER_PAGE);\r\n\r\n            // Display unlocks - Redesigned card layout\r\n            const cardWidth = 340;\r\n            const cardHeight = 105;\r\n            const itemSpacing = cardHeight + 8;\r\n            const startY = contentY + 5;\r\n            const itemsPerColumn = 3;\r\n\r\n            // Benefit icon mapping - shows what type of bonus this gives\r\n            const getBenefitIcon = (desc) => {\r\n                if (!desc) return null;\r\n                const d = desc.toLowerCase();\r\n                if (d.includes('hp') || d.includes('health')) return { icon: '', color: [255, 100, 100] };\r\n                if (d.includes('damage') || d.includes('dmg')) return { icon: '', color: [255, 200, 100] };\r\n                if (d.includes('speed')) return { icon: '', color: [100, 200, 255] };\r\n                if (d.includes('crit')) return { icon: '', color: [255, 255, 100] };\r\n                if (d.includes('xp') || d.includes('pickup')) return { icon: '', color: [100, 255, 200] };\r\n                if (d.includes('defense') || d.includes('reduction')) return { icon: '', color: [150, 150, 255] };\r\n                if (d.includes('credit') || d.includes('silver')) return { icon: '$', color: [200, 150, 50] };\r\n                if (d.includes('level')) return { icon: '', color: [200, 100, 255] };\r\n                if (d.includes('invuln') || d.includes('immunity')) return { icon: '', color: [100, 255, 255] };\r\n                if (d.includes('trail') || d.includes('glow') || d.includes('effect')) return { icon: '', color: [200, 150, 255] };\r\n                return null;\r\n            };\r\n\r\n            pageItems.forEach((key, index) => {\r\n                const unlock = unlocks[key];\r\n                const column = Math.floor(index / itemsPerColumn);\r\n                const row = index % itemsPerColumn;\r\n                const itemX = 45 + column * (cardWidth + 15);\r\n                const itemY = startY + row * itemSpacing;\r\n\r\n                // Check achievement requirement - handle both formats:\r\n                // 1. requiredAchievement: 'achievementId' (cosmetics, weapons)\r\n                // 2. unlockRequirement: { type: 'achievement', value: 'achievementId' } (characters)\r\n                const achievementId = unlock.requiredAchievement ||\r\n                    (unlock.unlockRequirement?.type === 'achievement' ? unlock.unlockRequirement.value : null);\r\n                const isAchievementLocked = achievementId ? !isAchievementUnlocked(achievementId) : false;\r\n                const requiredAchievement = achievementId ? getAchievementById(achievementId) : null;\r\n\r\n                // Determine item status for styling\r\n                const isUnlockedChar = currentCategory === 'characters' && isUnlocked('characters', key);\r\n                const isUnlockedWeapon = currentCategory === 'weapons' && isUnlocked('weapons', key);\r\n                const isMaxedUpgrade = currentCategory === 'permanentUpgrades' && getPermanentUpgradeLevel(key) >= (unlock.maxLevel || 1);\r\n                // Cosmetics are \"owned\" if: default, purchased, OR achievement requirement is met\r\n                const isCosmeticAchievementUnlocked = currentCategory === 'cosmetics' && unlock.requiredAchievement && !isAchievementLocked;\r\n                const isOwnedCosmetic = currentCategory === 'cosmetics' && (isUnlocked('cosmetics', key) || unlock.unlockedByDefault || isCosmeticAchievementUnlocked);\r\n                const isEquippedCosmetic = currentCategory === 'cosmetics' && getEquippedCosmetic(unlock.category) === key;\r\n\r\n                // Card border color based on status\r\n                let borderColor, bgColor;\r\n                if (isAchievementLocked) {\r\n                    borderColor = k.rgb(60, 50, 50);\r\n                    bgColor = [30, 25, 25];\r\n                } else if (isEquippedCosmetic) {\r\n                    borderColor = k.rgb(100, 200, 255);\r\n                    bgColor = [35, 45, 55];\r\n                } else if (isMaxedUpgrade || isUnlockedChar || isUnlockedWeapon || isOwnedCosmetic) {\r\n                    borderColor = k.rgb(80, 150, 80);\r\n                    bgColor = [35, 45, 35];\r\n                } else {\r\n                    borderColor = k.rgb(80, 80, 120);\r\n                    bgColor = [35, 35, 45];\r\n                }\r\n\r\n                // Card background\r\n                const cardBg = k.add([\r\n                    k.rect(cardWidth, cardHeight),\r\n                    k.pos(itemX, itemY),\r\n                    k.anchor('topleft'),\r\n                    k.color(...bgColor),\r\n                    k.outline(2, borderColor),\r\n                    k.area(),\r\n                    k.fixed(),\r\n                    k.z(1000)\r\n                ]);\r\n\r\n                // === TOP ROW: Icon + Name + Benefit indicator ===\r\n                let contentStartX = itemX + 10;\r\n\r\n                // Character/Weapon icon (if applicable)\r\n                if ((currentCategory === 'characters' || currentCategory === 'weapons') && unlock.char) {\r\n                    const iconBg = k.add([\r\n                        k.rect(40, 40),\r\n                        k.pos(itemX + 8, itemY + 8),\r\n                        k.anchor('topleft'),\r\n                        k.color(25, 25, 35),\r\n                        k.outline(1, k.rgb(60, 60, 80)),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n                    const iconText = k.add([\r\n                        k.text(unlock.char, { size: 28 }),\r\n                        k.pos(itemX + 28, itemY + 28),\r\n                        k.anchor('center'),\r\n                        k.color(...(isAchievementLocked ? [60, 60, 60] : (unlock.color || [200, 200, 200]))),\r\n                        k.fixed(),\r\n                        k.z(1002)\r\n                    ]);\r\n                    unlockItems.push(iconBg, iconText);\r\n                    contentStartX = itemX + 55;\r\n                }\r\n\r\n                // Cosmetic icon\r\n                if (currentCategory === 'cosmetics') {\r\n                    const cosmeticIcon = unlock.category === 'trail' ? '~' : unlock.category === 'death' ? '' : '';\r\n                    // Get a safe color array (handles 'rainbow' string and missing colors)\r\n                    let baseColor;\r\n                    if (unlock.color === 'rainbow') {\r\n                        // Rainbow gets a distinctive multicolor-ish display (magenta/cyan)\r\n                        baseColor = [255, 100, 200];\r\n                    } else if (Array.isArray(unlock.color)) {\r\n                        baseColor = unlock.color;\r\n                    } else {\r\n                        baseColor = [150, 150, 200];\r\n                    }\r\n                    // Dim the color when achievement-locked\r\n                    const cosmeticColor = isAchievementLocked ? [60, 60, 70] : baseColor;\r\n                    const borderColor = isAchievementLocked ? [50, 50, 60] : baseColor;\r\n                    const iconBg = k.add([\r\n                        k.rect(36, 36),\r\n                        k.pos(itemX + 8, itemY + 8),\r\n                        k.anchor('topleft'),\r\n                        k.color(25, 25, 35),\r\n                        k.outline(1, k.rgb(...borderColor)),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n                    const iconText = k.add([\r\n                        k.text(cosmeticIcon, { size: 22 }),\r\n                        k.pos(itemX + 26, itemY + 26),\r\n                        k.anchor('center'),\r\n                        k.color(...cosmeticColor),\r\n                        k.fixed(),\r\n                        k.z(1002)\r\n                    ]);\r\n                    unlockItems.push(iconBg, iconText);\r\n                    contentStartX = itemX + 50;\r\n                }\r\n\r\n                // Item name\r\n                const nameText = k.add([\r\n                    k.text(unlock.name, { size: 16 }),\r\n                    k.pos(contentStartX, itemY + 10),\r\n                    k.anchor('topleft'),\r\n                    k.color(isAchievementLocked ? 100 : 255, isAchievementLocked ? 100 : 255, isAchievementLocked ? 100 : 255),\r\n                    k.fixed(),\r\n                    k.z(1001)\r\n                ]);\r\n\r\n                // Benefit icon (top right, shows what type of bonus)\r\n                const benefit = getBenefitIcon(unlock.description);\r\n                if (benefit && !isAchievementLocked) {\r\n                    const benefitIcon = k.add([\r\n                        k.text(benefit.icon, { size: 18 }),\r\n                        k.pos(itemX + cardWidth - 12, itemY + 12),\r\n                        k.anchor('topright'),\r\n                        k.color(...benefit.color),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n                    unlockItems.push(benefitIcon);\r\n                }\r\n\r\n                // Lock icon for achievement-locked items\r\n                if (isAchievementLocked) {\r\n                    const lockIcon = k.add([\r\n                        k.text('(X)', { size: 14 }),\r\n                        k.pos(itemX + cardWidth - 10, itemY + 10),\r\n                        k.anchor('topright'),\r\n                        k.color(150, 80, 80),\r\n                        k.fixed(),\r\n                        k.z(1002)\r\n                    ]);\r\n                    unlockItems.push(lockIcon);\r\n                }\r\n\r\n                // === MIDDLE ROW: Description (constrained to 2 lines max) ===\r\n                const descWidth = cardWidth - contentStartX + itemX - 90; // Leave room for button\r\n                const descY = itemY + 30;\r\n\r\n                // Build description text with achievement progress for locked items\r\n                let descriptionText = unlock.description;\r\n                let achievementProgress = null;\r\n                if (isAchievementLocked && requiredAchievement) {\r\n                    const stats = getSaveStats();\r\n                    // Safely get achievement progress with null check\r\n                    if (stats) {\r\n                        achievementProgress = getAchievementProgress(requiredAchievement.id, stats);\r\n                    }\r\n                    if (achievementProgress) {\r\n                        descriptionText = `${requiredAchievement.name} (${achievementProgress.current}/${achievementProgress.target})`;\r\n                    } else {\r\n                        descriptionText = `Requires: ${requiredAchievement.name}`;\r\n                    }\r\n                }\r\n\r\n                const descText = k.add([\r\n                    k.text(descriptionText, { size: 12, width: descWidth }),\r\n                    k.pos(contentStartX, descY),\r\n                    k.anchor('topleft'),\r\n                    k.color(isAchievementLocked ? 140 : 180, isAchievementLocked ? 110 : 180, isAchievementLocked ? 110 : 180),\r\n                    k.fixed(),\r\n                    k.z(1001)\r\n                ]);\r\n\r\n                // Show mini progress bar for achievement-locked items with trackable progress\r\n                if (isAchievementLocked && achievementProgress && achievementProgress.target > 1) {\r\n                    const miniBarWidth = Math.min(descWidth, 120);\r\n                    const miniBarHeight = 4;\r\n                    const miniBarX = contentStartX;\r\n                    const miniBarY = descY + 18;\r\n\r\n                    // Background bar\r\n                    const miniBarBg = k.add([\r\n                        k.rect(miniBarWidth, miniBarHeight),\r\n                        k.pos(miniBarX, miniBarY),\r\n                        k.anchor('topleft'),\r\n                        k.color(40, 35, 45),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n                    unlockItems.push(miniBarBg);\r\n\r\n                    // Filled portion\r\n                    const fillWidth = Math.max(0, achievementProgress.progress * miniBarWidth);\r\n                    if (fillWidth > 0) {\r\n                        const miniBarFill = k.add([\r\n                            k.rect(fillWidth, miniBarHeight),\r\n                            k.pos(miniBarX, miniBarY),\r\n                            k.anchor('topleft'),\r\n                            k.color(100, 80, 130),\r\n                            k.fixed(),\r\n                            k.z(1002)\r\n                        ]);\r\n                        unlockItems.push(miniBarFill);\r\n                    }\r\n                }\r\n                \r\n                // === BOTTOM ROW: Status/Progress + Action Button ===\r\n                const bottomY = itemY + cardHeight - 28;\r\n                const buttonX = itemX + cardWidth - 85;\r\n                const buttonWidth = 75;\r\n                const buttonHeight = 24;\r\n\r\n                // Calculate escalating price for permanent upgrades\r\n                function getUpgradePrice(level) {\r\n                    const prices = [50, 65, 90, 115, 160];\r\n                    if (level < prices.length) return prices[level];\r\n                    return 160 + (level - 4) * 50;\r\n                }\r\n\r\n                // Determine status and purchase state\r\n                let statusText = '';\r\n                let canPurchase = false;\r\n                let purchaseCost = unlock.cost;\r\n                let showProgressBar = false;\r\n                let progressLevel = 0;\r\n                let progressMax = 1;\r\n\r\n                if (currentCategory === 'permanentUpgrades') {\r\n                    const level = getPermanentUpgradeLevel(key);\r\n                    const maxLevel = unlock.maxLevel || 1;\r\n                    progressLevel = level;\r\n                    progressMax = maxLevel;\r\n                    showProgressBar = true;\r\n\r\n                    if (level >= maxLevel) {\r\n                        statusText = 'MAXED';\r\n                    } else {\r\n                        purchaseCost = getUpgradePrice(level);\r\n                        canPurchase = currency >= purchaseCost;\r\n                    }\r\n                } else if (currentCategory === 'boosters') {\r\n                    const boosterCount = getActiveBoostersCount(key);\r\n                    statusText = boosterCount > 0 ? `Ready (${boosterCount})` : 'Consumable';\r\n                    canPurchase = currency >= purchaseCost;\r\n                } else if (currentCategory === 'cosmetics') {\r\n                    const cosmeticType = unlock.category;\r\n                    if (isEquippedCosmetic) {\r\n                        statusText = 'EQUIPPED';\r\n                    } else if (isOwnedCosmetic) {\r\n                        // Differentiate between achievement-unlocked and purchased\r\n                        statusText = isCosmeticAchievementUnlocked ? 'UNLOCKED' : 'OWNED';\r\n                    } else if (!isAchievementLocked) {\r\n                        // Only show purchase option if not achievement-locked\r\n                        canPurchase = currency >= purchaseCost;\r\n                    }\r\n                    // If achievement-locked, no status text needed (VIEW button handles it)\r\n                } else if (currentCategory === 'characters') {\r\n                    if (!isUnlockedChar) {\r\n                        canPurchase = currency >= purchaseCost;\r\n                    }\r\n                } else if (currentCategory === 'weapons') {\r\n                    if (!isUnlockedWeapon) {\r\n                        canPurchase = currency >= purchaseCost;\r\n                    }\r\n                }\r\n\r\n                // Progress bar for permanent upgrades\r\n                if (showProgressBar) {\r\n                    const barWidth = 100;\r\n                    const barHeight = 8;\r\n                    const barX = contentStartX;\r\n                    const barY = bottomY + 8;\r\n\r\n                    // Background bar\r\n                    const barBg = k.add([\r\n                        k.rect(barWidth, barHeight),\r\n                        k.pos(barX, barY),\r\n                        k.anchor('topleft'),\r\n                        k.color(30, 30, 40),\r\n                        k.outline(1, k.rgb(60, 60, 80)),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n\r\n                    // Filled portion\r\n                    const fillWidth = Math.max(0, (progressLevel / progressMax) * (barWidth - 2));\r\n                    if (fillWidth > 0) {\r\n                        const barFill = k.add([\r\n                            k.rect(fillWidth, barHeight - 2),\r\n                            k.pos(barX + 1, barY + 1),\r\n                            k.anchor('topleft'),\r\n                            k.color(progressLevel >= progressMax ? 100 : 80, progressLevel >= progressMax ? 200 : 150, progressLevel >= progressMax ? 100 : 80),\r\n                            k.fixed(),\r\n                            k.z(1002)\r\n                        ]);\r\n                        unlockItems.push(barFill);\r\n                    }\r\n\r\n                    // Level text\r\n                    const levelText = k.add([\r\n                        k.text(`${progressLevel}/${progressMax}`, { size: 10 }),\r\n                        k.pos(barX + barWidth + 8, barY + 4),\r\n                        k.anchor('left'),\r\n                        k.color(progressLevel >= progressMax ? 100 : 150, progressLevel >= progressMax ? 255 : 200, progressLevel >= progressMax ? 100 : 150),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n\r\n                    unlockItems.push(barBg, levelText);\r\n                }\r\n\r\n                // Status text (for non-progress items)\r\n                let statusLabel = null;\r\n                if (statusText && !showProgressBar) {\r\n                    // Color based on status type\r\n                    let statusColor;\r\n                    switch (statusText) {\r\n                        case 'EQUIPPED':\r\n                            statusColor = [100, 200, 255]; // Cyan for equipped\r\n                            break;\r\n                        case 'UNLOCKED':\r\n                            statusColor = [180, 140, 255]; // Purple for achievement-unlocked\r\n                            break;\r\n                        case 'MAXED':\r\n                        case 'OWNED':\r\n                            statusColor = [100, 200, 100]; // Green for owned/maxed\r\n                            break;\r\n                        default:\r\n                            statusColor = [180, 180, 180]; // Gray default\r\n                    }\r\n                    statusLabel = k.add([\r\n                        k.text(statusText, { size: 11 }),\r\n                        k.pos(contentStartX, bottomY + 7),\r\n                        k.anchor('topleft'),\r\n                        k.color(...statusColor),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n                }\r\n                \r\n                // Purchase button or View Achievement button\r\n                if (isAchievementLocked && requiredAchievement) {\r\n                    // Show \"View\" button for achievement-locked items\r\n                    const viewButtonBg = k.add([\r\n                        k.rect(buttonWidth, buttonHeight),\r\n                        k.pos(buttonX, bottomY),\r\n                        k.anchor('topleft'),\r\n                        k.color(50, 40, 60),\r\n                        k.outline(1, k.rgb(100, 80, 130)),\r\n                        k.area({ width: buttonWidth, height: buttonHeight }),\r\n                        k.fixed(),\r\n                        k.z(1010)\r\n                    ]);\r\n\r\n                    const viewButtonText = k.add([\r\n                        k.text('VIEW', { size: 11 }),\r\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\r\n                        k.anchor('center'),\r\n                        k.color(160, 130, 200),\r\n                        k.fixed(),\r\n                        k.z(1011)\r\n                    ]);\r\n\r\n                    // Hover effects for better feedback\r\n                    viewButtonBg.onHover(() => {\r\n                        viewButtonBg.color = k.rgb(70, 55, 85);\r\n                        viewButtonBg.outline.color = k.rgb(140, 110, 180);\r\n                        viewButtonText.color = k.rgb(200, 170, 255);\r\n                    });\r\n                    viewButtonBg.onHoverEnd(() => {\r\n                        viewButtonBg.color = k.rgb(50, 40, 60);\r\n                        viewButtonBg.outline.color = k.rgb(100, 80, 130);\r\n                        viewButtonText.color = k.rgb(160, 130, 200);\r\n                    });\r\n\r\n                    // Store achievement reference for closure\r\n                    const achievementToShow = requiredAchievement;\r\n                    viewButtonBg.onClick(() => {\r\n                        playMenuNav();\r\n                        showAchievementModal(k, achievementToShow);\r\n                    });\r\n                    viewButtonBg.cursor = 'pointer';\r\n\r\n                    unlockItems.push(viewButtonBg, viewButtonText);\r\n                } else if (isAchievementLocked) {\r\n                    // Achievement locked but no specific achievement found - show locked status\r\n                    const lockedText = k.add([\r\n                        k.text('LOCKED', { size: 11 }),\r\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\r\n                        k.anchor('center'),\r\n                        k.color(100, 80, 80),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n                    unlockItems.push(lockedText);\r\n                } else if (canPurchase || (currentCategory === 'permanentUpgrades' && progressLevel < progressMax)) {\r\n                    const buttonBg = k.add([\r\n                        k.rect(buttonWidth, buttonHeight),\r\n                        k.pos(buttonX, bottomY),\r\n                        k.anchor('topleft'),\r\n                        k.color(canPurchase ? 40 : 30, canPurchase ? 120 : 40, canPurchase ? 40 : 30),\r\n                        k.outline(1, k.rgb(canPurchase ? 80 : 50, canPurchase ? 180 : 60, canPurchase ? 80 : 50)),\r\n                        k.area(),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n\r\n                    const buttonText = k.add([\r\n                        k.text(`$${purchaseCost}`, { size: 12 }),\r\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\r\n                        k.anchor('center'),\r\n                        k.color(canPurchase ? 255 : 120, canPurchase ? 255 : 120, canPurchase ? 255 : 120),\r\n                        k.fixed(),\r\n                        k.z(1002)\r\n                    ]);\r\n                    \r\n                    // Add right-click handler for permanent upgrades (refund single level)\r\n                    if (currentCategory === 'permanentUpgrades') {\r\n                        if (progressLevel > 0) {\r\n                            // Use global mouse release event to detect right-click\r\n                            let rightClickHandler = null;\r\n                            rightClickHandler = k.onMouseRelease('right', () => {\r\n                                // Check if mouse is over the button\r\n                                const mousePos = k.mousePos();\r\n\r\n                                if (mousePos.x >= buttonX && mousePos.x <= buttonX + buttonWidth &&\r\n                                    mousePos.y >= bottomY && mousePos.y <= bottomY + buttonHeight) {\r\n                                    // Right-click on button: refund single level\r\n                                    if (isPurchasing) return;\r\n                                    isPurchasing = true;\r\n                                    \r\n                                    const result = refundSinglePermanentUpgrade(key);\r\n                                    \r\n                                    if (result && result.success) {\r\n                                        // Play purchase success sound (reusing for refund)\r\n                                        playPurchaseSuccess();\r\n                                        \r\n                                        // Refund successful\r\n                                        const refundMsg = k.add([\r\n                                            k.text(`Refunded $${result.refundAmount}!`, { size: 20 }),\r\n                                            k.pos(k.width() / 2, k.height() / 2),\r\n                                            k.anchor('center'),\r\n                                            k.color(100, 200, 255),\r\n                                            k.fixed(),\r\n                                            k.z(2000)\r\n                                        ]);\r\n                                        \r\n                                        k.wait(0.5, () => {\r\n                                            if (refundMsg.exists()) k.destroy(refundMsg);\r\n                                        });\r\n                                        \r\n                                        // Refresh shop and reset flag\r\n                                        refreshShop();\r\n                                        k.wait(0.2, () => {\r\n                                            isPurchasing = false;\r\n                                        });\r\n                                    } else {\r\n                                        // Reset flag on error\r\n                                        isPurchasing = false;\r\n                                    }\r\n                                }\r\n                            });\r\n                            \r\n                            // Cleanup handler when button is destroyed\r\n                            buttonBg.onDestroy(() => {\r\n                                if (rightClickHandler) {\r\n                                    rightClickHandler.cancel();\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                    \r\n                    if (canPurchase) {\r\n                        buttonBg.onClick(() => {\r\n                            // Prevent multiple simultaneous purchases\r\n                            if (isPurchasing) return;\r\n                            isPurchasing = true;\r\n\r\n                            let result;\r\n                            if (currentCategory === 'permanentUpgrades') {\r\n                                result = purchasePermanentUpgrade(key, purchaseCost, unlock.maxLevel);\r\n                            } else if (currentCategory === 'boosters') {\r\n                                result = purchaseBooster(key, purchaseCost);\r\n                            } else {\r\n                                result = purchaseUnlock(currentCategory, key, purchaseCost);\r\n                            }\r\n                            \r\n                            // Handle result (permanent upgrades and boosters return object, regular unlocks return boolean)\r\n                            if (currentCategory === 'permanentUpgrades' || currentCategory === 'boosters') {\r\n                                if (result && result.success) {\r\n                                    // Play purchase success sound\r\n                                    playPurchaseSuccess();\r\n\r\n                                    // Purchase successful - different message for boosters\r\n                                    const msgText = currentCategory === 'boosters' ? 'Booster Ready!' : 'Purchased!';\r\n                                    const successMsg = k.add([\r\n                                        k.text(msgText, { size: 20 }),\r\n                                        k.pos(k.width() / 2, k.height() / 2),\r\n                                        k.anchor('center'),\r\n                                        k.color(100, 255, 100),\r\n                                        k.fixed(),\r\n                                        k.z(2000)\r\n                                    ]);\r\n\r\n                                    k.wait(0.5, () => {\r\n                                        if (successMsg.exists()) k.destroy(successMsg);\r\n                                    });\r\n\r\n                                    // Refresh shop and reset purchasing flag with delay to prevent double-purchase\r\n                                    refreshShop();\r\n                                    k.wait(0.2, () => {\r\n                                        isPurchasing = false;\r\n                                    });\r\n                                } else if (result && result.reason === 'insufficientCurrency') {\r\n                                    // Play purchase error sound\r\n                                    playPurchaseError();\r\n\r\n                                    // Not enough currency\r\n                                    const errorMsg = k.add([\r\n                                        k.text(`Not enough ${currencyName}!`, { size: 20 }),\r\n                                        k.pos(k.width() / 2, k.height() / 2),\r\n                                        k.anchor('center'),\r\n                                        k.color(255, 100, 100),\r\n                                        k.fixed(),\r\n                                        k.z(2000)\r\n                                    ]);\r\n\r\n                                    k.wait(0.5, () => {\r\n                                        if (errorMsg.exists()) k.destroy(errorMsg);\r\n                                    });\r\n\r\n                                    // Reset purchasing flag\r\n                                    isPurchasing = false;\r\n                                } else {\r\n                                    // Reset purchasing flag on any other error\r\n                                    isPurchasing = false;\r\n                                }\r\n                            } else {\r\n                                // Regular unlock (returns boolean)\r\n                                if (result) {\r\n                                    // Play purchase success sound\r\n                                    playPurchaseSuccess();\r\n\r\n                                    // Purchase successful\r\n                                    const successMsg = k.add([\r\n                                        k.text('Purchased!', { size: 20 }),\r\n                                        k.pos(k.width() / 2, k.height() / 2),\r\n                                        k.anchor('center'),\r\n                                        k.color(100, 255, 100),\r\n                                        k.fixed(),\r\n                                        k.z(2000)\r\n                                    ]);\r\n\r\n                                    k.wait(0.5, () => {\r\n                                        if (successMsg.exists()) k.destroy(successMsg);\r\n                                    });\r\n\r\n                                    // Refresh shop and reset purchasing flag with delay to prevent double-purchase\r\n                                    refreshShop();\r\n                                    k.wait(0.2, () => {\r\n                                        isPurchasing = false;\r\n                                    });\r\n                                } else {\r\n                                    // Play purchase error sound\r\n                                    playPurchaseError();\r\n\r\n                                    // Not enough currency\r\n                                    const errorMsg = k.add([\r\n                                        k.text(`Not enough ${currencyName}!`, { size: 20 }),\r\n                                        k.pos(k.width() / 2, k.height() / 2),\r\n                                        k.anchor('center'),\r\n                                        k.color(255, 100, 100),\r\n                                        k.fixed(),\r\n                                        k.z(2000)\r\n                                    ]);\r\n\r\n                                    k.wait(0.5, () => {\r\n                                        if (errorMsg.exists()) k.destroy(errorMsg);\r\n                                    });\r\n                                    \r\n                                    // Reset purchasing flag\r\n                                    isPurchasing = false;\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                    \r\n                    unlockItems.push(buttonBg, buttonText);\r\n                } else if (currentCategory === 'cosmetics' && isOwnedCosmetic && !isEquippedCosmetic) {\r\n                    // Show EQUIP button for owned but not equipped cosmetics\r\n                    const equipButtonBg = k.add([\r\n                        k.rect(buttonWidth, buttonHeight),\r\n                        k.pos(buttonX, bottomY),\r\n                        k.anchor('topleft'),\r\n                        k.color(40, 80, 120),\r\n                        k.outline(1, k.rgb(80, 140, 200)),\r\n                        k.area(),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n\r\n                    const equipButtonText = k.add([\r\n                        k.text('EQUIP', { size: 11 }),\r\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\r\n                        k.anchor('center'),\r\n                        k.color(200, 230, 255),\r\n                        k.fixed(),\r\n                        k.z(1002)\r\n                    ]);\r\n\r\n                    // Hover effects\r\n                    equipButtonBg.onHover(() => {\r\n                        equipButtonBg.color = k.rgb(50, 100, 150);\r\n                        equipButtonBg.outline.color = k.rgb(100, 170, 240);\r\n                        equipButtonText.color = k.rgb(230, 245, 255);\r\n                    });\r\n                    equipButtonBg.onHoverEnd(() => {\r\n                        equipButtonBg.color = k.rgb(40, 80, 120);\r\n                        equipButtonBg.outline.color = k.rgb(80, 140, 200);\r\n                        equipButtonText.color = k.rgb(200, 230, 255);\r\n                    });\r\n\r\n                    equipButtonBg.onClick(() => {\r\n                        if (isPurchasing) return;\r\n                        isPurchasing = true;\r\n                        playMenuNav();\r\n                        setEquippedCosmetic(unlock.category, key);\r\n                        isPurchasing = false;\r\n                        refreshShop();\r\n                    });\r\n                    equipButtonBg.cursor = 'pointer';\r\n\r\n                    unlockItems.push(equipButtonBg, equipButtonText);\r\n                } else if (currentCategory === 'cosmetics' && isEquippedCosmetic && !key.includes('None')) {\r\n                    // Show UNEQUIP button for equipped cosmetics (except default \"None\" cosmetics)\r\n                    const unequipButtonBg = k.add([\r\n                        k.rect(buttonWidth, buttonHeight),\r\n                        k.pos(buttonX, bottomY),\r\n                        k.anchor('topleft'),\r\n                        k.color(80, 50, 50),\r\n                        k.outline(1, k.rgb(160, 100, 100)),\r\n                        k.area(),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n\r\n                    const unequipButtonText = k.add([\r\n                        k.text('UNEQUIP', { size: 11 }),\r\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\r\n                        k.anchor('center'),\r\n                        k.color(255, 180, 180),\r\n                        k.fixed(),\r\n                        k.z(1002)\r\n                    ]);\r\n\r\n                    // Hover effects\r\n                    unequipButtonBg.onHover(() => {\r\n                        unequipButtonBg.color = k.rgb(100, 60, 60);\r\n                        unequipButtonBg.outline.color = k.rgb(200, 120, 120);\r\n                        unequipButtonText.color = k.rgb(255, 210, 210);\r\n                    });\r\n                    unequipButtonBg.onHoverEnd(() => {\r\n                        unequipButtonBg.color = k.rgb(80, 50, 50);\r\n                        unequipButtonBg.outline.color = k.rgb(160, 100, 100);\r\n                        unequipButtonText.color = k.rgb(255, 180, 180);\r\n                    });\r\n\r\n                    unequipButtonBg.onClick(() => {\r\n                        if (isPurchasing) return;\r\n                        isPurchasing = true;\r\n                        playMenuNav();\r\n                        // Reset to default \"None\" cosmetic for this category\r\n                        const noneKey = unlock.category + 'None';\r\n                        setEquippedCosmetic(unlock.category, noneKey);\r\n                        isPurchasing = false;\r\n                        refreshShop();\r\n                    });\r\n                    unequipButtonBg.cursor = 'pointer';\r\n\r\n                    unlockItems.push(unequipButtonBg, unequipButtonText);\r\n                }\r\n\r\n                // Push all items (only push statusLabel if it exists)\r\n                unlockItems.push(cardBg, nameText, descText);\r\n                if (statusLabel) {\r\n                    unlockItems.push(statusLabel);\r\n                }\r\n            });\r\n\r\n            // Add pagination controls if more than one page\r\n            if (totalPages > 1) {\r\n                const paginationY = k.height() - 115;\r\n                const paginationCenterX = k.width() / 2;\r\n\r\n                // Page indicator pips\r\n                const pipSpacing = 20;\r\n                const pipsStartX = paginationCenterX - ((totalPages - 1) * pipSpacing) / 2;\r\n                const pipsEndX = paginationCenterX + ((totalPages - 1) * pipSpacing) / 2;\r\n\r\n                // Arrows positioned well outside the pips to prevent overlap\r\n                const arrowOffset = 35;\r\n                const leftArrowX = pipsStartX - arrowOffset;\r\n                const rightArrowX = pipsEndX + arrowOffset;\r\n\r\n                // Left arrow FIRST (so it registers clicks before pips)\r\n                const leftArrowBg = k.add([\r\n                    k.rect(30, 30),\r\n                    k.pos(leftArrowX, paginationY),\r\n                    k.anchor('center'),\r\n                    k.color(0, 0, 0),\r\n                    k.opacity(0),\r\n                    k.area({ width: 30, height: 30 }),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS + 10)\r\n                ]);\r\n\r\n                const leftArrowText = k.add([\r\n                    k.text('<', { size: 24 }),\r\n                    k.pos(leftArrowX, paginationY),\r\n                    k.anchor('center'),\r\n                    k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT + 10)\r\n                ]);\r\n\r\n                if (currentPage > 0) {\r\n                    leftArrowBg.onClick(() => {\r\n                        if (paginationClickHandled) return;\r\n                        paginationClickHandled = true;\r\n                        k.wait(0, () => { paginationClickHandled = false; });\r\n                        playMenuNav();\r\n                        currentPage--;\r\n                        refreshShop();\r\n                    });\r\n                    leftArrowBg.cursor = 'pointer';\r\n                }\r\n                paginationItems.push(leftArrowBg, leftArrowText);\r\n\r\n                // Right arrow SECOND (so it registers clicks before pips)\r\n                const rightArrowBg = k.add([\r\n                    k.rect(30, 30),\r\n                    k.pos(rightArrowX, paginationY),\r\n                    k.anchor('center'),\r\n                    k.color(0, 0, 0),\r\n                    k.opacity(0),\r\n                    k.area({ width: 30, height: 30 }),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS + 10)\r\n                ]);\r\n\r\n                const rightArrowText = k.add([\r\n                    k.text('>', { size: 24 }),\r\n                    k.pos(rightArrowX, paginationY),\r\n                    k.anchor('center'),\r\n                    k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT + 10)\r\n                ]);\r\n\r\n                if (currentPage < totalPages - 1) {\r\n                    rightArrowBg.onClick(() => {\r\n                        if (paginationClickHandled) return;\r\n                        paginationClickHandled = true;\r\n                        k.wait(0, () => { paginationClickHandled = false; });\r\n                        playMenuNav();\r\n                        currentPage++;\r\n                        refreshShop();\r\n                    });\r\n                    rightArrowBg.cursor = 'pointer';\r\n                }\r\n                paginationItems.push(rightArrowBg, rightArrowText);\r\n\r\n                // Page indicator pips LAST (lower z-index, won't interfere with arrows)\r\n                for (let i = 0; i < totalPages; i++) {\r\n                    const isCurrentPage = i === currentPage;\r\n                    const pipX = pipsStartX + i * pipSpacing;\r\n\r\n                    const pipBg = k.add([\r\n                        k.rect(16, 16),\r\n                        k.pos(pipX, paginationY),\r\n                        k.anchor('center'),\r\n                        k.color(0, 0, 0),\r\n                        k.opacity(0),\r\n                        k.area({ width: 16, height: 16 }),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                    ]);\r\n\r\n                    const pipText = k.add([\r\n                        k.text(isCurrentPage ? '' : '', { size: 14 }),\r\n                        k.pos(pipX, paginationY),\r\n                        k.anchor('center'),\r\n                        k.color(isCurrentPage ? 255 : 120, isCurrentPage ? 255 : 120, isCurrentPage ? 255 : 120),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n\r\n                    const pageIndex = i;\r\n                    pipBg.onClick(() => {\r\n                        if (paginationClickHandled) return;\r\n                        paginationClickHandled = true;\r\n                        k.wait(0, () => { paginationClickHandled = false; });\r\n                        if (pageIndex !== currentPage) {\r\n                            playMenuNav();\r\n                            currentPage = pageIndex;\r\n                            refreshShop();\r\n                        }\r\n                    });\r\n                    pipBg.cursor = 'pointer';\r\n\r\n                    paginationItems.push(pipBg, pipText);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Refund button (only shown on permanent upgrades tab)\r\n        // Matches \"Reset to Defaults\" button formatting from Settings menu\r\n        let refundButton = null;\r\n        let refundText = null;\r\n        \r\n        function updateRefundButton() {\r\n            const refundableAmount = getTotalRefundableCredits();\r\n            const showRefund = currentCategory === 'permanentUpgrades' && refundableAmount > 0;\r\n            \r\n            if (showRefund) {\r\n                if (!refundButton) {\r\n                    refundButton = k.add([\r\n                        k.rect(200, 30),\r\n                        k.pos(k.width() / 2, k.height() - 80),\r\n                        k.anchor('center'),\r\n                        k.color(100, 50, 50),\r\n                        k.outline(2, k.rgb(150, 100, 100)),\r\n                        k.area(),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                    ]);\r\n                    \r\n                    refundText = k.add([\r\n                        k.text(`REFUND: $${refundableAmount}`, { size: 14 }),\r\n                        k.pos(k.width() / 2, k.height() - 80),\r\n                        k.anchor('center'),\r\n                        k.color(255, 200, 200),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    \r\n                    refundButton.onClick(() => {\r\n                        const result = refundAllPermanentUpgrades();\r\n                        if (result.success) {\r\n                            playPurchaseSuccess();\r\n                            // Refresh shop to update display\r\n                            refreshShop();\r\n                        } else {\r\n                            playPurchaseError();\r\n                        }\r\n                    });\r\n                } else {\r\n                    // Update refund amount in button text\r\n                    refundText.text = `REFUND: $${refundableAmount}`;\r\n                    refundButton.hidden = false;\r\n                    refundText.hidden = false;\r\n                }\r\n            } else {\r\n                if (refundButton) {\r\n                    refundButton.hidden = true;\r\n                    if (refundText) refundText.hidden = true;\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Initial refresh (after refund button function is defined)\r\n        refreshShop();\r\n        \r\n        // Back button (standardized, centered like other menus)\r\n        const backButton = k.add([\r\n            k.rect(120, 35),\r\n            k.pos(k.width() / 2, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.NEUTRAL),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n        \r\n        const backText = k.add([\r\n            k.text(formatButtonText('Back'), { size: UI_TEXT_SIZES.BODY }),\r\n            k.pos(k.width() / 2, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n        \r\n        backButton.onClick(() => {\r\n            playMenuNav();\r\n            k.go('menu');\r\n        });\r\n        \r\n        k.onKeyPress('escape', () => {\r\n            // Don't navigate away if achievement modal is open (it handles its own escape)\r\n            if (isAchievementModalOpen()) return;\r\n            k.go('menu');\r\n        });\r\n    });\r\n}\r\n\r\n","// Settings scene - allows players to configure game options\r\nimport { getSettings, updateSetting, resetSettings, saveSettings } from '../systems/settings.js';\r\nimport { setMusicVolume, setMasterVolume, setSfxVolume, setUiSoundsEnabled, setCombatSoundsEnabled, playMenuNav } from '../systems/sounds.js';\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS,\r\n    createMenuParticles,\r\n    createAnimatedTitle\r\n} from '../config/uiConfig.js';\r\n\r\n/**\r\n * Show reset confirmation dialog\r\n */\r\nfunction showResetConfirmationDialog(k, onConfirm) {\r\n    // Overlay\r\n    const overlay = k.add([\r\n        k.rect(k.width(), k.height()),\r\n        k.pos(0, 0),\r\n        k.color(0, 0, 0),\r\n        k.opacity(0.7),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY)\r\n    ]);\r\n\r\n    // Dialog box\r\n    const dialogWidth = 400;\r\n    const dialogHeight = 180;\r\n    const dialogBg = k.add([\r\n        k.rect(dialogWidth, dialogHeight),\r\n        k.pos(k.width() / 2, k.height() / 2),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.BG_MEDIUM),\r\n        k.outline(3, k.rgb(...UI_COLORS.BORDER)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 1)\r\n    ]);\r\n\r\n\r\n    // Store dialog entities for cleanup\r\n    const dialogEntities = [];\r\n\r\n    // Close function\r\n    function closeDialog() {\r\n        dialogEntities.forEach(entity => {\r\n            if (entity && entity.exists && entity.exists()) {\r\n                k.destroy(entity);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Cancel button\r\n    const cancelButton = k.add([\r\n        k.rect(100, 30),\r\n        k.pos(k.width() / 2 - 60, k.height() / 2 + 50),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.BG_MEDIUM),\r\n        k.outline(2, k.rgb(...UI_COLORS.TEXT_PRIMARY)),\r\n        k.area(),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n    ]);\r\n\r\n    const cancelText = k.add([\r\n        k.text('Cancel', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n        k.pos(k.width() / 2 - 60, k.height() / 2 + 50),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\r\n    ]);\r\n\r\n    cancelButton.onClick(() => {\r\n        closeDialog();\r\n    });\r\n    dialogEntities.push(overlay, dialogBg, cancelButton, cancelText);\r\n\r\n    // Confirm button\r\n    const confirmButton = k.add([\r\n        k.rect(100, 30),\r\n        k.pos(k.width() / 2 + 60, k.height() / 2 + 50),\r\n        k.anchor('center'),\r\n        k.color(100, 50, 50),\r\n        k.outline(2, k.rgb(150, 100, 100)),\r\n        k.area(),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n    ]);\r\n\r\n    const confirmText = k.add([\r\n        k.text('Reset', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n        k.pos(k.width() / 2 + 60, k.height() / 2 + 50),\r\n        k.anchor('center'),\r\n        k.color(255, 200, 200),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\r\n    ]);\r\n\r\n    confirmButton.onClick(() => {\r\n        closeDialog();\r\n        onConfirm();\r\n    });\r\n    dialogEntities.push(confirmButton, confirmText);\r\n\r\n    // Add title and message to cleanup list\r\n    const titleText = k.add([\r\n        k.text('Reset to Defaults?', { size: UI_TEXT_SIZES.LABEL }),\r\n        k.pos(k.width() / 2, k.height() / 2 - 50),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n    ]);\r\n    dialogEntities.push(titleText);\r\n\r\n    const messageText = k.add([\r\n        k.text('This will reset all settings to their default values.', { size: UI_TEXT_SIZES.SMALL }),\r\n        k.pos(k.width() / 2, k.height() / 2 - 10),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_SECONDARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n    ]);\r\n    dialogEntities.push(messageText);\r\n\r\n    const escapeHandler = k.onKeyPress('escape', () => {\r\n        closeDialog();\r\n        escapeHandler.cancel();\r\n    });\r\n}\r\n\r\nexport function setupSettingsScene(k) {\r\n    k.scene('settings', (args) => {\r\n        // Check if we came from game (pause menu)\r\n        const fromGame = args?.fromGame || false;\r\n        \r\n        let settings = getSettings();\r\n        let currentTab = 'audio'; // audio, video, gameplay, controls, access, data\r\n\r\n        // Background\r\n        k.add([\r\n            k.rect(k.width(), k.height()),\r\n            k.pos(0, 0),\r\n            k.anchor('topleft'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.BACKGROUND)\r\n        ]);\r\n\r\n        // Background particle effects\r\n        createMenuParticles(k, { patternCount: 10, particleCount: 15 });\r\n\r\n        // Title (moved up to avoid collision with tabs)\r\n        createAnimatedTitle(k, 'OPTIONS', k.width() / 2, 35, 8);\r\n\r\n        // Tab buttons\r\n        const tabY = 80;\r\n        const tabSpacing = 100;\r\n        const tabWidth = 90;\r\n        const tabHeight = 30;\r\n        \r\n        const tabs = [\r\n            { key: 'audio', label: 'Audio' },\r\n            { key: 'video', label: 'Video' },\r\n            { key: 'gameplay', label: 'Gameplay' },\r\n            { key: 'controls', label: 'Controls' },\r\n            { key: 'access', label: 'Access.' },\r\n            { key: 'data', label: 'Data' }\r\n        ];\r\n        \r\n        // Calculate centered positions for tabs\r\n        const totalTabWidth = (tabs.length - 1) * tabSpacing;\r\n        const firstTabX = k.width() / 2 - totalTabWidth / 2;\r\n        \r\n        const tabButtons = [];\r\n        tabs.forEach((tab, index) => {\r\n            const tabX = firstTabX + index * tabSpacing;\r\n            const isActive = currentTab === tab.key;\r\n            \r\n            const tabBg = k.add([\r\n                k.rect(tabWidth, tabHeight),\r\n                k.pos(tabX, tabY),\r\n                k.anchor('center'),\r\n                k.color(isActive ? 100 : 50, isActive ? 100 : 50, isActive ? 150 : 80),\r\n                k.outline(2, k.rgb(150, 150, 150)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n            \r\n            const tabLabel = k.add([\r\n                k.text(tab.label, { size: 16 }),\r\n                k.pos(tabX, tabY),\r\n                k.anchor('center'),\r\n                k.color(isActive ? 255 : 150, isActive ? 255 : 150, isActive ? 255 : 150),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            \r\n            tabBg.onClick(() => {\r\n                currentTab = tab.key;\r\n                refreshSettings();\r\n            });\r\n            \r\n            tabButtons.push({ bg: tabBg, label: tabLabel, key: tab.key });\r\n        });\r\n        \r\n        // Content area\r\n        const contentY = 120;\r\n        const itemSpacing = 50; // Spacing between settings items\r\n        const bottomButtonArea = 150; // Space reserved for buttons at bottom (prevents overlap)\r\n        // TODO: Add scrolling support if content exceeds available space\r\n        let settingsItems = [];\r\n        \r\n        // Refresh settings display\r\n        function refreshSettings() {\r\n            // Update tab visuals\r\n            tabButtons.forEach(tab => {\r\n                const isActive = currentTab === tab.key;\r\n                tab.bg.color = k.rgb(\r\n                    isActive ? 100 : 50,\r\n                    isActive ? 100 : 50,\r\n                    isActive ? 150 : 80\r\n                );\r\n                tab.label.color = k.rgb(\r\n                    isActive ? 255 : 150,\r\n                    isActive ? 255 : 150,\r\n                    isActive ? 255 : 150\r\n                );\r\n            });\r\n            \r\n            // Clear existing items\r\n            settingsItems.forEach(item => {\r\n                if (item.exists()) k.destroy(item);\r\n            });\r\n            settingsItems = [];\r\n            \r\n            // Reload settings\r\n            settings = getSettings();\r\n            \r\n            // Display settings based on current tab\r\n            const startY = contentY + 20;\r\n            let currentY = startY;\r\n\r\n            if (currentTab === 'audio') {\r\n                // Master Volume\r\n                currentY = addVolumeSlider(k, 'Master Volume', settings.audio?.masterVolume ?? 1.0, currentY, (value) => {\r\n                    updateSetting('audio', 'masterVolume', value);\r\n                    setMasterVolume(value);\r\n                });\r\n\r\n                // Music Volume\r\n                currentY = addVolumeSlider(k, 'Music Volume', settings.audio?.musicVolume ?? 0.35, currentY, (value) => {\r\n                    updateSetting('audio', 'musicVolume', value);\r\n                    setMusicVolume(value);\r\n                });\r\n\r\n                // SFX Volume\r\n                currentY = addVolumeSlider(k, 'SFX Volume', settings.audio?.sfxVolume ?? 1.0, currentY, (value) => {\r\n                    updateSetting('audio', 'sfxVolume', value);\r\n                    setSfxVolume(value);\r\n                    // Play a preview sound when adjusting\r\n                    playMenuNav();\r\n                });\r\n\r\n                // UI Sounds toggle\r\n                currentY = addToggle(k, 'UI Sounds', settings.audio?.uiSounds !== false, currentY, (value) => {\r\n                    updateSetting('audio', 'uiSounds', value);\r\n                    setUiSoundsEnabled(value);\r\n                });\r\n\r\n                // Combat Sounds toggle\r\n                currentY = addToggle(k, 'Combat Sounds', settings.audio?.combatSounds !== false, currentY, (value) => {\r\n                    updateSetting('audio', 'combatSounds', value);\r\n                    setCombatSoundsEnabled(value);\r\n                });\r\n\r\n            } else if (currentTab === 'video') {\r\n                // Show Particles\r\n                currentY = addToggle(k, 'Show Particles', settings.visual?.showParticles !== false, currentY, (value) => {\r\n                    updateSetting('visual', 'showParticles', value);\r\n                });\r\n\r\n                // Show Screen Shake\r\n                currentY = addToggle(k, 'Screen Shake', settings.visual?.showScreenShake !== false, currentY, (value) => {\r\n                    updateSetting('visual', 'showScreenShake', value);\r\n                });\r\n\r\n                // Show Hit Freeze\r\n                currentY = addToggle(k, 'Hit Freeze', settings.visual?.showHitFreeze !== false, currentY, (value) => {\r\n                    updateSetting('visual', 'showHitFreeze', value);\r\n                });\r\n\r\n                // Show Damage Numbers\r\n                currentY = addToggle(k, 'Damage Numbers', settings.visual?.showDamageNumbers !== false, currentY, (value) => {\r\n                    updateSetting('visual', 'showDamageNumbers', value);\r\n                });\r\n\r\n                // Compact HUD\r\n                currentY = addToggle(k, 'Compact HUD', settings.visual?.compactHUD || false, currentY, (value) => {\r\n                    updateSetting('visual', 'compactHUD', value);\r\n                });\r\n\r\n                // FPS Counter\r\n                currentY = addToggle(k, 'FPS Counter', settings.visual?.showFPS || false, currentY, (value) => {\r\n                    updateSetting('visual', 'showFPS', value);\r\n                });\r\n\r\n                // Show Timer\r\n                currentY = addToggle(k, 'Show Timer', settings.visual?.showTimer !== false, currentY, (value) => {\r\n                    updateSetting('visual', 'showTimer', value);\r\n                });\r\n\r\n            } else if (currentTab === 'controls') {\r\n                // Display current key bindings\r\n                const controls = settings.controls || {};\r\n                \r\n                const controlLabels = [\r\n                    { label: 'Move Up', key: 'moveUp', value: controls.moveUp || 'w' },\r\n                    { label: 'Move Down', key: 'moveDown', value: controls.moveDown || 's' },\r\n                    { label: 'Move Left', key: 'moveLeft', value: controls.moveLeft || 'a' },\r\n                    { label: 'Move Right', key: 'moveRight', value: controls.moveRight || 'd' },\r\n                    { label: 'Pause', key: 'pause', value: controls.pause || 'escape' },\r\n                    { label: 'Interact', key: 'interact', value: controls.interact || 'space' }\r\n                ];\r\n                \r\n                controlLabels.forEach((control, index) => {\r\n                    const y = startY + index * itemSpacing;\r\n                    \r\n                    // Label (moved left for consistency)\r\n                    const labelText = k.add([\r\n                        k.text(control.label + ':', { size: 16 }),\r\n                        k.pos(150, y),\r\n                        k.anchor('left'),\r\n                        k.color(200, 200, 200),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                    ]);\r\n                    \r\n                    // Key display (moved right for more space)\r\n                    const keyDisplay = k.add([\r\n                        k.rect(100, 30),\r\n                        k.pos(500, y),\r\n                        k.anchor('center'),\r\n                        k.color(50, 50, 70),\r\n                        k.outline(2, k.rgb(100, 100, 120)),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                    ]);\r\n                    \r\n                    const keyText = k.add([\r\n                        k.text(control.value.toUpperCase(), { size: 16 }),\r\n                        k.pos(500, y),\r\n                        k.anchor('center'),\r\n                        k.color(255, 255, 255),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    \r\n                    settingsItems.push(labelText, keyDisplay, keyText);\r\n                });\r\n                \r\n                // Note about remapping (positioned to avoid button overlap)\r\n                const maxContentY = startY + controlLabels.length * itemSpacing;\r\n                if (maxContentY < k.height() - bottomButtonArea) {\r\n                    const noteText = k.add([\r\n                        k.text('(Key remapping coming soon)', { size: 12 }),\r\n                        k.pos(k.width() / 2, maxContentY + 20),\r\n                        k.anchor('center'),\r\n                        k.color(150, 150, 150),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                    ]);\r\n                    settingsItems.push(noteText);\r\n                }\r\n                \r\n            } else if (currentTab === 'gameplay') {\r\n                // Auto-pause on level up\r\n                currentY = addToggle(k, 'Auto-pause on Level Up', settings.gameplay?.autoPause || false, currentY, (value) => {\r\n                    updateSetting('gameplay', 'autoPause', value);\r\n                });\r\n\r\n                // Auto-pickup Currency\r\n                currentY = addToggle(k, 'Auto-pickup Currency', settings.gameplay?.autoPickupCurrency || false, currentY, (value) => {\r\n                    updateSetting('gameplay', 'autoPickupCurrency', value);\r\n                });\r\n\r\n                // Auto-pickup XP\r\n                currentY = addToggle(k, 'Auto-pickup XP', settings.gameplay?.autoPickupXP || false, currentY, (value) => {\r\n                    updateSetting('gameplay', 'autoPickupXP', value);\r\n                });\r\n\r\n                // Confirm Before Quit\r\n                currentY = addToggle(k, 'Confirm Before Quit', settings.gameplay?.confirmBeforeQuit !== false, currentY, (value) => {\r\n                    updateSetting('gameplay', 'confirmBeforeQuit', value);\r\n                });\r\n\r\n                // Skip Intro Animation\r\n                currentY = addToggle(k, 'Skip Intro Animation', settings.gameplay?.skipIntroAnimation || false, currentY, (value) => {\r\n                    updateSetting('gameplay', 'skipIntroAnimation', value);\r\n                });\r\n\r\n            } else if (currentTab === 'access') {\r\n                // Accessibility tab\r\n\r\n                // Colorblind Mode dropdown (simplified as toggle for now)\r\n                currentY = addToggle(k, 'Colorblind Mode', settings.accessibility?.colorblindMode !== 'off', currentY, (value) => {\r\n                    updateSetting('accessibility', 'colorblindMode', value ? 'deuteranopia' : 'off');\r\n                });\r\n\r\n                // Reduced Motion\r\n                currentY = addToggle(k, 'Reduced Motion', settings.accessibility?.reducedMotion || false, currentY, (value) => {\r\n                    updateSetting('accessibility', 'reducedMotion', value);\r\n                    // Also disable particles and screen shake\r\n                    if (value) {\r\n                        updateSetting('visual', 'showParticles', false);\r\n                        updateSetting('visual', 'showScreenShake', false);\r\n                    }\r\n                });\r\n\r\n                // Large Text\r\n                currentY = addToggle(k, 'Large Text', settings.accessibility?.largeText || false, currentY, (value) => {\r\n                    updateSetting('accessibility', 'largeText', value);\r\n                });\r\n\r\n                // High Contrast\r\n                currentY = addToggle(k, 'High Contrast', settings.accessibility?.highContrast || false, currentY, (value) => {\r\n                    updateSetting('accessibility', 'highContrast', value);\r\n                });\r\n\r\n            } else if (currentTab === 'data') {\r\n                // Data management tab\r\n\r\n                // Export Save button\r\n                const exportButton = k.add([\r\n                    k.rect(200, 35),\r\n                    k.pos(k.width() / 2, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.BG_MEDIUM),\r\n                    k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                    k.area(),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                ]);\r\n\r\n                const exportText = k.add([\r\n                    k.text('Export Save Data', { size: UI_TEXT_SIZES.SMALL }),\r\n                    k.pos(k.width() / 2, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n\r\n                let exportStatusText = null;\r\n\r\n                exportButton.onClick(() => {\r\n                    try {\r\n                        const saveData = localStorage.getItem('superSmashTexty_save') || '{}';\r\n                        // Check if clipboard API is available\r\n                        if (navigator.clipboard && navigator.clipboard.writeText) {\r\n                            navigator.clipboard.writeText(saveData).then(() => {\r\n                                if (exportStatusText && exportStatusText.exists()) {\r\n                                    exportStatusText.text = 'Copied to clipboard!';\r\n                                    exportStatusText.color = k.rgb(...UI_COLORS.SUCCESS);\r\n                                }\r\n                            }).catch(() => {\r\n                                if (exportStatusText && exportStatusText.exists()) {\r\n                                    exportStatusText.text = 'Failed to copy';\r\n                                    exportStatusText.color = k.rgb(...UI_COLORS.DANGER);\r\n                                }\r\n                            });\r\n                        } else {\r\n                            // Fallback: show the data in console\r\n                            console.log('Save data:', saveData);\r\n                            if (exportStatusText && exportStatusText.exists()) {\r\n                                exportStatusText.text = 'Check browser console (F12)';\r\n                                exportStatusText.color = k.rgb(...UI_COLORS.TEXT_SECONDARY);\r\n                            }\r\n                        }\r\n                    } catch (e) {\r\n                        console.error('Export failed:', e);\r\n                    }\r\n                });\r\n                settingsItems.push(exportButton, exportText);\r\n                currentY += 50;\r\n\r\n                // Status text for export\r\n                exportStatusText = k.add([\r\n                    k.text('', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                    k.pos(k.width() / 2, currentY - 10),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n                settingsItems.push(exportStatusText);\r\n                currentY += 30;\r\n\r\n                // Import Save button\r\n                const importButton = k.add([\r\n                    k.rect(200, 35),\r\n                    k.pos(k.width() / 2, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.BG_MEDIUM),\r\n                    k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                    k.area(),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                ]);\r\n\r\n                const importText = k.add([\r\n                    k.text('Import Save Data', { size: UI_TEXT_SIZES.SMALL }),\r\n                    k.pos(k.width() / 2, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n\r\n                importButton.onClick(() => {\r\n                    // Check if clipboard API is available\r\n                    if (!navigator.clipboard || !navigator.clipboard.readText) {\r\n                        if (exportStatusText && exportStatusText.exists()) {\r\n                            exportStatusText.text = 'Clipboard not available';\r\n                            exportStatusText.color = k.rgb(...UI_COLORS.DANGER);\r\n                        }\r\n                        return;\r\n                    }\r\n                    navigator.clipboard.readText().then((text) => {\r\n                        try {\r\n                            const data = JSON.parse(text);\r\n                            if (data && typeof data === 'object') {\r\n                                localStorage.setItem('superSmashTexty_save', text);\r\n                                if (exportStatusText && exportStatusText.exists()) {\r\n                                    exportStatusText.text = 'Import successful! Refresh to apply.';\r\n                                    exportStatusText.color = k.rgb(...UI_COLORS.SUCCESS);\r\n                                }\r\n                            }\r\n                        } catch (e) {\r\n                            if (exportStatusText && exportStatusText.exists()) {\r\n                                exportStatusText.text = 'Invalid save data';\r\n                                exportStatusText.color = k.rgb(...UI_COLORS.DANGER);\r\n                            }\r\n                        }\r\n                    }).catch(() => {\r\n                        if (exportStatusText && exportStatusText.exists()) {\r\n                            exportStatusText.text = 'Failed to read clipboard';\r\n                            exportStatusText.color = k.rgb(...UI_COLORS.DANGER);\r\n                        }\r\n                    });\r\n                });\r\n                settingsItems.push(importButton, importText);\r\n                currentY += 60;\r\n\r\n                // Reset Progress button\r\n                const resetProgressButton = k.add([\r\n                    k.rect(200, 35),\r\n                    k.pos(k.width() / 2, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.DANGER),\r\n                    k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                    k.area(),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                ]);\r\n\r\n                const resetProgressText = k.add([\r\n                    k.text('Reset All Progress', { size: UI_TEXT_SIZES.SMALL }),\r\n                    k.pos(k.width() / 2, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n\r\n                resetProgressButton.onClick(() => {\r\n                    // Double-confirm for dangerous action\r\n                    showResetConfirmationDialog(k, () => {\r\n                        localStorage.removeItem('superSmashTexty_save');\r\n                        if (exportStatusText && exportStatusText.exists()) {\r\n                            exportStatusText.text = 'Progress reset! Refresh to apply.';\r\n                            exportStatusText.color = k.rgb(...UI_COLORS.SUCCESS);\r\n                        }\r\n                    });\r\n                });\r\n                settingsItems.push(resetProgressButton, resetProgressText);\r\n                currentY += 50;\r\n\r\n                // Warning note\r\n                const warningText = k.add([\r\n                    k.text('Warning: Reset cannot be undone!', { size: 10 }),\r\n                    k.pos(k.width() / 2, currentY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.DANGER),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                ]);\r\n                settingsItems.push(warningText);\r\n            }\r\n        }\r\n        \r\n        // Helper function to add volume slider\r\n        function addVolumeSlider(k, label, value, y, onChange) {\r\n            // Label (moved left for more space)\r\n            const labelText = k.add([\r\n                k.text(label + ':', { size: 16 }),\r\n                k.pos(150, y),\r\n                k.anchor('left'),\r\n                k.color(200, 200, 200),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n            \r\n            // Slider track (moved right for more space)\r\n            const trackWidth = 300;\r\n            const trackHeight = 20;\r\n            const track = k.add([\r\n                k.rect(trackWidth, trackHeight),\r\n                k.pos(500, y),\r\n                k.anchor('center'),\r\n                k.color(50, 50, 70),\r\n                k.outline(2, k.rgb(100, 100, 120)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n            \r\n            // Helper function to get gradient color based on value (0-1)\r\n            // Red (low) -> Yellow (mid) -> Green (high)\r\n            // Returns an object with r, g, b values for use with k.color()\r\n            function getGradientColor(val) {\r\n                if (val < 0.5) {\r\n                    // Red to Yellow\r\n                    const t = val * 2; // 0 to 1\r\n                    return {\r\n                        r: 255, // Red stays max\r\n                        g: Math.round(255 * t), // Green increases\r\n                        b: 0 // Blue stays 0\r\n                    };\r\n                } else {\r\n                    // Yellow to Green\r\n                    const t = (val - 0.5) * 2; // 0 to 1\r\n                    return {\r\n                        r: Math.round(255 * (1 - t)), // Red decreases\r\n                        g: 255, // Green stays max\r\n                        b: 0 // Blue stays 0\r\n                    };\r\n                }\r\n            }\r\n            \r\n            // Slider fill (use k.color() to properly set the gradient color)\r\n            const fillWidth = trackWidth * value;\r\n            const fillColor = getGradientColor(value);\r\n            const fill = k.add([\r\n                k.rect(fillWidth, trackHeight - 4),\r\n                k.pos(500 - (trackWidth - fillWidth) / 2, y),\r\n                k.anchor('center'),\r\n                k.color(fillColor.r, fillColor.g, fillColor.b),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            \r\n            // Slider handle\r\n            const handleX = 500 - trackWidth / 2 + fillWidth;\r\n            const handle = k.add([\r\n                k.rect(20, trackHeight + 4),\r\n                k.pos(handleX, y),\r\n                k.anchor('center'),\r\n                k.color(200, 200, 255),\r\n                k.outline(2, k.rgb(150, 150, 200)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(1002)\r\n            ]);\r\n            \r\n            // Value text (moved further right to avoid clipping)\r\n            const valueText = k.add([\r\n                k.text(Math.round(value * 100) + '%', { size: 14 }),\r\n                k.pos(650 + 30, y),\r\n                k.anchor('left'),\r\n                k.color(255, 255, 255),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n            \r\n            // Slider interaction\r\n            let dragging = false;\r\n            let lastPreviewValue = -1; // Track last value we previewed sound at\r\n            \r\n            track.onClick(() => {\r\n                const mouseX = k.mousePos().x;\r\n                const trackLeft = 500 - trackWidth / 2;\r\n                const localX = mouseX - trackLeft;\r\n                const newValue = Math.max(0, Math.min(1, localX / trackWidth));\r\n                updateSlider(newValue);\r\n            });\r\n            \r\n            handle.onClick(() => {\r\n                dragging = true;\r\n            });\r\n            \r\n            k.onMouseMove(() => {\r\n                if (dragging && k.isMouseDown()) {\r\n                    const mouseX = k.mousePos().x;\r\n                    const trackLeft = 500 - trackWidth / 2;\r\n                    const localX = mouseX - trackLeft;\r\n                    const newValue = Math.max(0, Math.min(1, localX / trackWidth));\r\n                    updateSlider(newValue);\r\n                } else {\r\n                    dragging = false;\r\n                }\r\n            });\r\n            \r\n            k.onMouseRelease(() => {\r\n                dragging = false;\r\n            });\r\n            \r\n            function updateSlider(newValue) {\r\n                const newFillWidth = trackWidth * newValue;\r\n                fill.width = newFillWidth;\r\n                fill.pos.x = 500 - (trackWidth - newFillWidth) / 2;\r\n                handle.pos.x = 500 - trackWidth / 2 + newFillWidth;\r\n                valueText.text = Math.round(newValue * 100) + '%';\r\n                \r\n                // Update gradient color\r\n                const newColor = getGradientColor(newValue);\r\n                fill.color = k.rgb(newColor.r, newColor.g, newColor.b);\r\n                \r\n                // Preview sound at specific intervals (0%, 25%, 50%, 75%, 100%)\r\n                // Only play if we cross a threshold to avoid spam\r\n                const thresholds = [0, 0.25, 0.5, 0.75, 1.0];\r\n                const crossedThreshold = thresholds.some(threshold => {\r\n                    const wasBelow = lastPreviewValue < threshold;\r\n                    const isAbove = newValue >= threshold;\r\n                    return wasBelow && isAbove;\r\n                });\r\n                \r\n                if (crossedThreshold) {\r\n                    // Note: Audio preview would go here when audio system is implemented\r\n                    // Example: k.play('volumePreview', { volume: newValue });\r\n                    lastPreviewValue = newValue;\r\n                }\r\n                \r\n                onChange(newValue);\r\n            }\r\n            \r\n            settingsItems.push(labelText, track, fill, handle, valueText);\r\n            return y + itemSpacing;\r\n        }\r\n        \r\n        // Helper function to add toggle\r\n        function addToggle(k, label, value, y, onChange) {\r\n            // Label (moved left for more space, with max width to prevent overflow)\r\n            const labelText = k.add([\r\n                k.text(label + ':', { size: 16, width: 280 }),\r\n                k.pos(150, y),\r\n                k.anchor('left'),\r\n                k.color(200, 200, 200),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n\r\n            // Toggle background (wider to fit ON/OFF text, moved further right)\r\n            const toggleWidth = 80;\r\n            const toggleHeight = 30;\r\n            const toggleX = 550;\r\n            const toggleBg = k.add([\r\n                k.rect(toggleWidth, toggleHeight),\r\n                k.pos(toggleX, y),\r\n                k.anchor('center'),\r\n                k.color(value ? 50 : 70, value ? 150 : 50, value ? 50 : 70),\r\n                k.outline(2, k.rgb(100, 100, 120)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n\r\n            // Toggle handle\r\n            const handleSize = 24;\r\n            const handleX = value ? toggleX + toggleWidth / 2 - handleSize / 2 - 4 : toggleX - toggleWidth / 2 + handleSize / 2 + 4;\r\n            const toggleHandle = k.add([\r\n                k.rect(handleSize, handleSize),\r\n                k.pos(handleX, y),\r\n                k.anchor('center'),\r\n                k.color(255, 255, 255),\r\n                k.outline(1, k.rgb(200, 200, 200)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            // Toggle text (positioned based on current state)\r\n            const textX = value ? toggleX - 12 : toggleX + 8;\r\n            const toggleText = k.add([\r\n                k.text(value ? 'ON' : 'OFF', { size: 12 }),\r\n                k.pos(textX, y),\r\n                k.anchor('center'),\r\n                k.color(value ? 100 : 150, value ? 255 : 150, value ? 100 : 150),\r\n                k.fixed(),\r\n                k.z(1002)\r\n            ]);\r\n\r\n            // Click handler\r\n            toggleBg.onClick(() => {\r\n                const newValue = !value;\r\n                value = newValue; // Update local value for text positioning\r\n                toggleBg.color = k.rgb(\r\n                    newValue ? 50 : 70,\r\n                    newValue ? 150 : 50,\r\n                    newValue ? 50 : 70\r\n                );\r\n                toggleHandle.pos.x = newValue ? toggleX + toggleWidth / 2 - handleSize / 2 - 4 : toggleX - toggleWidth / 2 + handleSize / 2 + 4;\r\n                toggleText.text = newValue ? 'ON' : 'OFF';\r\n                toggleText.pos.x = newValue ? toggleX - 12 : toggleX + 8;\r\n                toggleText.color = k.rgb(\r\n                    newValue ? 100 : 150,\r\n                    newValue ? 255 : 150,\r\n                    newValue ? 100 : 150\r\n                );\r\n                onChange(newValue);\r\n            });\r\n\r\n            settingsItems.push(labelText, toggleBg, toggleHandle, toggleText);\r\n            return y + itemSpacing;\r\n        }\r\n        \r\n        // Button sizes\r\n        const { MD, SM } = UI_SIZES.BUTTON;\r\n\r\n        // Reset button (created outside refreshSettings to avoid destruction on refresh)\r\n        const resetButton = k.add([\r\n            k.rect(MD.width, MD.height),\r\n            k.pos(k.width() / 2 + 80, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.DANGER),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n\r\n        const resetText = k.add([\r\n            k.text('RESET', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2 + 80, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        resetButton.onClick(() => {\r\n            // Show confirmation dialog\r\n            showResetConfirmationDialog(k, () => {\r\n                resetSettings();\r\n                refreshSettings();\r\n            });\r\n        });\r\n\r\n        // Initial refresh\r\n        refreshSettings();\r\n\r\n        // Back button (SM size - secondary action)\r\n        const backButton = k.add([\r\n            k.rect(SM.width, SM.height),\r\n            k.pos(k.width() / 2 - 80, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.NEUTRAL),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n\r\n        const backText = k.add([\r\n            k.text('BACK', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2 - 80, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n        \r\n        backButton.onClick(() => {\r\n            if (fromGame) {\r\n                k.go('game');\r\n            } else {\r\n                k.go('menu');\r\n            }\r\n        });\r\n        \r\n        k.onKeyPress('escape', () => {\r\n            if (fromGame) {\r\n                k.go('game');\r\n            } else {\r\n                k.go('menu');\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n","// Statistics and Achievements scene\r\nimport { getSaveStats, getUnlockedAchievements, getCurrencyName, getRunHistory } from '../systems/metaProgression.js';\r\nimport { ACHIEVEMENTS, getAchievementCategories, getAchievementsByCategory, ACHIEVEMENT_COLORS, getAchievementProgress } from '../data/achievements.js';\r\nimport { playMenuNav } from '../systems/sounds.js';\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS,\r\n    formatButtonText,\r\n    createMenuParticles,\r\n    createAnimatedTitle\r\n} from '../config/uiConfig.js';\r\n\r\n// Helper function to convert HSL to RGB for rainbow gradient\r\nfunction hslToRgb(h, s, l) {\r\n    // Clamp inputs to valid ranges\r\n    h = Math.max(0, Math.min(1, h));\r\n    s = Math.max(0, Math.min(1, s));\r\n    l = Math.max(0, Math.min(1, l));\r\n\r\n    let r, g, b;\r\n    if (s === 0) {\r\n        r = g = b = l; // achromatic\r\n    } else {\r\n        const hue2rgb = (p, q, t) => {\r\n            if (t < 0) t += 1;\r\n            if (t > 1) t -= 1;\r\n            if (t < 1/6) return p + (q - p) * 6 * t;\r\n            if (t < 1/2) return q;\r\n            if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;\r\n            return p;\r\n        };\r\n        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n        const p = 2 * l - q;\r\n        r = hue2rgb(p, q, h + 1/3);\r\n        g = hue2rgb(p, q, h);\r\n        b = hue2rgb(p, q, h - 1/3);\r\n    }\r\n    // Ensure RGB values are valid integers\r\n    return [\r\n        Math.max(0, Math.min(255, Math.round(r * 255))),\r\n        Math.max(0, Math.min(255, Math.round(g * 255))),\r\n        Math.max(0, Math.min(255, Math.round(b * 255)))\r\n    ];\r\n}\r\n\r\nexport function setupStatisticsScene(k) {\r\n    k.scene('statistics', () => {\r\n        const stats = getSaveStats();\r\n        const unlockedAchievements = getUnlockedAchievements();\r\n        const currencyName = getCurrencyName();\r\n        let currentTab = 'achievements'; // achievements, stats, or history\r\n        let achievementCategory = 'all'; // all, or specific category\r\n        let currentPage = 0;\r\n        const ACHIEVEMENTS_PER_PAGE = 15; // 5x3 grid\r\n        const RUNS_PER_PAGE = 8; // History tab rows per page\r\n        let isNavigating = false; // Debounce flag for pagination and category tabs\r\n        let selectedAchievement = null; // Currently selected achievement for detail panel\r\n\r\n        // Background\r\n        k.add([\r\n            k.rect(k.width(), k.height()),\r\n            k.pos(0, 0),\r\n            k.anchor('topleft'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.BACKGROUND)\r\n        ]);\r\n\r\n        // Background particle effects\r\n        createMenuParticles(k, { patternCount: 10, particleCount: 15 });\r\n\r\n        // Title (moved up to avoid collision with tabs)\r\n        createAnimatedTitle(k, 'RATINGS AND RECORDS', k.width() / 2, 35, 8);\r\n\r\n        // Tab buttons (centered like Settings menu)\r\n        const tabY = 80;\r\n        const tabSpacing = 160; // Increased spacing to add padding between buttons\r\n        const tabWidth = 150;\r\n        const tabHeight = 30;\r\n\r\n        const tabs = [\r\n            { key: 'achievements', label: 'Achievements' },\r\n            { key: 'stats', label: 'Statistics' },\r\n            { key: 'history', label: 'History' }\r\n        ];\r\n\r\n        // Calculate centered positions for tabs (same as Settings menu)\r\n        const totalTabWidth = (tabs.length - 1) * tabSpacing;\r\n        const firstTabX = k.width() / 2 - totalTabWidth / 2;\r\n\r\n        const tabButtons = [];\r\n        tabs.forEach((tab, index) => {\r\n            const tabX = firstTabX + index * tabSpacing;\r\n            const isActive = currentTab === tab.key;\r\n\r\n            const tabBg = k.add([\r\n                k.rect(tabWidth, tabHeight),\r\n                k.pos(tabX, tabY),\r\n                k.anchor('center'),\r\n                k.color(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM)),\r\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n\r\n            const tabLabel = k.add([\r\n                k.text(tab.label, { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(tabX, tabY),\r\n                k.anchor('center'),\r\n                k.color(...(isActive ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_TERTIARY)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            tabBg.onClick(() => {\r\n                if (isNavigating) return;\r\n                isNavigating = true;\r\n                playMenuNav();\r\n                currentTab = tab.key;\r\n                currentPage = 0;\r\n                achievementCategory = 'all';\r\n                k.wait(0, () => {\r\n                    refreshContent();\r\n                    k.wait(0.1, () => { isNavigating = false; });\r\n                });\r\n            });\r\n\r\n            tabButtons.push({ bg: tabBg, label: tabLabel, key: tab.key });\r\n        });\r\n\r\n        // Content area\r\n        const contentY = 140;\r\n        const backButtonArea = 80; // Increased space for back button\r\n        const viewportBottom = k.height() - backButtonArea;\r\n        let contentItems = [];\r\n        let categoryTabItems = [];\r\n\r\n        // Get all achievement categories\r\n        const allCategories = ['all', ...getAchievementCategories()];\r\n\r\n        // Refresh content display\r\n        function refreshContent() {\r\n            // Verify k is available\r\n            if (!k || typeof k.add !== 'function') {\r\n                console.error('k is not available or k.add is not a function');\r\n                return;\r\n            }\r\n\r\n            // Update tab visuals\r\n            tabButtons.forEach(tab => {\r\n                const isActive = currentTab === tab.key;\r\n                tab.bg.color = k.rgb(\r\n                    isActive ? 100 : 50,\r\n                    isActive ? 100 : 50,\r\n                    isActive ? 150 : 80\r\n                );\r\n                tab.label.color = k.rgb(\r\n                    isActive ? 255 : 150,\r\n                    isActive ? 255 : 150,\r\n                    isActive ? 255 : 150\r\n                );\r\n            });\r\n\r\n            // Clear existing items\r\n            contentItems.forEach(item => {\r\n                if (item && typeof item.exists === 'function' && item.exists()) {\r\n                    try {\r\n                        k.destroy(item);\r\n                    } catch (e) {\r\n                        console.warn('Error destroying content item:', e);\r\n                    }\r\n                }\r\n            });\r\n            contentItems = [];\r\n\r\n            // Clear category tab items\r\n            categoryTabItems.forEach(item => {\r\n                if (item && typeof item.exists === 'function' && item.exists()) {\r\n                    try {\r\n                        k.destroy(item);\r\n                    } catch (e) {\r\n                        console.warn('Error destroying category tab item:', e);\r\n                    }\r\n                }\r\n            });\r\n            categoryTabItems = [];\r\n\r\n            if (currentTab === 'stats') {\r\n                // Display statistics\r\n                const statsY = contentY + 20;\r\n                const statsSpacing = 30;\r\n\r\n                const statLabels = [\r\n                    { label: 'Total Runs', value: stats.totalRuns || 0 },\r\n                    { label: 'Best Floor', value: stats.bestFloor || 1 },\r\n                    { label: 'Best Room', value: stats.bestRoom || 1 },\r\n                    { label: 'Best Level', value: stats.bestLevel || 1 },\r\n                    { label: 'Total Enemies Killed', value: stats.totalEnemiesKilled || 0 },\r\n                    { label: 'Total Bosses Killed', value: stats.totalBossesKilled || 0 },\r\n                    { label: 'Total Rooms Cleared', value: stats.totalRoomsCleared || 0 },\r\n                    { label: 'Total Floors Reached', value: stats.totalFloorsReached || 0 },\r\n                    { label: `Total ${currencyName} Earned`, value: stats.totalCurrencyEarned || 0 }\r\n                ];\r\n\r\n                statLabels.forEach((stat, index) => {\r\n                    const y = statsY + index * statsSpacing;\r\n\r\n                    // Label\r\n                    const labelText = k.add([\r\n                        k.text(stat.label + ':', { size: 18 }),\r\n                        k.pos(200, y),\r\n                        k.anchor('left'),\r\n                        k.color(200, 200, 200),\r\n                        k.fixed(),\r\n                        k.z(1000)\r\n                    ]);\r\n\r\n                    // Value\r\n                    const valueText = k.add([\r\n                        k.text(stat.value.toString(), { size: 18 }),\r\n                        k.pos(500, y),\r\n                        k.anchor('left'),\r\n                        k.color(255, 255, 255),\r\n                        k.fixed(),\r\n                        k.z(1000)\r\n                    ]);\r\n\r\n                    contentItems.push(labelText, valueText);\r\n                });\r\n\r\n            } else if (currentTab === 'achievements') {\r\n                try {\r\n                    // ========================================================\r\n                    // SPLIT PANEL LAYOUT: Grid on left, Detail panel on right\r\n                    // ========================================================\r\n\r\n                    // Layout constants\r\n                    const panelGap = 20;\r\n                    const leftPanelWidth = 320;\r\n                    const rightPanelWidth = 300;\r\n                    const totalWidth = leftPanelWidth + panelGap + rightPanelWidth;\r\n                    const startX = (k.width() - totalWidth) / 2;\r\n                    const panelTop = contentY + 5;\r\n                    const panelHeight = viewportBottom - panelTop - 80;\r\n\r\n                    // Category tabs (horizontal, above the panels)\r\n                    const categoryTabY = panelTop;\r\n                    const categoryTabWidth = 70;\r\n                    const categoryTabHeight = 22;\r\n                    const categoryTabSpacing = 75;\r\n\r\n                    const displayCategories = allCategories.slice(0, 7);\r\n                    const totalCategoryWidth = (displayCategories.length - 1) * categoryTabSpacing;\r\n                    const firstCategoryX = k.width() / 2 - totalCategoryWidth / 2;\r\n\r\n                    displayCategories.forEach((cat, index) => {\r\n                        const catX = firstCategoryX + index * categoryTabSpacing;\r\n                        const isActive = achievementCategory === cat;\r\n                        const catName = cat === 'all' ? 'All' : cat.charAt(0).toUpperCase() + cat.slice(1);\r\n\r\n                        const catBg = k.add([\r\n                            k.rect(categoryTabWidth, categoryTabHeight),\r\n                            k.pos(catX, categoryTabY),\r\n                            k.anchor('center'),\r\n                            k.color(isActive ? 80 : 40, isActive ? 80 : 40, isActive ? 120 : 60),\r\n                            k.outline(1, k.rgb(100, 100, 150)),\r\n                            k.area(),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n\r\n                        const catLabel = k.add([\r\n                            k.text(catName, { size: 11 }),\r\n                            k.pos(catX, categoryTabY),\r\n                            k.anchor('center'),\r\n                            k.color(isActive ? 255 : 150, isActive ? 255 : 150, isActive ? 255 : 150),\r\n                            k.fixed(),\r\n                            k.z(1001)\r\n                        ]);\r\n\r\n                        catBg.onClick(() => {\r\n                            if (isNavigating) return;\r\n                            isNavigating = true;\r\n                            playMenuNav();\r\n                            achievementCategory = cat;\r\n                            currentPage = 0;\r\n                            selectedAchievement = null;\r\n                            k.wait(0, () => {\r\n                                refreshContent();\r\n                                k.wait(0.1, () => { isNavigating = false; });\r\n                            });\r\n                        });\r\n\r\n                        categoryTabItems.push(catBg, catLabel);\r\n                    });\r\n\r\n                    // Get achievements for current category\r\n                    let categoryAchievements;\r\n                    if (achievementCategory === 'all') {\r\n                        categoryAchievements = Object.values(ACHIEVEMENTS);\r\n                    } else {\r\n                        categoryAchievements = getAchievementsByCategory(achievementCategory);\r\n                    }\r\n\r\n                    // Pagination\r\n                    const totalPages = Math.ceil(categoryAchievements.length / ACHIEVEMENTS_PER_PAGE);\r\n                    if (currentPage >= totalPages) currentPage = Math.max(0, totalPages - 1);\r\n\r\n                    const startIndex = currentPage * ACHIEVEMENTS_PER_PAGE;\r\n                    const pageAchievements = categoryAchievements.slice(startIndex, startIndex + ACHIEVEMENTS_PER_PAGE);\r\n\r\n                    // ========== LEFT PANEL: Achievement Grid ==========\r\n                    const gridTop = panelTop + 35;\r\n                    const boxSize = 50;\r\n                    const boxSpacing = 8;\r\n                    const boxesPerRow = 5;\r\n                    const rowHeight = boxSize + 22;\r\n                    const gridStartX = startX;\r\n\r\n                    // Left panel background\r\n                    const leftPanelBg = k.add([\r\n                        k.rect(leftPanelWidth, panelHeight - 35),\r\n                        k.pos(startX, gridTop),\r\n                        k.anchor('topleft'),\r\n                        k.color(25, 25, 35),\r\n                        k.outline(2, k.rgb(60, 60, 80)),\r\n                        k.fixed(),\r\n                        k.z(999)\r\n                    ]);\r\n                    contentItems.push(leftPanelBg);\r\n\r\n                    // Achievement grid\r\n                    const gridPadding = 15;\r\n                    pageAchievements.forEach((achievement, index) => {\r\n                        const isUnlocked = unlockedAchievements.includes(achievement.id);\r\n                        const isSelected = selectedAchievement && selectedAchievement.id === achievement.id;\r\n                        const row = Math.floor(index / boxesPerRow);\r\n                        const col = index % boxesPerRow;\r\n                        const boxX = gridStartX + gridPadding + col * (boxSize + boxSpacing);\r\n                        const boxY = gridTop + gridPadding + row * rowHeight;\r\n\r\n                        const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\r\n\r\n                        // Selection highlight\r\n                        const highlightColor = isSelected ? [100, 100, 180] : (isUnlocked ? [50, 50, 65] : [30, 30, 40]);\r\n                        const borderColor = isSelected ? [150, 150, 255] : (isUnlocked ? difficultyColor : [50, 50, 60]);\r\n\r\n                        const boxBg = k.add([\r\n                            k.rect(boxSize, boxSize),\r\n                            k.pos(boxX, boxY),\r\n                            k.anchor('topleft'),\r\n                            k.color(...highlightColor),\r\n                            k.outline(isSelected ? 3 : 2, k.rgb(...borderColor)),\r\n                            k.area({ width: boxSize, height: boxSize }),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n\r\n                        const iconText = k.add([\r\n                            k.text(achievement.icon, { size: 24 }),\r\n                            k.pos(boxX + boxSize / 2, boxY + boxSize / 2),\r\n                            k.anchor('center'),\r\n                            k.color(isUnlocked ? 255 : 80, isUnlocked ? 255 : 80, isUnlocked ? 255 : 80),\r\n                            k.fixed(),\r\n                            k.z(1001)\r\n                        ]);\r\n\r\n                        // Progress bar under locked achievements\r\n                        if (!isUnlocked) {\r\n                            const progress = getAchievementProgress(achievement.id, stats);\r\n                            if (progress && progress.percentage > 0) {\r\n                                const barWidth = boxSize - 4;\r\n                                const fillWidth = barWidth * progress.progress;\r\n\r\n                                const progressBg = k.add([\r\n                                    k.rect(barWidth, 4),\r\n                                    k.pos(boxX + 2, boxY + boxSize - 6),\r\n                                    k.anchor('topleft'),\r\n                                    k.color(20, 20, 30),\r\n                                    k.fixed(),\r\n                                    k.z(1001)\r\n                                ]);\r\n                                contentItems.push(progressBg);\r\n\r\n                                if (fillWidth > 0) {\r\n                                    const progressFill = k.add([\r\n                                        k.rect(fillWidth, 4),\r\n                                        k.pos(boxX + 2, boxY + boxSize - 6),\r\n                                        k.anchor('topleft'),\r\n                                        k.color(...difficultyColor),\r\n                                        k.opacity(0.8),\r\n                                        k.fixed(),\r\n                                        k.z(1002)\r\n                                    ]);\r\n                                    contentItems.push(progressFill);\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        // Click handler - select achievement\r\n                        boxBg.onClick(() => {\r\n                            if (isNavigating) return;\r\n                            playMenuNav();\r\n                            selectedAchievement = achievement;\r\n                            isNavigating = true;\r\n                            k.wait(0, () => {\r\n                                refreshContent();\r\n                                k.wait(0.1, () => { isNavigating = false; });\r\n                            });\r\n                        });\r\n\r\n                        contentItems.push(boxBg, iconText);\r\n                    });\r\n\r\n                    // ========== RIGHT PANEL: Detail View ==========\r\n                    const rightPanelX = startX + leftPanelWidth + panelGap;\r\n\r\n                    // Right panel background\r\n                    const rightPanelBg = k.add([\r\n                        k.rect(rightPanelWidth, panelHeight - 35),\r\n                        k.pos(rightPanelX, gridTop),\r\n                        k.anchor('topleft'),\r\n                        k.color(30, 28, 40),\r\n                        k.outline(2, k.rgb(70, 70, 100)),\r\n                        k.fixed(),\r\n                        k.z(999)\r\n                    ]);\r\n                    contentItems.push(rightPanelBg);\r\n\r\n                    // Detail content\r\n                    const detailCenterX = rightPanelX + rightPanelWidth / 2;\r\n                    const detailTop = gridTop + 20;\r\n\r\n                    if (selectedAchievement) {\r\n                        const ach = selectedAchievement;\r\n                        const isUnlocked = unlockedAchievements.includes(ach.id);\r\n                        const progress = getAchievementProgress(ach.id, stats);\r\n                        const difficultyColor = ACHIEVEMENT_COLORS[ach.difficulty] || ACHIEVEMENT_COLORS.normal;\r\n\r\n                        // Large icon\r\n                        const iconBg = k.add([\r\n                            k.rect(70, 70),\r\n                            k.pos(detailCenterX, detailTop + 35),\r\n                            k.anchor('center'),\r\n                            k.color(isUnlocked ? 45 : 25, isUnlocked ? 45 : 25, isUnlocked ? 55 : 30),\r\n                            k.outline(3, k.rgb(...(isUnlocked ? difficultyColor : [60, 60, 70]))),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n                        contentItems.push(iconBg);\r\n\r\n                        const largeIcon = k.add([\r\n                            k.text(ach.icon, { size: 40 }),\r\n                            k.pos(detailCenterX, detailTop + 35),\r\n                            k.anchor('center'),\r\n                            k.color(isUnlocked ? 255 : 100, isUnlocked ? 255 : 100, isUnlocked ? 255 : 100),\r\n                            k.fixed(),\r\n                            k.z(1001)\r\n                        ]);\r\n                        contentItems.push(largeIcon);\r\n\r\n                        // Achievement name\r\n                        const nameText = k.add([\r\n                            k.text(ach.name, { size: 16 }),\r\n                            k.pos(detailCenterX, detailTop + 85),\r\n                            k.anchor('center'),\r\n                            k.color(...(isUnlocked ? [255, 255, 255] : [180, 180, 180])),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n                        contentItems.push(nameText);\r\n\r\n                        // Difficulty badge\r\n                        const diffName = ach.difficulty.charAt(0).toUpperCase() + ach.difficulty.slice(1);\r\n                        const diffBadge = k.add([\r\n                            k.text(diffName, { size: 11 }),\r\n                            k.pos(detailCenterX, detailTop + 105),\r\n                            k.anchor('center'),\r\n                            k.color(...difficultyColor),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n                        contentItems.push(diffBadge);\r\n\r\n                        // Description\r\n                        const descText = k.add([\r\n                            k.text(ach.description, { size: 12 }),\r\n                            k.pos(detailCenterX, detailTop + 130),\r\n                            k.anchor('center'),\r\n                            k.color(180, 180, 200),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n                        contentItems.push(descText);\r\n\r\n                        // Status / Progress\r\n                        let statusY = detailTop + 160;\r\n                        if (isUnlocked) {\r\n                            const statusText = k.add([\r\n                                k.text('UNLOCKED', { size: 14 }),\r\n                                k.pos(detailCenterX, statusY),\r\n                                k.anchor('center'),\r\n                                k.color(100, 255, 100),\r\n                                k.fixed(),\r\n                                k.z(1000)\r\n                            ]);\r\n                            contentItems.push(statusText);\r\n                        } else if (progress) {\r\n                            // Progress bar\r\n                            const barWidth = 200;\r\n                            const barHeight = 16;\r\n\r\n                            const progressBgBar = k.add([\r\n                                k.rect(barWidth, barHeight),\r\n                                k.pos(detailCenterX, statusY),\r\n                                k.anchor('center'),\r\n                                k.color(30, 30, 45),\r\n                                k.outline(1, k.rgb(70, 70, 90)),\r\n                                k.fixed(),\r\n                                k.z(1000)\r\n                            ]);\r\n                            contentItems.push(progressBgBar);\r\n\r\n                            const fillWidth = Math.max(2, barWidth * progress.progress);\r\n                            const progressFillBar = k.add([\r\n                                k.rect(fillWidth, barHeight - 4),\r\n                                k.pos(detailCenterX - barWidth / 2 + fillWidth / 2, statusY),\r\n                                k.anchor('center'),\r\n                                k.color(...difficultyColor),\r\n                                k.opacity(0.9),\r\n                                k.fixed(),\r\n                                k.z(1001)\r\n                            ]);\r\n                            contentItems.push(progressFillBar);\r\n\r\n                            const progressLabel = k.add([\r\n                                k.text(`${progress.current} / ${progress.target}`, { size: 11 }),\r\n                                k.pos(detailCenterX, statusY + 20),\r\n                                k.anchor('center'),\r\n                                k.color(150, 150, 180),\r\n                                k.fixed(),\r\n                                k.z(1000)\r\n                            ]);\r\n                            contentItems.push(progressLabel);\r\n                            statusY += 35;\r\n                        }\r\n\r\n                        // Hint (if locked)\r\n                        if (!isUnlocked && ach.hint) {\r\n                            const hintY = statusY + 15;\r\n                            const hintLabel = k.add([\r\n                                k.text('Hint:', { size: 10 }),\r\n                                k.pos(detailCenterX, hintY),\r\n                                k.anchor('center'),\r\n                                k.color(120, 120, 140),\r\n                                k.fixed(),\r\n                                k.z(1000)\r\n                            ]);\r\n                            contentItems.push(hintLabel);\r\n\r\n                            const hintText = k.add([\r\n                                k.text(ach.hint, { size: 11 }),\r\n                                k.pos(detailCenterX, hintY + 18),\r\n                                k.anchor('center'),\r\n                                k.color(160, 160, 180),\r\n                                k.fixed(),\r\n                                k.z(1000)\r\n                            ]);\r\n                            contentItems.push(hintText);\r\n                        }\r\n\r\n                    } else {\r\n                        // No achievement selected - show prompt\r\n                        const promptIcon = k.add([\r\n                            k.text('', { size: 32 }),\r\n                            k.pos(detailCenterX, detailTop + 60),\r\n                            k.anchor('center'),\r\n                            k.color(150, 150, 180),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n                        contentItems.push(promptIcon);\r\n\r\n                        const promptText = k.add([\r\n                            k.text('Select an achievement', { size: 14 }),\r\n                            k.pos(detailCenterX, detailTop + 100),\r\n                            k.anchor('center'),\r\n                            k.color(120, 120, 150),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n                        contentItems.push(promptText);\r\n\r\n                        const promptText2 = k.add([\r\n                            k.text('to view details', { size: 12 }),\r\n                            k.pos(detailCenterX, detailTop + 120),\r\n                            k.anchor('center'),\r\n                            k.color(100, 100, 130),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n                        contentItems.push(promptText2);\r\n                    }\r\n\r\n                    // Pagination controls\r\n                    if (totalPages > 1) {\r\n                        const paginationY = viewportBottom - 55;\r\n                        const paginationCenterX = k.width() / 2;\r\n\r\n                        // Page indicator pips\r\n                        const pipSpacing = 20;\r\n                        const pipsStartX = paginationCenterX - ((totalPages - 1) * pipSpacing) / 2;\r\n                        const pipsEndX = paginationCenterX + ((totalPages - 1) * pipSpacing) / 2;\r\n\r\n                        // Arrows positioned outside the pips with offset for pip clickable area (16px) + gap\r\n                        const arrowOffset = 25;\r\n                        const leftArrowX = pipsStartX - arrowOffset;\r\n                        const rightArrowX = pipsEndX + arrowOffset;\r\n\r\n                        // Helper function to handle page change\r\n                        const goToPage = (newPage) => {\r\n                            if (isNavigating || newPage === currentPage || newPage < 0 || newPage >= totalPages) return;\r\n                            isNavigating = true;\r\n                            playMenuNav();\r\n                            currentPage = newPage;\r\n                            // Defer refresh to next frame to ensure clean destruction\r\n                            k.wait(0, () => {\r\n                                refreshContent();\r\n                                k.wait(0.15, () => { isNavigating = false; });\r\n                            });\r\n                        };\r\n\r\n                        for (let i = 0; i < totalPages; i++) {\r\n                            const isCurrentPip = i === currentPage;\r\n                            const pipX = pipsStartX + i * pipSpacing;\r\n\r\n                            const pipBg = k.add([\r\n                                k.rect(16, 16),\r\n                                k.pos(pipX, paginationY),\r\n                                k.anchor('center'),\r\n                                k.color(0, 0, 0),\r\n                                k.opacity(0),\r\n                                k.area({ width: 16, height: 16 }),\r\n                                k.fixed(),\r\n                                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                            ]);\r\n                            const pipText = k.add([\r\n                                k.text(isCurrentPip ? '' : '', { size: 14 }),\r\n                                k.pos(pipX, paginationY),\r\n                                k.anchor('center'),\r\n                                k.color(isCurrentPip ? 255 : 120, isCurrentPip ? 255 : 120, isCurrentPip ? 255 : 120),\r\n                                k.fixed(),\r\n                                k.z(UI_Z_LAYERS.UI_TEXT)\r\n                            ]);\r\n\r\n                            const pageIndex = i;\r\n                            pipBg.onClick(() => goToPage(pageIndex));\r\n                            pipBg.cursor = 'pointer';\r\n\r\n                            contentItems.push(pipBg, pipText);\r\n                        }\r\n\r\n                        // Left arrow (higher z-index to sit on top and take priority)\r\n                        const leftArrowBg = k.add([\r\n                            k.rect(30, 30),\r\n                            k.pos(leftArrowX, paginationY),\r\n                            k.anchor('center'),\r\n                            k.color(0, 0, 0),\r\n                            k.opacity(0),\r\n                            k.area({ width: 30, height: 30 }),\r\n                            k.fixed(),\r\n                            k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\r\n                        ]);\r\n                        const leftArrowText = k.add([\r\n                            k.text('<', { size: 24 }),\r\n                            k.pos(leftArrowX, paginationY),\r\n                            k.anchor('center'),\r\n                            k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\r\n                            k.fixed(),\r\n                            k.z(UI_Z_LAYERS.UI_TEXT + 1)\r\n                        ]);\r\n\r\n                        if (currentPage > 0) {\r\n                            const targetPage = currentPage - 1;\r\n                            leftArrowBg.onClick(() => goToPage(targetPage));\r\n                            leftArrowBg.cursor = 'pointer';\r\n                        }\r\n                        contentItems.push(leftArrowBg, leftArrowText);\r\n\r\n                        // Right arrow (higher z-index to sit on top and take priority)\r\n                        const rightArrowBg = k.add([\r\n                            k.rect(30, 30),\r\n                            k.pos(rightArrowX, paginationY),\r\n                            k.anchor('center'),\r\n                            k.color(0, 0, 0),\r\n                            k.opacity(0),\r\n                            k.area({ width: 30, height: 30 }),\r\n                            k.fixed(),\r\n                            k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\r\n                        ]);\r\n                        const rightArrowText = k.add([\r\n                            k.text('>', { size: 24 }),\r\n                            k.pos(rightArrowX, paginationY),\r\n                            k.anchor('center'),\r\n                            k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\r\n                            k.fixed(),\r\n                            k.z(UI_Z_LAYERS.UI_TEXT + 1)\r\n                        ]);\r\n\r\n                        if (currentPage < totalPages - 1) {\r\n                            const targetPage = currentPage + 1;\r\n                            rightArrowBg.onClick(() => goToPage(targetPage));\r\n                            rightArrowBg.cursor = 'pointer';\r\n                        }\r\n                        contentItems.push(rightArrowBg, rightArrowText);\r\n                    }\r\n\r\n                    // Achievement Trophy Meter - satisfying progress display\r\n                    const totalAchievements = Object.keys(ACHIEVEMENTS).length;\r\n                    const unlockedCount = unlockedAchievements.length;\r\n                    const progressPercent = unlockedCount / totalAchievements;\r\n                    const isComplete = progressPercent >= 1;\r\n\r\n                    const meterY = viewportBottom - 20;\r\n                    const meterX = k.width() / 2;\r\n\r\n                    // Trophy icon on the left\r\n                    const trophyIcon = k.add([\r\n                        k.text(isComplete ? '' : '', { size: 24 }),\r\n                        k.pos(meterX - 220, meterY),\r\n                        k.anchor('center'),\r\n                        k.color(isComplete ? 255 : 150, isComplete ? 215 : 150, isComplete ? 0 : 150),\r\n                        k.fixed(),\r\n                        k.scale(1),\r\n                        k.z(1002)\r\n                    ]);\r\n                    contentItems.push(trophyIcon);\r\n\r\n                    // Animated trophy for 100% completion\r\n                    if (isComplete) {\r\n                        let trophyTime = 0;\r\n                        trophyIcon.onUpdate(() => {\r\n                            trophyTime += k.dt();\r\n                            // Gentle pulse effect\r\n                            const scale = 1 + Math.sin(trophyTime * 3) * 0.1;\r\n                            trophyIcon.scale = k.vec2(scale, scale);\r\n                        });\r\n                    }\r\n\r\n                    // ASCII-style progress meter: ||\r\n                    const totalBlocks = 20;\r\n                    const filledBlocks = Math.floor(progressPercent * totalBlocks);\r\n                    const emptyBlocks = totalBlocks - filledBlocks;\r\n\r\n                    // Build the meter string with blocks\r\n                    let meterString = '';\r\n                    for (let i = 0; i < filledBlocks; i++) {\r\n                        meterString += '';\r\n                    }\r\n                    for (let i = 0; i < emptyBlocks; i++) {\r\n                        meterString += '';\r\n                    }\r\n\r\n                    // Meter background frame\r\n                    const meterFrame = k.add([\r\n                        k.text('|' + ''.repeat(totalBlocks) + '|', { size: 16 }),\r\n                        k.pos(meterX, meterY),\r\n                        k.anchor('center'),\r\n                        k.color(60, 60, 80),\r\n                        k.fixed(),\r\n                        k.z(1000)\r\n                    ]);\r\n                    contentItems.push(meterFrame);\r\n\r\n                    // Filled portion with color based on progress\r\n                    let fillColor;\r\n                    if (isComplete) {\r\n                        fillColor = [255, 215, 0]; // Gold for 100%\r\n                    } else if (progressPercent >= 0.75) {\r\n                        fillColor = [100, 255, 100]; // Green for 75%+\r\n                    } else if (progressPercent >= 0.5) {\r\n                        fillColor = [255, 255, 100]; // Yellow for 50%+\r\n                    } else if (progressPercent >= 0.25) {\r\n                        fillColor = [255, 180, 100]; // Orange for 25%+\r\n                    } else {\r\n                        fillColor = [200, 200, 200]; // Gray for less\r\n                    }\r\n\r\n                    const filledMeter = k.add([\r\n                        k.text('|' + meterString + '|', { size: 16 }),\r\n                        k.pos(meterX, meterY),\r\n                        k.anchor('center'),\r\n                        k.color(...fillColor),\r\n                        k.fixed(),\r\n                        k.z(1001)\r\n                    ]);\r\n                    contentItems.push(filledMeter);\r\n\r\n                    // Animate fill color for 100% completion (rainbow cycle)\r\n                    if (isComplete) {\r\n                        let colorTime = 0;\r\n                        filledMeter.onUpdate(() => {\r\n                            colorTime += k.dt();\r\n                            const hue = (colorTime * 60) % 360;\r\n                            const rgb = hslToRgb(hue / 360, 1, 0.6);\r\n                            filledMeter.color = k.rgb(rgb[0], rgb[1], rgb[2]);\r\n                        });\r\n                    }\r\n\r\n                    // Progress count and percentage\r\n                    const percentText = Math.round(progressPercent * 100);\r\n                    const statusText = isComplete ? 'COMPLETE!' : `${percentText}%`;\r\n                    const progressLabel = k.add([\r\n                        k.text(`${unlockedCount}/${totalAchievements}`, { size: 14 }),\r\n                        k.pos(meterX + 180, meterY - 8),\r\n                        k.anchor('center'),\r\n                        k.color(180, 180, 200),\r\n                        k.fixed(),\r\n                        k.z(1002)\r\n                    ]);\r\n                    contentItems.push(progressLabel);\r\n\r\n                    const statusLabel = k.add([\r\n                        k.text(statusText, { size: 12 }),\r\n                        k.pos(meterX + 180, meterY + 8),\r\n                        k.anchor('center'),\r\n                        k.color(...(isComplete ? [255, 215, 0] : [150, 150, 180])),\r\n                        k.fixed(),\r\n                        k.opacity(1),\r\n                        k.z(1002)\r\n                    ]);\r\n                    contentItems.push(statusLabel);\r\n\r\n                    // Sparkle effect for 100% completion\r\n                    if (isComplete) {\r\n                        let sparkleTime = 0;\r\n                        statusLabel.onUpdate(() => {\r\n                            sparkleTime += k.dt();\r\n                            const pulse = Math.sin(sparkleTime * 4) * 0.3 + 0.7;\r\n                            statusLabel.opacity = pulse;\r\n                        });\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Error rendering achievements:', e);\r\n                    // Fallback: show error message\r\n                    const errorText = k.add([\r\n                        k.text('Error loading achievements', { size: 18 }),\r\n                        k.pos(k.width() / 2, contentY + 50),\r\n                        k.anchor('center'),\r\n                        k.color(255, 100, 100),\r\n                        k.fixed(),\r\n                        k.z(1000)\r\n                    ]);\r\n                    contentItems.push(errorText);\r\n                }\r\n            } else if (currentTab === 'history') {\r\n                // Display run history with pagination\r\n                const runHistory = getRunHistory();\r\n                const historyY = contentY + 10;\r\n                const rowHeight = 35;\r\n\r\n                if (runHistory.length === 0) {\r\n                    // No history yet\r\n                    const noHistoryText = k.add([\r\n                        k.text('No run history yet. Complete a run to see it here!', { size: 16 }),\r\n                        k.pos(k.width() / 2, historyY + 50),\r\n                        k.anchor('center'),\r\n                        k.color(150, 150, 150),\r\n                        k.fixed(),\r\n                        k.z(1000)\r\n                    ]);\r\n                    contentItems.push(noHistoryText);\r\n                } else {\r\n                    // Calculate pagination\r\n                    const totalPages = Math.ceil(runHistory.length / RUNS_PER_PAGE);\r\n                    if (currentPage >= totalPages) currentPage = Math.max(0, totalPages - 1);\r\n                    const startIndex = currentPage * RUNS_PER_PAGE;\r\n                    const endIndex = Math.min(startIndex + RUNS_PER_PAGE, runHistory.length);\r\n                    const displayRuns = runHistory.slice(startIndex, endIndex);\r\n\r\n                    // Header row\r\n                    const headers = ['#', 'Floor', 'Rooms', 'Kills', 'Level', 'Credits', 'Time'];\r\n                    const headerPositions = [60, 120, 200, 280, 360, 450, 550];\r\n\r\n                    headers.forEach((header, i) => {\r\n                        const headerText = k.add([\r\n                            k.text(header, { size: 14 }),\r\n                            k.pos(headerPositions[i], historyY),\r\n                            k.anchor('left'),\r\n                            k.color(255, 200, 100),\r\n                            k.fixed(),\r\n                            k.z(1000)\r\n                        ]);\r\n                        contentItems.push(headerText);\r\n                    });\r\n\r\n                    // Run history rows\r\n                    displayRuns.forEach((run, index) => {\r\n                        const y = historyY + (index + 1) * rowHeight;\r\n                        const globalIndex = startIndex + index + 1;\r\n\r\n                        // Format duration\r\n                        const mins = Math.floor(run.duration / 60);\r\n                        const secs = run.duration % 60;\r\n                        const timeStr = `${mins}:${secs.toString().padStart(2, '0')}`;\r\n\r\n                        const rowData = [\r\n                            `${globalIndex}`,\r\n                            `${run.floorsReached}`,\r\n                            `${run.roomsCleared}`,\r\n                            `${run.enemiesKilled}`,\r\n                            `${run.level}`,\r\n                            `${currencyName}${run.currencyEarned}`,\r\n                            timeStr\r\n                        ];\r\n\r\n                        rowData.forEach((value, i) => {\r\n                            const cellText = k.add([\r\n                                k.text(value, { size: 14 }),\r\n                                k.pos(headerPositions[i], y),\r\n                                k.anchor('left'),\r\n                                k.color(200, 200, 200),\r\n                                k.fixed(),\r\n                                k.z(1000)\r\n                            ]);\r\n                            contentItems.push(cellText);\r\n                        });\r\n                    });\r\n\r\n                    // Pagination controls (if more than one page)\r\n                    if (totalPages > 1) {\r\n                        const paginationY = viewportBottom - 55;\r\n                        const centerX = k.width() / 2;\r\n\r\n                        // Page pips\r\n                        const pipSpacing = 20;\r\n                        const pipsStartX = centerX - ((totalPages - 1) * pipSpacing) / 2;\r\n\r\n                        for (let i = 0; i < totalPages; i++) {\r\n                            const isCurrentPip = i === currentPage;\r\n                            const pipX = pipsStartX + i * pipSpacing;\r\n\r\n                            const pipBg = k.add([\r\n                                k.rect(16, 16),\r\n                                k.pos(pipX, paginationY),\r\n                                k.anchor('center'),\r\n                                k.color(0, 0, 0),\r\n                                k.opacity(0),\r\n                                k.area({ width: 16, height: 16 }),\r\n                                k.fixed(),\r\n                                k.z(1000)\r\n                            ]);\r\n\r\n                            const pipText = k.add([\r\n                                k.text(isCurrentPip ? '' : '', { size: 14 }),\r\n                                k.pos(pipX, paginationY),\r\n                                k.anchor('center'),\r\n                                k.color(isCurrentPip ? 255 : 120, isCurrentPip ? 255 : 120, isCurrentPip ? 255 : 120),\r\n                                k.fixed(),\r\n                                k.z(1001)\r\n                            ]);\r\n\r\n                            const pageIndex = i;\r\n                            pipBg.onClick(() => {\r\n                                if (isNavigating || pageIndex === currentPage) return;\r\n                                isNavigating = true;\r\n                                playMenuNav();\r\n                                currentPage = pageIndex;\r\n                                refreshContent();\r\n                                k.wait(0.1, () => { isNavigating = false; });\r\n                            });\r\n                            pipBg.cursor = 'pointer';\r\n\r\n                            contentItems.push(pipBg, pipText);\r\n                        }\r\n\r\n                        // Left/Right arrows\r\n                        const arrowOffset = Math.max(30, (totalPages * pipSpacing) / 2 + 25);\r\n\r\n                        // Left arrow\r\n                        const leftArrowBg = k.add([\r\n                            k.rect(30, 30),\r\n                            k.pos(centerX - arrowOffset, paginationY),\r\n                            k.anchor('center'),\r\n                            k.color(0, 0, 0),\r\n                            k.opacity(0),\r\n                            k.area({ width: 30, height: 30 }),\r\n                            k.fixed(),\r\n                            k.z(1002)\r\n                        ]);\r\n\r\n                        const leftArrowText = k.add([\r\n                            k.text('<', { size: 24 }),\r\n                            k.pos(centerX - arrowOffset, paginationY),\r\n                            k.anchor('center'),\r\n                            k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\r\n                            k.fixed(),\r\n                            k.z(1003)\r\n                        ]);\r\n\r\n                        if (currentPage > 0) {\r\n                            leftArrowBg.onClick(() => {\r\n                                if (isNavigating) return;\r\n                                isNavigating = true;\r\n                                playMenuNav();\r\n                                currentPage--;\r\n                                refreshContent();\r\n                                k.wait(0.1, () => { isNavigating = false; });\r\n                            });\r\n                            leftArrowBg.cursor = 'pointer';\r\n                        }\r\n                        contentItems.push(leftArrowBg, leftArrowText);\r\n\r\n                        // Right arrow\r\n                        const rightArrowBg = k.add([\r\n                            k.rect(30, 30),\r\n                            k.pos(centerX + arrowOffset, paginationY),\r\n                            k.anchor('center'),\r\n                            k.color(0, 0, 0),\r\n                            k.opacity(0),\r\n                            k.area({ width: 30, height: 30 }),\r\n                            k.fixed(),\r\n                            k.z(1002)\r\n                        ]);\r\n\r\n                        const rightArrowText = k.add([\r\n                            k.text('>', { size: 24 }),\r\n                            k.pos(centerX + arrowOffset, paginationY),\r\n                            k.anchor('center'),\r\n                            k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\r\n                            k.fixed(),\r\n                            k.z(1003)\r\n                        ]);\r\n\r\n                        if (currentPage < totalPages - 1) {\r\n                            rightArrowBg.onClick(() => {\r\n                                if (isNavigating) return;\r\n                                isNavigating = true;\r\n                                playMenuNav();\r\n                                currentPage++;\r\n                                refreshContent();\r\n                                k.wait(0.1, () => { isNavigating = false; });\r\n                            });\r\n                            rightArrowBg.cursor = 'pointer';\r\n                        }\r\n                        contentItems.push(rightArrowBg, rightArrowText);\r\n                    }\r\n\r\n                    // Show total runs count\r\n                    const showingStart = startIndex + 1;\r\n                    const showingEnd = endIndex;\r\n                    const totalText = k.add([\r\n                        k.text(`Showing ${showingStart}-${showingEnd} of ${runHistory.length} runs`, { size: 12 }),\r\n                        k.pos(k.width() / 2, viewportBottom - 20),\r\n                        k.anchor('center'),\r\n                        k.color(100, 100, 150),\r\n                        k.fixed(),\r\n                        k.z(1000)\r\n                    ]);\r\n                    contentItems.push(totalText);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Initial refresh\r\n        refreshContent();\r\n\r\n        // Back button (SM size - secondary action)\r\n        const { SM } = UI_SIZES.BUTTON;\r\n        const backButton = k.add([\r\n            k.rect(SM.width, SM.height),\r\n            k.pos(k.width() / 2, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.NEUTRAL),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n\r\n        const backText = k.add([\r\n            k.text('BACK', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        backButton.onClick(() => {\r\n            playMenuNav();\r\n            k.go('menu');\r\n        });\r\n\r\n        k.onKeyPress('escape', () => {\r\n            k.go('menu');\r\n        });\r\n    });\r\n}\r\n","// Character selection scene\r\nimport { getCurrency, getCurrencyName, isUnlocked, setSelectedCharacter, getSelectedCharacter, isAchievementUnlocked } from '../systems/metaProgression.js';\r\nimport { broadcastCharacterChange } from '../systems/partySystem.js';\r\nimport { CHARACTER_UNLOCKS } from '../data/unlocks.js';\r\nimport { ACHIEVEMENTS } from '../data/achievements.js';\r\nimport { playMenuSelect, playMenuNav } from '../systems/sounds.js';\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS,\r\n    UI_TERMS,\r\n    formatButtonText,\r\n    formatStatLabel,\r\n    createCreditIndicator,\r\n    createMenuParticles,\r\n    createAnimatedTitle\r\n} from '../config/uiConfig.js';\r\nimport { createStatBar } from '../config/uiComponents.js';\r\n\r\n// Animation constants for character preview\r\nconst CHAR_ANIM = {\r\n    BREATHE_SPEED: 1.5,\r\n    BREATHE_AMOUNT: 0.04,\r\n    BOB_SPEED: 2,\r\n    BOB_AMOUNT: 3,\r\n    GLOW_PULSE_SPEED: 2,\r\n    GLOW_MIN: 0.3,\r\n    GLOW_MAX: 0.7\r\n};\r\n\r\n// Helper function to get unlock requirement text\r\nfunction getUnlockText(char) {\r\n    if (!char.unlockRequirement) return null;\r\n\r\n    if (char.unlockRequirement.type === 'floor') {\r\n        return `Unlock: Complete ${UI_TERMS.FLOOR} ${char.unlockRequirement.value}`;\r\n    } else if (char.unlockRequirement.type === 'achievement') {\r\n        const achievement = ACHIEVEMENTS[char.unlockRequirement.value];\r\n        if (achievement) {\r\n            return `Unlock: ${achievement.name}`;\r\n        }\r\n        return `Unlock: Achievement required`;\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function setupCharacterSelectScene(k) {\r\n    k.scene('characterSelect', () => {\r\n        const currency = getCurrency();\r\n        const currencyName = getCurrencyName();\r\n        const selectedChar = getSelectedCharacter();\r\n        \r\n        // Background\r\n        k.add([\r\n            k.rect(k.width(), k.height()),\r\n            k.pos(0, 0),\r\n            k.anchor('topleft'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.BACKGROUND)\r\n        ]);\r\n\r\n        // Background particle effects\r\n        createMenuParticles(k, { patternCount: 10, particleCount: 15 });\r\n\r\n        // Currency display (standardized)\r\n        const creditIndicator = createCreditIndicator(k, currency, currencyName);\r\n\r\n        // Title\r\n        createAnimatedTitle(k, 'CONTESTANTS', k.width() / 2, 60, 8);\r\n        \r\n        // Character selection layout: Left side = selection grid, Right side = details\r\n        const characterKeys = Object.keys(CHARACTER_UNLOCKS);\r\n        const leftPanelWidth = 360;\r\n        const rightPanelX = leftPanelWidth + 20;\r\n        const rightPanelWidth = k.width() - rightPanelX - 20;\r\n        const startY = 110;\r\n        // Custom smaller card size to fit more characters\r\n        const cardWidth = 165;\r\n        const cardHeight = 70;\r\n        const cardSpacing = 8;\r\n        const cardsPerRow = 2;\r\n        const rowsPerPage = 5;\r\n        const charactersPerPage = cardsPerRow * rowsPerPage;\r\n\r\n        // Helper to strip \"The \" prefix from names for display\r\n        const formatName = (name) => name.replace(/^The\\s+/i, '');\r\n\r\n        // Helper to render description with highlighted stats\r\n        // Returns array of text elements\r\n        const renderHighlightedDescription = (description, x, y, maxWidth) => {\r\n            const elements = [];\r\n            // Regex to match stat patterns like \"+10% XP\", \"-20% health\", \"+2 orbital\", etc.\r\n            const statPattern = /([+-]?\\d+%?\\s*(?:XP|health|HP|speed|damage|crit|dodge|reduction|lifesteal|blast radius|drones?|orbital))/gi;\r\n\r\n            // Split description by stat patterns\r\n            const parts = description.split(statPattern);\r\n            const matches = description.match(statPattern) || [];\r\n\r\n            // Build text segments\r\n            let currentText = '';\r\n            const segments = [];\r\n\r\n            let matchIndex = 0;\r\n            parts.forEach((part, i) => {\r\n                if (i % 2 === 0) {\r\n                    // Regular text\r\n                    if (part) segments.push({ text: part, highlight: false });\r\n                } else {\r\n                    // Stat text (matched pattern)\r\n                    segments.push({ text: part, highlight: true });\r\n                }\r\n            });\r\n\r\n            // Render as a single line with color markup using Kaplay's text formatting\r\n            // Since Kaplay doesn't support inline color changes easily, we'll render separate elements\r\n            // For simplicity, we'll render the full text in secondary color and overlay highlighted parts\r\n\r\n            // Full description in secondary color\r\n            const baseText = k.add([\r\n                k.text(description, { size: UI_TEXT_SIZES.SMALL, width: maxWidth }),\r\n                k.pos(x, y),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            elements.push(baseText);\r\n\r\n            // Create highlighted overlay for stat values\r\n            // We need to extract positions - this is complex, so let's use a simpler approach:\r\n            // Re-render just the highlighted parts in a brighter color on top\r\n            // Since we can't get precise character positions, we'll use a different approach:\r\n            // Render the description with stat values in a highlight color (gold/yellow)\r\n\r\n            // Alternative approach: Use different formatting\r\n            // Actually, let's format the description by replacing stat values with colored versions\r\n            // Since we can't do inline colors, let's just make the whole description look different\r\n            // by adding a separate line for the key stat highlights\r\n\r\n            // Find all stat mentions and create a summary line\r\n            if (matches.length > 0) {\r\n                const statSummary = matches.join(' | ');\r\n                const highlightText = k.add([\r\n                    k.text(statSummary, { size: UI_TEXT_SIZES.TINY }),\r\n                    k.pos(x, y + 28),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.GOLD),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT + 1)\r\n                ]);\r\n                elements.push(highlightText);\r\n            }\r\n\r\n            return elements;\r\n        };\r\n\r\n        // Pagination state\r\n        const totalPages = Math.ceil(characterKeys.length / charactersPerPage);\r\n        let currentPage = 0;\r\n\r\n        // Find the page containing the selected character\r\n        const selectedIndex = characterKeys.indexOf(selectedChar || characterKeys[0]);\r\n        if (selectedIndex >= 0) {\r\n            currentPage = Math.floor(selectedIndex / charactersPerPage);\r\n        }\r\n\r\n        const characterCards = [];\r\n        const confirmedCharacterKey = selectedChar || characterKeys[0]; // The saved selection\r\n        let viewedCharacterKey = confirmedCharacterKey; // What's being viewed/previewed\r\n        let detailItems = [];\r\n        let paginationItems = [];\r\n        let isRefreshing = false; // Prevent infinite loops\r\n\r\n        // Function to refresh display\r\n        function refreshDisplay() {\r\n            if (isRefreshing) return; // Prevent recursive calls\r\n            isRefreshing = true;\r\n\r\n            // Clear existing cards\r\n            characterCards.forEach(card => {\r\n                if (card && card.exists && card.exists()) {\r\n                    k.destroy(card);\r\n                }\r\n            });\r\n            characterCards.length = 0;\r\n\r\n            // Clear detail items\r\n            detailItems.forEach(item => {\r\n                if (item && item.exists && item.exists()) {\r\n                    k.destroy(item);\r\n                }\r\n            });\r\n            detailItems = [];\r\n\r\n            // Clear pagination items\r\n            paginationItems.forEach(item => {\r\n                if (item && item.exists && item.exists()) {\r\n                    k.destroy(item);\r\n                }\r\n            });\r\n            paginationItems = [];\r\n\r\n            // Get characters for current page\r\n            const pageStart = currentPage * charactersPerPage;\r\n            const pageEnd = Math.min(pageStart + charactersPerPage, characterKeys.length);\r\n            const pageCharacters = characterKeys.slice(pageStart, pageEnd);\r\n\r\n            // Render character selection grid (left side)\r\n            pageCharacters.forEach((key, pageIndex) => {\r\n                const char = CHARACTER_UNLOCKS[key];\r\n                const isUnlockedChar = isUnlocked('characters', key) || char.unlockedByDefault;\r\n                const isViewed = viewedCharacterKey === key;\r\n                const isConfirmedSelection = confirmedCharacterKey === key;\r\n\r\n                const row = Math.floor(pageIndex / cardsPerRow);\r\n                const col = pageIndex % cardsPerRow;\r\n                const cardX = 20 + col * (cardWidth + cardSpacing);\r\n                const cardY = startY + row * (cardHeight + cardSpacing);\r\n\r\n                // Card background\r\n                const cardBg = k.add([\r\n                    k.rect(cardWidth, cardHeight),\r\n                    k.pos(cardX, cardY),\r\n                    k.anchor('topleft'),\r\n                    k.color(...(isViewed ? UI_COLORS.BG_MEDIUM : UI_COLORS.BG_DARK)),\r\n                    k.outline(2, isViewed ? k.rgb(...UI_COLORS.BORDER_ACTIVE) : (isUnlockedChar ? k.rgb(...UI_COLORS.TEXT_DISABLED) : k.rgb(...UI_COLORS.BG_DARK))),\r\n                    k.area(),\r\n                    k.fixed(),\r\n                    k.scale(1),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS),\r\n                    {\r\n                        baseX: cardX,\r\n                        baseY: cardY,\r\n                        isHovered: false\r\n                    }\r\n                ]);\r\n\r\n                // Character visual\r\n                const charVisual = k.add([\r\n                    k.text(char.char, { size: UI_TEXT_SIZES.HEADER }),\r\n                    k.pos(cardX + 28, cardY + cardHeight / 2),\r\n                    k.anchor('center'),\r\n                    k.color(...(isUnlockedChar ? char.color : UI_COLORS.BG_DISABLED)),\r\n                    k.fixed(),\r\n                    k.scale(1),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT),\r\n                    {\r\n                        baseX: cardX + 28,\r\n                        baseY: cardY + cardHeight / 2\r\n                    }\r\n                ]);\r\n\r\n                // Character name (stripped of \"The \" prefix)\r\n                const nameText = k.add([\r\n                    k.text(formatName(char.name), { size: UI_TEXT_SIZES.SMALL }),\r\n                    k.pos(cardX + 60, cardY + cardHeight / 2),\r\n                    k.anchor('left'),\r\n                    k.color(...(isUnlockedChar ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_DISABLED)),\r\n                    k.fixed(),\r\n                    k.scale(1),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT),\r\n                    {\r\n                        baseX: cardX + 60,\r\n                        baseY: cardY + cardHeight / 2\r\n                    }\r\n                ]);\r\n\r\n                // Hover effects for cards\r\n                cardBg.onHoverUpdate(() => {\r\n                    if (!cardBg.isHovered && !isViewed) {\r\n                        cardBg.isHovered = true;\r\n                        playMenuNav();\r\n                    }\r\n                    if (!isViewed) {\r\n                        // Scale up slightly and brighten\r\n                        cardBg.scale = k.vec2(1.05, 1.05);\r\n                        charVisual.scale = k.vec2(1.15, 1.15);\r\n                        nameText.scale = k.vec2(1.05, 1.05);\r\n                        cardBg.color = k.rgb(50, 50, 65);\r\n                        // Add slight bounce to character\r\n                        const bounce = Math.sin(k.time() * 8) * 2;\r\n                        charVisual.pos.y = charVisual.baseY + bounce;\r\n                    }\r\n                });\r\n\r\n                cardBg.onHoverEnd(() => {\r\n                    cardBg.isHovered = false;\r\n                    cardBg.scale = k.vec2(1, 1);\r\n                    charVisual.scale = k.vec2(1, 1);\r\n                    nameText.scale = k.vec2(1, 1);\r\n                    cardBg.color = k.rgb(...(isViewed ? UI_COLORS.BG_MEDIUM : UI_COLORS.BG_DARK));\r\n                    charVisual.pos.y = charVisual.baseY;\r\n                });\r\n\r\n                // Locked overlay\r\n                if (!isUnlockedChar) {\r\n                    const lockText = k.add([\r\n                        k.text('', { size: UI_TEXT_SIZES.SMALL }),\r\n                        k.pos(cardX + cardWidth - 18, cardY + cardHeight / 2),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.DANGER),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.OVERLAY)\r\n                    ]);\r\n                    characterCards.push(lockText);\r\n                }\r\n\r\n                // Current selection indicator (checkmark badge)\r\n                if (isConfirmedSelection) {\r\n                    const checkBadge = k.add([\r\n                        k.circle(8),\r\n                        k.pos(cardX + cardWidth - 10, cardY + 12),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.SUCCESS),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT + 1)\r\n                    ]);\r\n                    const checkMark = k.add([\r\n                        k.text('', { size: 10 }),\r\n                        k.pos(cardX + cardWidth - 10, cardY + 12),\r\n                        k.anchor('center'),\r\n                        k.color(255, 255, 255),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT + 2)\r\n                    ]);\r\n                    characterCards.push(checkBadge, checkMark);\r\n                }\r\n\r\n                // Click handler - all cards are clickable for viewing\r\n                cardBg.onClick(() => {\r\n                    if (viewedCharacterKey !== key) {\r\n                        playMenuSelect();\r\n                        viewedCharacterKey = key;\r\n                        refreshDisplay();\r\n                    }\r\n                });\r\n                cardBg.cursor = 'pointer';\r\n\r\n                characterCards.push(cardBg, charVisual, nameText);\r\n            });\r\n\r\n            // Pagination controls (only show if more than one page)\r\n            if (totalPages > 1) {\r\n                const paginationY = startY + rowsPerPage * (cardHeight + cardSpacing) + 15;\r\n                const paginationCenterX = leftPanelWidth / 2;\r\n\r\n                // Page indicator pips\r\n                const pipSpacing = 20;\r\n                const pipsStartX = paginationCenterX - ((totalPages - 1) * pipSpacing) / 2;\r\n                const pipsEndX = paginationCenterX + ((totalPages - 1) * pipSpacing) / 2;\r\n\r\n                // Arrows positioned outside the pips with offset for pip clickable area (16px) + gap\r\n                const arrowOffset = 25;\r\n                const leftArrowX = pipsStartX - arrowOffset;\r\n                const rightArrowX = pipsEndX + arrowOffset;\r\n\r\n                for (let i = 0; i < totalPages; i++) {\r\n                    const isCurrentPage = i === currentPage;\r\n                    const pipX = pipsStartX + i * pipSpacing;\r\n\r\n                    const pipBg = k.add([\r\n                        k.rect(16, 16),\r\n                        k.pos(pipX, paginationY),\r\n                        k.anchor('center'),\r\n                        k.color(0, 0, 0),\r\n                        k.opacity(0),\r\n                        k.area({ width: 16, height: 16 }),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                    ]);\r\n\r\n                    const pipText = k.add([\r\n                        k.text(isCurrentPage ? '' : '', { size: 14 }),\r\n                        k.pos(pipX, paginationY),\r\n                        k.anchor('center'),\r\n                        k.color(isCurrentPage ? 255 : 120, isCurrentPage ? 255 : 120, isCurrentPage ? 255 : 120),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n\r\n                    const pageIndex = i;\r\n                    pipBg.onClick(() => {\r\n                        if (pageIndex !== currentPage) {\r\n                            playMenuNav();\r\n                            currentPage = pageIndex;\r\n                            refreshDisplay();\r\n                        }\r\n                    });\r\n                    pipBg.cursor = 'pointer';\r\n\r\n                    paginationItems.push(pipBg, pipText);\r\n                }\r\n\r\n                // Left arrow (higher z-index to sit on top and take priority)\r\n                const leftArrowBg = k.add([\r\n                    k.rect(30, 30),\r\n                    k.pos(leftArrowX, paginationY),\r\n                    k.anchor('center'),\r\n                    k.color(0, 0, 0),\r\n                    k.opacity(0),\r\n                    k.area({ width: 30, height: 30 }),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\r\n                ]);\r\n\r\n                const leftArrowText = k.add([\r\n                    k.text('<', { size: 24 }),\r\n                    k.pos(leftArrowX, paginationY),\r\n                    k.anchor('center'),\r\n                    k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT + 1)\r\n                ]);\r\n\r\n                if (currentPage > 0) {\r\n                    leftArrowBg.onClick(() => {\r\n                        playMenuNav();\r\n                        currentPage--;\r\n                        refreshDisplay();\r\n                    });\r\n                    leftArrowBg.cursor = 'pointer';\r\n                }\r\n                paginationItems.push(leftArrowBg, leftArrowText);\r\n\r\n                // Right arrow (higher z-index to sit on top and take priority)\r\n                const rightArrowBg = k.add([\r\n                    k.rect(30, 30),\r\n                    k.pos(rightArrowX, paginationY),\r\n                    k.anchor('center'),\r\n                    k.color(0, 0, 0),\r\n                    k.opacity(0),\r\n                    k.area({ width: 30, height: 30 }),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\r\n                ]);\r\n\r\n                const rightArrowText = k.add([\r\n                    k.text('>', { size: 24 }),\r\n                    k.pos(rightArrowX, paginationY),\r\n                    k.anchor('center'),\r\n                    k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT + 1)\r\n                ]);\r\n\r\n                if (currentPage < totalPages - 1) {\r\n                    rightArrowBg.onClick(() => {\r\n                        playMenuNav();\r\n                        currentPage++;\r\n                        refreshDisplay();\r\n                    });\r\n                    rightArrowBg.cursor = 'pointer';\r\n                }\r\n                paginationItems.push(rightArrowBg, rightArrowText);\r\n            }\r\n            \r\n            // Render character details (right side)\r\n            const viewedChar = CHARACTER_UNLOCKS[viewedCharacterKey];\r\n            const isViewedUnlocked = isUnlocked('characters', viewedCharacterKey) || viewedChar.unlockedByDefault;\r\n            let detailY = startY;\r\n\r\n            // Preview panel background for clarity\r\n            const previewPanelBg = k.add([\r\n                k.rect(rightPanelWidth - 10, 380),\r\n                k.pos(rightPanelX + 5, startY - 10),\r\n                k.anchor('topleft'),\r\n                k.color(25, 25, 35),\r\n                k.outline(2, k.rgb(60, 60, 80)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS - 1)\r\n            ]);\r\n            detailItems.push(previewPanelBg);\r\n\r\n            // Glow effect behind character (pulses)\r\n            const charGlow = k.add([\r\n                k.circle(50),\r\n                k.pos(rightPanelX + rightPanelWidth / 2, detailY + 45),\r\n                k.anchor('center'),\r\n                k.color(...(isViewedUnlocked ? viewedChar.color : [80, 80, 80])),\r\n                k.opacity(CHAR_ANIM.GLOW_MIN),\r\n                k.scale(1),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n            detailItems.push(charGlow);\r\n\r\n            // Character visual (large) with animation reference\r\n            const detailVisual = k.add([\r\n                k.text(viewedChar.char, { size: 72 }),\r\n                k.pos(rightPanelX + rightPanelWidth / 2, detailY + 45),\r\n                k.anchor('center'),\r\n                k.color(...(isViewedUnlocked ? viewedChar.color : UI_COLORS.BG_DISABLED)),\r\n                k.fixed(),\r\n                k.scale(1),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS + 1),\r\n                {\r\n                    baseY: detailY + 45,\r\n                    baseScale: 1,\r\n                    animTime: Math.random() * Math.PI * 2 // Random start phase\r\n                }\r\n            ]);\r\n            detailItems.push(detailVisual);\r\n\r\n            // Animate the character and glow\r\n            const animLoop = k.onUpdate(() => {\r\n                if (!detailVisual.exists()) return;\r\n\r\n                detailVisual.animTime += k.dt();\r\n\r\n                // Breathing effect (scale)\r\n                const breathe = 1 + Math.sin(detailVisual.animTime * CHAR_ANIM.BREATHE_SPEED) * CHAR_ANIM.BREATHE_AMOUNT;\r\n                detailVisual.scale = k.vec2(breathe, breathe);\r\n\r\n                // Bobbing effect (position)\r\n                const bob = Math.sin(detailVisual.animTime * CHAR_ANIM.BOB_SPEED) * CHAR_ANIM.BOB_AMOUNT;\r\n                detailVisual.pos.y = detailVisual.baseY + bob;\r\n\r\n                // Glow pulse\r\n                if (charGlow.exists()) {\r\n                    const glowIntensity = CHAR_ANIM.GLOW_MIN +\r\n                        (Math.sin(detailVisual.animTime * CHAR_ANIM.GLOW_PULSE_SPEED) * 0.5 + 0.5) *\r\n                        (CHAR_ANIM.GLOW_MAX - CHAR_ANIM.GLOW_MIN);\r\n                    charGlow.opacity = glowIntensity;\r\n                    charGlow.scale = k.vec2(1 + glowIntensity * 0.3, 1 + glowIntensity * 0.3);\r\n                }\r\n            });\r\n            detailItems.push({ exists: () => true, destroy: () => animLoop.cancel() });\r\n\r\n            detailY += 110;\r\n\r\n            // Character name (stripped of \"The \" prefix)\r\n            const detailName = k.add([\r\n                k.text(formatName(viewedChar.name), { size: UI_TEXT_SIZES.HEADER }),\r\n                k.pos(rightPanelX + rightPanelWidth / 2, detailY),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            detailItems.push(detailName);\r\n            detailY += 35;\r\n\r\n            // Description with highlighted stats\r\n            const descElements = renderHighlightedDescription(\r\n                viewedChar.description,\r\n                rightPanelX + rightPanelWidth / 2,\r\n                detailY,\r\n                rightPanelWidth - 40\r\n            );\r\n            detailItems.push(...descElements);\r\n            detailY += 55;\r\n\r\n            // Stats with visual bars\r\n            const statsLabel = k.add([\r\n                k.text('Stats:', { size: UI_TEXT_SIZES.LABEL }),\r\n                k.pos(rightPanelX + 20, detailY),\r\n                k.anchor('left'),\r\n                k.color(...UI_COLORS.WARNING),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            detailItems.push(statsLabel);\r\n            detailY += 28;\r\n\r\n            // Stat bar constants\r\n            const statBarWidth = 100;\r\n            const statBarX = rightPanelX + 40;\r\n            const statRowHeight = 24;\r\n\r\n            // Health stat bar (max 175 - characters range 60-150)\r\n            const healthBar = createStatBar(k, {\r\n                label: UI_TERMS.HEALTH,\r\n                value: viewedChar.stats.health,\r\n                maxValue: 175,\r\n                x: statBarX,\r\n                y: detailY,\r\n                width: statBarWidth,\r\n                usePercentageColor: true\r\n            });\r\n            detailItems.push(...healthBar.elements);\r\n            detailY += statRowHeight;\r\n\r\n            // Speed stat bar (max 225 - characters range 100-200)\r\n            const speedBar = createStatBar(k, {\r\n                label: UI_TERMS.SPEED,\r\n                value: viewedChar.stats.speed,\r\n                maxValue: 225,\r\n                x: statBarX,\r\n                y: detailY,\r\n                width: statBarWidth,\r\n                usePercentageColor: true\r\n            });\r\n            detailItems.push(...speedBar.elements);\r\n            detailY += statRowHeight;\r\n\r\n            // Damage stat bar (max 25 - characters range 8-20)\r\n            const damageBar = createStatBar(k, {\r\n                label: UI_TERMS.DAMAGE,\r\n                value: viewedChar.stats.damage,\r\n                maxValue: 25,\r\n                x: statBarX,\r\n                y: detailY,\r\n                width: statBarWidth,\r\n                usePercentageColor: true\r\n            });\r\n            detailItems.push(...damageBar.elements);\r\n            detailY += 30;\r\n\r\n            // Currently selected indicator (show if viewing the confirmed selection)\r\n            if (viewedCharacterKey === confirmedCharacterKey) {\r\n                const selectedIndicator = k.add([\r\n                    k.text(' CURRENT SELECTION', { size: UI_TEXT_SIZES.LABEL }),\r\n                    k.pos(rightPanelX + rightPanelWidth / 2, detailY),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.SUCCESS),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n                detailItems.push(selectedIndicator);\r\n            }\r\n\r\n            // Locked info\r\n            if (!isViewedUnlocked) {\r\n                const unlockTextStr = getUnlockText(viewedChar);\r\n                if (unlockTextStr) {\r\n                    const unlockText = k.add([\r\n                        k.text(unlockTextStr, { size: UI_TEXT_SIZES.SMALL, width: rightPanelWidth - 40 }),\r\n                        k.pos(rightPanelX + rightPanelWidth / 2, detailY + 30),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.GOLD),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    detailItems.push(unlockText);\r\n                }\r\n            }\r\n            \r\n            isRefreshing = false;\r\n        }\r\n        \r\n        // Initial display\r\n        refreshDisplay();\r\n\r\n        // Keyboard pagination\r\n        k.onKeyPress('arrowleft', () => {\r\n            if (currentPage > 0) {\r\n                playMenuNav();\r\n                currentPage--;\r\n                refreshDisplay();\r\n            }\r\n        });\r\n\r\n        k.onKeyPress('arrowright', () => {\r\n            if (currentPage < totalPages - 1) {\r\n                playMenuNav();\r\n                currentPage++;\r\n                refreshDisplay();\r\n            }\r\n        });\r\n\r\n        // Cancel button (left side)\r\n        const cancelButton = k.add([\r\n            k.rect(120, 35),\r\n            k.pos(k.width() / 2 - 70, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.NEUTRAL),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n\r\n        k.add([\r\n            k.text(formatButtonText('Cancel'), { size: UI_TEXT_SIZES.BODY }),\r\n            k.pos(k.width() / 2 - 70, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        cancelButton.onClick(() => {\r\n            playMenuNav();\r\n            k.go('menu');\r\n        });\r\n\r\n        // Confirm button (right side) - track for enabling/disabling\r\n        let confirmButton = null;\r\n        let confirmText = null;\r\n        let confirmButtonItems = [];\r\n\r\n        function updateConfirmButton() {\r\n            // Clean up old button\r\n            confirmButtonItems.forEach(item => {\r\n                if (item && item.exists && item.exists()) {\r\n                    k.destroy(item);\r\n                }\r\n            });\r\n            confirmButtonItems = [];\r\n\r\n            const viewedChar = CHARACTER_UNLOCKS[viewedCharacterKey];\r\n            const isViewedUnlocked = isUnlocked('characters', viewedCharacterKey) || viewedChar.unlockedByDefault;\r\n\r\n            confirmButton = k.add([\r\n                k.rect(120, 35),\r\n                k.pos(k.width() / 2 + 70, k.height() - 40),\r\n                k.anchor('center'),\r\n                k.color(...(isViewedUnlocked ? UI_COLORS.SUCCESS : UI_COLORS.BG_DISABLED)),\r\n                k.outline(2, k.rgb(...(isViewedUnlocked ? UI_COLORS.BORDER : UI_COLORS.BG_DARK))),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n            confirmButtonItems.push(confirmButton);\r\n\r\n            confirmText = k.add([\r\n                k.text(formatButtonText('Confirm'), { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(k.width() / 2 + 70, k.height() - 40),\r\n                k.anchor('center'),\r\n                k.color(...(isViewedUnlocked ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_DISABLED)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            confirmButtonItems.push(confirmText);\r\n\r\n            if (isViewedUnlocked) {\r\n                confirmButton.onClick(() => {\r\n                    playMenuSelect();\r\n                    setSelectedCharacter(viewedCharacterKey);\r\n                    broadcastCharacterChange(viewedCharacterKey);\r\n                    k.go('menu');\r\n                });\r\n                confirmButton.cursor = 'pointer';\r\n            }\r\n        }\r\n\r\n        // Initial confirm button render\r\n        updateConfirmButton();\r\n\r\n        // Wrap refreshDisplay to also update confirm button\r\n        const originalRefreshDisplay = refreshDisplay;\r\n        refreshDisplay = function() {\r\n            originalRefreshDisplay();\r\n            updateConfirmButton();\r\n        };\r\n\r\n\r\n        // Controls\r\n        k.onKeyPress('escape', () => {\r\n            playMenuNav();\r\n            k.go('menu');\r\n        });\r\n\r\n        k.onKeyPress('enter', () => {\r\n            const viewedChar = CHARACTER_UNLOCKS[viewedCharacterKey];\r\n            const isViewedUnlocked = isUnlocked('characters', viewedCharacterKey) || viewedChar.unlockedByDefault;\r\n            if (isViewedUnlocked) {\r\n                playMenuSelect();\r\n                setSelectedCharacter(viewedCharacterKey);\r\n                broadcastCharacterChange(viewedCharacterKey);\r\n                k.go('menu');\r\n            }\r\n        });\r\n    });\r\n}\r\n","import { isValidInviteCode } from '../systems/nameGenerator.js';\r\nimport { joinPartyAsClient, restoreLocalPlayerToSoloParty, getPlayerName, getInviteCode, getSelectedCharacter } from '../systems/partySystem.js';\r\nimport { playMenuNav, playMenuSelect } from '../systems/sounds.js';\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS\r\n} from '../config/uiConfig.js';\r\n\r\n/**\r\n * Join Party Scene\r\n * Dedicated scene for entering a party invite code\r\n */\r\nexport function initJoinPartyScene(k) {\r\n    k.scene('joinParty', () => {\r\n        // Save original party state before any join attempt\r\n        const originalState = {\r\n            name: getPlayerName(),\r\n            inviteCode: getInviteCode(),\r\n            character: getSelectedCharacter()\r\n        };\r\n        let joinCancelled = false;\r\n\r\n        // Background\r\n        k.add([\r\n            k.rect(k.width(), k.height()),\r\n            k.pos(0, 0),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.fixed(),\r\n            k.z(0)\r\n        ]);\r\n\r\n        // Title\r\n        k.add([\r\n            k.text('Join Party', { size: UI_TEXT_SIZES.TITLE }),\r\n            k.pos(k.width() / 2, 100),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(10)\r\n        ]);\r\n\r\n        // Instruction\r\n        k.add([\r\n            k.text('Enter 6-digit invite code:', { size: UI_TEXT_SIZES.LABEL }),\r\n            k.pos(k.width() / 2, 180),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(10)\r\n        ]);\r\n\r\n        // Input display\r\n        let inputCode = '';\r\n        const inputDisplay = k.add([\r\n            k.text('______', { size: UI_TEXT_SIZES.TITLE * 1.5 }),\r\n            k.pos(k.width() / 2, 280),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.GOLD),\r\n            k.fixed(),\r\n            k.z(10)\r\n        ]);\r\n\r\n        // Error/Status message\r\n        const errorMsg = k.add([\r\n            k.text('', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2, 360),\r\n            k.anchor('center'),\r\n            k.color(255, 100, 100),\r\n            k.fixed(),\r\n            k.z(10)\r\n        ]);\r\n\r\n        // Instructions text\r\n        k.add([\r\n            k.text('Press ESC or click Cancel to go back', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(k.width() / 2, k.height() - 100),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_DISABLED),\r\n            k.fixed(),\r\n            k.z(10)\r\n        ]);\r\n\r\n        let isJoining = false;\r\n\r\n        // Update display\r\n        function updateDisplay() {\r\n            let display = '';\r\n            for (let i = 0; i < 6; i++) {\r\n                if (i < inputCode.length) {\r\n                    display += inputCode[i];\r\n                } else {\r\n                    display += '_';\r\n                }\r\n            }\r\n            inputDisplay.text = display;\r\n        }\r\n\r\n        // Character input handler\r\n        k.onCharInput((ch) => {\r\n            if (isJoining) return;\r\n\r\n            // Only accept alphanumeric characters\r\n            if (/[a-zA-Z0-9]/.test(ch) && inputCode.length < 6) {\r\n                playMenuNav();\r\n                inputCode += ch.toUpperCase();\r\n                updateDisplay();\r\n                errorMsg.text = '';\r\n\r\n                // Auto-submit when 6 characters entered\r\n                if (inputCode.length === 6) {\r\n                    k.wait(0.2, attemptJoin);\r\n                }\r\n            }\r\n        });\r\n\r\n        // Backspace handler\r\n        k.onKeyPress('backspace', () => {\r\n            if (isJoining) return;\r\n\r\n            if (inputCode.length > 0) {\r\n                playMenuNav();\r\n                inputCode = inputCode.slice(0, -1);\r\n                updateDisplay();\r\n                errorMsg.text = '';\r\n            }\r\n        });\r\n\r\n        // Escape key to cancel (works even during join attempt)\r\n        k.onKeyPress('escape', () => {\r\n            playMenuNav();\r\n            joinCancelled = true;\r\n            isJoining = false;\r\n            // Restore original party state\r\n            restoreLocalPlayerToSoloParty(originalState);\r\n            k.go('menu');\r\n        });\r\n\r\n        // Enter key to submit\r\n        k.onKeyPress('enter', () => {\r\n            if (isJoining) return;\r\n            if (inputCode.length === 6) {\r\n                attemptJoin();\r\n            }\r\n        });\r\n\r\n        // Attempt to join party\r\n        async function attemptJoin() {\r\n            if (isJoining) return;\r\n\r\n            const code = inputCode.trim();\r\n\r\n            if (!isValidInviteCode(code)) {\r\n                errorMsg.text = 'Invalid invite code format';\r\n                errorMsg.color = k.rgb(255, 100, 100);\r\n                return;\r\n            }\r\n\r\n            isJoining = true;\r\n            errorMsg.text = 'Joining party...';\r\n            errorMsg.color = k.rgb(...UI_COLORS.GOLD);\r\n\r\n            try {\r\n                const success = await joinPartyAsClient(code);\r\n\r\n                if (success) {\r\n                    // Check if join was cancelled while waiting\r\n                    if (joinCancelled) {\r\n                        return;\r\n                    }\r\n                    playMenuSelect();\r\n                    errorMsg.text = 'Successfully joined party!';\r\n                    errorMsg.color = k.rgb(...UI_COLORS.SUCCESS);\r\n\r\n                    // Wait a moment then go to menu (now in party)\r\n                    k.wait(1, () => {\r\n                        if (!joinCancelled) {\r\n                            k.go('menu');\r\n                        }\r\n                    });\r\n                } else {\r\n                    isJoining = false;\r\n                    errorMsg.text = 'Failed to join party. Check the code and try again.';\r\n                    errorMsg.color = k.rgb(255, 100, 100);\r\n                    inputCode = '';\r\n                    updateDisplay();\r\n                }\r\n            } catch (error) {\r\n                isJoining = false;\r\n                console.error('[JoinParty] Error joining party:', error);\r\n                errorMsg.text = 'Connection error. Please try again.';\r\n                errorMsg.color = k.rgb(255, 100, 100);\r\n                inputCode = '';\r\n                updateDisplay();\r\n            }\r\n        }\r\n\r\n        // Cancel button (MD size - secondary action)\r\n        const { MD } = UI_SIZES.BUTTON;\r\n        const cancelButton = k.add([\r\n            k.rect(MD.width, MD.height),\r\n            k.pos(k.width() / 2, k.height() - 180),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.NEUTRAL),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(10)\r\n        ]);\r\n\r\n        const cancelText = k.add([\r\n            k.text('CANCEL', { size: UI_TEXT_SIZES.BODY }),\r\n            k.pos(k.width() / 2, k.height() - 180),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(11)\r\n        ]);\r\n\r\n        cancelButton.onClick(() => {\r\n            playMenuNav();\r\n            joinCancelled = true;\r\n            isJoining = false;\r\n            // Restore original party state\r\n            restoreLocalPlayerToSoloParty(originalState);\r\n            k.go('menu');\r\n        });\r\n\r\n        cancelButton.onHoverUpdate(() => {\r\n            if (!isJoining) {\r\n                cancelButton.color = k.rgb(...UI_COLORS.NEUTRAL_HOVER);\r\n            }\r\n        });\r\n\r\n        cancelButton.onHoverEnd(() => {\r\n            cancelButton.color = k.rgb(...UI_COLORS.NEUTRAL);\r\n        });\r\n    });\r\n}\r\n","/**\r\n * Leaderboards Scene\r\n *\r\n * Displays leaderboard data with four tabs:\r\n * - Daily: Today's daily run leaderboard\r\n * - All-Time: Top scores ever\r\n * - Personal Bests: Best per character\r\n * - Global: Online global leaderboard (Dreamlo API)\r\n */\r\n\r\nimport {\r\n    getDailyLeaderboard,\r\n    getAllTimeLeaderboard,\r\n    getPersonalBests,\r\n    formatScore,\r\n    formatTime\r\n} from '../systems/leaderboards.js';\r\nimport { getOnlineLeaderboard } from '../systems/onlineLeaderboards.js';\r\nimport { getPlayerName } from '../systems/metaProgression.js';\r\nimport { getTodayDateString, getDailyCharacter } from '../systems/dailyRuns.js';\r\nimport { CHARACTER_UNLOCKS } from '../data/unlocks.js';\r\nimport { playMenuSelect, playMenuNav } from '../systems/sounds.js';\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS\r\n} from '../config/uiConfig.js';\r\n\r\n// Tab types\r\nconst TABS = {\r\n    DAILY: 'daily',\r\n    ALL_TIME: 'allTime',\r\n    PERSONAL: 'personal',\r\n    GLOBAL: 'global'\r\n};\r\n\r\nexport function setupLeaderboardsScene(k) {\r\n    k.scene('leaderboards', (args = {}) => {\r\n        const initialTab = args.tab || TABS.DAILY;\r\n        let currentTab = initialTab;\r\n\r\n        // Pagination settings\r\n        const ENTRIES_PER_PAGE = 10;\r\n        const CHARACTERS_PER_PAGE = 5;\r\n        let currentPage = 0; // Used for DAILY, ALL-TIME, and PERSONAL tabs\r\n\r\n        // Background\r\n        k.add([\r\n            k.rect(k.width(), k.height()),\r\n            k.pos(0, 0),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.z(UI_Z_LAYERS.BACKGROUND)\r\n        ]);\r\n\r\n        // Title\r\n        k.add([\r\n            k.text('LEADERBOARDS', { size: UI_TEXT_SIZES.TITLE }),\r\n            k.pos(k.width() / 2, 50),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Tab container\r\n        const tabY = 100;\r\n        const tabWidth = 115;\r\n        const tabSpacing = 8;\r\n        const totalTabWidth = (tabWidth * 4) + (tabSpacing * 3);\r\n        const startX = (k.width() - totalTabWidth) / 2;\r\n\r\n        // Content container\r\n        const contentY = 160;\r\n\r\n        // Content elements (will be destroyed and recreated on tab change)\r\n        let contentElements = [];\r\n\r\n        // Create tab button\r\n        function createTab(text, tabType, x) {\r\n            const isActive = currentTab === tabType;\r\n            const bg = k.add([\r\n                k.rect(tabWidth, 40),\r\n                k.pos(x, tabY),\r\n                k.anchor('center'),\r\n                k.color(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM)),\r\n                k.outline(2, k.rgb(...(isActive ? UI_COLORS.BORDER_HOVER : UI_COLORS.BORDER))),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS),\r\n                'tab'\r\n            ]);\r\n\r\n            const label = k.add([\r\n                k.text(text, { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(x, tabY),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT),\r\n                'tab'\r\n            ]);\r\n\r\n            bg.onClick(() => {\r\n                if (currentTab !== tabType) {\r\n                    playMenuNav();\r\n                    currentTab = tabType;\r\n                    currentPage = 0; // Reset pagination when switching tabs\r\n                    refreshTabs();\r\n                    renderContent();\r\n                }\r\n            });\r\n\r\n            bg.onHoverUpdate(() => {\r\n                if (currentTab !== tabType) {\r\n                    bg.color = k.rgb(...UI_COLORS.BG_LIGHT);\r\n                }\r\n            });\r\n\r\n            bg.onHoverEnd(() => {\r\n                if (currentTab !== tabType) {\r\n                    bg.color = k.rgb(...UI_COLORS.BG_MEDIUM);\r\n                }\r\n            });\r\n\r\n            return { bg, label, tabType };\r\n        }\r\n\r\n        // Create tabs\r\n        let tabs = [];\r\n        function refreshTabs() {\r\n            // Destroy old tabs\r\n            k.get('tab').forEach(t => k.destroy(t));\r\n            tabs = [];\r\n\r\n            const tab1 = createTab('DAILY', TABS.DAILY, startX + tabWidth / 2);\r\n            const tab2 = createTab('ALL-TIME', TABS.ALL_TIME, startX + tabWidth + tabSpacing + tabWidth / 2);\r\n            const tab3 = createTab('PERSONAL', TABS.PERSONAL, startX + (tabWidth + tabSpacing) * 2 + tabWidth / 2);\r\n            const tab4 = createTab('GLOBAL', TABS.GLOBAL, startX + (tabWidth + tabSpacing) * 3 + tabWidth / 2);\r\n\r\n            tabs = [tab1, tab2, tab3, tab4];\r\n        }\r\n\r\n        // Render content based on current tab\r\n        function renderContent() {\r\n            // Clear previous content\r\n            contentElements.forEach(el => {\r\n                if (el.exists()) k.destroy(el);\r\n            });\r\n            contentElements = [];\r\n\r\n            switch (currentTab) {\r\n                case TABS.DAILY:\r\n                    renderDailyContent();\r\n                    break;\r\n                case TABS.ALL_TIME:\r\n                    renderAllTimeContent();\r\n                    break;\r\n                case TABS.PERSONAL:\r\n                    renderPersonalContent();\r\n                    break;\r\n                case TABS.GLOBAL:\r\n                    renderGlobalContent();\r\n                    break;\r\n            }\r\n        }\r\n\r\n        // Render daily leaderboard\r\n        function renderDailyContent() {\r\n            const today = getTodayDateString();\r\n            const dailyChar = getDailyCharacter(today);\r\n            const charData = CHARACTER_UNLOCKS[dailyChar] || CHARACTER_UNLOCKS.survivor;\r\n            const allEntries = getDailyLeaderboard(today, 100); // Get all entries\r\n            const playerName = getPlayerName() || 'Anonymous';\r\n\r\n            const totalPages = Math.ceil(allEntries.length / ENTRIES_PER_PAGE);\r\n            if (currentPage >= totalPages && totalPages > 0) currentPage = totalPages - 1;\r\n\r\n            const startIndex = currentPage * ENTRIES_PER_PAGE;\r\n            const entries = allEntries.slice(startIndex, startIndex + ENTRIES_PER_PAGE);\r\n\r\n            // Date and character info\r\n            const dateLabel = k.add([\r\n                k.text(`Date: ${today}`, { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(k.width() / 2 - 100, contentY),\r\n                k.anchor('left'),\r\n                k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            contentElements.push(dateLabel);\r\n\r\n            const charLabel = k.add([\r\n                k.text(`Character: ${charData.char} ${charData.name}`, { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(k.width() / 2 + 50, contentY),\r\n                k.anchor('left'),\r\n                k.color(...charData.color),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            contentElements.push(charLabel);\r\n\r\n            // Header row\r\n            const headerY = contentY + 40;\r\n            renderLeaderboardHeader(headerY);\r\n\r\n            // Entries\r\n            if (allEntries.length === 0) {\r\n                const noData = k.add([\r\n                    k.text('No entries yet. Be the first!', { size: UI_TEXT_SIZES.BODY }),\r\n                    k.pos(k.width() / 2, headerY + 60),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_DISABLED),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n                contentElements.push(noData);\r\n            } else {\r\n                entries.forEach((entry, index) => {\r\n                    const rowY = headerY + 40 + (index * 35);\r\n                    const isPlayer = entry.name.toLowerCase() === playerName.toLowerCase();\r\n                    const globalRank = startIndex + index + 1;\r\n                    renderLeaderboardRow(globalRank, entry, rowY, isPlayer);\r\n                });\r\n\r\n                // Pagination controls\r\n                if (totalPages > 1) {\r\n                    renderPaginationControls(headerY + 40 + (ENTRIES_PER_PAGE * 35) + 10, totalPages);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Render all-time leaderboard\r\n        function renderAllTimeContent() {\r\n            const allEntries = getAllTimeLeaderboard(100); // Get all entries\r\n            const playerName = getPlayerName() || 'Anonymous';\r\n\r\n            const totalPages = Math.ceil(allEntries.length / ENTRIES_PER_PAGE);\r\n            if (currentPage >= totalPages && totalPages > 0) currentPage = totalPages - 1;\r\n\r\n            const startIndex = currentPage * ENTRIES_PER_PAGE;\r\n            const entries = allEntries.slice(startIndex, startIndex + ENTRIES_PER_PAGE);\r\n\r\n            // Header row\r\n            const headerY = contentY + 10;\r\n            renderLeaderboardHeader(headerY);\r\n\r\n            // Entries\r\n            if (allEntries.length === 0) {\r\n                const noData = k.add([\r\n                    k.text('No entries yet. Play a game!', { size: UI_TEXT_SIZES.BODY }),\r\n                    k.pos(k.width() / 2, headerY + 60),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.TEXT_DISABLED),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n                contentElements.push(noData);\r\n            } else {\r\n                entries.forEach((entry, index) => {\r\n                    const rowY = headerY + 40 + (index * 35);\r\n                    const isPlayer = entry.name.toLowerCase() === playerName.toLowerCase();\r\n                    const globalRank = startIndex + index + 1;\r\n                    renderLeaderboardRow(globalRank, entry, rowY, isPlayer);\r\n                });\r\n\r\n                // Pagination controls\r\n                if (totalPages > 1) {\r\n                    renderPaginationControls(headerY + 40 + (ENTRIES_PER_PAGE * 35) + 10, totalPages);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Render personal bests\r\n        function renderPersonalContent() {\r\n            const personalBests = getPersonalBests();\r\n            const characters = Object.keys(CHARACTER_UNLOCKS);\r\n            const totalPages = Math.ceil(characters.length / CHARACTERS_PER_PAGE);\r\n\r\n            // Clamp page to valid range\r\n            if (currentPage >= totalPages) currentPage = Math.max(0, totalPages - 1);\r\n\r\n            // Get characters for current page\r\n            const startIndex = currentPage * CHARACTERS_PER_PAGE;\r\n            const pageCharacters = characters.slice(startIndex, startIndex + CHARACTERS_PER_PAGE);\r\n\r\n            // Header\r\n            const headerY = contentY + 10;\r\n            const headers = ['Character', 'Best Score', 'Best Floor', 'Best Time'];\r\n            const colPositions = [120, 280, 420, 540];\r\n\r\n            headers.forEach((header, i) => {\r\n                const headerText = k.add([\r\n                    k.text(header, { size: UI_TEXT_SIZES.SMALL }),\r\n                    k.pos(colPositions[i], headerY),\r\n                    k.anchor('left'),\r\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n                contentElements.push(headerText);\r\n            });\r\n\r\n            // Divider\r\n            const divider = k.add([\r\n                k.rect(500, 2),\r\n                k.pos(k.width() / 2, headerY + 20),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.BORDER),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n            contentElements.push(divider);\r\n\r\n            // Character rows (paginated)\r\n            pageCharacters.forEach((charKey, pageIndex) => {\r\n                const charData = CHARACTER_UNLOCKS[charKey];\r\n                const bests = personalBests[charKey];\r\n                const rowY = headerY + 45 + (pageIndex * 40);\r\n\r\n                // Character icon and name\r\n                const charIcon = k.add([\r\n                    k.text(`${charData.char} ${charData.name}`, { size: UI_TEXT_SIZES.BODY }),\r\n                    k.pos(colPositions[0], rowY),\r\n                    k.anchor('left'),\r\n                    k.color(...charData.color),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n                contentElements.push(charIcon);\r\n\r\n                if (bests) {\r\n                    // Best score\r\n                    const scoreText = k.add([\r\n                        k.text(formatScore(bests.bestScore), { size: UI_TEXT_SIZES.BODY }),\r\n                        k.pos(colPositions[1], rowY),\r\n                        k.anchor('left'),\r\n                        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    contentElements.push(scoreText);\r\n\r\n                    // Best floor\r\n                    const floorText = k.add([\r\n                        k.text(`Floor ${bests.bestFloor}`, { size: UI_TEXT_SIZES.BODY }),\r\n                        k.pos(colPositions[2], rowY),\r\n                        k.anchor('left'),\r\n                        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    contentElements.push(floorText);\r\n\r\n                    // Best time\r\n                    const timeText = k.add([\r\n                        k.text(formatTime(bests.bestTime), { size: UI_TEXT_SIZES.BODY }),\r\n                        k.pos(colPositions[3], rowY),\r\n                        k.anchor('left'),\r\n                        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    contentElements.push(timeText);\r\n                } else {\r\n                    // No data\r\n                    const noData = k.add([\r\n                        k.text('-- no data --', { size: UI_TEXT_SIZES.SMALL }),\r\n                        k.pos(colPositions[1], rowY),\r\n                        k.anchor('left'),\r\n                        k.color(...UI_COLORS.TEXT_DISABLED),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    contentElements.push(noData);\r\n                }\r\n            });\r\n\r\n            // Pagination controls\r\n            if (totalPages > 1) {\r\n                const paginationY = headerY + 45 + (CHARACTERS_PER_PAGE * 40) + 20;\r\n                renderPaginationControls(paginationY, totalPages);\r\n            }\r\n        }\r\n\r\n        // Render global leaderboard\r\n        function renderGlobalContent() {\r\n            const playerName = getPlayerName() || 'Anonymous';\r\n            const headerY = contentY + 10;\r\n\r\n            // Show loading state initially\r\n            const loadingText = k.add([\r\n                k.text('Connecting to global leaderboard...', { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(k.width() / 2, headerY + 100),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            contentElements.push(loadingText);\r\n\r\n            // Fetch global leaderboard\r\n            getOnlineLeaderboard(10).then(result => {\r\n                // Remove loading text\r\n                if (loadingText.exists()) {\r\n                    k.destroy(loadingText);\r\n                    const idx = contentElements.indexOf(loadingText);\r\n                    if (idx > -1) contentElements.splice(idx, 1);\r\n                }\r\n\r\n                // Check if we're still on the GLOBAL tab\r\n                if (currentTab !== TABS.GLOBAL) return;\r\n\r\n                if (result.error) {\r\n                    // Error state\r\n                    const errorText = k.add([\r\n                        k.text(result.error, { size: UI_TEXT_SIZES.BODY }),\r\n                        k.pos(k.width() / 2, headerY + 80),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.DANGER),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    contentElements.push(errorText);\r\n\r\n                    // Retry button\r\n                    const retryBg = k.add([\r\n                        k.rect(120, 35),\r\n                        k.pos(k.width() / 2, headerY + 130),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.SECONDARY),\r\n                        k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                        k.area(),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                    ]);\r\n                    contentElements.push(retryBg);\r\n\r\n                    const retryLabel = k.add([\r\n                        k.text('Try Again', { size: UI_TEXT_SIZES.SMALL }),\r\n                        k.pos(k.width() / 2, headerY + 130),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    contentElements.push(retryLabel);\r\n\r\n                    retryBg.onClick(() => {\r\n                        playMenuNav();\r\n                        renderContent();\r\n                    });\r\n\r\n                    retryBg.onHoverUpdate(() => {\r\n                        retryBg.color = k.rgb(...UI_COLORS.SECONDARY_HOVER);\r\n                    });\r\n\r\n                    retryBg.onHoverEnd(() => {\r\n                        retryBg.color = k.rgb(...UI_COLORS.SECONDARY);\r\n                    });\r\n\r\n                    return;\r\n                }\r\n\r\n                const entries = result.entries;\r\n\r\n                // Header row\r\n                renderLeaderboardHeader(headerY);\r\n\r\n                // Entries\r\n                if (entries.length === 0) {\r\n                    const noData = k.add([\r\n                        k.text('No global entries yet. Be the first!', { size: UI_TEXT_SIZES.BODY }),\r\n                        k.pos(k.width() / 2, headerY + 60),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.TEXT_DISABLED),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    contentElements.push(noData);\r\n                } else {\r\n                    entries.forEach((entry, index) => {\r\n                        const rowY = headerY + 40 + (index * 35);\r\n                        const isPlayer = entry.name.toLowerCase() === playerName.toLowerCase();\r\n                        renderLeaderboardRow(index + 1, entry, rowY, isPlayer);\r\n                    });\r\n                }\r\n\r\n                // Show total count at bottom\r\n                if (result.totalCount > 0) {\r\n                    const totalY = headerY + 40 + (Math.min(entries.length, 10) * 35) + 20;\r\n                    const totalText = k.add([\r\n                        k.text(`${result.totalCount} player${result.totalCount !== 1 ? 's' : ''} worldwide`, { size: UI_TEXT_SIZES.SMALL }),\r\n                        k.pos(k.width() / 2, totalY),\r\n                        k.anchor('center'),\r\n                        k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                        k.fixed(),\r\n                        k.z(UI_Z_LAYERS.UI_TEXT)\r\n                    ]);\r\n                    contentElements.push(totalText);\r\n                }\r\n            });\r\n        }\r\n\r\n        // Render pagination controls (reusable)\r\n        function renderPaginationControls(y, totalPages) {\r\n            const paginationCenterX = k.width() / 2;\r\n\r\n            // Page indicator pips\r\n            const pipSpacing = 20;\r\n            const pipsStartX = paginationCenterX - ((totalPages - 1) * pipSpacing) / 2;\r\n            const pipsEndX = paginationCenterX + ((totalPages - 1) * pipSpacing) / 2;\r\n\r\n            // Arrows positioned outside the pips with offset for pip clickable area (16px) + gap\r\n            const arrowOffset = 25;\r\n            const leftArrowX = pipsStartX - arrowOffset;\r\n            const rightArrowX = pipsEndX + arrowOffset;\r\n\r\n            for (let i = 0; i < totalPages; i++) {\r\n                const isCurrentPagePip = i === currentPage;\r\n                const pipX = pipsStartX + i * pipSpacing;\r\n\r\n                const pipBg = k.add([\r\n                    k.rect(16, 16),\r\n                    k.pos(pipX, y),\r\n                    k.anchor('center'),\r\n                    k.color(0, 0, 0),\r\n                    k.opacity(0),\r\n                    k.area({ width: 16, height: 16 }),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n                ]);\r\n\r\n                const pipText = k.add([\r\n                    k.text(isCurrentPagePip ? '' : '', { size: 14 }),\r\n                    k.pos(pipX, y),\r\n                    k.anchor('center'),\r\n                    k.color(isCurrentPagePip ? 255 : 120, isCurrentPagePip ? 255 : 120, isCurrentPagePip ? 255 : 120),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n\r\n                const pageIndex = i;\r\n                pipBg.onClick(() => {\r\n                    if (pageIndex !== currentPage) {\r\n                        playMenuNav();\r\n                        currentPage = pageIndex;\r\n                        renderContent();\r\n                    }\r\n                });\r\n                pipBg.cursor = 'pointer';\r\n\r\n                contentElements.push(pipBg, pipText);\r\n            }\r\n\r\n            // Left arrow (higher z-index to sit on top and take priority)\r\n            const leftArrowBg = k.add([\r\n                k.rect(30, 30),\r\n                k.pos(leftArrowX, y),\r\n                k.anchor('center'),\r\n                k.color(0, 0, 0),\r\n                k.opacity(0),\r\n                k.area({ width: 30, height: 30 }),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\r\n            ]);\r\n\r\n            const leftArrowText = k.add([\r\n                k.text('<', { size: 24 }),\r\n                k.pos(leftArrowX, y),\r\n                k.anchor('center'),\r\n                k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT + 1)\r\n            ]);\r\n\r\n            if (currentPage > 0) {\r\n                leftArrowBg.onClick(() => {\r\n                    playMenuNav();\r\n                    currentPage--;\r\n                    renderContent();\r\n                });\r\n                leftArrowBg.cursor = 'pointer';\r\n            }\r\n            contentElements.push(leftArrowBg, leftArrowText);\r\n\r\n            // Right arrow (higher z-index to sit on top and take priority)\r\n            const rightArrowBg = k.add([\r\n                k.rect(30, 30),\r\n                k.pos(rightArrowX, y),\r\n                k.anchor('center'),\r\n                k.color(0, 0, 0),\r\n                k.opacity(0),\r\n                k.area({ width: 30, height: 30 }),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\r\n            ]);\r\n\r\n            const rightArrowText = k.add([\r\n                k.text('>', { size: 24 }),\r\n                k.pos(rightArrowX, y),\r\n                k.anchor('center'),\r\n                k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT + 1)\r\n            ]);\r\n\r\n            if (currentPage < totalPages - 1) {\r\n                rightArrowBg.onClick(() => {\r\n                    playMenuNav();\r\n                    currentPage++;\r\n                    renderContent();\r\n                });\r\n                rightArrowBg.cursor = 'pointer';\r\n            }\r\n            contentElements.push(rightArrowBg, rightArrowText);\r\n        }\r\n\r\n        // Render leaderboard header row\r\n        function renderLeaderboardHeader(y) {\r\n            const headers = ['#', 'Name', 'Score', 'Floor', 'Time'];\r\n            const colPositions = [80, 150, 350, 470, 560];\r\n\r\n            headers.forEach((header, i) => {\r\n                const headerText = k.add([\r\n                    k.text(header, { size: UI_TEXT_SIZES.SMALL }),\r\n                    k.pos(colPositions[i], y),\r\n                    k.anchor(i === 0 ? 'center' : 'left'),\r\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_TEXT)\r\n                ]);\r\n                contentElements.push(headerText);\r\n            });\r\n\r\n            // Divider line\r\n            const divider = k.add([\r\n                k.rect(550, 2),\r\n                k.pos(k.width() / 2, y + 20),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.BORDER),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n            contentElements.push(divider);\r\n        }\r\n\r\n        // Render leaderboard row\r\n        function renderLeaderboardRow(rank, entry, y, isHighlighted = false) {\r\n            const colPositions = [80, 150, 350, 470, 560];\r\n            const color = isHighlighted ? UI_COLORS.GOLD : UI_COLORS.TEXT_PRIMARY;\r\n            const charData = CHARACTER_UNLOCKS[entry.character] || CHARACTER_UNLOCKS.survivor;\r\n\r\n            // Rank\r\n            const rankText = k.add([\r\n                k.text(rank <= 3 ? ['', '1st', '2nd', '3rd'][rank] : `${rank}`, { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(colPositions[0], y),\r\n                k.anchor('center'),\r\n                k.color(...(rank === 1 ? [255, 215, 0] : rank === 2 ? [192, 192, 192] : rank === 3 ? [205, 127, 50] : color)),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            contentElements.push(rankText);\r\n\r\n            // Name with character icon\r\n            const nameText = k.add([\r\n                k.text(`${charData.char} ${entry.name}`, { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(colPositions[1], y),\r\n                k.anchor('left'),\r\n                k.color(...color),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            contentElements.push(nameText);\r\n\r\n            // Score\r\n            const scoreText = k.add([\r\n                k.text(formatScore(entry.score), { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(colPositions[2], y),\r\n                k.anchor('left'),\r\n                k.color(...color),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            contentElements.push(scoreText);\r\n\r\n            // Floor\r\n            const floorText = k.add([\r\n                k.text(`${entry.floor}`, { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(colPositions[3], y),\r\n                k.anchor('left'),\r\n                k.color(...color),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            contentElements.push(floorText);\r\n\r\n            // Time\r\n            const timeText = k.add([\r\n                k.text(formatTime(entry.time), { size: UI_TEXT_SIZES.BODY }),\r\n                k.pos(colPositions[4], y),\r\n                k.anchor('left'),\r\n                k.color(...color),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n            contentElements.push(timeText);\r\n\r\n            // Highlight background for current player\r\n            if (isHighlighted) {\r\n                const highlight = k.add([\r\n                    k.rect(550, 30),\r\n                    k.pos(k.width() / 2, y),\r\n                    k.anchor('center'),\r\n                    k.color(...UI_COLORS.GOLD),\r\n                    k.opacity(0.1),\r\n                    k.fixed(),\r\n                    k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\r\n                ]);\r\n                contentElements.push(highlight);\r\n            }\r\n        }\r\n\r\n        // Back button (SM size - secondary action)\r\n        const { SM } = UI_SIZES.BUTTON;\r\n        const backButton = k.add([\r\n            k.rect(SM.width, SM.height),\r\n            k.pos(k.width() / 2, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.NEUTRAL),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n\r\n        k.add([\r\n            k.text('BACK', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        backButton.onClick(() => {\r\n            playMenuSelect();\r\n            k.go('menu');\r\n        });\r\n\r\n        backButton.onHoverUpdate(() => {\r\n            backButton.color = k.rgb(...UI_COLORS.SECONDARY_HOVER);\r\n        });\r\n\r\n        backButton.onHoverEnd(() => {\r\n            backButton.color = k.rgb(...UI_COLORS.SECONDARY);\r\n        });\r\n\r\n        // Keyboard shortcuts\r\n        k.onKeyPress('escape', () => {\r\n            playMenuSelect();\r\n            k.go('menu');\r\n        });\r\n\r\n        // Initialize\r\n        refreshTabs();\r\n        renderContent();\r\n    });\r\n}\r\n","// Profile scene - displays player profile with XP, level, portraits, and stats\r\nimport {\r\n    getPlayerName, setPlayerName, getPlayerLevel, getTotalXP,\r\n    getXPProgress, getXPForNextLevel, getXPRequiredForLevel,\r\n    getSelectedPortrait, setSelectedPortrait, isPortraitUnlocked,\r\n    getUnlockedPortraits, unlockPortrait, getSaveStats, loadSave\r\n} from '../systems/metaProgression.js';\r\nimport { generateRandomName } from '../systems/nameGenerator.js';\r\nimport { playMenuSelect, playMenuNav } from '../systems/sounds.js';\r\nimport {\r\n    PORTRAITS, getPortraitById, getAllPortraits,\r\n    checkPortraitUnlockCondition, getPortraitUnlockDescription,\r\n    getPortraitUnlockProgress, PORTRAIT_CATEGORIES\r\n} from '../data/portraits.js';\r\nimport {\r\n    UI_SIZES,\r\n    UI_TEXT_SIZES,\r\n    UI_COLORS,\r\n    UI_Z_LAYERS,\r\n    createMenuParticles,\r\n    createAnimatedTitle\r\n} from '../config/uiConfig.js';\r\n\r\n/**\r\n * Show name edit dialog (same as settings scene)\r\n */\r\nfunction showNameEditDialog(k, currentName, onSave) {\r\n    // Overlay\r\n    const overlay = k.add([\r\n        k.rect(k.width(), k.height()),\r\n        k.pos(0, 0),\r\n        k.color(0, 0, 0),\r\n        k.opacity(0.7),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY)\r\n    ]);\r\n\r\n    // Dialog box\r\n    const dialogWidth = 400;\r\n    const dialogHeight = 180;\r\n    const dialogBg = k.add([\r\n        k.rect(dialogWidth, dialogHeight),\r\n        k.pos(k.width() / 2, k.height() / 2),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.BG_MEDIUM),\r\n        k.outline(3, k.rgb(...UI_COLORS.BORDER)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 1)\r\n    ]);\r\n\r\n    // Title\r\n    const titleText = k.add([\r\n        k.text('Edit Player Name', { size: UI_TEXT_SIZES.LABEL }),\r\n        k.pos(k.width() / 2, k.height() / 2 - 60),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n    ]);\r\n\r\n    // Input display background\r\n    const inputBg = k.add([\r\n        k.rect(300, 40),\r\n        k.pos(k.width() / 2, k.height() / 2 - 10),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.BG_LIGHT),\r\n        k.outline(2, k.rgb(...UI_COLORS.GOLD)),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n    ]);\r\n\r\n    // Input display\r\n    let inputText = currentName;\r\n    const inputDisplay = k.add([\r\n        k.text(inputText, { size: UI_TEXT_SIZES.LABEL }),\r\n        k.pos(k.width() / 2, k.height() / 2 - 10),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.GOLD),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\r\n    ]);\r\n\r\n    // Error/Info message\r\n    const infoMsg = k.add([\r\n        k.text('(Max 20 characters)', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n        k.pos(k.width() / 2, k.height() / 2 + 25),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_SECONDARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n    ]);\r\n\r\n    // Store all dialog entities\r\n    const dialogEntities = [overlay, dialogBg, titleText, inputBg, inputDisplay, infoMsg];\r\n\r\n    // Close function\r\n    function closeDialog() {\r\n        dialogEntities.forEach(entity => {\r\n            if (entity && entity.exists && entity.exists()) {\r\n                k.destroy(entity);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Cancel button\r\n    const cancelButton = k.add([\r\n        k.rect(100, 30),\r\n        k.pos(k.width() / 2 - 60, k.height() / 2 + 60),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.BG_MEDIUM),\r\n        k.outline(2, k.rgb(...UI_COLORS.TEXT_PRIMARY)),\r\n        k.area(),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n    ]);\r\n\r\n    const cancelText = k.add([\r\n        k.text('Cancel', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n        k.pos(k.width() / 2 - 60, k.height() / 2 + 60),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.TEXT_PRIMARY),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\r\n    ]);\r\n\r\n    cancelButton.onClick(() => {\r\n        playMenuNav();\r\n        closeDialog();\r\n    });\r\n    dialogEntities.push(cancelButton, cancelText);\r\n\r\n    // Save button\r\n    const saveButton = k.add([\r\n        k.rect(100, 30),\r\n        k.pos(k.width() / 2 + 60, k.height() / 2 + 60),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.BG_MEDIUM),\r\n        k.outline(2, k.rgb(...UI_COLORS.GOLD)),\r\n        k.area(),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\r\n    ]);\r\n\r\n    const saveText = k.add([\r\n        k.text('Save', { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n        k.pos(k.width() / 2 + 60, k.height() / 2 + 60),\r\n        k.anchor('center'),\r\n        k.color(...UI_COLORS.GOLD),\r\n        k.fixed(),\r\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\r\n    ]);\r\n\r\n    saveButton.onClick(() => {\r\n        if (inputText.trim().length > 0) {\r\n            playMenuSelect();\r\n            onSave(inputText.trim());\r\n            closeDialog();\r\n        } else {\r\n            infoMsg.text = 'Name cannot be empty!';\r\n            infoMsg.color = k.rgb(255, 100, 100);\r\n        }\r\n    });\r\n    dialogEntities.push(saveButton, saveText);\r\n\r\n    // Keyboard input handlers\r\n    const charHandler = k.onCharInput((ch) => {\r\n        if (inputText.length < 20 && /[a-zA-Z0-9 ]/.test(ch)) {\r\n            inputText += ch;\r\n            inputDisplay.text = inputText;\r\n            infoMsg.text = '(Max 20 characters)';\r\n            infoMsg.color = k.rgb(...UI_COLORS.TEXT_SECONDARY);\r\n        }\r\n    });\r\n\r\n    const backspaceHandler = k.onKeyPress('backspace', () => {\r\n        if (inputText.length > 0) {\r\n            inputText = inputText.slice(0, -1);\r\n            inputDisplay.text = inputText || ' ';\r\n        }\r\n    });\r\n\r\n    const escapeHandler = k.onKeyPress('escape', () => {\r\n        closeDialog();\r\n        charHandler.cancel();\r\n        backspaceHandler.cancel();\r\n        escapeHandler.cancel();\r\n        enterHandler.cancel();\r\n    });\r\n\r\n    const enterHandler = k.onKeyPress('enter', () => {\r\n        if (inputText.trim().length > 0) {\r\n            playMenuSelect();\r\n            onSave(inputText.trim());\r\n            closeDialog();\r\n            charHandler.cancel();\r\n            backspaceHandler.cancel();\r\n            escapeHandler.cancel();\r\n            enterHandler.cancel();\r\n        }\r\n    });\r\n}\r\n\r\nexport function setupProfileScene(k) {\r\n    k.scene('profile', (args = {}) => {\r\n        // Check if viewing another player's profile\r\n        const externalProfile = args.externalProfile || null;\r\n        const isViewingOther = externalProfile !== null;\r\n\r\n        // Get profile data from external source or local save\r\n        const saveData = isViewingOther ? externalProfile : loadSave();\r\n        let selectedPortraitId = isViewingOther ? externalProfile.selectedPortrait : getSelectedPortrait();\r\n\r\n        // Extract data based on source\r\n        const profileStats = isViewingOther ? externalProfile.stats : getSaveStats();\r\n        const profileLevel = isViewingOther ? externalProfile.playerLevel : getPlayerLevel();\r\n        const profileXP = isViewingOther ? externalProfile.totalXP : getTotalXP();\r\n        const profileName = isViewingOther ? externalProfile.playerName : (getPlayerName() || 'Player');\r\n        const profileAchievements = isViewingOther ? externalProfile.achievements : [];\r\n        const profileUnlockedPortraits = isViewingOther ? externalProfile.unlockedPortraits : getUnlockedPortraits();\r\n\r\n        // Background\r\n        k.add([\r\n            k.rect(k.width(), k.height()),\r\n            k.pos(0, 0),\r\n            k.anchor('topleft'),\r\n            k.color(...UI_COLORS.BG_DARK),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.BACKGROUND)\r\n        ]);\r\n\r\n        // Background particles\r\n        createMenuParticles(k, { patternCount: 8, particleCount: 12 });\r\n\r\n        // Title - show player name when viewing another player\r\n        if (isViewingOther) {\r\n            k.add([\r\n                k.text(`${profileName}'s Profile`, { size: UI_TEXT_SIZES.H1 }),\r\n                k.pos(k.width() / 2, 35),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.GOLD),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n        } else {\r\n            createAnimatedTitle(k, 'PROFILE', k.width() / 2, 35, 8);\r\n        }\r\n\r\n        // ==========================================\r\n        // PROFILE CARD SECTION (Top)\r\n        // ==========================================\r\n        const cardY = 80;\r\n        const cardHeight = 140;\r\n        const cardWidth = 720;\r\n        const cardX = k.width() / 2;\r\n\r\n        // Card background\r\n        k.add([\r\n            k.rect(cardWidth, cardHeight),\r\n            k.pos(cardX, cardY + cardHeight / 2),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_MEDIUM),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\r\n        ]);\r\n\r\n        // Portrait frame\r\n        const portraitSize = 80;\r\n        const portraitX = cardX - cardWidth / 2 + 60;\r\n        const portraitY = cardY + cardHeight / 2;\r\n        const currentPortrait = getPortraitById(selectedPortraitId) || PORTRAITS.default;\r\n\r\n        k.add([\r\n            k.rect(portraitSize, portraitSize),\r\n            k.pos(portraitX, portraitY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_LIGHT),\r\n            k.outline(3, k.rgb(...(currentPortrait.color || [200, 200, 200]))),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\r\n        ]);\r\n\r\n        // Portrait icon\r\n        const portraitIcon = k.add([\r\n            k.text(currentPortrait.icon, { size: 40 }),\r\n            k.pos(portraitX, portraitY - 5),\r\n            k.anchor('center'),\r\n            k.color(...(currentPortrait.color || [200, 200, 200])),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Level badge on portrait\r\n        k.add([\r\n            k.text(`LV${profileLevel}`, { size: 12 }),\r\n            k.pos(portraitX, portraitY + 28),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.GOLD),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Player info (right of portrait)\r\n        const infoX = portraitX + 80;\r\n        let infoY = cardY + 20;\r\n\r\n        // Player name\r\n        let playerName = profileName;\r\n        const nameDisplay = k.add([\r\n            k.text(playerName, { size: UI_TEXT_SIZES.H1 }),\r\n            k.pos(infoX, infoY),\r\n            k.anchor('left'),\r\n            k.color(...UI_COLORS.GOLD),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // Edit and randomize buttons - only show for local profile\r\n        if (!isViewingOther) {\r\n            const editIconSize = 24;\r\n            const randomButtonX = cardX + cardWidth / 2 - 20;\r\n            const editButtonX = randomButtonX - editIconSize - 8;\r\n\r\n            // Edit name button (pencil icon, square)\r\n            const editButton = k.add([\r\n                k.rect(editIconSize, editIconSize),\r\n                k.pos(editButtonX, infoY),\r\n                k.anchor('right'),\r\n                k.color(...UI_COLORS.BG_MEDIUM),\r\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n\r\n            k.add([\r\n                k.text('', { size: 14 }),\r\n                k.pos(editButtonX - editIconSize / 2, infoY),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            editButton.onClick(() => {\r\n                playMenuSelect();\r\n                showNameEditDialog(k, playerName, (newName) => {\r\n                    setPlayerName(newName);\r\n                    nameDisplay.text = newName;\r\n                    playerName = newName;\r\n                });\r\n            });\r\n\r\n            editButton.onHoverUpdate(() => {\r\n                editButton.color = k.rgb(...UI_COLORS.BG_LIGHT);\r\n            });\r\n            editButton.onHoverEnd(() => {\r\n                editButton.color = k.rgb(...UI_COLORS.BG_MEDIUM);\r\n            });\r\n\r\n            // Randomize name button (dice icon, square)\r\n            const randomButton = k.add([\r\n                k.rect(editIconSize, editIconSize),\r\n                k.pos(randomButtonX, infoY),\r\n                k.anchor('right'),\r\n                k.color(...UI_COLORS.BG_MEDIUM),\r\n                k.outline(2, k.rgb(...UI_COLORS.GOLD)),\r\n                k.area(),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ]);\r\n\r\n            k.add([\r\n                k.text('', { size: 14 }),\r\n                k.pos(randomButtonX - editIconSize / 2, infoY),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.GOLD),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            randomButton.onClick(() => {\r\n                playMenuSelect();\r\n                const newName = generateRandomName();\r\n                setPlayerName(newName);\r\n                nameDisplay.text = newName;\r\n                playerName = newName;\r\n            });\r\n\r\n            randomButton.onHoverUpdate(() => {\r\n                randomButton.color = k.rgb(...UI_COLORS.BG_LIGHT);\r\n            });\r\n            randomButton.onHoverEnd(() => {\r\n                randomButton.color = k.rgb(...UI_COLORS.BG_MEDIUM);\r\n            });\r\n        }\r\n\r\n        infoY += 35;\r\n\r\n        // Level with stars\r\n        const stars = Math.min(5, Math.floor(profileLevel / 10));\r\n        const starDisplay = ''.repeat(stars) + ''.repeat(5 - stars);\r\n        k.add([\r\n            k.text(`Level ${profileLevel}  ${starDisplay}`, { size: UI_TEXT_SIZES.LABEL }),\r\n            k.pos(infoX, infoY),\r\n            k.anchor('left'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n        infoY += 30;\r\n\r\n        // XP Progress bar\r\n        const barWidth = 250;\r\n        const barHeight = 16;\r\n        const xpProgress = isViewingOther ? 0 : getXPProgress();\r\n        const currentXP = profileXP;\r\n        const nextLevelXP = isViewingOther ? profileXP : getXPForNextLevel();\r\n        const currentLevelXP = getXPRequiredForLevel(profileLevel);\r\n\r\n        // Bar background\r\n        k.add([\r\n            k.rect(barWidth, barHeight),\r\n            k.pos(infoX, infoY),\r\n            k.anchor('left'),\r\n            k.color(40, 40, 60),\r\n            k.outline(1, k.rgb(80, 80, 100)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\r\n        ]);\r\n\r\n        // Bar fill\r\n        const fillWidth = Math.max(2, barWidth * xpProgress);\r\n        k.add([\r\n            k.rect(fillWidth, barHeight - 4),\r\n            k.pos(infoX + 2, infoY),\r\n            k.anchor('left'),\r\n            k.color(100, 180, 255),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n\r\n        // XP text\r\n        k.add([\r\n            k.text(`${Math.round(xpProgress * 100)}%`, { size: 10 }),\r\n            k.pos(infoX + barWidth / 2, infoY),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_PRIMARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n        infoY += 22;\r\n\r\n        // XP numbers\r\n        k.add([\r\n            k.text(`${currentXP.toLocaleString()} / ${nextLevelXP.toLocaleString()} XP`, { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(infoX, infoY),\r\n            k.anchor('left'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // ==========================================\r\n        // PORTRAITS SECTION (directly below card since buttons moved to name)\r\n        // ==========================================\r\n        const portraitsY = cardY + cardHeight + 10;\r\n        const portraitsSectionHeight = 165;\r\n\r\n        // Section background\r\n        k.add([\r\n            k.rect(cardWidth, portraitsSectionHeight),\r\n            k.pos(cardX, portraitsY + portraitsSectionHeight / 2),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_MEDIUM),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\r\n        ]);\r\n\r\n        // Portrait grid (no header, 2 rows max with 13 per row = 26 portraits)\r\n        const allPortraits = getAllPortraits();\r\n        const gridStartX = cardX - cardWidth / 2 + 30;\r\n        const gridY = portraitsY + 20;\r\n        const iconSize = 40;\r\n        const iconSpacing = 50;\r\n        const maxPerRow = 13;\r\n\r\n        // Selected portrait info display\r\n        let selectedInfoText = null;\r\n        let selectedDescText = null;\r\n\r\n        function updateSelectedInfo(portrait) {\r\n            if (selectedInfoText && selectedInfoText.exists()) {\r\n                selectedInfoText.text = `Selected: \"${portrait.name}\"`;\r\n            }\r\n            if (selectedDescText && selectedDescText.exists()) {\r\n                selectedDescText.text = portrait.description;\r\n            }\r\n        }\r\n\r\n        allPortraits.forEach((portrait, index) => {\r\n            const row = Math.floor(index / maxPerRow);\r\n            const col = index % maxPerRow;\r\n            const x = gridStartX + col * iconSpacing;\r\n            const y = gridY + row * (iconSpacing + 5);\r\n\r\n            // Check if unlocked - use external data when viewing another player\r\n            const isUnlocked = isViewingOther\r\n                ? profileUnlockedPortraits.includes(portrait.id)\r\n                : checkPortraitUnlockCondition(portrait.id, saveData);\r\n            const isSelected = portrait.id === selectedPortraitId;\r\n\r\n            // Portrait box\r\n            const boxColor = isUnlocked\r\n                ? (isSelected ? [80, 100, 140] : UI_COLORS.BG_LIGHT)\r\n                : [40, 40, 50];\r\n            const borderColor = isSelected\r\n                ? UI_COLORS.GOLD\r\n                : (isUnlocked ? portrait.color : [80, 80, 80]);\r\n\r\n            const portraitBox = k.add([\r\n                k.rect(iconSize, iconSize),\r\n                k.pos(x, y),\r\n                k.anchor('center'),\r\n                k.color(...boxColor),\r\n                k.outline(isSelected ? 3 : 2, k.rgb(...borderColor)),\r\n                isViewingOther ? null : k.area(), // Only clickable for own profile\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n            ].filter(Boolean));\r\n\r\n            // Portrait icon or lock\r\n            const displayIcon = isUnlocked ? portrait.icon : '';\r\n            const displayColor = isUnlocked ? portrait.color : [100, 100, 100];\r\n            const iconText = k.add([\r\n                k.text(displayIcon, { size: isUnlocked ? 24 : 16 }),\r\n                k.pos(x, y - 3),\r\n                k.anchor('center'),\r\n                k.color(...displayColor),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            // Name below\r\n            const nameText = isUnlocked ? portrait.name.substring(0, 8) : '???';\r\n            k.add([\r\n                k.text(nameText, { size: 8 }),\r\n                k.pos(x, y + iconSize / 2 + 8),\r\n                k.anchor('center'),\r\n                k.color(...(isUnlocked ? UI_COLORS.TEXT_SECONDARY : [80, 80, 80])),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            // Click handler - only for own profile\r\n            if (!isViewingOther) {\r\n                portraitBox.onClick(() => {\r\n                    if (isUnlocked) {\r\n                        playMenuSelect();\r\n                        setSelectedPortrait(portrait.id);\r\n                        selectedPortraitId = portrait.id;\r\n                        // Update UI - would need to refresh scene\r\n                        updateSelectedInfo(portrait);\r\n                        k.go('profile'); // Refresh scene to show new selection\r\n                    } else {\r\n                        playMenuNav();\r\n                        // Show unlock requirement\r\n                        const desc = getPortraitUnlockDescription(portrait.id);\r\n                        if (selectedDescText && selectedDescText.exists()) {\r\n                            selectedDescText.text = `Locked: ${desc}`;\r\n                            selectedDescText.color = k.rgb(...UI_COLORS.DANGER);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                portraitBox.onHoverUpdate(() => {\r\n                    if (!isSelected) {\r\n                        portraitBox.color = k.rgb(...(isUnlocked ? [100, 120, 160] : [50, 50, 60]));\r\n                    }\r\n                });\r\n                portraitBox.onHoverEnd(() => {\r\n                    if (!isSelected) {\r\n                        portraitBox.color = k.rgb(...boxColor);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        // Selected portrait info\r\n        selectedInfoText = k.add([\r\n            k.text(`Selected: \"${currentPortrait.name}\"`, { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(cardX, portraitsY + portraitsSectionHeight - 35),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.GOLD),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        selectedDescText = k.add([\r\n            k.text(currentPortrait.description, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n            k.pos(cardX, portraitsY + portraitsSectionHeight - 18),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        // ==========================================\r\n        // STATS SECTION\r\n        // ==========================================\r\n        const statsY = portraitsY + portraitsSectionHeight + 10;\r\n        const statsHeight = 120;\r\n\r\n        // Section background\r\n        k.add([\r\n            k.rect(cardWidth, statsHeight),\r\n            k.pos(cardX, statsY + statsHeight / 2),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.BG_MEDIUM),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\r\n        ]);\r\n\r\n        // Stats display - Three rows (use profileStats for both local and external)\r\n        const stats = profileStats;\r\n        const totalRuns = stats.totalRuns || 0;\r\n        const avgCurrency = totalRuns > 0 ? Math.round((stats.totalCurrencyEarned || 0) / totalRuns) : 0;\r\n        const avgFloors = totalRuns > 0 ? ((stats.totalFloorsReached || 0) / totalRuns).toFixed(1) : '0';\r\n        const avgRooms = totalRuns > 0 ? ((stats.totalRoomsCleared || 0) / totalRuns).toFixed(1) : '0';\r\n\r\n        // Format fastest run time\r\n        const fastestTime = stats.fastestRunTime || 0;\r\n        const fastestMin = Math.floor(fastestTime / 60);\r\n        const fastestSec = Math.floor(fastestTime % 60);\r\n        const fastestDisplay = fastestTime > 0 ? `${fastestMin}:${fastestSec.toString().padStart(2, '0')}` : '--:--';\r\n\r\n        // Row 1: Main stats (5 columns)\r\n        const row1Stats = [\r\n            { label: 'Total Runs', value: totalRuns },\r\n            { label: 'Best Floor', value: stats.bestFloor || 1 },\r\n            { label: 'Best Level', value: stats.bestLevel || 1 },\r\n            { label: 'Best Room', value: stats.bestRoom || 1 },\r\n            { label: 'Fastest Run', value: fastestDisplay }\r\n        ];\r\n\r\n        const statWidth = cardWidth / row1Stats.length;\r\n        row1Stats.forEach((stat, index) => {\r\n            const x = cardX - cardWidth / 2 + statWidth * index + statWidth / 2;\r\n            const y = statsY + 15;\r\n\r\n            k.add([\r\n                k.text(stat.label, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                k.pos(x, y),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            k.add([\r\n                k.text(String(stat.value), { size: UI_TEXT_SIZES.LABEL }),\r\n                k.pos(x, y + 16),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.GOLD),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n        });\r\n\r\n        // Row 2: Combat stats (5 columns)\r\n        const row2Stats = [\r\n            { label: 'Enemies', value: (stats.totalEnemiesKilled || 0).toLocaleString() },\r\n            { label: 'Bosses', value: stats.totalBossesKilled || 0 },\r\n            { label: 'Rooms', value: (stats.totalRoomsCleared || 0).toLocaleString() },\r\n            { label: 'Avg Floor', value: avgFloors },\r\n            { label: 'Avg Rooms', value: avgRooms }\r\n        ];\r\n\r\n        row2Stats.forEach((stat, index) => {\r\n            const x = cardX - cardWidth / 2 + statWidth * index + statWidth / 2;\r\n            const y = statsY + 50;\r\n\r\n            k.add([\r\n                k.text(stat.label, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                k.pos(x, y),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            k.add([\r\n                k.text(String(stat.value), { size: UI_TEXT_SIZES.SMALL }),\r\n                k.pos(x, y + 14),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n        });\r\n\r\n        // Row 3: Currency stats (5 columns)\r\n        const row3Stats = [\r\n            { label: 'Total Money', value: (stats.totalCurrencyEarned || 0).toLocaleString() },\r\n            { label: 'Spent', value: (stats.totalCurrencySpent || 0).toLocaleString() },\r\n            { label: 'Avg Money', value: avgCurrency.toLocaleString() },\r\n            { label: 'Floors', value: (stats.totalFloorsReached || 0).toLocaleString() },\r\n            { label: 'Play Time', value: (() => {\r\n                const playTime = stats.totalPlayTime || 0;\r\n                const hours = Math.floor(playTime / 3600);\r\n                const minutes = Math.floor((playTime % 3600) / 60);\r\n                return `${hours}h ${minutes}m`;\r\n            })() }\r\n        ];\r\n\r\n        row3Stats.forEach((stat, index) => {\r\n            const x = cardX - cardWidth / 2 + statWidth * index + statWidth / 2;\r\n            const y = statsY + 85;\r\n\r\n            k.add([\r\n                k.text(stat.label, { size: UI_TEXT_SIZES.SMALL - 2 }),\r\n                k.pos(x, y),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_SECONDARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n\r\n            k.add([\r\n                k.text(String(stat.value), { size: UI_TEXT_SIZES.SMALL }),\r\n                k.pos(x, y + 14),\r\n                k.anchor('center'),\r\n                k.color(...UI_COLORS.TEXT_PRIMARY),\r\n                k.fixed(),\r\n                k.z(UI_Z_LAYERS.UI_TEXT)\r\n            ]);\r\n        });\r\n\r\n        // ==========================================\r\n        // BACK BUTTON\r\n        // ==========================================\r\n        const { SM } = UI_SIZES.BUTTON;\r\n\r\n        const backButton = k.add([\r\n            k.rect(SM.width, SM.height),\r\n            k.pos(k.width() / 2, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.NEUTRAL),\r\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\r\n            k.area(),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\r\n        ]);\r\n\r\n        k.add([\r\n            k.text('BACK', { size: UI_TEXT_SIZES.SMALL }),\r\n            k.pos(k.width() / 2, k.height() - 40),\r\n            k.anchor('center'),\r\n            k.color(...UI_COLORS.TEXT_SECONDARY),\r\n            k.fixed(),\r\n            k.z(UI_Z_LAYERS.UI_TEXT)\r\n        ]);\r\n\r\n        backButton.onClick(() => {\r\n            playMenuNav();\r\n            k.go('menu');\r\n        });\r\n\r\n        backButton.onHoverUpdate(() => {\r\n            backButton.color = k.rgb(...UI_COLORS.NEUTRAL_HOVER);\r\n        });\r\n        backButton.onHoverEnd(() => {\r\n            backButton.color = k.rgb(...UI_COLORS.NEUTRAL);\r\n        });\r\n\r\n        // Escape key handler\r\n        k.onKeyPress('escape', () => {\r\n            playMenuNav();\r\n            k.go('menu');\r\n        });\r\n    });\r\n}\r\n","import kaplay from 'kaplay';\r\nimport { setupGameScene } from './scenes/game.js';\r\nimport { setupMenuScene } from './scenes/menu.js';\r\nimport { setupGameOverScene } from './scenes/gameOver.js';\r\nimport { setupShopScene } from './scenes/shop.js';\r\nimport { setupSettingsScene } from './scenes/settings.js';\r\nimport { setupStatisticsScene } from './scenes/statistics.js';\r\nimport { setupCharacterSelectScene } from './scenes/characterSelect.js';\r\nimport { initJoinPartyScene } from './scenes/joinParty.js';\r\nimport { setupLeaderboardsScene } from './scenes/leaderboards.js';\r\nimport { setupProfileScene } from './scenes/profile.js';\r\nimport { GAME_CONFIG } from './config/constants.js';\r\n\r\n// Initialize KAPLAY\r\nconst k = kaplay({\r\n    width: GAME_CONFIG.CANVAS_WIDTH,\r\n    height: GAME_CONFIG.CANVAS_HEIGHT,\r\n    background: GAME_CONFIG.BACKGROUND_COLOR,\r\n    scale: GAME_CONFIG.CANVAS_SCALE,\r\n    debug: GAME_CONFIG.DEBUG_MODE,\r\n    root: document.querySelector('#game-container'),\r\n    stretch: true,  // Stretch canvas to fill container\r\n    letterbox: true, // Maintain aspect ratio with letterboxing\r\n    crisp: true, // Disable anti-aliasing for crisp pixel art\r\n});\r\n\r\n// Setup scenes\r\nsetupMenuScene(k);\r\nsetupGameScene(k);\r\nsetupGameOverScene(k);\r\nsetupShopScene(k);\r\nsetupSettingsScene(k);\r\nsetupStatisticsScene(k);\r\nsetupCharacterSelectScene(k);\r\ninitJoinPartyScene(k);\r\nsetupLeaderboardsScene(k);\r\nsetupProfileScene(k);\r\n\r\n// Start with menu\r\nk.go('menu');\r\n\r\n"],"names":["Oo","t","e","n","r","o","s","i","m","u","c","p","Ao","Te","j","b","l","de","I","So","ae","lt","E","Se","Po","v","W","q","le","Dt","bt","fe","h","d","C","g","y","O","A","R","V","w","An","tu","nu","Vo","Xt","wr","Go","he","Cr","Mo","Er","Ro","Do","Tr","ru","Sn","Vn","Bt","Bo","Fo","Lo","be","Pn","Ft","Gn","Or","et","Oe","ou","Qt","Tn","Ke","jo","we","su","G","M","D","L","U","H","Y","_","K","J","$","Z","Ee","k","gt","Gt","Io","iu","au","uu","cu","lu","mu","pu","Ko","du","ko","fu","hu","_o","On","gu","No","Uo","Ho","Jt","qo","zo","Wo","Yo","$o","Vr","Lt","Pr","jt","Xo","Qo","Jo","Yt","xr","$t","bu","x","S","yu","Zo","es","ts","ns","rs","xu","vr","vu","wu","Cu","Mn","os","Rn","mt","ss","yt","Zt","en","Eu","is","as","us","cs","ls","tn","nn","ms","ps","Gr","ds","fs","Dn","rn","ke","re","ze","hs","gs","bs","It","Tu","ys","Bn","Mr","xs","Rr","Fn","vs","Ln","ws","Cs","Ou","tt","on","ne","Au","Ts","Su","Bu","Mu","Ru","Fu","Vu","Es","Pu","Du","Gu","xt","Dr","De","We","sn","Os","As","jn","a","Ss","Qe","Vs","pt","Ps","vt","Br","Fr","Gs","ju","Ms","f","T","P","Me","br","En","B","te","To","Ae","se","Ze","Rt","Cn","Xa","Ht","yn","xn","mr","pr","Mt","$e","vn","F","N","z","oe","ye","Q","ve","qt","ut","dr","fr","hr","gr","wn","Xe","ct","zt","Ie","Wt","Je","Ja","vo","Qa","Re","wo","yr","Co","Za","Eo","ee","an","un","Iu","Ku","ku","_u","Nu","Uu","Hu","qu","zu","_e","Rs","Ds","In","Bs","Fs","Ls","Kn","nt","Wu","Lr","jr","Ir","kn","dt","js","ie","ue","wt","Is","Ks","X","ge","ks","rt","Ye","me","Ce","_n","Ct","Nn","Ve","pe","ce","ft","_r","Et","_s","Ns","Us","Hs","Tt","Be","Un","qs","cn","zs","Ws","Fe","Ur","Kt","Nr","Ot","Ys","$s","Xs","At","Hr","Hn","qr","Qs","Js","Zs","ei","zr","qn","ti","Wr","ni","ri","ot","oi","Yr","si","ii","$r","Le","Pe","kt","zn","Ne","_t","$u","Xu","Qu","Wn","ai","st","Yn","St","ui","Xr","mi","$n","Ue","it","He","xe","qe","Qr","Xn","di","Jr","fi","hi","Qn","gi","Vt","bi","yi","Zr","xi","at","je","vi","Jn","wi","Ci","Ei","Zn","Ti","eo","Oi","Ai","er","tr","Si","Vi","Pt","nr","Ge","Pi","Gi","rr","Mi","to","Ri","Di","Bi","no","Fi","Li","ji","Ii","or","Ki","ki","_i","Ni","Ui","Hi","qi","Nt","zi","ro","oo","so","io","ao","uo","Wi","co","ar","ir","Yi","$i","pn","sr","Xi","Qi","Ji","Zi","dn","ea","ta","na","ra","ht","oa","sa","ia","aa","ur","lo","mo","ua","cr","ca","lr","fn","Ut","hn","po","gn","fo","la","ma","pa","da","fa","ha","ga","ba","ya","xa","va","wa","Ca","Ea","bn","Ta","ho","go","bo","Oa","yo","Aa","Sa","Va","Pa","Ga","xo","Ma","Ra","Da","Ba","Fa","La","ja","Ia","Ka","ka","_a","Na","Ua","Ha","qa","za","Wa","Ya","sc","ic","hw","ADJECTIVES","NOUNS","generateRandomName","adjective","noun","generateInviteCode","isValidInviteCode","code","ACHIEVEMENTS","ACHIEVEMENT_COLORS","ACHIEVEMENT_REWARDS","getAchievementReward","achievement","getAchievementsByCategory","category","ach","getAchievementCategories","categories","getAchievementById","id","getAchievementProgress","achievementId","stats","currentValue","targetValue","progress","CHARACTER_UNLOCKS","WEAPON_UNLOCKS","COSMETIC_UNLOCKS","RUN_BOOSTER_UNLOCKS","PERMANENT_UPGRADE_UNLOCKS","getUnlocksForCategory","STORAGE_KEY","CURRENCY_ICON","DEFAULT_SAVE","MAX_RUN_HISTORY","loadSave","saved","data","mergedData","saveGame","newSave","getSaveData","addCurrency","amount","save","getCurrency","isUnlocked","item","unlockItem","checkFloorUnlocks","floorCompleted","unlocked","key","char","checkAchievementUnlocks","getSelectedCharacter","setSelectedCharacter","characterKey","getPermanentUpgradeLevel","upgradeKey","purchaseUnlock","cost","getUpgradePrice","level","prices","purchasePermanentUpgrade","maxLevel","currentLevel","purchaseBooster","boosterKey","getActiveBoostersCount","consumeBoosters","boosters","getTotalRefundableCredits","total","purchaseHistory","refundSinglePermanentUpgrade","refundAmount","index","refundAllPermanentUpgrades","updateRunStats","runStats","isAchievementUnlocked","unlockAchievement","reward","unlockedChars","getUnlockedAchievements","getSaveStats","calculateCurrencyEarned","currency","bossBountyLevel","creditBonusLevel","getCurrencyName","getPlayerName","setPlayerName","name","getInviteCode","setInviteCode","recordRun","runData","runRecord","getRunHistory","getEquippedCosmetic","type","setEquippedCosmetic","getEquippedCosmetics","calculateLevelFromXP","xp","getXPRequiredForLevel","getPlayerLevel","getTotalXP","getXPForNextLevel","getXPProgress","totalXP","currentLevelXP","nextLevelXP","addXP","oldLevel","newLevel","calculateRunXP","getSelectedPortrait","setSelectedPortrait","portraitId","getUnlockedPortraits","STICK_DEADZONE","JOYSTICK_SIZE","JOYSTICK_KNOB_SIZE","JOYSTICK_OPACITY","JOYSTICK_ACTIVE_OPACITY","inputState","applyDeadzone","value","deadzone","initInputSystem","gamepads","updateGamepadInput","gamepad","rawAimX","rawAimY","initTouchControls","cleanupTouchJoysticks","createJoystickVisuals","canvas","handleTouchStart","handleTouchMove","handleTouchEnd","screenWidth","screenHeight","leftCenterX","leftCenterY","rightCenterX","rightCenterY","rect","scaleX","scaleY","touch","dx","dy","distance","maxDistance","clampedDistance","angle","normalizedDistance","getMovementInput","getAimInput","WEAPON_DEFINITIONS","getWeaponDefinition","weaponKey","isUpgradeValidForWeapon","upgradeCategory","GAME_CONFIG","PLAYER_CONFIG","PROGRESSION_CONFIG","CHARACTER_ABILITIES","COMBAT_CONFIG","WEAPON_CONFIG","PICKUP_CONFIG","calculateDamageAfterDefense","baseDamage","defense","damageReduction","afterReduction","rollCriticalHit","critChance","rng","calculateCriticalDamage","critMultiplier","createPlayer","selectedCharKey","charData","outline","player","headStartLevel","weaponDef","characterDamageBonus","weaponBaseDamage","characterDamageMultiplier","luckyStartLevel","thickSkinLevel","xpMagnetLevel","comfortZoneLevel","moveDir","windowHasFocus","keysNeedRelease","handleBlur","handleFocus","flashRate","effectiveMoveDir","altInput","len","moveAmount","newX","newY","canMoveX","canMoveY","obstacles","playerSize","obstacle","obsLeft","obsRight","obsTop","obsBottom","playerLeft","playerRight","playerTop","playerBottom","playerLeftY","playerRightY","playerTopY","playerBottomY","roomWidth","roomHeight","margin","network","initNetwork","inviteCode","isHost","resolve","reject","disconnect","peerId","isLocalhost","peerConfig","codeToReturn","err","newCode","conn","handleIncomingConnection","cb","handleMessage","connectToHost","hostInviteCode","hostPeerId","connectionTimeout","isResolved","fromPeerId","handler","onMessage","messageType","offMessage","onConnectionChange","callback","sendToHost","payload","sendToPeer","broadcast","excludePeerIds","getNetworkInfo","displayCode","party","partyHostHandlersRegistered","partyClientHandlersRegistered","initParty","playerName","selectedCharacter","selectedPortrait","actualCode","setupNetworkHandlers","slotIndex","addPlayerToPartyFromNetwork","partySyncData","slot","sendInitialGameState","broadcastPartyUpdate","checkAllReady","handlePartyEmote","targetSlot","handleProfileRequest","targetPeerId","handleProfileResponse","event","handlePlayerDisconnect","getParty","getPartySize","getDisplayInviteCode","permanentUpgradeLevels","joinPartyAsClient","savedLocalPlayer","setupClientHandlers","restoreLocalPlayerToSoloParty","playerInfo","partySize","localSlotIndex","broadcastGameStart","playerData","finalizeDisconnect","cleanupDisconnectedPlayer","removePlayerFromParty","getPartyDisplayInfo","broadcastCharacterChange","toggleReady","localSlot","getLocalPlayerSlot","isLocalPlayerReady","areAllPlayersReady","occupiedSlots","startCountdown","cancelCountdown","getCountdownState","elapsed","emoteType","broadcastPartyEmote","onPartyEmote","offPartyEmote","getActiveEmote","maxAge","emote","clearPartyCallbacks","profileRequestCallbacks","getLocalProfileData","requestPlayerProfile","profileData","BOSS_TYPES","getBossDefinition","createBoss","floor","baseConfig","floorMultiplier","config","getBossVisual","leftArmor","rightArmor","boss","leftShield","rightShield","shieldPercent","armorPercent","visual","damage","shieldChanged","armorChanged","previousShieldHealth","previousArmorHealth","shieldRegenCooldownDuration","shieldDamage","remainingDamage","reducedDamage","armorDamage","damageMultiplier","finalDamage","healthPercent","phase","minionCount","angleVariation","spawnDistance","spawnX","spawnY","minionType","minion","createEnemy","isMultiplayerActive","registerEnemy","directions","projectileSpeed","projectileDamage","dir","projectile","createProjectile","targetPos","regenInterval","regenAmount","minionSpawnInterval","chargeCooldown","radialBurstInterval","chargeMove","normalized","moveSpeed","bossSize","bossLeftX","bossRightX","bossTopX","bossBottomX","bossLeftY","bossRightY","bossTopY","bossBottomY","chargeDistance","chargeSpeedMultiplier","preferredDistance","fireInterval","direction","spawnInterval","activeMinions","centerX","centerY","toCenter","toPlayer","playerDistance","broadcastDeathEvent","createTwinGuardians","door1","door2","meleeGuardian","rangedGuardian","broadcastBossEnrage","POWERUP_WEAPONS","rollPowerupDrop","enemyType","dropChanceBonus","powerup","adjustedChance","finalChance","applyPowerupWeapon","powerupKey","durabilityBonus","restoreOriginalWeapon","original","updatePowerupWeapon","broadcastPowerupExpired","decrementPowerupAmmo","getPowerupDisplay","createXPPickup","pickup","pulse","dirToPlayer","registerPickup","unregisterPickup","CURRENCY_ICONS","getRandomCurrencyIcon","createCurrencyPickup","icon","currencyIcon","timeRemaining","flashSpeed","flash","createPowerupWeaponPickup","SeededRandom","seed","min","max","array","arr","probability","state","createSeed","components","seedFromString","str","hash","connectionState","initConnectionQuality","now","pingId","peerState","latency","UPGRADE_STACK_LIMITS","UPGRADES","stacks","multiplier","baseFireRate","baseSpeed","baseHealth","bonusHP","oldMaxHealth","hpDiff","baseMultiplier","baseRadius","baseCount","basePiercing","baseObstaclePiercing","finalCritChance","finalCritDamage","baseSpread","baseRange","baseJumps","baseReduction","baseDefense","baseDodge","pickupStacks","pickupMultiplier","baseDuration","isUpgradeValidForPlayer","upgrade","maxStacks","startingWeapon","getRandomUpgrades","count","allOptions","validOptions","option","selected","used","randomIndex","applyUpgrade","recalculateAllUpgrades","getUpgradeDescription","UI_SIZES","UI_TEXT_SIZES","UI_COLORS","UI_BUTTON","UI_TERMS","formatButtonText","text","formatXP","current","UI_Z_LAYERS","CURRENCY_SYMBOLS","createMenuParticles","options","patternCount","particleCount","includeCursorFollowers","patterns","pattern","scale","particle","cursorFollowers","shipChars","ship","dist","ASCII_TITLES","createAnimatedTitle","fontSize","hslToRgb","titleKey","asciiTitle","title","colorTime","hue","color","offset","titleLines","lineSpacing","startY","line","titleLine","createCreditIndicator","currencyName","getRandomInterval","measurementText","panelWidth","panelHeight","panel","updateCurrency","newCurrency","newWidth","toastState","initToastSystem","showToast","toast","processQueue","showAchievementToast","difficultyColor","showMultiplayerAchievementToast","toastData","createToastUI","startX","targetX","toastIndex","borderColor","bgColor","borderWidth","container","glowTime","iconBg","iconSize","iconTime","baseY","bounce","messageLines","messageElements","msg","toastElements","updateHandler","easedProgress","easeOutCubic","currentX","lerp","updateToastPositionX","easeInCubic","exitX","opacity","destroyToast","repositionActiveToasts","oldY","offsetY","msgIndex","start","end","mpGame","initMultiplayerGame","kaplayInstance","gameSeed","setupHostHandlers","multiplayerClientHandlersRegistered","multiplayerHostHandlersRegistered","moveX","moveY","aimAngle","collectGameState","playerState","localPlayer","receivedIds","enemyState","existingEnemy","enemy","pickupState","existing","targetPlayer","damageText","target","originalColor","entity","revivePercent","reviveHealth","reviveHealthPercent","reviveEffect","cleanupMultiplayer","registerPlayer","playerEntity","broadcastPlayerDisconnect","updateMultiplayer","broadcastGameState","sendInputState","desyncDetected","requestResync","lerpFactor","playerStates","enemyStates","projectileStates","pickupStates","weaponsArray","upgradesArray","stacksObj","currentHP","entityId","sendAllExistingEntities","entityData","move","getPlayerCount","creationParams","registerProjectile","colorArray","unregisterProjectile","spawnData","broadcastDamageEvent","params","broadcastHealEvent","broadcastDodgeEvent","bossNetworkId","broadcastRevivalEvent","broadcastGameOver","currencyEarned","partyStats","broadcastHostQuit","broadcastPowerupWeaponApplied","broadcastUpgradeSelected","broadcastLevelUpQueued","broadcastSynergyActivated","synergyKeys","hasGameSeed","onGameSeedReceived","setCurrentFloor","floorSeed","getRoomRNG","getFirstRoomTemplateKey","getFloorRNG","getUpgradeRNG","playerIndex","playerLevel","broadcastGameSeed","firstRoomTemplateKey","broadcastPauseState","paused","sendPauseRequest","sendEnemyDeath","deathData","broadcastObstacles","doorStates","broadcastRoomCompletion","broadcastXPGain","xpValue","broadcastCurrencyGain","currencyValue","getAndClearPendingXP","pending","broadcastEmote","broadcastRoomTransition","entryDirection","allPlayerStats","gridDirection","currentFloor","roomTemplateKey","broadcastEnemySplit","splitCount","broadcastPlayerDeath","broadcastAchievementUnlocked","playerSlotIndex","ObjectPool","createFn","resetFn","initialSize","obj","args","pools","initObjectPools","proj","speed","piercing","obstaclePiercing","isCrit","maxRange","size","velocity","gravity","lifetime","fadeStart","friction","zIndex","getParticlePool","clearAllPools","distToPlayer","returnDir","returnSpeed","distanceThisFrame","ENEMY_TYPES","getEnemyDefinition","GRID_SIZE","MAX_PATH_LENGTH","PriorityQueue","element","priority","worldToGrid","gridToWorld","gx","gy","isCellWalkable","gridWidth","gridHeight","worldPos","halfSize","cellLeft","cellRight","cellTop","cellBottom","obstacleLeft","obstacleRight","obstacleTop","obstacleBottom","heuristic","findPath","goalX","goalY","goal","frontier","cameFrom","costSoFar","getKey","node","iterations","maxIterations","neighbors","next","moveCost","newCost","nextKey","path","getSmartMoveDirection","targetY","waypoint","toWaypoint","distanceToWaypoint","toTarget","getPerimeterMoveDirection","perim","threshold","distanceToTarget","getEnemyVisual","floorArmorBonus","floorShieldBonus","floorShieldRegen","armorRoll","shieldRoll","bothRoll","totalBaseArmor","totalBaseShield","healthBarWidth","healthBarHeight","healthBarOffset","healthBarBg","healthBar","barWidth","isPositionClear","testX","testY","enemySize","enemyLeft","enemyRight","enemyTop","enemyBottom","applyObstacleAvoidance","desiredMove","desiredDir","perpendicular1","perpendicular2","testDirections","testDir","avoidMove","avoidX","avoidY","alivePlayers","minDistance","finalMove","jitter","teleportDir","teleportPos","spawnAngle","nearbyEnemies","otherEnemy","maxHP","newHP","healText","teleportAngle","teleportX","teleportY","clampedX","clampedY","teleportText","rushMove","bomb","toPlayerNorm","buffedEnemy","splitType","splitEnemy","explosionText","MINIBOSS_TYPES","getMinibossDefinition","createMiniboss","miniboss","minibossSize","createDoor","doorGroup","part","doorChars","doorText","leftCorner","rightCorner","spacing","doorPart","topDecor","bottomDecor","blockedMarker","newColor","newText","createObstacle","width","height","isWall","defaultColor","defaultOutline","BARREL_CONFIG","allBarrels","createBarrel","barrel","healthBarFill","sourceId","fromNetwork","explosionX","explosionY","createExplosionEffect","dealExplosionDamage","triggerChainReaction","radius","outerRing","innerRing","core","val","debris","knockbackForce","falloff","knockback","sourceBarrelId","chainRadius","findBarrelByPosition","tolerance","clearAllBarrels","SpatialGrid","cellSize","cellX","cellY","cell","oldKey","newKey","results","cellRadius","centerKey","cx","cy","minX","minY","maxX","maxY","minCellX","minCellY","maxCellX","maxCellY","totalEntities","maxEntitiesInCell","minEntitiesInCell","audioContext","masterVolume","musicVolume","sfxVolume","uiSoundsEnabled","combatSoundsEnabled","currentMusic","currentMusicTrack","MUSIC_TRACKS","musicCache","initAudio","resumeAudioContext","getAudioContext","setMasterVolume","volume","setSfxVolume","setUiSoundsEnabled","enabled","setCombatSoundsEnabled","playTone","frequency","duration","ctx","osc","gainNode","finalVolume","attack","decay","playNoise","bufferSize","buffer","source","filter","vary","playPistolFire","variation","playSMGFire","playShotgunFire","freq","playSniperFire","playFlamethrowerFire","playExplosiveFire","playChainLightningFire","playOrbitalFire","playGenericFire","playEnemyHit","playPlayerHit","playEnemyDeath","playExplosion","playXPPickup","playCurrencyPickup","playLevelUp","baseFreq","mult","playDoorOpen","playMenuSelect","playMenuNav","playUpgradeSelect","playBossSpawn","playBossDeath","playAchievement","playPurchaseSuccess","playPurchaseError","playPause","playUnpause","playWeaponFire","weaponType","weaponName","setMusicVolume","stopMusic","playMusicTrack","trackName","loop","trackPath","playPromise","error","playMenuMusic","playCombatMusic","playDefeatMusic","createParticle","pool","releaseParticle","updateParticles","lifetimePercent","fadePercent","spawnBloodSplatter","chars","actualCount","actualSpeed","actualColor","speedMult","spawnDeathExplosion","isBoss","isMiniboss","spawnHitImpact","dirLen","dirNorm","spreadAngle","spawnTrailParticle","trailType","trailChars","particleColor","offsetX","createGlowEffect","glowType","glowEntity","updateGlowEffect","glow","spawnCosmeticDeath","deathType","enemyColor","spawnExplosiveDeath","spawnDisintegrateDeath","spawnVaporizeDeath","spawnPixelateDeath","spawnFireworksDeath","coreCount","SETTINGS_KEY","DEFAULT_SETTINGS","loadSettings","mergeDeep","output","isObject","saveSettings","settings","getSettings","updateSetting","getSetting","resetSettings","kInstance","originalCamPos","shakeTimer","shakeIntensity","inHitFreeze","lastShakeTime","MIN_SHAKE_INTERVAL","lastFreezeTime","MIN_FREEZE_INTERVAL","initVisualEffects","screenShake","intensity","currentTime","updateScreenShake","hitFreeze","isInHitFreeze","EffectPresets","resetVisualEffects","applySafeKnockback","knockbackDir","knockbackAmount","roomMargin","boundedX","boundedY","originalX","originalY","walls","allObstacles","colliding","setupCombatSystem","lastFireTime","initializeOrbitalWeapons","aimInput","mousePos","aimAngleDeg","enemies","bosses","minibosses","updateOrbitalWeapons","time","baseDirection","shouldFire","angleRad","effectiveFireRate","speedStacks","projectileCount","angleStep","startAngle","rad","cos","sin","delay","weaponRange","burnDamagePerTick","burnDuration","dotMultiplier","createExplosiveProjectile","createChainProjectile","wall","explodeProjectile","cover","maxReflections","reflectionCount","jumpCount","chainToNextEnemy","ownerPlayer","healAmount","lifestealMultiplier","impactDir","thornsDamage","reducedThornsDamage","enrageMultiplier","damageAfterReduction","orb","orbCount","orbitRadius","expectedOrbCount","rotationSpeed","explosionRadius","explosionDamage","chainRange","maxJumps","allTargets","currentEnemy","nearestEnemy","nearestDist","startPos","endPos","midX","midY","chainLine","TUTORIAL_HINTS","TUTORIAL_STORAGE_KEY","currentHint","loadTutorialProgress","stored","saveTutorialProgress","hasHintBeenShown","hintId","markHintShown","showHint","hint","hintBg","hintText","showMovementHint","showSynergyHint","SYNERGIES","newMaxHealth","minSafeHP","trackUpgrade","checkAndApplySynergies","activeSynergies","synergyKey","synergy","hasAllRequired","showSynergyNotification","notification","desc","reapplySynergies","upgradeDraftActive","showUpgradeDraft","onSelect","levelOverride","rerollsAvailable","inMultiplayer","toughChoicesLevel","mulliganLevel","numUpgradeOptions","rerollsRemaining","rerollSeed","generateUpgrades","upgradeRng","upgrades","titleText","createUpgradeCards","baseCardWidth","baseCardHeight","maxTotalWidth","cardWidth","cardHeight","availableWidth","cardY","cards","cardX","cardBg","iconColor","nameSize","descSize","description","numSize","selectUpgrade","rerollText","rerollButton","performReroll","activatedSynergies","synergyNames","isUpgradeDraftActive","setupProgressionSystem","reviveAllPlayersCallback","isMultiplayer","levelUpInProgress","adjustedAmount","handleLevelUp","ENEMY_SPAWN_WEIGHTS","getDefaultWeights","weightedRandom","weights","sum","weight","random","getRandomEnemyType","ELITE_MODIFIERS","ELITE_CONFIG","shouldSpawnElite","getRandomEliteModifier","modifiers","roll","applyEliteModifier","modifierKey","modifier","newChar","tryMakeElite","ROOM_WIDTH","ROOM_HEIGHT","ROOM_MARGIN","lastRoomTemplate","ROOM_TEMPLATES","constrainObstacleToRoom","halfWidth","halfHeight","getFloorColors","floorPalettes","palette","getWeightedRoomTemplate","allTemplates","availableTemplates","floorSpecific","universal","template","templatePool","finalPool","randomKey","getBarrelPositions","templateKey","positions","extraX","extraY","resetRoomTemplateHistory","getRoomTemplateByKey","runUnlockedAchievements","unlockAndNotify","initAchievementChecker","getRunUnlockedAchievements","checkAchievements","currentRunStats","savedStats","newlyUnlocked","check","condition","RoomNode","FloorMap","midRow","bossRow","startRoom","bossRoom","pos","room","maxBranches","branchesAdded","enemyCount","visited","queue","nextPos","exits","nextRoom","currentRoom","minimapGrid","row","adjRoom","connections","generateFloorMap","floorMap","MINIMAP_MODE","LAYOUT","COLORS","Minimap","el","bg","badge","grid","headerHeight","header","gridStartX","gridStartY","counter","legendHeight","padding","safeWidth","actualGridWidth","legendY","showBackground","col","cellBg","cellText","legends","colWidth","rowHeight","legend","itemX","itemY","symbol","label","createMinimap","FLOOR_THEMES","getFloorTheme","theme","generateFloorDecorations","decorations","deco","baseColor","perSide","renderFloorDecorations","PlayerState","playerId","json","EntityState","GameState","playerJson","entityJson","StateManager","gameMode","stateManager","PlayerInput","frameNumber","timestamp","input","InputManager","playerIds","inputs","InputManagerSingleton","inputManager","MessageType","NetworkMessage","senderId","NetworkManager","mode","sessionId","message","messages","eventType","handlers","NetworkManagerSingleton","networkManager","gameState","gameSceneMessageHandlersRegistered","applyPermanentUpgrades","upgradeLevels","useLocalStorage","healthLevel","damageLevel","speedLevel","applyRunBoosters","booster","boosterDef","effect","boosterText","setupGameScene","eventHandlers","doorEntered","roomCompleted","spawnDoors","reviveAllPlayers","spatialGrids","getSeededRoomRNG","roomSeed","generateFloorMapAndMinimap","floorRng","floorNames","getFloorName","floorTitle","floorSubtitle","doorMargin","playerSpawnX","playerSpawnY","characterOverride","wasRemote","savedHP","glowDef","trailDef","equippedCosmetics","networkInfo","players","roomRng","firstRoomTemplate","localOffsetX","remotePlayer","fullRunStats","nameTag","currentLocalSlot","localPlayerStats","door","isBossRoom","northDoor","completionText","completionMsg","obsData","upgradingPlayer","leveledPlayer","synergyPlayer","expiringPlayer","healedPlayer","dodgingPlayer","dodgeText","showEmote","emoteChar","emoteColor","lastEmoteTime","EMOTE_COOLDOWN","emotingPlayer","localPlayerId","secondWindLevel","revivedCount","playerKey","progressionSystem","pendingXP","currentRoomNode","roomTemplate","firstRoomKey","floorColors","isFirstRoom","safeZoneRadius","entranceDoorX","entranceDoorY","obstacleDataForBroadcast","shouldCreateObstacles","obs","distanceToSpawn","distanceToEntrance","obstacleRadius","constrainedPos","obstacleColor","distToSpawn","distToEntrance","overlapsObstacle","enemyIcon","enemiesCounter","creditText","playerCount","statusColor","statusText","xpBarWidth","xpBarHeight","xpBarY","initialXpProgress","initialXpWidth","xpBarFill","xpBarText","levelBadgeSize","levelBadgeX","levelBadgeY","levelText","playerHealthBarWidth","playerHealthBarHeight","playerHealthBarOffsetY","playerHealthBarBg","playerHealthBarFill","weaponIconSize","weaponIconX","weaponIconY","weaponIconBg","weaponIconText","weaponDetailWidth","weaponDetailHeight","weaponDetailBg","weaponDetailIcon","weaponDetailName","weaponDetailDamage","weaponDetailFireRate","weaponDetailDPS","weaponDetailState","powerupIconSize","powerupIconX","powerupIconY","powerupIconBg","powerupIconText","powerupAmmoText","buffsDisplayX","buffsDisplayY","buffIconSize","buffIconSpacing","activeBuffIcons","updateBuffDisplay","upgradesWithStacks","xPos","upgradeDef","stackText","levelUpButtonSize","levelUpButtonX","levelUpButtonY","levelUpButtonBg","levelUpButtonText","levelUpCountBadgeSize","levelUpCountBadgeX","levelUpCountBadgeY","levelUpCountBadge","levelUpCountText","levelUpGlowTime","outlineSize","brightness","tooltip","tooltipText","tooltipData","showTooltip","hideTooltip","saveTooltipState","restoreTooltipState","additionalEnemiesFromSplits","isBelowThreshold","speedMultiplier","timeSinceCombat","cooldown","regenPercent","trailInterval","distMoved","hovering","bossNameText","bossHealthBarBg","bossHealthBar","bossArmorBarBg","bossArmorBar","bossHealthText","bossArmorText","bossShieldBarBg","bossShieldBar","bossShieldText","xpProgress","healthBarX","healthBarY","fillWidth","fillBarX","currentEnemies","totalEnemies","enemiesToSpawn","isMinibossRoom","currentMinibosses","remainingEnemies","enemiesSpawned","minibossSpawned","dps","powerupDisplay","pendingCount","twinGuardians","meleeHP","rangedHP","totalHP","totalMaxHP","meleeShield","rangedShield","totalShield","totalMaxShield","meleeArmor","rangedArmor","totalArmor","totalMaxArmor","remainingBoss","bossHP","bossMaxHP","bossShieldHP","bossMaxShieldHP","bossArmorHP","bossMaxArmorHP","bossName","initialSpawnDelay","bossSpawned","entranceDoorExclusionTime","roomStartTime","minibossChance","getRandomMinibossType","minibossTypes","simpleTypes","getBossTypeForFloor","allDoorPositions","availableExits","availableGridDirs","exit","spawnDoor","enemySpawnTimer","enemySpawnInterval","roomStartTimeSet","bossType","bossRng","availableDoors","shuffled","oppositeMap","guardian","announcement","bossSpawnDoor","doorIndex","bossX","bossY","bossMinions","handleRoomCompletion","minibossType","minibossRng","doorsToUse","randomDoor","minibossX","minibossY","minibossName","spawnRng","timeSinceRoomStart","side","posX","posY","other","deathEffect","shrapnelCount","shrapnelSpeed","shrapnelDamage","killerSlot","lootRng","currencyDropCount","powerupDrop","minibossKillerSlot","minibossCurrencyCount","minibossCurrencyValue","deathText","bossKillerSlot","bossCurrencyCount","bossCurrencyValue","bossCurrencyIcon","pickupCheckRadius","nearbyPickups","closestPlayer","closestDistance","flashAge","doorProgressCircle","doorProgressBg","doorProgressTime","doorProgressDoor","doorProgressIsForced","DOOR_PROGRESS_DURATION","DOOR_FORCE_DURATION","hostInRange","allPlayersInRange","inRange","shouldShowProgress","isForced","handleDoorEntry","spawnRoomClearRewards","baseXP","baseCurrency","xpMultiplier","currencyMultiplier","floorBonus","numXPPickups","numCurrencyPickups","rewardRng","powerupKeys","numPowerups","randomPowerup","entryDirectionMap","unlockText","nextTemplate","runDuration","pauseOverlay","pauseText","pauseCenterY","LG","SM","resumeButton","quitButton","btn","updatePauseUI","yesButton","noButton","handleGameBlur","PORTRAIT_CATEGORIES","PORTRAITS","getPortraitById","getAllPortraits","checkPortraitUnlockCondition","saveData","portrait","statValue","getPortraitUnlockDescription","statName","DAILY_RUN_STORAGE_KEY","DAILY_CHARACTERS","getTodayDateString","getDailySeed","date","dateStr","getDailyCharacter","getTodayDailyCharacter","getDailyRunData","saveDailyRunData","hasCompletedDailyToday","today","getDailyCompletion","getTodayCompletion","markDailyCompleted","completion","getTodayAttemptCount","getDailyRunInfo","character","completed","attempts","createMenuButton","primaryColor","hoverColor","textColor","formattedText","isDisabled","setupMenuScene","audioResumed","resumeAudio","rightColumnX","profileCardX","profileCardY","profileCardWidth","profileCardHeight","profileCardBg","portraitSize","portraitX","portraitY","displayName","infoX","xpBarX","xpFillWidth","partyPanelX","partyPanelY","partyPanelWidth","slotHeight","slotSpacing","titlePadding","partyPanelHeight","slotsStartY","slotElements","updatePartySlots","elements","slotY","elementsForThisSlot","isClickable","slotBg","slotIcon","slotIconEl","charIcon","nameText","readyIcon","readyColor","readyText","activeEmote","emoteText","dcText","lastPartyCheck","updateStartButtonState","inviteCodeY","inviteCodeDisplay","hasValidCode","currentCode","joinButtonY","readyButtonY","readyButtonElements","countdownDisplay","lastReadyState","updateReadyButton","forceUpdate","countdown","isReady","countdownSeconds","readyBg","readyLabel","lastCountdownCheck","dailyPanelWidth","dailyPanelHeight","dailyPanelX","dailyRunY","dailyInfo","dailyChar","dailyDisabledInMultiplayer","dailyPlayButton","leaderboardsY","leaderboardsPanel","titleY","buttonStartY","buttonSpacing","XL","playButton","shouldDisable","characterButton","selectedCharData","isCharUnlocked","charDisplayX","charDisplayY","charDisplaySize","charDisplayBg","charDisplayIcon","shopButton","statisticsButton","settingsButton","menuButtons","buttonColorTime","button","spaceHandler","cHandler","sHandler","oHandler","tHandler","qHandler","eHandler","emoteCallback","goldenEnemy","rewardText","getCharactersUnlockedByAchievement","characters","modalState","showAchievementModal","onClose","closeAchievementModal","modalWidth","modalHeight","overlay","modalBg","iconText","descText","characterUnlocks","hasShopUnlocks","hasCharacterUnlocks","unlockParts","unlockKey","weapon","cosmetic","unlocksText","progressBaseY","progressY","progressBg","progressFill","progressText","unlockedText","creditReward","rewardY","rewardLabel","difficultyName","difficultyBadge","closeButton","closeText","escHandler","isAchievementModalOpen","LEADERBOARDS","CORS_PROXY","DREAMLO_RAW_URL","buildProxiedUrl","CACHE_DURATION_MS","leaderboardCaches","REQUEST_TIMEOUT_MS","sanitizeName","isValidScore","score","fetchWithTimeout","url","timeout","controller","timeoutId","response","submitOnlineScore","entry","boardType","board","seconds","submitDailyScore","parseEntry","textParts","getOnlineLeaderboard","limit","cache","entries","rawEntries","getGlobalRank","playerScore","result","sanitizedName","MAX_DAILY_ENTRIES","MAX_ALLTIME_ENTRIES","getLeaderboards","parsed","saveLeaderboards","calculateScore","floorScore","enemyScore","bossScore","timeBonus","submitScore","personal","getDailyLeaderboard","targetDate","getAllTimeLeaderboard","getPersonalBests","formatTime","mins","secs","formatScore","getPercentageColor","percent","createStatBar","maxValue","usePercentageColor","barHeight","fillColor","labelEl","barBg","barFill","valueEl","newValue","clampedValue","newPercent","getEnemyName","getEnemyChar","getEnemyColor","AWARDS","setupGameOverScene","isDailyRun","dailyCharacter","runDate","leaderboardResult","onlineScoreEntry","totalTeamCredits","unlockedAchievementIds","xpEarned","leveledUp","headerY","rankRowY","localRankText","globalRankLabel","tableStartY","numPlayers","playersToShow","awardWinners","award","bestPlayer","bestValue","tableWidth","tableX","labelColWidth","tableHeight","currentY","idx","colX","charColor","maxNameLen","activeAwardModal","showAwardModal","modalX","modalY","earnedText","closeHandler","playerAwards","totalWidth","awardIdx","awardX","awardBox","playerAchievements","maxIcons","iconSpacing","achId","achIdx","achX","achBox","moreCount","moreX","bucketSectionY","maxBucketWidth","bucketSpacing","calculatedBucketWidth","bucketWidth","bucketHeight","totalBucketsWidth","bucketStartX","playerBuckets","bucketX","credits","labelSize","currencyLabel","maxParticlesPerPlayer","particleSpawnDelay","particleFallSpeed","animationTimer","animationStartDelay","bucket","bucketIndex","targetParticles","particleValue","spawnTime","targetSpawned","bucketBottom","stackHeight","landingY","killPanelX","killPanelY","killPanelWidth","killPanelHeight","killsByType","sortedKills","killY","killSpacing","maxKillsToShow","showCount","shortName","remaining","footerY","xpColor","xpText","currentXP","barX","barY","isHostPlayer","buttonY","MD","buttonGap","playAgainEnabled","playAgainText","playAgainWidth","playAgainHeight","menuWidth","menuHeight","totalButtonWidth","buttonsStartX","playAgainBg","playAgainLabel","menuBg","menuLabel","setupShopScene","preventContextMenu","currentCategory","creditIndicator","tabY","tabSpacing","tabWidth","tabHeight","totalTabWidth","firstTabX","tabButtons","cat","tabX","isActive","tabBg","tabLabel","currentPage","refreshShop","contentY","unlockItems","ITEMS_PER_PAGE","paginationItems","isPurchasing","paginationClickHandled","currentCurrency","tab","updateRefundButton","unlocks","displayUnlocks","unlock","noItemsText","totalPages","startIndex","pageItems","itemSpacing","itemsPerColumn","getBenefitIcon","column","isAchievementLocked","requiredAchievement","isUnlockedChar","isUnlockedWeapon","isMaxedUpgrade","isCosmeticAchievementUnlocked","isOwnedCosmetic","isEquippedCosmetic","contentStartX","cosmeticIcon","cosmeticColor","benefit","benefitIcon","lockIcon","descWidth","descY","descriptionText","achievementProgress","miniBarWidth","miniBarHeight","miniBarX","miniBarY","miniBarBg","miniBarFill","bottomY","buttonX","buttonWidth","buttonHeight","canPurchase","purchaseCost","showProgressBar","progressLevel","progressMax","boosterCount","statusLabel","viewButtonBg","viewButtonText","achievementToShow","lockedText","buttonBg","buttonText","rightClickHandler","refundMsg","msgText","successMsg","errorMsg","equipButtonBg","equipButtonText","unequipButtonBg","unequipButtonText","noneKey","paginationY","paginationCenterX","pipSpacing","pipsStartX","pipsEndX","arrowOffset","leftArrowX","rightArrowX","leftArrowBg","leftArrowText","rightArrowBg","rightArrowText","isCurrentPage","pipX","pipBg","pipText","pageIndex","refundButton","refundText","refundableAmount","backButton","showResetConfirmationDialog","onConfirm","dialogBg","dialogEntities","closeDialog","cancelButton","cancelText","confirmButton","confirmText","messageText","escapeHandler","setupSettingsScene","fromGame","currentTab","tabs","refreshSettings","bottomButtonArea","settingsItems","addVolumeSlider","addToggle","controls","controlLabels","control","labelText","keyDisplay","keyText","maxContentY","noteText","exportButton","exportText","exportStatusText","importButton","importText","resetProgressButton","resetProgressText","warningText","onChange","trackWidth","trackHeight","track","getGradientColor","fill","handleX","handle","valueText","dragging","mouseX","trackLeft","localX","updateSlider","newFillWidth","toggleWidth","toggleHeight","toggleX","toggleBg","handleSize","toggleHandle","textX","toggleText","resetButton","hue2rgb","setupStatisticsScene","unlockedAchievements","achievementCategory","ACHIEVEMENTS_PER_PAGE","RUNS_PER_PAGE","isNavigating","selectedAchievement","refreshContent","viewportBottom","contentItems","categoryTabItems","allCategories","statsY","statsSpacing","stat","panelTop","categoryTabY","categoryTabWidth","categoryTabHeight","categoryTabSpacing","displayCategories","totalCategoryWidth","firstCategoryX","catX","catName","catBg","catLabel","categoryAchievements","pageAchievements","gridTop","boxSize","boxSpacing","boxesPerRow","leftPanelBg","gridPadding","isSelected","boxX","boxY","highlightColor","boxBg","rightPanelX","rightPanelBg","detailCenterX","detailTop","largeIcon","diffName","diffBadge","statusY","progressBgBar","progressFillBar","progressLabel","hintY","hintLabel","promptIcon","promptText","promptText2","goToPage","newPage","isCurrentPip","targetPage","totalAchievements","unlockedCount","progressPercent","isComplete","meterY","meterX","trophyIcon","trophyTime","totalBlocks","filledBlocks","emptyBlocks","meterString","meterFrame","filledMeter","rgb","percentText","sparkleTime","errorText","runHistory","historyY","noHistoryText","endIndex","displayRuns","headers","headerPositions","headerText","run","globalIndex","timeStr","showingStart","showingEnd","totalText","CHAR_ANIM","getUnlockText","setupCharacterSelectScene","selectedChar","characterKeys","leftPanelWidth","rightPanelWidth","cardSpacing","cardsPerRow","rowsPerPage","charactersPerPage","formatName","renderHighlightedDescription","maxWidth","statPattern","parts","matches","baseText","statSummary","highlightText","selectedIndex","characterCards","confirmedCharacterKey","viewedCharacterKey","detailItems","isRefreshing","refreshDisplay","card","pageStart","pageEnd","isViewed","isConfirmedSelection","charVisual","lockText","checkBadge","checkMark","viewedChar","isViewedUnlocked","detailY","previewPanelBg","charGlow","detailVisual","animLoop","breathe","bob","glowIntensity","detailName","descElements","statsLabel","statBarWidth","statBarX","statRowHeight","speedBar","damageBar","selectedIndicator","unlockTextStr","confirmButtonItems","updateConfirmButton","originalRefreshDisplay","initJoinPartyScene","originalState","joinCancelled","inputCode","inputDisplay","isJoining","updateDisplay","display","ch","attemptJoin","TABS","setupLeaderboardsScene","ENTRIES_PER_PAGE","CHARACTERS_PER_PAGE","contentElements","createTab","tabType","refreshTabs","renderContent","renderDailyContent","renderAllTimeContent","renderPersonalContent","renderGlobalContent","allEntries","dateLabel","charLabel","renderLeaderboardHeader","noData","rowY","isPlayer","globalRank","renderLeaderboardRow","renderPaginationControls","personalBests","pageCharacters","colPositions","divider","charKey","bests","scoreText","floorText","timeText","loadingText","retryBg","retryLabel","totalY","isCurrentPagePip","rank","isHighlighted","rankText","highlight","showNameEditDialog","currentName","onSave","inputBg","inputText","infoMsg","saveButton","saveText","charHandler","backspaceHandler","enterHandler","setupProfileScene","externalProfile","isViewingOther","selectedPortraitId","profileStats","profileLevel","profileXP","profileName","profileUnlockedPortraits","currentPortrait","infoY","nameDisplay","randomButtonX","editButtonX","editButton","newName","randomButton","stars","starDisplay","portraitsY","portraitsSectionHeight","allPortraits","gridY","maxPerRow","selectedInfoText","selectedDescText","updateSelectedInfo","boxColor","portraitBox","displayIcon","displayColor","statsHeight","totalRuns","avgCurrency","avgFloors","avgRooms","fastestTime","fastestMin","fastestSec","fastestDisplay","row1Stats","statWidth","playTime","hours","minutes","kaplay"],"mappings":"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E,GAAGC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEI,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEgB,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAA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","x_google_ignoreList":[0]}