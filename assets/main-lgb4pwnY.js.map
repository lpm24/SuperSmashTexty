{"version":3,"file":"main-lgb4pwnY.js","sources":["../../node_modules/kaplay/dist/kaplay.mjs","../../src/systems/nameGenerator.js","../../src/data/achievements.js","../../src/data/unlocks.js","../../src/systems/metaProgression.js","../../src/systems/inputSystem.js","../../src/data/weapons.js","../../src/config/constants.js","../../src/entities/player.js","../../src/systems/networkSystem.js","../../node_modules/@firebase/util/dist/index.esm2017.js","../../node_modules/@firebase/component/dist/esm/index.esm2017.js","../../node_modules/@firebase/logger/dist/esm/index.esm2017.js","../../node_modules/idb/build/wrap-idb-value.js","../../node_modules/idb/build/index.js","../../node_modules/@firebase/app/dist/esm/index.esm2017.js","../../node_modules/firebase/app/dist/esm/index.esm.js","../../node_modules/@firebase/database/dist/index.esm2017.js","../../src/systems/matchmakingSystem.js","../../src/systems/partySystem.js","../../src/data/bosses.js","../../src/entities/boss.js","../../src/systems/powerupWeapons.js","../../src/entities/pickup.js","../../src/utils/seededRandom.js","../../src/systems/connectionQuality.js","../../src/systems/upgrades.js","../../src/config/uiConfig.js","../../src/systems/toastNotifications.js","../../src/systems/multiplayerGame.js","../../src/systems/objectPool.js","../../src/entities/projectile.js","../../src/data/enemies.js","../../src/systems/pathfinding.js","../../src/entities/enemy.js","../../src/data/minibosses.js","../../src/entities/miniboss.js","../../src/entities/door.js","../../src/entities/obstacle.js","../../src/entities/barrel.js","../../src/systems/spatialGrid.js","../../src/systems/sounds.js","../../src/systems/settings.js","../../src/systems/particleSystem.js","../../src/systems/visualEffects.js","../../src/systems/combat.js","../../src/systems/tutorial.js","../../src/systems/synergies.js","../../src/scenes/upgradeDraft.js","../../src/systems/progression.js","../../src/systems/enemySpawn.js","../../src/systems/eliteSystem.js","../../src/systems/roomGeneration.js","../../src/systems/achievementChecker.js","../../src/systems/floorMap.js","../../src/systems/minimap.js","../../src/systems/floorTheming.js","../../src/core/GameState.js","../../src/core/InputManager.js","../../src/core/NetworkManager.js","../../src/scenes/game.js","../../src/data/portraits.js","../../src/systems/dailyRuns.js","../../src/scenes/menu.js","../../src/components/achievementModal.js","../../src/systems/onlineLeaderboards.js","../../src/systems/leaderboards.js","../../src/config/uiComponents.js","../../src/scenes/gameOver.js","../../src/scenes/shop.js","../../src/scenes/settings.js","../../src/scenes/statistics.js","../../src/scenes/characterSelect.js","../../src/scenes/joinParty.js","../../src/scenes/leaderboards.js","../../src/scenes/profile.js","../../src/main.js"],"sourcesContent":["var Oo=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return n=>{for(var r=n.length,o=new Uint8Array((r-(n[r-1]==\"=\")-(n[r-2]==\"=\"))*3/4|0),s=0,i=0;s<r;){var m=t[n.charCodeAt(s++)],u=t[n.charCodeAt(s++)],c=t[n.charCodeAt(s++)],p=t[n.charCodeAt(s++)];o[i++]=m<<2|u>>4,o[i++]=u<<4|c>>2,o[i++]=c<<6|p}return o}})();var Ao={name:\"kaplay\",description:\"KAPLAY is a JavaScript & TypeScript game library that helps you make games fast and fun! (formerly known as Kaboom.js)\",version:\"3001.0.19\",license:\"MIT\",homepage:\"https://kaplayjs.com/\",bugs:{url:\"https://github.com/kaplayjs/kaplay/issues\"},funding:{type:\"opencollective\",url:\"https://opencollective.com/kaplay\"},repository:{type:\"git\",url:\"git+https://github.com/kaplayjs/kaplay.git\"},type:\"module\",main:\"./dist/kaplay.cjs\",module:\"./dist/kaplay.mjs\",types:\"./dist/doc.d.ts\",readme:\"./README.md\",exports:{\".\":{import:{types:\"./dist/doc.d.ts\",default:\"./dist/kaplay.mjs\"},require:{types:\"./dist/doc.d.ts\",default:\"./dist/kaplay.cjs\"}},\"./global\":\"./dist/declaration/global.js\"},typesVersions:{\"*\":{global:[\"./dist/declaration/global.d.ts\"]}},keywords:[\"game development\",\"javascript\",\"typescript\",\"game engine\",\"2d games\",\"physics engine\",\"webgl\",\"canvas\",\"game library\",\"kaplay\",\"kaboom\",\"kaboomjs\",\"kaboom.js\"],files:[\"dist/\",\"kaplay.webp\",\"CHANGELOG.md\"],scripts:{dev:\"NODE_ENV=development node scripts/dev.js\",\"win:dev\":\"set NODE_ENV=development && node scripts/dev.js\",build:\"node scripts/generateIndex.js && npm run doc-dts && node scripts/build.js\",\"build:fast\":\"node scripts/buildFast.js\",check:\"tsc\",fmt:\"dprint fmt\",test:\"node scripts/test.js\",\"doc-dts\":\"dts-bundle-generator -o dist/doc.d.ts src/index.ts\",\"test:vite\":\"vitest --typecheck\",desktop:\"tauri dev\",prepare:\"npm run build\",\"publish:next\":\"npm publish --tag next\"},devDependencies:{\"@kaplayjs/dprint-config\":\"^1.2.0\",\"@types/jest\":\"^29.5.14\",dprint:\"^0.49.1\",\"dts-bundle-generator\":\"^9.5.1\",ejs:\"^3.1.10\",esbuild:\"^0.25.2\",express:\"^5.1.0\",puppeteer:\"^22.15.0\",\"tar-fs\":\"3.0.8\",typescript:\"5.6.3\",vite:\"5.4.16\",vitest:\"^3.1.1\",\"vitest-environment-puppeteer\":\"^11.0.3\",\"vitest-puppeteer\":\"^11.0.3\"},engines:{node:\">=20.0.0\"},packageManager:\"pnpm@9.9.0+sha512.60c18acd138bff695d339be6ad13f7e936eea6745660d4cc4a776d5247c540d0edee1a563695c183a66eb917ef88f2b4feb1fc25f32a7adcadc7aaf3438e99c1\"};function Te(t,e,n){return e>n?Te(t,n,e):Math.min(Math.max(t,e),n)}var j=class t{r=255;g=255;b=255;constructor(e,n,r){this.r=Te(e,0,255),this.g=Te(n,0,255),this.b=Te(r,0,255)}static fromArray(e){return new t(e[0],e[1],e[2])}static fromHex(e){if(typeof e==\"number\")return new t(e>>16&255,e>>8&255,e>>0&255);if(typeof e==\"string\"){let n=/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(e);if(!n)throw new Error(\"Invalid hex color format\");return new t(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}else throw new Error(\"Invalid hex color format\")}static fromHSL(e,n,r){if(n==0)return new t(255*r,255*r,255*r);let o=(p,b,l)=>(l<0&&(l+=1),l>1&&(l-=1),l<1/6?p+(b-p)*6*l:l<1/2?b:l<2/3?p+(b-p)*(2/3-l)*6:p),s=r<.5?r*(1+n):r+n-r*n,i=2*r-s,m=o(i,s,e+1/3),u=o(i,s,e),c=o(i,s,e-1/3);return new t(Math.round(m*255),Math.round(u*255),Math.round(c*255))}static RED=new t(255,0,0);static GREEN=new t(0,255,0);static BLUE=new t(0,0,255);static YELLOW=new t(255,255,0);static MAGENTA=new t(255,0,255);static CYAN=new t(0,255,255);static WHITE=new t(255,255,255);static BLACK=new t(0,0,0);clone(){return new t(this.r,this.g,this.b)}lighten(e){return new t(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(e){return new t(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,n){return new t(de(this.r,e.r,n),de(this.g,e.g,n),de(this.b,e.b,n))}toHSL(){let e=this.r/255,n=this.g/255,r=this.b/255,o=Math.max(e,n,r),s=Math.min(e,n,r),i=(o+s)/2,m=i,u=i;if(o==s)i=m=0;else{let c=o-s;switch(m=u>.5?c/(2-o-s):c/(o+s),o){case e:i=(n-r)/c+(n<r?6:0);break;case n:i=(r-e)/c+2;break;case r:i=(e-n)/c+4;break}i/=6}return[i,m,u]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return\"#\"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}};function I(...t){if(t.length===0)return new j(255,255,255);if(t.length===1){if(t[0]instanceof j)return t[0].clone();if(typeof t[0]==\"string\")return j.fromHex(t[0]);if(Array.isArray(t[0])&&t[0].length===3)return j.fromArray(t[0])}else if(t.length===2){if(t[0]instanceof j)return t[0].clone()}else if(t.length===3||t.length===4)return new j(t[0],t[1],t[2]);throw new Error(\"Invalid color arguments\")}var So=(t,e,n)=>j.fromHSL(t,e,n);function ae(t){return t*Math.PI/180}function lt(t){return t*180/Math.PI}function de(t,e,n){if(typeof t==\"number\"&&typeof e==\"number\")return t+(e-t)*n;if(t instanceof E&&e instanceof E)return t.lerp(e,n);if(t instanceof j&&e instanceof j)return t.lerp(e,n);throw new Error(`Bad value for lerp(): ${t}, ${e}. Only number, Vec2 and Color is supported.`)}function Se(t,e,n,r,o){return r+(t-e)/(n-e)*(o-r)}function Po(t,e,n,r,o){return Te(Se(t,e,n,r,o),r,o)}var E=class t{x=0;y=0;constructor(e=0,n=e){this.x=e,this.y=n}static fromAngle(e){let n=ae(e);return new t(Math.cos(n),Math.sin(n))}static fromArray(e){return new t(e[0],e[1])}static ZERO=new t(0,0);static ONE=new t(1,1);static LEFT=new t(-1,0);static RIGHT=new t(1,0);static UP=new t(0,-1);static DOWN=new t(0,1);clone(){return new t(this.x,this.y)}add(...e){let n=v(...e);return new t(this.x+n.x,this.y+n.y)}sub(...e){let n=v(...e);return new t(this.x-n.x,this.y-n.y)}scale(...e){let n=v(...e);return new t(this.x*n.x,this.y*n.y)}dist(...e){let n=v(...e);return this.sub(n).len()}sdist(...e){let n=v(...e);return this.sub(n).slen()}static sdist(e,n){let r=e.x-n.x,o=e.y-n.y;return r*r+o*o}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new t(0):this.scale(1/e)}normal(){return new t(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}static dot(e,n){return e.x*n.x+e.y*n.y}cross(e){return this.x*e.y-this.y*e.x}static cross(e,n){return e.x*n.y-e.y*n.x}angle(...e){let n=v(...e);return lt(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...e){let n=v(...e);return lt(Math.atan2(this.cross(n),this.dot(n)))}lerp(e,n){return new t(de(this.x,e.x,n),de(this.y,e.y,n))}slerp(e,n){let r=this.dot(e),o=this.cross(e),s=Math.atan2(o,r);return this.scale(Math.sin((1-n)*s)).add(e.scale(Math.sin(n*s))).scale(1/o)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new t(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new W(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}};function v(...t){if(t.length===1){if(t[0]instanceof E)return new E(t[0].x,t[0].y);if(Array.isArray(t[0])&&t[0].length===2)return new E(...t[0])}return new E(...t)}var q=class t{x=0;y=0;w=1;h=1;constructor(e,n,r,o){this.x=e,this.y=n,this.w=r,this.h=o}scale(e){return new t(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new E(this.x,this.y)}clone(){return new t(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function le(t,e,n,r){return new q(t,e,n,r)}var Dt=class t{a;b;c;d;constructor(e,n,r,o){this.a=e,this.b=n,this.c=r,this.d=o}mul(e){return new t(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return v(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new t(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new t(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,n=this.det,r=e+Math.sqrt(e*e-n),o=e-Math.sqrt(e*e-n);return[r,o]}eigenvectors(e,n){return this.c!=0?[[e-this.d,this.c],[n-this.d,this.c]]:this.b!=0?[[this.b,e-this.a],[this.b,n-this.a]]:Math.abs(this.transform(v(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let n=Math.cos(e),r=Math.sin(e);return new t(n,r,-r,n)}static scale(e,n){return new t(e,0,0,n)}};var bt=class t{m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(e,n,r,o,s,i,m,u,c){this.m11=e,this.m12=n,this.m13=r,this.m21=o,this.m22=s,this.m23=i,this.m31=m,this.m32=u,this.m33=c}static fromMat2(e){return new t(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new Dt(this.m11,this.m12,this.m21,this.m22)}mul(e){return new t(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let n=Math.cos(e),r=Math.sin(e),o=this.m11,s=this.m12;return this.m11=n*this.m11+r*this.m21,this.m12=n*this.m12+r*this.m22,this.m21=n*this.m21-r*o,this.m22=n*this.m22-r*s,this}scale(e,n){return this.m11*=e,this.m12*=e,this.m21*=n,this.m22*=n,this}get inverse(){let e=this.det;return new t((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new t(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},fe=class t{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new t([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new t([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=ae(-e);let n=Math.cos(e),r=Math.sin(e);return new t([1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1])}static rotateY(e){e=ae(-e);let n=Math.cos(e),r=Math.sin(e);return new t([n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1])}static rotateZ(e){e=ae(-e);let n=Math.cos(e),r=Math.sin(e);return new t([n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=ae(-e);let n=Math.cos(e),r=Math.sin(e),o=this.m[0],s=this.m[1],i=this.m[4],m=this.m[5];return this.m[0]=o*n+s*r,this.m[1]=-o*r+s*n,this.m[4]=i*n+m*r,this.m[5]=-i*r+m*n,this}mult(e){let n=[];for(let r=0;r<4;r++)for(let o=0;o<4;o++)n[r*4+o]=this.m[0*4+o]*e.m[r*4+0]+this.m[1*4+o]*e.m[r*4+1]+this.m[2*4+o]*e.m[r*4+2]+this.m[3*4+o]*e.m[r*4+3];return new t(n)}multVec2(e){return new E(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new E(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(n,e/n)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(e/n,n)}else return new E(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return lt(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return lt(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new E(0,0)}invert(){let e=[],n=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],o=this.m[9]*this.m[14]-this.m[13]*this.m[10],s=this.m[8]*this.m[15]-this.m[12]*this.m[11],i=this.m[8]*this.m[14]-this.m[12]*this.m[10],m=this.m[8]*this.m[13]-this.m[12]*this.m[9],u=this.m[6]*this.m[15]-this.m[14]*this.m[7],c=this.m[5]*this.m[15]-this.m[13]*this.m[7],p=this.m[5]*this.m[14]-this.m[13]*this.m[6],b=this.m[4]*this.m[15]-this.m[12]*this.m[7],l=this.m[4]*this.m[14]-this.m[12]*this.m[6],h=this.m[5]*this.m[15]-this.m[13]*this.m[7],d=this.m[4]*this.m[13]-this.m[12]*this.m[5],C=this.m[6]*this.m[11]-this.m[10]*this.m[7],g=this.m[5]*this.m[11]-this.m[9]*this.m[7],y=this.m[5]*this.m[10]-this.m[9]*this.m[6],O=this.m[4]*this.m[11]-this.m[8]*this.m[7],A=this.m[4]*this.m[10]-this.m[8]*this.m[6],R=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*n-this.m[6]*r+this.m[7]*o,e[4]=-(this.m[4]*n-this.m[6]*s+this.m[7]*i),e[8]=this.m[4]*r-this.m[5]*s+this.m[7]*m,e[12]=-(this.m[4]*o-this.m[5]*i+this.m[6]*m),e[1]=-(this.m[1]*n-this.m[2]*r+this.m[3]*o),e[5]=this.m[0]*n-this.m[2]*s+this.m[3]*i,e[9]=-(this.m[0]*r-this.m[1]*s+this.m[3]*m),e[13]=this.m[0]*o-this.m[1]*i+this.m[2]*m,e[2]=this.m[1]*u-this.m[2]*c+this.m[3]*p,e[6]=-(this.m[0]*u-this.m[2]*b+this.m[3]*l),e[10]=this.m[0]*h-this.m[1]*b+this.m[3]*d,e[14]=-(this.m[0]*p-this.m[1]*l+this.m[2]*d),e[3]=-(this.m[1]*C-this.m[2]*g+this.m[3]*y),e[7]=this.m[0]*C-this.m[2]*O+this.m[3]*A,e[11]=-(this.m[0]*g-this.m[1]*O+this.m[3]*R),e[15]=this.m[0]*y-this.m[1]*A+this.m[2]*R;let V=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let x=0;x<4;x++)for(let w=0;w<4;w++)e[x*4+w]*=1/V;return new t(e)}clone(){return new t([...this.m])}toString(){return this.m.toString()}};function An(t,e,n,r=o=>-Math.cos(o)){return t+(r(n)+1)/2*(e-t)}var tu=1103515245,nu=12345,Vo=2147483648,Xt=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(tu*this.seed+nu)%Vo,this.seed/Vo}genNumber(e,n){return e+this.gen()*(n-e)}genVec2(e,n){return new E(this.genNumber(e.x,n.x),this.genNumber(e.y,n.y))}genColor(e,n){return new j(this.genNumber(e.r,n.r),this.genNumber(e.g,n.g),this.genNumber(e.b,n.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]==\"number\")return this.genNumber(0,e[0]);if(e[0]instanceof E)return this.genVec2(v(0,0),e[0]);if(e[0]instanceof j)return this.genColor(I(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]==\"number\"&&typeof e[1]==\"number\")return this.genNumber(e[0],e[1]);if(e[0]instanceof E&&e[1]instanceof E)return this.genVec2(e[0],e[1]);if(e[0]instanceof j&&e[1]instanceof j)return this.genColor(e[0],e[1])}throw new Error(\"More than 2 arguments not supported\")}},wr=new Xt(Date.now());function Go(t){return t!=null&&(wr.seed=t),wr.seed}function he(...t){return wr.genAny(...t)}function Cr(...t){return Math.floor(he(...t.length>0?t:[2]))}function Mo(t){return he()<=t}function Er(t){for(let e=t.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function Ro(t,e){return t.length<=e?t.slice():Er(t.slice()).slice(0,e)}function Do(t){return t[Cr(t.length)]}function Tr(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}function ru(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let n=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(n===0)return null;let r=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/n,o=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/n;return r<0||r>1||o<0||o>1?null:r}function Sn(t,e){let n=ru(t,e);return n?v(t.p1.x+n*(t.p2.x-t.p1.x),t.p1.y+n*(t.p2.y-t.p1.y)):null}function Vn(t,e){let n=e.p2.sub(e.p1),r=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;if(n.x!=0){let s=(t.pos.x-e.p1.x)/n.x,i=(t.pos.x+t.width-e.p1.x)/n.x;r=Math.max(r,Math.min(s,i)),o=Math.min(o,Math.max(s,i))}if(n.y!=0){let s=(t.pos.y-e.p1.y)/n.y,i=(t.pos.y+t.height-e.p1.y)/n.y;r=Math.max(r,Math.min(s,i)),o=Math.min(o,Math.max(s,i))}return o>=r&&o>=0&&r<=1}function Bt(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}function Bo(t,e){let n=Math.max(t.pos.x,Math.min(e.center.x,t.pos.x+t.width)),r=Math.max(t.pos.y,Math.min(e.center.y,t.pos.y+t.height));return v(n,r).sdist(e.center)<=e.radius*e.radius}function Fo(t,e){return Lo(e,new be(t.points()))}function Pn(t,e){let n=e.sub(t.p1),r=t.p2.sub(t.p1);if(Math.abs(n.cross(r))>Number.EPSILON)return!1;let o=n.dot(r)/r.dot(r);return o>=0&&o<=1}function Ft(t,e){let n=t.p2.sub(t.p1),r=n.dot(n),o=t.p1.sub(e.center),s=2*n.dot(o),i=o.dot(o)-e.radius*e.radius,m=s*s-4*r*i;if(r<=Number.EPSILON||m<0)return!1;if(m==0){let u=-s/(2*r);if(u>=0&&u<=1)return!0}else{let u=(-s+Math.sqrt(m))/(2*r),c=(-s-Math.sqrt(m))/(2*r);if(u>=0&&u<=1||c>=0&&c<=1)return!0}return Gn(e,t.p1)}function Or(t,e){if(et(e,t.p1)||et(e,t.p2))return!0;for(let n=0;n<e.pts.length;n++){let r=e.pts[n],o=e.pts[(n+1)%e.pts.length];if(Sn(t,new Oe(r,o)))return!0}return!1}function Gn(t,e){return t.center.sdist(e)<t.radius*t.radius}function ou(t,e){return t.center.sdist(e.center)<(t.radius+e.radius)*(t.radius+e.radius)}function Qt(t,e){let n=e.pts[e.pts.length-1];for(let r of e.pts){if(Ft(new Oe(n,r),t))return!0;n=r}return Gn(t,e.pts[0])?!0:et(e,t.center)}function Lo(t,e){for(let n=0;n<t.pts.length;n++)if(Or(new Oe(t.pts[n],t.pts[(n+1)%t.pts.length]),e))return!0;return!!(t.pts.some(n=>et(e,n))||e.pts.some(n=>et(t,n)))}function et(t,e){let n=!1,r=t.pts;for(let o=0,s=r.length-1;o<r.length;s=o++)r[o].y>e.y!=r[s].y>e.y&&e.x<(r[s].x-r[o].x)*(e.y-r[o].y)/(r[s].y-r[o].y)+r[o].x&&(n=!n);return n}function Ar(t,e){e=e.sub(t.center);let n=ae(t.angle),r=Math.cos(n),o=Math.sin(n),s=e.x*r+e.y*o,i=-e.x*o+e.y*r;return s*s/(t.radiusX*t.radiusX)+i*i/(t.radiusY*t.radiusY)<1}function Tn(t,e){let n=e.center.sub(t.center),r=ae(t.angle),o=Math.cos(r),s=Math.sin(r),i=n.x*o+n.y*s,m=-n.x*s+n.y*o;return Ar(new Ke(v(),t.radiusX+e.radius,t.radiusY+e.radius,0),v(i,m))}function jo(t,e){let n=t.toMat2().inverse;return e=new Oe(n.transform(e.p1.sub(t.center)),n.transform(e.p2.sub(t.center))),Ft(e,new we(v(),1))}function su(t,e){if(t.radiusX===t.radiusY)return Tn(e,new we(t.center,t.radiusX));if(e.radiusX===e.radiusY)return Tn(t,new we(e.center,e.radiusX));let n=new bt(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),r=new bt(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),o=t.center.x,s=t.center.y,i=e.center.x,m=e.center.y,u=ae(t.angle),c=ae(e.angle),p=new bt(Math.cos(u),-Math.sin(u),o,Math.sin(u),Math.cos(u),s,0,0,1),b=new bt(Math.cos(c),-Math.sin(c),i,Math.sin(c),Math.cos(c),m,0,0,1),l=p.inverse,h=b.inverse,d=l.transpose.mul(n).mul(l),C=h.transpose.mul(r).mul(h),g=d.m11,y=d.m12,O=d.m13,A=d.m21,R=d.m22,V=d.m23,x=d.m31,w=d.m32,S=d.m33,G=C.m11,M=C.m12,D=C.m13,L=C.m21,U=C.m22,H=C.m23,Y=C.m31,_=C.m32,K=C.m33,J=g*R*S-g*V*w-y*A*S+y*V*x+O*A*w-O*R*x,$=(g*R*K-g*V*_-g*w*H+g*S*U-y*A*K+y*V*Y+y*x*H-y*S*L+O*A*_-O*R*Y-O*x*U+O*w*L+A*w*D-A*S*M-R*x*D+R*S*G+V*x*M-V*w*G)/J,Z=(g*U*K-g*H*_-y*L*K+y*H*Y+O*L*_-O*U*Y-A*M*K+A*D*_+R*G*K-R*D*Y-V*G*_+V*M*Y+x*M*H-x*D*U-w*G*H+w*D*L+S*G*U-S*M*L)/J,Ee=(G*U*K-G*H*_-M*L*K+M*H*Y+D*L*_-D*U*Y)/J;if($>=0){let k=-3*Z+$**2,gt=3*$*Ee+Z*$**2-4*Z**2,Gt=-27*Ee**2+18*Ee*$*Z+$**2*Z**2-4*$**3*Ee-4*Z**3;return!(k>0&&gt<0&&Gt>0)}else{let k=-3*Z+$**2,gt=-27*Ee**2+18*Ee*$*Z+$**2*Z**2-4*$**3*Ee-4*Z**3;return!(k>0&&gt>0)}}function Io(t,e){return Sr(t,new be(e.points()))}function Sr(t,e){let n=t.toMat2().inverse;return e=new be(e.pts.map(r=>n.transform(r.sub(t.center)))),Qt(new we(v(),1),e)}function iu(t,e){return t.x===e.x&&t.y===e.y}function au(t,e){return e instanceof E?iu(e,t.pt):e instanceof we?Gn(e,t.pt):e instanceof Oe?Pn(e,t.pt):e instanceof W?Bt(e,t.pt):e instanceof be?et(e,t.pt):e instanceof Ke?Ar(e,t.pt):!1}function uu(t,e){return e instanceof E?Pn(t,e):e instanceof we?Ft(t,e):e instanceof Oe?Sn(t,e)!=null:e instanceof W?Vn(e,t):e instanceof be?Or(t,e):e instanceof Ke?jo(e,t):!1}function cu(t,e){return e instanceof E?Gn(t,e):e instanceof we?ou(t,e):e instanceof Oe?Ft(e,t):e instanceof W?Bo(e,t):e instanceof be?Qt(t,e):e instanceof Ke?Tn(e,t):!1}function lu(t,e){return e instanceof E?Bt(t,e):e instanceof we?Bo(t,e):e instanceof Oe?Vn(t,e):e instanceof W?Tr(t,e):e instanceof be?Fo(t,e):e instanceof Ke?Io(e,t):!1}function mu(t,e){return e instanceof E?et(t,e):e instanceof we?Qt(e,t):e instanceof Oe?Or(e,t):e instanceof W?Fo(e,t):e instanceof be?Lo(e,t):e instanceof Ke?Sr(e,t):!1}function pu(t,e){return e instanceof E?Ar(t,e):e instanceof we?Tn(t,e):e instanceof Oe?jo(t,e):e instanceof W?Io(t,e):e instanceof be?Sr(t,e):e instanceof Ke?su(e,t):!1}function Ko(t,e,n){let r=t,o=n.p1,s=n.p2,i=e,m=s.sub(o),u=i.cross(m);if(Math.abs(u)<Number.EPSILON)return null;let c=o.sub(r),p=c.cross(m)/u;if(p<=0||p>=1)return null;let b=c.cross(i)/u;if(b<=0||b>=1)return null;let l=m.normal().unit();return e.dot(l)>0&&(l.x*=-1,l.y*=-1),{point:r.add(i.scale(p)),normal:l,fraction:p}}function du(t,e,n){let r=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,s;if(t.x!=0){let i=(n.pos.x-t.x)/e.x,m=(n.pos.x+n.width-t.x)/e.x;s=v(-Math.sign(e.x),0),r=Math.max(r,Math.min(i,m)),o=Math.min(o,Math.max(i,m))}if(t.y!=0){let i=(n.pos.y-t.y)/e.y,m=(n.pos.y+n.height-t.y)/e.y;Math.min(i,m)>r&&(s=v(0,-Math.sign(e.y))),r=Math.max(r,Math.min(i,m)),o=Math.min(o,Math.max(i,m))}return o>=r&&r>=0&&r<=1?{point:t.add(e.scale(r)),normal:s,fraction:r}:null}function ko(t,e,n){let r=t,o=n.center,s=e,i=s.dot(s),m=r.sub(o),u=2*s.dot(m),c=m.dot(m)-n.radius*n.radius,p=u*u-4*i*c;if(i<=Number.EPSILON||p<0)return null;if(p==0){let b=-u/(2*i);if(b>=0&&b<=1){let l=r.add(s.scale(b));return{point:l,normal:l.sub(o),fraction:b}}}else{let b=(-u+Math.sqrt(p))/(2*i),l=(-u-Math.sqrt(p))/(2*i),h=null;if(b>=0&&b<=1&&(h=b),l>=0&&l<=1&&(h=Math.min(l,h??l)),h!=null){let d=r.add(s.scale(h));return{point:d,normal:d.sub(o).unit(),fraction:h}}}return null}function fu(t,e,n){let r=n.pts,o=null,s=r[r.length-1];for(let i=0;i<r.length;i++){let m=r[i],u=Ko(t,e,new Oe(s,m));u&&(!o||o.fraction>u.fraction)&&(o=u),s=m}return o}function hu(t,e,n){let r=n.toMat2(),o=r.inverse,s=o.transform(t.sub(n.center)),i=o.transform(e),m=ko(s,i,new we(v(),1));if(m){let u=Dt.rotation(ae(-n.angle)),p=Dt.scale(n.radiusX,n.radiusY).transform(m.point),b=r.transform(m.point).add(n.center),l=b.dist(t)/e.len();return{point:b,normal:u.transform(v(n.radiusY**2*p.x,n.radiusX**2*p.y)).unit(),fraction:l}}return m}function _o(t,e,n,r=64){let o=t,s=e.len(),i=e.scale(1/s),m=0,u=v(Math.floor(t.x),Math.floor(t.y)),c=v(i.x>0?1:-1,i.y>0?1:-1),p=v(Math.abs(1/i.x),Math.abs(1/i.y)),b=v(c.x>0?u.x+1-t.x:t.x-u.x,c.y>0?u.y+1-t.y:t.y-u.y),l=v(p.x<1/0?p.x*b.x:1/0,p.y<1/0?p.y*b.y:1/0),h=-1;for(;m<=r;){let d=n(u);if(d===!0)return{point:o.add(i.scale(m)),normal:v(h===0?-c.x:0,h===1?-c.y:0),fraction:m/s,gridPos:u};if(d)return d;l.x<l.y?(u.x+=c.x,m=l.x,l.x+=p.x,h=0):(u.y+=c.y,m=l.y,l.y+=p.y,h=1)}return null}var On=class t{pt;constructor(e){this.pt=e.clone()}transform(e){return new t(e.multVec2(this.pt))}bbox(){return new W(this.pt,0,0)}area(){return 0}clone(){return new t(this.pt)}collides(e){return au(this,e)}contains(e){return this.pt.eq(e)}raycast(e,n){return null}random(){return this.pt.clone()}},Oe=class t{p1;p2;constructor(e,n){this.p1=e.clone(),this.p2=n.clone()}transform(e){return new t(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return W.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new t(this.p1,this.p2)}collides(e){return uu(this,e)}contains(e){return this.collides(e)}raycast(e,n){return Ko(e,n,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(he(1)))}},W=class t{pos;width;height;constructor(e,n,r){this.pos=e.clone(),this.width=n,this.height=r}static fromPoints(e,n){return new t(e.clone(),n.x-e.x,n.y-e.y)}center(){return new E(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new be(this.points().map(n=>e.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new t(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let n=this.pos,r=this.pos.add(this.width,this.height),o=Math.max(n.x-e.x,0,e.x-r.x),s=Math.max(n.y-e.y,0,e.y-r.y);return o*o+s*s}collides(e){return lu(this,e)}contains(e){return this.collides(e)}raycast(e,n){return du(e,n,this)}random(){return this.pos.add(he(this.width),he(this.height))}},we=class t{center;radius;constructor(e,n){this.center=e.clone(),this.radius=n}transform(e){return new Ke(this.center,this.radius,this.radius).transform(e)}bbox(){return W.fromPoints(this.center.sub(v(this.radius)),this.center.add(v(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new t(this.center,this.radius)}collides(e){return cu(this,e)}contains(e){return this.collides(e)}raycast(e,n){return ko(e,n,this)}random(){return this.center.add(E.fromAngle(he(360)).scale(he(this.radius)))}},Ke=class t{center;radiusX;radiusY;angle;constructor(e,n,r,o=0){this.center=e.clone(),this.radiusX=n,this.radiusY=r,this.angle=o}static fromMat2(e){let n=e.inverse,r=n.transpose.mul(n),[o,s]=r.eigenvalues,[i,m]=r.eigenvectors(o,s),[u,c]=[1/Math.sqrt(o),1/Math.sqrt(s)];return u>c?new t(v(),u,c,lt(Math.atan2(-i[1],i[0]))):new t(v(),c,u,lt(Math.atan2(-m[1],m[0])))}toMat2(){let e=ae(this.angle),n=Math.cos(e),r=Math.sin(e);return new Dt(n*this.radiusX,-r*this.radiusY,r*this.radiusX,n*this.radiusY)}transform(e){if(this.angle==0&&e.getRotation()==0)return new t(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY);{let n=this.toMat2(),r=e.getRotation(),o=e.getScale();n=bt.fromMat2(n).scale(o.x,o.y).rotate(r).toMat2();let i=t.fromMat2(n);return i.center=e.multVec2(this.center),i}}bbox(){if(this.angle==0)return W.fromPoints(this.center.sub(v(this.radiusX,this.radiusY)),this.center.add(v(this.radiusX,this.radiusY)));{let e=ae(this.angle),n=Math.cos(e),r=Math.sin(e),o=this.radiusX*n,s=this.radiusX*r,i=this.radiusY*r,m=this.radiusY*n,u=Math.sqrt(o*o+i*i),c=Math.sqrt(s*s+m*m);return W.fromPoints(this.center.sub(v(u,c)),this.center.add(v(u,c)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new t(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return pu(this,e)}contains(e){e=e.sub(this.center);let n=ae(this.angle),r=Math.cos(n),o=Math.sin(n),s=e.x*r+e.y*o,i=-e.x*o+e.y*r;return s*s/(this.radiusX*this.radiusX)+i*i/(this.radiusY*this.radiusY)<1}raycast(e,n){return hu(e,n,this)}random(){return this.center}};function gu(t,e,n,r){let o=e.sub(t),s=r.sub(n),i=o.cross(s);return i<1e-5&&i>-1e-5||(i=n.sub(t).cross(s)/i,i<0||i>1)?null:t.add(o.scale(i))}var be=class t{pts;constructor(e){if(e.length<3)throw new Error(\"Polygons should have at least 3 vertices\");this.pts=e}transform(e){return new t(this.pts.map(n=>e.multVec2(n)))}bbox(){let e=v(Number.MAX_VALUE),n=v(-Number.MAX_VALUE);for(let r of this.pts)e.x=Math.min(e.x,r.x),n.x=Math.max(n.x,r.x),e.y=Math.min(e.y,r.y),n.y=Math.max(n.y,r.y);return W.fromPoints(e,n)}area(){let e=0,n=this.pts.length;for(let r=0;r<n;r++){let o=this.pts[r],s=this.pts[(r+1)%n];e+=o.x*s.y*.5,e-=s.x*o.y*.5}return Math.abs(e)}clone(){return new t(this.pts.map(e=>e.clone()))}collides(e){return mu(this,e)}contains(e){return this.collides(e)}raycast(e,n){return fu(e,n,this)}random(){return v()}cut(e,n){let r=new Oe(e,n),o=[],s=[],i=n.sub(e),m=this.pts[this.pts.length-1],u=m.sub(e),c=i.cross(u)>0;return this.pts.forEach(p=>{u=p.sub(e);let b=i.cross(u)>0;if(c!=b){let l=gu(m,p,e,n);o.push(l),s.push(l),c=b}(b?o:s).push(p),m=p}),[o.length?new t(o):null,s.length?new t(s):null]}};function No(t,e,n,r){let o=r*r,s=1-r,i=s*s;return t.scale(i).add(e.scale(2*s*r)).add(n.scale(o))}function Uo(t,e,n,r){let o=1-r;return e.sub(t).scale(2*o).add(n.sub(e).scale(2*r))}function Ho(t,e,n,r){return n.sub(e.scale(2)).add(t).scale(2)}function Jt(t,e,n,r,o){let s=o*o,i=s*o,m=1-o,u=m*m,c=u*m;return t.scale(c).add(e.scale(3*u*o)).add(n.scale(3*m*s)).add(r.scale(i))}function qo(t,e,n,r,o){let s=o*o,i=1-o,m=i*i;return e.sub(t).scale(3*m).add(n.sub(e).scale(6*i*o)).add(r.sub(n).scale(3*s))}function zo(t,e,n,r,o){let s=1-o;return n.sub(e.scale(2)).add(t).scale(6*s).add(r.sub(n.scale(2)).add(e).scale(6*o))}function Wo(t,e,n,r,o){let s=.5*(((-o+2)*o-1)*o),i=.5*((3*o-5)*o*o+2),m=.5*(((-3*o+4)*o+1)*o),u=.5*((o-1)*o*o);return t.scale(s).add(e.scale(i)).add(n.scale(m)).add(r.scale(u))}function Yo(t,e,n,r,o){let s=.5*((-3*o+4)*o-1),i=.5*((9*o-10)*o),m=.5*((-9*o+8)*o+1),u=.5*((3*o-2)*o);return t.scale(s).add(e.scale(i)).add(n.scale(m)).add(r.scale(u))}function $o(t){let e=Vr(t),n=e(1);return r=>{let o=r*n,s=e(o,!0);return t(s)}}function Vr(t,e=10,n=10){let r=[0],o=[0],i=1/(e-1)/n,m=0,u=t(0),c=0;for(let p=1;p<e;p++){for(let b=0;b<n;b++){c+=i;let l=t(c),h=l.dist(u);m+=h,u=l}r[p]=m,o[p]=c}return o[e-1]=1,(p,b=!1)=>{if(b){let l=p;if(l<=0)return 0;if(l>=m)return 1;let h=0;for(;r[h+1]<l;)h++;let d=o[h],C=o[h+1],g=r[h],y=r[h+1],O=(l-g)/(y-g);return d+(C-d)*O}else{if(p<=0)return 0;if(p>=1)return r[e-1];let l=0;for(;o[l+1]<p;)l++;let h=o[l],d=o[l+1],C=r[l],g=r[l+1],y=(p-h)/(d-h);return C+(g-C)*y}}}function Lt(t,e,n,r){let o=2*t+e-2*r+n,s=-3*t+3*r-2*e-n,i=e,m=t;return u=>{let c=u*u,p=c*u;return o*p+s*c+i*u+m}}function Pr(t,e,n,r,o,s=Lt){let i=s(e.x,(1-o)*(n.x-t.x),(1-o)*(r.x-e.x),n.x),m=s(e.y,(1-o)*(n.y-t.y),(1-o)*(r.y-e.y),n.y);return u=>new E(i(u),m(u))}function jt(t,e,n,r,o=Lt){return Pr(t,e,n,r,.5,o)}function Xo(t,e,n,r,o=Lt){return jt(r.add(t.sub(e).scale(6)),t,r,t.add(r.sub(n).scale(6)),o)}function Qo(t,e,n,r,o,s,i,m=Lt){let u=m(e.x,.5*(1-o)*(1+i)*(1+s)*(e.x-t.x)+.5*(1-o)*(1-i)*(1-s)*(n.x-e.x),.5*(1-o)*(1+i)*(1-s)*(n.x-e.x)+.5*(1-o)*(1-i)*(1+s)*(r.x-n.x),n.x),c=m(e.y,.5*(1-o)*(1+i)*(1+s)*(e.y-t.y)+.5*(1-o)*(1-i)*(1-s)*(n.y-e.y),.5*(1-o)*(1+i)*(1-s)*(n.y-e.y)+.5*(1-o)*(1-i)*(1+s)*(r.y-n.y),n.y);return p=>new E(u(p),c(p))}function Jo(t,e,n,r){let o=2*t+e-2*r+n,s=-3*t+3*r-2*e+n,i=e;return m=>{let u=m*m;return 3*o*u+2*s*m+i}}function Yt(t){return 0<=t&&t<=1}function xr(t,e){return Math.abs(t-e)<=Number.EPSILON}function $t(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function bu(t,e,n,r){let o=3*t-6*e+3*n,s=-3*t+3*e,i=t,m=-t+3*e-3*n+r;if(xr(m,0)){if(xr(o,0))return xr(s,0)?[]:[-i/s].filter(Yt);let y=Math.sqrt(s*s-4*o*i),O=2*o;return[(y-s)/O,(-s-y)/O].filter(Yt)}o/=m,s/=m,i/=m;let u=(3*s-o*o)/3,c=u/3,p=(2*o*o*o-9*o*s+27*i)/27,b=p/2,l=b*b+c*c*c;if(l<0){let y=-u/3,O=y*y*y,A=Math.sqrt(O),R=-p/(2*A),V=R<-1?-1:R>1?1:R,x=Math.acos(V),S=2*$t(A),G=S*Math.cos(x/3)-o/3,M=S*Math.cos((x+2*Math.PI)/3)-o/3,D=S*Math.cos((x+4*Math.PI)/3)-o/3;return[G,M,D].filter(Yt)}if(l===0){let y=b<0?$t(-b):-$t(b),O=2*y-o/3,A=-y-o/3;return[O,A].filter(Yt)}let h=Math.sqrt(l),d=$t(h-b),C=$t(h+b);return[d-C-o/3].filter(Yt)}function yu(t,e,n,r,o){let s=bu(t.x-o,e.x-o,n.x-o,r.x-o);return s.length>0?Jt(t,e,n,r,s[0]).y:NaN}function Zo(t){if(!t||t.length==0)throw new Error(\"Need at least one point for easingLinear.\");let e=t.length;return n=>{if(n<=0||t.length==1||n<=t[0].x)return t[0].y;for(let r=0;r<e;r++)if(t[r].x>=n)return Se(n,t[r-1].x,t[r].x,t[r-1].y,t[r].y);return t[t.length-1].y}}function es(t,e){return n=>yu(v(0,0),t,e,v(1,1),n)}function ts(t,e=\"jump-end\"){let n=1/t,r=e==\"jump-start\"||e==\"jump-both\",o=e==\"jump-end\"||e==\"jump-both\",s=1/(t+(o?1:0)),i=r?s:0;return m=>{let u=Math.floor(m/n);return i+u*s}}function ns(t,e){let n=Number.MAX_VALUE,r={normal:v(0),distance:0};for(let o of[t,e])for(let s=0;s<o.pts.length;s++){let i=o.pts[s],u=o.pts[(s+1)%o.pts.length].sub(i).normal().unit(),c=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let d=0;d<t.pts.length;d++){let C=t.pts[d].dot(u);c=Math.min(c,C),p=Math.max(p,C)}let b=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let d=0;d<e.pts.length;d++){let C=e.pts[d].dot(u);b=Math.min(b,C),l=Math.max(l,C)}let h=Math.min(p,l)-Math.max(c,b);if(h<0)return null;if(h<Math.abs(n)){let d=l-c,C=b-p;n=Math.abs(d)<Math.abs(C)?d:C,r.normal=u,r.distance=n}}return r}function rs(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)>=0}function xu(t){let e=0,n=t[t.length-1];for(let r=0;r<t.length;r++)e+=(t[r].x-n.x)*(t[r].y+n.y),n=t[r];return e<0}function vr(t,e,n,r){let o=r.x-n.x,s=r.y-n.y,i=o*(t.y-n.y)-s*(t.x-n.x),m=o*(e.y-n.y)-s*(e.x-n.x);return i*m>=0}function vu(t,e,n,r){return vr(t,e,n,r)&&vr(t,n,e,r)&&vr(t,r,e,n)}function wu(t,e,n,r){for(let o of t)if(o!==e&&o!==n&&o!==r&&vu(o,e,n,r))return!0;return!1}function Cu(t,e,n,r){return rs(t,e,n)&&!wu(r,t,e,n)}function Mn(t){if(t.length<3)return[];if(t.length==3)return[t];let e=[],n=[],r=0;for(let b=0;b<t.length;b++){let l=t[r],h=t[b];(h.x<l.x||h.x==l.x&&h.y<l.y)&&(r=r),e[b]=b+1,n[b]=b-1}e[e.length-1]=0,n[0]=n.length-1,xu(t)||([e,n]=[n,e]);let o=[];for(let b=0;b<t.length;++b)rs(t[n[b]],t[b],t[e[b]])||o.push(t[b]);let s=[],i=t.length,m=1,u=0,c,p;for(;i>3;){c=e[m],p=n[m];let b=t[p],l=t[m],h=t[c];if(Cu(b,l,h,o))s.push([b,l,h]),e[p]=c,n[c]=p,o.splice(o.indexOf(l),1),--i,u=0;else if(++u>i)return[];m=c}return c=e[m],p=n[m],s.push([t[p],t[m],t[c]]),s}function os(t){if(t.length<3)return!1;let e=t.length-2,n=t.length-1,r=0,o=t[n].sub(t[e]),s=t[r].sub(t[n]),i=o.cross(s);for(;r+1<t.length;)if(e=n,n=r,r++,o=t[n].sub(t[e]),s=t[r].sub(t[n]),o.cross(s)*i<0)return!1;return!0}var Rn=\" !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\",mt=\"topleft\";var ss=\"monospace\",yt=\"monospace\";var Zt=\"linear\";var en=[{name:\"a_pos\",size:2},{name:\"a_uv\",size:2},{name:\"a_color\",size:4}],Eu=en.reduce((t,e)=>t+e.size,0),is=2048,as=is*4*Eu,us=is*6,cs=`\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n`,ls=`\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\tvec4 texColor = texture2D(u_tex, v_uv);\n\treturn vec4((v_color.rgb * texColor.rgb), texColor.a) * v_color.a;\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n`,tn=`\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n`,nn=`\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n`,ms=new Set([\"id\",\"require\"]),ps=new Set([\"add\",\"fixedUpdate\",\"update\",\"draw\",\"destroy\",\"inspect\",\"drawInspect\"]),Gr=200,ds=640,fs=65536,Dn=Symbol.for(\"kaplay.cancel\");var rn=class extends Map{lastID=0;push(e){let n=this.lastID;return this.set(n,e),this.lastID++,n}pushd(e){let n=this.push(e);return()=>this.delete(n)}},ke=class t{paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let n=new t(()=>e.forEach(r=>r.cancel()));return Object.defineProperty(n,\"paused\",{get:()=>e[0].paused,set:r=>e.forEach(o=>o.paused=r)}),n.paused=!1,n}static replace(e,n){return e.cancel=()=>n.cancel(),n.paused=e.paused,Object.defineProperty(e,\"paused\",{get:()=>n.paused,set:r=>n.paused=r}),e}},re=class{cancellers=new WeakMap;handlers=new rn;add(e){function n(...s){if(!o.paused)return e(...s)}let r=this.handlers.pushd(n),o=new ke(r);return this.cancellers.set(n,r),o}addOnce(e){let n=this.add((...r)=>{n.cancel(),e(...r)});return n}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(n=>{let r=n(...e),o;r===Dn&&(o=this.cancellers.get(n))&&o()})}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},ze=class{handlers={};registers={};on(e,n){return this.handlers[e]||(this.handlers[e]=new re),this.handlers[e].add(n)}onOnce(e,n){let r=this.on(e,(...o)=>{r.cancel(),n(...o)});return r}next(e){return new Promise(n=>{this.onOnce(e,(...r)=>n(r[0]))})}trigger(e,...n){this.handlers[e]&&this.handlers[e].trigger(...n)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};var hs=t=>t[0]instanceof j,gs=t=>t[0]instanceof E,bs=t=>typeof t[0]==\"number\";var It=class{_items;_compareFn;constructor(e=(n,r)=>n<r){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],n=this._items.pop();return this._items.length!==0&&(this._items[0]=n,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let n=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[n])&&this._items[e]>=this._items[n])break;this.swap(e,n),e=n}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let n=2*e+1;if(n<this._items.length-1&&!this._compareFn(this._items[n],this._items[n+1])&&++n,this._compareFn(this._items[e],this._items[n]))break;this.swap(e,n),e=n}}swap(e,n){[this._items[e],this._items[n]]=[this._items[n],this._items[e]]}get length(){return this._items.length}};function Tu(t){let e=window.atob(t),n=e.length,r=new Uint8Array(n);for(let o=0;o<n;o++)r[o]=e.charCodeAt(o);return r.buffer}function ys(t){return Tu(t.split(\",\")[1])}function Bn(t,e){let n=document.createElement(\"a\");n.href=e,n.download=t,n.click()}function Mr(t,e){Bn(t,\"data:text/plain;charset=utf-8,\"+e)}function xs(t,e){Mr(t,JSON.stringify(e))}function Rr(t,e){let n=URL.createObjectURL(e);Bn(t,n),URL.revokeObjectURL(n)}var Fn=t=>t.match(/^data:\\w+\\/\\w+;base64,.+/);var vs=t=>t.split(\".\").slice(0,-1).join(\".\");function Ln(t,e){if(t===e)return!0;let n=typeof t,r=typeof e;if(n!==r)return!1;if(n===\"object\"&&r===\"object\"&&t!==null&&e!==null){if(Array.isArray(t)!==Array.isArray(e))return!1;let o=Object.keys(t),s=Object.keys(e);if(o.length!==s.length)return!1;for(let i of o){let m=t[i],u=e[i];if(!Ln(m,u))return!1}return!0}return!1}var ws=new Set,Cs=t=>t instanceof Error?t.message:String(t);function Ou(t){ws.has(t)||(ws.add(t),console.warn(t))}function tt(t,e){Ou(`${t} is deprecated. Use ${e} instead.`)}function on(t,e){return Number(t.toFixed(e))}function ne(t,e){return(...n)=>{let r=n.length;if(r===t.length)return t(...n);if(r===e.length)return e(...n)}}var Au=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Ts(t){if(typeof t!=\"string\")throw new TypeError(\"string cannot be undefined or null\");let e=[],n=0,r=0;for(;n<t.length;){if(r+=Su(n+r,t),Bu(t[n+r])&&r++,Mu(t[n+r])&&r++,Ru(t[n+r])&&r++,Fu(t[n+r])){r++;continue}e.push(t.substring(n,n+r)),n+=r,r=0}return e}function Su(t,e){let n=e[t];if(!Vu(n)||t===e.length-1)return 1;let r=n+e[t+1],o=e.substring(t+2,t+5);return Es(r)&&Es(o)?4:Pu(r)&&Du(o)?e.slice(t).indexOf(String.fromCodePoint(917631))+2:Gu(o)?4:2}function Vu(t){return t&&xt(t[0].charCodeAt(0),55296,56319)}function Es(t){return xt(Dr(t),127462,127487)}function Pu(t){return xt(Dr(t),127988,127988)}function Gu(t){return xt(Dr(t),127995,127999)}function Mu(t){return typeof t==\"string\"&&xt(t.charCodeAt(0),65024,65039)}function Ru(t){return typeof t==\"string\"&&xt(t.charCodeAt(0),8400,8447)}function Du(t){let e=t.codePointAt(0);return typeof t==\"string\"&&typeof e==\"number\"&&xt(e,917504,917631)}function Bu(t){return typeof t==\"string\"&&Au.includes(t.charCodeAt(0))}function Fu(t){return typeof t==\"string\"&&t.charCodeAt(0)===8205}function Dr(t){let e=t.charCodeAt(0)-55296,n=t.charCodeAt(1)-56320;return(e<<10)+n+65536}function xt(t,e,n){return t>=e&&t<=n}var De=(t,e)=>Array.isArray(t)?t?.includes(e):t===e,We=(t,e)=>Array.isArray(e)?e.some(n=>t.has(n)):t.has(e),sn=(t,e,n)=>{t.has(e)?t.get(e)?.push(n):t.set(e,[n])};var Os=(()=>{let t=0;return()=>t++})();var As={\"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"6\":\"ltrigger\",\"7\":\"rtrigger\",\"8\":\"select\",\"9\":\"start\",\"10\":\"lstick\",\"11\":\"rstick\",\"12\":\"dpad-up\",\"13\":\"dpad-down\",\"14\":\"dpad-left\",\"15\":\"dpad-right\",\"16\":\"home\",\"17\":\"capture\"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},\"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"9\":\"select\",\"10\":\"lstick\",\"16\":\"start\"},sticks:{left:{x:0,y:1}}},\"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"9\":\"start\",\"10\":\"lstick\",\"16\":\"select\"},sticks:{left:{x:0,y:1}}},\"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)\":{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"6\":\"ltrigger\",\"7\":\"rtrigger\",\"8\":\"select\",\"9\":\"start\",\"10\":\"lstick\",\"11\":\"rstick\",\"12\":\"dpad-up\",\"13\":\"dpad-down\",\"14\":\"dpad-left\",\"15\":\"dpad-right\",\"16\":\"home\",\"17\":\"capture\"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{\"0\":\"south\",\"1\":\"east\",\"2\":\"west\",\"3\":\"north\",\"4\":\"lshoulder\",\"5\":\"rshoulder\",\"6\":\"ltrigger\",\"7\":\"rtrigger\",\"8\":\"select\",\"9\":\"start\",\"10\":\"lstick\",\"11\":\"rstick\",\"12\":\"dpad-up\",\"13\":\"dpad-down\",\"14\":\"dpad-left\",\"15\":\"dpad-right\",\"16\":\"home\"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}};function jn(){let t=a.globalOpt.pixelDensity??1,e=a.globalOpt.width,n=a.globalOpt.height,r=a.gfx.ggl.gl.drawingBufferWidth,o=a.gfx.ggl.gl.drawingBufferHeight,s=r/t,i=o/t,m=0,u=0,c=s,p=i;if(a.globalOpt.letterbox){if(!e||!n)throw new Error(\"Letterboxing requires width and height defined.\");let b=s/i,l=e/n;if(b>l){let h=i*l;m=(s-h)/2,c=h}else{let h=s/l;p=h,u=(i-h)/2}}if(a.globalOpt.stretch&&(!a.globalOpt.width||!a.globalOpt.height))throw new Error(\"Stretching requires width and height defined.\");a.gfx.viewport={x:m,y:u,width:c,height:p,scale:(a.gfx.viewport.width+a.gfx.viewport.height)/(a.gfx.width+a.gfx.height)}}function Ss(t){return new E(t.x*a.gfx.viewport.width/a.gfx.width,t.y*a.gfx.viewport.height/a.gfx.height)}function Qe(t){return new E((t.x-a.gfx.viewport.x)*a.gfx.width/a.gfx.viewport.width,(t.y-a.gfx.viewport.y)*a.gfx.height/a.gfx.viewport.height)}var Vs=()=>pt.lastInputDevice,Ps=()=>{let t=pt.buttons;for(let e in t){let n=t[e].keyboard&&[t[e].keyboard].flat(),r=t[e].keyboardCode&&[t[e].keyboardCode].flat(),o=t[e].gamepad&&[t[e].gamepad].flat(),s=t[e].mouse&&[t[e].mouse].flat();n&&n.forEach(i=>{sn(pt.buttonsByKey,i,e)}),r&&r.forEach(i=>{sn(pt.buttonsByKeyCode,i,e)}),o&&o.forEach(i=>{sn(pt.buttonsByGamepad,i,e)}),s&&s.forEach(i=>{sn(pt.buttonsByMouse,i,e)})}};var vt=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},Br=class{buttonState=new vt;stickState=new Map},Fr=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((n,r)=>n+r)/this.dts.length)),this.dts=[])}},pt,Gs=As,ju=t=>{let e=t.buttons??{};return{canvas:t.canvas,buttons:e,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new Fr,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new E(0),mouseDeltaPos:new E(0),keyState:new vt,mouseState:new vt,mergedGamepadState:new Br,gamepadStates:new Map,lastInputDevice:null,buttonState:new vt,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new ze}},Ms=t=>{if(!t.canvas)throw new Error(\"Please provide a canvas\");let e=ju(t);pt=e,Ps();function n(){return e.dt*e.timeScale}function r(){return e.fixedDt*e.timeScale}function o(){return e.restDt*e.timeScale}function s(){return e.isHidden}function i(){return e.time}function m(){return e.fpsCounter.fps}function u(){return e.numFrames}function c(){return e.canvas.toDataURL()}function p(f){e.canvas.style.cursor=f}function b(){return e.canvas.style.cursor}function l(f){if(f)try{let T=e.canvas.requestPointerLock();T?.catch&&T.catch(P=>console.error(P))}catch(T){console.error(T)}else document.exitPointerLock()}function h(){return!!document.pointerLockElement}function d(f){f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen&&f.webkitRequestFullscreen()}function C(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function g(f=!0){f?d(e.canvas):C()}function y(){return document.fullscreenElement===e.canvas||document.webkitFullscreenElement===e.canvas}function O(){e.stopped=!0;let f=Object.entries(Me),T=Object.entries(br),P=Object.entries(En);for(let[B,te]of f)e.canvas.removeEventListener(B,te);for(let[B,te]of T)document.removeEventListener(B,te);for(let[B,te]of P)window.removeEventListener(B,te);To.disconnect()}function A(f,T){e.loopID!==null&&cancelAnimationFrame(e.loopID);let P=0,B=0,te=Ae=>{if(e.stopped)return;if(document.visibilityState!==\"visible\"){e.loopID=requestAnimationFrame(te);return}let se=Ae/1e3,Ze=Math.min(se-e.realTime,.25),Rt=t.maxFPS?1/t.maxFPS:0;if(e.realTime=se,B+=Ze,B>Rt){if(!e.skipTime){for(P+=B,e.dt=e.fixedDt,e.restDt=0;P>e.fixedDt;)P-=e.fixedDt,P<e.fixedDt&&(e.restDt=P),f();e.restDt=P,e.dt=B,e.time+=n(),e.fpsCounter.tick(e.dt)}B=0,e.skipTime=!1,e.numFrames++,T(Cn,Xa)}e.loopID=requestAnimationFrame(te)};te(0)}function R(){return\"ontouchstart\"in window||navigator.maxTouchPoints>0}function V(){return e.mousePos.clone()}function x(){return e.mouseDeltaPos.clone()}function w(f=\"left\"){return e.mouseState.pressed.has(f)}function S(f=\"left\"){return e.mouseState.down.has(f)}function G(f=\"left\"){return e.mouseState.released.has(f)}function M(){return e.isMouseMoved}function D(f){return f===void 0?e.keyState.pressed.size>0:We(e.keyState.pressed,f)}function L(f){return f===void 0?e.keyState.pressedRepeat.size>0:We(e.keyState.pressedRepeat,f)}function U(f){return f===void 0?e.keyState.down.size>0:We(e.keyState.down,f)}function H(f){return f===void 0?e.keyState.released.size>0:We(e.keyState.released,f)}function Y(f){return f===void 0?e.mergedGamepadState.buttonState.pressed.size>0:We(e.mergedGamepadState.buttonState.pressed,f)}function _(f){return f===void 0?e.mergedGamepadState.buttonState.down.size>0:We(e.mergedGamepadState.buttonState.down,f)}function K(f){return f===void 0?e.mergedGamepadState.buttonState.released.size>0:We(e.mergedGamepadState.buttonState.released,f)}function J(f){return f===void 0?e.buttonState.pressed.size>0:We(e.buttonState.pressed,f)}function $(f){return f===void 0?e.buttonState.down.size>0:We(e.buttonState.down,f)}function Z(f){return f===void 0?e.buttonState.released.size>0:We(e.buttonState.released,f)}function Ee(f){return e.buttons?.[f]}function k(f,T){e.buttons[f]={...e.buttons[f],...T}}function gt(f){e.buttonState.press(f),e.events.trigger(\"buttonPress\",f)}function Gt(f){e.buttonState.release(f),e.events.trigger(\"buttonRelease\",f)}function Ht(f){return e.events.on(\"resize\",f)}let yn=ne(f=>e.events.on(\"keyDown\",f),(f,T)=>e.events.on(\"keyDown\",P=>De(f,P)&&T(P))),xn=ne(f=>e.events.on(\"keyPress\",T=>f(T)),(f,T)=>e.events.on(\"keyPress\",P=>De(f,P)&&T(P))),mr=ne(f=>e.events.on(\"keyPressRepeat\",f),(f,T)=>e.events.on(\"keyPressRepeat\",P=>De(f,P)&&T(P))),pr=ne(f=>e.events.on(\"keyRelease\",f),(f,T)=>e.events.on(\"keyRelease\",P=>De(f,P)&&T(P))),Mt=ne(f=>e.events.on(\"mouseDown\",T=>f(T)),(f,T)=>e.events.on(\"mouseDown\",P=>De(f,P)&&T(P))),$e=ne(f=>e.events.on(\"mousePress\",T=>f(T)),(f,T)=>e.events.on(\"mousePress\",P=>De(f,P)&&T(P))),vn=ne(f=>e.events.on(\"mouseRelease\",T=>f(T)),(f,T)=>e.events.on(\"mouseRelease\",P=>P===f&&T(P)));function F(f){return e.events.on(\"mouseMove\",()=>f(V(),x()))}function N(f){return e.events.on(\"charInput\",f)}function z(f){return e.events.on(\"touchStart\",f)}function oe(f){return e.events.on(\"touchMove\",f)}function ye(f){return e.events.on(\"touchEnd\",f)}function Q(f){return e.events.on(\"scroll\",f)}function ve(f){return e.events.on(\"hide\",f)}function qt(f){return e.events.on(\"show\",f)}let ut=ne(f=>e.events.on(\"gamepadButtonPress\",(T,P)=>f(T,P)),(f,T)=>e.events.on(\"gamepadButtonPress\",(P,B)=>De(f,P)&&T(P,B))),dr=ne(f=>e.events.on(\"gamepadButtonDown\",(T,P)=>f(T,P)),(f,T)=>e.events.on(\"gamepadButtonDown\",(P,B)=>De(f,P)&&T(P,B))),fr=ne(f=>e.events.on(\"gamepadButtonRelease\",(T,P)=>f(T,P)),(f,T)=>e.events.on(\"gamepadButtonRelease\",(P,B)=>De(f,P)&&T(P,B)));function hr(f,T){return e.events.on(\"gamepadStick\",(P,B,te)=>P===f&&T(B,te))}function gr(f){e.events.on(\"gamepadConnect\",f)}function wn(f){e.events.on(\"gamepadDisconnect\",f)}function Xe(f){return e.mergedGamepadState.stickState.get(f)||new E(0)}function ct(){return[...e.charInputted]}function zt(){return[...e.gamepads]}let Ie=ne(f=>e.events.on(\"buttonPress\",T=>f(T)),(f,T)=>e.events.on(\"buttonPress\",P=>De(f,P)&&T(P))),Wt=ne(f=>e.events.on(\"buttonDown\",T=>f(T)),(f,T)=>e.events.on(\"buttonDown\",P=>De(f,P)&&T(P))),Je=ne(f=>e.events.on(\"buttonRelease\",T=>f(T)),(f,T)=>e.events.on(\"buttonRelease\",P=>De(f,P)&&T(P)));function Cn(){e.events.trigger(\"input\"),e.keyState.down.forEach(f=>e.events.trigger(\"keyDown\",f)),e.mouseState.down.forEach(f=>e.events.trigger(\"mouseDown\",f)),e.buttonState.down.forEach(f=>{e.events.trigger(\"buttonDown\",f)}),Ja()}function Xa(){e.keyState.update(),e.mouseState.update(),e.buttonState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((f,T)=>{e.mergedGamepadState.stickState.set(T,new E(0))}),e.charInputted=[],e.isMouseMoved=!1,e.mouseDeltaPos=new E(0),e.gamepadStates.forEach(f=>{f.buttonState.update(),f.stickState.forEach((T,P)=>{f.stickState.set(P,new E(0))})})}function vo(f){let T={index:f.index,isPressed:P=>e.gamepadStates.get(f.index)?.buttonState.pressed.has(P)||!1,isDown:P=>e.gamepadStates.get(f.index)?.buttonState.down.has(P)||!1,isReleased:P=>e.gamepadStates.get(f.index)?.buttonState.released.has(P)||!1,getStick:P=>e.gamepadStates.get(f.index)?.stickState.get(P)||v()};return e.gamepads.push(T),e.gamepadStates.set(f.index,{buttonState:new vt,stickState:new Map([[\"left\",new E(0)],[\"right\",new E(0)]])}),T}function Qa(f){e.gamepads=e.gamepads.filter(T=>T.index!==f.index),e.gamepadStates.delete(f.index)}function Ja(){for(let f of navigator.getGamepads())f&&!e.gamepadStates.has(f.index)&&vo(f);for(let f of e.gamepads){let T=navigator.getGamepads()[f.index];if(!T)continue;let B=(t.gamepads??{})[T.id]||Gs[T.id]||Gs.default,te=e.gamepadStates.get(f.index);if(te){for(let Ae=0;Ae<T.buttons.length;Ae++){let se=B.buttons[Ae],Ze=T.buttons[Ae],Rt=e.buttonsByGamepad.has(se);if(Ze.pressed){if(te.buttonState.down.has(se)){e.events.trigger(\"gamepadButtonDown\",se,f);continue}e.lastInputDevice=\"gamepad\",Rt&&e.buttonsByGamepad.get(se)?.forEach(Re=>{e.buttonState.press(Re),e.events.trigger(\"buttonPress\",Re)}),e.mergedGamepadState.buttonState.press(se),te.buttonState.press(se),e.events.trigger(\"gamepadButtonPress\",se,f)}else te.buttonState.down.has(se)&&(Rt&&e.buttonsByGamepad.get(se)?.forEach(Re=>{e.buttonState.release(Re),e.events.trigger(\"buttonRelease\",Re)}),e.mergedGamepadState.buttonState.release(se),te.buttonState.release(se),e.events.trigger(\"gamepadButtonRelease\",se,f))}for(let Ae in B.sticks){let se=B.sticks[Ae];if(!se)continue;let Ze=new E(T.axes[se.x],T.axes[se.y]);te.stickState.set(Ae,Ze),e.mergedGamepadState.stickState.set(Ae,Ze),e.events.trigger(\"gamepadStick\",Ae,Ze,f)}}}}let Me={},br={},En={},wo=t.pixelDensity||1;Me.mousemove=f=>{let T=Qe(new E(f.offsetX,f.offsetY)),P=new E(f.movementX,f.movementY);if(y()){let B=e.canvas.width/wo,te=e.canvas.height/wo,Ae=window.innerWidth,se=window.innerHeight,Ze=Ae/se,Rt=B/te;if(Ze>Rt){let Re=se/te,yr=(Ae-B*Re)/2;T.x=Se(f.offsetX-yr,0,B*Re,0,B),T.y=Se(f.offsetY,0,te*Re,0,te)}else{let Re=Ae/B,yr=(se-te*Re)/2;T.x=Se(f.offsetX,0,B*Re,0,B),T.y=Se(f.offsetY-yr,0,te*Re,0,te)}}e.events.onOnce(\"input\",()=>{e.isMouseMoved=!0,e.mousePos=T,e.mouseDeltaPos=P,e.events.trigger(\"mouseMove\")})};let Co=[\"left\",\"middle\",\"right\",\"back\",\"forward\"];Me.mousedown=f=>{e.events.onOnce(\"input\",()=>{let T=Co[f.button];T&&(e.lastInputDevice=\"mouse\",e.buttonsByMouse.has(T)&&e.buttonsByMouse.get(T)?.forEach(P=>{e.buttonState.press(P),e.events.trigger(\"buttonPress\",P)}),e.mouseState.press(T),e.events.trigger(\"mousePress\",T))})},Me.mouseup=f=>{e.events.onOnce(\"input\",()=>{let T=Co[f.button];T&&(e.buttonsByMouse.has(T)&&e.buttonsByMouse.get(T)?.forEach(P=>{e.buttonState.release(P),e.events.trigger(\"buttonRelease\",P)}),e.mouseState.release(T),e.events.trigger(\"mouseRelease\",T))})};let Za=new Set([\" \",\"ArrowLeft\",\"ArrowRight\",\"ArrowUp\",\"ArrowDown\",\"Tab\"]),Eo={ArrowLeft:\"left\",ArrowRight:\"right\",ArrowUp:\"up\",ArrowDown:\"down\",\" \":\"space\"};Me.keydown=f=>{Za.has(f.key)&&f.preventDefault(),e.events.onOnce(\"input\",()=>{let T=Eo[f.key]||f.key.toLowerCase(),P=f.code;if(T===void 0)throw new Error(`Unknown key: ${f.key}`);T.length===1?(e.events.trigger(\"charInput\",T),e.charInputted.push(T)):T===\"space\"&&(e.events.trigger(\"charInput\",\" \"),e.charInputted.push(\" \")),f.repeat?(e.keyState.pressRepeat(T),e.events.trigger(\"keyPressRepeat\",T)):(e.lastInputDevice=\"keyboard\",e.buttonsByKey.has(T)&&e.buttonsByKey.get(T)?.forEach(B=>{e.buttonState.press(B),e.events.trigger(\"buttonPress\",B)}),e.buttonsByKeyCode.has(P)&&e.buttonsByKeyCode.get(P)?.forEach(B=>{e.buttonState.press(B),e.events.trigger(\"buttonPress\",B)}),e.keyState.press(T),e.events.trigger(\"keyPressRepeat\",T),e.events.trigger(\"keyPress\",T))})},Me.keyup=f=>{e.events.onOnce(\"input\",()=>{let T=Eo[f.key]||f.key.toLowerCase(),P=f.code;e.buttonsByKey.has(T)&&e.buttonsByKey.get(T)?.forEach(B=>{e.buttonState.release(B),e.events.trigger(\"buttonRelease\",B)}),e.buttonsByKeyCode.has(P)&&e.buttonsByKeyCode.get(P)?.forEach(B=>{e.buttonState.release(B),e.events.trigger(\"buttonRelease\",B)}),e.keyState.release(T),e.events.trigger(\"keyRelease\",T)})},Me.touchstart=f=>{f.preventDefault(),e.events.onOnce(\"input\",()=>{let T=[...f.changedTouches],P=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=Qe(new E(T[0].clientX-P.x,T[0].clientY-P.y)),e.lastInputDevice=\"mouse\",e.buttonsByMouse.has(\"left\")&&e.buttonsByMouse.get(\"left\")?.forEach(B=>{e.buttonState.press(B),e.events.trigger(\"buttonPress\",B)}),e.mouseState.press(\"left\"),e.events.trigger(\"mousePress\",\"left\")),T.forEach(B=>{e.events.trigger(\"touchStart\",Qe(new E(B.clientX-P.x,B.clientY-P.y)),B)})})},Me.touchmove=f=>{f.preventDefault(),e.events.onOnce(\"input\",()=>{let T=[...f.changedTouches],P=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){let B=e.mousePos;e.mousePos=Qe(new E(T[0].clientX-P.x,T[0].clientY-P.y)),e.mouseDeltaPos=e.mousePos.sub(B),e.events.trigger(\"mouseMove\")}T.forEach(B=>{e.events.trigger(\"touchMove\",Qe(new E(B.clientX-P.x,B.clientY-P.y)),B)})})},Me.touchend=f=>{e.events.onOnce(\"input\",()=>{let T=[...f.changedTouches],P=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=Qe(new E(T[0].clientX-P.x,T[0].clientY-P.y)),e.mouseDeltaPos=new E(0,0),e.buttonsByMouse.has(\"left\")&&e.buttonsByMouse.get(\"left\")?.forEach(B=>{e.buttonState.release(B),e.events.trigger(\"buttonRelease\",B)}),e.mouseState.release(\"left\"),e.events.trigger(\"mouseRelease\",\"left\")),T.forEach(B=>{e.events.trigger(\"touchEnd\",Qe(new E(B.clientX-P.x,B.clientY-P.y)),B)})})},Me.touchcancel=f=>{e.events.onOnce(\"input\",()=>{let T=[...f.changedTouches],P=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=Qe(new E(T[0].clientX-P.x,T[0].clientY-P.y)),e.mouseState.release(\"left\"),e.events.trigger(\"mouseRelease\",\"left\")),T.forEach(B=>{e.events.trigger(\"touchEnd\",Qe(new E(B.clientX-P.x,B.clientY-P.y)),B)})})},Me.wheel=f=>{f.preventDefault(),e.events.onOnce(\"input\",()=>{e.events.trigger(\"scroll\",new E(f.deltaX,f.deltaY))})},Me.contextmenu=f=>f.preventDefault(),br.visibilitychange=()=>{document.visibilityState===\"visible\"?(e.skipTime=!0,e.isHidden=!1,e.events.trigger(\"show\")):(e.isHidden=!0,e.events.trigger(\"hide\"))},En.gamepadconnected=f=>{let T=vo(f.gamepad);e.events.onOnce(\"input\",()=>{e.events.trigger(\"gamepadConnect\",T)})},En.gamepaddisconnected=f=>{let T=zt().filter(P=>P.index===f.gamepad.index)[0];Qa(f.gamepad),e.events.onOnce(\"input\",()=>{e.events.trigger(\"gamepadDisconnect\",T)})};for(let[f,T]of Object.entries(Me))e.canvas.addEventListener(f,T);for(let[f,T]of Object.entries(br))document.addEventListener(f,T);for(let[f,T]of Object.entries(En))window.addEventListener(f,T);let To=new ResizeObserver(f=>{for(let T of f)if(T.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce(\"input\",()=>{e.events.trigger(\"resize\")})}});return To.observe(e.canvas),{state:e,dt:n,fixedDt:r,restDt:o,time:i,run:A,canvas:e.canvas,fps:m,numFrames:u,quit:O,isHidden:s,setFullscreen:g,isFullscreen:y,setCursor:p,screenshot:c,getGamepads:zt,getCursor:b,setCursorLocked:l,isCursorLocked:h,isTouchscreen:R,mousePos:V,mouseDeltaPos:x,isKeyDown:U,isKeyPressed:D,isKeyPressedRepeat:L,isKeyReleased:H,isMouseDown:S,isMousePressed:w,isMouseReleased:G,isMouseMoved:M,isGamepadButtonPressed:Y,isGamepadButtonDown:_,isGamepadButtonReleased:K,getGamepadStick:Xe,isButtonPressed:J,isButtonDown:$,isButtonReleased:Z,setButton:k,getButton:Ee,pressButton:gt,releaseButton:Gt,charInputted:ct,onResize:Ht,onKeyDown:yn,onKeyPress:xn,onKeyPressRepeat:mr,onKeyRelease:pr,onMouseDown:Mt,onMousePress:$e,onMouseRelease:vn,onMouseMove:F,onCharInput:N,onTouchStart:z,onTouchMove:oe,onTouchEnd:ye,onScroll:Q,onHide:ve,onShow:qt,onGamepadButtonDown:dr,onGamepadButtonPress:ut,onGamepadButtonRelease:fr,onGamepadStick:hr,onGamepadConnect:gr,onGamepadDisconnect:wn,onButtonPress:Ie,onButtonDown:Wt,onButtonRelease:Je,getLastInputDeviceType:Vs,events:e.events}};function ee(){return a.app.dt()}function an(){return a.app.fixedDt()}function un(){return a.app.restDt()}var Iu=new E(-1,-1),Ku=new E(0,-1),ku=new E(1,-1),_u=new E(-1,0),Nu=new E(0,0),Uu=new E(1,0),Hu=new E(-1,1),qu=new E(0,1),zu=new E(1,1);function _e(t){switch(t){case\"topleft\":return Iu;case\"top\":return Ku;case\"topright\":return ku;case\"left\":return _u;case\"center\":return Nu;case\"right\":return Uu;case\"botleft\":return Hu;case\"bot\":return qu;case\"botright\":return zu;default:return t}}function Rs(t){switch(t){case\"left\":return 0;case\"center\":return .5;case\"right\":return 1;default:return 0}}function Ds(t){return t.createBuffer(1,1,44100)}var In=2.5949095,Bs=1.70158+1,Fs=2*Math.PI/3,Ls=2*Math.PI/4.5,Kn={linear:t=>t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>Bs*t*t*t-1.70158*t*t,easeOutBack:t=>1+Bs*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*((In+1)*2*t-In)/2:(Math.pow(2*t-2,2)*((In+1)*(t*2-2)+In)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*Fs),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*Fs)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*Ls))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*Ls)/2+1,easeInBounce:t=>1-Kn.easeOutBounce(1-t),easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInOutBounce:t=>t<.5?(1-Kn.easeOutBounce(1-2*t))/2:(1+Kn.easeOutBounce(2*t-1))/2},nt=Kn;function Wu(t,e,n){let r=[],o=e;for(r.push(o);o!==t;){if(o=n.get(o),o==null)return null;r.push(o)}return r.reverse()}function Lr(t,e,n){let r=new It((i,m)=>i.cost<m.cost);r.insert({cost:0,node:e});let o=new Map;o.set(e,e);let s=new Map;for(s.set(e,0);r.length!==0;){let i=r.remove()?.node;if(i===n)break;let m=t.getNeighbours(i);for(let u of m){let c=(s.get(i)||0)+t.getCost(i,u)+t.getHeuristic(u,n);(!s.has(u)||c<s.get(u))&&(s.set(u,c),r.insert({cost:c,node:u}),o.set(u,i))}}return Wu(e,n,o)}var jr=class{a;b;polygon;constructor(e,n,r){this.a=e,this.b=n,this.polygon=new WeakRef(r)}isLeft(e,n){return(this.b.x-this.a.x)*(n-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},Ir=class{_edges;_centroid;_id;constructor(e){this._id=e}get id(){return this._id}set edges(e){this._edges=e;let n=0,r=0,o=0;for(let s of this._edges){s.polygon=new WeakRef(this);let i=s.a.x*s.b.y-s.a.y*s.b.x;n+=(s.a.x+s.b.x)*i,r+=(s.a.y+s.b.y)*i,o+=i}o/=2,this._centroid=v(n/(6*o),r/(6*o))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let n=!1;for(let r of this.edges)r.b.y>e.y!=r.a.y>e.y&&e.x<(r.a.x-r.b.x)*(e.y-r.b.y)/(r.a.y-r.b.y)+r.b.x&&(n=!n);return n}},kn=class{_polygons;_pointCache;_edgeCache;constructor(){this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let n=this._pointCache[`${e.x}_${e.y}`];return n||(n=e.clone(),this._pointCache[`${e.x}_${e.y}`]=n,n)}_addEdge(e){let n=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[n]=e,e}_findEdge(e,n){let r=`${e.x}_${e.y}-${n.x}_${n.y}`;return this._edgeCache[r]}_findCommonEdge(e,n){for(let r of e.edges){let o=this._findEdge(r.b,r.a);if(o&&o.polygon.deref().id===n.id)return o}return null}addPolygon(e){let n=new Ir(this._polygons.length),r=e.map((o,s)=>new jr(o,e[(s+1)%e.length],n));n.edges=r,this._polygons.push(n);for(let o of n.edges)this._addEdge(o);return n}addRect(e,n){let r=this._addPoint(e),o=this._addPoint(e.add(n.x,0)),s=this._addPoint(e.add(n)),i=this._addPoint(e.add(0,n.y));return this.addPolygon([r,o,s,i])}_getLocation(e){for(let n of this._polygons)if(n.contains(e))return n;return null}getNeighbours(e){let n=[];for(let r of this._polygons[e].edges){let o=this._findEdge(r.b,r.a);if(o){let s=o.polygon.deref();s&&n.push(s.id)}}return n}getCost(e,n){return 1}getHeuristic(e,n){let r=this._polygons[e],o=this._polygons[n],s=r.centroid.x-o.centroid.x,i=r.centroid.y-o.centroid.y;return Math.sqrt(s*s+i*i)}getPath(e,n){return e===void 0||n===void 0?[]:e===n?[e,n]:Lr(this,e,n)}getWaypointPath(e,n,r){let o=r?.type||\"centroids\",s=this._getLocation(e),i=this._getLocation(n);if(s===void 0||i===void 0)return[];let m=this.getPath(s.id,i.id);if(!m)return[];if(o===\"edges\"){let u=[];for(let c=1;c<m.length;c++){let p=this._polygons[m[c-1]],b=this._polygons[m[c]],l=this._findCommonEdge(p,b);u.push(l.middle.add(b.centroid.sub(l.middle).unit().scale(4)))}return[e,...u,n]}else return[e,...m.slice(1,-1).map(u=>this._polygons[u].centroid),n]}};function dt(t){let e=new fe;return t.pos&&e.translate(t.pos),t.scale&&e.scale(t.scale),t.angle&&e.rotate(t.angle),t.parent?e.mult(t.parent.transform):e}function js(t){return new E(t.x/ie()*2-1,-t.y/ue()*2+1)}function wt(t,e,n,r,o,s=1){r=ae(r%360),o=ae(o%360),o<=r&&(o+=Math.PI*2);let i=[],m=Math.ceil((o-r)/ae(8)*s),u=(o-r)/m,c=v(Math.cos(r),Math.sin(r)),p=v(Math.cos(u),Math.sin(u));for(let b=0;b<=m;b++)i.push(t.add(e*c.x,n*c.y)),c=v(c.x*p.x-c.y*p.y,c.x*p.y+c.y*p.x);return i}function Is(...t){let e=I(...t),n=t[3]??1;a.gfx.bgColor=e,a.gfx.bgAlpha=n,a.gfx.ggl.gl.clearColor(e.r/255,e.g/255,e.b/255,n)}function Ks(){return a.gfx.bgColor?.clone?.()??null}function X(...t){if(t[0]===void 0)return;let e=v(...t);e.x===0&&e.y===0||a.gfx.transform.translate(e)}function ge(){a.gfx.transformStack.push(a.gfx.transform.clone())}function ks(t){a.gfx.transform=t.clone()}function rt(...t){if(t[0]===void 0)return;let e=v(...t);e.x===1&&e.y===1||a.gfx.transform.scale(e)}function Ye(t){t&&a.gfx.transform.rotate(t)}function me(){a.gfx.transformStack.length>0&&(a.gfx.transform=a.gfx.transformStack.pop())}function Ce(){a.gfx.renderer.flush()}function ie(){return a.gfx.width}function ue(){return a.gfx.height}function _n(){return(a.gfx.viewport.width+a.gfx.viewport.height)/(a.gfx.width+a.gfx.height)}function Ct(){return v(ie()/2,ue()/2)}var Nn=class{lastTextureId=0;textures=[];bigTextures=[];texturesPosition=new Map;canvas;c2d;x=0;y=0;curHeight=0;gfx;padding;constructor(e,n,r,o){this.gfx=e,this.canvas=document.createElement(\"canvas\"),this.canvas.width=n,this.canvas.height=r,this.textures=[Ve.fromImage(e,this.canvas)],this.bigTextures=[],this.padding=o;let s=this.canvas.getContext(\"2d\");if(!s)throw new Error(\"Failed to get 2d context\");this.c2d=s}addSingle(e){let n=Ve.fromImage(this.gfx,e);return this.bigTextures.push(n),[n,new q(0,0,1,1),0]}add(e){let n=e.width+this.padding*2,r=e.height+this.padding*2;if(n>this.canvas.width||r>this.canvas.height)return this.addSingle(e);this.x+n>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+r>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Ve.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let o=this.textures[this.textures.length-1],s=new E(this.x+this.padding,this.y+this.padding);return this.x+=n,r>this.curHeight&&(this.curHeight=r),e instanceof ImageData?this.c2d.putImageData(e,s.x,s.y):this.c2d.drawImage(e,s.x,s.y),o.update(this.canvas),this.texturesPosition.set(this.lastTextureId,{position:s,size:new E(e.width,e.height),texture:o}),this.lastTextureId++,[o,new q(s.x/this.canvas.width,s.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height),this.lastTextureId-1]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}};function pe(t){return typeof t!=\"string\"||Fn(t)?t:a.assets.urlPrefix+t}var ce=class t{loaded=!1;data=null;error=null;onLoadEvents=new re;onErrorEvents=new re;onFinishEvents=new re;constructor(e){e.then(n=>{this.loaded=!0,this.data=n,this.onLoadEvents.trigger(n)}).catch(n=>{if(this.error=n,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(n);else throw n}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let n=new t(Promise.resolve(e));return n.data=e,n.loaded=!0,n}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},ft=class{assets=new Map;lastUID=0;add(e,n){let r=e??this.lastUID+++\"\",o=new ce(n);return this.assets.set(r,o),o}addLoaded(e,n){let r=e??this.lastUID+++\"\",o=ce.loaded(n);return this.assets.set(r,o),o}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(n=>{n.loaded&&e++}),e/this.assets.size}getFailedAssets(){return Array.from(this.assets.keys()).filter(e=>this.assets.get(e).error!==null).map(e=>[e,this.assets.get(e)])}};function _r(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`Failed to fetch \"${t}\"`);return e})}function Et(t){return _r(t).then(e=>e.json())}function _s(t){return _r(t).then(e=>e.text())}function Ns(t){return _r(t).then(e=>e.arrayBuffer())}function Us(t){return t!==void 0&&(a.assets.urlPrefix=t),a.assets.urlPrefix}function Hs(t,e){return a.assets.custom.add(t,Et(pe(e)))}function Tt(t){let e=new Image;return e.crossOrigin=\"anonymous\",e.src=t,new Promise((n,r)=>{e.onload=()=>n(e),e.onerror=()=>r(new Error(`Failed to load image from \"${t}\"`))})}function Be(){let t=[a.assets.sprites,a.assets.sounds,a.assets.shaders,a.assets.fonts,a.assets.bitmapFonts,a.assets.custom];return t.reduce((e,n)=>e+n.progress(),0)/t.length}function Un(){return[a.assets.sprites,a.assets.sounds,a.assets.shaders,a.assets.fonts,a.assets.bitmapFonts,a.assets.custom].reduce((e,n)=>e.concat(n.getFailedAssets()),[])}function qs(t){return a.assets.custom.get(t)??null}function cn(t){return a.assets.custom.add(null,t)}var zs=(t,e)=>({urlPrefix:\"\",sprites:new ft,fonts:new ft,bitmapFonts:new ft,sounds:new ft,shaders:new ft,custom:new ft,music:{},packer:new Nn(t,2048,2048,e),loaded:!1});var Ws=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==\";var Fe=class t{tex;frames=[new q(0,0,1,1)];anims={};slice9=null;constructor(e,n,r={},o=null){this.tex=e,n&&(this.frames=n),this.anims=r,this.slice9=o}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(e,n={}){return typeof e==\"string\"?t.fromURL(e,n):Promise.resolve(t.fromImage(e,n))}static fromImage(e,n={}){let[r,o]=n.singular?a.assets.packer.addSingle(e):a.assets.packer.add(e),s=n.frames?n.frames.map(i=>new q(o.x+i.x*o.w,o.y+i.y*o.h,i.w*o.w,i.h*o.h)):Ur(n.sliceX||1,n.sliceY||1,o.x,o.y,o.w,o.h);return new t(r,s,n.anims,n.slice9)}static fromURL(e,n={}){return Tt(e).then(r=>t.fromImage(r,n))}};function Kt(t){if(typeof t==\"string\"){let e=Nr(t);if(e)return e;if(Be()<1)return null;throw new Error(`Sprite not found: ${t}`)}else{if(t instanceof Fe)return ce.loaded(t);if(t instanceof ce)return t;throw new Error(`Invalid sprite: ${t}`)}}function Nr(t){return a.assets.sprites.get(t)??null}function Ot(t,e,n={sliceX:1,sliceY:1,anims:{}}){return e=pe(e),Array.isArray(e)?e.some(r=>typeof r==\"string\")?a.assets.sprites.add(t,Promise.all(e.map(r=>typeof r==\"string\"?Tt(r):Promise.resolve(r))).then(r=>Ys(r,n))):a.assets.sprites.addLoaded(t,Ys(e,n)):typeof e==\"string\"?a.assets.sprites.add(t,Fe.from(e,n)):a.assets.sprites.addLoaded(t,Fe.fromImage(e,n))}function Ur(t=1,e=1,n=0,r=0,o=1,s=1){let i=[],m=o/t,u=s/e;for(let c=0;c<e;c++)for(let p=0;p<t;p++)i.push(new q(n+p*m,r+c*u,m,u));return i}function Ys(t,e={}){let n=document.createElement(\"canvas\"),r=t[0].width,o=t[0].height;n.width=r*t.length,n.height=o;let s=n.getContext(\"2d\");if(!s)throw new Error(\"Failed to create canvas context\");t.forEach((m,u)=>{m instanceof ImageData?s.putImageData(m,u*r,0):s.drawImage(m,u*r,0)});let i=s.getImageData(0,0,t.length*r,o);return Fe.fromImage(i,{...e,sliceX:t.length,sliceY:1})}function $s(t=\"bean\"){return Ot(t,Ws)}function Xs(t,e,n){e=pe(e),n=pe(n),typeof e==\"string\"&&!n&&(n=vs(e)+\".json\");let r=typeof n==\"string\"?Et(n):Promise.resolve(n);return a.assets.sprites.add(t,r.then(o=>{let s=o.meta.size,i=o.frames.map(u=>new q(u.frame.x/s.w,u.frame.y/s.h,u.frame.w/s.w,u.frame.h/s.h)),m={};for(let u of o.meta.frameTags)u.from===u.to?m[u.name]=u.from:m[u.name]={from:u.from,to:u.to,speed:10,loop:!0,pingpong:u.direction===\"pingpong\"};return Fe.from(e,{frames:i,anims:m})}))}var At=class{fontface;filter=Zt;outline=null;size=64;constructor(e,n={}){if(this.fontface=e,this.filter=n.filter??Zt,this.size=n.size??64,this.size>256)throw new Error(`Max font size: ${256}`);n.outline&&(this.outline={width:1,color:I(0,0,0)},typeof n.outline==\"number\"?this.outline.width=n.outline:typeof n.outline==\"object\"&&(n.outline.width&&(this.outline.width=n.outline.width),n.outline.color&&(this.outline.color=n.outline.color)))}};function Hr(t){if(!t)return Hr(a.globalOpt.font??ss);if(typeof t==\"string\"){let e=Hn(t),n=qr(t);if(e)return e.data??e;if(n)return n.data??n;if(document.fonts.check(`${64}px ${t}`))return t;if(Be()<1)return null;throw new Error(`Font not found: ${t}`)}else if(t instanceof ce)return t.data?t.data:t;return t}function qr(t){return a.assets.fonts.get(t)??null}function Qs(t,e,n={}){let r=pe(e),o=new FontFace(t,typeof e==\"string\"?`url(${r})`:r);return document.fonts.add(o),a.assets.fonts.add(t,o.load().catch(s=>{throw new Error(`Failed to load font from \"${r}\": ${s}`)}).then(s=>new At(s,n)))}function Js(t,e,n,r){let o=t.width/e,s={},i=r.split(\"\").entries();for(let[m,u]of i)s[u]=new q(m%o*e,Math.floor(m/o)*n,e,n);return{tex:t,map:s,size:n}}function Hn(t){return a.assets.bitmapFonts.get(t)??null}function Zs(t,e,n,r,o={}){let s=pe(e);return a.assets.bitmapFonts.add(t,Tt(s).then(i=>Js(Ve.fromImage(a.gfx.ggl,i,o),n,r,o.chars??Rn)))}function ei(t,e){return e=pe(e),a.assets.sprites.add(t,new Promise(async n=>{let r=typeof e==\"string\"?await Et(e):e,o=await Promise.all(r.frames.map(Tt)),s=document.createElement(\"canvas\");s.width=r.width,s.height=r.height*r.frames.length;let i=s.getContext(\"2d\");if(!i)throw new Error(\"Failed to create canvas context\");o.forEach((u,c)=>{i.drawImage(u,0,c*r.height)});let m=await Ot(null,s,{sliceY:r.frames.length,anims:r.anims});n(m)}))}var zr=class{ctx;glProgram;constructor(e,n,r,o){this.ctx=e,e.onDestroy(()=>this.free());let s=e.gl,i=s.createShader(s.VERTEX_SHADER),m=s.createShader(s.FRAGMENT_SHADER);if(!i||!m)throw new Error(\"Failed to create shader\");s.shaderSource(i,n),s.shaderSource(m,r),s.compileShader(i),s.compileShader(m);let u=s.createProgram();if(this.glProgram=u,s.attachShader(u,i),s.attachShader(u,m),o.forEach((c,p)=>s.bindAttribLocation(u,p,c)),s.linkProgram(u),!s.getProgramParameter(u,s.LINK_STATUS)){let c=s.getShaderInfoLog(i);if(c)throw new Error(\"VERTEX SHADER \"+c);let p=s.getShaderInfoLog(m);if(p)throw new Error(\"FRAGMENT SHADER \"+p)}s.deleteShader(i),s.deleteShader(m)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let n=this.ctx.gl;for(let r in e){let o=e[r],s=n.getUniformLocation(this.glProgram,r);if(typeof o==\"number\")n.uniform1f(s,o);else if(o instanceof fe)n.uniformMatrix4fv(s,!1,new Float32Array(o.m));else if(o instanceof j)n.uniform3f(s,o.r,o.g,o.b);else if(o instanceof E)n.uniform2f(s,o.x,o.y);else if(Array.isArray(o)){let i=o[0];bs(o)?n.uniform1fv(s,o):gs(o)?n.uniform2fv(s,o.map(m=>[m.x,m.y]).flat()):hs(o)&&n.uniform3fv(s,o.map(m=>[m.r,m.g,m.b]).flat())}else throw new Error(\"Unsupported uniform data type\")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}};function qn(t,e=tn,n=nn){let r=cs.replace(\"{{user}}\",e??tn),o=ls.replace(\"{{user}}\",n??nn);try{return new zr(t,r,o,en.map(s=>s.name))}catch(s){let m=/(?<type>^\\w+) SHADER ERROR: 0:(?<line>\\d+): (?<msg>.+)/,u=Cs(s).match(m);if(!u?.groups)throw s;let c=Number(u.groups.line)-14,p=u.groups.msg.trim(),b=u.groups.type.toLowerCase();throw new Error(`${b} shader line ${c}: ${p}`)}}function ti(t){if(!t)return a.gfx.defShader;if(typeof t==\"string\"){let e=Wr(t);if(e)return e.data??e;if(Be()<1)return null;throw new Error(`Shader not found: ${t}`)}else if(t instanceof ce)return t.data?t.data:t;return t}function Wr(t){return a.assets.shaders.get(t)??null}function ni(t,e,n){return a.assets.shaders.addLoaded(t,qn(a.gfx.ggl,e,n))}function ri(t,e,n){e=pe(e),n=pe(n);let r=s=>s?_s(s):Promise.resolve(null),o=Promise.all([r(e),r(n)]).then(([s,i])=>qn(a.gfx.ggl,s,i));return a.assets.shaders.add(t,o)}var ot=class t{buf;constructor(e){this.buf=e}static fromArrayBuffer(e){return new Promise((n,r)=>a.audio.ctx.decodeAudioData(e,n,r)).then(n=>new t(n))}static fromURL(e){return Fn(e)?t.fromArrayBuffer(ys(e)):Ns(e).then(n=>t.fromArrayBuffer(n))}};function oi(t){if(typeof t==\"string\"){let e=Yr(t);if(e)return e;if(Be()<1)return null;throw new Error(`Sound not found: ${t}`)}else{if(t instanceof ot)return ce.loaded(t);if(t instanceof ce)return t;throw new Error(`Invalid sound: ${t}`)}}function Yr(t){return a.assets.sounds.get(t)??null}function si(t,e){return e=pe(e),a.assets.sounds.add(t,typeof e==\"string\"?ot.fromURL(e):ot.fromArrayBuffer(e))}function ii(t,e){let n=pe(e),r=new Audio(n);return r.preload=\"auto\",a.assets.music[t]=n}function $r(t,e){return t=pe(t),typeof e==\"string\"?cn(new Promise((n,r)=>{Et(e).then(o=>{$r(t,o).then(n).catch(r)})})):cn(Fe.from(t).then(n=>{let r={};for(let o in e){let s=e[o],i=n.frames[0],m=2048*i.w,u=2048*i.h,c=s.frames?s.frames.map(b=>new q(i.x+(s.x+b.x)/m*i.w,i.y+(s.y+b.y)/u*i.h,b.w/m*i.w,b.h/u*i.h)):Ur(s.sliceX||1,s.sliceY||1,i.x+s.x/m*i.w,i.y+s.y/u*i.h,s.width/m*i.w,s.height/u*i.h),p=new Fe(n.tex,c,s.anims);a.assets.sprites.addLoaded(o,p),r[o]=p}return r}))}function Le(t,e,n=!1,r,o,s={}){let i=r??a.gfx.defTex,m=o??a.gfx.defShader,u=ti(m);if(!u||u instanceof ce)return;let c=a.gfx.fixed||n?a.gfx.transform:a.game.cam.transform.mult(a.gfx.transform),p=[];for(let b of t){let l=js(c.multVec2(b.pos));p.push(l.x,l.y,b.uv.x,b.uv.y,b.color.r/255,b.color.g/255,b.color.b/255,b.opacity)}a.gfx.renderer.push(a.gfx.ggl.gl.TRIANGLES,p,e,u,i,s)}function Pe(t){if(!t.pts)throw new Error('drawPolygon() requires property \"pts\".');let e=t.pts.length;if(!(e<3)){if(ge(),X(t.pos),rt(t.scale),Ye(t.angle),X(t.offset),t.fill!==!1){let n=t.color??j.WHITE,r=t.pts.map((s,i)=>({pos:new E(s.x,s.y),uv:t.uv?t.uv[i]:new E(0,0),color:t.colors&&t.colors[i]?t.colors[i].mult(n):n,opacity:t.opacity??1})),o;t.triangulate?o=Mn(t.pts).map(i=>i.map(m=>t.pts.indexOf(m))).flat():o=[...Array(e-2).keys()].map(s=>[0,s+1,s+2]).flat(),Le(r,t.indices??o,t.fixed,t.uv?t.tex:a.gfx.defTex,t.shader,t.uniform??void 0)}t.outline&&kt({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity??t.outline.opacity}),me()}}function zn(t){if(t.radiusX===void 0||t.radiusY===void 0)throw new Error('drawEllipse() requires properties \"radiusX\" and \"radiusY\".');if(t.radiusX===0||t.radiusY===0)return;let e=t.start??0,n=t.end??360,r=_e(t.anchor??\"center\").scale(new E(-t.radiusX,-t.radiusY)),o=wt(r,t.radiusX,t.radiusY,e,n,t.resolution);o.unshift(r);let s=Object.assign({},t,{pts:o,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(o.length-1).fill(t.gradient[1])]}:{}});if(n-e>=360&&t.outline){t.fill!==!1&&Pe(Object.assign({},s,{outline:null})),Pe(Object.assign({},s,{pts:o.slice(1),fill:!1}));return}Pe(s)}function Ne(t){if(typeof t.radius!=\"number\")throw new Error('drawCircle() requires property \"radius\".');t.radius!==0&&zn(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}function _t(t){let{p1:e,p2:n}=t;if(!e||!n)throw new Error('drawLine() requires properties \"p1\" and \"p2\".');let r=t.width||1,o=n.sub(e).unit().normal().scale(r*.5),s=[e.sub(o),e.add(o),n.add(o),n.sub(o)].map(i=>({pos:new E(i.x,i.y),uv:new E(0),color:t.color??j.WHITE,opacity:t.opacity??1}));Le(s,[0,1,3,1,2,3],t.fixed,a.gfx.defTex,t.shader,t.uniform??void 0)}function $u(t){let e=t.pts,n=[],r=(t.width||1)*.5,o=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),s=t.pos||v(0,0),i;o?i=e[0].sub(e[e.length-2]):i=e[1].sub(e[0]);let m=i.len(),u=i.normal().scale(-r/m),c,p=e[0];if(!o)switch(t.cap){case\"square\":{let d=i.scale(-r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(-1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)n.push(p),n.push(p.sub(g)),g=v(g.x*y-g.y*O,g.x*O+g.y*y)}}for(let d=1;d<e.length;d++){if(p===e[d]||p.eq(e[d]))continue;c=p,p=e[d];let C=p.sub(c),g=C.len(),y=C.normal().scale(-r/g),O=i.cross(C);if(Math.abs(O)/(m*g)<.05){n.push(c.add(u)),n.push(c.sub(u)),i.dot(C)<0&&(n.push(c.sub(u)),n.push(c.add(u))),i=C,m=g,u=y;continue}let A=y.sub(u).cross(C)/O,R=u.add(i.scale(A));O>0?(n.push(c.add(R)),n.push(c.sub(u)),n.push(c.add(R)),n.push(c.sub(y))):(n.push(c.add(u)),n.push(c.sub(R)),n.push(c.add(y)),n.push(c.sub(R))),i=C,m=g,u=y}if(!o)switch(n.push(p.add(u)),n.push(p.sub(u)),t.cap){case\"square\":{let d=i.scale(r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)g=v(g.x*y-g.y*O,g.x*O+g.y*y),n.push(p),n.push(p.sub(g))}}if(n.length<4)return;let b=n.map(d=>({pos:s.add(d),uv:v(),color:t.color||j.WHITE,opacity:t.opacity??1})),l=[],h=0;for(let d=0;d<n.length-2;d+=2)l[h++]=d+1,l[h++]=d,l[h++]=d+2,l[h++]=d+2,l[h++]=d+3,l[h++]=d+1;o&&(l[h++]=n.length-1,l[h++]=n.length-2,l[h++]=0,l[h++]=0,l[h++]=1,l[h++]=n.length-1),Le(b,l,t.fixed,a.gfx.defTex,t.shader,t.uniform??void 0)}function Xu(t){let e=t.pts,n=[],r=(t.width||1)*.5,o=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),s=t.pos||v(0,0),i;o?i=e[0].sub(e[e.length-2]):i=e[1].sub(e[0]);let m=i.len(),u=i.normal().scale(-r/m),c,p=e[0];if(!o)switch(t.cap){case\"square\":{let d=i.scale(-r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(-1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)n.push(p),n.push(p.sub(g)),g=v(g.x*y-g.y*O,g.x*O+g.y*y)}}for(let d=1;d<e.length;d++){if(p===e[d]||p.eq(e[d]))continue;c=p,p=e[d];let C=p.sub(c),g=C.len(),y=C.normal().scale(-r/g),O=i.cross(C);if(Math.abs(O)/(m*g)<.05){n.push(c.add(u)),n.push(c.sub(u)),i.dot(C)<0&&(n.push(c.sub(u)),n.push(c.add(u))),i=C,m=g,u=y;continue}let A=y.sub(u).cross(C)/O,R=u.add(i.scale(A));if(O>0){let V=c.add(R),x=Math.max(r,10),w=ae(u.angleBetween(y)/x),S=u,G=Math.cos(w),M=Math.sin(w);for(let D=0;D<x;D++)n.push(V),n.push(c.sub(S)),S=v(S.x*G-S.y*M,S.x*M+S.y*G)}else{let V=c.sub(R),x=Math.max(r,10),w=ae(u.angleBetween(y)/x),S=u,G=Math.cos(w),M=Math.sin(w);for(let D=0;D<x;D++)n.push(c.add(S)),n.push(V),S=v(S.x*G-S.y*M,S.x*M+S.y*G)}i=C,m=g,u=y}if(!o)switch(n.push(p.add(u)),n.push(p.sub(u)),t.cap){case\"square\":{let d=i.scale(r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)g=v(g.x*y-g.y*O,g.x*O+g.y*y),n.push(p),n.push(p.sub(g))}}if(n.length<4)return;let b=n.map(d=>({pos:s.add(d),uv:v(),color:t.color||j.WHITE,opacity:t.opacity??1})),l=[],h=0;for(let d=0;d<n.length-2;d+=2)l[h++]=d+1,l[h++]=d,l[h++]=d+2,l[h++]=d+2,l[h++]=d+3,l[h++]=d+1;o&&(l[h++]=n.length-1,l[h++]=n.length-2,l[h++]=0,l[h++]=0,l[h++]=1,l[h++]=n.length-1),Le(b,l,t.fixed,a.gfx.defTex,t.shader,t.uniform??void 0)}function Qu(t){let e=t.pts,n=[],r=(t.width||1)*.5,o=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),s=t.pos||v(0,0),i;o?i=e[0].sub(e[e.length-2]):i=e[1].sub(e[0]);let m=i.len(),u=i.normal().scale(-r/m),c,p=e[0];if(!o)switch(t.cap){case\"square\":{let d=i.scale(-r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(-1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)n.push(p),n.push(p.sub(g)),g=v(g.x*y-g.y*O,g.x*O+g.y*y)}}for(let d=1;d<e.length;d++){if(p===e[d]||p.eq(e[d]))continue;c=p,p=e[d];let C=p.sub(c),g=C.len(),y=C.normal().scale(-r/g),O=i.cross(C);if(Math.abs(O)/(m*g)<.05){n.push(c.add(u)),n.push(c.sub(u)),i.dot(C)<0&&(n.push(c.sub(u)),n.push(c.add(u))),i=C,m=g,u=y;continue}let A=y.sub(u).cross(C)/O,R=u.add(i.scale(A));n.push(c.add(R)),n.push(c.sub(R)),i=C,m=g,u=y}if(!o)switch(n.push(p.add(u)),n.push(p.sub(u)),t.cap){case\"square\":{let d=i.scale(r/m);n.push(p.add(d).add(u)),n.push(p.add(d).sub(u));break}case\"round\":{let d=Math.max(r,10),C=Math.PI/d,g=u.scale(1),y=Math.cos(C),O=Math.sin(C);for(let A=0;A<d;A++)g=v(g.x*y-g.y*O,g.x*O+g.y*y),n.push(p),n.push(p.sub(g))}}if(n.length<4)return;let b=n.map(d=>({pos:s.add(d),uv:v(),color:t.color||j.WHITE,opacity:t.opacity??1})),l=[],h=0;for(let d=0;d<n.length-2;d+=2)l[h++]=d+1,l[h++]=d,l[h++]=d+2,l[h++]=d+2,l[h++]=d+3,l[h++]=d+1;o&&(l[h++]=n.length-1,l[h++]=n.length-2,l[h++]=0,l[h++]=0,l[h++]=1,l[h++]=n.length-1),Le(b,l,t.fixed,a.gfx.defTex,t.shader,t.uniform??void 0)}function kt(t){let e=t.pts,n=t.width??1;if(!e)throw new Error('drawLines() requires property \"pts\".');if(!(e.length<2)){if(e.length>2)switch(t.join){case\"bevel\":return $u(t);case\"round\":return Xu(t);case\"miter\":return Qu(t)}if(t.radius&&e.length>=3){_t(Object.assign({},t,{p1:e[0],p2:e[1]}));for(let r=1;r<e.length-2;r++){let o=e[r],s=e[r+1];_t(Object.assign({},t,{p1:o,p2:s}))}_t(Object.assign({},t,{p1:e[e.length-2],p2:e[e.length-1]}))}else for(let r=0;r<e.length-1;r++)_t(Object.assign({},t,{p1:e[r],p2:e[r+1]})),t.join!==\"none\"&&Ne(Object.assign({},t,{pos:e[r],radius:n/2}))}}function Wn(t,e){let n=e.segments??16,r=[];for(let o=0;o<=n;o++)r.push(t(o/n));kt({pts:r,width:e.width||1,pos:e.pos,color:e.color,opacity:e.opacity})}function ai(t){Wn(e=>Jt(t.pt1,t.pt2,t.pt3,t.pt4,e),t)}var Ve=class t{ctx;src=null;glTex;width;height;constructor(e,n,r,o={}){this.ctx=e;let s=e.gl,i=e.gl.createTexture();if(!i)throw new Error(\"Failed to create texture\");this.glTex=i,e.onDestroy(()=>this.free()),this.width=n,this.height=r;let m={linear:s.LINEAR,nearest:s.NEAREST}[o.filter??e.opts.texFilter??\"nearest\"],u={repeat:s.REPEAT,clampToEdge:s.CLAMP_TO_EDGE}[o.wrap??\"clampToEdge\"];this.bind(),n&&r&&s.texImage2D(s.TEXTURE_2D,0,s.RGBA,n,r,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,m),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,m),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,u),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,u),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.unbind()}static fromImage(e,n,r={}){let o=new t(e,n.width,n.height,r);return o.update(n),o.src=n,o}update(e,n=0,r=0){let o=this.ctx.gl;this.bind(),o.texSubImage2D(o.TEXTURE_2D,0,n,r,o.RGBA,o.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},st=class{ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,n,r,o={}){this.ctx=e;let s=e.gl;e.onDestroy(()=>this.free()),this.tex=new Ve(e,n,r,o);let i=s.createFramebuffer(),m=s.createRenderbuffer();if(!i||!m)throw new Error(\"Failed to create framebuffer\");this.glFramebuffer=i,this.glRenderbuffer=m,this.bind(),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,n,r),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.tex.glTex,0),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,n=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,n),this.unbind();let r=this.width*4,o=new Uint8Array(r);for(let s=0;s<(this.height/2|0);s++){let i=s*r,m=(this.height-s-1)*r;o.set(n.subarray(i,i+r)),n.copyWithin(i,m,m+r),n.set(o,m)}return new ImageData(n,this.width,this.height)}toDataURL(){let e=document.createElement(\"canvas\"),n=e.getContext(\"2d\");if(e.width=this.width,e.height=this.height,!n)throw new Error(\"Failed to get 2d context\");return n.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},Yn=class{ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,n,r,o){let s=e.gl;this.vertexFormat=n,this.ctx=e,this.stride=n.reduce((m,u)=>m+u.size,0),this.maxVertices=r,this.maxIndices=o;let i=s.createBuffer();if(!i)throw new Error(\"Failed to create vertex buffer\");this.glVBuf=i,e.pushArrayBuffer(this.glVBuf),s.bufferData(s.ARRAY_BUFFER,r*4,s.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=s.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),s.bufferData(s.ELEMENT_ARRAY_BUFFER,o*4,s.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,n,r,o,s=null,i={}){(e!==this.curPrimitive||s!==this.curTex||o!==this.curShader||!Ln(this.curUniform,i)||this.vqueue.length+n.length*this.stride>this.maxVertices||this.iqueue.length+r.length>this.maxIndices)&&this.flush();let m=this.vqueue.length/this.stride;for(let u of n)this.vqueue.push(u);for(let u of r)this.iqueue.push(u+m);this.curPrimitive=e,this.curShader=o,this.curTex=s,this.curUniform=i}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function St(t){let e=[],n=s=>{e.push(s),t(s)},r=()=>{e.pop(),t(o()??null)},o=()=>e[e.length-1];return[n,r,o]}function ui(t,e={}){let n=[];function r(V){n.push(V)}function o(){n.forEach(x=>x());let V=t.getExtension(\"WEBGL_lose_context\");V&&V.loseContext()}let s=null;function i(V){if(Ln(V,s))return;s=V;let x=V.reduce((w,S)=>w+S.size,0);V.reduce((w,S,G)=>(t.vertexAttribPointer(G,S.size,t.FLOAT,!1,x*4,w),t.enableVertexAttribArray(G),w+S.size*4),0)}let[m,u]=St(V=>t.bindTexture(t.TEXTURE_2D,V)),[c,p]=St(V=>t.bindBuffer(t.ARRAY_BUFFER,V)),[b,l]=St(V=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,V)),[h,d]=St(V=>t.bindFramebuffer(t.FRAMEBUFFER,V)),[C,g]=St(V=>t.bindRenderbuffer(t.RENDERBUFFER,V)),[y,O]=St(V=>{if(!V)return;let{x,y:w,w:S,h:G}=V;t.viewport(x,w,S,G)}),[A,R]=St(V=>t.useProgram(V));return y({x:0,y:0,w:t.drawingBufferWidth,h:t.drawingBufferHeight}),{gl:t,opts:e,onDestroy:r,destroy:o,pushTexture2D:m,popTexture2D:u,pushArrayBuffer:c,popArrayBuffer:p,pushElementArrayBuffer:b,popElementArrayBuffer:l,pushFramebuffer:h,popFramebuffer:d,pushRenderbuffer:C,popRenderbuffer:g,pushViewport:y,popViewport:O,pushProgram:A,popProgram:R,setVertexFormat:i}}var Xr={};function mi(t,e){if(e.override){Object.assign(t,e);return}e.pos&&(t.pos=t.pos.add(e.pos)),e.scale&&(t.scale=t.scale.scale(v(e.scale))),e.angle&&(t.angle+=e.angle),e.color&&t.ch.length===1&&(t.color=t.color.mult(e.color)),e.opacity!=null&&(t.opacity*=e.opacity)}function $n(t){let e={},n=\"\",r=[],o=String(t),s=i=>{r.length>0&&(e[n.length]=r.slice()),n+=i};for(;o!==\"\";){if(o[0]===\"\\\\\"){if(o.length===1)throw new Error(\"Styled text error: \\\\ at end of string\");s(o[1]),o=o.slice(2);continue}if(o[0]===\"[\"){let i=/^\\[(\\/)?(\\w+?)\\]/.exec(o);if(!i){s(o[0]),o=o.slice(1);continue}let[m,u,c]=i;if(u!==void 0){let p=r.pop();if(p!==c)throw p!==void 0?new Error(`Styled text error: mismatched tags. Expected [/${p}], got [/${c}]`):new Error(`Styled text error: stray end tag [/${c}]`)}else r.push(c);o=o.slice(m.length);continue}s(o[0]),o=o.slice(1)}if(r.length>0)throw new Error(`Styled text error: unclosed tags ${r}`);return{charStyleMap:e,text:n}}function Ue(t){if(t.text===void 0)throw new Error('formatText() requires property \"text\".');let e=Hr(t.font);if(!t.text||t.text===\"\"||e instanceof ce||!e)return{width:0,height:0,chars:[],opt:t,renderedText:\"\"};let{charStyleMap:n,text:r}=$n(t.text+\"\"),o=Ts(r);if(e instanceof At||typeof e==\"string\"){let A=e instanceof At?e.fontface.family:e,R=e instanceof At?{outline:e.outline,filter:e.filter}:{outline:null,filter:Zt},V=Xr[A]??{font:{tex:new Ve(a.gfx.ggl,2048,2048,{filter:R.filter}),map:{},size:64},cursor:new E(0),maxHeight:0,outline:R.outline};Xr[A]||(Xr[A]=V),e=V.font;for(let x of o)if(!V.font.map[x]){let w=a.fontCacheC2d;if(!w)throw new Error(\"fontCacheC2d is not defined.\");if(!a.fontCacheCanvas)throw new Error(\"fontCacheCanvas is not defined.\");w.clearRect(0,0,a.fontCacheCanvas.width,a.fontCacheCanvas.height),w.font=`${e.size}px ${A}`,w.textBaseline=\"top\",w.textAlign=\"left\",w.fillStyle=\"#ffffff\";let S=w.measureText(x),G=Math.ceil(S.width);if(!G)continue;let M=Math.ceil(Math.abs(S.actualBoundingBoxAscent))+Math.ceil(Math.abs(S.actualBoundingBoxDescent));V.outline&&V.outline.width&&V.outline.color&&(w.lineJoin=\"round\",w.lineWidth=V.outline.width*2,w.strokeStyle=V.outline.color.toHex(),w.strokeText(x,V.outline.width,V.outline.width),G+=V.outline.width*2,M+=V.outline.width*3),w.fillText(x,V.outline?.width??0,V.outline?.width??0);let D=w.getImageData(0,0,G,M);if(V.cursor.x+G>2048&&(V.cursor.x=0,V.cursor.y+=V.maxHeight,V.maxHeight=0,V.cursor.y>2048))throw new Error(\"Font atlas exceeds character limit\");e.tex.update(D,V.cursor.x,V.cursor.y),e.map[x]=new q(V.cursor.x,V.cursor.y,G,M),V.cursor.x+=G+1,V.maxHeight=Math.max(V.maxHeight,M)}}let s=t.size||e.size,i=v(t.scale??1).scale(s/e.size),m=t.lineSpacing??0,u=t.letterSpacing??0,c=0,p=0,b=0,l=[],h=[],d=0,C=null,g=0,y;for(;d<o.length;){let A=o[d];if(A===`\n`)b+=s+m,l.push({width:c-u,chars:h}),C=null,g=0,c=0,h=[],y=void 0;else{let R=e.map[A];if(R){let V=R.w*i.x;t.width&&c+V>t.width&&(b+=s+m,C!=null&&(d-=h.length-C,A=o[d],R=e.map[A],V=R.w*i.x,h=h.slice(0,C-1),c=g),C=null,g=0,l.push({width:c-u,chars:h}),c=y??0,h=[]),h.push({tex:e.tex,width:R.w,height:R.h,quad:new q(R.x/e.tex.width,R.y/e.tex.height,R.w/e.tex.width,R.h/e.tex.height),ch:A,pos:new E(c,b),opacity:t.opacity??1,color:t.color??j.WHITE,scale:v(i),angle:0}),A===\" \"&&(C=h.length,g=c),t.indentAll&&y===void 0&&/\\S/.test(A)&&(y=c),c+=V,p=Math.max(p,c),c+=u}}d++}l.push({width:c-u,chars:h}),b+=s,t.width&&(p=t.width);let O=[];for(let A=0;A<l.length;A++){let R=(p-l[A].width)*Rs(t.align??\"left\");for(let V of l[A].chars){let x=e.map[V.ch],w=O.length+A;if(V.pos=V.pos.add(R,0).add(x.w*i.x*.5,x.h*i.y*.5),t.transform){let S=typeof t.transform==\"function\"?t.transform(w,V.ch):t.transform;S&&mi(V,S)}if(n[w]){let S=n[w];for(let G of S){let M=t.styles?.[G],D=typeof M==\"function\"?M(w,V.ch):M;D&&mi(V,D)}}O.push(V)}}return{width:p,height:b,chars:O,opt:t,renderedText:r}}function it(t){if(t.width===void 0||t.height===void 0)throw new Error('drawUVQuad() requires property \"width\" and \"height\".');if(t.width<=0||t.height<=0)return;let e=t.width,n=t.height,o=_e(t.anchor||mt).scale(new E(e,n).scale(-.5)),s=t.quad||new q(0,0,1,1),i=t.color||I(255,255,255),m=t.opacity??1,u=t.tex?.1/t.tex.width:0,c=t.tex?.1/t.tex.height:0,p=s.x+u,b=s.y+c,l=s.w-u*2,h=s.h-c*2;ge(),X(t.pos),Ye(t.angle),rt(t.scale),X(o),Le([{pos:new E(-e/2,n/2),uv:new E(t.flipX?p+l:p,t.flipY?b:b+h),color:i,opacity:m},{pos:new E(-e/2,-n/2),uv:new E(t.flipX?p+l:p,t.flipY?b+h:b),color:i,opacity:m},{pos:new E(e/2,-n/2),uv:new E(t.flipX?p:p+l,t.flipY?b+h:b),color:i,opacity:m},{pos:new E(e/2,n/2),uv:new E(t.flipX?p:p+l,t.flipY?b:b+h),color:i,opacity:m}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform??void 0),me()}function He(t){ge(),X(t.opt.pos),Ye(t.opt.angle),X(_e(t.opt.anchor??\"topleft\").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(e=>{it({tex:e.tex,width:e.width,height:e.height,pos:e.pos,scale:e.scale,angle:e.angle,color:e.color,opacity:e.opacity,quad:e.quad,anchor:\"center\",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),me()}function xe(t){if(t.width===void 0||t.height===void 0)throw new Error('drawRect() requires property \"width\" and \"height\".');if(t.width<=0||t.height<=0)return;let e=t.width,n=t.height,o=_e(t.anchor||mt).add(1,1).scale(new E(e,n).scale(-.5)),s=[new E(0,0),new E(e,0),new E(e,n),new E(0,n)];if(t.radius){let i=Math.min(e,n)/2,m=Array.isArray(t.radius)?t.radius.map(u=>Math.min(i,u)):new Array(4).fill(Math.min(i,t.radius));s=[new E(m[0],0),...m[1]?wt(new E(e-m[1],m[1]),m[1],m[1],270,360):[v(e,0)],...m[2]?wt(new E(e-m[2],n-m[2]),m[2],m[2],0,90):[v(e,n)],...m[3]?wt(new E(m[3],n-m[3]),m[3],m[3],90,180):[v(0,n)],...m[0]?wt(new E(m[0],m[0]),m[0],m[0],180,270):[]]}Pe(Object.assign({},t,{offset:o,pts:s,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}function qe(t){Ce();let e=a.gfx.width,n=a.gfx.height;a.gfx.width=a.gfx.viewport.width,a.gfx.height=a.gfx.viewport.height,t(),Ce(),a.gfx.width=e,a.gfx.height=n}function Qr(t,e){qe(()=>{let n=v(8);ge(),X(t);let r=Ue({text:e,font:yt,size:16,pos:n,color:I(255,255,255),fixed:!0}),o=r.width+n.x*2,s=r.height+n.x*2;t.x+o>=ie()&&X(v(-o,0)),t.y+s>=ue()&&X(v(0,-s)),xe({width:o,height:s,color:I(0,0,0),radius:4,opacity:.8,fixed:!0}),He(r),me()})}function Xn(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawTriangle() requires properties \"p1\", \"p2\" and \"p3\".');return Pe(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}function di(){if(a.debug.inspect){let t=null;for(let e of a.game.root.get(\"*\",{recursive:!0}))if(e.has(\"area\")&&e.isHovering()){t=e;break}if(a.game.root.drawInspect(),t){let e=[],n=t.inspect();for(let r in n)n[r]?e.push(`${n[r]}`):e.push(`${r}`);Qr(Ss(a.k.mousePos()),e.join(`\n`))}Qr(v(8),`FPS: ${a.debug.fps()}`)}a.debug.paused&&qe(()=>{ge(),X(ie(),0),X(-8,8);let t=32;xe({width:t,height:t,anchor:\"topright\",color:I(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)xe({width:4,height:t*.6,anchor:\"center\",pos:v(-t/3*e,t*.5),color:I(255,255,255),radius:2,fixed:!0});me()}),a.debug.timeScale!==1&&qe(()=>{ge(),X(ie(),ue()),X(-8,-8);let t=8,e=Ue({text:a.debug.timeScale.toFixed(1),font:yt,size:16,color:I(255,255,255),pos:v(-t),anchor:\"botright\",fixed:!0});xe({width:e.width+t*2+t*4,height:e.height+t*2,anchor:\"botright\",color:I(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=0;n<2;n++){let r=a.debug.timeScale<1;Xn({p1:v(-e.width-t*(r?2:3.5),-t),p2:v(-e.width-t*(r?2:3.5),-t-e.height),p3:v(-e.width-t*(r?3.5:2),-t-e.height/2),pos:v(-n*t*1+(r?-t*.5:0),0),color:I(255,255,255),fixed:!0})}He(e),me()}),a.debug.curRecording&&qe(()=>{ge(),X(0,ue()),X(24,-24),Ne({radius:12,color:I(255,0,0),opacity:An(0,1,a.app.time()*4),fixed:!0}),me()}),a.debug.showLog&&a.game.logs.length>0&&qe(()=>{ge(),X(0,ue()),X(8,-8);let t=8,e=[];for(let r of a.game.logs){let o=\"\",s=r.msg instanceof Error?\"error\":\"info\";o+=`[time]${r.time.toFixed(2)}[/time]`,o+=\" \",o+=`[${s}]${Jr(r.msg)}[/${s}]`,e.push(o)}a.game.logs=a.game.logs.filter(r=>a.app.time()-r.time<(a.globalOpt.logTime||4));let n=Ue({text:e.join(`\n`),font:yt,pos:v(t,-t),anchor:\"botleft\",size:16,width:ie()*.6,lineSpacing:t/2,fixed:!0,styles:{time:{color:I(127,127,127)},info:{color:I(255,255,255)},error:{color:I(255,0,127)}}});xe({width:n.width+t*2,height:n.height+t*2,anchor:\"botleft\",color:I(0,0,0),radius:4,opacity:.8,fixed:!0}),He(n),me()})}function Jr(t,e=!1,n=new Set){if(n.has(t))return\"<recursive>\";var r=\"\",o;return e&&typeof t==\"string\"&&(t=JSON.stringify(t)),Array.isArray(t)&&(r=[\"[\",t.map(s=>Jr(s,!0,n.union(new Set([t])))).join(\", \"),\"]\"].join(\"\"),t=r),t===null?\"null\":(typeof t==\"object\"&&t.toString===Object.prototype.toString&&(t.constructor!==Object&&(r+=t.constructor.name+\" \"),r+=[\"{\",(o=Object.getOwnPropertyNames(t).map(s=>`${/^\\w+$/.test(s)?s:JSON.stringify(s)}: ${Jr(t[s],!0,n.union(new Set([t])))}`).join(\", \"))?` ${o} `:\"\",\"}\"].join(\"\"),t=r),String(t).replaceAll(/(?<!\\\\)\\[/g,\"\\\\[\"))}function fi(){let t=a.game.cam,e=E.fromAngle(he(0,360)).scale(t.shake);t.shake=de(t.shake,0,5*ee()),t.transform=new fe().translate(Ct()).scale(t.scale).rotate(t.angle).translate((t.pos??Ct()).scale(-1).add(e)),a.game.root.draw(),Ce()}function hi(){let t=Be();a.game.events.numListeners(\"loading\")>0?a.game.events.trigger(\"loading\",t):qe(()=>{let e=ie()/2,n=24,r=v(ie()/2,ue()/2).sub(v(e/2,n/2));xe({pos:v(0),width:ie(),height:ue(),color:I(0,0,0)}),xe({pos:r,width:e,height:n,fill:!1,outline:{width:4}}),xe({pos:r,width:e*t,height:n})})}function Qn(t,e,n){let r=a.gfx.ggl.gl;Ce(),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST),r.stencilFunc(r.NEVER,1,255),r.stencilOp(r.REPLACE,r.REPLACE,r.REPLACE),e(),Ce(),r.stencilFunc(n,1,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),t(),Ce(),r.disable(r.STENCIL_TEST)}function gi(t,e){let n=a.gfx.ggl.gl;Qn(t,e,n.EQUAL)}function Vt(t){if(!t.tex)throw new Error('drawTexture() requires property \"tex\".');let e=t.quad??new q(0,0,1,1),n=t.tex.width*e.w,r=t.tex.height*e.h,o=new E(1);if(t.tiled){let s=_e(t.anchor||mt),i=(t.pos?.x||0)-(s.x+1)*.5*(t.width||n),m=(t.pos?.y||0)-(s.y+1)*.5*(t.height||r),u=(t.width||n)/n,c=(t.height||r)/r,p=Math.floor(u),b=Math.floor(c),l=u-p,h=c-b,d=(p+l?1:0)*(b+h?1:0),C=new Array(d*6),g=new Array(d*4),y=0,O=(A,R,V,x,w)=>{C[y*6+0]=y*4+0,C[y*6+1]=y*4+1,C[y*6+2]=y*4+3,C[y*6+3]=y*4+1,C[y*6+4]=y*4+2,C[y*6+5]=y*4+3,g[y*4+0]={pos:new E(A-s.x,R-s.y),uv:new E(w.x,w.y),color:t.color||j.WHITE,opacity:t.opacity||1},g[y*4+1]={pos:new E(A+V-s.x,R-s.y),uv:new E(w.x+w.w,w.y),color:t.color||j.WHITE,opacity:t.opacity||1},g[y*4+2]={pos:new E(A+V-s.x,R+x-s.y),uv:new E(w.x+w.w,w.y+w.h),color:t.color||j.WHITE,opacity:t.opacity||1},g[y*4+3]={pos:new E(A-s.x,R+x-s.y),uv:new E(w.x,w.y+w.h),color:t.color||j.WHITE,opacity:t.opacity||1},y++};for(let A=0;A<b;A++){for(let R=0;R<p;R++)O(R*n,A*r,n,r,e);l&&O(p*n,A*r,n*l,r,new q(e.x,e.y,e.w*l,e.h))}if(h){for(let A=0;A<p;A++)O(A*n,b*r,n,r*h,new q(e.x,e.y,e.w,e.h*h));l&&O(p*n,b*r,n*l,r*h,new q(e.x,e.y,e.w*l,e.h*h))}Le(g,C,t.fixed,t.tex,t.shader,t.uniform??void 0)}else t.width&&t.height?(o.x=t.width/n,o.y=t.height/r):t.width?(o.x=t.width/n,o.y=o.x):t.height&&(o.y=t.height/r,o.x=o.y),it(Object.assign({},t,{scale:o.scale(t.scale||new E(1)),tex:t.tex,quad:e,width:n,height:r}))}function bi(t){if(!t.sprite)throw new Error('drawSprite() requires property \"sprite\"');let e=Kt(t.sprite);if(!e||!e.data)return;let n=e.data.frames[t.frame??0];if(!n)throw new Error(`Frame not found: ${t.frame??0}`);Vt(Object.assign({},t,{tex:e.data.tex,quad:n.scale(t.quad??new q(0,0,1,1))}))}function yi(t,e){let n=a.gfx.ggl.gl;Qn(t,e,n.NOTEQUAL)}function Zr(t){He(Ue(t))}var xi=(t,e)=>{let n=qn(e,tn,nn),r=t.pixelDensity??1,o=t.scale??1,{gl:s}=e,i=Ve.fromImage(e,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),m=t.width&&t.height?new st(e,t.width*r*o,t.height*r*o):new st(e,s.drawingBufferWidth,s.drawingBufferHeight),u=null,c=1;t.background&&(typeof t.background==\"string\"?u=I(t.background):(u=I(...t.background),c=t.background[3]??1),s.clearColor(u.r/255,u.g/255,u.b/255,c??1)),s.enable(s.BLEND),s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);let p=new Yn(e,en,as,us),b=Ve.fromImage(e,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:\"repeat\",filter:\"nearest\"});return{lastDrawCalls:0,ggl:e,defShader:n,defTex:i,frameBuffer:m,postShader:null,postShaderUniform:null,renderer:p,transform:new fe,transformStack:[],bgTex:b,bgColor:u,bgAlpha:c,width:t.width??s.drawingBufferWidth/r/o,height:t.height??s.drawingBufferHeight/r/o,viewport:{x:0,y:0,width:s.drawingBufferWidth,height:s.drawingBufferHeight,scale:1},fixed:!1}};function at(t){return t.fixed?!0:t.parent?at(t.parent):!1}function je(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}function vi(t,e={}){return{id:\"circle\",radius:t,draw(){Ne(Object.assign(je(this),{radius:this.radius,fill:e.fill}))},renderArea(){return new W(new E(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}function Jn(...t){return{id:\"color\",color:I(...t),inspect(){return`color: ${this.color.toString()}`}}}function wi(t){return{add(){this.canvas=t}}}function Ci(t=1){let e,n=0,r=!1;return{require:[\"opacity\"],add(){e=this.opacity,this.opacity=0},update(){r||(n+=ee(),this.opacity=Se(n,0,t,0,e),n>=t&&(this.opacity=e,r=!0))}}}function Ei(t=\"intersect\"){return{id:\"mask\",mask:t}}function Zn(t){return{id:\"opacity\",opacity:t??1,fadeIn(e=1,n=a.k.easings.linear){return a.game.root.tween(0,this.opacity,e,r=>this.opacity=r,n)},fadeOut(e=1,n=a.k.easings.linear){return a.game.root.tween(this.opacity,0,e,r=>this.opacity=r,n)},inspect(){return`opacity: ${on(this.opacity,1)}`}}}function Ti(t=1,e=I(0,0,0),n=1,r=\"miter\",o=10,s=\"butt\"){return{id:\"outline\",outline:{width:t,color:e,opacity:n,join:r,miterLimit:o,cap:s},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}var eo=class{pos=v(0);vel=v(0);acc=v(0);angle=0;angularVelocity=0;damping=0;t;lt=null;gc;constructor(){this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}};function Oi(t,e){let n=e.lifetime,r=[],o=t.colors||[j.WHITE],s=t.opacities||[1],i=t.quads||[new q(0,0,1,1)],m=t.scales||[1],u=t.lifeTime,c=e.direction,p=e.spread,b=t.speed||[0,0],l=t.angle||[0,0],h=t.angularVelocity||[0,0],d=t.acceleration||[v(0),v(0)],C=t.damping||[0,0],g=[],y=new Array(t.max),O=0,A=0;for(let x=0;x<t.max;x++){g[x*6+0]=x*4+0,g[x*6+1]=x*4+1,g[x*6+2]=x*4+3,g[x*6+3]=x*4+1,g[x*6+4]=x*4+2,g[x*6+5]=x*4+3;for(let w=0;w<4;w++)y[x*4+w]={pos:new E(0,0),uv:new E(0,0),color:I(255,255,255),opacity:1};r[x]=new eo}let R=new re;function V(x=0){for(;x<t.max;){if(r[x].gc)return x;x++}return null}return{id:\"particles\",emit(x){let w=0;for(let S=0;S<x;S++){if(w=V(w),w==null)return;let G=he(c-p,c+p),M=E.fromAngle(G).scale(he(b[0],b[1])),D=he(l[0],l[1]),L=he(h[0],h[1]),U=v(he(d[0].x,d[1].x),he(d[0].y,d[1].y)),H=he(C[0],C[1]),Y=u?he(u[0],u[1]):null,_=e.shape?e.shape.random():v(),K=r[w];K.lt=Y,K.pos=_,K.vel=M,K.acc=U,K.angle=D,K.angularVelocity=L,K.damping=H,K.angularVelocity=L,K.gc=!1}O+=x},update(){if(n!==void 0&&n<=0)return;let x=ee();for(let w of r)if(!w.gc){if(w.t+=x,w.lt&&w.t>=w.lt){w.gc=!0,O--;continue}w.vel=w.vel.add(w.acc.scale(x)).scale(1-w.damping*x),w.pos=w.pos.add(w.vel.scale(x)),w.angle+=w.angularVelocity*x}for(n!==void 0&&(n-=x,n<=0&&R.trigger()),A+=x;O<t.max&&e.rate&&A>e.rate;)this.emit(1),O++,A-=e.rate},draw(){if(!(n!==void 0&&n<=0)){for(let x=0;x<r.length;x++){let w=r[x];if(w.gc)continue;let S=w.progress,G=Math.floor(w.progress*o.length),M=G<o.length-1?de(o[G],o[G+1],Se(S,G/o.length,(G+1)/o.length,0,1)):o[G],D=Math.floor(w.progress*s.length),L=D<s.length-1?de(s[D],s[D+1],Se(S,D/s.length,(D+1)/s.length,0,1)):s[D],U=Math.floor(w.progress*i.length),H=i[U],Y=Math.floor(w.progress*m.length),_=m[Y],K=Math.cos(w.angle*Math.PI/180),J=Math.sin(w.angle*Math.PI/180),$=(t.texture?t.texture.width:10)*H.w/2,Z=(t.texture?t.texture.height:10)*H.h/2,Ee=x*4,k=y[Ee];k.pos.x=w.pos.x+-$*_*K- -Z*_*J,k.pos.y=w.pos.y+-$*_*J+-Z*_*K,k.uv.x=H.x,k.uv.y=H.y,k.color.r=M.r,k.color.g=M.g,k.color.b=M.b,k.opacity=L,k=y[Ee+1],k.pos.x=w.pos.x+$*_*K- -Z*_*J,k.pos.y=w.pos.y+$*_*J+-Z*_*K,k.uv.x=H.x+H.w,k.uv.y=H.y,k.color.r=M.r,k.color.g=M.g,k.color.b=M.b,k.opacity=L,k=y[Ee+2],k.pos.x=w.pos.x+$*_*K-Z*_*J,k.pos.y=w.pos.y+$*_*J+Z*_*K,k.uv.x=H.x+H.w,k.uv.y=H.y+H.h,k.color.r=M.r,k.color.g=M.g,k.color.b=M.b,k.opacity=L,k=y[Ee+3],k.pos.x=w.pos.x+-$*_*K-Z*_*J,k.pos.y=w.pos.y+-$*_*J+Z*_*K,k.uv.x=H.x,k.uv.y=H.y+H.h,k.color.r=M.r,k.color.g=M.g,k.color.b=M.b,k.opacity=L}Le(y,g,this.fixed,t.texture,this.shader,this.uniform)}},onEnd(x){return R.add(x)},inspect(){return`count: ${O}/${t.max}`}}}function Ai(t,e={}){if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:\"polygon\",pts:t,colors:e.colors,uv:e.uv,tex:e.tex,radius:e.radius,draw(){Pe(Object.assign(je(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:e.fill,triangulate:e.triangulate}))},renderArea(){return new be(this.pts)},inspect(){return`polygon: ${this.pts.map(n=>`[${n.x},${n.y}]`).join(\",\")}`}}}function er(t,e,n){let r;return a.game.root.get(\"area\").forEach(s=>{if(n&&n.some(u=>s.is(u)))return;let m=s.worldArea().raycast(t,e);m&&(r?m.fraction<r.fraction&&(r=m,r.object=s):(r=m,r.object=s))}),r}function tr(t,e,n={}){return{id:\"rect\",width:t,height:e,radius:n.radius||0,draw(){xe(Object.assign(je(this),{width:this.width,height:this.height,radius:this.radius,fill:n.fill}))},renderArea(){return new W(v(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}function Si(t,e){return{id:\"shader\",shader:t,...typeof e==\"function\"?{uniform:e(),update(){this.uniform=e()}}:{uniform:e},inspect(){return`shader: ${t}`}}}function Vi(t,e){if(!e.tileWidth||!e.tileHeight)throw new Error(\"Must provide tileWidth and tileHeight.\");let n=a.game.root.add([Pt(e.pos??v(0))]),r=t.length,o=0,s=null,i=null,m=null,u=null,c=x=>x.x+x.y*o,p=x=>v(Math.floor(x%o),Math.floor(x/o)),b=()=>{s=[];for(let x of n.children)l(x)},l=x=>{let w=c(x.tilePos);s[w]?s[w].push(x):s[w]=[x]},h=x=>{let w=c(x.tilePos);if(s[w]){let S=s[w].indexOf(x);S>=0&&s[w].splice(S,1)}},d=()=>{let x=!1;for(let w of n.children){let S=n.pos2Tile(w.pos);(w.tilePos.x!=S.x||w.tilePos.y!=S.y)&&(x=!0,h(w),w.tilePos.x=S.x,w.tilePos.y=S.y,l(w))}x&&n.trigger(\"spatialMapChanged\")},C=()=>{let x=n.getSpatialMap(),w=n.numRows()*n.numColumns();i?i.length=w:i=new Array(w),i.fill(1,0,w);for(let S=0;S<x.length;S++){let G=x[S];if(G){let M=0;for(let D of G)if(D.isObstacle){M=1/0;break}else M+=D.cost;i[S]=M||1}}},g=()=>{let x=n.getSpatialMap(),w=n.numRows()*n.numColumns();m?m.length=w:m=new Array(w),m.fill(15,0,w);for(let S=0;S<x.length;S++){let G=x[S];if(G){let M=G.length,D=15;for(let L=0;L<M;L++)D|=G[L].edgeMask;m[S]=D}}},y=()=>{let x=n.numRows()*n.numColumns(),w=(G,M)=>{let D=[];for(D.push(G);D.length>0;){let L=D.pop();R(L).forEach(U=>{u[U]<0&&(u[U]=M,D.push(U))})}};u?u.length=x:u=new Array(x),u.fill(-1,0,x);let S=0;for(let G=0;G<i.length;G++){if(u[G]>=0){S++;continue}w(G,S),S++}},O=(x,w)=>i[w],A=(x,w)=>{let S=p(x),G=p(w);return S.dist(G)},R=(x,w)=>{let S=[],G=Math.floor(x%o),M=G>0&&m[x]&1&&i[x-1]!==1/0,D=x>=o&&m[x]&2&&i[x-o]!==1/0,L=G<o-1&&m[x]&4&&i[x+1]!==1/0,U=x<o*r-o-1&&m[x]&8&&i[x+o]!==1/0;return w?(M&&(D&&S.push(x-o-1),S.push(x-1),U&&S.push(x+o-1)),D&&S.push(x-o),L&&(D&&S.push(x-o+1),S.push(x+1),U&&S.push(x+o+1)),U&&S.push(x+o)):(M&&S.push(x-1),D&&S.push(x-o),L&&S.push(x+1),U&&S.push(x+o)),S},V={id:\"level\",tileWidth(){return e.tileWidth},tileHeight(){return e.tileHeight},spawn(x,...w){let S=v(...w),G=(()=>{if(typeof x==\"string\"){if(e.tiles[x]){if(typeof e.tiles[x]!=\"function\")throw new Error(\"Level symbol def must be a function returning a component list\");return e.tiles[x](S)}else if(e.wildcardTile)return e.wildcardTile(x,S)}else{if(Array.isArray(x))return x;throw new Error(\"Expected a symbol or a component list\")}})();if(!G)return null;let M=!1,D=!1;for(let U of G)U.id===\"tile\"&&(D=!0),U.id===\"pos\"&&(M=!0);M||G.push(Pt(this.tile2Pos(S))),D||G.push(nr());let L=n.add(G);return M&&(L.tilePosOffset=L.pos.clone()),L.tilePos=S,L.transform=dt(L),s&&(l(L),this.trigger(\"spatialMapChanged\"),this.trigger(\"navigationMapInvalid\")),L},numColumns(){return o},numRows(){return r},levelWidth(){return o*this.tileWidth()},levelHeight(){return r*this.tileHeight()},tile2Pos(...x){return v(...x).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...x){let w=v(...x);return v(Math.floor(w.x/this.tileWidth()),Math.floor(w.y/this.tileHeight()))},getSpatialMap(){return s||b(),s},removeFromSpatialMap:h,insertIntoSpatialMap:l,onSpatialMapChanged(x){return this.on(\"spatialMapChanged\",x)},onNavigationMapInvalid(x){return this.on(\"navigationMapInvalid\",x)},getAt(x){s||b();let w=c(x);return s[w]||[]},raycast(x,w){let S=this.toWorld(x),G=this.toWorld(x.add(w)).sub(S),M=1/this.tileWidth(),D=x.scale(M),L=_o(D,w,U=>{let H=this.getAt(U);if(H.some(_=>_.isObstacle))return!0;let Y=null;for(let _ of H)if(_.has(\"area\")){let J=_.worldArea().raycast(S,G);J&&(Y?J.fraction<Y.fraction&&(Y=J,Y.object=_):(Y=J,Y.object=_))}return Y&&(Y.point=this.fromWorld(Y.point).scale(M)),Y||!1},64);return L&&(L.point=L.point.scale(this.tileWidth())),L},update(){s&&d()},invalidateNavigationMap(){i=null,m=null,u=null},onNavigationMapChanged(x){return this.on(\"navigationMapChanged\",x)},getTilePath(x,w,S={}){if(i||C(),m||g(),u||y(),x.x<0||x.x>=o||x.y<0||x.y>=r||w.x<0||w.x>=o||w.y<0||w.y>=r)return null;let G=c(x),M=c(w);if(i[M]===1/0)return null;if(G===M)return[];if(u[G]!=-1&&u[G]!==u[M])return null;let D=new It((K,J)=>K.cost<J.cost);D.insert({cost:0,node:G});let L=new Map;L.set(G,G);let U=new Map;for(U.set(G,0);D.length!==0;){let K=D.remove()?.node;if(K===M)break;let J=R(K,S.allowDiagonals);for(let $ of J){let Z=(U.get(K)||0)+O(K,$)+A($,M);(!U.has($)||Z<U.get($))&&(U.set($,Z),D.insert({cost:Z,node:$}),L.set($,K))}}let H=[],Y=M,_=p(Y);for(H.push(_);Y!==G;){let K=L.get(Y);if(K===void 0)throw new Error(\"Bug in pathfinding algorithm\");Y=K;let J=p(Y);H.push(J)}return H.reverse()},getPath(x,w,S={}){let G=this.tileWidth(),M=this.tileHeight(),D=this.getTilePath(this.pos2Tile(x),this.pos2Tile(w),S);return D?[x,...D.slice(1,-1).map(L=>L.scale(G,M).add(G/2,M/2)),w]:null}};return n.use(V),n.onNavigationMapInvalid(()=>{n.invalidateNavigationMap(),n.trigger(\"navigationMapChanged\")}),t.forEach((x,w)=>{let S=x.split(\"\");o=Math.max(S.length,o),S.forEach((G,M)=>{n.spawn(G,v(M,w))})}),n}function Ge(t,e,n){return a.game.objEvents.registers[t]||(a.game.objEvents.registers[t]=new rn),a.game.objEvents.on(t,(r,...o)=>{r.is(e)&&n(r,...o)})}var Pi=(t,e,...n)=>{for(let r of a.game.root.children)r.is(e)&&r.trigger(t,n)},Gi=ne(t=>{let e=a.game.root.add([{fixedUpdate:t}]);return{get paused(){return e.paused},set paused(n){e.paused=n},cancel:()=>e.destroy()}},(t,e)=>Ge(\"fixedUpdate\",t,e)),rr=ne(t=>{let e=a.game.root.add([{update:t}]);return{get paused(){return e.paused},set paused(n){e.paused=n},cancel:()=>e.destroy()}},(t,e)=>Ge(\"update\",t,e)),Mi=ne(t=>{let e=a.game.root.add([{draw:t}]);return{get paused(){return e.hidden},set paused(n){e.hidden=n},cancel:()=>e.destroy()}},(t,e)=>Ge(\"draw\",t,e)),to=ne(t=>a.game.events.on(\"add\",t),(t,e)=>Ge(\"add\",t,e)),Ri=ne(t=>a.game.events.on(\"destroy\",t),(t,e)=>Ge(\"destroy\",t,e)),Di=ne(t=>a.game.events.on(\"use\",t),(t,e)=>Ge(\"use\",t,e)),Bi=ne(t=>a.game.events.on(\"unuse\",t),(t,e)=>Ge(\"unuse\",t,e)),no=ne(t=>a.game.events.on(\"tag\",t),(t,e)=>Ge(\"tag\",t,e)),Fi=ne(t=>a.game.events.on(\"untag\",t),(t,e)=>Ge(\"untag\",t,e));function Li(t,e,n){return Ge(\"collide\",t,(r,o,s)=>o.is(e)&&n(r,o,s))}function ji(t,e,n){return Ge(\"collideUpdate\",t,(r,o,s)=>o.is(e)&&n(r,o,s))}function Ii(t,e,n){return Ge(\"collideEnd\",t,(r,o,s)=>o.is(e)&&n(r,o,s))}function or(t,e){a.game.root.get(t,{recursive:!0}).forEach(e),to(t,e),no((n,r)=>{r===t&&e(n)})}var Ki=ne(t=>a.app.onMousePress(t),(t,e)=>{let n=[];return or(t,r=>{if(!r.area)throw new Error(\"onClick() requires the object to have area() component\");n.push(r.onClick(()=>e(r)))}),ke.join(n)});function ki(t,e){let n=[];return or(t,r=>{if(!r.area)throw new Error(\"onHover() requires the object to have area() component\");n.push(r.onHover(()=>e(r)))}),ke.join(n)}function _i(t,e){let n=[];return or(t,r=>{if(!r.area)throw new Error(\"onHoverUpdate() requires the object to have area() component\");n.push(r.onHoverUpdate(()=>e(r)))}),ke.join(n)}function Ni(t,e){let n=[];return or(t,r=>{if(!r.area)throw new Error(\"onHoverEnd() requires the object to have area() component\");n.push(r.onHoverEnd(()=>e(r)))}),ke.join(n)}function Ui(t){a.game.events.on(\"loading\",t)}function Hi(t){a.app.onResize(t)}function qi(t){a.game.events.on(\"error\",t)}function Nt(t){a.assets.loaded?t():a.game.events.on(\"load\",t)}function zi(t){if(a.assets.loaded)Un().forEach(e=>t(...e));else return a.game.events.on(\"loadError\",t)}function ro(...t){a.game.cam.pos=v(...t)}function oo(){return a.game.cam.pos?a.game.cam.pos.clone():Ct()}function so(...t){a.game.cam.scale=v(...t)}function io(){return a.game.cam.scale.clone()}function ao(t){a.game.cam.angle=t}function uo(){return a.game.cam.angle}function Wi(){return a.game.cam.transform.clone()}function co(t=I(255,255,255),e=1){let n=a.game.root.add([tr(ie(),ue()),Jn(t),Zn(1),ar()]),r=n.fadeOut(e);return r.onEnd(()=>ir(n)),r}function Yi(){return a.game.cam.transform.clone()}function $i(t=12){a.game.cam.shake+=t}function pn(t){return a.game.cam.transform.multVec2(t)}function sr(t){return a.game.cam.transform.invert().multVec2(t)}function Xi(...t){return tt(\"camPos\",\"setCamPos / getCamPos\"),t.length>0&&ro(...t),oo()}function Qi(...t){return tt(\"camScale\",\"setCamScale / getCamScale\"),t.length>0&&so(...t),io()}function Ji(t){return tt(\"camRot\",\"setCamRot / getCamRot\"),t!==void 0&&ao(t),uo()}function Zi(t=I(255,255,255),e=1){return tt(\"camFlash\",\"flash\"),co(t,e)}function dn(t=[]){let e=new Map,n=[],r={},o=new ze,s=[],i=new Set(\"*\"),m=a.globalOpt.tagsAsComponents,u=null,c=!1,p={id:Os(),hidden:!1,transform:new fe,children:[],parent:null,set paused(l){if(l!==c){c=l;for(let h of s)h.paused=l}},get paused(){return c},get tags(){return Array.from(i)},add(l){let h=Array.isArray(l)?dn(l):l;if(h.parent)throw new Error(\"Cannot add a game obj that already has a parent.\");return h.parent=this,h.transform=dt(h),this.children.push(h),h.trigger(\"add\",h),a.game.events.trigger(\"add\",h),h},readd(l){let h=this.children.indexOf(l);return h!==-1&&(this.children.splice(h,1),this.children.push(l)),l},remove(l){let h=this.children.indexOf(l);if(h!==-1){l.parent=null,this.children.splice(h,1);let d=C=>{C.trigger(\"destroy\"),a.game.events.trigger(\"destroy\",C),C.children.forEach(g=>d(g))};d(l)}},removeAll(l){if(l)this.get(l).forEach(h=>this.remove(h));else for(let h of[...this.children])this.remove(h)},fixedUpdate(){this.paused||(this.children.forEach(l=>l.fixedUpdate()),this.trigger(\"fixedUpdate\"))},update(){this.paused||(this.children.forEach(l=>l.update()),this.trigger(\"update\"))},draw(){if(this.hidden)return;this.canvas&&(Ce(),this.canvas.bind());let l=a.gfx.fixed;this.fixed&&(a.gfx.fixed=!0),ge(),X(this.pos),rt(this.scale),Ye(this.angle);let h=this.children.sort((d,C)=>{let g=d.layerIndex??a.game.defaultLayerIndex,y=C.layerIndex??a.game.defaultLayerIndex;return g-y||(d.z??0)-(C.z??0)});if(this.mask){let d={intersect:a.k.drawMasked,subtract:a.k.drawSubtracted}[this.mask];if(!d)throw new Error(`Invalid mask func: \"${this.mask}\"`);d(()=>{h.forEach(C=>C.draw())},()=>{this.trigger(\"draw\")})}else this.trigger(\"draw\"),h.forEach(d=>d.draw());me(),a.gfx.fixed=l,this.canvas&&(Ce(),this.canvas.unbind())},drawInspect(){this.hidden||(ge(),X(this.pos),rt(this.scale),Ye(this.angle),this.children.forEach(l=>l.drawInspect()),this.trigger(\"drawInspect\"),me())},use(l){if(typeof l==\"string\")return i.add(l);if(!l||typeof l!=\"object\")throw new Error(`You can only pass a component or a string to .use(), you passed a \"${typeof l}\"`);let h=[];l.id?(this.unuse(l.id),r[l.id]=[],h=r[l.id],e.set(l.id,l),m&&i.add(l.id)):n.push(l);for(let C in l){if(ms.has(C))continue;let g=Object.getOwnPropertyDescriptor(l,C);if(g)if(typeof g.value==\"function\"&&(l[C]=l[C].bind(this)),g.set&&Object.defineProperty(l,C,{set:g.set.bind(this)}),g.get&&Object.defineProperty(l,C,{get:g.get.bind(this)}),ps.has(C)){let y=C===\"add\"?()=>{u=O=>h.push(O),l[C]?.(),u=null}:l[C];h.push(this.on(C,y).cancel)}else if(this[C]===void 0)Object.defineProperty(this,C,{get:()=>l[C],set:y=>l[C]=y,configurable:!0,enumerable:!0}),h.push(()=>delete this[C]);else{let y=e.values().find(O=>O[C]!==void 0)?.id;throw new Error(`Duplicate component property: \"${C}\" while adding component \"${l.id}\"`+(y?` (originally added by \"${y}\")`:\"\"))}}let d=()=>{if(l.require){for(let C of l.require)if(!this.c(C))throw new Error(`Component \"${l.id}\" requires component \"${C}\"`)}};l.destroy&&h.push(l.destroy.bind(this)),this.exists()?(d(),l.add&&(u=C=>h.push(C),l.add.call(this),u=null),l.id&&(this.trigger(\"use\",l.id),a.game.events.trigger(\"use\",this,l.id))):l.require&&h.push(this.on(\"add\",d).cancel)},unuse(l){if(e.has(l)){for(let h of e.values())if(h.require&&h.require.includes(l))throw new Error(`Can't unuse. Component \"${h.id}\" requires component \"${l}\"`);e.delete(l),this.trigger(\"unuse\",l),a.game.events.trigger(\"unuse\",this,l)}else m&&i.has(l)&&i.delete(l);r[l]&&(r[l].forEach(h=>h()),delete r[l])},c(l){return e.get(l)??null},get(l,h={}){let d=(g,y)=>h.only===\"comps\"?g.has(y):h.only===\"tags\"?g.is(y):g.is(y)||g.has(y),C=h.recursive?this.children.flatMap(function g(y){return[y,...y.children.flatMap(g)]}):this.children;if(C=C.filter(g=>l?d(g,l):!0),h.liveUpdate){let g=O=>h.recursive?this.isAncestorOf(O):O.parent===this,y=[];y.push(a.k.onAdd(O=>{g(O)&&d(O,l)&&C.push(O)})),y.push(a.k.onDestroy(O=>{if(g(O)&&d(O,l)){let A=C.findIndex(R=>R.id===O.id);A!==-1&&C.splice(A,1)}})),this.onDestroy(()=>{for(let O of y)O.cancel()})}return C},query(l){let h=l.hierarchy||\"children\",d=l.include,C=l.exclude,g=[];switch(h){case\"children\":g=this.children;break;case\"siblings\":g=this.parent?this.parent.children.filter(O=>O!==this):[];break;case\"ancestors\":let y=this.parent;for(;y;)g.push(y),y=y.parent;break;case\"descendants\":g=this.children.flatMap(function O(A){return[A,...A.children.flatMap(O)]});break}if(d&&((l.includeOp||\"and\")===\"and\"||!Array.isArray(l.include)?g=g.filter(O=>O.is(d)):g=g.filter(O=>l.include.some(A=>O.is(A)))),C&&((l.includeOp||\"and\")===\"and\"||!Array.isArray(l.include)?g=g.filter(O=>!O.is(C)):g=g.filter(O=>!l.exclude.some(A=>O.is(A)))),l.visible===!0&&(g=g.filter(y=>y.visible)),l.distance){if(!this.pos)throw Error(\"Can't do a distance query from an object without pos\");let y=l.distanceOp||\"near\",O=l.distance*l.distance;y===\"near\"?g=g.filter(A=>A.pos&&this.pos.sdist(A.pos)<=O):g=g.filter(A=>A.pos&&this.pos.sdist(A.pos)>O)}return l.name&&(g=g.filter(y=>y.name===l.name)),g},isAncestorOf(l){return l.parent?l.parent===this||this.isAncestorOf(l.parent):!1},exists(){return a.game.root.isAncestorOf(this)},is(l,h=\"and\"){return Array.isArray(l)?h===\"and\"?l.every(d=>i.has(d)):l.some(d=>i.has(d)):i.has(l)},tag(l){if(Array.isArray(l))for(let h of l)i.add(h),this.trigger(\"tag\",h),a.game.events.trigger(\"tag\",this,h);else i.add(l),this.trigger(\"tag\",l),a.game.events.trigger(\"tag\",this,l)},untag(l){if(Array.isArray(l))for(let h of l)i.delete(h),this.trigger(\"untag\",h),a.game.events.trigger(\"untag\",this,h);else i.delete(l),this.trigger(\"untag\",l),a.game.events.trigger(\"untag\",this,l)},has(l,h=\"and\"){return Array.isArray(l)?h===\"and\"?l.every(d=>e.has(d)):l.some(d=>e.has(d)):e.has(l)},on(l,h){let d=o.on(l,h.bind(this));return u&&u(()=>d.cancel()),d},trigger(l,...h){o.trigger(l,...h),a.game.objEvents.trigger(l,this,...h)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let l={};for(let[h,d]of e)l[h]=d.inspect?.()??null;for(let[h,d]of n.entries()){if(d.inspect){l[h]=d.inspect();continue}for(let[C,g]of Object.entries(d))typeof g!=\"function\"&&(l[C]=`${C}: ${g}`)}return l},onAdd(l){return this.on(\"add\",l)},onFixedUpdate(l){return this.on(\"fixedUpdate\",l)},onUpdate(l){return this.on(\"update\",l)},onDraw(l){return this.on(\"draw\",l)},onDestroy(l){return this.on(\"destroy\",l)},onUse(l){return this.on(\"use\",l)},onUnuse(l){return this.on(\"unuse\",l)},clearEvents(){o.clear()}},b=[\"onKeyPress\",\"onKeyPressRepeat\",\"onKeyDown\",\"onKeyRelease\",\"onMousePress\",\"onMouseDown\",\"onMouseRelease\",\"onMouseMove\",\"onCharInput\",\"onMouseMove\",\"onTouchStart\",\"onTouchMove\",\"onTouchEnd\",\"onScroll\",\"onGamepadButtonPress\",\"onGamepadButtonDown\",\"onGamepadButtonRelease\",\"onGamepadStick\",\"onButtonPress\",\"onButtonDown\",\"onButtonRelease\"];for(let l of b)p[l]=(...h)=>{let d=a.app[l]?.(...h);return s.push(d),p.onDestroy(()=>d.cancel()),p.on(\"sceneEnter\",()=>{s.splice(s.indexOf(d),1);let C=a.app[l]?.(...h);ke.replace(d,C),s.push(d)}),d};for(let l of t)p.use(l);return p}var ea=()=>({events:new ze,objEvents:new ze,root:dn([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new E(1),angle:0,shake:0,transform:new fe}});function ta(t){a.game.gravity=t?(a.game.gravity||v(0,1)).unit().scale(t):null}function na(){return a.game.gravity?a.game.gravity.len():0}function ra(t){a.game.gravity=t.unit().scale(a.game.gravity?a.game.gravity.len():1)}function ht(){return a.game.gravity?a.game.gravity.unit():v(0,1)}var oa=Oo(\"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\");var sa=()=>(()=>{let e=new(window.AudioContext||window.webkitAudioContext),n=e.createGain();n.connect(e.destination);let r=new ot(Ds(e));return e.decodeAudioData(oa.buffer.slice(0)).then(o=>{r.buf=o}).catch(o=>{console.error(\"Failed to load burp: \",o)}),{ctx:e,masterNode:n,burpSnd:r}})();function ia(t,e={}){let n=new re,r=new Audio(t);r.crossOrigin=\"anonymous\",r.loop=!!e.loop,a.audio.ctx.createMediaElementSource(r).connect(a.audio.masterNode);function s(){a.debug.paused||a.app.isHidden()&&!a.globalOpt.backgroundAudio||a.audio.ctx.resume()}function i(){s(),r.play()}return e.paused||i(),r.onended=()=>n.trigger(),{play(){i()},seek(m){r.currentTime=m},stop(){r.pause(),this.seek(0)},set loop(m){r.loop=m},get loop(){return r.loop},set paused(m){m?r.pause():i()},get paused(){return r.paused},time(){return r.currentTime},duration(){return r.duration},set volume(m){r.volume=Te(m,0,1)},get volume(){return r.volume},set speed(m){r.playbackRate=Math.max(m,0)},get speed(){return r.playbackRate},set detune(m){},get detune(){return 0},onEnd(m){return n.add(m)},then(m){return this.onEnd(m)}}}function aa(t,e={}){if(typeof t==\"string\"&&a.assets.music[t])return ia(a.assets.music[t],e);let n=a.audio.ctx,r=e.paused??!1,o=n.createBufferSource(),s=new re,i=n.createGain(),m=n.createStereoPanner(),u=e.seek??0,c=0,p=0,b=!1;o.loop=!!e.loop,o.detune.value=e.detune??0,o.playbackRate.value=e.speed??1,o.connect(m),o.onended=()=>{d()>=(o.buffer?.duration??Number.POSITIVE_INFINITY)&&s.trigger()},m.pan.value=e.pan??0,m.connect(i),i.connect(a.audio.masterNode),i.gain.value=e.volume??1;let l=g=>{o.buffer=g.buf,r||(c=n.currentTime,o.start(0,u),b=!0)},h=oi(t);h instanceof ce&&h.onLoad(l);let d=()=>{if(!o.buffer)return 0;let g=r?p-c:n.currentTime-c,y=o.buffer.duration;return o.loop?g%y:Math.min(g,y)},C=g=>{let y=n.createBufferSource();return y.buffer=g.buffer,y.loop=g.loop,y.playbackRate.value=g.playbackRate.value,y.detune.value=g.detune.value,y.onended=g.onended,y.connect(m),y};return{stop(){this.paused=!0,this.seek(0)},set paused(g){if(r!==g)if(r=g,g)b&&(o.stop(),b=!1),p=n.currentTime;else{o=C(o);let y=p-c;o.start(0,y),b=!0,c=n.currentTime-y,p=0}},get paused(){return r},play(g=0){this.seek(g),this.paused=!1},seek(g){o.buffer?.duration&&(g>o.buffer.duration||(r?(o=C(o),c=p-g):(o.stop(),o=C(o),c=n.currentTime-g,o.start(0,g),b=!0,p=0)))},set speed(g){o.playbackRate.value=g},get speed(){return o.playbackRate.value},set detune(g){o.detune.value=g},get detune(){return o.detune.value},set volume(g){i.gain.value=Math.max(g,0)},get volume(){return i.gain.value},set pan(g){m.pan.value=g},get pan(){return m.pan.value},set loop(g){o.loop=g},get loop(){return o.loop},duration(){return o.buffer?.duration??0},time(){return d()%this.duration()},onEnd(g){return s.add(g)},then(g){return this.onEnd(g)}}}function ur(t){return a.k.play(a.audio.burpSnd,t)}function lo(t){a.audio.masterNode.gain.value=t}function mo(){return a.audio.masterNode.gain.value}function ua(t){return tt(\"volume\",\"setVolume / getVolume\"),t!==void 0&&lo(t),mo()}function cr(){a.app.onHide(()=>{a.globalOpt.backgroundAudio||a.audio.ctx.suspend()}),a.app.onShow(()=>{!a.globalOpt.backgroundAudio&&!a.debug.paused&&a.audio.ctx.resume()}),a.app.onResize(()=>{if(a.app.isFullscreen())return;let t=a.globalOpt.width&&a.globalOpt.height;t&&!a.globalOpt.stretch&&!a.globalOpt.letterbox||(a.canvas.width=a.canvas.offsetWidth*a.pixelDensity,a.canvas.height=a.canvas.offsetHeight*a.pixelDensity,jn(),t||(a.gfx.frameBuffer.free(),a.gfx.frameBuffer=new st(a.gfx.ggl,a.gfx.ggl.gl.drawingBufferWidth,a.gfx.ggl.gl.drawingBufferHeight),a.gfx.width=a.gfx.ggl.gl.drawingBufferWidth/a.pixelDensity/a.gscale,a.gfx.height=a.gfx.ggl.gl.drawingBufferHeight/a.pixelDensity/a.gscale))}),a.globalOpt.debug!==!1&&(a.app.onKeyPress(a.globalOpt.debugKey??\"f1\",()=>a.debug.inspect=!a.debug.inspect),a.app.onKeyPress(\"f2\",()=>a.debug.clearLog()),a.app.onKeyPress(\"f8\",()=>a.debug.paused=!a.debug.paused),a.app.onKeyPress(\"f7\",()=>{a.debug.timeScale=on(Te(a.debug.timeScale-.2,0,2),1)}),a.app.onKeyPress(\"f9\",()=>{a.debug.timeScale=on(Te(a.debug.timeScale+.2,0,2),1)}),a.app.onKeyPress(\"f10\",()=>a.debug.stepFrame())),a.globalOpt.burp&&a.app.onKeyPress(\"b\",()=>ur())}function ca(t,e={}){let n=a.game.root.add([Pt(t),lr()]),r=(e.speed||1)*5,o=e.scale||1;n.add([fn(a.boomSprite),Ut(0),hn(\"center\"),po(r,o),...e.comps??[]]);let s=n.add([fn(a.kaSprite),Ut(0),hn(\"center\"),gn(),...e.comps??[]]);return s.wait(.4/r,()=>s.use(po(r,o))),s.onDestroy(()=>n.destroy()),n}function fo(t,e){if(a.game.layers)throw Error(\"Layers can only be assigned once.\");let n=t.indexOf(e);if(n==-1)throw Error(\"The default layer name should be present in the layers list.\");a.game.layers=t,a.game.defaultLayerIndex=n}function la(){return a.game.layers}function ma(){return a.game.layers?.[a.game.defaultLayerIndex]??null}function pa(t,e){tt(\"layers\",\"setLayers\"),fo(t,e)}function ir(t){t.destroy()}function da(){return a.game.root}function fa(t,e){a.game.scenes[t]=e}function ha(t,...e){if(!a.game.scenes[t])throw new Error(`Scene not found: ${t}`);a.game.events.onOnce(\"frameEnd\",()=>{a.game.events.trigger(\"sceneLeave\",t),a.app.events.clear(),a.game.events.clear(),a.game.objEvents.clear(),[...a.game.root.children].forEach(n=>{!n.stay||n.scenesToStay&&!n.scenesToStay.includes(t)?a.game.root.remove(n):n.trigger(\"sceneEnter\",t)}),a.game.root.clearEvents(),cr(),a.game.cam={pos:null,scale:v(1),angle:0,shake:0,transform:new fe},a.game.scenes[t](...e)}),a.game.currentScene=t}function ga(t){return a.game.events.on(\"sceneLeave\",t)}function ba(){return a.game.currentScene}function fn(t,e={}){let n=null,r=null,o=null,s=new re;if(!t)throw new Error(\"Please pass the resource name or data to sprite()\");let i=(c,p,b,l)=>{let h=v(1,1);return b&&l?(h.x=b/(c.width*p.w),h.y=l/(c.height*p.h)):b?(h.x=b/(c.width*p.w),h.y=h.x):l&&(h.y=l/(c.height*p.h),h.x=h.y),h},m=(c,p)=>{if(!p)return;let b=p.frames[0].clone();e.quad&&(b=b.scale(e.quad));let l=i(p.tex,b,e.width,e.height);if(c.width=p.tex.width*b.w*l.x,c.height=p.tex.height*b.h*l.y,p.anims)for(let h in p.anims){let d=p.anims[h];typeof d!=\"number\"&&(d.frames=u(d))}n=p,s.trigger(n),e.anim&&c.play(e.anim)},u=c=>{if(c.frames)return c.frames;let p=[];if(c.from===void 0||c.to===void 0)throw new Error(\"Sprite anim 'from' and 'to' must be defined if 'frames' is not defined\");let b=Math.abs(c.to-c.from)+1;for(let l=0;l<b;l++)p.push(c.from+l*Math.sign(c.to-c.from));if(c.pingpong)for(let l=b-2;l>0;l--)p.push(p[l]);return p};return{id:\"sprite\",width:0,height:0,frame:e.frame||0,quad:e.quad||new q(0,0,1,1),animSpeed:e.animSpeed??1,flipX:e.flipX??!1,flipY:e.flipY??!1,get sprite(){return t.toString()},set sprite(c){let p=Kt(c);p&&p.onLoad(b=>m(this,b))},get animFrame(){if(!n||!r||o===null)return this.frame;let c=n.anims[r.name];return typeof c==\"number\"?c:c.from===void 0||c.to===void 0?r.frameIndex:this.frame-Math.min(c.from,c.to)},draw(){if(!n)return;let c=n.frames[this.frame??0];if(!c)throw new Error(`Frame not found: ${this.frame??0}`);if(n.slice9){let{left:p,right:b,top:l,bottom:h}=n.slice9,d=n.tex.width*c.w,C=n.tex.height*c.h,g=this.width-p-b,y=this.height-l-h,O=p/d,A=b/d,R=1-O-A,V=l/C,x=h/C,w=1-V-x,S=[le(0,0,O,V),le(O,0,R,V),le(O+R,0,A,V),le(0,V,O,w),le(O,V,R,w),le(O+R,V,A,w),le(0,V+w,O,x),le(O,V+w,R,x),le(O+R,V+w,A,x),le(0,0,p,l),le(p,0,g,l),le(p+g,0,b,l),le(0,l,p,y),le(p,l,g,y),le(p+g,l,b,y),le(0,l+y,p,h),le(p,l+y,g,h),le(p+g,l+y,b,h)];for(let G=0;G<9;G++){let M=S[G],D=S[G+9];Vt(Object.assign(je(this),{pos:D.pos(),tex:n.tex,quad:c.scale(M),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:D.w,height:D.h}))}}else Vt(Object.assign(je(this),{tex:n.tex,quad:c.scale(this.quad??new q(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:this.width,height:this.height}))},add(){let c=Kt(t);c?c.onLoad(p=>m(this,p)):Nt(()=>m(this,Kt(t).data))},update(){if(!n||!r||o===null)return;let c=n.anims[r.name];if(typeof c==\"number\"){this.frame=c;return}if(c.speed===0)throw new Error(\"Sprite anim speed cannot be 0\");if(r.timer+=ee()*this.animSpeed,r.timer>=1/r.speed){r.timer=0,r.frameIndex+=o;let p=c.frames;if(r.frameIndex>=p.length)if(r.pingpong&&!c.pingpong)o=-1,r.frameIndex=p.length-2;else if(r.loop)r.frameIndex=0;else{this.frame=p.at(-1),r.onEnd(),this.stop();return}else if(r.frameIndex<0)if(r.pingpong&&r.loop)o=1,r.frameIndex=1;else if(r.loop)r.frameIndex=p.length-1;else{this.frame=p[0],r.onEnd(),this.stop();return}this.frame=p[r.frameIndex]}},play(c,p={}){if(!n){s.add(()=>this.play(c,p));return}let b=n.anims[c];if(b===void 0)throw new Error(`Anim not found: ${c}`);r&&this.stop(),r=typeof b==\"number\"?{name:c,timer:0,loop:!1,pingpong:!1,speed:0,frameIndex:0,onEnd:()=>{}}:{name:c,timer:0,loop:p.loop??b.loop??!1,pingpong:p.pingpong??b.pingpong??!1,speed:p.speed??b.speed??10,frameIndex:0,onEnd:p.onEnd??(()=>{})},o=typeof b==\"number\"?null:1,this.frame=typeof b==\"number\"?b:b.frames[0],this.trigger(\"animStart\",c)},stop(){if(!r)return;let c=r.name;r=null,this.trigger(\"animEnd\",c)},numFrames(){return n?.frames.length??0},getCurAnim(){return r},curAnim(){return r?.name},getAnim(c){return n?.anims[c]??null},hasAnim(c){return!!this.getAnim(c)},onAnimEnd(c){return this.on(\"animEnd\",c)},onAnimStart(c){return this.on(\"animStart\",c)},renderArea(){return new W(v(0),this.width,this.height)},inspect(){return typeof t==\"string\"?`sprite: \"${t}\"`:null}}}function ya(t,e={}){function n(o){let s=Ue(Object.assign(je(o),{text:o.text+\"\",size:o.textSize,font:o.font,width:e.width&&o.width,align:o.align,letterSpacing:o.letterSpacing,lineSpacing:o.lineSpacing,transform:o.textTransform,styles:o.textStyles,indentAll:e.indentAll}));return e.width||(o.width=s.width/(o.scale?.x||1)),o.height=s.height/(o.scale?.y||1),s}let r={id:\"text\",set text(o){t=o,n(this),this.renderedText=$n(t).text},get text(){return t},textSize:e.size??36,font:e.font,width:e.width??0,height:0,align:e.align,lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing,textTransform:e.transform,textStyles:e.styles,renderedText:t?$n(t).text:\"\",add(){Nt(()=>n(this))},draw(){He(n(this))},renderArea(){return new W(v(0),this.width,this.height)}};return n(r),r}function xa(t,e){return{id:\"rect\",width:t,height:e,draw(){it(Object.assign(je(this),{width:this.width,height:this.height}))},renderArea(){return new W(v(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}function va(t={}){let e=null,n=null,r=null,o=null;return{id:\"agent\",require:[\"pos\",\"tile\"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return e?this.pos.dist(e):0},getNextLocation(){return n&&r?n[r]:null},getPath(){return n?n.slice():null},getTarget(){return e},isNavigationFinished(){return n?r===null:!0},isTargetReachable(){return n!==null},isTargetReached(){return e?this.pos.eq(e):!0},setTarget(s){e=s,n=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),r=n?0:null,n&&r!==null?(o||(o=this.getLevel().onNavigationMapChanged(()=>{e&&n&&r!==null&&(n=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),n?(r=0,this.trigger(\"navigationNext\",this,n[r])):(r=null,this.trigger(\"navigationEnded\",this)))}),this.onDestroy(()=>o?.cancel())),this.trigger(\"navigationStarted\",this),this.trigger(\"navigationNext\",this,n[r])):this.trigger(\"navigationEnded\",this)},update(){if(e&&n&&r!==null){if(this.pos.sdist(n[r])<2)if(r===n.length-1){this.pos=e.clone(),r=null,this.trigger(\"navigationEnded\",this),this.trigger(\"targetReached\",this);return}else r++,this.trigger(\"navigationNext\",this,n[r]);this.moveTo(n[r],this.agentSpeed)}},onNavigationStarted(s){return this.on(\"navigationStarted\",s)},onNavigationNext(s){return this.on(\"navigationNext\",s)},onNavigationEnded(s){return this.on(\"navigationEnded\",s)},onTargetReached(s){return this.on(\"targetReached\",s)},inspect(){return\"agent: \"+JSON.stringify({target:JSON.stringify(e),path:JSON.stringify(n)})}}}function wa(t){let e=t.graph;return{id:\"pathfinder\",require:[\"pos\"],navigateTo(n){return this.graph?.getWaypointPath(this.pos,n,t.navigationOpt)},get graph(){if(e)return e;let n=this.parent;for(;n;){if(n.has(\"pathfinderMap\"))return n.graph;n=n.parent}},set graph(n){e=n}}}function Ca(t={}){let e=t.waypoints,n=t.speed||100,r=t.endBehavior||\"stop\",o=0,s=e!=null;return{id:\"patrol\",require:[\"pos\"],get patrolSpeed(){return n},set patrolSpeed(i){n=i},get waypoints(){return e},set waypoints(i){e=i,o=0,s=!1},get nextLocation(){return e?e[o]:void 0},update(){let i=this.nextLocation;if(!(!e||!i||s)&&(this.moveTo(i,n),this.pos.sdist(i)<9))switch(r){case\"loop\":o=(o+1)%e.length;break;case\"ping-pong\":o=o+1,o==e.length&&(e.reverse(),o=0);break;case\"stop\":o<e.length-1?o+=1:s||(s=!0,this.trigger(\"patrolFinished\",this));break}},onPatrolFinished(i){return this.on(\"patrolFinished\",i)}}}function Ea(t,e={}){let n=typeof t==\"function\"?t:()=>a.game.root.query(t),r=e.checkFrequency||1,o=typeof e.direction==\"number\"?E.fromAngle(e.direction):e.direction,s=0;return{id:\"sentry\",require:[\"pos\"],direction:typeof e.direction==\"number\"?E.fromAngle(e.direction):e.direction,spotted:[],set directionAngle(i){this.direction=i!==void 0?E.fromAngle(i):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:e.fieldOfView||200,isWithinFieldOfView(i,m,u){let c=(typeof m==\"number\"?E.fromAngle(m):m)||o,p=u||e.fieldOfView;if(!c||!p||p>=360)return!0;let b=p/2;return i.pos&&c.angleBetween(i.pos.sub(this.pos))<=b},hasLineOfSight(i){let m=er(this.pos,i.pos.sub(this.pos),e.raycastExclude);return m!=null&&m.object===i},update(){if(s+=ee(),s>r){s-=r;let i=n();if(i.length&&o&&this.fieldOfView&&this.fieldOfView<360){let m=this.fieldOfView/2;i=i.filter(u=>u.pos&&o.angleBetween(u.pos.sub(this.pos))<=m)}i.length&&e.lineOfSight&&(i=i.filter(m=>m.pos&&this.hasLineOfSight(m))),i.length>0&&(this.spotted=i,this.trigger(\"objectSpotted\",i))}},onObjectsSpotted(i){return this.on(\"objectSpotted\",i)}}}function nr(t={}){let e=v(0),n=t.isObstacle??!1,r=t.cost??0,o=t.edges??[],s=()=>{let m={left:1,top:2,right:4,bottom:8};return o.map(u=>m[u]||0).reduce((u,c)=>u|c,0)},i=s();return{id:\"tile\",tilePosOffset:t.offset??v(0),set tilePos(m){let u=this.getLevel();e=m.clone(),this.pos=v(this.tilePos.x*u.tileWidth(),this.tilePos.y*u.tileHeight()).add(this.tilePosOffset)},get tilePos(){return e},set isObstacle(m){n!==m&&(n=m,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(m){r!==m&&(r=m,this.getLevel().invalidateNavigationMap())},get cost(){return r},set edges(m){o=m,i=s(),this.getLevel().invalidateNavigationMap()},get edges(){return o},get edgeMask(){return i},getLevel(){return this.parent},tileMove(m){let u=this.getLevel();u.removeFromSpatialMap(this),this.tilePos=this.tilePos.add(m),u.insertIntoSpatialMap(this),u.trigger(\"spatialMapChanged\")},moveLeft(){this.tileMove(v(-1,0))},moveRight(){this.tileMove(v(1,0))},moveUp(){this.tileMove(v(0,-1))},moveDown(){this.tileMove(v(0,1))}}}var bn=class{name;duration;loops;direction;easing;interpolation;isFinished;timing;easings;relative;constructor(e,n,r){this.name=e,this.duration=n.duration,this.loops=n.loops||0,this.direction=n.direction||\"forward\",this.easing=n.easing||nt.linear,this.interpolation=n.interpolation||\"linear\",this.isFinished=!1,this.timing=n.timing,this.easings=n.easings,this.relative=r}update(e,n){return!0}getLowerKeyIndexAndRelativeTime(e,n,r){let o=n-1,s=e/this.duration;if(this.loops!==0&&s>=this.loops)return[o,0,!0];let i=Math.trunc(s);if(s-=i,(this.direction==\"reverse\"||this.direction==\"ping-pong\"&&i&1)&&(s=1-s),r){let m=0;for(;r[m+1]!==void 0&&r[m+1]<s;)m++;return m>=o?[o,0,!0]:[m,(s-r[m])/(r[m+1]-r[m]),!1]}else{let m=Math.floor((n-1)*s);return[m,(s-m/o)*o,!1]}}setValue(e,n,r){if(this.relative)switch(n){case\"pos\":e.pos=e.base.pos.add(r);break;case\"angle\":e.angle=e.base.angle+r;break;case\"scale\":e.scale=e.base.scale.scale(r);break;case\"opacity\":e.opacity=e.base.opacity*r;break;default:e[n]=r}else e[n]=r}serialize(){let e={duration:this.duration,keys:[]};return this.loops&&(e.loops=this.loops),this.direction!==\"forward\"&&(e.direction=this.direction),this.easing!=nt.linear&&(e.easing=this.easing.name),this.interpolation!==\"linear\"&&(e.interpolation=this.interpolation),this.timing&&(e.timing=this.timing),this.easings&&(e.easings=this.easings.map(n=>this.easing.name)),e}};function Ta(t,e){return e.add(e.sub(t))}var ho=class extends bn{keys;constructor(e,n,r,o){super(e,r,o),this.keys=n}update(e,n){let[r,o,s]=this.getLowerKeyIndexAndRelativeTime(n,this.keys.length,this.timing);if(o==0||this.interpolation===\"none\")this.setValue(e,this.name,this.keys[r]);else{let i=this.easings?this.easings[r]:this.easing;this.setValue(e,this.name,de(this.keys[r],this.keys[r+1],i(o)))}return s}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},go=class extends bn{keys;curves;dcurves;constructor(e,n,r,o,s){if(super(e,r,o),this.keys=n,this.interpolation===\"spline\"){this.curves=[],s&&(this.dcurves=[]);for(let i=0;i<this.keys.length-1;i++){let m=this.keys[i],u=i+1,c=this.keys[u],p=i>0?this.keys[i-1]:Ta(c,m),b=u<this.keys.length-1?this.keys[u+1]:Ta(m,c);this.curves.push(jt(p,m,c,b)),s&&this.dcurves?.push(jt(p,m,c,b,Jo))}}}update(e,n){let[r,o,s]=this.getLowerKeyIndexAndRelativeTime(n,this.keys.length,this.timing);if(o==0||this.interpolation===\"none\")this.setValue(e,this.name,this.keys[r]);else{let i=this.easings?this.easings[r]:this.easing;switch(this.interpolation){case\"linear\":this.setValue(e,this.name,this.keys[r].lerp(this.keys[r+1],i(o)));break;case\"slerp\":this.setValue(e,this.name,this.keys[r].slerp(this.keys[r+1],i(o)));break;case\"spline\":if(this.curves){this.setValue(e,this.name,this.curves[r](i(o))),this.dcurves&&this.setValue(e,\"angle\",this.dcurves[r](i(o)).angle());break}}}return s}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},bo=class extends bn{keys;constructor(e,n,r,o){super(e,r,o),this.keys=n}update(e,n){let[r,o,s]=this.getLowerKeyIndexAndRelativeTime(n,this.keys.length,this.timing);if(o==0||this.interpolation==\"none\")this.setValue(e,this.name,this.keys[r]);else{let i=this.easings?this.easings[r]:this.easing;this.setValue(e,this.name,this.keys[r].lerp(this.keys[r+1],i(o)))}return s}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}};function Oa(t={}){let e=[],n=0,r=!1;return{id:\"animate\",require:t.followMotion?[\"rotate\"]:void 0,base:{pos:v(0,0),angle:0,scale:v(1,1),opacity:1},animation:{paused:!1,seek(o){n=Te(o,0,this.duration),e.forEach(s=>{s.isFinished=!1}),r=!1},get duration(){return e.reduce((o,s)=>Math.max(s.duration,o),0)}},add(){t.relative&&(this.has(\"pos\")&&(this.base.pos=this.pos.clone()),this.has(\"rotate\")&&(this.base.angle=this.angle),this.has(\"scale\")&&(this.base.scale=this.scale),this.has(\"opacity\")&&(this.base.opacity=this.opacity))},update(){if(this.animation.paused)return;let o=!0,s;n+=ee();for(let i of e)s=i.update(this,n),s&&!i.isFinished&&(i.isFinished=!0,this.trigger(\"animateChannelFinished\",i.name)),o&&=s;o&&!r&&(r=!0,this.trigger(\"animateFinished\"))},animate(o,s,i){r=!1,this.unanimate(o),typeof s[0]==\"number\"?e.push(new ho(o,s,i,t.relative||!1)):s[0]instanceof E?e.push(new go(o,s,i,t.relative||!1,o===\"pos\"&&(t.followMotion||!1))):s[0]instanceof j&&e.push(new bo(o,s,i,t.relative||!1))},unanimate(o){let s=e.findIndex(i=>i.name===o);s>=0&&e.splice(s,1)},unanimateAll(){e.splice(0,e.length)},onAnimateFinished(o){return this.on(\"animateFinished\",o)},onAnimateChannelFinished(o){return this.on(\"animateChannelFinished\",o)},serializeAnimationChannels(){return e.reduce((o,s)=>(o[s.name]=s.serialize(),o),{})},serializeAnimationOptions(){let o={};return t.followMotion&&(o.followMotion=!0),t.relative&&(o.relative=!0),o}}}function yo(t,e){let n={name:t.name};return t.has(\"animate\")&&(n.channels=t.serializeAnimationChannels(),Object.assign(n,t.serializeAnimationOptions())),t.children.length>0&&(n.children=t.children.filter(r=>r.has(\"named\")).map(r=>yo(r,r.name))),n}function po(t=2,e=1){let n=0;return{require:[\"scale\"],update(){let r=Math.sin(n*t)*e;r<0&&this.destroy(),this.scale=v(r),n+=ee()}}}function Aa(t,e){if(t==null)throw new Error(\"health() requires the initial amount of hp\");return{id:\"health\",hurt(n=1){this.setHP(t-n),this.trigger(\"hurt\",n)},heal(n=1){let r=t;this.setHP(t+n),this.trigger(\"heal\",t-r)},hp(){return t},maxHP(){return e??null},setMaxHP(n){e=n},setHP(n){t=e?Math.min(e,n):n,t<=0&&this.trigger(\"death\")},onHurt(n){return this.on(\"hurt\",n)},onHeal(n){return this.on(\"heal\",n)},onDeath(n){return this.on(\"death\",n)},inspect(){return`health: ${t}`}}}function Sa(t,e={}){if(t==null)throw new Error(\"lifespan() requires time\");let n=e.fade??0;return{id:\"lifespan\",require:[\"opacity\"],add(){a.game.root.wait(t,()=>{this.opacity=this.opacity??1,n>0?a.game.root.tween(this.opacity,0,n,r=>this.opacity=r,nt.linear).onEnd(()=>{this.destroy()}):this.destroy()})}}}function Va(t){return{id:\"named\",name:t}}function Pa(t,e,n){if(!t)throw new Error(\"state() requires an initial state\");let r={};function o(u){r[u]||(r[u]={enter:new re,end:new re,update:new re,draw:new re})}function s(u,c,p){return o(c),r[c][u].add(p)}function i(u,c,...p){o(c),r[c][u].trigger(...p)}let m=!1;return{id:\"state\",state:t,enterState(u,...c){if(m=!0,e&&!e.includes(u))throw new Error(`State not found: ${u}`);let p=this.state;if(n){if(!n?.[p])return;let b=typeof n[p]==\"string\"?[n[p]]:n[p];if(!b.includes(u))throw new Error(`Cannot transition state from \"${p}\" to \"${u}\". Available transitions: ${b.map(l=>`\"${l}\"`).join(\", \")}`)}i(\"end\",p,...c),this.state=u,i(\"enter\",u,...c),i(\"enter\",`${p} -> ${u}`,...c)},onStateTransition(u,c,p){return s(\"enter\",`${u} -> ${c}`,p)},onStateEnter(u,c){return s(\"enter\",u,c)},onStateUpdate(u,c){return s(\"update\",u,c)},onStateDraw(u,c){return s(\"draw\",u,c)},onStateEnd(u,c){return s(\"end\",u,c)},update(){m||(i(\"enter\",t),m=!0),i(\"update\",this.state)},draw(){i(\"draw\",this.state)},inspect(){return`state: ${this.state}`}}}function lr(t){return{id:\"stay\",stay:!0,scenesToStay:t}}function Ga(t=!0,e){let n,r;return{id:\"textInput\",hasFocus:t,require:[\"text\"],typedText:\"\",add(){let o=()=>{this.text=this.typedText.replace(/([\\[\\\\])/g,\"\\\\$1\")};n=a.k.onCharInput(s=>{this.hasFocus&&(!e||this.typedText.length<e)&&(a.k.isKeyDown(\"shift\")?this.typedText+=s.toUpperCase():this.typedText+=s,o())}),r=a.k.onKeyPressRepeat(\"backspace\",()=>{this.hasFocus&&(this.typedText=this.typedText.slice(0,-1),o())})},destroy(){n.cancel(),r.cancel()}}}function gn(t=1e3){return{id:\"timer\",maxLoopsPerFrame:t,loop(e,n,r=1/0,o=!1){let s=o?0:e,i=new re,m=this.onUpdate(()=>{s+=a.app.state.dt;for(let u=0;s>=e&&u<this.maxLoopsPerFrame;u++)if(r--,n(),s-=e,r<=0){m.cancel(),i.trigger();return}});return{get paused(){return m.paused},set paused(u){m.paused=u},cancel:m.cancel,onEnd(u){i.add(u)},then(u){return i.add(u),this}}},wait(e,n){return this.loop(e,n??(()=>{}),1,!0)},tween(e,n,r,o,s=nt.linear){let i=0,m=[],u=this.onUpdate(()=>{i+=a.app.state.dt;let c=Math.min(i/r,1);o(de(e,n,s(c))),c===1&&(u.cancel(),o(n),m.forEach(p=>p()))});return{get paused(){return u.paused},set paused(c){u.paused=c},onEnd(c){m.push(c)},then(c){return this.onEnd(c),this},cancel(){u.cancel()},finish(){u.cancel(),o(n),m.forEach(c=>c())}}}}}var xo=0;function Ma(){return xo>0}function Ra(t={}){let e={},n=new Set,r=[];return{id:\"area\",collisionIgnore:t.collisionIgnore??[],add(){xo++,this.area.cursor&&r.push(this.onHover(()=>a.app.setCursor(this.area.cursor))),r.push(this.onCollideUpdate((o,s)=>{if(!o.id)throw new Error(\"area() requires the object to have an id\");e[o.id]||this.trigger(\"collide\",o,s),s&&(e[o.id]=s,n.add(o.id))}))},destroy(){xo--;for(let o of r)o.cancel()},fixedUpdate(){for(let o in e)n.has(Number(o))||(this.trigger(\"collideEnd\",e[o].target),delete e[o]);n.clear()},drawInspect(){let o=this.localArea();ge(),X(this.area.offset);let s={outline:{width:4/_n(),color:I(0,0,255)},anchor:this.anchor,fill:!1,fixed:at(this)};o instanceof W?xe({...s,pos:o.pos,width:o.width*this.area.scale.x,height:o.height*this.area.scale.y}):o instanceof be?Pe({...s,pts:o.pts,scale:this.area.scale}):o instanceof we&&Ne({...s,pos:o.center,radius:o.radius}),me()},area:{shape:t.shape??null,scale:t.scale?v(t.scale):v(1),offset:t.offset??v(0),cursor:t.cursor??null},isClicked(){return a.app.isMousePressed()&&this.isHovering()},isHovering(){let o=at(this)?a.k.mousePos():a.k.toWorld(a.k.mousePos());return this.hasPoint(o)},checkCollision(o){if(!o.id)throw new Error(\"checkCollision() requires the object to have an id\");return e[o.id]??null},getCollisions(){return Object.values(e)},isColliding(o){if(!o.id)throw new Error(\"isColliding() requires the object to have an id\");return!!e[o.id]},isOverlapping(o){if(!o.id)throw new Error(\"isOverlapping() requires the object to have an id\");let s=e[o.id];return s&&s.hasOverlap()},onClick(o,s=\"left\"){let i=this.onMousePress(s,()=>{this.isHovering()&&o()});return r.push(i),i},onHover(o){let s=!1;return this.onUpdate(()=>{s?s=this.isHovering():this.isHovering()&&(s=!0,o())})},onHoverUpdate(o){return this.onUpdate(()=>{this.isHovering()&&o()})},onHoverEnd(o){let s=!1;return this.onUpdate(()=>{s?this.isHovering()||(s=!1,o()):s=this.isHovering()})},onCollide(o,s){if(typeof o==\"function\"&&s===void 0)return this.on(\"collide\",o);if(typeof o==\"string\")return this.onCollide((i,m)=>{i.is(o)&&s?.(i,m)});throw new Error(\"onCollide() requires either a function or a tag\")},onCollideUpdate(o,s){if(typeof o==\"function\"&&s===void 0)return this.on(\"collideUpdate\",o);if(typeof o==\"string\")return this.on(\"collideUpdate\",(i,m)=>i.is(o)&&s?.(i,m));throw new Error(\"onCollideUpdate() requires either a function or a tag\")},onCollideEnd(o,s){if(typeof o==\"function\"&&s===void 0)return this.on(\"collideEnd\",o);if(typeof o==\"string\")return this.on(\"collideEnd\",i=>i.is(o)&&s?.(i));throw new Error(\"onCollideEnd() requires either a function or a tag\")},hasPoint(o){return et(this.worldArea(),o)},resolveCollision(o){let s=this.checkCollision(o);s&&!s.resolved&&(this.pos=this.pos.add(s.displacement),s.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let o=this.localArea();if(!(o instanceof be||o instanceof W))throw new Error(\"Only support polygon and rect shapes for now\");let s=this.transform.clone().translate(this.area.offset).scale(v(this.area.scale??1));if(o instanceof W){let i=_e(this.anchor||mt).add(1,1).scale(-.5).scale(o.width,o.height);s.translate(i)}return o.transform(s)},screenArea(){let o=this.worldArea();return at(this)?o:o.transform(a.game.cam.transform)},inspect(){return this.area.scale?.x==this.area.scale?.y?`area: ${this.area.scale?.x?.toFixed(1)}x`:`area: (${this.area.scale?.x?.toFixed(1)}x, ${this.area.scale.y?.toFixed(1)}y)`}}}function Da(t={}){let e=null,n=null,r=!1,o=v(0),s=null,i=null,m;return{id:\"body\",require:[\"pos\"],vel:v(0),drag:t.drag??0,jumpForce:t.jumpForce??ds,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(s=this.pos.clone(),i=this.pos.clone(),m=this.pos.clone(),this.mass===0)throw new Error(\"Can't set body mass to 0\");this.has(\"area\")&&(this.onCollideUpdate((u,c)=>{if(!c||!u.has(\"body\")||c.resolved)return;this.trigger(\"beforePhysicsResolve\",c);let p=c.reverse();if(u.trigger(\"beforePhysicsResolve\",p),!(c.resolved||p.resolved)&&!(this.isStatic&&u.isStatic)){if(!this.isStatic&&!u.isStatic){let b=this.mass+u.mass;this.pos=this.pos.add(c.displacement.scale(u.mass/b)),u.pos=u.pos.add(c.displacement.scale(-this.mass/b)),this.transform=dt(this),u.transform=dt(u)}else{let b=!this.isStatic&&u.isStatic?c:c.reverse();b.source.pos=b.source.pos.add(b.displacement),b.source.transform=dt(b.source)}c.resolved=!0,this.trigger(\"physicsResolve\",c),u.trigger(\"physicsResolve\",c.reverse())}}),this.onPhysicsResolve(u=>{if(a.game.gravity)if(u.isBottom()&&this.isFalling()){this.vel=this.vel.reject(a.game.gravity.unit());let c=e;e=u.target,c!=e&&(n=u.target.pos),r?r=!1:c||(this.trigger(\"ground\",e),u.target.trigger(\"land\",this))}else u.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(a.game.gravity.unit()),this.trigger(\"headbutt\",u.target),u.target.trigger(\"headbutted\",this))}))},update(){e&&this.isColliding(e)&&e.exists()&&e.has(\"body\")&&(n&&!e.pos.eq(n)&&t.stickToPlatform!==!1&&this.moveBy(e.pos.sub(n)),n=e.pos);let u=un();u&&(this.pos.x==m.x&&(this.pos.x=de(s.x,i.x,u/an()),m.x=this.pos.x),this.pos.y==m.y&&(this.pos.y=de(s.y,i.y,u/an()),m.y=this.pos.y))},fixedUpdate(){if(s&&(this.pos.x==m.x&&(this.pos.x=s.x),this.pos.y==m.y&&(this.pos.y=s.y),s=null),a.game.gravity&&!this.isStatic){r&&(e=null,n=null,this.trigger(\"fallOff\"),r=!1),e&&(!this.isColliding(e)||!e.exists()||!e.has(\"body\"))&&(r=!0);let c=this.vel.clone();this.vel=this.vel.add(a.game.gravity.scale(this.gravityScale*ee()));let p=t.maxVelocity??fs;this.vel.slen()>p*p&&(this.vel=this.vel.unit().scale(p)),c.dot(a.game.gravity)<0&&this.vel.dot(a.game.gravity)>=0&&this.trigger(\"fall\")}if(this.vel.x+=o.x*ee(),this.vel.y+=o.y*ee(),this.vel.x*=1-this.drag*ee(),this.vel.y*=1-this.drag*ee(),this.move(this.vel),un()){s=this.pos.clone();let c=this.vel.add(o.scale(ee()));i=this.pos.add(c.scale(ee())),m=this.pos.clone()}o.x=0,o.y=0},onPhysicsResolve(u){return this.on(\"physicsResolve\",u)},onBeforePhysicsResolve(u){return this.on(\"beforePhysicsResolve\",u)},curPlatform(){return e},isGrounded(){return e!==null},isFalling(){return this.vel.dot(ht())>0},isJumping(){return this.vel.dot(ht())<0},applyImpulse(u){this.isStatic||(this.vel=this.vel.add(u))},addForce(u){this.isStatic||(o.x+=u.x/this.mass,o.y+=u.y/this.mass)},jump(u){this.isStatic||(e=null,n=null,this.vel=ht().scale(-u||-this.jumpForce))},onGround(u){return this.on(\"ground\",u)},onFall(u){return this.on(\"fall\",u)},onFallOff(u){return this.on(\"fallOff\",u)},onHeadbutt(u){return this.on(\"headbutt\",u)},onLand(u){return this.on(\"land\",u)},onHeadbutted(u){return this.on(\"headbutted\",u)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}function Ba(t=2){let e=t;return{id:\"doubleJump\",require:[\"body\"],numJumps:t,add(){this.onGround(()=>{e=this.numJumps})},doubleJump(n){e<=0||(e<this.numJumps&&this.trigger(\"doubleJump\"),e--,this.jump(n))},onDoubleJump(n){return this.on(\"doubleJump\",n)},inspect(){return`jumpsLeft: ${e}`}}}function Fa(t){return{id:\"surfaceEffector\",require:[\"area\"],speed:t.speed,speedVariation:t.speedVariation??0,forceScale:t.speedVariation??.9,add(){this.onCollideUpdate(\"body\",(e,n)=>{let r=n?.normal.normal(),o=e.vel.project(r),i=r?.scale(this.speed)?.sub(o);e.addForce(i?.scale(e.mass*this.forceScale))})}}}function La(t){return{id:\"areaEffector\",require:[\"area\"],useGlobalAngle:t.useGlobalAngle||!1,forceAngle:t.forceAngle,forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,linearDrag:t.linearDrag??0,add(){this.onCollideUpdate(\"body\",(e,n)=>{if(!e.has(\"body\"))return;let o=E.fromAngle(this.forceAngle).scale(this.forceMagnitude);e.addForce(o),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}function ja(t){return{id:\"pointEffector\",require:[\"area\",\"pos\"],forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,distanceScale:t.distanceScale??1,forceMode:t.forceMode||\"inverseLinear\",linearDrag:t.linearDrag??0,add(){this.onCollideUpdate(\"body\",(e,n)=>{let r=this.pos.sub(e.pos),o=r.len(),s=o*this.distanceScale/10,i=this.forceMode===\"constant\"?1:this.forceMode===\"inverseLinear\"?1/s:1/s**2,m=r.scale(this.forceMagnitude*i/o);e.addForce(m),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}function Ia(t){return{id:\"constantForce\",require:[\"body\"],force:t.force,update(){this.force&&this.addForce(this.force)}}}function Ka(t){return{id:\"platformEffector\",require:[\"area\",\"body\"],surfaceArc:t.surfaceArc??180,useOneWay:t.useOneWay??!1,add(){this.onBeforePhysicsResolve(e=>{let n=e.target.vel,o=ht().scale(-1).angleBetween(n);Math.abs(o)>this.surfaceArc/2&&e.preventResolution()})}}}function ka(t){return{id:\"buoyancyEffector\",require:[\"area\"],surfaceLevel:t.surfaceLevel,density:t.density??1,linearDrag:t.linearDrag??1,angularDrag:t.angularDrag??.2,flowAngle:t.flowAngle??0,flowMagnitude:t.flowMagnitude??0,flowVariation:t.flowVariation??0,add(){this.onCollideUpdate(\"body\",(e,n)=>{let r=e,o=r.worldArea(),[s,i]=o.cut(v(-100,this.surfaceLevel),v(100,this.surfaceLevel));s&&(this.applyBuoyancy(r,s),this.applyDrag(r,s)),this.flowMagnitude&&r.addForce(E.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(e,n){let r=this.density*n.area(),o=v(0,1).scale(-r);e.addForce(o)},applyDrag(e,n){let r=e.vel,o=this.density*this.linearDrag,s=r.scale(-o);e.addForce(s)}}}function hn(t){if(!t)throw new Error(\"Please define an anchor\");return{id:\"anchor\",anchor:t,inspect(){return typeof this.anchor==\"string\"?\"anchor: \"+this.anchor:\"anchor: \"+this.anchor.toString()}}}function ar(){return{id:\"fixed\",fixed:!0}}function _a(t,e){return{id:\"follow\",require:[\"pos\"],follow:{obj:t,offset:e??v(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function Na(t){let e=a.game.layers?.indexOf(t);return{id:\"layer\",get layerIndex(){return e??null},get layer(){return e?a.game.layers?.[e]??null:null},set layer(n){if(e=a.game.layers?.indexOf(n),e==-1)throw Error(\"Invalid layer name\")},inspect(){return`layer: ${this.layer}`}}}function Ua(t,e){let n=typeof t==\"number\"?E.fromAngle(t):t.unit();return{id:\"move\",require:[\"pos\"],update(){this.move(n.scale(e))}}}function Ha(t={}){let e=!1,n=new W(v(0),ie(),ue()),r=new W(v(0),0,0),o=s=>{s.isOffScreen()?(e||(s.trigger(\"exitView\"),e=!0),t.hide&&(s.hidden=!0),t.pause&&(s.paused=!0),t.destroy&&s.destroy()):(e&&(s.trigger(\"enterView\"),e=!1),t.hide&&(s.hidden=!1),t.pause&&(s.paused=!1))};return{id:\"offscreen\",require:[\"pos\"],offscreenDistance:t.distance??Gr,isOffScreen(){let s=this.screenPos();if(!s)return!1;if(n.width=ie(),n.height=ue(),!this.offscreenDistance&&this.width&&this.height)return r.width=this.width,r.height=this.height,r.pos=this.pos,r.collides(n);let i=this.offscreenDistance?this.offscreenDistance:Gr;return!Bt(n,s)&&n.sdistToPoint(s)>i*i},onExitScreen(s){return this.on(\"exitView\",s)},onEnterScreen(s){return this.on(\"enterView\",s)},add(){t.pause&&t.unpause?rr(()=>o(this)):this.onUpdate(()=>o(this))}}}function Pt(...t){return{id:\"pos\",pos:v(...t),moveBy(...e){this.pos=this.pos.add(v(...e))},move(...e){this.moveBy(v(...e).scale(ee()))},moveTo(...e){if(typeof e[0]==\"number\"&&typeof e[1]==\"number\")return this.moveTo(v(e[0],e[1]),e[2]);let n=e[0],r=e[1];if(r===void 0){this.pos=v(n);return}let o=n.sub(this.pos);if(o.len()<=r*ee()){this.pos=v(n);return}this.move(o.unit().scale(r))},worldPos(e=null){return e?(this.pos=this.pos.add(this.fromWorld(e)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(e){return this.parent?this.parent.transform.multVec2(this.pos.add(e)):this.pos.add(e)},fromWorld(e){return this.parent?this.parent.transform.invert().multVec2(e).sub(this.pos):e.sub(this.pos)},screenPos(e=null){if(e)return this.pos=this.pos.add(this.fromScreen(e)),null;{let n=this.worldPos();return n?at(this)?n:pn(n):null}},toScreen(e){let n=this.toWorld(e);return at(this)?n:pn(n)},fromScreen(e){return at(this)?this.fromWorld(e):this.fromWorld(sr(e))},toOther(e,n){return e.fromWorld(this.toWorld(n))},fromOther(e,n){return e.toOther(this,n)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){Ne({color:I(255,0,0),radius:4/_n()})}}}function qa(t){return{id:\"rotate\",angle:t??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`}}}function Ut(...t){if(t.length===0)return Ut(1);let e=v(...t);return{id:\"scale\",set scale(n){if(!(n instanceof E))throw Error(\"The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.\");e=v(n)},get scale(){return e},scaleTo(...n){e=v(...n)},scaleBy(...n){e=e.scale(v(...n))},inspect(){return e.x==e.y?`scale: ${e.x.toFixed(1)}x`:`scale: (${e.x.toFixed(1)}x, ${e.y.toFixed(1)}y)`}}}function za(t){return{id:\"z\",z:t,inspect(){return`z: ${this.z}`}}}var Wa=\"data:image/png;base64,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\";var Ya=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABdRJREFUeJzt3d3N3TYMgGG16ADdoAhyl7UyV9bqXRB0g2zQXgRGDcOWSIoUaX3vAwQBknMk/4gWLcnHrQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDEb9kb8FH99eeXf6Wf/efn35ynDyj1pEsb6G6NUxOYZ7sdB/QtPdnWRnn29gbKMYDUspPs0SgPb22cHANo/JG9AZF6wWBp3JLgeir36bvff3x9LOvzp2/dbSFA97bk5I4a9VMD7TXOUcP0uJ+d6emu5d6V1QvMs5nj8FZPx37X/b2TFpzShtnafeP0DipJMFnLnN3/w1OQ7tZgP+pA4VVKcHo0TG36KNULKGt5XsHZmi1APS5WM2Vqg0i7vbsG6YcIznN9vRTxXHavgdxtv6Tc3vc1pAHqdaG6ipwKYprpf1sFp6aH0gRTrxxLubPB2avHu+c/l3mICvqnsr//+Cq+qGrK1Xw/wzbBaRkNvSv3yew9cq+cu89L6nu6F/cMzCgzF1ftANlbe+Otp1IkDVxyVfbo6Z481f3507dhvXfbrk3HpdtjKTNqKuio8678c7mzF6ns6arfMyrVNoA75wMfNU2hKSeCx3Fq7dc+SPfDc39H9Vqn2CT//4bsYeT1PecOJyGSJdh6PZOlbElPZz2PHtlD1cUeS4LT4z5IOihwfNaD5ERm9qxH/dZ7Vmt9M999CtCZbdLUP/p3r2zFQ0paG8lr4Eb6+ZWBcSeq/qhyK6bXUfXOSgtO7/tOb9eT1NveqKttpYbiyXu/euV51JV16/T6e86zyF5TUp731V5Sp+Z7M71h9QvFNWWuvr0Sy4LzLfNvrel6zRX1e+hN2VzrnNlfaYD0xhCs++851lDh3vNV95xe6YvHgb8bwbNcuc+f09wbaUj2dzYgjz93//5kh94t0quCM8OKK6glKKuM0EYHfhUZWd8WwenZa0rLsp6s2YY66o0k9WUvS4NManBaGuo1eDIHgUZ1ePdkntsfFaCz5VZJdStsxyt7ziMNXHEAK5yk1mqmhrMPf1fcp57Vqe3SqZTMEduZhqAZyaywFne0DVHngHTZ11bznE88l/1lBZ9meP8851plWkBCO7drmQvWnL/sY/fKtFaqN3iy6iofsQxNktJnTMgfPXJUz3w3VaP5vOQ7Iyszvy2DczSi+aYFET2jINUEqFcAS4+rV480WlwRWXe07dLa0YGvfl9kmbTvPZJ1TXGvn4t4yuRp+2aMgk27wkm63DIztU3vOVfueC8wK4zKWtK0M+nvJXmOdlt65MgFFCva06qsKz044SvjIiN5TjLaaHxhtNyyouXBGZ1WSn66Ivt+M7pRZAWoZsDq+t2emeM1am/WtHxFG9runrO1/n1CxLK7CilxJM/H4bwuTJJBvWtgvm0gcNu01uvpd8la1soLE7xkpYDea4Ot6W3GOSzRc3o/qHw2M9qmXWA+uw+jbd0hyO9Yz0+vJ9QGcO/8ZV2YUqYVPN8dImXp3aJ/w1XTGGYfKZN+P7IXiXqO1uINLzFOm/Pz+BV4C03PNEqpZl//ELXP1ro8nhLyKLPHMyAiXyvh4cMFZ2uyAJXc62gzgJl1nhrSLMEzcLx+5qQnIhgqv6qhTHC2Zmus1tUuowCVDkRU6j0jgiJqhLPSSq2q7wMtMSBkdbcQWjNCq2nMlRrTnajAPP/t+c5Sj3K8VNueQ+pGzaa2MyOb2sZseW2dpL6ZnjMzfeQFt/Fe3XP2WIfGvRY6a569jCJ9TaIlcCS9KQE5p1TP2VrMbwLNDlZEvpE5AkGxh9f2nLO/QOetytIwAnMf6SfS2ns+jaZ6B4i2sWvSvF0HWOAj/aRGNFAaPXbw2rS2Rzr0T/ChshKNM3qd4135BCaqK9VAKy+lAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4DBC0k0jFtF9wAAAAASUVORK5CYII=\";var sc=Ao.version,a={k:null,globalOpt:null,gfx:null,game:null,app:null,assets:null,fontCacheCanvas:null,fontCacheC2d:null,debug:null,audio:null,pixelDensity:null,canvas:null,gscale:null,kaSprite:null,boomSprite:null},ic=(t={tagsAsComponents:!0})=>{a.k&&(console.warn(\"KAPLAY already initialized, you are calling kaplay() multiple times, it may lead bugs!\"),a.k.quit()),a.globalOpt=t;let e=t.root??document.body;e===document.body&&(document.body.style.width=\"100%\",document.body.style.height=\"100%\",document.body.style.margin=\"0px\",document.documentElement.style.width=\"100%\",document.documentElement.style.height=\"100%\");let n=t.canvas??e.appendChild(document.createElement(\"canvas\"));a.canvas=n;let r=t.scale??1;a.gscale=r;let o=t.width&&t.height&&!t.stretch&&!t.letterbox;o?(n.width=t.width*r,n.height=t.height*r):(n.width=n.parentElement.offsetWidth,n.height=n.parentElement.offsetHeight);let s=[\"outline: none\",\"cursor: default\"];if(o){let F=n.width,N=n.height;s.push(`width: ${F}px`),s.push(`height: ${N}px`)}else s.push(\"width: 100%\"),s.push(\"height: 100%\");t.crisp&&(s.push(\"image-rendering: pixelated\"),s.push(\"image-rendering: crisp-edges\")),n.style.cssText=s.join(\";\");let i=t.pixelDensity||1;a.pixelDensity=i,n.width*=i,n.height*=i,n.tabIndex=0;let m=document.createElement(\"canvas\");m.width=256,m.height=256,a.fontCacheCanvas=m;let u=m.getContext(\"2d\",{willReadFrequently:!0});a.fontCacheC2d=u;let c=Ms({canvas:n,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS,buttons:t.buttons});a.app=c;let p=[],b=c.canvas.getContext(\"webgl\",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!b)throw new Error(\"WebGL not supported\");let l=b,h=ui(l,{texFilter:t.texFilter}),d=xi(t,h);a.gfx=d;let C=sa();a.audio=C;let g=zs(h,t.spriteAtlasPadding??0);a.assets=g;let y=ea();a.game=y,y.root.use(gn());function O(F,N){let z=new st(h,F,N);return{clear:()=>z.clear(),free:()=>z.free(),toDataURL:()=>z.toDataURL(),toImageData:()=>z.toImageData(),width:z.width,height:z.height,draw:oe=>{Ce(),z.bind(),oe(),Ce(),z.unbind()},get fb(){return z}}}function A(){l.clear(l.COLOR_BUFFER_BIT),d.frameBuffer.bind(),l.clear(l.COLOR_BUFFER_BIT),d.bgColor||qe(()=>{it({width:ie(),height:ue(),quad:new q(0,0,ie()/64,ue()/64),tex:d.bgTex,fixed:!0})}),d.renderer.numDraws=0,d.fixed=!1,d.transformStack.length=0,d.transform=new fe}function R(F,N){d.postShader=F,d.postShaderUniform=N??null}function V(){Ce(),d.lastDrawCalls=d.renderer.numDraws,d.frameBuffer.unbind(),l.viewport(0,0,l.drawingBufferWidth,l.drawingBufferHeight);let F=d.width,N=d.height;d.width=l.drawingBufferWidth/i,d.height=l.drawingBufferHeight/i,Vt({flipY:!0,tex:d.frameBuffer.tex,pos:new E(d.viewport.x,d.viewport.y),width:d.viewport.width,height:d.viewport.height,shader:d.postShader,uniform:typeof d.postShaderUniform==\"function\"?d.postShaderUniform():d.postShaderUniform,fixed:!0}),Ce(),d.width=F,d.height=N}let x=!1,w={inspect:!1,set timeScale(F){a.app.state.timeScale=F},get timeScale(){return a.app.state.timeScale},showLog:!0,fps:()=>c.fps(),numFrames:()=>c.numFrames(),stepFrame:Gt,drawCalls:()=>d.lastDrawCalls,clearLog:()=>y.logs=[],log:(...F)=>{let N=t.logMax??8,z=F.length>1?F.concat(\" \").join(\" \"):F[0];y.logs.unshift({msg:z,time:c.time()}),y.logs.length>N&&(y.logs=y.logs.slice(0,N))},error:F=>w.log(new Error(F.toString?F.toString():F)),curRecording:null,numObjects:()=>_(\"*\",{recursive:!0}).length,get paused(){return x},set paused(F){x=F,F?C.ctx.suspend():C.ctx.resume()}};a.debug=w;function S(F,N){try{return JSON.parse(window.localStorage[F])}catch{return N?(G(F,N),N):null}}function G(F,N){window.localStorage[F]=JSON.stringify(N)}function M(F,...N){let z=F($e),oe;typeof z==\"function\"?oe=z(...N)($e):oe=z;for(let ye in oe)$e[ye]=oe[ye],t.global!==!1&&(window[ye]=oe[ye]);return $e}function D(F){let N=c.canvas.captureStream(F),z=C.ctx.createMediaStreamDestination();C.masterNode.connect(z);let oe=new MediaRecorder(N),ye=[];return oe.ondataavailable=Q=>{Q.data.size>0&&ye.push(Q.data)},oe.onerror=()=>{C.masterNode.disconnect(z),N.getTracks().forEach(Q=>Q.stop())},oe.start(),{resume(){oe.resume()},pause(){oe.pause()},stop(){return oe.stop(),C.masterNode.disconnect(z),N.getTracks().forEach(Q=>Q.stop()),new Promise(Q=>{oe.onstop=()=>{Q(new Blob(ye,{type:\"video/mp4\"}))}})},download(Q=\"kaboom.mp4\"){this.stop().then(ve=>Rr(Q,ve))}}}function L(){return document.activeElement===c.canvas}let U=y.root.add.bind(y.root),H=y.root.readd.bind(y.root),Y=y.root.removeAll.bind(y.root),_=y.root.get.bind(y.root),K=y.root.wait.bind(y.root),J=y.root.loop.bind(y.root),$=y.root.query.bind(y.root),Z=y.root.tween.bind(y.root),Ee=Ot(null,Ya),k=Ot(null,Wa);a.kaSprite=Ee,a.boomSprite=k;function gt(){y.root.fixedUpdate()}function Gt(){y.root.update()}class Ht{source;target;normal;distance;resolved=!1;constructor(N,z,oe,ye,Q=!1){this.source=N,this.target=z,this.normal=oe,this.distance=ye,this.resolved=Q}get displacement(){return this.normal.scale(this.distance)}reverse(){return new Ht(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(y.gravity||v(0,1))>0}isRight(){return this.displacement.cross(y.gravity||v(0,1))<0}isTop(){return this.displacement.dot(y.gravity||v(0,1))>0}isBottom(){return this.displacement.dot(y.gravity||v(0,1))<0}preventResolution(){this.resolved=!0}}function yn(){if(!Ma())return;let F={},N=t.hashGridSize||64,z=new fe,oe=[];function ye(Q){if(oe.push(z.clone()),Q.pos&&z.translate(Q.pos),Q.scale&&z.scale(Q.scale),Q.angle&&z.rotate(Q.angle),Q.transform=z.clone(),Q.c(\"area\")&&!Q.paused){let ve=Q,ut=ve.worldArea().bbox(),dr=Math.floor(ut.pos.x/N),fr=Math.floor(ut.pos.y/N),hr=Math.ceil((ut.pos.x+ut.width)/N),gr=Math.ceil((ut.pos.y+ut.height)/N),wn=new Set;for(let Xe=dr;Xe<=hr;Xe++)for(let ct=fr;ct<=gr;ct++)if(!F[Xe])F[Xe]={},F[Xe][ct]=[ve];else if(!F[Xe][ct])F[Xe][ct]=[ve];else{let zt=F[Xe][ct];e:for(let Ie of zt){if(Ie.paused||!Ie.exists()||wn.has(Ie.id))continue;for(let Je of ve.collisionIgnore)if(Ie.is(Je))continue e;for(let Je of Ie.collisionIgnore)if(ve.is(Je))continue e;let Wt=ns(ve.worldArea(),Ie.worldArea());if(Wt){let Je=new Ht(ve,Ie,Wt.normal,Wt.distance);ve.trigger(\"collideUpdate\",Ie,Je);let Cn=Je.reverse();Cn.resolved=Je.resolved,Ie.trigger(\"collideUpdate\",ve,Cn)}wn.add(Ie.id)}zt.push(ve)}}Q.children.forEach(ye),z=oe.pop()}ye(y.root)}function xn(F){console.error(F),C.ctx.suspend();let N=F.message??String(F)??\"Unknown error, check console for more info\";c.run(()=>{},()=>{A(),qe(()=>{let ye=ie(),Q=ue(),ve={size:36,width:ye-32*2,letterSpacing:4,lineSpacing:4,font:yt,fixed:!0};xe({width:ye,height:Q,color:I(0,0,255),fixed:!0});let qt=Ue({...ve,text:\"Error\",pos:v(32),color:I(255,128,0),fixed:!0});He(qt),Zr({...ve,text:N,pos:v(32,32+qt.height+16),fixed:!0}),me(),y.events.trigger(\"error\",F)}),V()})}function mr(F){p.push(F)}function pr(){y.events.onOnce(\"frameEnd\",()=>{c.quit(),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT|l.STENCIL_BUFFER_BIT);let F=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS);for(let N=0;N<F;N++)l.activeTexture(l.TEXTURE0+N),l.bindTexture(l.TEXTURE_2D,null),l.bindTexture(l.TEXTURE_CUBE_MAP,null);l.bindBuffer(l.ARRAY_BUFFER,null),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),h.destroy(),p.forEach(N=>N())})}let Mt=!0;c.run(()=>{try{g.loaded&&(w.paused||gt(),yn())}catch(F){xn(F)}},(F,N)=>{try{F(),g.loaded||Be()===1&&!Mt&&(g.loaded=!0,Un().forEach(z=>y.events.trigger(\"loadError\",...z)),y.events.trigger(\"load\")),!g.loaded&&t.loadingScreen!==!1||Mt?(A(),hi(),V()):(w.paused||Gt(),yn(),A(),fi(),t.debug!==!1&&di(),V()),Mt&&(Mt=!1),y.events.trigger(\"frameEnd\"),N()}catch(z){xn(z)}}),jn(),cr();let $e={_k:a,VERSION:sc,loadRoot:Us,loadProgress:Be,loadSprite:Ot,loadSpriteAtlas:$r,loadSound:si,loadMusic:ii,loadBitmapFont:Zs,loadFont:Qs,loadShader:ni,loadShaderURL:ri,loadAseprite:Xs,loadPedit:ei,loadBean:$s,loadJSON:Hs,load:cn,getSound:Yr,getFont:qr,getBitmapFont:Hn,getSprite:Nr,getShader:Wr,getAsset:qs,Asset:ce,SpriteData:Fe,SoundData:ot,width:ie,height:ue,center:Ct,dt:ee,fixedDt:an,restDt:un,time:c.time,screenshot:c.screenshot,record:D,isFocused:L,setCursor:c.setCursor,getCursor:c.getCursor,setCursorLocked:c.setCursorLocked,isCursorLocked:c.isCursorLocked,setFullscreen:c.setFullscreen,isFullscreen:c.isFullscreen,isTouchscreen:c.isTouchscreen,onLoad:Nt,onLoadError:zi,onLoading:Ui,onResize:Hi,onGamepadConnect:c.onGamepadConnect,onGamepadDisconnect:c.onGamepadDisconnect,onError:qi,onCleanup:mr,flash:co,setCamPos:ro,getCamPos:oo,setCamRot:ao,getCamRot:uo,setCamScale:so,getCamScale:io,getCamTransform:Wi,camPos:Xi,camScale:Qi,camFlash:Zi,camRot:Ji,camTransform:Yi,shake:$i,toScreen:pn,toWorld:sr,setGravity:ta,getGravity:na,setGravityDirection:ra,getGravityDirection:ht,setBackground:Is,getBackground:Ks,getGamepads:c.getGamepads,getTreeRoot:da,add:U,make:dn,destroy:ir,destroyAll:Y,get:_,query:$,readd:H,pos:Pt,scale:Ut,rotate:qa,color:Jn,opacity:Zn,anchor:hn,area:Ra,sprite:fn,text:ya,polygon:Ai,rect:tr,circle:vi,uvquad:xa,outline:Ti,particles:Oi,body:Da,platformEffector:Ka,surfaceEffector:Fa,areaEffector:La,pointEffector:ja,buoyancyEffector:ka,constantForce:Ia,doubleJump:Ba,shader:Si,textInput:Ga,timer:gn,fixed:ar,stay:lr,health:Aa,lifespan:Sa,named:Va,state:Pa,z:za,layer:Na,move:Ua,offscreen:Ha,follow:_a,fadeIn:Ci,mask:Ei,drawon:wi,raycast:er,tile:nr,animate:Oa,serializeAnimation:yo,agent:va,sentry:Ea,patrol:Ca,pathfinder:wa,trigger:Pi,on:Ge,onFixedUpdate:Gi,onUpdate:rr,onDraw:Mi,onAdd:to,onDestroy:Ri,onTag:no,onUntag:Fi,onUse:Di,onUnuse:Bi,onClick:Ki,onCollide:Li,onCollideUpdate:ji,onCollideEnd:Ii,onHover:ki,onHoverUpdate:_i,onHoverEnd:Ni,onKeyDown:c.onKeyDown,onKeyPress:c.onKeyPress,onKeyPressRepeat:c.onKeyPressRepeat,onKeyRelease:c.onKeyRelease,onMouseDown:c.onMouseDown,onMousePress:c.onMousePress,onMouseRelease:c.onMouseRelease,onMouseMove:c.onMouseMove,onCharInput:c.onCharInput,onTouchStart:c.onTouchStart,onTouchMove:c.onTouchMove,onTouchEnd:c.onTouchEnd,onScroll:c.onScroll,onHide:c.onHide,onShow:c.onShow,onGamepadButtonDown:c.onGamepadButtonDown,onGamepadButtonPress:c.onGamepadButtonPress,onGamepadButtonRelease:c.onGamepadButtonRelease,onGamepadStick:c.onGamepadStick,onButtonPress:c.onButtonPress,onButtonDown:c.onButtonDown,onButtonRelease:c.onButtonRelease,mousePos:c.mousePos,mouseDeltaPos:c.mouseDeltaPos,isKeyDown:c.isKeyDown,isKeyPressed:c.isKeyPressed,isKeyPressedRepeat:c.isKeyPressedRepeat,isKeyReleased:c.isKeyReleased,isMouseDown:c.isMouseDown,isMousePressed:c.isMousePressed,isMouseReleased:c.isMouseReleased,isMouseMoved:c.isMouseMoved,isGamepadButtonPressed:c.isGamepadButtonPressed,isGamepadButtonDown:c.isGamepadButtonDown,isGamepadButtonReleased:c.isGamepadButtonReleased,getGamepadStick:c.getGamepadStick,isButtonPressed:c.isButtonPressed,isButtonDown:c.isButtonDown,isButtonReleased:c.isButtonReleased,setButton:c.setButton,getButton:c.getButton,pressButton:c.pressButton,releaseButton:c.releaseButton,getLastInputDeviceType:c.getLastInputDeviceType,charInputted:c.charInputted,loop:J,wait:K,play:aa,setVolume:lo,getVolume:mo,volume:ua,burp:ur,audioCtx:C.ctx,Line:Oe,Rect:W,Circle:we,Ellipse:Ke,Point:On,Polygon:be,Vec2:E,Color:j,Mat4:fe,Quad:q,RNG:Xt,rand:he,randi:Cr,randSeed:Go,vec2:v,rgb:I,hsl2rgb:So,quad:le,choose:Do,chooseMultiple:Ro,shuffle:Er,chance:Mo,lerp:de,tween:Z,easings:nt,map:Se,mapc:Po,wave:An,deg2rad:ae,rad2deg:lt,clamp:Te,evaluateQuadratic:No,evaluateQuadraticFirstDerivative:Uo,evaluateQuadraticSecondDerivative:Ho,evaluateBezier:Jt,evaluateBezierFirstDerivative:qo,evaluateBezierSecondDerivative:zo,evaluateCatmullRom:Wo,evaluateCatmullRomFirstDerivative:Yo,curveLengthApproximation:Vr,normalizedCurve:$o,hermite:Lt,cardinal:Pr,catmullRom:jt,bezier:Xo,kochanekBartels:Qo,easingSteps:ts,easingLinear:Zo,easingCubicBezier:es,testLineLine:Sn,testRectRect:Tr,testRectLine:Vn,testRectPoint:Bt,testCirclePolygon:Qt,testLinePoint:Pn,testLineCircle:Ft,isConvex:os,triangulate:Mn,NavMesh:kn,drawSprite:bi,drawText:Zr,formatText:Ue,drawRect:xe,drawLine:_t,drawLines:kt,drawTriangle:Xn,drawCircle:Ne,drawEllipse:zn,drawUVQuad:it,drawPolygon:Pe,drawCurve:Wn,drawBezier:ai,drawFormattedText:He,drawMasked:gi,drawSubtracted:yi,pushTransform:ge,popTransform:me,pushTranslate:X,pushScale:rt,pushRotate:Ye,pushMatrix:ks,usePostEffect:R,makeCanvas:O,debug:w,scene:fa,getSceneName:ba,go:ha,onSceneLeave:ga,layers:pa,getLayers:la,setLayers:fo,getDefaultLayer:ma,addLevel:Vi,getData:S,setData:G,download:Bn,downloadJSON:xs,downloadText:Mr,downloadBlob:Rr,plug:M,ASCII_CHARS:Rn,canvas:c.canvas,addKaboom:ca,LEFT:E.LEFT,RIGHT:E.RIGHT,UP:E.UP,DOWN:E.DOWN,RED:j.RED,GREEN:j.GREEN,BLUE:j.BLUE,YELLOW:j.YELLOW,MAGENTA:j.MAGENTA,CYAN:j.CYAN,WHITE:j.WHITE,BLACK:j.BLACK,quit:pr,KEvent:re,KEventHandler:ze,KEventController:ke,cancel:()=>Dn};a.k=$e;let vn=t.plugins;if(vn&&vn.forEach(M),t.global!==!1)for(let F in $e)window[F]=$e[F];return t.focus!==!1&&c.canvas.focus(),$e};var hw=ic;export{a as _k,hw as default,ic as kaplay};\n//# sourceMappingURL=kaplay.mjs.map\n","/**\n * Player Name Generator\n * Generates random contestant names in the format [Adjective][Noun]\n * Theme: Game show contestants competing in combat arenas\n */\n\nconst ADJECTIVES = [\n    // Original - Power & Speed (all 8 chars or less)\n    'Swift', 'Mighty', 'Bold', 'Silent', 'Fierce',\n    'Brave', 'Quick', 'Sharp', 'Dark', 'Bright',\n    'Wild', 'Cool', 'Hot', 'Frozen', 'Burning',\n    'Iron', 'Steel', 'Golden', 'Silver', 'Crimson',\n    'Azure', 'Jade', 'Ruby', 'Onyx', 'Electric',\n    'Toxic', 'Mystic', 'Ancient', 'Cyber', 'Neon',\n    'Phantom', 'Shadow', 'Storm', 'Thunder', 'Frost',\n    'Blaze', 'Venom', 'Razor', 'Nitro', 'Turbo',\n    'Alpha', 'Omega', 'Prime', 'Elite', 'Epic',\n    'Royal', 'Noble', 'Rogue', 'Savage',\n\n    // Game Show / Competition (8 chars or less)\n    'Reigning', 'Rising', 'Rookie', 'Veteran', 'Seasoned',\n    'Underdog', 'Favored', 'Viral', 'Trending', 'Famous',\n    'Infamous', 'Ultimate', 'Supreme', 'Grand', 'Major',\n    'Premier', 'Star', 'Main', 'Top', 'Peak', 'Apex',\n\n    // Fighting / Combat (8 chars or less)\n    'Brutal', 'Ruthless', 'Vicious', 'Crushing', 'Raging',\n    'Furious', 'Frenzied', 'Berserk', 'Mad', 'Crazy',\n    'Lethal', 'Deadly', 'Fatal', 'Killer', 'Murder',\n    'Immortal', 'Eternal', 'Heavy', 'Hard', 'Tough',\n    'Gritty', 'Scrappy', 'Mean', 'Nasty', 'Dirty',\n    'Raw', 'Primal',\n\n    // Dramatic / Showmanship (8 chars or less)\n    'Amazing', 'Awesome', 'Dazzling', 'Stunning', 'Shocking',\n    'Dynamic', 'Radical', 'Extreme', 'Intense', 'Hyper',\n    'Ultra', 'Mega', 'Super', 'Power', 'Atomic',\n    'Nuclear', 'Chaos', 'Havoc', 'Mayhem', 'Rampage',\n    'Carnage',\n\n    // Attitude / Personality (8 chars or less)\n    'Cocky', 'Sneaky', 'Tricky', 'Sly', 'Cunning',\n    'Wicked', 'Evil', 'Sinister', 'Twisted', 'Crooked',\n    'Lucky', 'Unlucky', 'Cursed', 'Blessed', 'Chosen',\n    'Lone', 'Solo', 'Outlaw', 'Rebel', 'Bandit'\n];\n\nconst NOUNS = [\n    // Original - Animals & Warriors (8 chars or less)\n    'Wolf', 'Eagle', 'Tiger', 'Dragon', 'Phoenix',\n    'Hawk', 'Lion', 'Bear', 'Falcon', 'Raven',\n    'Viper', 'Cobra', 'Panther', 'Shark', 'Raptor',\n    'Hunter', 'Warrior', 'Knight', 'Ninja', 'Samurai',\n    'Ronin', 'Striker', 'Sniper', 'Ranger', 'Scout',\n    'Titan', 'Champion', 'Hero', 'Legend', 'Master',\n    'Blade', 'Arrow', 'Bullet', 'Rocket', 'Comet',\n    'Star', 'Moon', 'Sun', 'Bolt', 'Flash',\n    'Storm', 'Flame', 'Wave', 'Wind', 'Quake',\n    'Slayer', 'Reaper', 'Wraith', 'Ghost', 'Specter',\n\n    // Game Show / Competition (8 chars or less)\n    'Finalist', 'Victor', 'Winner', 'Champ', 'Hopeful',\n    'Prospect', 'Wildcard', 'Underdog', 'Favorite', 'Prodigy',\n    'Rookie', 'Veteran', 'Pro', 'Amateur', 'Phenom',\n    'Showman', 'Icon',\n\n    // Fighting / Brawling (8 chars or less)\n    'Brawler', 'Bruiser', 'Slugger', 'Puncher', 'Boxer',\n    'Fighter', 'Scrapper', 'Battler', 'Duelist', 'Crusher',\n    'Smasher', 'Basher', 'Masher', 'Thrasher', 'Pummeler',\n    'Pounder', 'Hammer', 'Mauler', 'Mangler', 'Knockout',\n    'Haymaker', 'Uppercut', 'Jab', 'Hook', 'Spartan',\n    'Viking',\n\n    // Destruction / Chaos (8 chars or less)\n    'Wrecking', 'Rampage', 'Havoc', 'Mayhem', 'Chaos',\n    'Carnage', 'Fury', 'Menace', 'Terror', 'Horror',\n    'Dread',\n\n    // Weaponry / Tools (8 chars or less)\n    'Fist', 'Knuckle', 'Claw', 'Talon', 'Spike',\n    'Axe', 'Hammer', 'Mace', 'Flail', 'Club',\n    'Cannon', 'Mortar', 'Missile', 'Bomb', 'Grenade',\n    'Shiv', 'Machete', 'Cleaver', 'Hatchet',\n\n    // Animals - More Aggressive (8 chars or less)\n    'Gorilla', 'Rhino', 'Bull', 'Boar', 'Pitbull',\n    'Doberman', 'Mastiff', 'Bulldog', 'Scorpion', 'Mantis',\n    'Hornet', 'Wasp', 'Spider', 'Croc', 'Gator',\n    'Piranha', 'Orca', 'Hyena', 'Jackal', 'Badger',\n    'Warthog', 'Mongoose',\n\n    // Personas / Archetypes (8 chars or less)\n    'Outlaw', 'Bandit', 'Thug', 'Goon', 'Hooligan',\n    'Punk', 'Rebel', 'Maverick', 'Renegade', 'Assassin',\n    'Bounty', 'Hitman', 'Enforcer', 'Boss', 'Kingpin',\n    'Warlord', 'Overlord', 'Tyrant'\n];\n\n/**\n * Generate a random player name\n * @returns {string} Random name in format \"AdjectiveNoun\"\n */\nexport function generateRandomName() {\n    const adjective = ADJECTIVES[Math.floor(Math.random() * ADJECTIVES.length)];\n    const noun = NOUNS[Math.floor(Math.random() * NOUNS.length)];\n    return `${adjective}${noun}`;\n}\n\n/**\n * Generate a unique 6-digit invite code\n * @returns {string} 6-digit code\n */\nexport function generateInviteCode() {\n    // Generate 6 random digits\n    return Math.floor(100000 + Math.random() * 900000).toString();\n}\n\n/**\n * Validate an invite code\n * @param {string} code - Code to validate\n * @returns {boolean} True if valid format\n */\nexport function isValidInviteCode(code) {\n    return /^\\d{6}$/.test(code);\n}\n","// Achievement definitions - expanded achievement system with difficulty tiers and shop unlocks\n\nexport const ACHIEVEMENTS = {\n    // =============================================================================\n    // PROGRESSION ACHIEVEMENTS (normal difficulty)\n    // =============================================================================\n    floor2: {\n        id: 'floor2',\n        name: 'Floor 2 Reached',\n        description: 'Reach Floor 2',\n        category: 'progression',\n        icon: '2',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'bestFloor', value: 2 },\n        hint: 'Progress further into the facility'\n    },\n    floor3: {\n        id: 'floor3',\n        name: 'Floor 3 Reached',\n        description: 'Reach Floor 3',\n        category: 'progression',\n        icon: '3',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'bestFloor', value: 3 },\n        hint: 'Keep pushing deeper'\n    },\n    floor5: {\n        id: 'floor5',\n        name: 'Floor 5 Reached',\n        description: 'Reach Floor 5',\n        category: 'progression',\n        icon: '5',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'bestFloor', value: 5 },\n        hint: 'The halfway point awaits',\n        unlocks: ['trailIce']\n    },\n    floor10: {\n        id: 'floor10',\n        name: 'Double Digits',\n        description: 'Reach Floor 10',\n        category: 'progression',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'bestFloor', value: 10 },\n        unlocks: ['plasmaRifle']\n    },\n    firstSynergy: {\n        id: 'firstSynergy',\n        name: 'Combo Starter',\n        description: 'Activate your first synergy',\n        category: 'progression',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        hint: 'Collect upgrades that work together',\n        unlocks: ['trailShadow']\n    },\n    allCharacters: {\n        id: 'allCharacters',\n        name: 'Full Roster',\n        description: 'Unlock all characters',\n        category: 'progression',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        hint: 'Progress through floors to unlock characters'\n    },\n    maxUpgrade: {\n        id: 'maxUpgrade',\n        name: 'Maxed Out',\n        description: 'Max out a permanent upgrade',\n        category: 'progression',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        hint: 'Purchase the same upgrade multiple times'\n    },\n    firstDoor: {\n        id: 'firstDoor',\n        name: 'Door Explorer',\n        description: 'Enter a special door',\n        category: 'progression',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        hint: 'Find and enter a special door in a room'\n    },\n\n    // =============================================================================\n    // COMBAT ACHIEVEMENTS (normal difficulty)\n    // =============================================================================\n    firstKill: {\n        id: 'firstKill',\n        name: 'First Blood',\n        description: 'Kill your first enemy',\n        category: 'combat',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalEnemiesKilled', value: 1 },\n        hint: 'Defeat any enemy'\n    },\n    kill100: {\n        id: 'kill100',\n        name: 'Enemy Slayer',\n        description: 'Kill 100 enemies total',\n        category: 'combat',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalEnemiesKilled', value: 100 },\n        hint: 'Keep fighting!',\n        unlocks: ['trailFire']\n    },\n    kill500: {\n        id: 'kill500',\n        name: 'Massacre',\n        description: 'Kill 500 enemies total',\n        category: 'combat',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalEnemiesKilled', value: 500 },\n        hint: 'The carnage continues',\n        unlocks: ['trailPoison']\n    },\n    kill1000: {\n        id: 'kill1000',\n        name: 'Rampage',\n        description: 'Kill 1000 enemies total',\n        category: 'combat',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalEnemiesKilled', value: 1000 },\n        hint: 'A true warrior emerges'\n    },\n    killStreak10: {\n        id: 'killStreak10',\n        name: 'On Fire',\n        description: 'Kill 10 enemies in 5 seconds',\n        category: 'combat',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Defeat enemies rapidly',\n        unlocks: ['deathVaporize']\n    },\n    multikill: {\n        id: 'multikill',\n        name: 'Multi-Kill',\n        description: 'Kill 5 enemies with one attack',\n        category: 'combat',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Use piercing or explosive attacks',\n        unlocks: ['deathPixelate']\n    },\n\n    // =============================================================================\n    // BOSS ACHIEVEMENTS\n    // =============================================================================\n    firstBoss: {\n        id: 'firstBoss',\n        name: 'Boss Hunter',\n        description: 'Defeat your first boss',\n        category: 'boss',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalBossesKilled', value: 1 },\n        hint: 'Clear Floor 1 to face a boss',\n        unlocks: ['deathExplosion']\n    },\n    boss5: {\n        id: 'boss5',\n        name: 'Boss Slayer',\n        description: 'Defeat 5 bosses total',\n        category: 'boss',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalBossesKilled', value: 5 },\n        hint: 'Keep defeating floor bosses',\n        unlocks: ['deathDisintegrate']\n    },\n    boss10: {\n        id: 'boss10',\n        name: 'Boss Veteran',\n        description: 'Defeat 10 bosses total',\n        category: 'boss',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalBossesKilled', value: 10 },\n        hint: 'Experience makes perfect'\n    },\n    boss25: {\n        id: 'boss25',\n        name: 'Boss Crusher',\n        description: 'Defeat 25 bosses total',\n        category: 'boss',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'totalBossesKilled', value: 25 },\n        unlocks: ['railgun'],\n        hint: 'Become a boss-hunting expert'\n    },\n    boss50: {\n        id: 'boss50',\n        name: 'Boss Destroyer',\n        description: 'Defeat 50 bosses total',\n        category: 'boss',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'totalBossesKilled', value: 50 },\n        hint: 'The ultimate boss hunter'\n    },\n    minibossSlayer: {\n        id: 'minibossSlayer',\n        name: 'Miniboss Hunter',\n        description: 'Defeat 10 minibosses',\n        category: 'boss',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalMinibossesKilled', value: 10 },\n        hint: 'Minibosses appear in later rooms'\n    },\n\n    // =============================================================================\n    // RUN ACHIEVEMENTS\n    // =============================================================================\n    firstRun: {\n        id: 'firstRun',\n        name: 'First Run',\n        description: 'Complete your first run',\n        category: 'run',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalRuns', value: 1 },\n        hint: 'Play until you die (or win!)'\n    },\n    run10: {\n        id: 'run10',\n        name: 'Veteran',\n        description: 'Complete 10 runs',\n        category: 'run',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalRuns', value: 10 },\n        hint: 'Practice makes progress'\n    },\n    run50: {\n        id: 'run50',\n        name: 'Dedicated',\n        description: 'Complete 50 runs',\n        category: 'run',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalRuns', value: 50 },\n        hint: 'A true fan of the show'\n    },\n    run100: {\n        id: 'run100',\n        name: 'Century',\n        description: 'Complete 100 runs',\n        category: 'run',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'totalRuns', value: 100 },\n        hint: 'The ultimate dedication'\n    },\n    quickDeath: {\n        id: 'quickDeath',\n        name: 'Speedrun Fail',\n        description: 'Die within 30 seconds',\n        category: 'run',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        hint: 'Sometimes things go wrong fast'\n    },\n    longRun: {\n        id: 'longRun',\n        name: 'Marathon',\n        description: 'Survive for 30 minutes',\n        category: 'run',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Keep surviving as long as possible'\n    },\n\n    // =============================================================================\n    // UPGRADE ACHIEVEMENTS\n    // =============================================================================\n    level10: {\n        id: 'level10',\n        name: 'Level 10',\n        description: 'Reach level 10 in a single run',\n        category: 'upgrade',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'bestLevel', value: 10 },\n        hint: 'Collect XP and level up'\n    },\n    level20: {\n        id: 'level20',\n        name: 'Level 20',\n        description: 'Reach level 20 in a single run',\n        category: 'upgrade',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'bestLevel', value: 20 },\n        hint: 'Keep grinding for XP'\n    },\n    level30: {\n        id: 'level30',\n        name: 'Powerhouse',\n        description: 'Reach level 30 in a single run',\n        category: 'upgrade',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'bestLevel', value: 30 },\n        hint: 'Build becomes unstoppable'\n    },\n    level50: {\n        id: 'level50',\n        name: 'Unstoppable',\n        description: 'Reach level 50 in a single run',\n        category: 'upgrade',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'bestLevel', value: 50 },\n        hint: 'Ultimate power achieved'\n    },\n    upgradeCollector: {\n        id: 'upgradeCollector',\n        name: 'Collector',\n        description: 'Have 15 upgrades at once',\n        category: 'upgrade',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        hint: 'Collect many different upgrades'\n    },\n    synergyMaster: {\n        id: 'synergyMaster',\n        name: 'Synergy Master',\n        description: 'Activate 3 synergies in one run',\n        category: 'upgrade',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Build for multiple synergy combos',\n        unlocks: ['trailRainbow']\n    },\n\n    // =============================================================================\n    // CURRENCY ACHIEVEMENTS\n    // =============================================================================\n    earn100: {\n        id: 'earn100',\n        name: 'Pocket Change',\n        description: 'Earn 100 credits total',\n        category: 'currency',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalCurrencyEarned', value: 100 },\n        hint: 'Play runs to earn credits'\n    },\n    earn500: {\n        id: 'earn500',\n        name: 'Savings Account',\n        description: 'Earn 500 credits total',\n        category: 'currency',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalCurrencyEarned', value: 500 },\n        hint: 'Keep earning and saving',\n        unlocks: ['glowGold']\n    },\n    earn1000: {\n        id: 'earn1000',\n        name: 'Money Bags',\n        description: 'Earn 1000 credits total',\n        category: 'currency',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalCurrencyEarned', value: 1000 },\n        hint: 'A fortune awaits'\n    },\n    earn5000: {\n        id: 'earn5000',\n        name: 'Fortune',\n        description: 'Earn 5000 credits total',\n        category: 'currency',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'totalCurrencyEarned', value: 5000 },\n        hint: 'Building an empire'\n    },\n    earn10000: {\n        id: 'earn10000',\n        name: 'Tycoon',\n        description: 'Earn 10000 credits total',\n        category: 'currency',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'totalCurrencyEarned', value: 10000 },\n        hint: 'The ultimate collector'\n    },\n    bigSpender: {\n        id: 'bigSpender',\n        name: 'Big Spender',\n        description: 'Spend 1000 credits in the shop',\n        category: 'currency',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalCurrencySpent', value: 1000 },\n        hint: 'Buy upgrades from the shop'\n    },\n\n    // =============================================================================\n    // CHALLENGE ACHIEVEMENTS (special conditions)\n    // =============================================================================\n    perfectFloor: {\n        id: 'perfectFloor',\n        name: 'Untouchable',\n        description: 'Clear a floor without taking damage',\n        category: 'challenge',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Dodge everything on an entire floor',\n        unlocks: ['glowVoid']\n    },\n    speedRunner: {\n        id: 'speedRunner',\n        name: 'Speed Demon',\n        description: 'Clear Floor 3 in under 5 minutes',\n        category: 'challenge',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Rush through the first 3 floors',\n        unlocks: ['glowElectric']\n    },\n    bossRush: {\n        id: 'bossRush',\n        name: 'Boss Rush',\n        description: 'Defeat 3 bosses in one run',\n        category: 'challenge',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Reach and defeat multiple floor bosses'\n    },\n    noHitBoss: {\n        id: 'noHitBoss',\n        name: 'Flawless Victory',\n        description: 'Defeat a boss without taking damage',\n        category: 'challenge',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Perfect boss fight execution'\n    },\n    glassCannonWin: {\n        id: 'glassCannonWin',\n        name: 'Living Dangerously',\n        description: 'Defeat a boss while below 25% HP',\n        category: 'challenge',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Living dangerously pays off'\n    },\n    closeCall: {\n        id: 'closeCall',\n        name: 'Close Call',\n        description: 'Survive with 1 HP',\n        category: 'challenge',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Get very close to death but survive',\n        unlocks: ['glowCrimson']\n    },\n    pacifist: {\n        id: 'pacifist',\n        name: 'Pacifist Start',\n        description: 'Clear Room 1 without attacking',\n        category: 'challenge',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Just dodge everything'\n    },\n    noDamageRoom: {\n        id: 'noDamageRoom',\n        name: 'Perfect Room',\n        description: 'Clear 5 rooms without damage in one run',\n        category: 'challenge',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Master your dodging skills'\n    },\n\n    // =============================================================================\n    // BENCHMARK ACHIEVEMENTS (high targets)\n    // =============================================================================\n    kill5000: {\n        id: 'kill5000',\n        name: 'Exterminator',\n        description: 'Kill 5,000 enemies total',\n        category: 'benchmark',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'totalEnemiesKilled', value: 5000 },\n        hint: 'A lifetime of combat'\n    },\n    kill10000: {\n        id: 'kill10000',\n        name: 'Annihilator',\n        description: 'Kill 10,000 enemies total',\n        category: 'benchmark',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'totalEnemiesKilled', value: 10000 },\n        hint: 'The ultimate destroyer'\n    },\n    floor15: {\n        id: 'floor15',\n        name: 'Deep Delver',\n        description: 'Reach Floor 15',\n        category: 'benchmark',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'bestFloor', value: 15 },\n        hint: 'Go deeper than ever before'\n    },\n    floor20: {\n        id: 'floor20',\n        name: 'Abyssal',\n        description: 'Reach Floor 20',\n        category: 'benchmark',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'bestFloor', value: 20 },\n        hint: 'The final frontier'\n    },\n    rooms100: {\n        id: 'rooms100',\n        name: 'Room Master',\n        description: 'Clear 100 rooms total',\n        category: 'benchmark',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalRoomsCleared', value: 100 },\n        hint: 'Clear many rooms across all runs'\n    },\n    rooms500: {\n        id: 'rooms500',\n        name: 'Hall Walker',\n        description: 'Clear 500 rooms total',\n        category: 'benchmark',\n        icon: '',\n        unlocked: false,\n        difficulty: 'benchmark',\n        threshold: { stat: 'totalRoomsCleared', value: 500 },\n        hint: 'Keep exploring'\n    },\n\n    // =============================================================================\n    // SECRET/FUN ACHIEVEMENTS\n    // =============================================================================\n    firstPickup: {\n        id: 'firstPickup',\n        name: 'Loot Goblin',\n        description: 'Collect your first pickup',\n        category: 'progression',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        hint: 'Pick up health, XP, or other items'\n    },\n    healingAddict: {\n        id: 'healingAddict',\n        name: 'Healing Addict',\n        description: 'Collect 50 health pickups',\n        category: 'progression',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalHealthPickups', value: 50 },\n        hint: 'Stay alive by healing'\n    },\n    xpHoarder: {\n        id: 'xpHoarder',\n        name: 'XP Hoarder',\n        description: 'Collect 1000 XP orbs',\n        category: 'progression',\n        icon: '',\n        unlocked: false,\n        difficulty: 'normal',\n        threshold: { stat: 'totalXpOrbs', value: 1000 },\n        hint: 'Collect all those green orbs'\n    },\n    comeback: {\n        id: 'comeback',\n        name: 'Comeback King',\n        description: 'Win a room after being below 10% HP',\n        category: 'challenge',\n        icon: '',\n        unlocked: false,\n        difficulty: 'challenge',\n        hint: 'Never give up!'\n    }\n};\n\n// Achievement difficulty colors for UI\nexport const ACHIEVEMENT_COLORS = {\n    normal: [200, 200, 200],      // Gray - standard achievements\n    challenge: [255, 200, 100],   // Gold - challenge achievements\n    benchmark: [200, 150, 255]    // Purple - benchmark achievements\n};\n\n// Default credit rewards by difficulty (for achievements without unlocks)\nexport const ACHIEVEMENT_REWARDS = {\n    normal: 25,\n    challenge: 50,\n    benchmark: 100\n};\n\n/**\n * Get the credit reward for an achievement\n * Returns 0 if achievement has unlocks (the unlock IS the reward)\n * @param {Object} achievement - Achievement object\n * @returns {number} Credit reward amount\n */\nexport function getAchievementReward(achievement) {\n    if (!achievement) return 0;\n    // If achievement unlocks something, no credit reward\n    if (achievement.unlocks && achievement.unlocks.length > 0) return 0;\n    // Use explicit reward if set, otherwise use difficulty default\n    if (achievement.reward !== undefined) return achievement.reward;\n    return ACHIEVEMENT_REWARDS[achievement.difficulty] || ACHIEVEMENT_REWARDS.normal;\n}\n\n// Get achievements by category\nexport function getAchievementsByCategory(category) {\n    return Object.values(ACHIEVEMENTS).filter(ach => ach.category === category);\n}\n\n// Get achievements by difficulty\nexport function getAchievementsByDifficulty(difficulty) {\n    return Object.values(ACHIEVEMENTS).filter(ach => ach.difficulty === difficulty);\n}\n\n// Get all achievement categories\nexport function getAchievementCategories() {\n    const categories = new Set();\n    Object.values(ACHIEVEMENTS).forEach(ach => categories.add(ach.category));\n    return Array.from(categories);\n}\n\n// Get achievement by ID\nexport function getAchievementById(id) {\n    return ACHIEVEMENTS[id] || null;\n}\n\n// Get all achievements that unlock shop items\nexport function getAchievementsWithUnlocks() {\n    return Object.values(ACHIEVEMENTS).filter(ach => ach.unlocks && ach.unlocks.length > 0);\n}\n\n// Calculate achievement progress (for achievements with thresholds)\nexport function getAchievementProgress(achievementId, stats) {\n    const achievement = ACHIEVEMENTS[achievementId];\n    if (!achievement || !achievement.threshold) {\n        return null;\n    }\n\n    const currentValue = stats[achievement.threshold.stat] || 0;\n    const targetValue = achievement.threshold.value;\n    const progress = Math.min(currentValue / targetValue, 1);\n\n    return {\n        current: currentValue,\n        target: targetValue,\n        progress: progress,\n        percentage: Math.round(progress * 100)\n    };\n}\n","// Unlock definitions - defines all unlockable content\n\n// Character unlocks\nexport const CHARACTER_UNLOCKS = {\n    survivor: {\n        name: 'The Survivor',\n        description: 'Balanced stats, +10% XP gain',\n        cost: 0,\n        unlockedByDefault: true,\n        char: '@',\n        color: [100, 150, 255],\n        stats: {\n            health: 100,\n            speed: 150,\n            damage: 10\n        },\n        weapon: 'pistol',\n        ability: 'xpBoost' // +10% XP gain\n    },\n    scout: {\n        name: 'The Scout',\n        description: 'Fast and agile, +20% speed, +10% dodge',\n        cost: 0, // Unlocked by completing Floor 2\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 2 },\n        char: '',\n        color: [255, 255, 100],\n        stats: {\n            health: 75,\n            speed: 200,\n            damage: 8\n        },\n        weapon: 'smg',\n        ability: 'speedBoost' // +20% speed, +10% dodge chance\n    },\n    tank: {\n        name: 'The Tank',\n        description: 'High health and defense, +25% health, +15% damage reduction',\n        cost: 0, // Unlocked by completing Floor 3\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 3 },\n        char: '',\n        color: [150, 150, 150],\n        stats: {\n            health: 150,\n            speed: 100,\n            damage: 12\n        },\n        weapon: 'shotgun',\n        ability: 'tankStats' // +25% health, +15% damage reduction\n    },\n    sniper: {\n        name: 'The Sniper',\n        description: 'High damage, precision-focused, +50% crit chance',\n        cost: 0, // Unlocked by completing Floor 3\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 3 },\n        char: '',\n        color: [100, 255, 255],\n        stats: {\n            health: 80,\n            speed: 120,\n            damage: 20\n        },\n        weapon: 'sniper',\n        ability: 'critBoost' // +50% crit chance, +25% crit damage (requires crit system)\n    },\n    pyro: {\n        name: 'The Pyro',\n        description: 'Fire specialist, +25% fire damage over time',\n        cost: 0, // Unlocked by completing Floor 2\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 2 },\n        char: '',\n        color: [255, 150, 50],\n        stats: {\n            health: 90,\n            speed: 150,\n            damage: 12\n        },\n        weapon: 'flamethrower',\n        ability: 'fireDot' // +25% fire DoT (requires DoT system)\n    },\n    // === NEW CHARACTERS (achievement-locked) ===\n    bomber: {\n        name: 'The Bomber',\n        description: 'Explosive specialist, +50% blast radius, projectiles explode on hit',\n        cost: 0,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'achievement', value: 'boss10' },\n        char: '',\n        color: [255, 100, 100],\n        stats: {\n            health: 85,\n            speed: 130,\n            damage: 15\n        },\n        weapon: 'launcher',\n        ability: 'explosiveShots' // Projectiles explode, +50% blast radius\n    },\n    engineer: {\n        name: 'The Engineer',\n        description: 'Support class, +2 orbital drones that auto-attack nearby enemies',\n        cost: 0,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'achievement', value: 'level20' },\n        char: '',\n        color: [100, 200, 255],\n        stats: {\n            health: 80,\n            speed: 140,\n            damage: 8\n        },\n        weapon: 'pistol',\n        ability: 'orbitalDrones' // Start with 2 orbital drones\n    },\n    vampire: {\n        name: 'The Vampire',\n        description: 'Lifesteal specialist, +15% lifesteal, -20% max health',\n        cost: 0,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'achievement', value: 'kill1000' },\n        char: '',\n        color: [180, 50, 180],\n        stats: {\n            health: 70,\n            speed: 160,\n            damage: 14\n        },\n        weapon: 'smg',\n        ability: 'vampiric' // +15% lifesteal, -20% max health\n    },\n    berserker: {\n        name: 'The Berserker',\n        description: 'Rage mode, +100% damage below 30% HP, takes +25% more damage',\n        cost: 0,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'achievement', value: 'glassCannonWin' },\n        char: '',\n        color: [255, 50, 50],\n        stats: {\n            health: 120,\n            speed: 140,\n            damage: 18\n        },\n        weapon: 'shotgun',\n        ability: 'rage' // +100% damage below 30% HP, +25% damage taken\n    },\n    ghost: {\n        name: 'The Ghost',\n        description: 'Evasion master, +25% dodge chance, +15% crit, lower health',\n        cost: 0,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'achievement', value: 'perfectFloor' },\n        char: '',\n        color: [200, 200, 255],\n        stats: {\n            health: 60,\n            speed: 180,\n            damage: 11\n        },\n        weapon: 'smg',\n        ability: 'ethereal' // +25% dodge, +15% crit chance\n    }\n};\n\n// Weapon unlocks\nexport const WEAPON_UNLOCKS = {\n    default: {\n        name: 'Default Weapon',\n        description: 'Single bullet weapon',\n        cost: 0,\n        unlockedByDefault: true\n    },\n    spreadShot: {\n        name: 'Spread Shot',\n        description: 'Fires 3 projectiles in a cone, lower damage each',\n        cost: 250,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 2 }\n    },\n    boomerang: {\n        name: 'Boomerang Blaster',\n        description: 'Projectiles return, hitting enemies twice',\n        cost: 400,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 3 }\n    },\n    chainLightning: {\n        name: 'Chain Lightning',\n        description: 'Bounces to 3 nearby enemies, -20% per bounce',\n        cost: 500,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 3 }\n    },\n    railgun: {\n        name: 'Railgun',\n        description: 'Pierces ALL enemies in a line, 3s cooldown',\n        cost: 600,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 4 },\n        requiredAchievement: 'boss25'\n    },\n    homingMissiles: {\n        name: 'Homing Missiles',\n        description: 'Slower projectiles that track enemies',\n        cost: 700,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 4 }\n    },\n    plasmaRifle: {\n        name: 'Plasma Rifle',\n        description: 'High damage, penetrates 2 enemies',\n        cost: 800,\n        unlockedByDefault: false,\n        unlockRequirement: { type: 'floor', value: 5 },\n        requiredAchievement: 'floor10'\n    }\n};\n\n// Cosmetic unlocks - visual customizations (unlocked via achievements)\nexport const COSMETIC_UNLOCKS = {\n    // === Player Trails ===\n    trailNone: {\n        name: 'No Trail',\n        description: 'Default appearance',\n        cost: 0,\n        unlockedByDefault: true,\n        category: 'trail'\n    },\n    trailFire: {\n        name: 'Fire Trail',\n        description: 'Leave a blazing trail behind you',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'trail',\n        color: [255, 100, 50],\n        requiredAchievement: 'kill100'\n    },\n    trailIce: {\n        name: 'Ice Trail',\n        description: 'Leave a frosty trail behind you',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'trail',\n        color: [100, 200, 255],\n        requiredAchievement: 'floor5'\n    },\n    trailPoison: {\n        name: 'Toxic Trail',\n        description: 'Leave a poisonous trail behind you',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'trail',\n        color: [100, 255, 100],\n        requiredAchievement: 'kill500'\n    },\n    trailShadow: {\n        name: 'Shadow Trail',\n        description: 'Leave a dark trail behind you',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'trail',\n        color: [80, 50, 120],\n        requiredAchievement: 'firstSynergy'\n    },\n    trailRainbow: {\n        name: 'Rainbow Trail',\n        description: 'Leave a colorful trail behind you',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'trail',\n        color: 'rainbow',\n        requiredAchievement: 'synergyMaster'\n    },\n\n    // === Death Effects ===\n    deathNone: {\n        name: 'Standard Death',\n        description: 'Default enemy death effect',\n        cost: 0,\n        unlockedByDefault: true,\n        category: 'death'\n    },\n    deathExplosion: {\n        name: 'Explosive Death',\n        description: 'Enemies explode dramatically',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'death',\n        requiredAchievement: 'firstBoss'\n    },\n    deathDisintegrate: {\n        name: 'Disintegration',\n        description: 'Enemies crumble into particles',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'death',\n        requiredAchievement: 'boss5'\n    },\n    deathVaporize: {\n        name: 'Vaporize',\n        description: 'Enemies vanish in a puff of smoke',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'death',\n        requiredAchievement: 'killStreak10'\n    },\n    deathPixelate: {\n        name: 'Pixelate',\n        description: 'Enemies break into pixels',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'death',\n        requiredAchievement: 'multikill'\n    },\n    deathFireworks: {\n        name: 'Fireworks',\n        description: 'Enemies burst like fireworks',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'death',\n        requiredAchievement: 'floor10'\n    },\n\n    // === Player Glow ===\n    glowNone: {\n        name: 'No Glow',\n        description: 'Default appearance',\n        cost: 0,\n        unlockedByDefault: true,\n        category: 'glow'\n    },\n    glowGold: {\n        name: 'Golden Aura',\n        description: 'Radiate a golden glow',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'glow',\n        color: [255, 200, 50],\n        requiredAchievement: 'earn500'\n    },\n    glowCrimson: {\n        name: 'Crimson Aura',\n        description: 'Radiate a blood-red glow',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'glow',\n        color: [200, 50, 50],\n        requiredAchievement: 'closeCall'\n    },\n    glowElectric: {\n        name: 'Electric Aura',\n        description: 'Crackle with electricity',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'glow',\n        color: [100, 150, 255],\n        requiredAchievement: 'speedRunner'\n    },\n    glowVoid: {\n        name: 'Void Aura',\n        description: 'Emanate dark energy',\n        cost: 0,\n        unlockedByDefault: false,\n        category: 'glow',\n        color: [50, 0, 80],\n        requiredAchievement: 'perfectFloor'\n    }\n};\n\n// Run Boosters - one-time consumables for next run\nexport const RUN_BOOSTER_UNLOCKS = {\n    healthPack: {\n        name: 'Health Pack',\n        description: 'Start next run with +30 bonus HP',\n        cost: 30,\n        consumable: true,\n        effect: { type: 'startingHealth', value: 30 }\n    },\n    damageAmp: {\n        name: 'Damage Amp',\n        description: '+25% damage for first floor',\n        cost: 35,\n        consumable: true,\n        effect: { type: 'tempDamage', value: 0.25, duration: 'floor' }\n    },\n    speedSerum: {\n        name: 'Speed Serum',\n        description: '+30% speed for first floor',\n        cost: 25,\n        consumable: true,\n        effect: { type: 'tempSpeed', value: 0.30, duration: 'floor' }\n    },\n    wealthCharm: {\n        name: 'Wealth Charm',\n        description: '+30% credits earned this run',\n        cost: 50,\n        consumable: true,\n        effect: { type: 'creditMultiplier', value: 0.30, duration: 'run' }\n    },\n    luckyCoin: {\n        name: 'Lucky Coin',\n        description: '+15% crit chance for first floor',\n        cost: 40,\n        consumable: true,\n        effect: { type: 'tempCrit', value: 0.15, duration: 'floor' }\n    },\n    armorPlating: {\n        name: 'Armor Plating',\n        description: '+20% damage reduction for first floor',\n        cost: 45,\n        consumable: true,\n        effect: { type: 'tempDefense', value: 0.20, duration: 'floor' }\n    },\n    xpBooster: {\n        name: 'XP Booster',\n        description: '+50% XP gained for first floor',\n        cost: 40,\n        consumable: true,\n        effect: { type: 'tempXP', value: 0.50, duration: 'floor' }\n    },\n    emergencyRevive: {\n        name: 'Emergency Revive',\n        description: 'Auto-revive once at 25% HP',\n        cost: 75,\n        consumable: true,\n        effect: { type: 'autoRevive', value: 0.25, uses: 1 }\n    }\n};\n\n// Permanent upgrade unlocks\nexport const PERMANENT_UPGRADE_UNLOCKS = {\n    // === TIER 1: Basic Stats (cheap, essential) ===\n    startingHealth: {\n        name: 'Starting Health +10',\n        description: 'Start the show with +10 max health',\n        cost: 50,\n        maxLevel: 5,\n        tier: 1\n    },\n    startingDamage: {\n        name: 'Starting Damage +1',\n        description: 'Start the show with +1 damage',\n        cost: 75,\n        maxLevel: 5,\n        tier: 1\n    },\n    startingSpeed: {\n        name: 'Starting Speed +10',\n        description: 'Start the show with +10 speed',\n        cost: 60,\n        maxLevel: 5,\n        tier: 1\n    },\n\n    // === TIER 2: Utility (moderate cost) ===\n    xpMagnet: {\n        name: 'XP Magnet',\n        description: '+15% XP pickup radius per level',\n        cost: 60,\n        maxLevel: 5,\n        tier: 2\n    },\n    propDurability: {\n        name: 'Prop Durability',\n        description: 'Props last +2 seconds per level',\n        cost: 80,\n        maxLevel: 5,\n        tier: 2\n    },\n    propDropChance: {\n        name: 'Prop Drop Chance',\n        description: '+5% prop drop chance per level',\n        cost: 100,\n        maxLevel: 5,\n        tier: 2\n    },\n    creditBonus: {\n        name: 'Credit Bonus',\n        description: '+8% credits earned per level',\n        cost: 120,\n        maxLevel: 5,\n        tier: 2\n    },\n\n    // === TIER 3: Combat (higher cost) ===\n    luckyStart: {\n        name: 'Lucky Start',\n        description: '+5% starting crit chance per level',\n        cost: 100,\n        maxLevel: 4,\n        tier: 3\n    },\n    thickSkin: {\n        name: 'Thick Skin',\n        description: '+3% damage reduction per level',\n        cost: 100,\n        maxLevel: 5,\n        tier: 3\n    },\n    secondWind: {\n        name: 'Second Wind',\n        description: '+5% revive health per level (up to 25%)',\n        cost: 150,\n        maxLevel: 4,\n        tier: 3\n    },\n    bossBounty: {\n        name: 'Boss Bounty',\n        description: '+15 bonus credits per boss kill',\n        cost: 150,\n        maxLevel: 3,\n        tier: 3\n    },\n\n    // === TIER 4: Premium (expensive, powerful) ===\n    mulligan: {\n        name: 'Mulligan',\n        description: '+1 reroll per run for upgrade drafts',\n        cost: 300,\n        maxLevel: 3,\n        tier: 4\n    },\n    comfortZone: {\n        name: 'Comfort Zone',\n        description: '+0.1s invulnerability after hit',\n        cost: 200,\n        maxLevel: 3,\n        tier: 4\n    },\n    toughChoices: {\n        name: 'Tough Choices',\n        description: '+1 upgrade option in drafts (4 total)',\n        cost: 500,\n        maxLevel: 1,\n        tier: 4\n    },\n    headStart: {\n        name: 'Head Start',\n        description: 'Begin each run at level 2',\n        cost: 750,\n        maxLevel: 1,\n        tier: 4\n    }\n};\n\n// Get all unlocks for a category\nexport function getUnlocksForCategory(category) {\n    switch (category) {\n        case 'characters':\n            return CHARACTER_UNLOCKS;\n        case 'weapons':\n            return WEAPON_UNLOCKS;\n        case 'permanentUpgrades':\n            return PERMANENT_UPGRADE_UNLOCKS;\n        case 'cosmetics':\n            return COSMETIC_UNLOCKS;\n        case 'boosters':\n            return RUN_BOOSTER_UNLOCKS;\n        default:\n            return {};\n    }\n}\n\n// Get unlock info\nexport function getUnlockInfo(category, key) {\n    const unlocks = getUnlocksForCategory(category);\n    return unlocks[key] || null;\n}\n\n// Get cosmetics by sub-category (trail, death, glow)\nexport function getCosmeticsByType(type) {\n    return Object.entries(COSMETIC_UNLOCKS)\n        .filter(([key, item]) => item.category === type)\n        .reduce((acc, [key, item]) => ({ ...acc, [key]: item }), {});\n}\n\n","// Meta progression system - handles currency, saves, and unlocks\n\nimport { generateRandomName, generateInviteCode } from './nameGenerator.js';\nimport { getAchievementReward, getAchievementById } from '../data/achievements.js';\nimport { CHARACTER_UNLOCKS, getUnlockInfo } from '../data/unlocks.js';\n\nconst STORAGE_KEY = 'superSmashTexty_save';\nconst CURRENCY_NAME = 'Credits'; // Full name (rarely used)\nconst CURRENCY_ICON = '$'; // Icon used for display\n\n// Default save data structure\nconst DEFAULT_SAVE = {\n    version: 1,\n    currency: 0,\n    playerName: null, // Will be generated on first load\n    inviteCode: null, // Will be generated on first load\n    // Player XP/Level system (cosmetic prestige)\n    totalXP: 0,\n    playerLevel: 1,\n    selectedPortrait: 'default',\n    unlocks: {\n        characters: ['survivor'], // Default character is always unlocked\n        weapons: ['default'], // Default weapon is always unlocked\n        permanentUpgrades: [], // Array of unlock keys\n        portraits: ['default'] // Default portrait is always unlocked\n    },\n    permanentUpgradeLevels: {}, // Track levels for permanent upgrades: { upgradeKey: level }\n    permanentUpgradePurchaseHistory: {}, // Track purchase costs: { upgradeKey: [cost1, cost2, ...] }\n    stats: {\n        totalRuns: 0,\n        totalFloorsReached: 0,\n        totalRoomsCleared: 0,\n        totalEnemiesKilled: 0,\n        totalBossesKilled: 0,\n        bestFloor: 1,\n        bestRoom: 1,\n        bestLevel: 1,\n        totalCurrencyEarned: 0,\n        totalPlayTime: 0, // Total play time in seconds\n        fastestRunTime: 0 // Fastest run completion time in seconds\n    },\n    achievements: [], // Array of unlocked achievement IDs\n    runHistory: [] // Array of last 20 run records\n};\n\n// Maximum number of runs to store in history\nconst MAX_RUN_HISTORY = 20;\n\n// Load save data from localStorage\nexport function loadSave() {\n    try {\n        const saved = localStorage.getItem(STORAGE_KEY);\n        if (saved) {\n            const data = JSON.parse(saved);\n            // Merge with default to handle missing fields\n            const mergedData = { ...DEFAULT_SAVE, ...data };\n\n            // Generate player name if not set\n            if (!mergedData.playerName) {\n                mergedData.playerName = generateRandomName();\n                saveGame(mergedData);\n            }\n\n            // Generate invite code if not set\n            if (!mergedData.inviteCode) {\n                mergedData.inviteCode = generateInviteCode();\n                saveGame(mergedData);\n            }\n\n            return mergedData;\n        }\n    } catch (e) {\n        console.error('Error loading save:', e);\n    }\n\n    // First time load - generate name and code\n    const newSave = { ...DEFAULT_SAVE };\n    newSave.playerName = generateRandomName();\n    newSave.inviteCode = generateInviteCode();\n    saveGame(newSave);\n    return newSave;\n}\n\n// Save data to localStorage\nexport function saveGame(data) {\n    try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n        return true;\n    } catch (e) {\n        console.error('Error saving game:', e);\n        return false;\n    }\n}\n\n// Get current save data\nexport function getSaveData() {\n    return loadSave();\n}\n\n// Add currency to save\nexport function addCurrency(amount) {\n    const save = loadSave();\n    // Cap currency at Number.MAX_SAFE_INTEGER to prevent overflow\n    save.currency = Math.min(Number.MAX_SAFE_INTEGER, save.currency + amount);\n    saveGame(save);\n    return save.currency;\n}\n\n// Get current currency\nexport function getCurrency() {\n    return loadSave().currency;\n}\n\n// Check if something is unlocked\nexport function isUnlocked(category, item) {\n    const save = loadSave();\n    return save.unlocks[category] && save.unlocks[category].includes(item);\n}\n\n// Unlock an item\nexport function unlockItem(category, item) {\n    const save = loadSave();\n    if (!save.unlocks[category]) {\n        save.unlocks[category] = [];\n    }\n    if (!save.unlocks[category].includes(item)) {\n        save.unlocks[category].push(item);\n        saveGame(save);\n        return true;\n    }\n    return false;\n}\n\n// Check and unlock characters based on floor completion\nexport function checkFloorUnlocks(floorCompleted) {\n    const save = loadSave();\n    let unlocked = false;\n\n    for (const [key, char] of Object.entries(CHARACTER_UNLOCKS)) {\n        if (char.unlockRequirement &&\n            char.unlockRequirement.type === 'floor' &&\n            floorCompleted >= char.unlockRequirement.value) {\n            if (!isUnlocked('characters', key)) {\n                unlockItem('characters', key);\n                unlocked = true;\n            }\n        }\n    }\n\n    return unlocked;\n}\n\n// Check and unlock characters based on achievement completion\n// Call this after unlocking an achievement\nexport function checkAchievementUnlocks(achievementId) {\n    let unlocked = [];\n\n    for (const [key, char] of Object.entries(CHARACTER_UNLOCKS)) {\n        if (char.unlockRequirement &&\n            char.unlockRequirement.type === 'achievement' &&\n            char.unlockRequirement.value === achievementId) {\n            if (!isUnlocked('characters', key)) {\n                unlockItem('characters', key);\n                unlocked.push({ type: 'character', key, name: char.name });\n            }\n        }\n    }\n\n    return unlocked;\n}\n\n// Check if a character is unlocked (handles both floor and achievement requirements)\nexport function isCharacterUnlocked(characterKey) {\n    // First check if explicitly unlocked in save data\n    if (isUnlocked('characters', characterKey)) {\n        return true;\n    }\n\n    // Import CHARACTER_UNLOCKS synchronously (already loaded)\n    // This is a convenience function - for async contexts use checkAchievementUnlocks\n    return false; // If not in save data, it's not unlocked\n}\n\n// Get selected character (stored in save)\nexport function getSelectedCharacter() {\n    const save = loadSave();\n    return save.selectedCharacter || 'survivor';\n}\n\n// Set selected character\nexport function setSelectedCharacter(characterKey) {\n    const save = loadSave();\n    save.selectedCharacter = characterKey;\n    saveGame(save);\n}\n\n// Get permanent upgrade level\nexport function getPermanentUpgradeLevel(upgradeKey) {\n    const save = loadSave();\n    if (!save.permanentUpgradeLevels) {\n        save.permanentUpgradeLevels = {};\n    }\n    return save.permanentUpgradeLevels[upgradeKey] || 0;\n}\n\n// Purchase an unlock with currency\nexport function purchaseUnlock(category, item, cost) {\n    const save = loadSave();\n    if (save.currency >= cost) {\n        save.currency -= cost;\n        // Unlock the item\n        if (!save.unlocks[category]) {\n            save.unlocks[category] = [];\n        }\n        if (!save.unlocks[category].includes(item)) {\n            save.unlocks[category].push(item);\n        }\n        saveGame(save);\n        return true;\n    }\n    return false;\n}\n\n// Calculate escalating price for permanent upgrades (same as shop.js)\nfunction getUpgradePrice(level) {\n    // Level 1 = $50, Level 2 = $65, Level 3 = $90, Level 4 = $115, Level 5 = $160\n    const prices = [50, 65, 90, 115, 160];\n    if (level < prices.length) {\n        return prices[level];\n    }\n    // For levels beyond 5, increase by 50 each level\n    return 160 + (level - 4) * 50;\n}\n\n// Purchase a permanent upgrade (handles level tracking)\nexport function purchasePermanentUpgrade(upgradeKey, cost, maxLevel) {\n    const save = loadSave();\n    const currentLevel = getPermanentUpgradeLevel(upgradeKey);\n    \n    // Check if already at max level\n    if (maxLevel && currentLevel >= maxLevel) {\n        return { success: false, reason: 'maxLevel' };\n    }\n    \n    // Check if enough currency\n    if (save.currency < cost) {\n        return { success: false, reason: 'insufficientCurrency' };\n    }\n    \n    // Purchase\n    save.currency -= cost;\n    if (!save.permanentUpgradeLevels) {\n        save.permanentUpgradeLevels = {};\n    }\n    save.permanentUpgradeLevels[upgradeKey] = (currentLevel || 0) + 1;\n    \n    // Track purchase cost for refund purposes\n    if (!save.permanentUpgradePurchaseHistory) {\n        save.permanentUpgradePurchaseHistory = {};\n    }\n    if (!save.permanentUpgradePurchaseHistory[upgradeKey]) {\n        save.permanentUpgradePurchaseHistory[upgradeKey] = [];\n    }\n    save.permanentUpgradePurchaseHistory[upgradeKey].push(cost);\n    \n    // Also add to unlocks if first purchase\n    if (!save.unlocks.permanentUpgrades) {\n        save.unlocks.permanentUpgrades = [];\n    }\n    if (!save.unlocks.permanentUpgrades.includes(upgradeKey)) {\n        save.unlocks.permanentUpgrades.push(upgradeKey);\n    }\n    \n    saveGame(save);\n    return { success: true, newLevel: save.permanentUpgradeLevels[upgradeKey] };\n}\n\n// ============ BOOSTER FUNCTIONS ============\n\n/**\n * Purchase a run booster (consumable)\n * @param {string} boosterKey - The booster to purchase\n * @param {number} cost - The cost of the booster\n * @returns {Object} Result object with success status\n */\nexport function purchaseBooster(boosterKey, cost) {\n    const save = loadSave();\n\n    // Check if player has enough currency\n    if (save.currency < cost) {\n        return { success: false, reason: 'insufficientCurrency' };\n    }\n\n    // Initialize boosters array if needed\n    if (!save.activeBoosters) {\n        save.activeBoosters = [];\n    }\n\n    // Deduct currency\n    save.currency -= cost;\n\n    // Track currency spent in stats\n    if (save.stats) {\n        save.stats.totalCurrencySpent = (save.stats.totalCurrencySpent || 0) + cost;\n    }\n\n    // Add booster to active boosters\n    save.activeBoosters.push({\n        key: boosterKey,\n        purchasedAt: Date.now()\n    });\n\n    saveGame(save);\n    return { success: true, boosterKey };\n}\n\n/**\n * Get count of active boosters\n * @returns {number} Number of active boosters ready to use\n */\nexport function getActiveBoostersCount() {\n    const save = loadSave();\n    return (save.activeBoosters || []).length;\n}\n\n/**\n * Get all active boosters\n * @returns {Array} Array of active booster objects\n */\nexport function getActiveBoosters() {\n    const save = loadSave();\n    return save.activeBoosters || [];\n}\n\n/**\n * Consume all active boosters for a run\n * @returns {Array} Array of consumed booster effects\n */\nexport function consumeBoosters() {\n    const save = loadSave();\n    const boosters = save.activeBoosters || [];\n\n    // Clear boosters\n    save.activeBoosters = [];\n    saveGame(save);\n\n    return boosters;\n}\n\n/**\n * Clear a specific booster (refund not included - just removes it)\n * @param {number} index - Index of booster to clear\n */\nexport function clearBooster(index) {\n    const save = loadSave();\n    if (save.activeBoosters && index >= 0 && index < save.activeBoosters.length) {\n        save.activeBoosters.splice(index, 1);\n        saveGame(save);\n        return true;\n    }\n    return false;\n}\n\n// Calculate total refundable credits for all permanent upgrades\nexport function getTotalRefundableCredits() {\n    const save = loadSave();\n    \n    // If purchase history exists, use it (most accurate)\n    if (save.permanentUpgradePurchaseHistory && Object.keys(save.permanentUpgradePurchaseHistory).length > 0) {\n        let total = 0;\n        Object.keys(save.permanentUpgradePurchaseHistory).forEach(upgradeKey => {\n            const purchaseHistory = save.permanentUpgradePurchaseHistory[upgradeKey];\n            if (purchaseHistory && Array.isArray(purchaseHistory)) {\n                purchaseHistory.forEach(cost => {\n                    total += cost;\n                });\n            }\n        });\n        return total;\n    }\n    \n    // Fallback: Calculate retroactively from current levels (for existing saves)\n    if (save.permanentUpgradeLevels && Object.keys(save.permanentUpgradeLevels).length > 0) {\n        let total = 0;\n        Object.keys(save.permanentUpgradeLevels).forEach(upgradeKey => {\n            const level = save.permanentUpgradeLevels[upgradeKey] || 0;\n            // Calculate what was paid for each level (0 to level-1)\n            for (let i = 0; i < level; i++) {\n                total += getUpgradePrice(i);\n            }\n        });\n        return total;\n    }\n    \n    return 0;\n}\n\n// Refund a single level of a specific permanent upgrade\nexport function refundSinglePermanentUpgrade(upgradeKey) {\n    const save = loadSave();\n    const currentLevel = getPermanentUpgradeLevel(upgradeKey);\n    \n    // Check if upgrade has any levels to refund\n    if (currentLevel === 0) {\n        return { success: false, reason: 'noLevels' };\n    }\n    \n    // Get refund amount from purchase history (most accurate)\n    let refundAmount = 0;\n    if (save.permanentUpgradePurchaseHistory && \n        save.permanentUpgradePurchaseHistory[upgradeKey] && \n        save.permanentUpgradePurchaseHistory[upgradeKey].length > 0) {\n        // Refund the last purchase (most recent level)\n        const purchaseHistory = save.permanentUpgradePurchaseHistory[upgradeKey];\n        refundAmount = purchaseHistory[purchaseHistory.length - 1];\n        // Remove the last entry\n        purchaseHistory.pop();\n        if (purchaseHistory.length === 0) {\n            delete save.permanentUpgradePurchaseHistory[upgradeKey];\n        }\n    } else {\n        // Fallback: Calculate price for the level being refunded (level-1 to level-2)\n        refundAmount = getUpgradePrice(currentLevel - 1);\n    }\n    \n    // Return credits\n    save.currency += refundAmount;\n    \n    // Decrease level by 1\n    save.permanentUpgradeLevels[upgradeKey] = currentLevel - 1;\n    \n    // If level becomes 0, remove from unlocks\n    if (save.permanentUpgradeLevels[upgradeKey] === 0) {\n        delete save.permanentUpgradeLevels[upgradeKey];\n        if (save.unlocks.permanentUpgrades) {\n            const index = save.unlocks.permanentUpgrades.indexOf(upgradeKey);\n            if (index > -1) {\n                save.unlocks.permanentUpgrades.splice(index, 1);\n            }\n        }\n    }\n    \n    saveGame(save);\n    return { success: true, refundAmount, newLevel: save.permanentUpgradeLevels[upgradeKey] || 0 };\n}\n\n// Refund all permanent upgrades (returns credits and resets levels)\nexport function refundAllPermanentUpgrades() {\n    const save = loadSave();\n    const refundAmount = getTotalRefundableCredits();\n    \n    if (refundAmount === 0) {\n        return { success: false, reason: 'noUpgrades' };\n    }\n    \n    // Return credits\n    save.currency += refundAmount;\n    \n    // Reset upgrade levels\n    save.permanentUpgradeLevels = {};\n    \n    // Clear purchase history\n    save.permanentUpgradePurchaseHistory = {};\n    \n    // Remove from unlocks (but keep the array structure)\n    if (save.unlocks.permanentUpgrades) {\n        save.unlocks.permanentUpgrades = [];\n    }\n    \n    saveGame(save);\n    return { success: true, refundAmount };\n}\n\n// Update run statistics\nexport function updateRunStats(runStats) {\n    const save = loadSave();\n    save.stats.totalRuns++;\n    save.stats.totalFloorsReached += runStats.floorsReached || 0;\n    save.stats.totalRoomsCleared += runStats.roomsCleared || 0;\n    save.stats.totalEnemiesKilled += runStats.enemiesKilled || 0;\n    save.stats.totalBossesKilled += runStats.bossesKilled || 0;\n    save.stats.totalCurrencyEarned += runStats.currencyEarned || 0;\n    \n    if (runStats.floorsReached > save.stats.bestFloor) {\n        save.stats.bestFloor = runStats.floorsReached;\n    }\n    if (runStats.roomsCleared > save.stats.bestRoom) {\n        save.stats.bestRoom = runStats.roomsCleared;\n    }\n    if (runStats.level > save.stats.bestLevel) {\n        save.stats.bestLevel = runStats.level || 1;\n    }\n    \n    saveGame(save);\n}\n\n// Check if achievement is unlocked\nexport function isAchievementUnlocked(achievementId) {\n    const save = loadSave();\n    if (!save.achievements) {\n        save.achievements = [];\n    }\n    return save.achievements.includes(achievementId);\n}\n\n// Unlock an achievement\nexport function unlockAchievement(achievementId) {\n    const save = loadSave();\n    if (!save.achievements) {\n        save.achievements = [];\n    }\n    if (!save.achievements.includes(achievementId)) {\n        save.achievements.push(achievementId);\n\n        // Award credit reward for the achievement\n        const achievement = getAchievementById(achievementId);\n        const reward = getAchievementReward(achievement);\n        if (reward > 0) {\n            save.currency = Math.min(Number.MAX_SAFE_INTEGER, save.currency + reward);\n            console.log(`[MetaProgression] Achievement \"${achievementId}\" awarded ${reward} credits`);\n        }\n\n        saveGame(save);\n\n        // Check if this achievement unlocks any characters\n        checkAchievementUnlocks(achievementId).then(unlockedChars => {\n            if (unlockedChars.length > 0) {\n                console.log('[MetaProgression] Achievement unlocked characters:', unlockedChars);\n            }\n        });\n\n        return true; // Newly unlocked\n    }\n    return false; // Already unlocked\n}\n\n// Get all unlocked achievements\nexport function getUnlockedAchievements() {\n    const save = loadSave();\n    return save.achievements || [];\n}\n\n// Get save statistics\nexport function getSaveStats() {\n    const save = loadSave();\n    return save.stats || DEFAULT_SAVE.stats;\n}\n\n// Calculate currency earned from a run\nexport function calculateCurrencyEarned(runStats) {\n    let currency = 0;\n\n    // Base currency per floor reached\n    currency += runStats.floorsReached * 10;\n\n    // Currency per room cleared\n    currency += runStats.roomsCleared * 5;\n\n    // Currency per enemy killed (small amount)\n    currency += Math.floor(runStats.enemiesKilled * 0.5);\n\n    // Bonus for reaching higher floors\n    if (runStats.floorsReached >= 2) {\n        currency += 10; // Floor 2 bonus\n    }\n    if (runStats.floorsReached >= 3) {\n        currency += 20; // Floor 3 bonus\n    }\n    if (runStats.floorsReached >= 4) {\n        currency += 30; // Floor 4+ bonus\n    }\n\n    // Performance bonus: more enemies killed = bonus\n    if (runStats.enemiesKilled >= 50) {\n        currency += 10;\n    }\n    if (runStats.enemiesKilled >= 100) {\n        currency += 20;\n    }\n    if (runStats.enemiesKilled >= 200) {\n        currency += 30;\n    }\n\n    // Boss Bounty upgrade: +15 credits per boss killed per level\n    const bossBountyLevel = getPermanentUpgradeLevel('bossBounty');\n    if (bossBountyLevel > 0 && runStats.bossesKilled > 0) {\n        currency += runStats.bossesKilled * bossBountyLevel * 15;\n    }\n\n    // Credit Bonus upgrade: +8% credits per level\n    const creditBonusLevel = getPermanentUpgradeLevel('creditBonus');\n    if (creditBonusLevel > 0) {\n        currency = Math.floor(currency * (1 + creditBonusLevel * 0.08));\n    }\n\n    return Math.floor(currency);\n}\n\n// Get currency name (returns icon for display)\nexport function getCurrencyName() {\n    return CURRENCY_ICON;\n}\n\n// Get currency icon (same as getCurrencyName for backward compatibility)\nexport function getCurrencyIcon() {\n    return CURRENCY_ICON;\n}\n\n// Get player name\nexport function getPlayerName() {\n    const save = loadSave();\n    return save.playerName || 'Player';\n}\n\n// Set player name\nexport function setPlayerName(name) {\n    const save = loadSave();\n    save.playerName = name;\n    saveGame(save);\n    return save.playerName;\n}\n\n// Get invite code\nexport function getInviteCode() {\n    const save = loadSave();\n    return save.inviteCode || '000000';\n}\n\n// Set invite code\nexport function setInviteCode(code) {\n    const save = loadSave();\n    save.inviteCode = code;\n    saveGame(save);\n    return save.inviteCode;\n}\n\n// Reset save (for testing/debugging)\nexport function resetSave() {\n    localStorage.removeItem(STORAGE_KEY);\n    return { ...DEFAULT_SAVE };\n}\n\n/**\n * Record a completed run to history\n * @param {Object} runData - Run data to record\n * @param {string} runData.character - Character used\n * @param {string} runData.weapon - Weapon used\n * @param {number} runData.floorsReached - Floors reached\n * @param {number} runData.roomsCleared - Rooms cleared\n * @param {number} runData.enemiesKilled - Enemies killed\n * @param {number} runData.bossesKilled - Bosses killed\n * @param {number} runData.level - Final player level\n * @param {number} runData.currencyEarned - Currency earned\n * @param {number} runData.duration - Run duration in seconds\n * @param {string} runData.deathCause - What killed the player\n * @param {Array} runData.upgrades - Upgrades collected\n * @param {Array} runData.synergies - Synergies activated\n */\nexport function recordRun(runData) {\n    const save = loadSave();\n\n    // Ensure runHistory array exists\n    if (!save.runHistory) {\n        save.runHistory = [];\n    }\n\n    // Create run record\n    const runRecord = {\n        timestamp: Date.now(),\n        character: runData.character || 'survivor',\n        weapon: runData.weapon || 'pistol',\n        floorsReached: runData.floorsReached || 1,\n        roomsCleared: runData.roomsCleared || 0,\n        enemiesKilled: runData.enemiesKilled || 0,\n        bossesKilled: runData.bossesKilled || 0,\n        level: runData.level || 1,\n        currencyEarned: runData.currencyEarned || 0,\n        duration: runData.duration || 0,\n        deathCause: runData.deathCause || 'Unknown',\n        upgrades: runData.upgrades || [],\n        synergies: runData.synergies || []\n    };\n\n    // Add to history (most recent first)\n    save.runHistory.unshift(runRecord);\n\n    // Keep only last MAX_RUN_HISTORY runs\n    if (save.runHistory.length > MAX_RUN_HISTORY) {\n        save.runHistory = save.runHistory.slice(0, MAX_RUN_HISTORY);\n    }\n\n    saveGame(save);\n    return runRecord;\n}\n\n/**\n * Get run history\n * @returns {Array} Array of run records (most recent first)\n */\nexport function getRunHistory() {\n    const save = loadSave();\n    return save.runHistory || [];\n}\n\n/**\n * Check if a shop item's achievement requirement is met\n * @param {string} category - Category of the item ('characters', 'weapons', 'permanentUpgrades')\n * @param {string} itemKey - Key of the item to check\n * @returns {boolean} True if achievement requirement is met (or no requirement exists)\n */\nexport function isShopItemAchievementUnlocked(category, itemKey) {\n    const unlockInfo = getUnlockInfo(category, itemKey);\n\n    if (!unlockInfo || !unlockInfo.requiredAchievement) {\n        return true; // No achievement requirement\n    }\n\n    return isAchievementUnlocked(unlockInfo.requiredAchievement);\n}\n\n/**\n * Get the required achievement info for a shop item\n * @param {string} category - Category of the item\n * @param {string} itemKey - Key of the item\n * @returns {Object|null} Achievement info or null if no requirement\n */\nexport function getRequiredAchievementForItem(category, itemKey) {\n    const unlockInfo = getUnlockInfo(category, itemKey);\n\n    if (!unlockInfo || !unlockInfo.requiredAchievement) {\n        return null;\n    }\n\n    const achievement = getAchievementById(unlockInfo.requiredAchievement);\n    return achievement;\n}\n\n/**\n * Synchronous version - Check if a shop item's achievement requirement is met\n * Use this when you already have the unlock info\n * @param {Object} unlockInfo - Unlock info object (must have requiredAchievement field if required)\n * @returns {boolean} True if achievement requirement is met (or no requirement exists)\n */\nexport function isItemAchievementUnlockedSync(unlockInfo) {\n    if (!unlockInfo || !unlockInfo.requiredAchievement) {\n        return true; // No achievement requirement\n    }\n\n    return isAchievementUnlocked(unlockInfo.requiredAchievement);\n}\n\n// ============ COSMETIC FUNCTIONS ============\n\n/**\n * Get the equipped cosmetic of a specific type\n * @param {string} type - Type of cosmetic (trail, death, glow)\n * @returns {string} Key of the equipped cosmetic, or default\n */\nexport function getEquippedCosmetic(type) {\n    const save = loadSave();\n    if (!save.equippedCosmetics) {\n        return type === 'trail' ? 'trailNone' : type === 'death' ? 'deathNone' : 'glowNone';\n    }\n    return save.equippedCosmetics[type] || (type === 'trail' ? 'trailNone' : type === 'death' ? 'deathNone' : 'glowNone');\n}\n\n/**\n * Set the equipped cosmetic of a specific type\n * @param {string} type - Type of cosmetic (trail, death, glow)\n * @param {string} key - Key of the cosmetic to equip\n * @returns {boolean} True if successful\n */\nexport function setEquippedCosmetic(type, key) {\n    const save = loadSave();\n\n    // Initialize cosmetics object if needed\n    if (!save.equippedCosmetics) {\n        save.equippedCosmetics = {\n            trail: 'trailNone',\n            death: 'deathNone',\n            glow: 'glowNone'\n        };\n    }\n\n    // Check if the cosmetic is owned (either default or purchased)\n    if (!key.includes('None') && !isUnlocked('cosmetics', key)) {\n        return false; // Can't equip what you don't own\n    }\n\n    save.equippedCosmetics[type] = key;\n    saveGame(save);\n    return true;\n}\n\n/**\n * Get all equipped cosmetics\n * @returns {Object} Object with trail, death, glow keys\n */\nexport function getEquippedCosmetics() {\n    const save = loadSave();\n    return save.equippedCosmetics || {\n        trail: 'trailNone',\n        death: 'deathNone',\n        glow: 'glowNone'\n    };\n}\n\n// ============ PLAYER XP/LEVEL SYSTEM ============\n\n/**\n * Calculate player level from total XP\n * Formula: level = floor(sqrt(totalXP / 100)) + 1\n * - Level 1: 0 XP\n * - Level 2: 100 XP\n * - Level 5: 1,600 XP\n * - Level 10: 8,100 XP\n * - Level 20: 36,100 XP\n * - Level 50: 240,100 XP\n * @param {number} xp - Total XP\n * @returns {number} Player level\n */\nexport function calculateLevelFromXP(xp) {\n    return Math.floor(Math.sqrt(xp / 100)) + 1;\n}\n\n/**\n * Calculate XP required for a specific level\n * @param {number} level - Target level\n * @returns {number} Total XP required to reach that level\n */\nexport function getXPRequiredForLevel(level) {\n    if (level <= 1) return 0;\n    return Math.pow(level - 1, 2) * 100;\n}\n\n/**\n * Get current player level\n * @returns {number} Current level\n */\nexport function getPlayerLevel() {\n    const save = loadSave();\n    return calculateLevelFromXP(save.totalXP || 0);\n}\n\n/**\n * Get total XP earned\n * @returns {number} Total XP\n */\nexport function getTotalXP() {\n    const save = loadSave();\n    return save.totalXP || 0;\n}\n\n/**\n * Get XP required for next level\n * @returns {number} XP needed for next level\n */\nexport function getXPForNextLevel() {\n    const currentLevel = getPlayerLevel();\n    return getXPRequiredForLevel(currentLevel + 1);\n}\n\n/**\n * Get XP progress towards next level (0-1)\n * @returns {number} Progress percentage (0-1)\n */\nexport function getXPProgress() {\n    const totalXP = getTotalXP();\n    const currentLevel = calculateLevelFromXP(totalXP);\n    const currentLevelXP = getXPRequiredForLevel(currentLevel);\n    const nextLevelXP = getXPRequiredForLevel(currentLevel + 1);\n\n    if (nextLevelXP === currentLevelXP) return 1;\n    return (totalXP - currentLevelXP) / (nextLevelXP - currentLevelXP);\n}\n\n/**\n * Add XP to player and check for level ups\n * @param {number} amount - XP to add\n * @returns {Object} Result with newXP, newLevel, levelsGained\n */\nexport function addXP(amount) {\n    const save = loadSave();\n    const oldLevel = calculateLevelFromXP(save.totalXP || 0);\n\n    save.totalXP = (save.totalXP || 0) + amount;\n    const newLevel = calculateLevelFromXP(save.totalXP);\n\n    // Update stored level\n    save.playerLevel = newLevel;\n\n    saveGame(save);\n\n    return {\n        newXP: save.totalXP,\n        newLevel: newLevel,\n        levelsGained: newLevel - oldLevel,\n        oldLevel: oldLevel\n    };\n}\n\n/**\n * Calculate XP earned from a run\n * @param {Object} runStats - Run statistics\n * @returns {number} XP earned\n */\nexport function calculateRunXP(runStats) {\n    let xp = 0;\n\n    // Floors reached: 50 XP per floor\n    xp += (runStats.floorsReached || 0) * 50;\n\n    // Enemies killed: 2 XP each\n    xp += (runStats.enemiesKilled || 0) * 2;\n\n    // Bosses killed: 100 XP each\n    xp += (runStats.bossesKilled || 0) * 100;\n\n    // Run completion bonus (reached floor 5+): 200 XP\n    if ((runStats.floorsReached || 0) >= 5) {\n        xp += 200;\n    }\n\n    // Daily run completion bonus: 500 XP\n    if (runStats.isDailyRun) {\n        xp += 500;\n    }\n\n    return xp;\n}\n\n// ============ PORTRAIT SYSTEM ============\n\n/**\n * Get selected portrait ID\n * @returns {string} Portrait ID\n */\nexport function getSelectedPortrait() {\n    const save = loadSave();\n    return save.selectedPortrait || 'default';\n}\n\n/**\n * Set selected portrait\n * @param {string} portraitId - Portrait ID to select\n * @returns {boolean} True if successful\n * Note: Caller should verify portrait is unlocked before calling this\n */\nexport function setSelectedPortrait(portraitId) {\n    const save = loadSave();\n    save.selectedPortrait = portraitId;\n    saveGame(save);\n    return true;\n}\n\n/**\n * Check if a portrait is unlocked\n * @param {string} portraitId - Portrait ID to check\n * @returns {boolean} True if unlocked\n */\nexport function isPortraitUnlocked(portraitId) {\n    const save = loadSave();\n\n    // Default portrait is always unlocked\n    if (portraitId === 'default') return true;\n\n    // Check unlocks array\n    if (save.unlocks?.portraits?.includes(portraitId)) {\n        return true;\n    }\n\n    return false;\n}\n\n/**\n * Unlock a portrait\n * @param {string} portraitId - Portrait ID to unlock\n * @returns {boolean} True if newly unlocked\n */\nexport function unlockPortrait(portraitId) {\n    const save = loadSave();\n\n    if (!save.unlocks.portraits) {\n        save.unlocks.portraits = ['default'];\n    }\n\n    if (!save.unlocks.portraits.includes(portraitId)) {\n        save.unlocks.portraits.push(portraitId);\n        saveGame(save);\n        return true;\n    }\n\n    return false;\n}\n\n/**\n * Get all unlocked portraits\n * @returns {Array} Array of unlocked portrait IDs\n */\nexport function getUnlockedPortraits() {\n    const save = loadSave();\n    return save.unlocks?.portraits || ['default'];\n}\n\n","/**\n * Input System\n * Handles gamepad controllers (Backbone, Xbox, PlayStation, etc.) and touch controls\n *\n * Features:\n * - Gamepad support with dual analog sticks\n * - Virtual touch joysticks for mobile devices\n * - Left stick/joystick for movement\n * - Right stick/joystick for aiming and auto-fire\n */\n\n// Deadzone for analog sticks (ignore small movements)\nconst STICK_DEADZONE = 0.15;\n\n// Touch joystick configuration\nconst JOYSTICK_SIZE = 120;\nconst JOYSTICK_KNOB_SIZE = 50;\nconst JOYSTICK_OPACITY = 0.5;\nconst JOYSTICK_ACTIVE_OPACITY = 0.7;\n\n// Input state\nconst inputState = {\n    // Initialization flags (prevent duplicate setup)\n    systemInitialized: false,\n    touchInitialized: false,\n\n    // Gamepad state\n    gamepadConnected: false,\n    gamepadIndex: null,\n\n    // Movement (left stick or left touch joystick)\n    moveX: 0,\n    moveY: 0,\n\n    // Aim (right stick or right touch joystick)\n    aimX: 0,\n    aimY: 0,\n    aimActive: false, // True when right stick is being used\n\n    // Touch joystick state\n    touchEnabled: false,\n    leftTouch: null,  // Touch identifier for left joystick\n    rightTouch: null, // Touch identifier for right joystick\n    leftJoystickCenter: null,\n    rightJoystickCenter: null,\n\n    // UI elements (set by initTouchControls)\n    leftJoystickBase: null,\n    leftJoystickKnob: null,\n    rightJoystickBase: null,\n    rightJoystickKnob: null,\n\n    // Kaplay instance\n    k: null\n};\n\n/**\n * Apply deadzone to a value\n */\nfunction applyDeadzone(value, deadzone = STICK_DEADZONE) {\n    if (Math.abs(value) < deadzone) return 0;\n    // Scale the value to go from 0 at deadzone edge to 1 at full tilt\n    const sign = value > 0 ? 1 : -1;\n    return sign * (Math.abs(value) - deadzone) / (1 - deadzone);\n}\n\n/**\n * Initialize the input system\n * @param {Object} k - Kaplay instance\n */\nexport function initInputSystem(k) {\n    inputState.k = k;\n\n    // Prevent duplicate initialization of event listeners\n    if (inputState.systemInitialized) {\n        return;\n    }\n    inputState.systemInitialized = true;\n\n    // Listen for gamepad connections\n    window.addEventListener('gamepadconnected', (e) => {\n        console.log('[InputSystem] Gamepad connected:', e.gamepad.id);\n        inputState.gamepadConnected = true;\n        inputState.gamepadIndex = e.gamepad.index;\n    });\n\n    window.addEventListener('gamepaddisconnected', (e) => {\n        console.log('[InputSystem] Gamepad disconnected:', e.gamepad.id);\n        if (e.gamepad.index === inputState.gamepadIndex) {\n            inputState.gamepadConnected = false;\n            inputState.gamepadIndex = null;\n        }\n    });\n\n    // Check for already connected gamepads\n    const gamepads = navigator.getGamepads();\n    for (let i = 0; i < gamepads.length; i++) {\n        if (gamepads[i]) {\n            console.log('[InputSystem] Found existing gamepad:', gamepads[i].id);\n            inputState.gamepadConnected = true;\n            inputState.gamepadIndex = gamepads[i].index;\n            break;\n        }\n    }\n\n    // Detect touch device\n    inputState.touchEnabled = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n    console.log('[InputSystem] Initialized. Gamepad:', inputState.gamepadConnected, 'Touch:', inputState.touchEnabled);\n}\n\n/**\n * Update gamepad input state (call each frame)\n */\nexport function updateGamepadInput() {\n    if (!inputState.gamepadConnected || inputState.gamepadIndex === null) {\n        return;\n    }\n\n    const gamepads = navigator.getGamepads();\n    const gamepad = gamepads[inputState.gamepadIndex];\n\n    if (!gamepad) {\n        inputState.gamepadConnected = false;\n        inputState.gamepadIndex = null;\n        return;\n    }\n\n    // Standard gamepad mapping:\n    // axes[0] = Left stick X (-1 left, 1 right)\n    // axes[1] = Left stick Y (-1 up, 1 down)\n    // axes[2] = Right stick X (-1 left, 1 right)\n    // axes[3] = Right stick Y (-1 up, 1 down)\n\n    // Left stick - movement\n    inputState.moveX = applyDeadzone(gamepad.axes[0] || 0);\n    inputState.moveY = applyDeadzone(gamepad.axes[1] || 0);\n\n    // Right stick - aiming\n    const rawAimX = applyDeadzone(gamepad.axes[2] || 0);\n    const rawAimY = applyDeadzone(gamepad.axes[3] || 0);\n\n    inputState.aimX = rawAimX;\n    inputState.aimY = rawAimY;\n\n    // Aim is active if right stick is being used\n    inputState.aimActive = Math.abs(rawAimX) > 0 || Math.abs(rawAimY) > 0;\n}\n\n/**\n * Initialize touch controls with virtual joysticks\n * @param {Object} k - Kaplay instance\n */\nexport function initTouchControls(k) {\n    if (!inputState.touchEnabled) return;\n\n    // Clean up existing joysticks first (in case of scene reload)\n    cleanupTouchJoysticks();\n\n    // Prevent duplicate touch event listeners\n    if (inputState.touchInitialized) {\n        // Just recreate the visual elements, don't re-add event listeners\n        createJoystickVisuals(k);\n        return;\n    }\n    inputState.touchInitialized = true;\n\n    createJoystickVisuals(k);\n\n    // Touch event handlers (only added once)\n    const canvas = k.canvas;\n\n    canvas.addEventListener('touchstart', handleTouchStart, { passive: false });\n    canvas.addEventListener('touchmove', handleTouchMove, { passive: false });\n    canvas.addEventListener('touchend', handleTouchEnd, { passive: false });\n    canvas.addEventListener('touchcancel', handleTouchEnd, { passive: false });\n\n    console.log('[InputSystem] Touch controls initialized');\n}\n\n/**\n * Create joystick visual elements\n * @param {Object} k - Kaplay instance\n */\nfunction createJoystickVisuals(k) {\n    const screenWidth = k.width();\n    const screenHeight = k.height();\n\n    // Left joystick (bottom left quarter of screen)\n    const leftCenterX = screenWidth * 0.15;\n    const leftCenterY = screenHeight * 0.75;\n\n    // Right joystick (bottom right quarter of screen)\n    const rightCenterX = screenWidth * 0.85;\n    const rightCenterY = screenHeight * 0.75;\n\n    // Create left joystick base\n    inputState.leftJoystickBase = k.add([\n        k.circle(JOYSTICK_SIZE / 2),\n        k.pos(leftCenterX, leftCenterY),\n        k.anchor('center'),\n        k.color(100, 100, 100),\n        k.opacity(JOYSTICK_OPACITY),\n        k.fixed(),\n        k.z(1000),\n        'touchJoystick'\n    ]);\n\n    // Create left joystick knob\n    inputState.leftJoystickKnob = k.add([\n        k.circle(JOYSTICK_KNOB_SIZE / 2),\n        k.pos(leftCenterX, leftCenterY),\n        k.anchor('center'),\n        k.color(200, 200, 200),\n        k.opacity(JOYSTICK_OPACITY),\n        k.fixed(),\n        k.z(1001),\n        'touchJoystick'\n    ]);\n\n    // Create right joystick base\n    inputState.rightJoystickBase = k.add([\n        k.circle(JOYSTICK_SIZE / 2),\n        k.pos(rightCenterX, rightCenterY),\n        k.anchor('center'),\n        k.color(100, 100, 100),\n        k.opacity(JOYSTICK_OPACITY),\n        k.fixed(),\n        k.z(1000),\n        'touchJoystick'\n    ]);\n\n    // Create right joystick knob\n    inputState.rightJoystickKnob = k.add([\n        k.circle(JOYSTICK_KNOB_SIZE / 2),\n        k.pos(rightCenterX, rightCenterY),\n        k.anchor('center'),\n        k.color(255, 100, 100),\n        k.opacity(JOYSTICK_OPACITY),\n        k.fixed(),\n        k.z(1001),\n        'touchJoystick'\n    ]);\n\n    inputState.leftJoystickCenter = { x: leftCenterX, y: leftCenterY };\n    inputState.rightJoystickCenter = { x: rightCenterX, y: rightCenterY };\n}\n\n/**\n * Handle touch start\n */\nfunction handleTouchStart(e) {\n    e.preventDefault();\n\n    const k = inputState.k;\n    const rect = k.canvas.getBoundingClientRect();\n    const scaleX = k.width() / rect.width;\n    const scaleY = k.height() / rect.height;\n\n    for (const touch of e.changedTouches) {\n        const x = (touch.clientX - rect.left) * scaleX;\n        const y = (touch.clientY - rect.top) * scaleY;\n\n        // Check if touch is on left side (movement joystick)\n        if (x < k.width() / 2 && inputState.leftTouch === null) {\n            inputState.leftTouch = touch.identifier;\n            inputState.leftJoystickCenter = { x, y };\n\n            // Move joystick base to touch position\n            if (inputState.leftJoystickBase) {\n                inputState.leftJoystickBase.pos.x = x;\n                inputState.leftJoystickBase.pos.y = y;\n                inputState.leftJoystickBase.opacity = JOYSTICK_ACTIVE_OPACITY;\n            }\n            if (inputState.leftJoystickKnob) {\n                inputState.leftJoystickKnob.pos.x = x;\n                inputState.leftJoystickKnob.pos.y = y;\n                inputState.leftJoystickKnob.opacity = JOYSTICK_ACTIVE_OPACITY;\n            }\n        }\n        // Check if touch is on right side (aim joystick)\n        else if (x >= k.width() / 2 && inputState.rightTouch === null) {\n            inputState.rightTouch = touch.identifier;\n            inputState.rightJoystickCenter = { x, y };\n\n            // Move joystick base to touch position\n            if (inputState.rightJoystickBase) {\n                inputState.rightJoystickBase.pos.x = x;\n                inputState.rightJoystickBase.pos.y = y;\n                inputState.rightJoystickBase.opacity = JOYSTICK_ACTIVE_OPACITY;\n            }\n            if (inputState.rightJoystickKnob) {\n                inputState.rightJoystickKnob.pos.x = x;\n                inputState.rightJoystickKnob.pos.y = y;\n                inputState.rightJoystickKnob.opacity = JOYSTICK_ACTIVE_OPACITY;\n            }\n\n            inputState.aimActive = true;\n        }\n    }\n}\n\n/**\n * Handle touch move\n */\nfunction handleTouchMove(e) {\n    e.preventDefault();\n\n    const k = inputState.k;\n    const rect = k.canvas.getBoundingClientRect();\n    const scaleX = k.width() / rect.width;\n    const scaleY = k.height() / rect.height;\n\n    for (const touch of e.changedTouches) {\n        const x = (touch.clientX - rect.left) * scaleX;\n        const y = (touch.clientY - rect.top) * scaleY;\n\n        // Left joystick (movement)\n        if (touch.identifier === inputState.leftTouch && inputState.leftJoystickCenter) {\n            const dx = x - inputState.leftJoystickCenter.x;\n            const dy = y - inputState.leftJoystickCenter.y;\n            const distance = Math.sqrt(dx * dx + dy * dy);\n            const maxDistance = JOYSTICK_SIZE / 2;\n\n            // Clamp to joystick radius\n            const clampedDistance = Math.min(distance, maxDistance);\n            const angle = Math.atan2(dy, dx);\n\n            // Update knob position\n            if (inputState.leftJoystickKnob) {\n                inputState.leftJoystickKnob.pos.x = inputState.leftJoystickCenter.x + Math.cos(angle) * clampedDistance;\n                inputState.leftJoystickKnob.pos.y = inputState.leftJoystickCenter.y + Math.sin(angle) * clampedDistance;\n            }\n\n            // Calculate normalized movement (-1 to 1)\n            const normalizedDistance = clampedDistance / maxDistance;\n            inputState.moveX = Math.cos(angle) * normalizedDistance;\n            inputState.moveY = Math.sin(angle) * normalizedDistance;\n        }\n\n        // Right joystick (aim)\n        if (touch.identifier === inputState.rightTouch && inputState.rightJoystickCenter) {\n            const dx = x - inputState.rightJoystickCenter.x;\n            const dy = y - inputState.rightJoystickCenter.y;\n            const distance = Math.sqrt(dx * dx + dy * dy);\n            const maxDistance = JOYSTICK_SIZE / 2;\n\n            // Clamp to joystick radius\n            const clampedDistance = Math.min(distance, maxDistance);\n            const angle = Math.atan2(dy, dx);\n\n            // Update knob position\n            if (inputState.rightJoystickKnob) {\n                inputState.rightJoystickKnob.pos.x = inputState.rightJoystickCenter.x + Math.cos(angle) * clampedDistance;\n                inputState.rightJoystickKnob.pos.y = inputState.rightJoystickCenter.y + Math.sin(angle) * clampedDistance;\n            }\n\n            // Calculate normalized aim (-1 to 1)\n            const normalizedDistance = clampedDistance / maxDistance;\n            inputState.aimX = Math.cos(angle) * normalizedDistance;\n            inputState.aimY = Math.sin(angle) * normalizedDistance;\n            inputState.aimActive = normalizedDistance > 0.1;\n        }\n    }\n}\n\n/**\n * Handle touch end\n */\nfunction handleTouchEnd(e) {\n    e.preventDefault();\n\n    for (const touch of e.changedTouches) {\n        // Left joystick released\n        if (touch.identifier === inputState.leftTouch) {\n            inputState.leftTouch = null;\n            inputState.moveX = 0;\n            inputState.moveY = 0;\n\n            // Reset knob to center\n            if (inputState.leftJoystickKnob && inputState.leftJoystickCenter) {\n                inputState.leftJoystickKnob.pos.x = inputState.leftJoystickCenter.x;\n                inputState.leftJoystickKnob.pos.y = inputState.leftJoystickCenter.y;\n            }\n            if (inputState.leftJoystickBase) {\n                inputState.leftJoystickBase.opacity = JOYSTICK_OPACITY;\n            }\n            if (inputState.leftJoystickKnob) {\n                inputState.leftJoystickKnob.opacity = JOYSTICK_OPACITY;\n            }\n        }\n\n        // Right joystick released\n        if (touch.identifier === inputState.rightTouch) {\n            inputState.rightTouch = null;\n            inputState.aimX = 0;\n            inputState.aimY = 0;\n            inputState.aimActive = false;\n\n            // Reset knob to center\n            if (inputState.rightJoystickKnob && inputState.rightJoystickCenter) {\n                inputState.rightJoystickKnob.pos.x = inputState.rightJoystickCenter.x;\n                inputState.rightJoystickKnob.pos.y = inputState.rightJoystickCenter.y;\n            }\n            if (inputState.rightJoystickBase) {\n                inputState.rightJoystickBase.opacity = JOYSTICK_OPACITY;\n            }\n            if (inputState.rightJoystickKnob) {\n                inputState.rightJoystickKnob.opacity = JOYSTICK_OPACITY;\n            }\n        }\n    }\n}\n\n/**\n * Get movement input (from gamepad or touch)\n * @returns {{ x: number, y: number }} Movement direction (-1 to 1)\n */\nexport function getMovementInput() {\n    return {\n        x: inputState.moveX,\n        y: inputState.moveY\n    };\n}\n\n/**\n * Get aim input (from gamepad or touch)\n * @returns {{ x: number, y: number, active: boolean }} Aim direction (-1 to 1) and whether aim is active\n */\nexport function getAimInput() {\n    return {\n        x: inputState.aimX,\n        y: inputState.aimY,\n        active: inputState.aimActive\n    };\n}\n\n/**\n * Check if gamepad is connected\n * @returns {boolean}\n */\nexport function isGamepadConnected() {\n    return inputState.gamepadConnected;\n}\n\n/**\n * Check if touch controls are enabled\n * @returns {boolean}\n */\nexport function isTouchEnabled() {\n    return inputState.touchEnabled;\n}\n\n/**\n * Check if any alternative input is being used (gamepad or touch)\n * @returns {boolean}\n */\nexport function isUsingAlternativeInput() {\n    return inputState.gamepadConnected ||\n           inputState.leftTouch !== null ||\n           inputState.rightTouch !== null;\n}\n\n/**\n * Hide touch joysticks (e.g., when not in game)\n */\nexport function hideTouchJoysticks() {\n    if (inputState.leftJoystickBase) inputState.leftJoystickBase.hidden = true;\n    if (inputState.leftJoystickKnob) inputState.leftJoystickKnob.hidden = true;\n    if (inputState.rightJoystickBase) inputState.rightJoystickBase.hidden = true;\n    if (inputState.rightJoystickKnob) inputState.rightJoystickKnob.hidden = true;\n}\n\n/**\n * Show touch joysticks\n */\nexport function showTouchJoysticks() {\n    if (inputState.leftJoystickBase) inputState.leftJoystickBase.hidden = false;\n    if (inputState.leftJoystickKnob) inputState.leftJoystickKnob.hidden = false;\n    if (inputState.rightJoystickBase) inputState.rightJoystickBase.hidden = false;\n    if (inputState.rightJoystickKnob) inputState.rightJoystickKnob.hidden = false;\n}\n\n/**\n * Clean up touch joystick visuals (call when leaving game scene)\n * Note: Does not remove event listeners as they persist across scenes\n */\nexport function cleanupTouchJoysticks() {\n    const k = inputState.k;\n    if (!k) return;\n\n    // Destroy joystick entities if they exist\n    try {\n        k.get('touchJoystick').forEach(j => {\n            if (j && j.exists()) k.destroy(j);\n        });\n    } catch (e) {\n        // Ignore errors if entities are already destroyed\n    }\n\n    inputState.leftJoystickBase = null;\n    inputState.leftJoystickKnob = null;\n    inputState.rightJoystickBase = null;\n    inputState.rightJoystickKnob = null;\n    inputState.leftTouch = null;\n    inputState.rightTouch = null;\n    inputState.moveX = 0;\n    inputState.moveY = 0;\n    inputState.aimX = 0;\n    inputState.aimY = 0;\n    inputState.aimActive = false;\n}\n","// Weapon definitions - defines all weapon types and their properties\n\nexport const WEAPON_DEFINITIONS = {\n    pistol: {\n        name: 'Basic Pistol',\n        icon: '', // Gun icon\n        char: '', // Bullet point\n        color: [255, 255, 255],\n        fireRate: 3.75, // Shots per second (2.5x multiplier)\n        projectileSpeed: 300,\n        baseDamage: 10,\n        projectileCount: 1,\n        spreadAngle: 0, // No spread\n        piercing: 0,\n        obstaclePiercing: 0,\n        critChance: 0.05, // 5% base crit chance\n        critDamage: 2.0, // 200% damage\n        range: 600, // Medium range\n        category: 'balanced', // balanced, rapid, spread, precision, area\n        upgradeCategories: ['damage', 'fireRate', 'multiShot', 'piercing', 'crit'] // Available upgrade types\n    },\n    smg: {\n        name: 'Rapid Fire SMG',\n        icon: '', // Rapid fire icon\n        char: '', // Box drawing vertical\n        color: [100, 200, 255],\n        fireRate: 7.5, // Shots per second (2.5x multiplier)\n        projectileSpeed: 350,\n        baseDamage: 6,\n        projectileCount: 1,\n        spreadAngle: 0,\n        piercing: 0,\n        obstaclePiercing: 0,\n        critChance: 0.05,\n        critDamage: 2.0,\n        range: 700, // Medium-long range\n        category: 'rapid',\n        upgradeCategories: ['damage', 'fireRate', 'multiShot', 'piercing', 'crit'] // Removed 'speed' (passive upgrade)\n    },\n    shotgun: {\n        name: 'Spread Shotgun',\n        icon: '', // Spread pattern icon\n        char: '', // White bullet\n        color: [255, 200, 100],\n        fireRate: 2.0, // Shots per second (2.5x multiplier)\n        projectileSpeed: 250,\n        baseDamage: 8, // Per pellet\n        projectileCount: 3, // 3-5 pellets\n        spreadAngle: 35, // Degrees\n        piercing: 0,\n        obstaclePiercing: 0,\n        critChance: 0.05,\n        critDamage: 2.0,\n        range: 400, // Short-medium range\n        category: 'spread',\n        upgradeCategories: ['damage', 'pelletCount', 'spread', 'fireRate', 'crit']\n    },\n    sniper: {\n        name: 'Sniper Rifle',\n        icon: '', // Long barrel icon\n        char: '', // Arrow\n        color: [100, 255, 255],\n        fireRate: 1.0, // Very slow (2.5x multiplier)\n        projectileSpeed: 500, // Very fast\n        baseDamage: 20, // Very high\n        projectileCount: 1,\n        spreadAngle: 0,\n        piercing: 1, // Passes through 1 enemy\n        obstaclePiercing: 0,\n        critChance: 0.05,\n        critDamage: 2.5, // Higher crit damage\n        range: 900, // Long range\n        category: 'precision',\n        upgradeCategories: ['damage', 'piercing', 'crit', 'fireRate', 'range']\n    },\n    flamethrower: {\n        name: 'Flame Thrower',\n        icon: '', // Flame wave icon\n        char: '', // Double line\n        color: [255, 150, 50],\n        fireRate: 12.5, // Continuous fire (ticks per second) (2.5x multiplier)\n        projectileSpeed: 200,\n        baseDamage: 8, // Per tick\n        projectileCount: 1,\n        spreadAngle: 15, // Small spread\n        piercing: 0,\n        obstaclePiercing: 0,\n        critChance: 0.05,\n        critDamage: 2.0,\n        range: 150, // Short range\n        category: 'area',\n        upgradeCategories: ['damage', 'fireRate', 'range', 'spread', 'dot'] // DoT upgrades\n    },\n    orbital: {\n        name: 'Orbital Weapons',\n        icon: '', // Orbital icon\n        char: '', // White circle\n        color: [100, 200, 255],\n        fireRate: 0, // No firing - passive orbs\n        projectileSpeed: 0,\n        baseDamage: 12, // Per contact\n        projectileCount: 1, // Starting orbs\n        spreadAngle: 0,\n        piercing: 0,\n        obstaclePiercing: 0,\n        critChance: 0,\n        critDamage: 1.0,\n        range: 0,\n        orbitRadius: 45, // Distance from player\n        rotationSpeed: 180, // Degrees per second\n        category: 'passive',\n        upgradeCategories: ['orbitalCount', 'orbitalSpeed', 'orbitalRadius', 'damage'] // Orbital-specific upgrades\n    },\n    explosive: {\n        name: 'Explosive Launcher',\n        icon: '', // Explosion icon\n        char: '', // Black circle\n        color: [255, 100, 50],\n        fireRate: 1.5, // Slow fire rate (2.5x multiplier)\n        projectileSpeed: 200, // Slow, visible\n        baseDamage: 25, // Base explosion damage\n        projectileCount: 1,\n        spreadAngle: 0,\n        piercing: 0,\n        obstaclePiercing: 0,\n        critChance: 0.05,\n        critDamage: 2.0,\n        range: 500, // Medium range\n        explosionRadius: 50, // Area damage radius\n        explosionDamage: 15, // Area damage\n        category: 'area',\n        upgradeCategories: ['damage', 'explosionRadius', 'explosionDamage', 'fireRate', 'range']\n    },\n    chainLightning: {\n        name: 'Chain Lightning',\n        icon: '', // Lightning icon\n        char: '', // Lightning bolt\n        color: [255, 255, 100],\n        fireRate: 3.0, // Shots per second (2.5x multiplier)\n        projectileSpeed: 400, // Fast\n        baseDamage: 12, // Base damage\n        projectileCount: 1,\n        spreadAngle: 0,\n        piercing: 0,\n        obstaclePiercing: 0,\n        critChance: 0.05,\n        critDamage: 2.0,\n        range: 600, // Medium range\n        chainRange: 70, // Distance between chain jumps\n        maxJumps: 3, // Starting chain jumps\n        chainDamageReduction: 0.15, // -15% damage per jump\n        category: 'multiTarget',\n        upgradeCategories: ['damage', 'chainJumps', 'chainRange', 'fireRate', 'chainDamage']\n    },\n    boomerang: {\n        name: 'Boomerang Blaster',\n        icon: '', // Circular arrow\n        char: '', // Clockwise arrow\n        color: [100, 255, 200],\n        fireRate: 2.0, // Shots per second\n        projectileSpeed: 250,\n        baseDamage: 14, // Higher base damage since hits twice\n        projectileCount: 1,\n        spreadAngle: 0,\n        piercing: 0, // No pierce, but returns to hit again\n        obstaclePiercing: 0,\n        critChance: 0.05,\n        critDamage: 2.0,\n        range: 400, // Medium range - travels out and back\n        returnsToPlayer: true, // Projectiles return, hitting enemies twice\n        returnSpeedMultiplier: 1.2, // Returns faster\n        category: 'multiTarget',\n        upgradeCategories: ['damage', 'fireRate', 'range', 'crit', 'projectileSpeed']\n    },\n    railgun: {\n        name: 'Railgun',\n        icon: '', // Double horizontal line\n        char: '', // Rail\n        color: [150, 200, 255],\n        fireRate: 0.33, // 3 second cooldown (very slow)\n        projectileSpeed: 800, // Very fast\n        baseDamage: 50, // Very high damage\n        projectileCount: 1,\n        spreadAngle: 0,\n        piercing: 999, // Effectively infinite - pierces ALL enemies\n        obstaclePiercing: 1, // Can pierce one obstacle\n        critChance: 0.1, // Higher crit chance\n        critDamage: 3.0, // Higher crit damage\n        range: 1000, // Very long range\n        infinitePierce: true, // Special flag for railgun\n        category: 'precision',\n        upgradeCategories: ['damage', 'crit', 'critDamage', 'fireRate', 'obstaclePiercing']\n    },\n    spreadShot: {\n        name: 'Spread Shot',\n        icon: '', // Trident-like spread\n        char: '', // Small bullet\n        color: [255, 180, 100],\n        fireRate: 2.5, // Moderate fire rate\n        projectileSpeed: 280,\n        baseDamage: 6, // Lower per projectile\n        projectileCount: 3, // 3 projectiles in cone\n        spreadAngle: 25, // Cone spread\n        piercing: 0,\n        obstaclePiercing: 0,\n        critChance: 0.05,\n        critDamage: 2.0,\n        range: 450, // Medium range\n        category: 'spread',\n        upgradeCategories: ['damage', 'pelletCount', 'spread', 'fireRate', 'crit']\n    },\n    homingMissiles: {\n        name: 'Homing Missiles',\n        icon: '', // Triangle pointing right\n        char: '', // Small triangle\n        color: [255, 100, 150],\n        fireRate: 1.5, // Slow fire rate\n        projectileSpeed: 180, // Slower but tracks\n        baseDamage: 18, // High damage per hit\n        projectileCount: 1,\n        spreadAngle: 0,\n        piercing: 0,\n        obstaclePiercing: 0,\n        critChance: 0.05,\n        critDamage: 2.0,\n        range: 700, // Long range\n        homing: true, // Tracks nearest enemy\n        homingStrength: 3.0, // Turn rate multiplier\n        category: 'precision',\n        upgradeCategories: ['damage', 'fireRate', 'range', 'crit', 'projectileSpeed']\n    },\n    plasmaRifle: {\n        name: 'Plasma Rifle',\n        icon: '', // Circled plus\n        char: '', // Diamond\n        color: [100, 255, 200],\n        fireRate: 2.0, // Moderate fire rate\n        projectileSpeed: 350,\n        baseDamage: 16, // High damage\n        projectileCount: 1,\n        spreadAngle: 0,\n        piercing: 2, // Penetrates 2 enemies\n        obstaclePiercing: 0,\n        critChance: 0.08, // Slightly higher crit\n        critDamage: 2.2,\n        range: 650, // Medium-long range\n        category: 'precision',\n        upgradeCategories: ['damage', 'piercing', 'crit', 'fireRate', 'range']\n    }\n};\n\n// Get weapon definition by key\nexport function getWeaponDefinition(weaponKey) {\n    return WEAPON_DEFINITIONS[weaponKey] || WEAPON_DEFINITIONS.pistol;\n}\n\n// Get all weapons in a category\nexport function getWeaponsByCategory(category) {\n    return Object.entries(WEAPON_DEFINITIONS)\n        .filter(([key, weapon]) => weapon.category === category)\n        .map(([key, weapon]) => ({ key, ...weapon }));\n}\n\n// Check if upgrade category is valid for weapon\nexport function isUpgradeValidForWeapon(weaponKey, upgradeCategory) {\n    const weapon = getWeaponDefinition(weaponKey);\n    return weapon.upgradeCategories.includes(upgradeCategory);\n}\n\n","/**\n * Game Constants & Configuration\n *\n * Centralized configuration for all game values.\n * This makes balancing easier and prepares for multiplayer where\n * constants may need to be synchronized across clients.\n */\n\n// =============================================================================\n// GAME WINDOW & RENDERING\n// =============================================================================\n\nexport const GAME_CONFIG = {\n    // Canvas dimensions\n    CANVAS_WIDTH: 800,\n    CANVAS_HEIGHT: 600,\n    CANVAS_SCALE: 1,\n\n    // Background\n    BACKGROUND_COLOR: [0, 0, 0],\n\n    // Debug mode\n    DEBUG_MODE: false,\n};\n\n// =============================================================================\n// PLAYER BASE STATS\n// =============================================================================\n\nexport const PLAYER_CONFIG = {\n    // Collision & physics\n    COLLISION_SIZE: 12, // Approximate player hitbox radius\n\n    // Pickup system\n    BASE_PICKUP_RADIUS: 30, // Base pickup radius in pixels\n\n    // Immunity frames (i-frames after taking damage)\n    INVULNERABILITY_DURATION: 1.0, // Seconds of immunity after hit\n    IMMUNITY_FLASH_RATE: 10, // Flashes per second during immunity\n\n    // Visual feedback\n    NORMAL_COLOR: [100, 150, 255],\n    HIT_COLOR: [255, 100, 100],\n    IMMUNITY_ALPHA: 0.3, // Transparency during flash\n\n    // Movement boundaries\n    ROOM_MARGIN: 20, // Distance from edge of screen\n};\n\n// =============================================================================\n// PROGRESSION SYSTEM\n// =============================================================================\n\nexport const PROGRESSION_CONFIG = {\n    // XP & Leveling (flattened curve: higher early, lower scaling)\n    BASE_XP_TO_NEXT_LEVEL: 15,\n    XP_SCALING_FACTOR: 1.25, // Multiplier per level for XP requirements\n\n    // Starting stats\n    STARTING_LEVEL: 1,\n    STARTING_XP: 0,\n\n    // Level up notification\n    LEVEL_UP_NOTIFICATION_Y: 100, // Y position of level up text\n    LEVEL_UP_NOTIFICATION_DURATION: 0.5, // Seconds before showing upgrade draft\n};\n\n// =============================================================================\n// CHARACTER ABILITIES (Multipliers & Bonuses)\n// =============================================================================\n\nexport const CHARACTER_ABILITIES = {\n    // The Survivor\n    SURVIVOR_XP_BOOST: 1.1, // +10% XP gain\n\n    // The Scout\n    SCOUT_SPEED_BOOST: 1.2, // +20% speed\n    SCOUT_DODGE_CHANCE: 0.1, // 10% dodge chance\n\n    // The Tank\n    TANK_HEALTH_BOOST: 1.25, // +25% health\n    TANK_DAMAGE_REDUCTION: 0.15, // 15% damage reduction\n\n    // The Sniper\n    SNIPER_CRIT_CHANCE_MULTIPLIER: 1.5, // +50% to base crit chance\n    SNIPER_CRIT_DAMAGE_MULTIPLIER: 1.25, // +25% to crit damage\n\n    // The Pyro\n    PYRO_FIRE_DOT_MULTIPLIER: 1.25, // +25% fire DoT damage\n};\n\n// =============================================================================\n// COMBAT SYSTEM\n// =============================================================================\n\nexport const COMBAT_CONFIG = {\n    // Damage\n    MIN_DAMAGE: 1, // Minimum damage that can be dealt\n\n    // Knockback distances\n    KNOCKBACK_ENEMY: 20, // Regular enemy knockback\n    KNOCKBACK_ENEMY_FROM_PROJECTILE: 15, // Enemy hit by projectile\n    KNOCKBACK_MINIBOSS: 25, // Miniboss knockback\n    KNOCKBACK_BOSS: 10, // Boss knockback (heavier)\n    KNOCKBACK_BOSS_FROM_PROJECTILE: 10, // Boss hit by projectile\n\n    // Base enemy damage values\n    BASE_ENEMY_DAMAGE: 10,\n    BASE_MINIBOSS_DAMAGE: 15,\n    BASE_BOSS_DAMAGE: 18,\n\n    // Enemy scaling per floor\n    ENEMY_HP_SCALING_PER_FLOOR: 0.3, // +30% HP per floor\n    ENEMY_DAMAGE_SCALING_PER_FLOOR: 0.15, // +15% damage per floor (new)\n    ENEMY_SPEED_SCALING_PER_FLOOR: 0.1, // +10% speed per floor\n\n    // Boss enrage multiplier\n    BOSS_ENRAGE_DAMAGE_MULTIPLIER: 1.25, // +25% damage when enraged\n\n    // Multi-shot delays\n    MULTISHOT_STAGGER_DELAY: 0.02, // Delay between projectiles in multi-shot\n\n    // Visual feedback durations\n    HIT_FLASH_DURATION: 0.1, // How long hit flash lasts\n    EXPLOSION_VISUAL_DURATION: 0.2, // How long explosion effect shows\n    CHAIN_VISUAL_DURATION: 0.1, // How long chain lightning visual shows\n\n    // Critical hit visuals\n    CRIT_COLOR: [255, 200, 0], // Gold color for crits\n    HIT_COLOR: [255, 255, 255], // White color for normal hits\n};\n\n// =============================================================================\n// WEAPON SYSTEMS (for special weapon types)\n// =============================================================================\n\nexport const WEAPON_CONFIG = {\n    // Orbital weapons\n    ORBITAL_CONTACT_COOLDOWN: 0.2, // Seconds between orbital hits on same enemy\n    BASE_ORBIT_RADIUS: 45, // Distance from player\n    BASE_ROTATION_SPEED: 180, // Degrees per second\n\n    // Explosive weapons\n    BASE_EXPLOSION_RADIUS: 50, // Area damage radius\n    BASE_EXPLOSION_DAMAGE: 15, // Area damage amount\n\n    // Chain lightning\n    BASE_CHAIN_RANGE: 70, // Distance between chain jumps\n    BASE_CHAIN_JUMPS: 3, // Number of times it can chain\n    BASE_CHAIN_DAMAGE_REDUCTION: 0.15, // 15% damage reduction per jump\n    CHAIN_COLLISION_DELAY: 0.01, // Small delay for collision detection\n\n    // Range fallback\n    DEFAULT_WEAPON_RANGE: 750, // Default projectile range if not specified\n};\n\n// =============================================================================\n// MULTIPLAYER (Future - Placeholder)\n// =============================================================================\n\nexport const MULTIPLAYER_CONFIG = {\n    // Player limits\n    MIN_PLAYERS: 1,\n    MAX_PLAYERS: 4,\n\n    // Default mode\n    DEFAULT_MODE: 'singleplayer', // 'singleplayer' | 'coop'\n\n    // Network (future)\n    TICK_RATE: 60, // Server tick rate\n    CLIENT_PREDICTION: true, // Enable client-side prediction\n    INTERPOLATION_DELAY: 100, // Milliseconds of interpolation buffer\n};\n\n// =============================================================================\n// PICKUPS & LOOT\n// =============================================================================\n\nexport const PICKUP_CONFIG = {\n    // XP Pickups\n    XP_LIFETIME: 10, // Seconds before XP despawns\n    XP_PULSE_SPEED: 5, // Speed of pulse animation\n    XP_PULSE_AMOUNT: 0.2, // Amount of pulse scaling (0.2 = 20% scale change)\n    XP_COLOR: [100, 200, 255], // Light blue\n\n    // Currency Pickups\n    CURRENCY_LIFETIME: 15, // Seconds before currency despawns (longer than XP)\n    CURRENCY_PULSE_SPEED: 4, // Speed of pulse animation\n    CURRENCY_PULSE_AMOUNT: 0.15, // Amount of pulse scaling\n    CURRENCY_COLOR: [255, 215, 0], // Gold\n\n    // Magnetization\n    MAGNETIZE_SPEED: 800, // Max speed at which pickups move toward player when magnetized (pixels/second)\n    MAGNETIZE_ACCELERATION: 600, // Acceleration of magnetized pickups (pixels/second)\n    COLLECTION_RADIUS: 20, // Distance at which pickups are automatically collected\n};\n\n// =============================================================================\n// PERFORMANCE & OPTIMIZATION\n// =============================================================================\n\nexport const PERFORMANCE_CONFIG = {\n    // Object pooling (future)\n    PROJECTILE_POOL_SIZE: 100,\n    PARTICLE_POOL_SIZE: 200,\n\n    // Spatial partitioning (future)\n    GRID_CELL_SIZE: 100, // Size of spatial grid cells\n\n    // Max entities (safety limits)\n    MAX_PROJECTILES: 500,\n    MAX_ENEMIES: 300, // Increased for 3x enemy count\n    MAX_PICKUPS: 600, // Increased for 3x pickups\n};\n\n// =============================================================================\n// HELPER FUNCTIONS\n// =============================================================================\n\n/**\n * Get XP required for next level\n * @param {number} currentLevel - Current player level\n * @returns {number} XP required to reach next level\n */\nexport function getXPForNextLevel(currentLevel) {\n    return Math.floor(\n        PROGRESSION_CONFIG.BASE_XP_TO_NEXT_LEVEL *\n        Math.pow(PROGRESSION_CONFIG.XP_SCALING_FACTOR, currentLevel - 1)\n    );\n}\n\n/**\n * Calculate damage after defense reduction\n * @param {number} baseDamage - Base damage before reduction\n * @param {number} defense - Flat defense reduction\n * @param {number} damageReduction - Percentage damage reduction (0-1)\n * @returns {number} Final damage (minimum 1)\n */\nexport function calculateDamageAfterDefense(baseDamage, defense = 0, damageReduction = 0) {\n    const afterReduction = baseDamage * (1 - damageReduction);\n    return Math.max(COMBAT_CONFIG.MIN_DAMAGE, afterReduction - defense);\n}\n\n/**\n * Check if an attack is a critical hit\n * @param {number} critChance - Critical hit chance (0-1)\n * @param {Object} rng - Optional seeded RNG for multiplayer consistency\n * @returns {boolean} Whether the attack is a crit\n */\nexport function rollCriticalHit(critChance, rng = null) {\n    const roll = rng ? rng.next() : Math.random();\n    return roll < critChance;\n}\n\n/**\n * Calculate critical hit damage\n * @param {number} baseDamage - Base damage\n * @param {number} critMultiplier - Critical damage multiplier (default 2.0 = 200%)\n * @returns {number} Critical damage\n */\nexport function calculateCriticalDamage(baseDamage, critMultiplier = 2.0) {\n    return Math.floor(baseDamage * critMultiplier);\n}\n","/**\n * Player Entity\n *\n * Creates and manages the player character including:\n * - Character selection and stats\n * - Health and death handling\n * - Progression (level, XP)\n * - Upgrades and abilities\n * - Invulnerability frames\n * - Character-specific abilities (dodge, XP boost, etc.)\n */\n\n// System imports\nimport { getSelectedCharacter, getPermanentUpgradeLevel } from '../systems/metaProgression.js';\nimport { getMovementInput, updateGamepadInput } from '../systems/inputSystem.js';\n\n// Data imports\nimport { CHARACTER_UNLOCKS } from '../data/unlocks.js';\nimport { getWeaponDefinition } from '../data/weapons.js';\n\n// Configuration imports\nimport {\n    PLAYER_CONFIG,\n    PROGRESSION_CONFIG,\n    CHARACTER_ABILITIES\n} from '../config/constants.js';\n\nexport function createPlayer(k, x, y, characterKey = null) {\n    // Get selected character (use provided characterKey for remote players, or get local selection)\n    const selectedCharKey = characterKey || getSelectedCharacter();\n    const charData = CHARACTER_UNLOCKS[selectedCharKey] || CHARACTER_UNLOCKS.survivor;\n    \n    // Create outline (larger, dark version behind player)\n    const outline = k.add([\n        k.text(charData.char, { size: 24 }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(0, 0, 0), // Black outline\n        k.scale(1.15), // Slightly larger\n        k.rotate(0), // Enable rotation\n        k.z(-1), // Behind the player\n        'playerOutline'\n    ]);\n\n    const player = k.add([\n        k.text(charData.char, { size: 24 }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...charData.color),\n        k.rotate(0), // Enable rotation\n        k.area(),\n        k.health(charData.stats.health),\n        'player'\n    ]);\n\n    // Link outline to player\n    player.outline = outline;\n\n    // Store character info\n    player.characterKey = selectedCharKey;\n    player.characterData = charData;\n    \n    // Player stats (from character)\n    player.speed = charData.stats.speed;\n    player.originalSpeed = charData.stats.speed; // Store original speed for debuff restoration\n    player.slowed = false; // Track if player is slowed\n    player.maxHealth = charData.stats.health;\n    // Head Start: Begin at level 2 if upgrade purchased\n    const headStartLevel = getPermanentUpgradeLevel('headStart');\n    player.level = headStartLevel > 0 ? 2 : PROGRESSION_CONFIG.STARTING_LEVEL;\n    player.xp = PROGRESSION_CONFIG.STARTING_XP;\n    player.xpToNext = PROGRESSION_CONFIG.BASE_XP_TO_NEXT_LEVEL;\n    player.pickupRadius = PLAYER_CONFIG.BASE_PICKUP_RADIUS;\n    player.invulnerable = false; // Immunity frames flag\n    player.invulnerableTime = 0; // Time remaining in immunity\n    player.invulnerableDuration = PLAYER_CONFIG.INVULNERABILITY_DURATION;\n    \n    // Sync health component with maxHealth\n    player.setHP(player.maxHealth);\n    \n    // Weapon system - get weapon definition\n    const weaponKey = charData.weapon || 'pistol';\n    const weaponDef = getWeaponDefinition(weaponKey);\n    player.weaponKey = weaponKey;\n    player.weaponDef = weaponDef;\n    \n    // Store base weapon stats (for upgrade recalculation)\n    player.baseFireRate = weaponDef.fireRate;\n    player.baseProjectileSpeed = weaponDef.projectileSpeed;\n    player.baseProjectileDamage = weaponDef.baseDamage;\n\n    // Apply character damage bonus to base weapon damage\n    const characterDamageBonus = charData.stats.damage || 10; // Default to 10 if not specified\n    const weaponBaseDamage = weaponDef.baseDamage;\n    const characterDamageMultiplier = characterDamageBonus / 10; // Normalize (10 is baseline)\n\n    // Weapon stats (from weapon definition + character bonuses)\n    player.fireRate = weaponDef.fireRate;\n    player.projectileSpeed = weaponDef.projectileSpeed;\n    player.projectileDamage = Math.floor(weaponBaseDamage * characterDamageMultiplier);\n    player.lastFireTime = 0;\n    \n    // Advanced weapon stats (from weapon definition)\n    player.projectileCount = weaponDef.projectileCount;\n    player.piercing = weaponDef.piercing;\n    player.obstaclePiercing = weaponDef.obstaclePiercing;\n    player.critChance = weaponDef.critChance;\n    player.critDamage = weaponDef.critDamage;\n    player.spreadAngle = weaponDef.spreadAngle;\n    player.defense = 0; // Damage reduction (flat reduction)\n    \n    // Weapon-specific properties\n    player.weaponRange = weaponDef.range;\n    player.weaponCategory = weaponDef.category;\n    \n    // Orbital weapon properties\n    if (weaponDef.orbitRadius) {\n        player.orbitRadius = weaponDef.orbitRadius;\n        player.rotationSpeed = weaponDef.rotationSpeed;\n        player.orbitalOrbs = []; // Array to store orbital entities\n        player.orbitalAngles = []; // Array to store orbital angles\n    }\n    \n    // Explosive weapon properties\n    if (weaponDef.explosionRadius) {\n        player.explosionRadius = weaponDef.explosionRadius;\n        player.explosionDamage = weaponDef.explosionDamage;\n    }\n    \n    // Chain lightning properties\n    if (weaponDef.chainRange) {\n        player.chainRange = weaponDef.chainRange;\n        player.maxJumps = weaponDef.maxJumps;\n        player.chainDamageReduction = weaponDef.chainDamageReduction;\n    }\n    \n    // Character abilities (apply based on character)\n    player.xpMultiplier = 1.0; // Base multiplier\n    player.dodgeChance = 0; // Base dodge chance\n    player.damageReduction = 0; // Base damage reduction\n    \n    // Upgrade tracking\n    player.weapons = [weaponKey]; // Array of equipped weapon keys (max 4)\n    player.passiveUpgrades = []; // Array of passive upgrade keys (max 4)\n    player.upgradeStacks = {}; // Track upgrade stack counts: { upgradeKey: count }\n    \n    // Apply character-specific abilities\n    if (charData.ability === 'xpBoost') {\n        player.xpMultiplier = CHARACTER_ABILITIES.SURVIVOR_XP_BOOST;\n    } else if (charData.ability === 'speedBoost') {\n        player.speed = player.speed * CHARACTER_ABILITIES.SCOUT_SPEED_BOOST;\n        player.originalSpeed = player.speed;\n        player.dodgeChance = CHARACTER_ABILITIES.SCOUT_DODGE_CHANCE;\n    } else if (charData.ability === 'tankStats') {\n        player.maxHealth = Math.floor(player.maxHealth * CHARACTER_ABILITIES.TANK_HEALTH_BOOST);\n        player.setHP(player.maxHealth);\n        player.damageReduction = CHARACTER_ABILITIES.TANK_DAMAGE_REDUCTION;\n    } else if (charData.ability === 'critBoost') {\n        player.critChance = (player.critChance || 0) * CHARACTER_ABILITIES.SNIPER_CRIT_CHANCE_MULTIPLIER;\n        player.critDamage = (player.critDamage || 2.0) * CHARACTER_ABILITIES.SNIPER_CRIT_DAMAGE_MULTIPLIER;\n    } else if (charData.ability === 'fireDot') {\n        player.fireDotMultiplier = CHARACTER_ABILITIES.PYRO_FIRE_DOT_MULTIPLIER;\n    }\n\n    // Apply permanent upgrades from shop (only for local players, not in multiplayer sync)\n    if (!charData.skipPermanentUpgrades) {\n        // Lucky Start: +5% crit chance per level\n        const luckyStartLevel = getPermanentUpgradeLevel('luckyStart');\n        if (luckyStartLevel > 0) {\n            player.critChance = (player.critChance || 0) + (luckyStartLevel * 0.05);\n        }\n\n        // Thick Skin: +3% damage reduction per level\n        const thickSkinLevel = getPermanentUpgradeLevel('thickSkin');\n        if (thickSkinLevel > 0) {\n            player.damageReduction = (player.damageReduction || 0) + (thickSkinLevel * 0.03);\n        }\n\n        // XP Magnet: +15% pickup radius per level\n        const xpMagnetLevel = getPermanentUpgradeLevel('xpMagnet');\n        if (xpMagnetLevel > 0) {\n            player.pickupRadius = Math.floor(player.pickupRadius * (1 + xpMagnetLevel * 0.15));\n        }\n\n        // Comfort Zone: +0.1s invulnerability after hit per level\n        const comfortZoneLevel = getPermanentUpgradeLevel('comfortZone');\n        if (comfortZoneLevel > 0) {\n            player.invulnerableDuration = player.invulnerableDuration + (comfortZoneLevel * 0.1);\n        }\n    }\n\n    // Control flags\n    player.canMove = true; // Can the player move? (set to false on death)\n    player.canShoot = true; // Can the player shoot? (set to false on death)\n    player.isDead = false; // Is the player dead?\n\n    // Movement\n    let moveDir = k.vec2(0, 0);\n    let windowHasFocus = document.hasFocus();\n    // Track keys that need to be released before accepting input again\n    let keysNeedRelease = { w: false, s: false, a: false, d: false, up: false, down: false, left: false, right: false };\n\n    // Expose moveDir on player object for multiplayer input reading\n    player.moveDir = moveDir;\n\n    k.onKeyDown(['w', 'up'], () => {\n        if (player.isRemote || !windowHasFocus) return;\n        if (keysNeedRelease.w || keysNeedRelease.up) return;\n        moveDir.y = -1;\n        player.moveDir = moveDir;\n    });\n\n    k.onKeyDown(['s', 'down'], () => {\n        if (player.isRemote || !windowHasFocus) return;\n        if (keysNeedRelease.s || keysNeedRelease.down) return;\n        moveDir.y = 1;\n        player.moveDir = moveDir;\n    });\n\n    k.onKeyDown(['a', 'left'], () => {\n        if (player.isRemote || !windowHasFocus) return;\n        if (keysNeedRelease.a || keysNeedRelease.left) return;\n        moveDir.x = -1;\n        player.moveDir = moveDir;\n    });\n\n    k.onKeyDown(['d', 'right'], () => {\n        if (player.isRemote || !windowHasFocus) return;\n        if (keysNeedRelease.d || keysNeedRelease.right) return;\n        moveDir.x = 1;\n        player.moveDir = moveDir;\n    });\n\n    k.onKeyRelease(['w', 'up'], () => {\n        if (player.isRemote) return;\n        keysNeedRelease.w = false;\n        keysNeedRelease.up = false;\n        if (!k.isKeyDown('s') && !k.isKeyDown('down')) {\n            moveDir.y = 0;\n            player.moveDir = moveDir;\n        }\n    });\n\n    k.onKeyRelease(['s', 'down'], () => {\n        if (player.isRemote) return;\n        keysNeedRelease.s = false;\n        keysNeedRelease.down = false;\n        if (!k.isKeyDown('w') && !k.isKeyDown('up')) {\n            moveDir.y = 0;\n            player.moveDir = moveDir;\n        }\n    });\n\n    k.onKeyRelease(['a', 'left'], () => {\n        if (player.isRemote) return;\n        keysNeedRelease.a = false;\n        keysNeedRelease.left = false;\n        if (!k.isKeyDown('d') && !k.isKeyDown('right')) {\n            moveDir.x = 0;\n            player.moveDir = moveDir;\n        }\n    });\n\n    k.onKeyRelease(['d', 'right'], () => {\n        if (player.isRemote) return;\n        keysNeedRelease.d = false;\n        keysNeedRelease.right = false;\n        if (!k.isKeyDown('a') && !k.isKeyDown('left')) {\n            moveDir.x = 0;\n            player.moveDir = moveDir;\n        }\n    });\n\n    // Stop movement when window loses focus\n    const handleBlur = () => {\n        if (player.isRemote) return;\n        windowHasFocus = false;\n        moveDir.x = 0;\n        moveDir.y = 0;\n        player.moveDir = moveDir;\n        player.isShooting = false;\n        // Only mark keys that are currently held as needing release\n        keysNeedRelease = {\n            w: k.isKeyDown('w'),\n            s: k.isKeyDown('s'),\n            a: k.isKeyDown('a'),\n            d: k.isKeyDown('d'),\n            up: k.isKeyDown('up'),\n            down: k.isKeyDown('down'),\n            left: k.isKeyDown('left'),\n            right: k.isKeyDown('right')\n        };\n    };\n\n    const handleFocus = () => {\n        windowHasFocus = true;\n    };\n\n    window.addEventListener('blur', handleBlur);\n    window.addEventListener('focus', handleFocus);\n\n    // Clean up listeners when player is destroyed\n    player.onDestroy(() => {\n        window.removeEventListener('blur', handleBlur);\n        window.removeEventListener('focus', handleFocus);\n    });\n\n    // Update movement and immunity frames\n    player.onUpdate(() => {\n        // Sync outline position with player\n        if (player.outline && player.outline.exists()) {\n            player.outline.pos = player.pos.clone();\n        }\n\n        if (k.paused) return;\n\n        // Update immunity frames\n        if (player.invulnerable) {\n            player.invulnerableTime -= k.dt();\n            if (player.invulnerableTime <= 0) {\n                player.invulnerable = false;\n                player.color = k.rgb(...PLAYER_CONFIG.NORMAL_COLOR);\n                // Reset outline visibility\n                if (player.outline && player.outline.exists()) {\n                    player.outline.opacity = 1;\n                }\n            } else {\n                // Flash effect during immunity\n                const flashRate = PLAYER_CONFIG.IMMUNITY_FLASH_RATE;\n                const shouldShow = Math.floor(player.invulnerableTime * flashRate) % 2 === 0;\n                if (shouldShow) {\n                    player.color = k.rgb(...PLAYER_CONFIG.NORMAL_COLOR);\n                    if (player.outline && player.outline.exists()) {\n                        player.outline.opacity = 1;\n                    }\n                } else {\n                    player.color = k.rgb(...PLAYER_CONFIG.NORMAL_COLOR, PLAYER_CONFIG.IMMUNITY_ALPHA);\n                    if (player.outline && player.outline.exists()) {\n                        player.outline.opacity = PLAYER_CONFIG.IMMUNITY_ALPHA;\n                    }\n                }\n            }\n        }\n        \n        // Don't allow movement if canMove is false (e.g., player is dead)\n        if (player.canMove === false) {\n            return;\n        }\n\n        // Update gamepad input polling\n        updateGamepadInput();\n\n        // For remote players, use network-provided move input instead of keyboard\n        let effectiveMoveDir = moveDir;\n        if (player.isRemote && player.move) {\n            effectiveMoveDir = k.vec2(player.move.x, player.move.y);\n        } else if (!player.isRemote) {\n            // Check for gamepad/touch input (overrides keyboard if active)\n            const altInput = getMovementInput();\n            if (altInput.x !== 0 || altInput.y !== 0) {\n                effectiveMoveDir = k.vec2(altInput.x, altInput.y);\n            }\n        }\n\n        if (effectiveMoveDir.len() > 0) {\n            const len = effectiveMoveDir.len();\n            const normalized = effectiveMoveDir.scale(1 / len);\n            const moveAmount = normalized.scale(player.speed * k.dt());\n            \n            // Check collision with obstacles before moving\n            const newX = player.pos.x + moveAmount.x;\n            const newY = player.pos.y + moveAmount.y;\n            \n            // Test collision with obstacles (walls and cover both block movement)\n            let canMoveX = true;\n            let canMoveY = true;\n\n            const obstacles = k.get('obstacle');\n            const playerSize = PLAYER_CONFIG.COLLISION_SIZE;\n            \n            for (const obstacle of obstacles) {\n                if (!obstacle.exists()) continue;\n                \n                // Check X movement\n                const obsLeft = obstacle.pos.x - obstacle.width / 2;\n                const obsRight = obstacle.pos.x + obstacle.width / 2;\n                const obsTop = obstacle.pos.y - obstacle.height / 2;\n                const obsBottom = obstacle.pos.y + obstacle.height / 2;\n                \n                const playerLeft = newX - playerSize;\n                const playerRight = newX + playerSize;\n                const playerTop = player.pos.y - playerSize;\n                const playerBottom = player.pos.y + playerSize;\n                \n                if (playerRight > obsLeft && playerLeft < obsRight &&\n                    playerBottom > obsTop && playerTop < obsBottom) {\n                    canMoveX = false;\n                }\n                \n                // Check Y movement\n                const playerLeftY = player.pos.x - playerSize;\n                const playerRightY = player.pos.x + playerSize;\n                const playerTopY = newY - playerSize;\n                const playerBottomY = newY + playerSize;\n                \n                if (playerRightY > obsLeft && playerLeftY < obsRight &&\n                    playerBottomY > obsTop && playerTopY < obsBottom) {\n                    canMoveY = false;\n                }\n            }\n            \n            // Apply movement if no collision\n            if (canMoveX) player.pos.x = newX;\n            if (canMoveY) player.pos.y = newY;\n        }\n        \n        // Keep player in bounds (room boundaries)\n        const roomWidth = k.width();\n        const roomHeight = k.height();\n        const margin = PLAYER_CONFIG.ROOM_MARGIN;\n\n        player.pos.x = k.clamp(player.pos.x, margin, roomWidth - margin);\n        player.pos.y = k.clamp(player.pos.y, margin, roomHeight - margin);\n    });\n\n    return player;\n}\n\n","/**\n * Network System - P2P Multiplayer using PeerJS\n * Handles connections, message passing, and state synchronization\n */\n\nimport { generateInviteCode } from './nameGenerator.js';\n\n// Debug flag - set to true to enable verbose network logging\nconst NET_DEBUG = false;\n\n// Network state\nconst network = {\n    peer: null,              // Our Peer instance\n    connections: new Map(),  // Map of peerId -> DataConnection\n    isHost: true,            // Are we the host?\n    hostId: null,            // Host's peer ID (null if we're host)\n    hostConnection: null,    // Connection to host (null if we're host)\n    messageHandlers: new Map(), // Message type -> handler function\n    connectionCallbacks: [], // Callbacks for when someone joins/leaves\n    isInitialized: false,\n    peerId: null            // Our peer ID (same as invite code for host)\n};\n\n/**\n * Initialize the network system\n * @param {string} inviteCode - Our invite code (will be our Peer ID if host)\n * @param {boolean} isHost - Whether we're the host\n * @returns {Promise<string>} Resolves with the actual invite code used (may differ if ID was taken)\n */\nexport function initNetwork(inviteCode, isHost = true) {\n    return new Promise((resolve, reject) => {\n        if (network.isInitialized) {\n            console.warn('Network already initialized');\n            resolve(inviteCode);\n            return;\n        }\n\n        // Clean up on page unload\n        window.addEventListener('beforeunload', () => {\n            disconnect();\n        });\n\n        // Check if PeerJS is available\n        if (typeof Peer === 'undefined') {\n            console.error('PeerJS library not loaded');\n            reject(new Error('PeerJS library not available'));\n            return;\n        }\n\n        network.isHost = isHost;\n\n        // Create peer with invite code as ID (for host) or random ID (for client)\n        const peerId = isHost ? `smash-${inviteCode}` : undefined;\n\n        // Auto-detect environment: use local PeerJS server for localhost, cloud for production\n        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n\n        // Configure PeerJS connection based on environment\n        let peerConfig;\n        if (isLocalhost) {\n            // Localhost: use local PeerJS server\n            peerConfig = {\n                debug: 3, // Maximum debug logging\n                host: 'localhost',\n                port: 9000,\n                path: '/',\n                secure: false, // HTTP for localhost\n                config: {\n                    // STUN and TURN servers for reliable connection\n                    iceServers: [\n                        { urls: 'stun:stun.l.google.com:19302' },\n                        // Public TURN server as fallback relay\n                        {\n                            urls: 'turn:numb.viagenie.ca',\n                            username: 'webrtc@live.com',\n                            credential: 'muazkh'\n                        }\n                    ]\n                }\n            };\n        } else {\n            // Production (GitHub Pages): use PeerJS cloud service\n            peerConfig = {\n                debug: 2, // Moderate debug logging\n                // No host/port/path specified = uses PeerJS cloud service (cloud.peerjs.com)\n                secure: true, // HTTPS for production\n                config: {\n                    // STUN and TURN servers for reliable connection\n                    iceServers: [\n                        { urls: 'stun:stun.l.google.com:19302' },\n                        { urls: 'stun:stun1.l.google.com:19302' },\n                        // Public TURN server as fallback relay\n                        {\n                            urls: 'turn:numb.viagenie.ca',\n                            username: 'webrtc@live.com',\n                            credential: 'muazkh'\n                        }\n                    ]\n                }\n            };\n        }\n\n        try {\n            network.peer = new Peer(peerId, peerConfig);\n\n            network.peer.on('open', (id) => {\n                network.peerId = id;\n                network.isInitialized = true;\n\n                // For hosts, extract the 6-digit code from the peer ID (format: \"smash-123456\")\n                // For clients, just resolve with the full ID\n                const codeToReturn = (isHost && id.startsWith('smash-'))\n                    ? id.substring(6) // Extract \"123456\" from \"smash-123456\"\n                    : id;\n\n                resolve(codeToReturn);\n            });\n\n            network.peer.on('error', (err) => {\n                console.error('Peer error:', err);\n\n                // Handle unavailable-id error (peer ID already taken)\n                if (err.type === 'unavailable-id' && isHost) {\n                    console.warn('Peer ID already taken - generating new code and retrying...');\n\n                    // Fully cleanup the peer\n                    if (network.peer) {\n                        try {\n                            network.peer.destroy();\n                        } catch (e) {\n                            console.warn('Error destroying peer:', e);\n                        }\n                        network.peer = null;\n                        network.peerId = null;\n                        network.isInitialized = false;\n                    }\n\n                    // Wait a bit longer for cleanup to complete\n                    setTimeout(() => {\n                        // Generate a new invite code (just 6 digits, no prefix)\n                        const newCode = generateInviteCode();\n\n                        // Recursively call initNetwork with new code\n                        // This will create a NEW peer with `smash-${newCode}` format\n                        initNetwork(newCode, isHost).then(resolve).catch(reject);\n                    }, 2000); // Longer delay to ensure cleanup\n                    return;\n                }\n\n                // Provide user-friendly error messages\n                if (err.type === 'network') {\n                    console.warn('PeerJS server unavailable - multiplayer disabled');\n                } else if (err.type === 'peer-unavailable') {\n                    console.warn('Host not found - check invite code');\n                } else if (err.type === 'server-error') {\n                    console.warn('PeerJS server error - multiplayer may be unavailable');\n                }\n\n                if (!network.isInitialized) {\n                    reject(new Error(`Multiplayer unavailable: ${err.type || 'connection failed'}`));\n                }\n            });\n\n            // Host listens for incoming connections\n            if (isHost) {\n                network.peer.on('connection', (conn) => {\n                    handleIncomingConnection(conn);\n                });\n            }\n\n        } catch (err) {\n            console.error('Failed to create peer:', err);\n            reject(err);\n        }\n    });\n}\n\n/**\n * Handle an incoming connection (host only)\n */\nfunction handleIncomingConnection(conn) {\n    if (!network.isHost) return;\n\n    conn.on('open', () => {\n        if (NET_DEBUG) console.log('Connection opened with:', conn.peer);\n        network.connections.set(conn.peer, conn);\n\n        // Notify callbacks\n        network.connectionCallbacks.forEach(cb => cb('join', conn.peer));\n    });\n\n    conn.on('data', (data) => {\n        handleMessage(data, conn.peer);\n    });\n\n    conn.on('close', () => {\n        if (NET_DEBUG) console.log('Connection closed with:', conn.peer);\n        network.connections.delete(conn.peer);\n\n        // Notify callbacks\n        network.connectionCallbacks.forEach(cb => cb('leave', conn.peer));\n    });\n\n    conn.on('error', (err) => {\n        console.error('Connection error with', conn.peer, ':', err);\n    });\n}\n\n/**\n * Connect to a host as a client\n * @param {string} hostInviteCode - The host's 6-digit invite code\n * @returns {Promise} Resolves when connected\n */\nexport function connectToHost(hostInviteCode) {\n    return new Promise((resolve, reject) => {\n        if (network.isHost) {\n            reject(new Error('Host cannot connect to another host'));\n            return;\n        }\n\n        if (!network.isInitialized) {\n            reject(new Error('Network not initialized'));\n            return;\n        }\n\n        const hostPeerId = `smash-${hostInviteCode}`;\n        if (NET_DEBUG) {\n            console.log('[NetworkSystem] Attempting to connect to host:', hostPeerId);\n            console.log('[NetworkSystem] Using STUN/TURN servers for NAT traversal...');\n        }\n\n        // Add connection timeout\n        let connectionTimeout;\n        let isResolved = false;\n\n        const conn = network.peer.connect(hostPeerId, {\n            reliable: true\n        });\n\n        // Set timeout for connection attempt (30 seconds)\n        connectionTimeout = setTimeout(() => {\n            if (!isResolved) {\n                console.error('[NetworkSystem] Connection timeout - host may be offline or unreachable');\n                console.error('[NetworkSystem] This could be due to:');\n                console.error('  - Host not found (wrong code or host offline)');\n                console.error('  - Firewall blocking connection');\n                console.error('  - NAT traversal failure (TURN servers may be overloaded)');\n                conn.close();\n                reject(new Error('Connection timeout - could not reach host'));\n            }\n        }, 30000);\n\n        conn.on('open', () => {\n            isResolved = true;\n            clearTimeout(connectionTimeout);\n            connectionTimeout = null; // Clear reference\n            network.hostConnection = conn;\n            network.hostId = hostPeerId;\n\n            // Don't send join_request here - partySystem.js will send it with full player info\n            resolve();\n        });\n\n        conn.on('data', (data) => {\n            handleMessage(data, hostPeerId);\n        });\n\n        conn.on('close', () => {\n            // Clear timeout to prevent race conditions\n            if (connectionTimeout) {\n                clearTimeout(connectionTimeout);\n                connectionTimeout = null;\n            }\n\n            network.hostConnection = null;\n            network.hostId = null;\n\n            // Notify callbacks\n            network.connectionCallbacks.forEach(cb => cb('host_disconnect'));\n        });\n\n        conn.on('error', (err) => {\n            isResolved = true;\n            clearTimeout(connectionTimeout);\n            connectionTimeout = null; // Clear reference\n            console.error('[NetworkSystem] Connection error:', err);\n            console.error('[NetworkSystem] Error type:', err.type || 'unknown');\n            reject(err);\n        });\n    });\n}\n\n/**\n * Handle incoming message\n */\nfunction handleMessage(data, fromPeerId) {\n    if (!data || !data.type) {\n        console.warn('Invalid message:', data);\n        return;\n    }\n\n    const handler = network.messageHandlers.get(data.type);\n    if (handler) {\n        handler(data.payload, fromPeerId);\n    } else {\n        console.warn('No handler for message type:', data.type);\n    }\n}\n\n/**\n * Register a message handler\n * @param {string} messageType - Type of message to handle\n * @param {Function} handler - Handler function (payload, fromPeerId) => void\n */\nexport function onMessage(messageType, handler) {\n    network.messageHandlers.set(messageType, handler);\n}\n\n/**\n * Unregister a message handler\n * @param {string} messageType - Type of message to remove\n */\nexport function offMessage(messageType) {\n    network.messageHandlers.delete(messageType);\n}\n\n/**\n * Clear all message handlers (useful for cleanup)\n */\nexport function clearAllMessageHandlers() {\n    network.messageHandlers.clear();\n}\n\n/**\n * Register a connection callback\n * @param {Function} callback - Callback function (event, peerId) => void\n *                              event can be 'join', 'leave', 'host_disconnect'\n */\nexport function onConnectionChange(callback) {\n    // Prevent duplicate callbacks\n    if (!network.connectionCallbacks.includes(callback)) {\n        network.connectionCallbacks.push(callback);\n    }\n}\n\n/**\n * Send message to host (client only)\n * @param {string} type - Message type\n * @param {any} payload - Message payload\n */\nexport function sendToHost(type, payload) {\n    if (network.isHost) {\n        console.warn('Host cannot send to itself');\n        return;\n    }\n\n    if (!network.hostConnection) {\n        console.warn('Not connected to host');\n        return;\n    }\n\n    network.hostConnection.send({ type, payload });\n}\n\n/**\n * Send message to specific peer (host only)\n * @param {string} peerId - Target peer ID\n * @param {string} type - Message type\n * @param {any} payload - Message payload\n */\nexport function sendToPeer(peerId, type, payload) {\n    if (!network.isHost) {\n        console.warn('Only host can send to specific peers');\n        return;\n    }\n\n    const conn = network.connections.get(peerId);\n    if (conn) {\n        conn.send({ type, payload });\n    } else {\n        console.warn('No connection to peer:', peerId);\n    }\n}\n\n/**\n * Broadcast message to all connected peers (host only)\n * @param {string} type - Message type\n * @param {any} payload - Message payload\n * @param {string[]} excludePeerIds - Peer IDs to exclude from broadcast\n */\nexport function broadcast(type, payload, excludePeerIds = []) {\n    if (!network.isHost) {\n        console.warn('Only host can broadcast');\n        return;\n    }\n\n    network.connections.forEach((conn, peerId) => {\n        if (!excludePeerIds.includes(peerId)) {\n            conn.send({ type, payload });\n        }\n    });\n}\n\n/**\n * Disconnect from network\n */\nexport function disconnect() {\n    // Close all connections\n    if (network.isHost) {\n        network.connections.forEach(conn => conn.close());\n        network.connections.clear();\n    } else if (network.hostConnection) {\n        network.hostConnection.close();\n        network.hostConnection = null;\n        network.hostId = null;\n    }\n\n    // Destroy peer\n    if (network.peer) {\n        network.peer.destroy();\n        network.peer = null;\n    }\n\n    // Clear handlers and callbacks to prevent memory leaks\n    network.messageHandlers.clear();\n    network.connectionCallbacks = [];\n\n    network.isInitialized = false;\n    network.peerId = null;\n}\n\n/**\n * Get network state info\n */\nexport function getNetworkInfo() {\n    // Extract just the 6-digit code from peerId if it has \"smash-\" prefix\n    const displayCode = network.peerId && network.peerId.startsWith('smash-')\n        ? network.peerId.substring(6)\n        : network.peerId;\n\n    return {\n        isInitialized: network.isInitialized,\n        isHost: network.isHost,\n        peerId: displayCode, // Return clean code without \"smash-\" prefix\n        hostId: network.hostId,\n        connectedPeers: Array.from(network.connections.keys()),\n        peerCount: network.connections.size\n    };\n}\n\n/**\n * Check if we're connected to the network\n */\nexport function isConnected() {\n    if (network.isHost) {\n        return network.isInitialized;\n    } else {\n        return network.hostConnection !== null;\n    }\n}\n\n/**\n * Get all connected peer IDs (host only)\n */\nexport function getConnectedPeers() {\n    if (!network.isHost) return [];\n    return Array.from(network.connections.keys());\n}\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Firebase constants.  Some of these (@defines) can be overridden at compile-time.\r\n */\r\nconst CONSTANTS = {\r\n    /**\r\n     * @define {boolean} Whether this is the client Node.js SDK.\r\n     */\r\n    NODE_CLIENT: false,\r\n    /**\r\n     * @define {boolean} Whether this is the Admin Node.js SDK.\r\n     */\r\n    NODE_ADMIN: false,\r\n    /**\r\n     * Firebase SDK Version\r\n     */\r\n    SDK_VERSION: '${JSCORE_VERSION}'\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws an error if the provided assertion is falsy\r\n */\r\nconst assert = function (assertion, message) {\r\n    if (!assertion) {\r\n        throw assertionError(message);\r\n    }\r\n};\r\n/**\r\n * Returns an Error object suitable for throwing.\r\n */\r\nconst assertionError = function (message) {\r\n    return new Error('Firebase Database (' +\r\n        CONSTANTS.SDK_VERSION +\r\n        ') INTERNAL ASSERT FAILED: ' +\r\n        message);\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst stringToByteArray$1 = function (str) {\r\n    // TODO(user): Use native implementations if/when available\r\n    const out = [];\r\n    let p = 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n        let c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if ((c & 0xfc00) === 0xd800 &&\r\n            i + 1 < str.length &&\r\n            (str.charCodeAt(i + 1) & 0xfc00) === 0xdc00) {\r\n            // Surrogate Pair\r\n            c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Turns an array of numbers into the string given by the concatenation of the\r\n * characters to which the numbers correspond.\r\n * @param bytes Array of numbers representing characters.\r\n * @return Stringification of the array.\r\n */\r\nconst byteArrayToString = function (bytes) {\r\n    // TODO(user): Use native implementations if/when available\r\n    const out = [];\r\n    let pos = 0, c = 0;\r\n    while (pos < bytes.length) {\r\n        const c1 = bytes[pos++];\r\n        if (c1 < 128) {\r\n            out[c++] = String.fromCharCode(c1);\r\n        }\r\n        else if (c1 > 191 && c1 < 224) {\r\n            const c2 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 31) << 6) | (c2 & 63));\r\n        }\r\n        else if (c1 > 239 && c1 < 365) {\r\n            // Surrogate Pair\r\n            const c2 = bytes[pos++];\r\n            const c3 = bytes[pos++];\r\n            const c4 = bytes[pos++];\r\n            const u = (((c1 & 7) << 18) | ((c2 & 63) << 12) | ((c3 & 63) << 6) | (c4 & 63)) -\r\n                0x10000;\r\n            out[c++] = String.fromCharCode(0xd800 + (u >> 10));\r\n            out[c++] = String.fromCharCode(0xdc00 + (u & 1023));\r\n        }\r\n        else {\r\n            const c2 = bytes[pos++];\r\n            const c3 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n        }\r\n    }\r\n    return out.join('');\r\n};\r\n// We define it as an object literal instead of a class because a class compiled down to es5 can't\r\n// be treeshaked. https://github.com/rollup/rollup/issues/1691\r\n// Static lookup maps, lazily populated by init_()\r\nconst base64 = {\r\n    /**\r\n     * Maps bytes to characters.\r\n     */\r\n    byteToCharMap_: null,\r\n    /**\r\n     * Maps characters to bytes.\r\n     */\r\n    charToByteMap_: null,\r\n    /**\r\n     * Maps bytes to websafe characters.\r\n     * @private\r\n     */\r\n    byteToCharMapWebSafe_: null,\r\n    /**\r\n     * Maps websafe characters to bytes.\r\n     * @private\r\n     */\r\n    charToByteMapWebSafe_: null,\r\n    /**\r\n     * Our default alphabet, shared between\r\n     * ENCODED_VALS and ENCODED_VALS_WEBSAFE\r\n     */\r\n    ENCODED_VALS_BASE: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789',\r\n    /**\r\n     * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\r\n     */\r\n    get ENCODED_VALS() {\r\n        return this.ENCODED_VALS_BASE + '+/=';\r\n    },\r\n    /**\r\n     * Our websafe alphabet.\r\n     */\r\n    get ENCODED_VALS_WEBSAFE() {\r\n        return this.ENCODED_VALS_BASE + '-_.';\r\n    },\r\n    /**\r\n     * Whether this browser supports the atob and btoa functions. This extension\r\n     * started at Mozilla but is now implemented by many browsers. We use the\r\n     * ASSUME_* variables to avoid pulling in the full useragent detection library\r\n     * but still allowing the standard per-browser compilations.\r\n     *\r\n     */\r\n    HAS_NATIVE_SUPPORT: typeof atob === 'function',\r\n    /**\r\n     * Base64-encode an array of bytes.\r\n     *\r\n     * @param input An array of bytes (numbers with\r\n     *     value in [0, 255]) to encode.\r\n     * @param webSafe Boolean indicating we should use the\r\n     *     alternative alphabet.\r\n     * @return The base64 encoded string.\r\n     */\r\n    encodeByteArray(input, webSafe) {\r\n        if (!Array.isArray(input)) {\r\n            throw Error('encodeByteArray takes an array as a parameter');\r\n        }\r\n        this.init_();\r\n        const byteToCharMap = webSafe\r\n            ? this.byteToCharMapWebSafe_\r\n            : this.byteToCharMap_;\r\n        const output = [];\r\n        for (let i = 0; i < input.length; i += 3) {\r\n            const byte1 = input[i];\r\n            const haveByte2 = i + 1 < input.length;\r\n            const byte2 = haveByte2 ? input[i + 1] : 0;\r\n            const haveByte3 = i + 2 < input.length;\r\n            const byte3 = haveByte3 ? input[i + 2] : 0;\r\n            const outByte1 = byte1 >> 2;\r\n            const outByte2 = ((byte1 & 0x03) << 4) | (byte2 >> 4);\r\n            let outByte3 = ((byte2 & 0x0f) << 2) | (byte3 >> 6);\r\n            let outByte4 = byte3 & 0x3f;\r\n            if (!haveByte3) {\r\n                outByte4 = 64;\r\n                if (!haveByte2) {\r\n                    outByte3 = 64;\r\n                }\r\n            }\r\n            output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);\r\n        }\r\n        return output.join('');\r\n    },\r\n    /**\r\n     * Base64-encode a string.\r\n     *\r\n     * @param input A string to encode.\r\n     * @param webSafe If true, we should use the\r\n     *     alternative alphabet.\r\n     * @return The base64 encoded string.\r\n     */\r\n    encodeString(input, webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\r\n            return btoa(input);\r\n        }\r\n        return this.encodeByteArray(stringToByteArray$1(input), webSafe);\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * @param input to decode.\r\n     * @param webSafe True if we should use the\r\n     *     alternative alphabet.\r\n     * @return string representing the decoded value.\r\n     */\r\n    decodeString(input, webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\r\n            return atob(input);\r\n        }\r\n        return byteArrayToString(this.decodeStringToByteArray(input, webSafe));\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * In base-64 decoding, groups of four characters are converted into three\r\n     * bytes.  If the encoder did not apply padding, the input length may not\r\n     * be a multiple of 4.\r\n     *\r\n     * In this case, the last group will have fewer than 4 characters, and\r\n     * padding will be inferred.  If the group has one or two characters, it decodes\r\n     * to one byte.  If the group has three characters, it decodes to two bytes.\r\n     *\r\n     * @param input Input to decode.\r\n     * @param webSafe True if we should use the web-safe alphabet.\r\n     * @return bytes representing the decoded value.\r\n     */\r\n    decodeStringToByteArray(input, webSafe) {\r\n        this.init_();\r\n        const charToByteMap = webSafe\r\n            ? this.charToByteMapWebSafe_\r\n            : this.charToByteMap_;\r\n        const output = [];\r\n        for (let i = 0; i < input.length;) {\r\n            const byte1 = charToByteMap[input.charAt(i++)];\r\n            const haveByte2 = i < input.length;\r\n            const byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;\r\n            ++i;\r\n            const haveByte3 = i < input.length;\r\n            const byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            const haveByte4 = i < input.length;\r\n            const byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {\r\n                throw new DecodeBase64StringError();\r\n            }\r\n            const outByte1 = (byte1 << 2) | (byte2 >> 4);\r\n            output.push(outByte1);\r\n            if (byte3 !== 64) {\r\n                const outByte2 = ((byte2 << 4) & 0xf0) | (byte3 >> 2);\r\n                output.push(outByte2);\r\n                if (byte4 !== 64) {\r\n                    const outByte3 = ((byte3 << 6) & 0xc0) | byte4;\r\n                    output.push(outByte3);\r\n                }\r\n            }\r\n        }\r\n        return output;\r\n    },\r\n    /**\r\n     * Lazy static initialization function. Called before\r\n     * accessing any of the static map variables.\r\n     * @private\r\n     */\r\n    init_() {\r\n        if (!this.byteToCharMap_) {\r\n            this.byteToCharMap_ = {};\r\n            this.charToByteMap_ = {};\r\n            this.byteToCharMapWebSafe_ = {};\r\n            this.charToByteMapWebSafe_ = {};\r\n            // We want quick mappings back and forth, so we precompute two maps.\r\n            for (let i = 0; i < this.ENCODED_VALS.length; i++) {\r\n                this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);\r\n                this.charToByteMap_[this.byteToCharMap_[i]] = i;\r\n                this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);\r\n                this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;\r\n                // Be forgiving when decoding and correctly decode both encodings.\r\n                if (i >= this.ENCODED_VALS_BASE.length) {\r\n                    this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;\r\n                    this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n/**\r\n * An error encountered while decoding base64 string.\r\n */\r\nclass DecodeBase64StringError extends Error {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.name = 'DecodeBase64StringError';\r\n    }\r\n}\r\n/**\r\n * URL-safe base64 encoding\r\n */\r\nconst base64Encode = function (str) {\r\n    const utf8Bytes = stringToByteArray$1(str);\r\n    return base64.encodeByteArray(utf8Bytes, true);\r\n};\r\n/**\r\n * URL-safe base64 encoding (without \".\" padding in the end).\r\n * e.g. Used in JSON Web Token (JWT) parts.\r\n */\r\nconst base64urlEncodeWithoutPadding = function (str) {\r\n    // Use base64url encoding and remove padding in the end (dot characters).\r\n    return base64Encode(str).replace(/\\./g, '');\r\n};\r\n/**\r\n * URL-safe base64 decoding\r\n *\r\n * NOTE: DO NOT use the global atob() function - it does NOT support the\r\n * base64Url variant encoding.\r\n *\r\n * @param str To be decoded\r\n * @return Decoded result, if possible\r\n */\r\nconst base64Decode = function (str) {\r\n    try {\r\n        return base64.decodeString(str, true);\r\n    }\r\n    catch (e) {\r\n        console.error('base64Decode failed: ', e);\r\n    }\r\n    return null;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Do a deep-copy of basic JavaScript Objects or Arrays.\r\n */\r\nfunction deepCopy(value) {\r\n    return deepExtend(undefined, value);\r\n}\r\n/**\r\n * Copy properties from source to target (recursively allows extension\r\n * of Objects and Arrays).  Scalar values in the target are over-written.\r\n * If target is undefined, an object of the appropriate type will be created\r\n * (and returned).\r\n *\r\n * We recursively copy all child properties of plain Objects in the source- so\r\n * that namespace- like dictionaries are merged.\r\n *\r\n * Note that the target can be a function, in which case the properties in\r\n * the source Object are copied onto it as static properties of the Function.\r\n *\r\n * Note: we don't merge __proto__ to prevent prototype pollution\r\n */\r\nfunction deepExtend(target, source) {\r\n    if (!(source instanceof Object)) {\r\n        return source;\r\n    }\r\n    switch (source.constructor) {\r\n        case Date:\r\n            // Treat Dates like scalars; if the target date object had any child\r\n            // properties - they will be lost!\r\n            const dateValue = source;\r\n            return new Date(dateValue.getTime());\r\n        case Object:\r\n            if (target === undefined) {\r\n                target = {};\r\n            }\r\n            break;\r\n        case Array:\r\n            // Always copy the array source and overwrite the target.\r\n            target = [];\r\n            break;\r\n        default:\r\n            // Not a plain Object - treat it as a scalar.\r\n            return source;\r\n    }\r\n    for (const prop in source) {\r\n        // use isValidKey to guard against prototype pollution. See https://snyk.io/vuln/SNYK-JS-LODASH-450202\r\n        if (!source.hasOwnProperty(prop) || !isValidKey(prop)) {\r\n            continue;\r\n        }\r\n        target[prop] = deepExtend(target[prop], source[prop]);\r\n    }\r\n    return target;\r\n}\r\nfunction isValidKey(key) {\r\n    return key !== '__proto__';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Polyfill for `globalThis` object.\r\n * @returns the `globalThis` object for the given environment.\r\n * @public\r\n */\r\nfunction getGlobal() {\r\n    if (typeof self !== 'undefined') {\r\n        return self;\r\n    }\r\n    if (typeof window !== 'undefined') {\r\n        return window;\r\n    }\r\n    if (typeof global !== 'undefined') {\r\n        return global;\r\n    }\r\n    throw new Error('Unable to locate global object.');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst getDefaultsFromGlobal = () => getGlobal().__FIREBASE_DEFAULTS__;\r\n/**\r\n * Attempt to read defaults from a JSON string provided to\r\n * process(.)env(.)__FIREBASE_DEFAULTS__ or a JSON file whose path is in\r\n * process(.)env(.)__FIREBASE_DEFAULTS_PATH__\r\n * The dots are in parens because certain compilers (Vite?) cannot\r\n * handle seeing that variable in comments.\r\n * See https://github.com/firebase/firebase-js-sdk/issues/6838\r\n */\r\nconst getDefaultsFromEnvVariable = () => {\r\n    if (typeof process === 'undefined' || typeof process.env === 'undefined') {\r\n        return;\r\n    }\r\n    const defaultsJsonString = process.env.__FIREBASE_DEFAULTS__;\r\n    if (defaultsJsonString) {\r\n        return JSON.parse(defaultsJsonString);\r\n    }\r\n};\r\nconst getDefaultsFromCookie = () => {\r\n    if (typeof document === 'undefined') {\r\n        return;\r\n    }\r\n    let match;\r\n    try {\r\n        match = document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/);\r\n    }\r\n    catch (e) {\r\n        // Some environments such as Angular Universal SSR have a\r\n        // `document` object but error on accessing `document.cookie`.\r\n        return;\r\n    }\r\n    const decoded = match && base64Decode(match[1]);\r\n    return decoded && JSON.parse(decoded);\r\n};\r\n/**\r\n * Get the __FIREBASE_DEFAULTS__ object. It checks in order:\r\n * (1) if such an object exists as a property of `globalThis`\r\n * (2) if such an object was provided on a shell environment variable\r\n * (3) if such an object exists in a cookie\r\n * @public\r\n */\r\nconst getDefaults = () => {\r\n    try {\r\n        return (getDefaultsFromGlobal() ||\r\n            getDefaultsFromEnvVariable() ||\r\n            getDefaultsFromCookie());\r\n    }\r\n    catch (e) {\r\n        /**\r\n         * Catch-all for being unable to get __FIREBASE_DEFAULTS__ due\r\n         * to any environment case we have not accounted for. Log to\r\n         * info instead of swallowing so we can find these unknown cases\r\n         * and add paths for them if needed.\r\n         */\r\n        console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);\r\n        return;\r\n    }\r\n};\r\n/**\r\n * Returns emulator host stored in the __FIREBASE_DEFAULTS__ object\r\n * for the given product.\r\n * @returns a URL host formatted like `127.0.0.1:9999` or `[::1]:4000` if available\r\n * @public\r\n */\r\nconst getDefaultEmulatorHost = (productName) => { var _a, _b; return (_b = (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a.emulatorHosts) === null || _b === void 0 ? void 0 : _b[productName]; };\r\n/**\r\n * Returns emulator hostname and port stored in the __FIREBASE_DEFAULTS__ object\r\n * for the given product.\r\n * @returns a pair of hostname and port like `[\"::1\", 4000]` if available\r\n * @public\r\n */\r\nconst getDefaultEmulatorHostnameAndPort = (productName) => {\r\n    const host = getDefaultEmulatorHost(productName);\r\n    if (!host) {\r\n        return undefined;\r\n    }\r\n    const separatorIndex = host.lastIndexOf(':'); // Finding the last since IPv6 addr also has colons.\r\n    if (separatorIndex <= 0 || separatorIndex + 1 === host.length) {\r\n        throw new Error(`Invalid host ${host} with no separate hostname and port!`);\r\n    }\r\n    // eslint-disable-next-line no-restricted-globals\r\n    const port = parseInt(host.substring(separatorIndex + 1), 10);\r\n    if (host[0] === '[') {\r\n        // Bracket-quoted `[ipv6addr]:port` => return \"ipv6addr\" (without brackets).\r\n        return [host.substring(1, separatorIndex - 1), port];\r\n    }\r\n    else {\r\n        return [host.substring(0, separatorIndex), port];\r\n    }\r\n};\r\n/**\r\n * Returns Firebase app config stored in the __FIREBASE_DEFAULTS__ object.\r\n * @public\r\n */\r\nconst getDefaultAppConfig = () => { var _a; return (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a.config; };\r\n/**\r\n * Returns an experimental setting on the __FIREBASE_DEFAULTS__ object (properties\r\n * prefixed by \"_\")\r\n * @public\r\n */\r\nconst getExperimentalSetting = (name) => { var _a; return (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a[`_${name}`]; };\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass Deferred {\r\n    constructor() {\r\n        this.reject = () => { };\r\n        this.resolve = () => { };\r\n        this.promise = new Promise((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n    }\r\n    /**\r\n     * Our API internals are not promisified and cannot because our callback APIs have subtle expectations around\r\n     * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\r\n     * and returns a node-style callback which will resolve or reject the Deferred's promise.\r\n     */\r\n    wrapCallback(callback) {\r\n        return (error, value) => {\r\n            if (error) {\r\n                this.reject(error);\r\n            }\r\n            else {\r\n                this.resolve(value);\r\n            }\r\n            if (typeof callback === 'function') {\r\n                // Attaching noop handler just in case developer wasn't expecting\r\n                // promises\r\n                this.promise.catch(() => { });\r\n                // Some of our callbacks don't expect a value and our own tests\r\n                // assert that the parameter length is 1\r\n                if (callback.length === 1) {\r\n                    callback(error);\r\n                }\r\n                else {\r\n                    callback(error, value);\r\n                }\r\n            }\r\n        };\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createMockUserToken(token, projectId) {\r\n    if (token.uid) {\r\n        throw new Error('The \"uid\" field is no longer supported by mockUserToken. Please use \"sub\" instead for Firebase Auth User ID.');\r\n    }\r\n    // Unsecured JWTs use \"none\" as the algorithm.\r\n    const header = {\r\n        alg: 'none',\r\n        type: 'JWT'\r\n    };\r\n    const project = projectId || 'demo-project';\r\n    const iat = token.iat || 0;\r\n    const sub = token.sub || token.user_id;\r\n    if (!sub) {\r\n        throw new Error(\"mockUserToken must contain 'sub' or 'user_id' field!\");\r\n    }\r\n    const payload = Object.assign({ \r\n        // Set all required fields to decent defaults\r\n        iss: `https://securetoken.google.com/${project}`, aud: project, iat, exp: iat + 3600, auth_time: iat, sub, user_id: sub, firebase: {\r\n            sign_in_provider: 'custom',\r\n            identities: {}\r\n        } }, token);\r\n    // Unsecured JWTs use the empty string as a signature.\r\n    const signature = '';\r\n    return [\r\n        base64urlEncodeWithoutPadding(JSON.stringify(header)),\r\n        base64urlEncodeWithoutPadding(JSON.stringify(payload)),\r\n        signature\r\n    ].join('.');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns navigator.userAgent string or '' if it's not defined.\r\n * @return user agent string\r\n */\r\nfunction getUA() {\r\n    if (typeof navigator !== 'undefined' &&\r\n        typeof navigator['userAgent'] === 'string') {\r\n        return navigator['userAgent'];\r\n    }\r\n    else {\r\n        return '';\r\n    }\r\n}\r\n/**\r\n * Detect Cordova / PhoneGap / Ionic frameworks on a mobile device.\r\n *\r\n * Deliberately does not rely on checking `file://` URLs (as this fails PhoneGap\r\n * in the Ripple emulator) nor Cordova `onDeviceReady`, which would normally\r\n * wait for a callback.\r\n */\r\nfunction isMobileCordova() {\r\n    return (typeof window !== 'undefined' &&\r\n        // @ts-ignore Setting up an broadly applicable index signature for Window\r\n        // just to deal with this case would probably be a bad idea.\r\n        !!(window['cordova'] || window['phonegap'] || window['PhoneGap']) &&\r\n        /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA()));\r\n}\r\n/**\r\n * Detect Node.js.\r\n *\r\n * @return true if Node.js environment is detected or specified.\r\n */\r\n// Node detection logic from: https://github.com/iliakan/detect-node/\r\nfunction isNode() {\r\n    var _a;\r\n    const forceEnvironment = (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a.forceEnvironment;\r\n    if (forceEnvironment === 'node') {\r\n        return true;\r\n    }\r\n    else if (forceEnvironment === 'browser') {\r\n        return false;\r\n    }\r\n    try {\r\n        return (Object.prototype.toString.call(global.process) === '[object process]');\r\n    }\r\n    catch (e) {\r\n        return false;\r\n    }\r\n}\r\n/**\r\n * Detect Browser Environment.\r\n * Note: This will return true for certain test frameworks that are incompletely\r\n * mimicking a browser, and should not lead to assuming all browser APIs are\r\n * available.\r\n */\r\nfunction isBrowser() {\r\n    return typeof window !== 'undefined' || isWebWorker();\r\n}\r\n/**\r\n * Detect Web Worker context.\r\n */\r\nfunction isWebWorker() {\r\n    return (typeof WorkerGlobalScope !== 'undefined' &&\r\n        typeof self !== 'undefined' &&\r\n        self instanceof WorkerGlobalScope);\r\n}\r\n/**\r\n * Detect Cloudflare Worker context.\r\n */\r\nfunction isCloudflareWorker() {\r\n    return (typeof navigator !== 'undefined' &&\r\n        navigator.userAgent === 'Cloudflare-Workers');\r\n}\r\nfunction isBrowserExtension() {\r\n    const runtime = typeof chrome === 'object'\r\n        ? chrome.runtime\r\n        : typeof browser === 'object'\r\n            ? browser.runtime\r\n            : undefined;\r\n    return typeof runtime === 'object' && runtime.id !== undefined;\r\n}\r\n/**\r\n * Detect React Native.\r\n *\r\n * @return true if ReactNative environment is detected.\r\n */\r\nfunction isReactNative() {\r\n    return (typeof navigator === 'object' && navigator['product'] === 'ReactNative');\r\n}\r\n/** Detects Electron apps. */\r\nfunction isElectron() {\r\n    return getUA().indexOf('Electron/') >= 0;\r\n}\r\n/** Detects Internet Explorer. */\r\nfunction isIE() {\r\n    const ua = getUA();\r\n    return ua.indexOf('MSIE ') >= 0 || ua.indexOf('Trident/') >= 0;\r\n}\r\n/** Detects Universal Windows Platform apps. */\r\nfunction isUWP() {\r\n    return getUA().indexOf('MSAppHost/') >= 0;\r\n}\r\n/**\r\n * Detect whether the current SDK build is the Node version.\r\n *\r\n * @return true if it's the Node SDK build.\r\n */\r\nfunction isNodeSdk() {\r\n    return CONSTANTS.NODE_CLIENT === true || CONSTANTS.NODE_ADMIN === true;\r\n}\r\n/** Returns true if we are running in Safari. */\r\nfunction isSafari() {\r\n    return (!isNode() &&\r\n        !!navigator.userAgent &&\r\n        navigator.userAgent.includes('Safari') &&\r\n        !navigator.userAgent.includes('Chrome'));\r\n}\r\n/**\r\n * This method checks if indexedDB is supported by current browser/service worker context\r\n * @return true if indexedDB is supported by current browser/service worker context\r\n */\r\nfunction isIndexedDBAvailable() {\r\n    try {\r\n        return typeof indexedDB === 'object';\r\n    }\r\n    catch (e) {\r\n        return false;\r\n    }\r\n}\r\n/**\r\n * This method validates browser/sw context for indexedDB by opening a dummy indexedDB database and reject\r\n * if errors occur during the database open operation.\r\n *\r\n * @throws exception if current browser/sw context can't run idb.open (ex: Safari iframe, Firefox\r\n * private browsing)\r\n */\r\nfunction validateIndexedDBOpenable() {\r\n    return new Promise((resolve, reject) => {\r\n        try {\r\n            let preExist = true;\r\n            const DB_CHECK_NAME = 'validate-browser-context-for-indexeddb-analytics-module';\r\n            const request = self.indexedDB.open(DB_CHECK_NAME);\r\n            request.onsuccess = () => {\r\n                request.result.close();\r\n                // delete database only when it doesn't pre-exist\r\n                if (!preExist) {\r\n                    self.indexedDB.deleteDatabase(DB_CHECK_NAME);\r\n                }\r\n                resolve(true);\r\n            };\r\n            request.onupgradeneeded = () => {\r\n                preExist = false;\r\n            };\r\n            request.onerror = () => {\r\n                var _a;\r\n                reject(((_a = request.error) === null || _a === void 0 ? void 0 : _a.message) || '');\r\n            };\r\n        }\r\n        catch (error) {\r\n            reject(error);\r\n        }\r\n    });\r\n}\r\n/**\r\n *\r\n * This method checks whether cookie is enabled within current browser\r\n * @return true if cookie is enabled within current browser\r\n */\r\nfunction areCookiesEnabled() {\r\n    if (typeof navigator === 'undefined' || !navigator.cookieEnabled) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Standardized Firebase Error.\r\n *\r\n * Usage:\r\n *\r\n *   // TypeScript string literals for type-safe codes\r\n *   type Err =\r\n *     'unknown' |\r\n *     'object-not-found'\r\n *     ;\r\n *\r\n *   // Closure enum for type-safe error codes\r\n *   // at-enum {string}\r\n *   var Err = {\r\n *     UNKNOWN: 'unknown',\r\n *     OBJECT_NOT_FOUND: 'object-not-found',\r\n *   }\r\n *\r\n *   let errors: Map<Err, string> = {\r\n *     'generic-error': \"Unknown error\",\r\n *     'file-not-found': \"Could not find file: {$file}\",\r\n *   };\r\n *\r\n *   // Type-safe function - must pass a valid error code as param.\r\n *   let error = new ErrorFactory<Err>('service', 'Service', errors);\r\n *\r\n *   ...\r\n *   throw error.create(Err.GENERIC);\r\n *   ...\r\n *   throw error.create(Err.FILE_NOT_FOUND, {'file': fileName});\r\n *   ...\r\n *   // Service: Could not file file: foo.txt (service/file-not-found).\r\n *\r\n *   catch (e) {\r\n *     assert(e.message === \"Could not find file: foo.txt.\");\r\n *     if ((e as FirebaseError)?.code === 'service/file-not-found') {\r\n *       console.log(\"Could not read file: \" + e['file']);\r\n *     }\r\n *   }\r\n */\r\nconst ERROR_NAME = 'FirebaseError';\r\n// Based on code from:\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\r\nclass FirebaseError extends Error {\r\n    constructor(\r\n    /** The error code for this error. */\r\n    code, message, \r\n    /** Custom data for this error. */\r\n    customData) {\r\n        super(message);\r\n        this.code = code;\r\n        this.customData = customData;\r\n        /** The custom name for all FirebaseErrors. */\r\n        this.name = ERROR_NAME;\r\n        // Fix For ES5\r\n        // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n        Object.setPrototypeOf(this, FirebaseError.prototype);\r\n        // Maintains proper stack trace for where our error was thrown.\r\n        // Only available on V8.\r\n        if (Error.captureStackTrace) {\r\n            Error.captureStackTrace(this, ErrorFactory.prototype.create);\r\n        }\r\n    }\r\n}\r\nclass ErrorFactory {\r\n    constructor(service, serviceName, errors) {\r\n        this.service = service;\r\n        this.serviceName = serviceName;\r\n        this.errors = errors;\r\n    }\r\n    create(code, ...data) {\r\n        const customData = data[0] || {};\r\n        const fullCode = `${this.service}/${code}`;\r\n        const template = this.errors[code];\r\n        const message = template ? replaceTemplate(template, customData) : 'Error';\r\n        // Service Name: Error message (service/code).\r\n        const fullMessage = `${this.serviceName}: ${message} (${fullCode}).`;\r\n        const error = new FirebaseError(fullCode, fullMessage, customData);\r\n        return error;\r\n    }\r\n}\r\nfunction replaceTemplate(template, data) {\r\n    return template.replace(PATTERN, (_, key) => {\r\n        const value = data[key];\r\n        return value != null ? String(value) : `<${key}?>`;\r\n    });\r\n}\r\nconst PATTERN = /\\{\\$([^}]+)}/g;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Evaluates a JSON string into a javascript object.\r\n *\r\n * @param {string} str A string containing JSON.\r\n * @return {*} The javascript object representing the specified JSON.\r\n */\r\nfunction jsonEval(str) {\r\n    return JSON.parse(str);\r\n}\r\n/**\r\n * Returns JSON representing a javascript object.\r\n * @param {*} data JavaScript object to be stringified.\r\n * @return {string} The JSON contents of the object.\r\n */\r\nfunction stringify(data) {\r\n    return JSON.stringify(data);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Decodes a Firebase auth. token into constituent parts.\r\n *\r\n * Notes:\r\n * - May return with invalid / incomplete claims if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst decode = function (token) {\r\n    let header = {}, claims = {}, data = {}, signature = '';\r\n    try {\r\n        const parts = token.split('.');\r\n        header = jsonEval(base64Decode(parts[0]) || '');\r\n        claims = jsonEval(base64Decode(parts[1]) || '');\r\n        signature = parts[2];\r\n        data = claims['d'] || {};\r\n        delete claims['d'];\r\n    }\r\n    catch (e) { }\r\n    return {\r\n        header,\r\n        claims,\r\n        data,\r\n        signature\r\n    };\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its time-based claims. Will return true if the\r\n * token is within the time window authorized by the 'nbf' (not-before) and 'iat' (issued-at) claims.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst isValidTimestamp = function (token) {\r\n    const claims = decode(token).claims;\r\n    const now = Math.floor(new Date().getTime() / 1000);\r\n    let validSince = 0, validUntil = 0;\r\n    if (typeof claims === 'object') {\r\n        if (claims.hasOwnProperty('nbf')) {\r\n            validSince = claims['nbf'];\r\n        }\r\n        else if (claims.hasOwnProperty('iat')) {\r\n            validSince = claims['iat'];\r\n        }\r\n        if (claims.hasOwnProperty('exp')) {\r\n            validUntil = claims['exp'];\r\n        }\r\n        else {\r\n            // token will expire after 24h by default\r\n            validUntil = validSince + 86400;\r\n        }\r\n    }\r\n    return (!!now &&\r\n        !!validSince &&\r\n        !!validUntil &&\r\n        now >= validSince &&\r\n        now <= validUntil);\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and returns its issued at time if valid, null otherwise.\r\n *\r\n * Notes:\r\n * - May return null if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst issuedAtTime = function (token) {\r\n    const claims = decode(token).claims;\r\n    if (typeof claims === 'object' && claims.hasOwnProperty('iat')) {\r\n        return claims['iat'];\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its format. Expects a valid issued-at time.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst isValidFormat = function (token) {\r\n    const decoded = decode(token), claims = decoded.claims;\r\n    return !!claims && typeof claims === 'object' && claims.hasOwnProperty('iat');\r\n};\r\n/**\r\n * Attempts to peer into an auth token and determine if it's an admin auth token by looking at the claims portion.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst isAdmin = function (token) {\r\n    const claims = decode(token).claims;\r\n    return typeof claims === 'object' && claims['admin'] === true;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction contains(obj, key) {\r\n    return Object.prototype.hasOwnProperty.call(obj, key);\r\n}\r\nfunction safeGet(obj, key) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n        return obj[key];\r\n    }\r\n    else {\r\n        return undefined;\r\n    }\r\n}\r\nfunction isEmpty(obj) {\r\n    for (const key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction map(obj, fn, contextObj) {\r\n    const res = {};\r\n    for (const key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            res[key] = fn.call(contextObj, obj[key], key, obj);\r\n        }\r\n    }\r\n    return res;\r\n}\r\n/**\r\n * Deep equal two objects. Support Arrays and Objects.\r\n */\r\nfunction deepEqual(a, b) {\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    const aKeys = Object.keys(a);\r\n    const bKeys = Object.keys(b);\r\n    for (const k of aKeys) {\r\n        if (!bKeys.includes(k)) {\r\n            return false;\r\n        }\r\n        const aProp = a[k];\r\n        const bProp = b[k];\r\n        if (isObject(aProp) && isObject(bProp)) {\r\n            if (!deepEqual(aProp, bProp)) {\r\n                return false;\r\n            }\r\n        }\r\n        else if (aProp !== bProp) {\r\n            return false;\r\n        }\r\n    }\r\n    for (const k of bKeys) {\r\n        if (!aKeys.includes(k)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction isObject(thing) {\r\n    return thing !== null && typeof thing === 'object';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Rejects if the given promise doesn't resolve in timeInMS milliseconds.\r\n * @internal\r\n */\r\nfunction promiseWithTimeout(promise, timeInMS = 2000) {\r\n    const deferredPromise = new Deferred();\r\n    setTimeout(() => deferredPromise.reject('timeout!'), timeInMS);\r\n    promise.then(deferredPromise.resolve, deferredPromise.reject);\r\n    return deferredPromise.promise;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a querystring-formatted string (e.g. &arg=val&arg2=val2) from a\r\n * params object (e.g. {arg: 'val', arg2: 'val2'})\r\n * Note: You must prepend it with ? when adding it to a URL.\r\n */\r\nfunction querystring(querystringParams) {\r\n    const params = [];\r\n    for (const [key, value] of Object.entries(querystringParams)) {\r\n        if (Array.isArray(value)) {\r\n            value.forEach(arrayVal => {\r\n                params.push(encodeURIComponent(key) + '=' + encodeURIComponent(arrayVal));\r\n            });\r\n        }\r\n        else {\r\n            params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\r\n        }\r\n    }\r\n    return params.length ? '&' + params.join('&') : '';\r\n}\r\n/**\r\n * Decodes a querystring (e.g. ?arg=val&arg2=val2) into a params object\r\n * (e.g. {arg: 'val', arg2: 'val2'})\r\n */\r\nfunction querystringDecode(querystring) {\r\n    const obj = {};\r\n    const tokens = querystring.replace(/^\\?/, '').split('&');\r\n    tokens.forEach(token => {\r\n        if (token) {\r\n            const [key, value] = token.split('=');\r\n            obj[decodeURIComponent(key)] = decodeURIComponent(value);\r\n        }\r\n    });\r\n    return obj;\r\n}\r\n/**\r\n * Extract the query string part of a URL, including the leading question mark (if present).\r\n */\r\nfunction extractQuerystring(url) {\r\n    const queryStart = url.indexOf('?');\r\n    if (!queryStart) {\r\n        return '';\r\n    }\r\n    const fragmentStart = url.indexOf('#', queryStart);\r\n    return url.substring(queryStart, fragmentStart > 0 ? fragmentStart : undefined);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview SHA-1 cryptographic hash.\r\n * Variable names follow the notation in FIPS PUB 180-3:\r\n * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\r\n *\r\n * Usage:\r\n *   var sha1 = new sha1();\r\n *   sha1.update(bytes);\r\n *   var hash = sha1.digest();\r\n *\r\n * Performance:\r\n *   Chrome 23:   ~400 Mbit/s\r\n *   Firefox 16:  ~250 Mbit/s\r\n *\r\n */\r\n/**\r\n * SHA-1 cryptographic hash constructor.\r\n *\r\n * The properties declared here are discussed in the above algorithm document.\r\n * @constructor\r\n * @final\r\n * @struct\r\n */\r\nclass Sha1 {\r\n    constructor() {\r\n        /**\r\n         * Holds the previous values of accumulated variables a-e in the compress_\r\n         * function.\r\n         * @private\r\n         */\r\n        this.chain_ = [];\r\n        /**\r\n         * A buffer holding the partially computed hash result.\r\n         * @private\r\n         */\r\n        this.buf_ = [];\r\n        /**\r\n         * An array of 80 bytes, each a part of the message to be hashed.  Referred to\r\n         * as the message schedule in the docs.\r\n         * @private\r\n         */\r\n        this.W_ = [];\r\n        /**\r\n         * Contains data needed to pad messages less than 64 bytes.\r\n         * @private\r\n         */\r\n        this.pad_ = [];\r\n        /**\r\n         * @private {number}\r\n         */\r\n        this.inbuf_ = 0;\r\n        /**\r\n         * @private {number}\r\n         */\r\n        this.total_ = 0;\r\n        this.blockSize = 512 / 8;\r\n        this.pad_[0] = 128;\r\n        for (let i = 1; i < this.blockSize; ++i) {\r\n            this.pad_[i] = 0;\r\n        }\r\n        this.reset();\r\n    }\r\n    reset() {\r\n        this.chain_[0] = 0x67452301;\r\n        this.chain_[1] = 0xefcdab89;\r\n        this.chain_[2] = 0x98badcfe;\r\n        this.chain_[3] = 0x10325476;\r\n        this.chain_[4] = 0xc3d2e1f0;\r\n        this.inbuf_ = 0;\r\n        this.total_ = 0;\r\n    }\r\n    /**\r\n     * Internal compress helper function.\r\n     * @param buf Block to compress.\r\n     * @param offset Offset of the block in the buffer.\r\n     * @private\r\n     */\r\n    compress_(buf, offset) {\r\n        if (!offset) {\r\n            offset = 0;\r\n        }\r\n        const W = this.W_;\r\n        // get 16 big endian words\r\n        if (typeof buf === 'string') {\r\n            for (let i = 0; i < 16; i++) {\r\n                // TODO(user): [bug 8140122] Recent versions of Safari for Mac OS and iOS\r\n                // have a bug that turns the post-increment ++ operator into pre-increment\r\n                // during JIT compilation.  We have code that depends heavily on SHA-1 for\r\n                // correctness and which is affected by this bug, so I've removed all uses\r\n                // of post-increment ++ in which the result value is used.  We can revert\r\n                // this change once the Safari bug\r\n                // (https://bugs.webkit.org/show_bug.cgi?id=109036) has been fixed and\r\n                // most clients have been updated.\r\n                W[i] =\r\n                    (buf.charCodeAt(offset) << 24) |\r\n                        (buf.charCodeAt(offset + 1) << 16) |\r\n                        (buf.charCodeAt(offset + 2) << 8) |\r\n                        buf.charCodeAt(offset + 3);\r\n                offset += 4;\r\n            }\r\n        }\r\n        else {\r\n            for (let i = 0; i < 16; i++) {\r\n                W[i] =\r\n                    (buf[offset] << 24) |\r\n                        (buf[offset + 1] << 16) |\r\n                        (buf[offset + 2] << 8) |\r\n                        buf[offset + 3];\r\n                offset += 4;\r\n            }\r\n        }\r\n        // expand to 80 words\r\n        for (let i = 16; i < 80; i++) {\r\n            const t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\r\n            W[i] = ((t << 1) | (t >>> 31)) & 0xffffffff;\r\n        }\r\n        let a = this.chain_[0];\r\n        let b = this.chain_[1];\r\n        let c = this.chain_[2];\r\n        let d = this.chain_[3];\r\n        let e = this.chain_[4];\r\n        let f, k;\r\n        // TODO(user): Try to unroll this loop to speed up the computation.\r\n        for (let i = 0; i < 80; i++) {\r\n            if (i < 40) {\r\n                if (i < 20) {\r\n                    f = d ^ (b & (c ^ d));\r\n                    k = 0x5a827999;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0x6ed9eba1;\r\n                }\r\n            }\r\n            else {\r\n                if (i < 60) {\r\n                    f = (b & c) | (d & (b | c));\r\n                    k = 0x8f1bbcdc;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0xca62c1d6;\r\n                }\r\n            }\r\n            const t = (((a << 5) | (a >>> 27)) + f + e + k + W[i]) & 0xffffffff;\r\n            e = d;\r\n            d = c;\r\n            c = ((b << 30) | (b >>> 2)) & 0xffffffff;\r\n            b = a;\r\n            a = t;\r\n        }\r\n        this.chain_[0] = (this.chain_[0] + a) & 0xffffffff;\r\n        this.chain_[1] = (this.chain_[1] + b) & 0xffffffff;\r\n        this.chain_[2] = (this.chain_[2] + c) & 0xffffffff;\r\n        this.chain_[3] = (this.chain_[3] + d) & 0xffffffff;\r\n        this.chain_[4] = (this.chain_[4] + e) & 0xffffffff;\r\n    }\r\n    update(bytes, length) {\r\n        // TODO(johnlenz): tighten the function signature and remove this check\r\n        if (bytes == null) {\r\n            return;\r\n        }\r\n        if (length === undefined) {\r\n            length = bytes.length;\r\n        }\r\n        const lengthMinusBlock = length - this.blockSize;\r\n        let n = 0;\r\n        // Using local instead of member variables gives ~5% speedup on Firefox 16.\r\n        const buf = this.buf_;\r\n        let inbuf = this.inbuf_;\r\n        // The outer while loop should execute at most twice.\r\n        while (n < length) {\r\n            // When we have no data in the block to top up, we can directly process the\r\n            // input buffer (assuming it contains sufficient data). This gives ~25%\r\n            // speedup on Chrome 23 and ~15% speedup on Firefox 16, but requires that\r\n            // the data is provided in large chunks (or in multiples of 64 bytes).\r\n            if (inbuf === 0) {\r\n                while (n <= lengthMinusBlock) {\r\n                    this.compress_(bytes, n);\r\n                    n += this.blockSize;\r\n                }\r\n            }\r\n            if (typeof bytes === 'string') {\r\n                while (n < length) {\r\n                    buf[inbuf] = bytes.charCodeAt(n);\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf === this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                while (n < length) {\r\n                    buf[inbuf] = bytes[n];\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf === this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.inbuf_ = inbuf;\r\n        this.total_ += length;\r\n    }\r\n    /** @override */\r\n    digest() {\r\n        const digest = [];\r\n        let totalBits = this.total_ * 8;\r\n        // Add pad 0x80 0x00*.\r\n        if (this.inbuf_ < 56) {\r\n            this.update(this.pad_, 56 - this.inbuf_);\r\n        }\r\n        else {\r\n            this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));\r\n        }\r\n        // Add # bits.\r\n        for (let i = this.blockSize - 1; i >= 56; i--) {\r\n            this.buf_[i] = totalBits & 255;\r\n            totalBits /= 256; // Don't use bit-shifting here!\r\n        }\r\n        this.compress_(this.buf_);\r\n        let n = 0;\r\n        for (let i = 0; i < 5; i++) {\r\n            for (let j = 24; j >= 0; j -= 8) {\r\n                digest[n] = (this.chain_[i] >> j) & 255;\r\n                ++n;\r\n            }\r\n        }\r\n        return digest;\r\n    }\r\n}\n\n/**\r\n * Helper to make a Subscribe function (just like Promise helps make a\r\n * Thenable).\r\n *\r\n * @param executor Function which can make calls to a single Observer\r\n *     as a proxy.\r\n * @param onNoObservers Callback when count of Observers goes to zero.\r\n */\r\nfunction createSubscribe(executor, onNoObservers) {\r\n    const proxy = new ObserverProxy(executor, onNoObservers);\r\n    return proxy.subscribe.bind(proxy);\r\n}\r\n/**\r\n * Implement fan-out for any number of Observers attached via a subscribe\r\n * function.\r\n */\r\nclass ObserverProxy {\r\n    /**\r\n     * @param executor Function which can make calls to a single Observer\r\n     *     as a proxy.\r\n     * @param onNoObservers Callback when count of Observers goes to zero.\r\n     */\r\n    constructor(executor, onNoObservers) {\r\n        this.observers = [];\r\n        this.unsubscribes = [];\r\n        this.observerCount = 0;\r\n        // Micro-task scheduling by calling task.then().\r\n        this.task = Promise.resolve();\r\n        this.finalized = false;\r\n        this.onNoObservers = onNoObservers;\r\n        // Call the executor asynchronously so subscribers that are called\r\n        // synchronously after the creation of the subscribe function\r\n        // can still receive the very first value generated in the executor.\r\n        this.task\r\n            .then(() => {\r\n            executor(this);\r\n        })\r\n            .catch(e => {\r\n            this.error(e);\r\n        });\r\n    }\r\n    next(value) {\r\n        this.forEachObserver((observer) => {\r\n            observer.next(value);\r\n        });\r\n    }\r\n    error(error) {\r\n        this.forEachObserver((observer) => {\r\n            observer.error(error);\r\n        });\r\n        this.close(error);\r\n    }\r\n    complete() {\r\n        this.forEachObserver((observer) => {\r\n            observer.complete();\r\n        });\r\n        this.close();\r\n    }\r\n    /**\r\n     * Subscribe function that can be used to add an Observer to the fan-out list.\r\n     *\r\n     * - We require that no event is sent to a subscriber synchronously to their\r\n     *   call to subscribe().\r\n     */\r\n    subscribe(nextOrObserver, error, complete) {\r\n        let observer;\r\n        if (nextOrObserver === undefined &&\r\n            error === undefined &&\r\n            complete === undefined) {\r\n            throw new Error('Missing Observer.');\r\n        }\r\n        // Assemble an Observer object when passed as callback functions.\r\n        if (implementsAnyMethods(nextOrObserver, [\r\n            'next',\r\n            'error',\r\n            'complete'\r\n        ])) {\r\n            observer = nextOrObserver;\r\n        }\r\n        else {\r\n            observer = {\r\n                next: nextOrObserver,\r\n                error,\r\n                complete\r\n            };\r\n        }\r\n        if (observer.next === undefined) {\r\n            observer.next = noop;\r\n        }\r\n        if (observer.error === undefined) {\r\n            observer.error = noop;\r\n        }\r\n        if (observer.complete === undefined) {\r\n            observer.complete = noop;\r\n        }\r\n        const unsub = this.unsubscribeOne.bind(this, this.observers.length);\r\n        // Attempt to subscribe to a terminated Observable - we\r\n        // just respond to the Observer with the final error or complete\r\n        // event.\r\n        if (this.finalized) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this.task.then(() => {\r\n                try {\r\n                    if (this.finalError) {\r\n                        observer.error(this.finalError);\r\n                    }\r\n                    else {\r\n                        observer.complete();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    // nothing\r\n                }\r\n                return;\r\n            });\r\n        }\r\n        this.observers.push(observer);\r\n        return unsub;\r\n    }\r\n    // Unsubscribe is synchronous - we guarantee that no events are sent to\r\n    // any unsubscribed Observer.\r\n    unsubscribeOne(i) {\r\n        if (this.observers === undefined || this.observers[i] === undefined) {\r\n            return;\r\n        }\r\n        delete this.observers[i];\r\n        this.observerCount -= 1;\r\n        if (this.observerCount === 0 && this.onNoObservers !== undefined) {\r\n            this.onNoObservers(this);\r\n        }\r\n    }\r\n    forEachObserver(fn) {\r\n        if (this.finalized) {\r\n            // Already closed by previous event....just eat the additional values.\r\n            return;\r\n        }\r\n        // Since sendOne calls asynchronously - there is no chance that\r\n        // this.observers will become undefined.\r\n        for (let i = 0; i < this.observers.length; i++) {\r\n            this.sendOne(i, fn);\r\n        }\r\n    }\r\n    // Call the Observer via one of it's callback function. We are careful to\r\n    // confirm that the observe has not been unsubscribed since this asynchronous\r\n    // function had been queued.\r\n    sendOne(i, fn) {\r\n        // Execute the callback asynchronously\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.task.then(() => {\r\n            if (this.observers !== undefined && this.observers[i] !== undefined) {\r\n                try {\r\n                    fn(this.observers[i]);\r\n                }\r\n                catch (e) {\r\n                    // Ignore exceptions raised in Observers or missing methods of an\r\n                    // Observer.\r\n                    // Log error to console. b/31404806\r\n                    if (typeof console !== 'undefined' && console.error) {\r\n                        console.error(e);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    close(err) {\r\n        if (this.finalized) {\r\n            return;\r\n        }\r\n        this.finalized = true;\r\n        if (err !== undefined) {\r\n            this.finalError = err;\r\n        }\r\n        // Proxy is no longer needed - garbage collect references\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.task.then(() => {\r\n            this.observers = undefined;\r\n            this.onNoObservers = undefined;\r\n        });\r\n    }\r\n}\r\n/** Turn synchronous function into one called asynchronously. */\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nfunction async(fn, onError) {\r\n    return (...args) => {\r\n        Promise.resolve(true)\r\n            .then(() => {\r\n            fn(...args);\r\n        })\r\n            .catch((error) => {\r\n            if (onError) {\r\n                onError(error);\r\n            }\r\n        });\r\n    };\r\n}\r\n/**\r\n * Return true if the object passed in implements any of the named methods.\r\n */\r\nfunction implementsAnyMethods(obj, methods) {\r\n    if (typeof obj !== 'object' || obj === null) {\r\n        return false;\r\n    }\r\n    for (const method of methods) {\r\n        if (method in obj && typeof obj[method] === 'function') {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction noop() {\r\n    // do nothing\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Check to make sure the appropriate number of arguments are provided for a public function.\r\n * Throws an error if it fails.\r\n *\r\n * @param fnName The function name\r\n * @param minCount The minimum number of arguments to allow for the function call\r\n * @param maxCount The maximum number of argument to allow for the function call\r\n * @param argCount The actual number of arguments provided.\r\n */\r\nconst validateArgCount = function (fnName, minCount, maxCount, argCount) {\r\n    let argError;\r\n    if (argCount < minCount) {\r\n        argError = 'at least ' + minCount;\r\n    }\r\n    else if (argCount > maxCount) {\r\n        argError = maxCount === 0 ? 'none' : 'no more than ' + maxCount;\r\n    }\r\n    if (argError) {\r\n        const error = fnName +\r\n            ' failed: Was called with ' +\r\n            argCount +\r\n            (argCount === 1 ? ' argument.' : ' arguments.') +\r\n            ' Expects ' +\r\n            argError +\r\n            '.';\r\n        throw new Error(error);\r\n    }\r\n};\r\n/**\r\n * Generates a string to prefix an error message about failed argument validation\r\n *\r\n * @param fnName The function name\r\n * @param argName The name of the argument\r\n * @return The prefix to add to the error thrown for validation.\r\n */\r\nfunction errorPrefix(fnName, argName) {\r\n    return `${fnName} failed: ${argName} argument `;\r\n}\r\n/**\r\n * @param fnName\r\n * @param argumentNumber\r\n * @param namespace\r\n * @param optional\r\n */\r\nfunction validateNamespace(fnName, namespace, optional) {\r\n    if (optional && !namespace) {\r\n        return;\r\n    }\r\n    if (typeof namespace !== 'string') {\r\n        //TODO: I should do more validation here. We only allow certain chars in namespaces.\r\n        throw new Error(errorPrefix(fnName, 'namespace') + 'must be a valid firebase namespace.');\r\n    }\r\n}\r\nfunction validateCallback(fnName, argumentName, \r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\ncallback, optional) {\r\n    if (optional && !callback) {\r\n        return;\r\n    }\r\n    if (typeof callback !== 'function') {\r\n        throw new Error(errorPrefix(fnName, argumentName) + 'must be a valid function.');\r\n    }\r\n}\r\nfunction validateContextObject(fnName, argumentName, context, optional) {\r\n    if (optional && !context) {\r\n        return;\r\n    }\r\n    if (typeof context !== 'object' || context === null) {\r\n        throw new Error(errorPrefix(fnName, argumentName) + 'must be a valid context object.');\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Code originally came from goog.crypt.stringToUtf8ByteArray, but for some reason they\r\n// automatically replaced '\\r\\n' with '\\n', and they didn't handle surrogate pairs,\r\n// so it's been modified.\r\n// Note that not all Unicode characters appear as single characters in JavaScript strings.\r\n// fromCharCode returns the UTF-16 encoding of a character - so some Unicode characters\r\n// use 2 characters in JavaScript.  All 4-byte UTF-8 characters begin with a first\r\n// character in the range 0xD800 - 0xDBFF (the first character of a so-called surrogate\r\n// pair).\r\n// See http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.3\r\n/**\r\n * @param {string} str\r\n * @return {Array}\r\n */\r\nconst stringToByteArray = function (str) {\r\n    const out = [];\r\n    let p = 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n        let c = str.charCodeAt(i);\r\n        // Is this the lead surrogate in a surrogate pair?\r\n        if (c >= 0xd800 && c <= 0xdbff) {\r\n            const high = c - 0xd800; // the high 10 bits.\r\n            i++;\r\n            assert(i < str.length, 'Surrogate pair missing trail surrogate.');\r\n            const low = str.charCodeAt(i) - 0xdc00; // the low 10 bits.\r\n            c = 0x10000 + (high << 10) + low;\r\n        }\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if (c < 65536) {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Calculate length without actually converting; useful for doing cheaper validation.\r\n * @param {string} str\r\n * @return {number}\r\n */\r\nconst stringLength = function (str) {\r\n    let p = 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n        const c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            p++;\r\n        }\r\n        else if (c < 2048) {\r\n            p += 2;\r\n        }\r\n        else if (c >= 0xd800 && c <= 0xdbff) {\r\n            // Lead surrogate of a surrogate pair.  The pair together will take 4 bytes to represent.\r\n            p += 4;\r\n            i++; // skip trail surrogate.\r\n        }\r\n        else {\r\n            p += 3;\r\n        }\r\n    }\r\n    return p;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Copied from https://stackoverflow.com/a/2117523\r\n * Generates a new uuid.\r\n * @public\r\n */\r\nconst uuidv4 = function () {\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\r\n        const r = (Math.random() * 16) | 0, v = c === 'x' ? r : (r & 0x3) | 0x8;\r\n        return v.toString(16);\r\n    });\r\n};\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The amount of milliseconds to exponentially increase.\r\n */\r\nconst DEFAULT_INTERVAL_MILLIS = 1000;\r\n/**\r\n * The factor to backoff by.\r\n * Should be a number greater than 1.\r\n */\r\nconst DEFAULT_BACKOFF_FACTOR = 2;\r\n/**\r\n * The maximum milliseconds to increase to.\r\n *\r\n * <p>Visible for testing\r\n */\r\nconst MAX_VALUE_MILLIS = 4 * 60 * 60 * 1000; // Four hours, like iOS and Android.\r\n/**\r\n * The percentage of backoff time to randomize by.\r\n * See\r\n * http://go/safe-client-behavior#step-1-determine-the-appropriate-retry-interval-to-handle-spike-traffic\r\n * for context.\r\n *\r\n * <p>Visible for testing\r\n */\r\nconst RANDOM_FACTOR = 0.5;\r\n/**\r\n * Based on the backoff method from\r\n * https://github.com/google/closure-library/blob/master/closure/goog/math/exponentialbackoff.js.\r\n * Extracted here so we don't need to pass metadata and a stateful ExponentialBackoff object around.\r\n */\r\nfunction calculateBackoffMillis(backoffCount, intervalMillis = DEFAULT_INTERVAL_MILLIS, backoffFactor = DEFAULT_BACKOFF_FACTOR) {\r\n    // Calculates an exponentially increasing value.\r\n    // Deviation: calculates value from count and a constant interval, so we only need to save value\r\n    // and count to restore state.\r\n    const currBaseValue = intervalMillis * Math.pow(backoffFactor, backoffCount);\r\n    // A random \"fuzz\" to avoid waves of retries.\r\n    // Deviation: randomFactor is required.\r\n    const randomWait = Math.round(\r\n    // A fraction of the backoff value to add/subtract.\r\n    // Deviation: changes multiplication order to improve readability.\r\n    RANDOM_FACTOR *\r\n        currBaseValue *\r\n        // A random float (rounded to int by Math.round above) in the range [-1, 1]. Determines\r\n        // if we add or subtract.\r\n        (Math.random() - 0.5) *\r\n        2);\r\n    // Limits backoff to max to avoid effectively permanent backoff.\r\n    return Math.min(MAX_VALUE_MILLIS, currBaseValue + randomWait);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provide English ordinal letters after a number\r\n */\r\nfunction ordinal(i) {\r\n    if (!Number.isFinite(i)) {\r\n        return `${i}`;\r\n    }\r\n    return i + indicator(i);\r\n}\r\nfunction indicator(i) {\r\n    i = Math.abs(i);\r\n    const cent = i % 100;\r\n    if (cent >= 10 && cent <= 20) {\r\n        return 'th';\r\n    }\r\n    const dec = i % 10;\r\n    if (dec === 1) {\r\n        return 'st';\r\n    }\r\n    if (dec === 2) {\r\n        return 'nd';\r\n    }\r\n    if (dec === 3) {\r\n        return 'rd';\r\n    }\r\n    return 'th';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getModularInstance(service) {\r\n    if (service && service._delegate) {\r\n        return service._delegate;\r\n    }\r\n    else {\r\n        return service;\r\n    }\r\n}\n\nexport { CONSTANTS, DecodeBase64StringError, Deferred, ErrorFactory, FirebaseError, MAX_VALUE_MILLIS, RANDOM_FACTOR, Sha1, areCookiesEnabled, assert, assertionError, async, base64, base64Decode, base64Encode, base64urlEncodeWithoutPadding, calculateBackoffMillis, contains, createMockUserToken, createSubscribe, decode, deepCopy, deepEqual, deepExtend, errorPrefix, extractQuerystring, getDefaultAppConfig, getDefaultEmulatorHost, getDefaultEmulatorHostnameAndPort, getDefaults, getExperimentalSetting, getGlobal, getModularInstance, getUA, isAdmin, isBrowser, isBrowserExtension, isCloudflareWorker, isElectron, isEmpty, isIE, isIndexedDBAvailable, isMobileCordova, isNode, isNodeSdk, isReactNative, isSafari, isUWP, isValidFormat, isValidTimestamp, isWebWorker, issuedAtTime, jsonEval, map, ordinal, promiseWithTimeout, querystring, querystringDecode, safeGet, stringLength, stringToByteArray, stringify, uuidv4, validateArgCount, validateCallback, validateContextObject, validateIndexedDBOpenable, validateNamespace };\n//# sourceMappingURL=index.esm2017.js.map\n","import { Deferred } from '@firebase/util';\n\n/**\r\n * Component for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nclass Component {\r\n    /**\r\n     *\r\n     * @param name The public service name, e.g. app, auth, firestore, database\r\n     * @param instanceFactory Service factory responsible for creating the public interface\r\n     * @param type whether the service provided by the component is public or private\r\n     */\r\n    constructor(name, instanceFactory, type) {\r\n        this.name = name;\r\n        this.instanceFactory = instanceFactory;\r\n        this.type = type;\r\n        this.multipleInstances = false;\r\n        /**\r\n         * Properties to be added to the service namespace\r\n         */\r\n        this.serviceProps = {};\r\n        this.instantiationMode = \"LAZY\" /* InstantiationMode.LAZY */;\r\n        this.onInstanceCreated = null;\r\n    }\r\n    setInstantiationMode(mode) {\r\n        this.instantiationMode = mode;\r\n        return this;\r\n    }\r\n    setMultipleInstances(multipleInstances) {\r\n        this.multipleInstances = multipleInstances;\r\n        return this;\r\n    }\r\n    setServiceProps(props) {\r\n        this.serviceProps = props;\r\n        return this;\r\n    }\r\n    setInstanceCreatedCallback(callback) {\r\n        this.onInstanceCreated = callback;\r\n        return this;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst DEFAULT_ENTRY_NAME = '[DEFAULT]';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provider for instance for service name T, e.g. 'auth', 'auth-internal'\r\n * NameServiceMapping[T] is an alias for the type of the instance\r\n */\r\nclass Provider {\r\n    constructor(name, container) {\r\n        this.name = name;\r\n        this.container = container;\r\n        this.component = null;\r\n        this.instances = new Map();\r\n        this.instancesDeferred = new Map();\r\n        this.instancesOptions = new Map();\r\n        this.onInitCallbacks = new Map();\r\n    }\r\n    /**\r\n     * @param identifier A provider can provide multiple instances of a service\r\n     * if this.component.multipleInstances is true.\r\n     */\r\n    get(identifier) {\r\n        // if multipleInstances is not supported, use the default name\r\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        if (!this.instancesDeferred.has(normalizedIdentifier)) {\r\n            const deferred = new Deferred();\r\n            this.instancesDeferred.set(normalizedIdentifier, deferred);\r\n            if (this.isInitialized(normalizedIdentifier) ||\r\n                this.shouldAutoInitialize()) {\r\n                // initialize the service if it can be auto-initialized\r\n                try {\r\n                    const instance = this.getOrInitializeService({\r\n                        instanceIdentifier: normalizedIdentifier\r\n                    });\r\n                    if (instance) {\r\n                        deferred.resolve(instance);\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    // when the instance factory throws an exception during get(), it should not cause\r\n                    // a fatal error. We just return the unresolved promise in this case.\r\n                }\r\n            }\r\n        }\r\n        return this.instancesDeferred.get(normalizedIdentifier).promise;\r\n    }\r\n    getImmediate(options) {\r\n        var _a;\r\n        // if multipleInstances is not supported, use the default name\r\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(options === null || options === void 0 ? void 0 : options.identifier);\r\n        const optional = (_a = options === null || options === void 0 ? void 0 : options.optional) !== null && _a !== void 0 ? _a : false;\r\n        if (this.isInitialized(normalizedIdentifier) ||\r\n            this.shouldAutoInitialize()) {\r\n            try {\r\n                return this.getOrInitializeService({\r\n                    instanceIdentifier: normalizedIdentifier\r\n                });\r\n            }\r\n            catch (e) {\r\n                if (optional) {\r\n                    return null;\r\n                }\r\n                else {\r\n                    throw e;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            // In case a component is not initialized and should/cannot be auto-initialized at the moment, return null if the optional flag is set, or throw\r\n            if (optional) {\r\n                return null;\r\n            }\r\n            else {\r\n                throw Error(`Service ${this.name} is not available`);\r\n            }\r\n        }\r\n    }\r\n    getComponent() {\r\n        return this.component;\r\n    }\r\n    setComponent(component) {\r\n        if (component.name !== this.name) {\r\n            throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);\r\n        }\r\n        if (this.component) {\r\n            throw Error(`Component for ${this.name} has already been provided`);\r\n        }\r\n        this.component = component;\r\n        // return early without attempting to initialize the component if the component requires explicit initialization (calling `Provider.initialize()`)\r\n        if (!this.shouldAutoInitialize()) {\r\n            return;\r\n        }\r\n        // if the service is eager, initialize the default instance\r\n        if (isComponentEager(component)) {\r\n            try {\r\n                this.getOrInitializeService({ instanceIdentifier: DEFAULT_ENTRY_NAME });\r\n            }\r\n            catch (e) {\r\n                // when the instance factory for an eager Component throws an exception during the eager\r\n                // initialization, it should not cause a fatal error.\r\n                // TODO: Investigate if we need to make it configurable, because some component may want to cause\r\n                // a fatal error in this case?\r\n            }\r\n        }\r\n        // Create service instances for the pending promises and resolve them\r\n        // NOTE: if this.multipleInstances is false, only the default instance will be created\r\n        // and all promises with resolve with it regardless of the identifier.\r\n        for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {\r\n            const normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\r\n            try {\r\n                // `getOrInitializeService()` should always return a valid instance since a component is guaranteed. use ! to make typescript happy.\r\n                const instance = this.getOrInitializeService({\r\n                    instanceIdentifier: normalizedIdentifier\r\n                });\r\n                instanceDeferred.resolve(instance);\r\n            }\r\n            catch (e) {\r\n                // when the instance factory throws an exception, it should not cause\r\n                // a fatal error. We just leave the promise unresolved.\r\n            }\r\n        }\r\n    }\r\n    clearInstance(identifier = DEFAULT_ENTRY_NAME) {\r\n        this.instancesDeferred.delete(identifier);\r\n        this.instancesOptions.delete(identifier);\r\n        this.instances.delete(identifier);\r\n    }\r\n    // app.delete() will call this method on every provider to delete the services\r\n    // TODO: should we mark the provider as deleted?\r\n    async delete() {\r\n        const services = Array.from(this.instances.values());\r\n        await Promise.all([\r\n            ...services\r\n                .filter(service => 'INTERNAL' in service) // legacy services\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                .map(service => service.INTERNAL.delete()),\r\n            ...services\r\n                .filter(service => '_delete' in service) // modularized services\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                .map(service => service._delete())\r\n        ]);\r\n    }\r\n    isComponentSet() {\r\n        return this.component != null;\r\n    }\r\n    isInitialized(identifier = DEFAULT_ENTRY_NAME) {\r\n        return this.instances.has(identifier);\r\n    }\r\n    getOptions(identifier = DEFAULT_ENTRY_NAME) {\r\n        return this.instancesOptions.get(identifier) || {};\r\n    }\r\n    initialize(opts = {}) {\r\n        const { options = {} } = opts;\r\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(opts.instanceIdentifier);\r\n        if (this.isInitialized(normalizedIdentifier)) {\r\n            throw Error(`${this.name}(${normalizedIdentifier}) has already been initialized`);\r\n        }\r\n        if (!this.isComponentSet()) {\r\n            throw Error(`Component ${this.name} has not been registered yet`);\r\n        }\r\n        const instance = this.getOrInitializeService({\r\n            instanceIdentifier: normalizedIdentifier,\r\n            options\r\n        });\r\n        // resolve any pending promise waiting for the service instance\r\n        for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {\r\n            const normalizedDeferredIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\r\n            if (normalizedIdentifier === normalizedDeferredIdentifier) {\r\n                instanceDeferred.resolve(instance);\r\n            }\r\n        }\r\n        return instance;\r\n    }\r\n    /**\r\n     *\r\n     * @param callback - a function that will be invoked  after the provider has been initialized by calling provider.initialize().\r\n     * The function is invoked SYNCHRONOUSLY, so it should not execute any longrunning tasks in order to not block the program.\r\n     *\r\n     * @param identifier An optional instance identifier\r\n     * @returns a function to unregister the callback\r\n     */\r\n    onInit(callback, identifier) {\r\n        var _a;\r\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        const existingCallbacks = (_a = this.onInitCallbacks.get(normalizedIdentifier)) !== null && _a !== void 0 ? _a : new Set();\r\n        existingCallbacks.add(callback);\r\n        this.onInitCallbacks.set(normalizedIdentifier, existingCallbacks);\r\n        const existingInstance = this.instances.get(normalizedIdentifier);\r\n        if (existingInstance) {\r\n            callback(existingInstance, normalizedIdentifier);\r\n        }\r\n        return () => {\r\n            existingCallbacks.delete(callback);\r\n        };\r\n    }\r\n    /**\r\n     * Invoke onInit callbacks synchronously\r\n     * @param instance the service instance`\r\n     */\r\n    invokeOnInitCallbacks(instance, identifier) {\r\n        const callbacks = this.onInitCallbacks.get(identifier);\r\n        if (!callbacks) {\r\n            return;\r\n        }\r\n        for (const callback of callbacks) {\r\n            try {\r\n                callback(instance, identifier);\r\n            }\r\n            catch (_a) {\r\n                // ignore errors in the onInit callback\r\n            }\r\n        }\r\n    }\r\n    getOrInitializeService({ instanceIdentifier, options = {} }) {\r\n        let instance = this.instances.get(instanceIdentifier);\r\n        if (!instance && this.component) {\r\n            instance = this.component.instanceFactory(this.container, {\r\n                instanceIdentifier: normalizeIdentifierForFactory(instanceIdentifier),\r\n                options\r\n            });\r\n            this.instances.set(instanceIdentifier, instance);\r\n            this.instancesOptions.set(instanceIdentifier, options);\r\n            /**\r\n             * Invoke onInit listeners.\r\n             * Note this.component.onInstanceCreated is different, which is used by the component creator,\r\n             * while onInit listeners are registered by consumers of the provider.\r\n             */\r\n            this.invokeOnInitCallbacks(instance, instanceIdentifier);\r\n            /**\r\n             * Order is important\r\n             * onInstanceCreated() should be called after this.instances.set(instanceIdentifier, instance); which\r\n             * makes `isInitialized()` return true.\r\n             */\r\n            if (this.component.onInstanceCreated) {\r\n                try {\r\n                    this.component.onInstanceCreated(this.container, instanceIdentifier, instance);\r\n                }\r\n                catch (_a) {\r\n                    // ignore errors in the onInstanceCreatedCallback\r\n                }\r\n            }\r\n        }\r\n        return instance || null;\r\n    }\r\n    normalizeInstanceIdentifier(identifier = DEFAULT_ENTRY_NAME) {\r\n        if (this.component) {\r\n            return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME;\r\n        }\r\n        else {\r\n            return identifier; // assume multiple instances are supported before the component is provided.\r\n        }\r\n    }\r\n    shouldAutoInitialize() {\r\n        return (!!this.component &&\r\n            this.component.instantiationMode !== \"EXPLICIT\" /* InstantiationMode.EXPLICIT */);\r\n    }\r\n}\r\n// undefined should be passed to the service factory for the default instance\r\nfunction normalizeIdentifierForFactory(identifier) {\r\n    return identifier === DEFAULT_ENTRY_NAME ? undefined : identifier;\r\n}\r\nfunction isComponentEager(component) {\r\n    return component.instantiationMode === \"EAGER\" /* InstantiationMode.EAGER */;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * ComponentContainer that provides Providers for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nclass ComponentContainer {\r\n    constructor(name) {\r\n        this.name = name;\r\n        this.providers = new Map();\r\n    }\r\n    /**\r\n     *\r\n     * @param component Component being added\r\n     * @param overwrite When a component with the same name has already been registered,\r\n     * if overwrite is true: overwrite the existing component with the new component and create a new\r\n     * provider with the new component. It can be useful in tests where you want to use different mocks\r\n     * for different tests.\r\n     * if overwrite is false: throw an exception\r\n     */\r\n    addComponent(component) {\r\n        const provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            throw new Error(`Component ${component.name} has already been registered with ${this.name}`);\r\n        }\r\n        provider.setComponent(component);\r\n    }\r\n    addOrOverwriteComponent(component) {\r\n        const provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            // delete the existing provider from the container, so we can register the new component\r\n            this.providers.delete(component.name);\r\n        }\r\n        this.addComponent(component);\r\n    }\r\n    /**\r\n     * getProvider provides a type safe interface where it can only be called with a field name\r\n     * present in NameServiceMapping interface.\r\n     *\r\n     * Firebase SDKs providing services should extend NameServiceMapping interface to register\r\n     * themselves.\r\n     */\r\n    getProvider(name) {\r\n        if (this.providers.has(name)) {\r\n            return this.providers.get(name);\r\n        }\r\n        // create a Provider for a service that hasn't registered with Firebase\r\n        const provider = new Provider(name, this);\r\n        this.providers.set(name, provider);\r\n        return provider;\r\n    }\r\n    getProviders() {\r\n        return Array.from(this.providers.values());\r\n    }\r\n}\n\nexport { Component, ComponentContainer, Provider };\n//# sourceMappingURL=index.esm2017.js.map\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A container for all of the Logger instances\r\n */\r\nconst instances = [];\r\n/**\r\n * The JS SDK supports 5 log levels and also allows a user the ability to\r\n * silence the logs altogether.\r\n *\r\n * The order is a follows:\r\n * DEBUG < VERBOSE < INFO < WARN < ERROR\r\n *\r\n * All of the log types above the current log level will be captured (i.e. if\r\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\r\n * `VERBOSE` logs will not)\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\r\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\r\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\r\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\r\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\r\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\r\n})(LogLevel || (LogLevel = {}));\r\nconst levelStringToEnum = {\r\n    'debug': LogLevel.DEBUG,\r\n    'verbose': LogLevel.VERBOSE,\r\n    'info': LogLevel.INFO,\r\n    'warn': LogLevel.WARN,\r\n    'error': LogLevel.ERROR,\r\n    'silent': LogLevel.SILENT\r\n};\r\n/**\r\n * The default log level\r\n */\r\nconst defaultLogLevel = LogLevel.INFO;\r\n/**\r\n * By default, `console.debug` is not displayed in the developer console (in\r\n * chrome). To avoid forcing users to have to opt-in to these logs twice\r\n * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\r\n * logs to the `console.log` function.\r\n */\r\nconst ConsoleMethod = {\r\n    [LogLevel.DEBUG]: 'log',\r\n    [LogLevel.VERBOSE]: 'log',\r\n    [LogLevel.INFO]: 'info',\r\n    [LogLevel.WARN]: 'warn',\r\n    [LogLevel.ERROR]: 'error'\r\n};\r\n/**\r\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\r\n * messages on to their corresponding console counterparts (if the log method\r\n * is supported by the current log level)\r\n */\r\nconst defaultLogHandler = (instance, logType, ...args) => {\r\n    if (logType < instance.logLevel) {\r\n        return;\r\n    }\r\n    const now = new Date().toISOString();\r\n    const method = ConsoleMethod[logType];\r\n    if (method) {\r\n        console[method](`[${now}]  ${instance.name}:`, ...args);\r\n    }\r\n    else {\r\n        throw new Error(`Attempted to log a message with an invalid logType (value: ${logType})`);\r\n    }\r\n};\r\nclass Logger {\r\n    /**\r\n     * Gives you an instance of a Logger to capture messages according to\r\n     * Firebase's logging scheme.\r\n     *\r\n     * @param name The name that the logs will be associated with\r\n     */\r\n    constructor(name) {\r\n        this.name = name;\r\n        /**\r\n         * The log level of the given Logger instance.\r\n         */\r\n        this._logLevel = defaultLogLevel;\r\n        /**\r\n         * The main (internal) log handler for the Logger instance.\r\n         * Can be set to a new function in internal package code but not by user.\r\n         */\r\n        this._logHandler = defaultLogHandler;\r\n        /**\r\n         * The optional, additional, user-defined log handler for the Logger instance.\r\n         */\r\n        this._userLogHandler = null;\r\n        /**\r\n         * Capture the current instance for later use\r\n         */\r\n        instances.push(this);\r\n    }\r\n    get logLevel() {\r\n        return this._logLevel;\r\n    }\r\n    set logLevel(val) {\r\n        if (!(val in LogLevel)) {\r\n            throw new TypeError(`Invalid value \"${val}\" assigned to \\`logLevel\\``);\r\n        }\r\n        this._logLevel = val;\r\n    }\r\n    // Workaround for setter/getter having to be the same type.\r\n    setLogLevel(val) {\r\n        this._logLevel = typeof val === 'string' ? levelStringToEnum[val] : val;\r\n    }\r\n    get logHandler() {\r\n        return this._logHandler;\r\n    }\r\n    set logHandler(val) {\r\n        if (typeof val !== 'function') {\r\n            throw new TypeError('Value assigned to `logHandler` must be a function');\r\n        }\r\n        this._logHandler = val;\r\n    }\r\n    get userLogHandler() {\r\n        return this._userLogHandler;\r\n    }\r\n    set userLogHandler(val) {\r\n        this._userLogHandler = val;\r\n    }\r\n    /**\r\n     * The functions below are all based on the `console` interface\r\n     */\r\n    debug(...args) {\r\n        this._userLogHandler && this._userLogHandler(this, LogLevel.DEBUG, ...args);\r\n        this._logHandler(this, LogLevel.DEBUG, ...args);\r\n    }\r\n    log(...args) {\r\n        this._userLogHandler &&\r\n            this._userLogHandler(this, LogLevel.VERBOSE, ...args);\r\n        this._logHandler(this, LogLevel.VERBOSE, ...args);\r\n    }\r\n    info(...args) {\r\n        this._userLogHandler && this._userLogHandler(this, LogLevel.INFO, ...args);\r\n        this._logHandler(this, LogLevel.INFO, ...args);\r\n    }\r\n    warn(...args) {\r\n        this._userLogHandler && this._userLogHandler(this, LogLevel.WARN, ...args);\r\n        this._logHandler(this, LogLevel.WARN, ...args);\r\n    }\r\n    error(...args) {\r\n        this._userLogHandler && this._userLogHandler(this, LogLevel.ERROR, ...args);\r\n        this._logHandler(this, LogLevel.ERROR, ...args);\r\n    }\r\n}\r\nfunction setLogLevel(level) {\r\n    instances.forEach(inst => {\r\n        inst.setLogLevel(level);\r\n    });\r\n}\r\nfunction setUserLogHandler(logCallback, options) {\r\n    for (const instance of instances) {\r\n        let customLogLevel = null;\r\n        if (options && options.level) {\r\n            customLogLevel = levelStringToEnum[options.level];\r\n        }\r\n        if (logCallback === null) {\r\n            instance.userLogHandler = null;\r\n        }\r\n        else {\r\n            instance.userLogHandler = (instance, level, ...args) => {\r\n                const message = args\r\n                    .map(arg => {\r\n                    if (arg == null) {\r\n                        return null;\r\n                    }\r\n                    else if (typeof arg === 'string') {\r\n                        return arg;\r\n                    }\r\n                    else if (typeof arg === 'number' || typeof arg === 'boolean') {\r\n                        return arg.toString();\r\n                    }\r\n                    else if (arg instanceof Error) {\r\n                        return arg.message;\r\n                    }\r\n                    else {\r\n                        try {\r\n                            return JSON.stringify(arg);\r\n                        }\r\n                        catch (ignored) {\r\n                            return null;\r\n                        }\r\n                    }\r\n                })\r\n                    .filter(arg => arg)\r\n                    .join(' ');\r\n                if (level >= (customLogLevel !== null && customLogLevel !== void 0 ? customLogLevel : instance.logLevel)) {\r\n                    logCallback({\r\n                        level: LogLevel[level].toLowerCase(),\r\n                        message,\r\n                        args,\r\n                        type: instance.name\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    }\r\n}\n\nexport { LogLevel, Logger, setLogLevel, setUserLogHandler };\n//# sourceMappingURL=index.esm2017.js.map\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","import { Component, ComponentContainer } from '@firebase/component';\nimport { Logger, setUserLogHandler, setLogLevel as setLogLevel$1 } from '@firebase/logger';\nimport { ErrorFactory, getDefaultAppConfig, deepEqual, isBrowser, isWebWorker, FirebaseError, base64urlEncodeWithoutPadding, isIndexedDBAvailable, validateIndexedDBOpenable } from '@firebase/util';\nexport { FirebaseError } from '@firebase/util';\nimport { openDB } from 'idb';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass PlatformLoggerServiceImpl {\r\n    constructor(container) {\r\n        this.container = container;\r\n    }\r\n    // In initial implementation, this will be called by installations on\r\n    // auth token refresh, and installations will send this string.\r\n    getPlatformInfoString() {\r\n        const providers = this.container.getProviders();\r\n        // Loop through providers and get library/version pairs from any that are\r\n        // version components.\r\n        return providers\r\n            .map(provider => {\r\n            if (isVersionServiceProvider(provider)) {\r\n                const service = provider.getImmediate();\r\n                return `${service.library}/${service.version}`;\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        })\r\n            .filter(logString => logString)\r\n            .join(' ');\r\n    }\r\n}\r\n/**\r\n *\r\n * @param provider check if this provider provides a VersionService\r\n *\r\n * NOTE: Using Provider<'app-version'> is a hack to indicate that the provider\r\n * provides VersionService. The provider is not necessarily a 'app-version'\r\n * provider.\r\n */\r\nfunction isVersionServiceProvider(provider) {\r\n    const component = provider.getComponent();\r\n    return (component === null || component === void 0 ? void 0 : component.type) === \"VERSION\" /* ComponentType.VERSION */;\r\n}\n\nconst name$q = \"@firebase/app\";\nconst version$1 = \"0.10.13\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst logger = new Logger('@firebase/app');\n\nconst name$p = \"@firebase/app-compat\";\n\nconst name$o = \"@firebase/analytics-compat\";\n\nconst name$n = \"@firebase/analytics\";\n\nconst name$m = \"@firebase/app-check-compat\";\n\nconst name$l = \"@firebase/app-check\";\n\nconst name$k = \"@firebase/auth\";\n\nconst name$j = \"@firebase/auth-compat\";\n\nconst name$i = \"@firebase/database\";\n\nconst name$h = \"@firebase/data-connect\";\n\nconst name$g = \"@firebase/database-compat\";\n\nconst name$f = \"@firebase/functions\";\n\nconst name$e = \"@firebase/functions-compat\";\n\nconst name$d = \"@firebase/installations\";\n\nconst name$c = \"@firebase/installations-compat\";\n\nconst name$b = \"@firebase/messaging\";\n\nconst name$a = \"@firebase/messaging-compat\";\n\nconst name$9 = \"@firebase/performance\";\n\nconst name$8 = \"@firebase/performance-compat\";\n\nconst name$7 = \"@firebase/remote-config\";\n\nconst name$6 = \"@firebase/remote-config-compat\";\n\nconst name$5 = \"@firebase/storage\";\n\nconst name$4 = \"@firebase/storage-compat\";\n\nconst name$3 = \"@firebase/firestore\";\n\nconst name$2 = \"@firebase/vertexai-preview\";\n\nconst name$1 = \"@firebase/firestore-compat\";\n\nconst name = \"firebase\";\nconst version = \"10.14.1\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The default app name\r\n *\r\n * @internal\r\n */\r\nconst DEFAULT_ENTRY_NAME = '[DEFAULT]';\r\nconst PLATFORM_LOG_STRING = {\r\n    [name$q]: 'fire-core',\r\n    [name$p]: 'fire-core-compat',\r\n    [name$n]: 'fire-analytics',\r\n    [name$o]: 'fire-analytics-compat',\r\n    [name$l]: 'fire-app-check',\r\n    [name$m]: 'fire-app-check-compat',\r\n    [name$k]: 'fire-auth',\r\n    [name$j]: 'fire-auth-compat',\r\n    [name$i]: 'fire-rtdb',\r\n    [name$h]: 'fire-data-connect',\r\n    [name$g]: 'fire-rtdb-compat',\r\n    [name$f]: 'fire-fn',\r\n    [name$e]: 'fire-fn-compat',\r\n    [name$d]: 'fire-iid',\r\n    [name$c]: 'fire-iid-compat',\r\n    [name$b]: 'fire-fcm',\r\n    [name$a]: 'fire-fcm-compat',\r\n    [name$9]: 'fire-perf',\r\n    [name$8]: 'fire-perf-compat',\r\n    [name$7]: 'fire-rc',\r\n    [name$6]: 'fire-rc-compat',\r\n    [name$5]: 'fire-gcs',\r\n    [name$4]: 'fire-gcs-compat',\r\n    [name$3]: 'fire-fst',\r\n    [name$1]: 'fire-fst-compat',\r\n    [name$2]: 'fire-vertex',\r\n    'fire-js': 'fire-js',\r\n    [name]: 'fire-js-all'\r\n};\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @internal\r\n */\r\nconst _apps = new Map();\r\n/**\r\n * @internal\r\n */\r\nconst _serverApps = new Map();\r\n/**\r\n * Registered components.\r\n *\r\n * @internal\r\n */\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nconst _components = new Map();\r\n/**\r\n * @param component - the component being added to this app's container\r\n *\r\n * @internal\r\n */\r\nfunction _addComponent(app, component) {\r\n    try {\r\n        app.container.addComponent(component);\r\n    }\r\n    catch (e) {\r\n        logger.debug(`Component ${component.name} failed to register with FirebaseApp ${app.name}`, e);\r\n    }\r\n}\r\n/**\r\n *\r\n * @internal\r\n */\r\nfunction _addOrOverwriteComponent(app, component) {\r\n    app.container.addOrOverwriteComponent(component);\r\n}\r\n/**\r\n *\r\n * @param component - the component to register\r\n * @returns whether or not the component is registered successfully\r\n *\r\n * @internal\r\n */\r\nfunction _registerComponent(component) {\r\n    const componentName = component.name;\r\n    if (_components.has(componentName)) {\r\n        logger.debug(`There were multiple attempts to register component ${componentName}.`);\r\n        return false;\r\n    }\r\n    _components.set(componentName, component);\r\n    // add the component to existing app instances\r\n    for (const app of _apps.values()) {\r\n        _addComponent(app, component);\r\n    }\r\n    for (const serverApp of _serverApps.values()) {\r\n        _addComponent(serverApp, component);\r\n    }\r\n    return true;\r\n}\r\n/**\r\n *\r\n * @param app - FirebaseApp instance\r\n * @param name - service name\r\n *\r\n * @returns the provider for the service with the matching name\r\n *\r\n * @internal\r\n */\r\nfunction _getProvider(app, name) {\r\n    const heartbeatController = app.container\r\n        .getProvider('heartbeat')\r\n        .getImmediate({ optional: true });\r\n    if (heartbeatController) {\r\n        void heartbeatController.triggerHeartbeat();\r\n    }\r\n    return app.container.getProvider(name);\r\n}\r\n/**\r\n *\r\n * @param app - FirebaseApp instance\r\n * @param name - service name\r\n * @param instanceIdentifier - service instance identifier in case the service supports multiple instances\r\n *\r\n * @internal\r\n */\r\nfunction _removeServiceInstance(app, name, instanceIdentifier = DEFAULT_ENTRY_NAME) {\r\n    _getProvider(app, name).clearInstance(instanceIdentifier);\r\n}\r\n/**\r\n *\r\n * @param obj - an object of type FirebaseApp or FirebaseOptions.\r\n *\r\n * @returns true if the provide object is of type FirebaseApp.\r\n *\r\n * @internal\r\n */\r\nfunction _isFirebaseApp(obj) {\r\n    return obj.options !== undefined;\r\n}\r\n/**\r\n *\r\n * @param obj - an object of type FirebaseApp.\r\n *\r\n * @returns true if the provided object is of type FirebaseServerAppImpl.\r\n *\r\n * @internal\r\n */\r\nfunction _isFirebaseServerApp(obj) {\r\n    return obj.settings !== undefined;\r\n}\r\n/**\r\n * Test only\r\n *\r\n * @internal\r\n */\r\nfunction _clearComponents() {\r\n    _components.clear();\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst ERRORS = {\r\n    [\"no-app\" /* AppError.NO_APP */]: \"No Firebase App '{$appName}' has been created - \" +\r\n        'call initializeApp() first',\r\n    [\"bad-app-name\" /* AppError.BAD_APP_NAME */]: \"Illegal App name: '{$appName}'\",\r\n    [\"duplicate-app\" /* AppError.DUPLICATE_APP */]: \"Firebase App named '{$appName}' already exists with different options or config\",\r\n    [\"app-deleted\" /* AppError.APP_DELETED */]: \"Firebase App named '{$appName}' already deleted\",\r\n    [\"server-app-deleted\" /* AppError.SERVER_APP_DELETED */]: 'Firebase Server App has been deleted',\r\n    [\"no-options\" /* AppError.NO_OPTIONS */]: 'Need to provide options, when not being deployed to hosting via source.',\r\n    [\"invalid-app-argument\" /* AppError.INVALID_APP_ARGUMENT */]: 'firebase.{$appName}() takes either no argument or a ' +\r\n        'Firebase App instance.',\r\n    [\"invalid-log-argument\" /* AppError.INVALID_LOG_ARGUMENT */]: 'First argument to `onLog` must be null or a function.',\r\n    [\"idb-open\" /* AppError.IDB_OPEN */]: 'Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.',\r\n    [\"idb-get\" /* AppError.IDB_GET */]: 'Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.',\r\n    [\"idb-set\" /* AppError.IDB_WRITE */]: 'Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.',\r\n    [\"idb-delete\" /* AppError.IDB_DELETE */]: 'Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.',\r\n    [\"finalization-registry-not-supported\" /* AppError.FINALIZATION_REGISTRY_NOT_SUPPORTED */]: 'FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.',\r\n    [\"invalid-server-app-environment\" /* AppError.INVALID_SERVER_APP_ENVIRONMENT */]: 'FirebaseServerApp is not for use in browser environments.'\r\n};\r\nconst ERROR_FACTORY = new ErrorFactory('app', 'Firebase', ERRORS);\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass FirebaseAppImpl {\r\n    constructor(options, config, container) {\r\n        this._isDeleted = false;\r\n        this._options = Object.assign({}, options);\r\n        this._config = Object.assign({}, config);\r\n        this._name = config.name;\r\n        this._automaticDataCollectionEnabled =\r\n            config.automaticDataCollectionEnabled;\r\n        this._container = container;\r\n        this.container.addComponent(new Component('app', () => this, \"PUBLIC\" /* ComponentType.PUBLIC */));\r\n    }\r\n    get automaticDataCollectionEnabled() {\r\n        this.checkDestroyed();\r\n        return this._automaticDataCollectionEnabled;\r\n    }\r\n    set automaticDataCollectionEnabled(val) {\r\n        this.checkDestroyed();\r\n        this._automaticDataCollectionEnabled = val;\r\n    }\r\n    get name() {\r\n        this.checkDestroyed();\r\n        return this._name;\r\n    }\r\n    get options() {\r\n        this.checkDestroyed();\r\n        return this._options;\r\n    }\r\n    get config() {\r\n        this.checkDestroyed();\r\n        return this._config;\r\n    }\r\n    get container() {\r\n        return this._container;\r\n    }\r\n    get isDeleted() {\r\n        return this._isDeleted;\r\n    }\r\n    set isDeleted(val) {\r\n        this._isDeleted = val;\r\n    }\r\n    /**\r\n     * This function will throw an Error if the App has already been deleted -\r\n     * use before performing API actions on the App.\r\n     */\r\n    checkDestroyed() {\r\n        if (this.isDeleted) {\r\n            throw ERROR_FACTORY.create(\"app-deleted\" /* AppError.APP_DELETED */, { appName: this._name });\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass FirebaseServerAppImpl extends FirebaseAppImpl {\r\n    constructor(options, serverConfig, name, container) {\r\n        // Build configuration parameters for the FirebaseAppImpl base class.\r\n        const automaticDataCollectionEnabled = serverConfig.automaticDataCollectionEnabled !== undefined\r\n            ? serverConfig.automaticDataCollectionEnabled\r\n            : false;\r\n        // Create the FirebaseAppSettings object for the FirebaseAppImp constructor.\r\n        const config = {\r\n            name,\r\n            automaticDataCollectionEnabled\r\n        };\r\n        if (options.apiKey !== undefined) {\r\n            // Construct the parent FirebaseAppImp object.\r\n            super(options, config, container);\r\n        }\r\n        else {\r\n            const appImpl = options;\r\n            super(appImpl.options, config, container);\r\n        }\r\n        // Now construct the data for the FirebaseServerAppImpl.\r\n        this._serverConfig = Object.assign({ automaticDataCollectionEnabled }, serverConfig);\r\n        this._finalizationRegistry = null;\r\n        if (typeof FinalizationRegistry !== 'undefined') {\r\n            this._finalizationRegistry = new FinalizationRegistry(() => {\r\n                this.automaticCleanup();\r\n            });\r\n        }\r\n        this._refCount = 0;\r\n        this.incRefCount(this._serverConfig.releaseOnDeref);\r\n        // Do not retain a hard reference to the dref object, otherwise the FinalizationRegistry\r\n        // will never trigger.\r\n        this._serverConfig.releaseOnDeref = undefined;\r\n        serverConfig.releaseOnDeref = undefined;\r\n        registerVersion(name$q, version$1, 'serverapp');\r\n    }\r\n    toJSON() {\r\n        return undefined;\r\n    }\r\n    get refCount() {\r\n        return this._refCount;\r\n    }\r\n    // Increment the reference count of this server app. If an object is provided, register it\r\n    // with the finalization registry.\r\n    incRefCount(obj) {\r\n        if (this.isDeleted) {\r\n            return;\r\n        }\r\n        this._refCount++;\r\n        if (obj !== undefined && this._finalizationRegistry !== null) {\r\n            this._finalizationRegistry.register(obj, this);\r\n        }\r\n    }\r\n    // Decrement the reference count.\r\n    decRefCount() {\r\n        if (this.isDeleted) {\r\n            return 0;\r\n        }\r\n        return --this._refCount;\r\n    }\r\n    // Invoked by the FinalizationRegistry callback to note that this app should go through its\r\n    // reference counts and delete itself if no reference count remain. The coordinating logic that\r\n    // handles this is in deleteApp(...).\r\n    automaticCleanup() {\r\n        void deleteApp(this);\r\n    }\r\n    get settings() {\r\n        this.checkDestroyed();\r\n        return this._serverConfig;\r\n    }\r\n    /**\r\n     * This function will throw an Error if the App has already been deleted -\r\n     * use before performing API actions on the App.\r\n     */\r\n    checkDestroyed() {\r\n        if (this.isDeleted) {\r\n            throw ERROR_FACTORY.create(\"server-app-deleted\" /* AppError.SERVER_APP_DELETED */);\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The current SDK version.\r\n *\r\n * @public\r\n */\r\nconst SDK_VERSION = version;\r\nfunction initializeApp(_options, rawConfig = {}) {\r\n    let options = _options;\r\n    if (typeof rawConfig !== 'object') {\r\n        const name = rawConfig;\r\n        rawConfig = { name };\r\n    }\r\n    const config = Object.assign({ name: DEFAULT_ENTRY_NAME, automaticDataCollectionEnabled: false }, rawConfig);\r\n    const name = config.name;\r\n    if (typeof name !== 'string' || !name) {\r\n        throw ERROR_FACTORY.create(\"bad-app-name\" /* AppError.BAD_APP_NAME */, {\r\n            appName: String(name)\r\n        });\r\n    }\r\n    options || (options = getDefaultAppConfig());\r\n    if (!options) {\r\n        throw ERROR_FACTORY.create(\"no-options\" /* AppError.NO_OPTIONS */);\r\n    }\r\n    const existingApp = _apps.get(name);\r\n    if (existingApp) {\r\n        // return the existing app if options and config deep equal the ones in the existing app.\r\n        if (deepEqual(options, existingApp.options) &&\r\n            deepEqual(config, existingApp.config)) {\r\n            return existingApp;\r\n        }\r\n        else {\r\n            throw ERROR_FACTORY.create(\"duplicate-app\" /* AppError.DUPLICATE_APP */, { appName: name });\r\n        }\r\n    }\r\n    const container = new ComponentContainer(name);\r\n    for (const component of _components.values()) {\r\n        container.addComponent(component);\r\n    }\r\n    const newApp = new FirebaseAppImpl(options, config, container);\r\n    _apps.set(name, newApp);\r\n    return newApp;\r\n}\r\nfunction initializeServerApp(_options, _serverAppConfig) {\r\n    if (isBrowser() && !isWebWorker()) {\r\n        // FirebaseServerApp isn't designed to be run in browsers.\r\n        throw ERROR_FACTORY.create(\"invalid-server-app-environment\" /* AppError.INVALID_SERVER_APP_ENVIRONMENT */);\r\n    }\r\n    if (_serverAppConfig.automaticDataCollectionEnabled === undefined) {\r\n        _serverAppConfig.automaticDataCollectionEnabled = false;\r\n    }\r\n    let appOptions;\r\n    if (_isFirebaseApp(_options)) {\r\n        appOptions = _options.options;\r\n    }\r\n    else {\r\n        appOptions = _options;\r\n    }\r\n    // Build an app name based on a hash of the configuration options.\r\n    const nameObj = Object.assign(Object.assign({}, _serverAppConfig), appOptions);\r\n    // However, Do not mangle the name based on releaseOnDeref, since it will vary between the\r\n    // construction of FirebaseServerApp instances. For example, if the object is the request headers.\r\n    if (nameObj.releaseOnDeref !== undefined) {\r\n        delete nameObj.releaseOnDeref;\r\n    }\r\n    const hashCode = (s) => {\r\n        return [...s].reduce((hash, c) => (Math.imul(31, hash) + c.charCodeAt(0)) | 0, 0);\r\n    };\r\n    if (_serverAppConfig.releaseOnDeref !== undefined) {\r\n        if (typeof FinalizationRegistry === 'undefined') {\r\n            throw ERROR_FACTORY.create(\"finalization-registry-not-supported\" /* AppError.FINALIZATION_REGISTRY_NOT_SUPPORTED */, {});\r\n        }\r\n    }\r\n    const nameString = '' + hashCode(JSON.stringify(nameObj));\r\n    const existingApp = _serverApps.get(nameString);\r\n    if (existingApp) {\r\n        existingApp.incRefCount(_serverAppConfig.releaseOnDeref);\r\n        return existingApp;\r\n    }\r\n    const container = new ComponentContainer(nameString);\r\n    for (const component of _components.values()) {\r\n        container.addComponent(component);\r\n    }\r\n    const newApp = new FirebaseServerAppImpl(appOptions, _serverAppConfig, nameString, container);\r\n    _serverApps.set(nameString, newApp);\r\n    return newApp;\r\n}\r\n/**\r\n * Retrieves a {@link @firebase/app#FirebaseApp} instance.\r\n *\r\n * When called with no arguments, the default app is returned. When an app name\r\n * is provided, the app corresponding to that name is returned.\r\n *\r\n * An exception is thrown if the app being retrieved has not yet been\r\n * initialized.\r\n *\r\n * @example\r\n * ```javascript\r\n * // Return the default app\r\n * const app = getApp();\r\n * ```\r\n *\r\n * @example\r\n * ```javascript\r\n * // Return a named app\r\n * const otherApp = getApp(\"otherApp\");\r\n * ```\r\n *\r\n * @param name - Optional name of the app to return. If no name is\r\n *   provided, the default is `\"[DEFAULT]\"`.\r\n *\r\n * @returns The app corresponding to the provided app name.\r\n *   If no app name is provided, the default app is returned.\r\n *\r\n * @public\r\n */\r\nfunction getApp(name = DEFAULT_ENTRY_NAME) {\r\n    const app = _apps.get(name);\r\n    if (!app && name === DEFAULT_ENTRY_NAME && getDefaultAppConfig()) {\r\n        return initializeApp();\r\n    }\r\n    if (!app) {\r\n        throw ERROR_FACTORY.create(\"no-app\" /* AppError.NO_APP */, { appName: name });\r\n    }\r\n    return app;\r\n}\r\n/**\r\n * A (read-only) array of all initialized apps.\r\n * @public\r\n */\r\nfunction getApps() {\r\n    return Array.from(_apps.values());\r\n}\r\n/**\r\n * Renders this app unusable and frees the resources of all associated\r\n * services.\r\n *\r\n * @example\r\n * ```javascript\r\n * deleteApp(app)\r\n *   .then(function() {\r\n *     console.log(\"App deleted successfully\");\r\n *   })\r\n *   .catch(function(error) {\r\n *     console.log(\"Error deleting app:\", error);\r\n *   });\r\n * ```\r\n *\r\n * @public\r\n */\r\nasync function deleteApp(app) {\r\n    let cleanupProviders = false;\r\n    const name = app.name;\r\n    if (_apps.has(name)) {\r\n        cleanupProviders = true;\r\n        _apps.delete(name);\r\n    }\r\n    else if (_serverApps.has(name)) {\r\n        const firebaseServerApp = app;\r\n        if (firebaseServerApp.decRefCount() <= 0) {\r\n            _serverApps.delete(name);\r\n            cleanupProviders = true;\r\n        }\r\n    }\r\n    if (cleanupProviders) {\r\n        await Promise.all(app.container\r\n            .getProviders()\r\n            .map(provider => provider.delete()));\r\n        app.isDeleted = true;\r\n    }\r\n}\r\n/**\r\n * Registers a library's name and version for platform logging purposes.\r\n * @param library - Name of 1p or 3p library (e.g. firestore, angularfire)\r\n * @param version - Current version of that library.\r\n * @param variant - Bundle variant, e.g., node, rn, etc.\r\n *\r\n * @public\r\n */\r\nfunction registerVersion(libraryKeyOrName, version, variant) {\r\n    var _a;\r\n    // TODO: We can use this check to whitelist strings when/if we set up\r\n    // a good whitelist system.\r\n    let library = (_a = PLATFORM_LOG_STRING[libraryKeyOrName]) !== null && _a !== void 0 ? _a : libraryKeyOrName;\r\n    if (variant) {\r\n        library += `-${variant}`;\r\n    }\r\n    const libraryMismatch = library.match(/\\s|\\//);\r\n    const versionMismatch = version.match(/\\s|\\//);\r\n    if (libraryMismatch || versionMismatch) {\r\n        const warning = [\r\n            `Unable to register library \"${library}\" with version \"${version}\":`\r\n        ];\r\n        if (libraryMismatch) {\r\n            warning.push(`library name \"${library}\" contains illegal characters (whitespace or \"/\")`);\r\n        }\r\n        if (libraryMismatch && versionMismatch) {\r\n            warning.push('and');\r\n        }\r\n        if (versionMismatch) {\r\n            warning.push(`version name \"${version}\" contains illegal characters (whitespace or \"/\")`);\r\n        }\r\n        logger.warn(warning.join(' '));\r\n        return;\r\n    }\r\n    _registerComponent(new Component(`${library}-version`, () => ({ library, version }), \"VERSION\" /* ComponentType.VERSION */));\r\n}\r\n/**\r\n * Sets log handler for all Firebase SDKs.\r\n * @param logCallback - An optional custom log handler that executes user code whenever\r\n * the Firebase SDK makes a logging call.\r\n *\r\n * @public\r\n */\r\nfunction onLog(logCallback, options) {\r\n    if (logCallback !== null && typeof logCallback !== 'function') {\r\n        throw ERROR_FACTORY.create(\"invalid-log-argument\" /* AppError.INVALID_LOG_ARGUMENT */);\r\n    }\r\n    setUserLogHandler(logCallback, options);\r\n}\r\n/**\r\n * Sets log level for all Firebase SDKs.\r\n *\r\n * All of the log types above the current log level are captured (i.e. if\r\n * you set the log level to `info`, errors are logged, but `debug` and\r\n * `verbose` logs are not).\r\n *\r\n * @public\r\n */\r\nfunction setLogLevel(logLevel) {\r\n    setLogLevel$1(logLevel);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst DB_NAME = 'firebase-heartbeat-database';\r\nconst DB_VERSION = 1;\r\nconst STORE_NAME = 'firebase-heartbeat-store';\r\nlet dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDB(DB_NAME, DB_VERSION, {\r\n            upgrade: (db, oldVersion) => {\r\n                // We don't use 'break' in this switch statement, the fall-through\r\n                // behavior is what we want, because if there are multiple versions between\r\n                // the old version and the current version, we want ALL the migrations\r\n                // that correspond to those versions to run, not only the last one.\r\n                // eslint-disable-next-line default-case\r\n                switch (oldVersion) {\r\n                    case 0:\r\n                        try {\r\n                            db.createObjectStore(STORE_NAME);\r\n                        }\r\n                        catch (e) {\r\n                            // Safari/iOS browsers throw occasional exceptions on\r\n                            // db.createObjectStore() that may be a bug. Avoid blocking\r\n                            // the rest of the app functionality.\r\n                            console.warn(e);\r\n                        }\r\n                }\r\n            }\r\n        }).catch(e => {\r\n            throw ERROR_FACTORY.create(\"idb-open\" /* AppError.IDB_OPEN */, {\r\n                originalErrorMessage: e.message\r\n            });\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\nasync function readHeartbeatsFromIndexedDB(app) {\r\n    try {\r\n        const db = await getDbPromise();\r\n        const tx = db.transaction(STORE_NAME);\r\n        const result = await tx.objectStore(STORE_NAME).get(computeKey(app));\r\n        // We already have the value but tx.done can throw,\r\n        // so we need to await it here to catch errors\r\n        await tx.done;\r\n        return result;\r\n    }\r\n    catch (e) {\r\n        if (e instanceof FirebaseError) {\r\n            logger.warn(e.message);\r\n        }\r\n        else {\r\n            const idbGetError = ERROR_FACTORY.create(\"idb-get\" /* AppError.IDB_GET */, {\r\n                originalErrorMessage: e === null || e === void 0 ? void 0 : e.message\r\n            });\r\n            logger.warn(idbGetError.message);\r\n        }\r\n    }\r\n}\r\nasync function writeHeartbeatsToIndexedDB(app, heartbeatObject) {\r\n    try {\r\n        const db = await getDbPromise();\r\n        const tx = db.transaction(STORE_NAME, 'readwrite');\r\n        const objectStore = tx.objectStore(STORE_NAME);\r\n        await objectStore.put(heartbeatObject, computeKey(app));\r\n        await tx.done;\r\n    }\r\n    catch (e) {\r\n        if (e instanceof FirebaseError) {\r\n            logger.warn(e.message);\r\n        }\r\n        else {\r\n            const idbGetError = ERROR_FACTORY.create(\"idb-set\" /* AppError.IDB_WRITE */, {\r\n                originalErrorMessage: e === null || e === void 0 ? void 0 : e.message\r\n            });\r\n            logger.warn(idbGetError.message);\r\n        }\r\n    }\r\n}\r\nfunction computeKey(app) {\r\n    return `${app.name}!${app.options.appId}`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst MAX_HEADER_BYTES = 1024;\r\n// 30 days\r\nconst STORED_HEARTBEAT_RETENTION_MAX_MILLIS = 30 * 24 * 60 * 60 * 1000;\r\nclass HeartbeatServiceImpl {\r\n    constructor(container) {\r\n        this.container = container;\r\n        /**\r\n         * In-memory cache for heartbeats, used by getHeartbeatsHeader() to generate\r\n         * the header string.\r\n         * Stores one record per date. This will be consolidated into the standard\r\n         * format of one record per user agent string before being sent as a header.\r\n         * Populated from indexedDB when the controller is instantiated and should\r\n         * be kept in sync with indexedDB.\r\n         * Leave public for easier testing.\r\n         */\r\n        this._heartbeatsCache = null;\r\n        const app = this.container.getProvider('app').getImmediate();\r\n        this._storage = new HeartbeatStorageImpl(app);\r\n        this._heartbeatsCachePromise = this._storage.read().then(result => {\r\n            this._heartbeatsCache = result;\r\n            return result;\r\n        });\r\n    }\r\n    /**\r\n     * Called to report a heartbeat. The function will generate\r\n     * a HeartbeatsByUserAgent object, update heartbeatsCache, and persist it\r\n     * to IndexedDB.\r\n     * Note that we only store one heartbeat per day. So if a heartbeat for today is\r\n     * already logged, subsequent calls to this function in the same day will be ignored.\r\n     */\r\n    async triggerHeartbeat() {\r\n        var _a, _b;\r\n        try {\r\n            const platformLogger = this.container\r\n                .getProvider('platform-logger')\r\n                .getImmediate();\r\n            // This is the \"Firebase user agent\" string from the platform logger\r\n            // service, not the browser user agent.\r\n            const agent = platformLogger.getPlatformInfoString();\r\n            const date = getUTCDateString();\r\n            if (((_a = this._heartbeatsCache) === null || _a === void 0 ? void 0 : _a.heartbeats) == null) {\r\n                this._heartbeatsCache = await this._heartbeatsCachePromise;\r\n                // If we failed to construct a heartbeats cache, then return immediately.\r\n                if (((_b = this._heartbeatsCache) === null || _b === void 0 ? void 0 : _b.heartbeats) == null) {\r\n                    return;\r\n                }\r\n            }\r\n            // Do not store a heartbeat if one is already stored for this day\r\n            // or if a header has already been sent today.\r\n            if (this._heartbeatsCache.lastSentHeartbeatDate === date ||\r\n                this._heartbeatsCache.heartbeats.some(singleDateHeartbeat => singleDateHeartbeat.date === date)) {\r\n                return;\r\n            }\r\n            else {\r\n                // There is no entry for this date. Create one.\r\n                this._heartbeatsCache.heartbeats.push({ date, agent });\r\n            }\r\n            // Remove entries older than 30 days.\r\n            this._heartbeatsCache.heartbeats =\r\n                this._heartbeatsCache.heartbeats.filter(singleDateHeartbeat => {\r\n                    const hbTimestamp = new Date(singleDateHeartbeat.date).valueOf();\r\n                    const now = Date.now();\r\n                    return now - hbTimestamp <= STORED_HEARTBEAT_RETENTION_MAX_MILLIS;\r\n                });\r\n            return this._storage.overwrite(this._heartbeatsCache);\r\n        }\r\n        catch (e) {\r\n            logger.warn(e);\r\n        }\r\n    }\r\n    /**\r\n     * Returns a base64 encoded string which can be attached to the heartbeat-specific header directly.\r\n     * It also clears all heartbeats from memory as well as in IndexedDB.\r\n     *\r\n     * NOTE: Consuming product SDKs should not send the header if this method\r\n     * returns an empty string.\r\n     */\r\n    async getHeartbeatsHeader() {\r\n        var _a;\r\n        try {\r\n            if (this._heartbeatsCache === null) {\r\n                await this._heartbeatsCachePromise;\r\n            }\r\n            // If it's still null or the array is empty, there is no data to send.\r\n            if (((_a = this._heartbeatsCache) === null || _a === void 0 ? void 0 : _a.heartbeats) == null ||\r\n                this._heartbeatsCache.heartbeats.length === 0) {\r\n                return '';\r\n            }\r\n            const date = getUTCDateString();\r\n            // Extract as many heartbeats from the cache as will fit under the size limit.\r\n            const { heartbeatsToSend, unsentEntries } = extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats);\r\n            const headerString = base64urlEncodeWithoutPadding(JSON.stringify({ version: 2, heartbeats: heartbeatsToSend }));\r\n            // Store last sent date to prevent another being logged/sent for the same day.\r\n            this._heartbeatsCache.lastSentHeartbeatDate = date;\r\n            if (unsentEntries.length > 0) {\r\n                // Store any unsent entries if they exist.\r\n                this._heartbeatsCache.heartbeats = unsentEntries;\r\n                // This seems more likely than emptying the array (below) to lead to some odd state\r\n                // since the cache isn't empty and this will be called again on the next request,\r\n                // and is probably safest if we await it.\r\n                await this._storage.overwrite(this._heartbeatsCache);\r\n            }\r\n            else {\r\n                this._heartbeatsCache.heartbeats = [];\r\n                // Do not wait for this, to reduce latency.\r\n                void this._storage.overwrite(this._heartbeatsCache);\r\n            }\r\n            return headerString;\r\n        }\r\n        catch (e) {\r\n            logger.warn(e);\r\n            return '';\r\n        }\r\n    }\r\n}\r\nfunction getUTCDateString() {\r\n    const today = new Date();\r\n    // Returns date format 'YYYY-MM-DD'\r\n    return today.toISOString().substring(0, 10);\r\n}\r\nfunction extractHeartbeatsForHeader(heartbeatsCache, maxSize = MAX_HEADER_BYTES) {\r\n    // Heartbeats grouped by user agent in the standard format to be sent in\r\n    // the header.\r\n    const heartbeatsToSend = [];\r\n    // Single date format heartbeats that are not sent.\r\n    let unsentEntries = heartbeatsCache.slice();\r\n    for (const singleDateHeartbeat of heartbeatsCache) {\r\n        // Look for an existing entry with the same user agent.\r\n        const heartbeatEntry = heartbeatsToSend.find(hb => hb.agent === singleDateHeartbeat.agent);\r\n        if (!heartbeatEntry) {\r\n            // If no entry for this user agent exists, create one.\r\n            heartbeatsToSend.push({\r\n                agent: singleDateHeartbeat.agent,\r\n                dates: [singleDateHeartbeat.date]\r\n            });\r\n            if (countBytes(heartbeatsToSend) > maxSize) {\r\n                // If the header would exceed max size, remove the added heartbeat\r\n                // entry and stop adding to the header.\r\n                heartbeatsToSend.pop();\r\n                break;\r\n            }\r\n        }\r\n        else {\r\n            heartbeatEntry.dates.push(singleDateHeartbeat.date);\r\n            // If the header would exceed max size, remove the added date\r\n            // and stop adding to the header.\r\n            if (countBytes(heartbeatsToSend) > maxSize) {\r\n                heartbeatEntry.dates.pop();\r\n                break;\r\n            }\r\n        }\r\n        // Pop unsent entry from queue. (Skipped if adding the entry exceeded\r\n        // quota and the loop breaks early.)\r\n        unsentEntries = unsentEntries.slice(1);\r\n    }\r\n    return {\r\n        heartbeatsToSend,\r\n        unsentEntries\r\n    };\r\n}\r\nclass HeartbeatStorageImpl {\r\n    constructor(app) {\r\n        this.app = app;\r\n        this._canUseIndexedDBPromise = this.runIndexedDBEnvironmentCheck();\r\n    }\r\n    async runIndexedDBEnvironmentCheck() {\r\n        if (!isIndexedDBAvailable()) {\r\n            return false;\r\n        }\r\n        else {\r\n            return validateIndexedDBOpenable()\r\n                .then(() => true)\r\n                .catch(() => false);\r\n        }\r\n    }\r\n    /**\r\n     * Read all heartbeats.\r\n     */\r\n    async read() {\r\n        const canUseIndexedDB = await this._canUseIndexedDBPromise;\r\n        if (!canUseIndexedDB) {\r\n            return { heartbeats: [] };\r\n        }\r\n        else {\r\n            const idbHeartbeatObject = await readHeartbeatsFromIndexedDB(this.app);\r\n            if (idbHeartbeatObject === null || idbHeartbeatObject === void 0 ? void 0 : idbHeartbeatObject.heartbeats) {\r\n                return idbHeartbeatObject;\r\n            }\r\n            else {\r\n                return { heartbeats: [] };\r\n            }\r\n        }\r\n    }\r\n    // overwrite the storage with the provided heartbeats\r\n    async overwrite(heartbeatsObject) {\r\n        var _a;\r\n        const canUseIndexedDB = await this._canUseIndexedDBPromise;\r\n        if (!canUseIndexedDB) {\r\n            return;\r\n        }\r\n        else {\r\n            const existingHeartbeatsObject = await this.read();\r\n            return writeHeartbeatsToIndexedDB(this.app, {\r\n                lastSentHeartbeatDate: (_a = heartbeatsObject.lastSentHeartbeatDate) !== null && _a !== void 0 ? _a : existingHeartbeatsObject.lastSentHeartbeatDate,\r\n                heartbeats: heartbeatsObject.heartbeats\r\n            });\r\n        }\r\n    }\r\n    // add heartbeats\r\n    async add(heartbeatsObject) {\r\n        var _a;\r\n        const canUseIndexedDB = await this._canUseIndexedDBPromise;\r\n        if (!canUseIndexedDB) {\r\n            return;\r\n        }\r\n        else {\r\n            const existingHeartbeatsObject = await this.read();\r\n            return writeHeartbeatsToIndexedDB(this.app, {\r\n                lastSentHeartbeatDate: (_a = heartbeatsObject.lastSentHeartbeatDate) !== null && _a !== void 0 ? _a : existingHeartbeatsObject.lastSentHeartbeatDate,\r\n                heartbeats: [\r\n                    ...existingHeartbeatsObject.heartbeats,\r\n                    ...heartbeatsObject.heartbeats\r\n                ]\r\n            });\r\n        }\r\n    }\r\n}\r\n/**\r\n * Calculate bytes of a HeartbeatsByUserAgent array after being wrapped\r\n * in a platform logging header JSON object, stringified, and converted\r\n * to base 64.\r\n */\r\nfunction countBytes(heartbeatsCache) {\r\n    // base64 has a restricted set of characters, all of which should be 1 byte.\r\n    return base64urlEncodeWithoutPadding(\r\n    // heartbeatsCache wrapper properties\r\n    JSON.stringify({ version: 2, heartbeats: heartbeatsCache })).length;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerCoreComponents(variant) {\r\n    _registerComponent(new Component('platform-logger', container => new PlatformLoggerServiceImpl(container), \"PRIVATE\" /* ComponentType.PRIVATE */));\r\n    _registerComponent(new Component('heartbeat', container => new HeartbeatServiceImpl(container), \"PRIVATE\" /* ComponentType.PRIVATE */));\r\n    // Register `app` package.\r\n    registerVersion(name$q, version$1, variant);\r\n    // BUILD_TARGET will be replaced by values like esm5, esm2017, cjs5, etc during the compilation\r\n    registerVersion(name$q, version$1, 'esm2017');\r\n    // Register platform SDK identifier (no version).\r\n    registerVersion('fire-js', '');\r\n}\n\n/**\r\n * Firebase App\r\n *\r\n * @remarks This package coordinates the communication between the different Firebase components\r\n * @packageDocumentation\r\n */\r\nregisterCoreComponents('');\n\nexport { SDK_VERSION, DEFAULT_ENTRY_NAME as _DEFAULT_ENTRY_NAME, _addComponent, _addOrOverwriteComponent, _apps, _clearComponents, _components, _getProvider, _isFirebaseApp, _isFirebaseServerApp, _registerComponent, _removeServiceInstance, _serverApps, deleteApp, getApp, getApps, initializeApp, initializeServerApp, onLog, registerVersion, setLogLevel };\n//# sourceMappingURL=index.esm2017.js.map\n","import { registerVersion } from '@firebase/app';\nexport * from '@firebase/app';\n\nvar name = \"firebase\";\nvar version = \"10.14.1\";\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nregisterVersion(name, version, 'app');\n//# sourceMappingURL=index.esm.js.map\n","import { _getProvider, getApp, SDK_VERSION as SDK_VERSION$1, _registerComponent, registerVersion } from '@firebase/app';\nimport { Component, ComponentContainer, Provider } from '@firebase/component';\nimport { stringify, jsonEval, contains, assert, isNodeSdk, stringToByteArray, Sha1, base64, deepCopy, base64Encode, isMobileCordova, stringLength, Deferred, safeGet, isAdmin, isValidFormat, isEmpty, isReactNative, assertionError, map, querystring, errorPrefix, getModularInstance, getDefaultEmulatorHostnameAndPort, createMockUserToken } from '@firebase/util';\nimport { Logger, LogLevel } from '@firebase/logger';\n\nconst name = \"@firebase/database\";\nconst version = \"1.0.8\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** The semver (www.semver.org) version of the SDK. */\r\nlet SDK_VERSION = '';\r\n/**\r\n * SDK_VERSION should be set before any database instance is created\r\n * @internal\r\n */\r\nfunction setSDKVersion(version) {\r\n    SDK_VERSION = version;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Wraps a DOM Storage object and:\r\n * - automatically encode objects as JSON strings before storing them to allow us to store arbitrary types.\r\n * - prefixes names with \"firebase:\" to avoid collisions with app data.\r\n *\r\n * We automatically (see storage.js) create two such wrappers, one for sessionStorage,\r\n * and one for localStorage.\r\n *\r\n */\r\nclass DOMStorageWrapper {\r\n    /**\r\n     * @param domStorage_ - The underlying storage object (e.g. localStorage or sessionStorage)\r\n     */\r\n    constructor(domStorage_) {\r\n        this.domStorage_ = domStorage_;\r\n        // Use a prefix to avoid collisions with other stuff saved by the app.\r\n        this.prefix_ = 'firebase:';\r\n    }\r\n    /**\r\n     * @param key - The key to save the value under\r\n     * @param value - The value being stored, or null to remove the key.\r\n     */\r\n    set(key, value) {\r\n        if (value == null) {\r\n            this.domStorage_.removeItem(this.prefixedName_(key));\r\n        }\r\n        else {\r\n            this.domStorage_.setItem(this.prefixedName_(key), stringify(value));\r\n        }\r\n    }\r\n    /**\r\n     * @returns The value that was stored under this key, or null\r\n     */\r\n    get(key) {\r\n        const storedVal = this.domStorage_.getItem(this.prefixedName_(key));\r\n        if (storedVal == null) {\r\n            return null;\r\n        }\r\n        else {\r\n            return jsonEval(storedVal);\r\n        }\r\n    }\r\n    remove(key) {\r\n        this.domStorage_.removeItem(this.prefixedName_(key));\r\n    }\r\n    prefixedName_(name) {\r\n        return this.prefix_ + name;\r\n    }\r\n    toString() {\r\n        return this.domStorage_.toString();\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An in-memory storage implementation that matches the API of DOMStorageWrapper\r\n * (TODO: create interface for both to implement).\r\n */\r\nclass MemoryStorage {\r\n    constructor() {\r\n        this.cache_ = {};\r\n        this.isInMemoryStorage = true;\r\n    }\r\n    set(key, value) {\r\n        if (value == null) {\r\n            delete this.cache_[key];\r\n        }\r\n        else {\r\n            this.cache_[key] = value;\r\n        }\r\n    }\r\n    get(key) {\r\n        if (contains(this.cache_, key)) {\r\n            return this.cache_[key];\r\n        }\r\n        return null;\r\n    }\r\n    remove(key) {\r\n        delete this.cache_[key];\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Helper to create a DOMStorageWrapper or else fall back to MemoryStorage.\r\n * TODO: Once MemoryStorage and DOMStorageWrapper have a shared interface this method annotation should change\r\n * to reflect this type\r\n *\r\n * @param domStorageName - Name of the underlying storage object\r\n *   (e.g. 'localStorage' or 'sessionStorage').\r\n * @returns Turning off type information until a common interface is defined.\r\n */\r\nconst createStoragefor = function (domStorageName) {\r\n    try {\r\n        // NOTE: just accessing \"localStorage\" or \"window['localStorage']\" may throw a security exception,\r\n        // so it must be inside the try/catch.\r\n        if (typeof window !== 'undefined' &&\r\n            typeof window[domStorageName] !== 'undefined') {\r\n            // Need to test cache. Just because it's here doesn't mean it works\r\n            const domStorage = window[domStorageName];\r\n            domStorage.setItem('firebase:sentinel', 'cache');\r\n            domStorage.removeItem('firebase:sentinel');\r\n            return new DOMStorageWrapper(domStorage);\r\n        }\r\n    }\r\n    catch (e) { }\r\n    // Failed to create wrapper.  Just return in-memory storage.\r\n    // TODO: log?\r\n    return new MemoryStorage();\r\n};\r\n/** A storage object that lasts across sessions */\r\nconst PersistentStorage = createStoragefor('localStorage');\r\n/** A storage object that only lasts one session */\r\nconst SessionStorage = createStoragefor('sessionStorage');\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst logClient = new Logger('@firebase/database');\r\n/**\r\n * Returns a locally-unique ID (generated by just incrementing up from 0 each time its called).\r\n */\r\nconst LUIDGenerator = (function () {\r\n    let id = 1;\r\n    return function () {\r\n        return id++;\r\n    };\r\n})();\r\n/**\r\n * Sha1 hash of the input string\r\n * @param str - The string to hash\r\n * @returns {!string} The resulting hash\r\n */\r\nconst sha1 = function (str) {\r\n    const utf8Bytes = stringToByteArray(str);\r\n    const sha1 = new Sha1();\r\n    sha1.update(utf8Bytes);\r\n    const sha1Bytes = sha1.digest();\r\n    return base64.encodeByteArray(sha1Bytes);\r\n};\r\nconst buildLogMessage_ = function (...varArgs) {\r\n    let message = '';\r\n    for (let i = 0; i < varArgs.length; i++) {\r\n        const arg = varArgs[i];\r\n        if (Array.isArray(arg) ||\r\n            (arg &&\r\n                typeof arg === 'object' &&\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                typeof arg.length === 'number')) {\r\n            message += buildLogMessage_.apply(null, arg);\r\n        }\r\n        else if (typeof arg === 'object') {\r\n            message += stringify(arg);\r\n        }\r\n        else {\r\n            message += arg;\r\n        }\r\n        message += ' ';\r\n    }\r\n    return message;\r\n};\r\n/**\r\n * Use this for all debug messages in Firebase.\r\n */\r\nlet logger = null;\r\n/**\r\n * Flag to check for log availability on first log message\r\n */\r\nlet firstLog_ = true;\r\n/**\r\n * The implementation of Firebase.enableLogging (defined here to break dependencies)\r\n * @param logger_ - A flag to turn on logging, or a custom logger\r\n * @param persistent - Whether or not to persist logging settings across refreshes\r\n */\r\nconst enableLogging$1 = function (logger_, persistent) {\r\n    assert(!persistent || logger_ === true || logger_ === false, \"Can't turn on custom loggers persistently.\");\r\n    if (logger_ === true) {\r\n        logClient.logLevel = LogLevel.VERBOSE;\r\n        logger = logClient.log.bind(logClient);\r\n        if (persistent) {\r\n            SessionStorage.set('logging_enabled', true);\r\n        }\r\n    }\r\n    else if (typeof logger_ === 'function') {\r\n        logger = logger_;\r\n    }\r\n    else {\r\n        logger = null;\r\n        SessionStorage.remove('logging_enabled');\r\n    }\r\n};\r\nconst log = function (...varArgs) {\r\n    if (firstLog_ === true) {\r\n        firstLog_ = false;\r\n        if (logger === null && SessionStorage.get('logging_enabled') === true) {\r\n            enableLogging$1(true);\r\n        }\r\n    }\r\n    if (logger) {\r\n        const message = buildLogMessage_.apply(null, varArgs);\r\n        logger(message);\r\n    }\r\n};\r\nconst logWrapper = function (prefix) {\r\n    return function (...varArgs) {\r\n        log(prefix, ...varArgs);\r\n    };\r\n};\r\nconst error = function (...varArgs) {\r\n    const message = 'FIREBASE INTERNAL ERROR: ' + buildLogMessage_(...varArgs);\r\n    logClient.error(message);\r\n};\r\nconst fatal = function (...varArgs) {\r\n    const message = `FIREBASE FATAL ERROR: ${buildLogMessage_(...varArgs)}`;\r\n    logClient.error(message);\r\n    throw new Error(message);\r\n};\r\nconst warn = function (...varArgs) {\r\n    const message = 'FIREBASE WARNING: ' + buildLogMessage_(...varArgs);\r\n    logClient.warn(message);\r\n};\r\n/**\r\n * Logs a warning if the containing page uses https. Called when a call to new Firebase\r\n * does not use https.\r\n */\r\nconst warnIfPageIsSecure = function () {\r\n    // Be very careful accessing browser globals. Who knows what may or may not exist.\r\n    if (typeof window !== 'undefined' &&\r\n        window.location &&\r\n        window.location.protocol &&\r\n        window.location.protocol.indexOf('https:') !== -1) {\r\n        warn('Insecure Firebase access from a secure page. ' +\r\n            'Please use https in calls to new Firebase().');\r\n    }\r\n};\r\n/**\r\n * Returns true if data is NaN, or +/- Infinity.\r\n */\r\nconst isInvalidJSONNumber = function (data) {\r\n    return (typeof data === 'number' &&\r\n        (data !== data || // NaN\r\n            data === Number.POSITIVE_INFINITY ||\r\n            data === Number.NEGATIVE_INFINITY));\r\n};\r\nconst executeWhenDOMReady = function (fn) {\r\n    if (isNodeSdk() || document.readyState === 'complete') {\r\n        fn();\r\n    }\r\n    else {\r\n        // Modeled after jQuery. Try DOMContentLoaded and onreadystatechange (which\r\n        // fire before onload), but fall back to onload.\r\n        let called = false;\r\n        const wrappedFn = function () {\r\n            if (!document.body) {\r\n                setTimeout(wrappedFn, Math.floor(10));\r\n                return;\r\n            }\r\n            if (!called) {\r\n                called = true;\r\n                fn();\r\n            }\r\n        };\r\n        if (document.addEventListener) {\r\n            document.addEventListener('DOMContentLoaded', wrappedFn, false);\r\n            // fallback to onload.\r\n            window.addEventListener('load', wrappedFn, false);\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        }\r\n        else if (document.attachEvent) {\r\n            // IE.\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            document.attachEvent('onreadystatechange', () => {\r\n                if (document.readyState === 'complete') {\r\n                    wrappedFn();\r\n                }\r\n            });\r\n            // fallback to onload.\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            window.attachEvent('onload', wrappedFn);\r\n            // jQuery has an extra hack for IE that we could employ (based on\r\n            // http://javascript.nwbox.com/IEContentLoaded/) But it looks really old.\r\n            // I'm hoping we don't need it.\r\n        }\r\n    }\r\n};\r\n/**\r\n * Minimum key name. Invalid for actual data, used as a marker to sort before any valid names\r\n */\r\nconst MIN_NAME = '[MIN_NAME]';\r\n/**\r\n * Maximum key name. Invalid for actual data, used as a marker to sort above any valid names\r\n */\r\nconst MAX_NAME = '[MAX_NAME]';\r\n/**\r\n * Compares valid Firebase key names, plus min and max name\r\n */\r\nconst nameCompare = function (a, b) {\r\n    if (a === b) {\r\n        return 0;\r\n    }\r\n    else if (a === MIN_NAME || b === MAX_NAME) {\r\n        return -1;\r\n    }\r\n    else if (b === MIN_NAME || a === MAX_NAME) {\r\n        return 1;\r\n    }\r\n    else {\r\n        const aAsInt = tryParseInt(a), bAsInt = tryParseInt(b);\r\n        if (aAsInt !== null) {\r\n            if (bAsInt !== null) {\r\n                return aAsInt - bAsInt === 0 ? a.length - b.length : aAsInt - bAsInt;\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n        }\r\n        else if (bAsInt !== null) {\r\n            return 1;\r\n        }\r\n        else {\r\n            return a < b ? -1 : 1;\r\n        }\r\n    }\r\n};\r\n/**\r\n * @returns {!number} comparison result.\r\n */\r\nconst stringCompare = function (a, b) {\r\n    if (a === b) {\r\n        return 0;\r\n    }\r\n    else if (a < b) {\r\n        return -1;\r\n    }\r\n    else {\r\n        return 1;\r\n    }\r\n};\r\nconst requireKey = function (key, obj) {\r\n    if (obj && key in obj) {\r\n        return obj[key];\r\n    }\r\n    else {\r\n        throw new Error('Missing required key (' + key + ') in object: ' + stringify(obj));\r\n    }\r\n};\r\nconst ObjectToUniqueKey = function (obj) {\r\n    if (typeof obj !== 'object' || obj === null) {\r\n        return stringify(obj);\r\n    }\r\n    const keys = [];\r\n    // eslint-disable-next-line guard-for-in\r\n    for (const k in obj) {\r\n        keys.push(k);\r\n    }\r\n    // Export as json, but with the keys sorted.\r\n    keys.sort();\r\n    let key = '{';\r\n    for (let i = 0; i < keys.length; i++) {\r\n        if (i !== 0) {\r\n            key += ',';\r\n        }\r\n        key += stringify(keys[i]);\r\n        key += ':';\r\n        key += ObjectToUniqueKey(obj[keys[i]]);\r\n    }\r\n    key += '}';\r\n    return key;\r\n};\r\n/**\r\n * Splits a string into a number of smaller segments of maximum size\r\n * @param str - The string\r\n * @param segsize - The maximum number of chars in the string.\r\n * @returns The string, split into appropriately-sized chunks\r\n */\r\nconst splitStringBySize = function (str, segsize) {\r\n    const len = str.length;\r\n    if (len <= segsize) {\r\n        return [str];\r\n    }\r\n    const dataSegs = [];\r\n    for (let c = 0; c < len; c += segsize) {\r\n        if (c + segsize > len) {\r\n            dataSegs.push(str.substring(c, len));\r\n        }\r\n        else {\r\n            dataSegs.push(str.substring(c, c + segsize));\r\n        }\r\n    }\r\n    return dataSegs;\r\n};\r\n/**\r\n * Apply a function to each (key, value) pair in an object or\r\n * apply a function to each (index, value) pair in an array\r\n * @param obj - The object or array to iterate over\r\n * @param fn - The function to apply\r\n */\r\nfunction each(obj, fn) {\r\n    for (const key in obj) {\r\n        if (obj.hasOwnProperty(key)) {\r\n            fn(key, obj[key]);\r\n        }\r\n    }\r\n}\r\n/**\r\n * Borrowed from http://hg.secondlife.com/llsd/src/tip/js/typedarray.js (MIT License)\r\n * I made one modification at the end and removed the NaN / Infinity\r\n * handling (since it seemed broken [caused an overflow] and we don't need it).  See MJL comments.\r\n * @param v - A double\r\n *\r\n */\r\nconst doubleToIEEE754String = function (v) {\r\n    assert(!isInvalidJSONNumber(v), 'Invalid JSON number'); // MJL\r\n    const ebits = 11, fbits = 52;\r\n    const bias = (1 << (ebits - 1)) - 1;\r\n    let s, e, f, ln, i;\r\n    // Compute sign, exponent, fraction\r\n    // Skip NaN / Infinity handling --MJL.\r\n    if (v === 0) {\r\n        e = 0;\r\n        f = 0;\r\n        s = 1 / v === -Infinity ? 1 : 0;\r\n    }\r\n    else {\r\n        s = v < 0;\r\n        v = Math.abs(v);\r\n        if (v >= Math.pow(2, 1 - bias)) {\r\n            // Normalized\r\n            ln = Math.min(Math.floor(Math.log(v) / Math.LN2), bias);\r\n            e = ln + bias;\r\n            f = Math.round(v * Math.pow(2, fbits - ln) - Math.pow(2, fbits));\r\n        }\r\n        else {\r\n            // Denormalized\r\n            e = 0;\r\n            f = Math.round(v / Math.pow(2, 1 - bias - fbits));\r\n        }\r\n    }\r\n    // Pack sign, exponent, fraction\r\n    const bits = [];\r\n    for (i = fbits; i; i -= 1) {\r\n        bits.push(f % 2 ? 1 : 0);\r\n        f = Math.floor(f / 2);\r\n    }\r\n    for (i = ebits; i; i -= 1) {\r\n        bits.push(e % 2 ? 1 : 0);\r\n        e = Math.floor(e / 2);\r\n    }\r\n    bits.push(s ? 1 : 0);\r\n    bits.reverse();\r\n    const str = bits.join('');\r\n    // Return the data as a hex string. --MJL\r\n    let hexByteString = '';\r\n    for (i = 0; i < 64; i += 8) {\r\n        let hexByte = parseInt(str.substr(i, 8), 2).toString(16);\r\n        if (hexByte.length === 1) {\r\n            hexByte = '0' + hexByte;\r\n        }\r\n        hexByteString = hexByteString + hexByte;\r\n    }\r\n    return hexByteString.toLowerCase();\r\n};\r\n/**\r\n * Used to detect if we're in a Chrome content script (which executes in an\r\n * isolated environment where long-polling doesn't work).\r\n */\r\nconst isChromeExtensionContentScript = function () {\r\n    return !!(typeof window === 'object' &&\r\n        window['chrome'] &&\r\n        window['chrome']['extension'] &&\r\n        !/^chrome/.test(window.location.href));\r\n};\r\n/**\r\n * Used to detect if we're in a Windows 8 Store app.\r\n */\r\nconst isWindowsStoreApp = function () {\r\n    // Check for the presence of a couple WinRT globals\r\n    return typeof Windows === 'object' && typeof Windows.UI === 'object';\r\n};\r\n/**\r\n * Converts a server error code to a JavaScript Error\r\n */\r\nfunction errorForServerCode(code, query) {\r\n    let reason = 'Unknown Error';\r\n    if (code === 'too_big') {\r\n        reason =\r\n            'The data requested exceeds the maximum size ' +\r\n                'that can be accessed with a single request.';\r\n    }\r\n    else if (code === 'permission_denied') {\r\n        reason = \"Client doesn't have permission to access the desired data.\";\r\n    }\r\n    else if (code === 'unavailable') {\r\n        reason = 'The service is unavailable';\r\n    }\r\n    const error = new Error(code + ' at ' + query._path.toString() + ': ' + reason);\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    error.code = code.toUpperCase();\r\n    return error;\r\n}\r\n/**\r\n * Used to test for integer-looking strings\r\n */\r\nconst INTEGER_REGEXP_ = new RegExp('^-?(0*)\\\\d{1,10}$');\r\n/**\r\n * For use in keys, the minimum possible 32-bit integer.\r\n */\r\nconst INTEGER_32_MIN = -2147483648;\r\n/**\r\n * For use in keys, the maximum possible 32-bit integer.\r\n */\r\nconst INTEGER_32_MAX = 2147483647;\r\n/**\r\n * If the string contains a 32-bit integer, return it.  Else return null.\r\n */\r\nconst tryParseInt = function (str) {\r\n    if (INTEGER_REGEXP_.test(str)) {\r\n        const intVal = Number(str);\r\n        if (intVal >= INTEGER_32_MIN && intVal <= INTEGER_32_MAX) {\r\n            return intVal;\r\n        }\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Helper to run some code but catch any exceptions and re-throw them later.\r\n * Useful for preventing user callbacks from breaking internal code.\r\n *\r\n * Re-throwing the exception from a setTimeout is a little evil, but it's very\r\n * convenient (we don't have to try to figure out when is a safe point to\r\n * re-throw it), and the behavior seems reasonable:\r\n *\r\n * * If you aren't pausing on exceptions, you get an error in the console with\r\n *   the correct stack trace.\r\n * * If you're pausing on all exceptions, the debugger will pause on your\r\n *   exception and then again when we rethrow it.\r\n * * If you're only pausing on uncaught exceptions, the debugger will only pause\r\n *   on us re-throwing it.\r\n *\r\n * @param fn - The code to guard.\r\n */\r\nconst exceptionGuard = function (fn) {\r\n    try {\r\n        fn();\r\n    }\r\n    catch (e) {\r\n        // Re-throw exception when it's safe.\r\n        setTimeout(() => {\r\n            // It used to be that \"throw e\" would result in a good console error with\r\n            // relevant context, but as of Chrome 39, you just get the firebase.js\r\n            // file/line number where we re-throw it, which is useless. So we log\r\n            // e.stack explicitly.\r\n            const stack = e.stack || '';\r\n            warn('Exception was thrown by user callback.', stack);\r\n            throw e;\r\n        }, Math.floor(0));\r\n    }\r\n};\r\n/**\r\n * @returns {boolean} true if we think we're currently being crawled.\r\n */\r\nconst beingCrawled = function () {\r\n    const userAgent = (typeof window === 'object' &&\r\n        window['navigator'] &&\r\n        window['navigator']['userAgent']) ||\r\n        '';\r\n    // For now we whitelist the most popular crawlers.  We should refine this to be the set of crawlers we\r\n    // believe to support JavaScript/AJAX rendering.\r\n    // NOTE: Google Webmaster Tools doesn't really belong, but their \"This is how a visitor to your website\r\n    // would have seen the page\" is flaky if we don't treat it as a crawler.\r\n    return (userAgent.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i) >= 0);\r\n};\r\n/**\r\n * Same as setTimeout() except on Node.JS it will /not/ prevent the process from exiting.\r\n *\r\n * It is removed with clearTimeout() as normal.\r\n *\r\n * @param fn - Function to run.\r\n * @param time - Milliseconds to wait before running.\r\n * @returns The setTimeout() return value.\r\n */\r\nconst setTimeoutNonBlocking = function (fn, time) {\r\n    const timeout = setTimeout(fn, time);\r\n    // Note: at the time of this comment, unrefTimer is under the unstable set of APIs. Run with --unstable to enable the API.\r\n    if (typeof timeout === 'number' &&\r\n        // @ts-ignore Is only defined in Deno environments.\r\n        typeof Deno !== 'undefined' &&\r\n        // @ts-ignore Deno and unrefTimer are only defined in Deno environments.\r\n        Deno['unrefTimer']) {\r\n        // @ts-ignore Deno and unrefTimer are only defined in Deno environments.\r\n        Deno.unrefTimer(timeout);\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    }\r\n    else if (typeof timeout === 'object' && timeout['unref']) {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        timeout['unref']();\r\n    }\r\n    return timeout;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Abstraction around AppCheck's token fetching capabilities.\r\n */\r\nclass AppCheckTokenProvider {\r\n    constructor(appName_, appCheckProvider) {\r\n        this.appName_ = appName_;\r\n        this.appCheckProvider = appCheckProvider;\r\n        this.appCheck = appCheckProvider === null || appCheckProvider === void 0 ? void 0 : appCheckProvider.getImmediate({ optional: true });\r\n        if (!this.appCheck) {\r\n            appCheckProvider === null || appCheckProvider === void 0 ? void 0 : appCheckProvider.get().then(appCheck => (this.appCheck = appCheck));\r\n        }\r\n    }\r\n    getToken(forceRefresh) {\r\n        if (!this.appCheck) {\r\n            return new Promise((resolve, reject) => {\r\n                // Support delayed initialization of FirebaseAppCheck. This allows our\r\n                // customers to initialize the RTDB SDK before initializing Firebase\r\n                // AppCheck and ensures that all requests are authenticated if a token\r\n                // becomes available before the timeout below expires.\r\n                setTimeout(() => {\r\n                    if (this.appCheck) {\r\n                        this.getToken(forceRefresh).then(resolve, reject);\r\n                    }\r\n                    else {\r\n                        resolve(null);\r\n                    }\r\n                }, 0);\r\n            });\r\n        }\r\n        return this.appCheck.getToken(forceRefresh);\r\n    }\r\n    addTokenChangeListener(listener) {\r\n        var _a;\r\n        (_a = this.appCheckProvider) === null || _a === void 0 ? void 0 : _a.get().then(appCheck => appCheck.addTokenListener(listener));\r\n    }\r\n    notifyForInvalidToken() {\r\n        warn(`Provided AppCheck credentials for the app named \"${this.appName_}\" ` +\r\n            'are invalid. This usually indicates your app was not initialized correctly.');\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Abstraction around FirebaseApp's token fetching capabilities.\r\n */\r\nclass FirebaseAuthTokenProvider {\r\n    constructor(appName_, firebaseOptions_, authProvider_) {\r\n        this.appName_ = appName_;\r\n        this.firebaseOptions_ = firebaseOptions_;\r\n        this.authProvider_ = authProvider_;\r\n        this.auth_ = null;\r\n        this.auth_ = authProvider_.getImmediate({ optional: true });\r\n        if (!this.auth_) {\r\n            authProvider_.onInit(auth => (this.auth_ = auth));\r\n        }\r\n    }\r\n    getToken(forceRefresh) {\r\n        if (!this.auth_) {\r\n            return new Promise((resolve, reject) => {\r\n                // Support delayed initialization of FirebaseAuth. This allows our\r\n                // customers to initialize the RTDB SDK before initializing Firebase\r\n                // Auth and ensures that all requests are authenticated if a token\r\n                // becomes available before the timeout below expires.\r\n                setTimeout(() => {\r\n                    if (this.auth_) {\r\n                        this.getToken(forceRefresh).then(resolve, reject);\r\n                    }\r\n                    else {\r\n                        resolve(null);\r\n                    }\r\n                }, 0);\r\n            });\r\n        }\r\n        return this.auth_.getToken(forceRefresh).catch(error => {\r\n            // TODO: Need to figure out all the cases this is raised and whether\r\n            // this makes sense.\r\n            if (error && error.code === 'auth/token-not-initialized') {\r\n                log('Got auth/token-not-initialized error.  Treating as null token.');\r\n                return null;\r\n            }\r\n            else {\r\n                return Promise.reject(error);\r\n            }\r\n        });\r\n    }\r\n    addTokenChangeListener(listener) {\r\n        // TODO: We might want to wrap the listener and call it with no args to\r\n        // avoid a leaky abstraction, but that makes removing the listener harder.\r\n        if (this.auth_) {\r\n            this.auth_.addAuthTokenListener(listener);\r\n        }\r\n        else {\r\n            this.authProvider_\r\n                .get()\r\n                .then(auth => auth.addAuthTokenListener(listener));\r\n        }\r\n    }\r\n    removeTokenChangeListener(listener) {\r\n        this.authProvider_\r\n            .get()\r\n            .then(auth => auth.removeAuthTokenListener(listener));\r\n    }\r\n    notifyForInvalidToken() {\r\n        let errorMessage = 'Provided authentication credentials for the app named \"' +\r\n            this.appName_ +\r\n            '\" are invalid. This usually indicates your app was not ' +\r\n            'initialized correctly. ';\r\n        if ('credential' in this.firebaseOptions_) {\r\n            errorMessage +=\r\n                'Make sure the \"credential\" property provided to initializeApp() ' +\r\n                    'is authorized to access the specified \"databaseURL\" and is from the correct ' +\r\n                    'project.';\r\n        }\r\n        else if ('serviceAccount' in this.firebaseOptions_) {\r\n            errorMessage +=\r\n                'Make sure the \"serviceAccount\" property provided to initializeApp() ' +\r\n                    'is authorized to access the specified \"databaseURL\" and is from the correct ' +\r\n                    'project.';\r\n        }\r\n        else {\r\n            errorMessage +=\r\n                'Make sure the \"apiKey\" and \"databaseURL\" properties provided to ' +\r\n                    'initializeApp() match the values provided for your app at ' +\r\n                    'https://console.firebase.google.com/.';\r\n        }\r\n        warn(errorMessage);\r\n    }\r\n}\r\n/* AuthTokenProvider that supplies a constant token. Used by Admin SDK or mockUserToken with emulators. */\r\nclass EmulatorTokenProvider {\r\n    constructor(accessToken) {\r\n        this.accessToken = accessToken;\r\n    }\r\n    getToken(forceRefresh) {\r\n        return Promise.resolve({\r\n            accessToken: this.accessToken\r\n        });\r\n    }\r\n    addTokenChangeListener(listener) {\r\n        // Invoke the listener immediately to match the behavior in Firebase Auth\r\n        // (see packages/auth/src/auth.js#L1807)\r\n        listener(this.accessToken);\r\n    }\r\n    removeTokenChangeListener(listener) { }\r\n    notifyForInvalidToken() { }\r\n}\r\n/** A string that is treated as an admin access token by the RTDB emulator. Used by Admin SDK. */\r\nEmulatorTokenProvider.OWNER = 'owner';\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst PROTOCOL_VERSION = '5';\r\nconst VERSION_PARAM = 'v';\r\nconst TRANSPORT_SESSION_PARAM = 's';\r\nconst REFERER_PARAM = 'r';\r\nconst FORGE_REF = 'f';\r\n// Matches console.firebase.google.com, firebase-console-*.corp.google.com and\r\n// firebase.corp.google.com\r\nconst FORGE_DOMAIN_RE = /(console\\.firebase|firebase-console-\\w+\\.corp|firebase\\.corp)\\.google\\.com/;\r\nconst LAST_SESSION_PARAM = 'ls';\r\nconst APPLICATION_ID_PARAM = 'p';\r\nconst APP_CHECK_TOKEN_PARAM = 'ac';\r\nconst WEBSOCKET = 'websocket';\r\nconst LONG_POLLING = 'long_polling';\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A class that holds metadata about a Repo object\r\n */\r\nclass RepoInfo {\r\n    /**\r\n     * @param host - Hostname portion of the url for the repo\r\n     * @param secure - Whether or not this repo is accessed over ssl\r\n     * @param namespace - The namespace represented by the repo\r\n     * @param webSocketOnly - Whether to prefer websockets over all other transports (used by Nest).\r\n     * @param nodeAdmin - Whether this instance uses Admin SDK credentials\r\n     * @param persistenceKey - Override the default session persistence storage key\r\n     */\r\n    constructor(host, secure, namespace, webSocketOnly, nodeAdmin = false, persistenceKey = '', includeNamespaceInQueryParams = false, isUsingEmulator = false) {\r\n        this.secure = secure;\r\n        this.namespace = namespace;\r\n        this.webSocketOnly = webSocketOnly;\r\n        this.nodeAdmin = nodeAdmin;\r\n        this.persistenceKey = persistenceKey;\r\n        this.includeNamespaceInQueryParams = includeNamespaceInQueryParams;\r\n        this.isUsingEmulator = isUsingEmulator;\r\n        this._host = host.toLowerCase();\r\n        this._domain = this._host.substr(this._host.indexOf('.') + 1);\r\n        this.internalHost =\r\n            PersistentStorage.get('host:' + host) || this._host;\r\n    }\r\n    isCacheableHost() {\r\n        return this.internalHost.substr(0, 2) === 's-';\r\n    }\r\n    isCustomHost() {\r\n        return (this._domain !== 'firebaseio.com' &&\r\n            this._domain !== 'firebaseio-demo.com');\r\n    }\r\n    get host() {\r\n        return this._host;\r\n    }\r\n    set host(newHost) {\r\n        if (newHost !== this.internalHost) {\r\n            this.internalHost = newHost;\r\n            if (this.isCacheableHost()) {\r\n                PersistentStorage.set('host:' + this._host, this.internalHost);\r\n            }\r\n        }\r\n    }\r\n    toString() {\r\n        let str = this.toURLString();\r\n        if (this.persistenceKey) {\r\n            str += '<' + this.persistenceKey + '>';\r\n        }\r\n        return str;\r\n    }\r\n    toURLString() {\r\n        const protocol = this.secure ? 'https://' : 'http://';\r\n        const query = this.includeNamespaceInQueryParams\r\n            ? `?ns=${this.namespace}`\r\n            : '';\r\n        return `${protocol}${this.host}/${query}`;\r\n    }\r\n}\r\nfunction repoInfoNeedsQueryParam(repoInfo) {\r\n    return (repoInfo.host !== repoInfo.internalHost ||\r\n        repoInfo.isCustomHost() ||\r\n        repoInfo.includeNamespaceInQueryParams);\r\n}\r\n/**\r\n * Returns the websocket URL for this repo\r\n * @param repoInfo - RepoInfo object\r\n * @param type - of connection\r\n * @param params - list\r\n * @returns The URL for this repo\r\n */\r\nfunction repoInfoConnectionURL(repoInfo, type, params) {\r\n    assert(typeof type === 'string', 'typeof type must == string');\r\n    assert(typeof params === 'object', 'typeof params must == object');\r\n    let connURL;\r\n    if (type === WEBSOCKET) {\r\n        connURL =\r\n            (repoInfo.secure ? 'wss://' : 'ws://') + repoInfo.internalHost + '/.ws?';\r\n    }\r\n    else if (type === LONG_POLLING) {\r\n        connURL =\r\n            (repoInfo.secure ? 'https://' : 'http://') +\r\n                repoInfo.internalHost +\r\n                '/.lp?';\r\n    }\r\n    else {\r\n        throw new Error('Unknown connection type: ' + type);\r\n    }\r\n    if (repoInfoNeedsQueryParam(repoInfo)) {\r\n        params['ns'] = repoInfo.namespace;\r\n    }\r\n    const pairs = [];\r\n    each(params, (key, value) => {\r\n        pairs.push(key + '=' + value);\r\n    });\r\n    return connURL + pairs.join('&');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Tracks a collection of stats.\r\n */\r\nclass StatsCollection {\r\n    constructor() {\r\n        this.counters_ = {};\r\n    }\r\n    incrementCounter(name, amount = 1) {\r\n        if (!contains(this.counters_, name)) {\r\n            this.counters_[name] = 0;\r\n        }\r\n        this.counters_[name] += amount;\r\n    }\r\n    get() {\r\n        return deepCopy(this.counters_);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst collections = {};\r\nconst reporters = {};\r\nfunction statsManagerGetCollection(repoInfo) {\r\n    const hashString = repoInfo.toString();\r\n    if (!collections[hashString]) {\r\n        collections[hashString] = new StatsCollection();\r\n    }\r\n    return collections[hashString];\r\n}\r\nfunction statsManagerGetOrCreateReporter(repoInfo, creatorFunction) {\r\n    const hashString = repoInfo.toString();\r\n    if (!reporters[hashString]) {\r\n        reporters[hashString] = creatorFunction();\r\n    }\r\n    return reporters[hashString];\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This class ensures the packets from the server arrive in order\r\n * This class takes data from the server and ensures it gets passed into the callbacks in order.\r\n */\r\nclass PacketReceiver {\r\n    /**\r\n     * @param onMessage_\r\n     */\r\n    constructor(onMessage_) {\r\n        this.onMessage_ = onMessage_;\r\n        this.pendingResponses = [];\r\n        this.currentResponseNum = 0;\r\n        this.closeAfterResponse = -1;\r\n        this.onClose = null;\r\n    }\r\n    closeAfter(responseNum, callback) {\r\n        this.closeAfterResponse = responseNum;\r\n        this.onClose = callback;\r\n        if (this.closeAfterResponse < this.currentResponseNum) {\r\n            this.onClose();\r\n            this.onClose = null;\r\n        }\r\n    }\r\n    /**\r\n     * Each message from the server comes with a response number, and an array of data. The responseNumber\r\n     * allows us to ensure that we process them in the right order, since we can't be guaranteed that all\r\n     * browsers will respond in the same order as the requests we sent\r\n     */\r\n    handleResponse(requestNum, data) {\r\n        this.pendingResponses[requestNum] = data;\r\n        while (this.pendingResponses[this.currentResponseNum]) {\r\n            const toProcess = this.pendingResponses[this.currentResponseNum];\r\n            delete this.pendingResponses[this.currentResponseNum];\r\n            for (let i = 0; i < toProcess.length; ++i) {\r\n                if (toProcess[i]) {\r\n                    exceptionGuard(() => {\r\n                        this.onMessage_(toProcess[i]);\r\n                    });\r\n                }\r\n            }\r\n            if (this.currentResponseNum === this.closeAfterResponse) {\r\n                if (this.onClose) {\r\n                    this.onClose();\r\n                    this.onClose = null;\r\n                }\r\n                break;\r\n            }\r\n            this.currentResponseNum++;\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// URL query parameters associated with longpolling\r\nconst FIREBASE_LONGPOLL_START_PARAM = 'start';\r\nconst FIREBASE_LONGPOLL_CLOSE_COMMAND = 'close';\r\nconst FIREBASE_LONGPOLL_COMMAND_CB_NAME = 'pLPCommand';\r\nconst FIREBASE_LONGPOLL_DATA_CB_NAME = 'pRTLPCB';\r\nconst FIREBASE_LONGPOLL_ID_PARAM = 'id';\r\nconst FIREBASE_LONGPOLL_PW_PARAM = 'pw';\r\nconst FIREBASE_LONGPOLL_SERIAL_PARAM = 'ser';\r\nconst FIREBASE_LONGPOLL_CALLBACK_ID_PARAM = 'cb';\r\nconst FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM = 'seg';\r\nconst FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET = 'ts';\r\nconst FIREBASE_LONGPOLL_DATA_PARAM = 'd';\r\nconst FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM = 'dframe';\r\n//Data size constants.\r\n//TODO: Perf: the maximum length actually differs from browser to browser.\r\n// We should check what browser we're on and set accordingly.\r\nconst MAX_URL_DATA_SIZE = 1870;\r\nconst SEG_HEADER_SIZE = 30; //ie: &seg=8299234&ts=982389123&d=\r\nconst MAX_PAYLOAD_SIZE = MAX_URL_DATA_SIZE - SEG_HEADER_SIZE;\r\n/**\r\n * Keepalive period\r\n * send a fresh request at minimum every 25 seconds. Opera has a maximum request\r\n * length of 30 seconds that we can't exceed.\r\n */\r\nconst KEEPALIVE_REQUEST_INTERVAL = 25000;\r\n/**\r\n * How long to wait before aborting a long-polling connection attempt.\r\n */\r\nconst LP_CONNECT_TIMEOUT = 30000;\r\n/**\r\n * This class manages a single long-polling connection.\r\n */\r\nclass BrowserPollConnection {\r\n    /**\r\n     * @param connId An identifier for this connection, used for logging\r\n     * @param repoInfo The info for the endpoint to send data to.\r\n     * @param applicationId The Firebase App ID for this project.\r\n     * @param appCheckToken The AppCheck token for this client.\r\n     * @param authToken The AuthToken to use for this connection.\r\n     * @param transportSessionId Optional transportSessionid if we are\r\n     * reconnecting for an existing transport session\r\n     * @param lastSessionId Optional lastSessionId if the PersistentConnection has\r\n     * already created a connection previously\r\n     */\r\n    constructor(connId, repoInfo, applicationId, appCheckToken, authToken, transportSessionId, lastSessionId) {\r\n        this.connId = connId;\r\n        this.repoInfo = repoInfo;\r\n        this.applicationId = applicationId;\r\n        this.appCheckToken = appCheckToken;\r\n        this.authToken = authToken;\r\n        this.transportSessionId = transportSessionId;\r\n        this.lastSessionId = lastSessionId;\r\n        this.bytesSent = 0;\r\n        this.bytesReceived = 0;\r\n        this.everConnected_ = false;\r\n        this.log_ = logWrapper(connId);\r\n        this.stats_ = statsManagerGetCollection(repoInfo);\r\n        this.urlFn = (params) => {\r\n            // Always add the token if we have one.\r\n            if (this.appCheckToken) {\r\n                params[APP_CHECK_TOKEN_PARAM] = this.appCheckToken;\r\n            }\r\n            return repoInfoConnectionURL(repoInfo, LONG_POLLING, params);\r\n        };\r\n    }\r\n    /**\r\n     * @param onMessage - Callback when messages arrive\r\n     * @param onDisconnect - Callback with connection lost.\r\n     */\r\n    open(onMessage, onDisconnect) {\r\n        this.curSegmentNum = 0;\r\n        this.onDisconnect_ = onDisconnect;\r\n        this.myPacketOrderer = new PacketReceiver(onMessage);\r\n        this.isClosed_ = false;\r\n        this.connectTimeoutTimer_ = setTimeout(() => {\r\n            this.log_('Timed out trying to connect.');\r\n            // Make sure we clear the host cache\r\n            this.onClosed_();\r\n            this.connectTimeoutTimer_ = null;\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        }, Math.floor(LP_CONNECT_TIMEOUT));\r\n        // Ensure we delay the creation of the iframe until the DOM is loaded.\r\n        executeWhenDOMReady(() => {\r\n            if (this.isClosed_) {\r\n                return;\r\n            }\r\n            //Set up a callback that gets triggered once a connection is set up.\r\n            this.scriptTagHolder = new FirebaseIFrameScriptHolder((...args) => {\r\n                const [command, arg1, arg2, arg3, arg4] = args;\r\n                this.incrementIncomingBytes_(args);\r\n                if (!this.scriptTagHolder) {\r\n                    return; // we closed the connection.\r\n                }\r\n                if (this.connectTimeoutTimer_) {\r\n                    clearTimeout(this.connectTimeoutTimer_);\r\n                    this.connectTimeoutTimer_ = null;\r\n                }\r\n                this.everConnected_ = true;\r\n                if (command === FIREBASE_LONGPOLL_START_PARAM) {\r\n                    this.id = arg1;\r\n                    this.password = arg2;\r\n                }\r\n                else if (command === FIREBASE_LONGPOLL_CLOSE_COMMAND) {\r\n                    // Don't clear the host cache. We got a response from the server, so we know it's reachable\r\n                    if (arg1) {\r\n                        // We aren't expecting any more data (other than what the server's already in the process of sending us\r\n                        // through our already open polls), so don't send any more.\r\n                        this.scriptTagHolder.sendNewPolls = false;\r\n                        // arg1 in this case is the last response number sent by the server. We should try to receive\r\n                        // all of the responses up to this one before closing\r\n                        this.myPacketOrderer.closeAfter(arg1, () => {\r\n                            this.onClosed_();\r\n                        });\r\n                    }\r\n                    else {\r\n                        this.onClosed_();\r\n                    }\r\n                }\r\n                else {\r\n                    throw new Error('Unrecognized command received: ' + command);\r\n                }\r\n            }, (...args) => {\r\n                const [pN, data] = args;\r\n                this.incrementIncomingBytes_(args);\r\n                this.myPacketOrderer.handleResponse(pN, data);\r\n            }, () => {\r\n                this.onClosed_();\r\n            }, this.urlFn);\r\n            //Send the initial request to connect. The serial number is simply to keep the browser from pulling previous results\r\n            //from cache.\r\n            const urlParams = {};\r\n            urlParams[FIREBASE_LONGPOLL_START_PARAM] = 't';\r\n            urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = Math.floor(Math.random() * 100000000);\r\n            if (this.scriptTagHolder.uniqueCallbackIdentifier) {\r\n                urlParams[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM] =\r\n                    this.scriptTagHolder.uniqueCallbackIdentifier;\r\n            }\r\n            urlParams[VERSION_PARAM] = PROTOCOL_VERSION;\r\n            if (this.transportSessionId) {\r\n                urlParams[TRANSPORT_SESSION_PARAM] = this.transportSessionId;\r\n            }\r\n            if (this.lastSessionId) {\r\n                urlParams[LAST_SESSION_PARAM] = this.lastSessionId;\r\n            }\r\n            if (this.applicationId) {\r\n                urlParams[APPLICATION_ID_PARAM] = this.applicationId;\r\n            }\r\n            if (this.appCheckToken) {\r\n                urlParams[APP_CHECK_TOKEN_PARAM] = this.appCheckToken;\r\n            }\r\n            if (typeof location !== 'undefined' &&\r\n                location.hostname &&\r\n                FORGE_DOMAIN_RE.test(location.hostname)) {\r\n                urlParams[REFERER_PARAM] = FORGE_REF;\r\n            }\r\n            const connectURL = this.urlFn(urlParams);\r\n            this.log_('Connecting via long-poll to ' + connectURL);\r\n            this.scriptTagHolder.addTag(connectURL, () => {\r\n                /* do nothing */\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * Call this when a handshake has completed successfully and we want to consider the connection established\r\n     */\r\n    start() {\r\n        this.scriptTagHolder.startLongPoll(this.id, this.password);\r\n        this.addDisconnectPingFrame(this.id, this.password);\r\n    }\r\n    /**\r\n     * Forces long polling to be considered as a potential transport\r\n     */\r\n    static forceAllow() {\r\n        BrowserPollConnection.forceAllow_ = true;\r\n    }\r\n    /**\r\n     * Forces longpolling to not be considered as a potential transport\r\n     */\r\n    static forceDisallow() {\r\n        BrowserPollConnection.forceDisallow_ = true;\r\n    }\r\n    // Static method, use string literal so it can be accessed in a generic way\r\n    static isAvailable() {\r\n        if (isNodeSdk()) {\r\n            return false;\r\n        }\r\n        else if (BrowserPollConnection.forceAllow_) {\r\n            return true;\r\n        }\r\n        else {\r\n            // NOTE: In React-Native there's normally no 'document', but if you debug a React-Native app in\r\n            // the Chrome debugger, 'document' is defined, but document.createElement is null (2015/06/08).\r\n            return (!BrowserPollConnection.forceDisallow_ &&\r\n                typeof document !== 'undefined' &&\r\n                document.createElement != null &&\r\n                !isChromeExtensionContentScript() &&\r\n                !isWindowsStoreApp());\r\n        }\r\n    }\r\n    /**\r\n     * No-op for polling\r\n     */\r\n    markConnectionHealthy() { }\r\n    /**\r\n     * Stops polling and cleans up the iframe\r\n     */\r\n    shutdown_() {\r\n        this.isClosed_ = true;\r\n        if (this.scriptTagHolder) {\r\n            this.scriptTagHolder.close();\r\n            this.scriptTagHolder = null;\r\n        }\r\n        //remove the disconnect frame, which will trigger an XHR call to the server to tell it we're leaving.\r\n        if (this.myDisconnFrame) {\r\n            document.body.removeChild(this.myDisconnFrame);\r\n            this.myDisconnFrame = null;\r\n        }\r\n        if (this.connectTimeoutTimer_) {\r\n            clearTimeout(this.connectTimeoutTimer_);\r\n            this.connectTimeoutTimer_ = null;\r\n        }\r\n    }\r\n    /**\r\n     * Triggered when this transport is closed\r\n     */\r\n    onClosed_() {\r\n        if (!this.isClosed_) {\r\n            this.log_('Longpoll is closing itself');\r\n            this.shutdown_();\r\n            if (this.onDisconnect_) {\r\n                this.onDisconnect_(this.everConnected_);\r\n                this.onDisconnect_ = null;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * External-facing close handler. RealTime has requested we shut down. Kill our connection and tell the server\r\n     * that we've left.\r\n     */\r\n    close() {\r\n        if (!this.isClosed_) {\r\n            this.log_('Longpoll is being closed.');\r\n            this.shutdown_();\r\n        }\r\n    }\r\n    /**\r\n     * Send the JSON object down to the server. It will need to be stringified, base64 encoded, and then\r\n     * broken into chunks (since URLs have a small maximum length).\r\n     * @param data - The JSON data to transmit.\r\n     */\r\n    send(data) {\r\n        const dataStr = stringify(data);\r\n        this.bytesSent += dataStr.length;\r\n        this.stats_.incrementCounter('bytes_sent', dataStr.length);\r\n        //first, lets get the base64-encoded data\r\n        const base64data = base64Encode(dataStr);\r\n        //We can only fit a certain amount in each URL, so we need to split this request\r\n        //up into multiple pieces if it doesn't fit in one request.\r\n        const dataSegs = splitStringBySize(base64data, MAX_PAYLOAD_SIZE);\r\n        //Enqueue each segment for transmission. We assign each chunk a sequential ID and a total number\r\n        //of segments so that we can reassemble the packet on the server.\r\n        for (let i = 0; i < dataSegs.length; i++) {\r\n            this.scriptTagHolder.enqueueSegment(this.curSegmentNum, dataSegs.length, dataSegs[i]);\r\n            this.curSegmentNum++;\r\n        }\r\n    }\r\n    /**\r\n     * This is how we notify the server that we're leaving.\r\n     * We aren't able to send requests with DHTML on a window close event, but we can\r\n     * trigger XHR requests in some browsers (everything but Opera basically).\r\n     */\r\n    addDisconnectPingFrame(id, pw) {\r\n        if (isNodeSdk()) {\r\n            return;\r\n        }\r\n        this.myDisconnFrame = document.createElement('iframe');\r\n        const urlParams = {};\r\n        urlParams[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM] = 't';\r\n        urlParams[FIREBASE_LONGPOLL_ID_PARAM] = id;\r\n        urlParams[FIREBASE_LONGPOLL_PW_PARAM] = pw;\r\n        this.myDisconnFrame.src = this.urlFn(urlParams);\r\n        this.myDisconnFrame.style.display = 'none';\r\n        document.body.appendChild(this.myDisconnFrame);\r\n    }\r\n    /**\r\n     * Used to track the bytes received by this client\r\n     */\r\n    incrementIncomingBytes_(args) {\r\n        // TODO: This is an annoying perf hit just to track the number of incoming bytes.  Maybe it should be opt-in.\r\n        const bytesReceived = stringify(args).length;\r\n        this.bytesReceived += bytesReceived;\r\n        this.stats_.incrementCounter('bytes_received', bytesReceived);\r\n    }\r\n}\r\n/*********************************************************************************************\r\n * A wrapper around an iframe that is used as a long-polling script holder.\r\n *********************************************************************************************/\r\nclass FirebaseIFrameScriptHolder {\r\n    /**\r\n     * @param commandCB - The callback to be called when control commands are received from the server.\r\n     * @param onMessageCB - The callback to be triggered when responses arrive from the server.\r\n     * @param onDisconnect - The callback to be triggered when this tag holder is closed\r\n     * @param urlFn - A function that provides the URL of the endpoint to send data to.\r\n     */\r\n    constructor(commandCB, onMessageCB, onDisconnect, urlFn) {\r\n        this.onDisconnect = onDisconnect;\r\n        this.urlFn = urlFn;\r\n        //We maintain a count of all of the outstanding requests, because if we have too many active at once it can cause\r\n        //problems in some browsers.\r\n        this.outstandingRequests = new Set();\r\n        //A queue of the pending segments waiting for transmission to the server.\r\n        this.pendingSegs = [];\r\n        //A serial number. We use this for two things:\r\n        // 1) A way to ensure the browser doesn't cache responses to polls\r\n        // 2) A way to make the server aware when long-polls arrive in a different order than we started them. The\r\n        //    server needs to release both polls in this case or it will cause problems in Opera since Opera can only execute\r\n        //    JSONP code in the order it was added to the iframe.\r\n        this.currentSerial = Math.floor(Math.random() * 100000000);\r\n        // This gets set to false when we're \"closing down\" the connection (e.g. we're switching transports but there's still\r\n        // incoming data from the server that we're waiting for).\r\n        this.sendNewPolls = true;\r\n        if (!isNodeSdk()) {\r\n            //Each script holder registers a couple of uniquely named callbacks with the window. These are called from the\r\n            //iframes where we put the long-polling script tags. We have two callbacks:\r\n            //   1) Command Callback - Triggered for control issues, like starting a connection.\r\n            //   2) Message Callback - Triggered when new data arrives.\r\n            this.uniqueCallbackIdentifier = LUIDGenerator();\r\n            window[FIREBASE_LONGPOLL_COMMAND_CB_NAME + this.uniqueCallbackIdentifier] = commandCB;\r\n            window[FIREBASE_LONGPOLL_DATA_CB_NAME + this.uniqueCallbackIdentifier] =\r\n                onMessageCB;\r\n            //Create an iframe for us to add script tags to.\r\n            this.myIFrame = FirebaseIFrameScriptHolder.createIFrame_();\r\n            // Set the iframe's contents.\r\n            let script = '';\r\n            // if we set a javascript url, it's IE and we need to set the document domain. The javascript url is sufficient\r\n            // for ie9, but ie8 needs to do it again in the document itself.\r\n            if (this.myIFrame.src &&\r\n                this.myIFrame.src.substr(0, 'javascript:'.length) === 'javascript:') {\r\n                const currentDomain = document.domain;\r\n                script = '<script>document.domain=\"' + currentDomain + '\";</script>';\r\n            }\r\n            const iframeContents = '<html><body>' + script + '</body></html>';\r\n            try {\r\n                this.myIFrame.doc.open();\r\n                this.myIFrame.doc.write(iframeContents);\r\n                this.myIFrame.doc.close();\r\n            }\r\n            catch (e) {\r\n                log('frame writing exception');\r\n                if (e.stack) {\r\n                    log(e.stack);\r\n                }\r\n                log(e);\r\n            }\r\n        }\r\n        else {\r\n            this.commandCB = commandCB;\r\n            this.onMessageCB = onMessageCB;\r\n        }\r\n    }\r\n    /**\r\n     * Each browser has its own funny way to handle iframes. Here we mush them all together into one object that I can\r\n     * actually use.\r\n     */\r\n    static createIFrame_() {\r\n        const iframe = document.createElement('iframe');\r\n        iframe.style.display = 'none';\r\n        // This is necessary in order to initialize the document inside the iframe\r\n        if (document.body) {\r\n            document.body.appendChild(iframe);\r\n            try {\r\n                // If document.domain has been modified in IE, this will throw an error, and we need to set the\r\n                // domain of the iframe's document manually. We can do this via a javascript: url as the src attribute\r\n                // Also note that we must do this *after* the iframe has been appended to the page. Otherwise it doesn't work.\r\n                const a = iframe.contentWindow.document;\r\n                if (!a) {\r\n                    // Apologies for the log-spam, I need to do something to keep closure from optimizing out the assignment above.\r\n                    log('No IE domain setting required');\r\n                }\r\n            }\r\n            catch (e) {\r\n                const domain = document.domain;\r\n                iframe.src =\r\n                    \"javascript:void((function(){document.open();document.domain='\" +\r\n                        domain +\r\n                        \"';document.close();})())\";\r\n            }\r\n        }\r\n        else {\r\n            // LongPollConnection attempts to delay initialization until the document is ready, so hopefully this\r\n            // never gets hit.\r\n            throw 'Document body has not initialized. Wait to initialize Firebase until after the document is ready.';\r\n        }\r\n        // Get the document of the iframe in a browser-specific way.\r\n        if (iframe.contentDocument) {\r\n            iframe.doc = iframe.contentDocument; // Firefox, Opera, Safari\r\n        }\r\n        else if (iframe.contentWindow) {\r\n            iframe.doc = iframe.contentWindow.document; // Internet Explorer\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        }\r\n        else if (iframe.document) {\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            iframe.doc = iframe.document; //others?\r\n        }\r\n        return iframe;\r\n    }\r\n    /**\r\n     * Cancel all outstanding queries and remove the frame.\r\n     */\r\n    close() {\r\n        //Mark this iframe as dead, so no new requests are sent.\r\n        this.alive = false;\r\n        if (this.myIFrame) {\r\n            //We have to actually remove all of the html inside this iframe before removing it from the\r\n            //window, or IE will continue loading and executing the script tags we've already added, which\r\n            //can lead to some errors being thrown. Setting textContent seems to be the safest way to do this.\r\n            this.myIFrame.doc.body.textContent = '';\r\n            setTimeout(() => {\r\n                if (this.myIFrame !== null) {\r\n                    document.body.removeChild(this.myIFrame);\r\n                    this.myIFrame = null;\r\n                }\r\n            }, Math.floor(0));\r\n        }\r\n        // Protect from being called recursively.\r\n        const onDisconnect = this.onDisconnect;\r\n        if (onDisconnect) {\r\n            this.onDisconnect = null;\r\n            onDisconnect();\r\n        }\r\n    }\r\n    /**\r\n     * Actually start the long-polling session by adding the first script tag(s) to the iframe.\r\n     * @param id - The ID of this connection\r\n     * @param pw - The password for this connection\r\n     */\r\n    startLongPoll(id, pw) {\r\n        this.myID = id;\r\n        this.myPW = pw;\r\n        this.alive = true;\r\n        //send the initial request. If there are requests queued, make sure that we transmit as many as we are currently able to.\r\n        while (this.newRequest_()) { }\r\n    }\r\n    /**\r\n     * This is called any time someone might want a script tag to be added. It adds a script tag when there aren't\r\n     * too many outstanding requests and we are still alive.\r\n     *\r\n     * If there are outstanding packet segments to send, it sends one. If there aren't, it sends a long-poll anyways if\r\n     * needed.\r\n     */\r\n    newRequest_() {\r\n        // We keep one outstanding request open all the time to receive data, but if we need to send data\r\n        // (pendingSegs.length > 0) then we create a new request to send the data.  The server will automatically\r\n        // close the old request.\r\n        if (this.alive &&\r\n            this.sendNewPolls &&\r\n            this.outstandingRequests.size < (this.pendingSegs.length > 0 ? 2 : 1)) {\r\n            //construct our url\r\n            this.currentSerial++;\r\n            const urlParams = {};\r\n            urlParams[FIREBASE_LONGPOLL_ID_PARAM] = this.myID;\r\n            urlParams[FIREBASE_LONGPOLL_PW_PARAM] = this.myPW;\r\n            urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = this.currentSerial;\r\n            let theURL = this.urlFn(urlParams);\r\n            //Now add as much data as we can.\r\n            let curDataString = '';\r\n            let i = 0;\r\n            while (this.pendingSegs.length > 0) {\r\n                //first, lets see if the next segment will fit.\r\n                const nextSeg = this.pendingSegs[0];\r\n                if (nextSeg.d.length +\r\n                    SEG_HEADER_SIZE +\r\n                    curDataString.length <=\r\n                    MAX_URL_DATA_SIZE) {\r\n                    //great, the segment will fit. Lets append it.\r\n                    const theSeg = this.pendingSegs.shift();\r\n                    curDataString =\r\n                        curDataString +\r\n                            '&' +\r\n                            FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM +\r\n                            i +\r\n                            '=' +\r\n                            theSeg.seg +\r\n                            '&' +\r\n                            FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET +\r\n                            i +\r\n                            '=' +\r\n                            theSeg.ts +\r\n                            '&' +\r\n                            FIREBASE_LONGPOLL_DATA_PARAM +\r\n                            i +\r\n                            '=' +\r\n                            theSeg.d;\r\n                    i++;\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n            theURL = theURL + curDataString;\r\n            this.addLongPollTag_(theURL, this.currentSerial);\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n    /**\r\n     * Queue a packet for transmission to the server.\r\n     * @param segnum - A sequential id for this packet segment used for reassembly\r\n     * @param totalsegs - The total number of segments in this packet\r\n     * @param data - The data for this segment.\r\n     */\r\n    enqueueSegment(segnum, totalsegs, data) {\r\n        //add this to the queue of segments to send.\r\n        this.pendingSegs.push({ seg: segnum, ts: totalsegs, d: data });\r\n        //send the data immediately if there isn't already data being transmitted, unless\r\n        //startLongPoll hasn't been called yet.\r\n        if (this.alive) {\r\n            this.newRequest_();\r\n        }\r\n    }\r\n    /**\r\n     * Add a script tag for a regular long-poll request.\r\n     * @param url - The URL of the script tag.\r\n     * @param serial - The serial number of the request.\r\n     */\r\n    addLongPollTag_(url, serial) {\r\n        //remember that we sent this request.\r\n        this.outstandingRequests.add(serial);\r\n        const doNewRequest = () => {\r\n            this.outstandingRequests.delete(serial);\r\n            this.newRequest_();\r\n        };\r\n        // If this request doesn't return on its own accord (by the server sending us some data), we'll\r\n        // create a new one after the KEEPALIVE interval to make sure we always keep a fresh request open.\r\n        const keepaliveTimeout = setTimeout(doNewRequest, Math.floor(KEEPALIVE_REQUEST_INTERVAL));\r\n        const readyStateCB = () => {\r\n            // Request completed.  Cancel the keepalive.\r\n            clearTimeout(keepaliveTimeout);\r\n            // Trigger a new request so we can continue receiving data.\r\n            doNewRequest();\r\n        };\r\n        this.addTag(url, readyStateCB);\r\n    }\r\n    /**\r\n     * Add an arbitrary script tag to the iframe.\r\n     * @param url - The URL for the script tag source.\r\n     * @param loadCB - A callback to be triggered once the script has loaded.\r\n     */\r\n    addTag(url, loadCB) {\r\n        if (isNodeSdk()) {\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            this.doNodeLongPoll(url, loadCB);\r\n        }\r\n        else {\r\n            setTimeout(() => {\r\n                try {\r\n                    // if we're already closed, don't add this poll\r\n                    if (!this.sendNewPolls) {\r\n                        return;\r\n                    }\r\n                    const newScript = this.myIFrame.doc.createElement('script');\r\n                    newScript.type = 'text/javascript';\r\n                    newScript.async = true;\r\n                    newScript.src = url;\r\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                    newScript.onload = newScript.onreadystatechange =\r\n                        function () {\r\n                            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                            const rstate = newScript.readyState;\r\n                            if (!rstate || rstate === 'loaded' || rstate === 'complete') {\r\n                                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                                newScript.onload = newScript.onreadystatechange = null;\r\n                                if (newScript.parentNode) {\r\n                                    newScript.parentNode.removeChild(newScript);\r\n                                }\r\n                                loadCB();\r\n                            }\r\n                        };\r\n                    newScript.onerror = () => {\r\n                        log('Long-poll script failed to load: ' + url);\r\n                        this.sendNewPolls = false;\r\n                        this.close();\r\n                    };\r\n                    this.myIFrame.doc.body.appendChild(newScript);\r\n                }\r\n                catch (e) {\r\n                    // TODO: we should make this error visible somehow\r\n                }\r\n            }, Math.floor(1));\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst WEBSOCKET_MAX_FRAME_SIZE = 16384;\r\nconst WEBSOCKET_KEEPALIVE_INTERVAL = 45000;\r\nlet WebSocketImpl = null;\r\nif (typeof MozWebSocket !== 'undefined') {\r\n    WebSocketImpl = MozWebSocket;\r\n}\r\nelse if (typeof WebSocket !== 'undefined') {\r\n    WebSocketImpl = WebSocket;\r\n}\r\n/**\r\n * Create a new websocket connection with the given callbacks.\r\n */\r\nclass WebSocketConnection {\r\n    /**\r\n     * @param connId identifier for this transport\r\n     * @param repoInfo The info for the websocket endpoint.\r\n     * @param applicationId The Firebase App ID for this project.\r\n     * @param appCheckToken The App Check Token for this client.\r\n     * @param authToken The Auth Token for this client.\r\n     * @param transportSessionId Optional transportSessionId if this is connecting\r\n     * to an existing transport session\r\n     * @param lastSessionId Optional lastSessionId if there was a previous\r\n     * connection\r\n     */\r\n    constructor(connId, repoInfo, applicationId, appCheckToken, authToken, transportSessionId, lastSessionId) {\r\n        this.connId = connId;\r\n        this.applicationId = applicationId;\r\n        this.appCheckToken = appCheckToken;\r\n        this.authToken = authToken;\r\n        this.keepaliveTimer = null;\r\n        this.frames = null;\r\n        this.totalFrames = 0;\r\n        this.bytesSent = 0;\r\n        this.bytesReceived = 0;\r\n        this.log_ = logWrapper(this.connId);\r\n        this.stats_ = statsManagerGetCollection(repoInfo);\r\n        this.connURL = WebSocketConnection.connectionURL_(repoInfo, transportSessionId, lastSessionId, appCheckToken, applicationId);\r\n        this.nodeAdmin = repoInfo.nodeAdmin;\r\n    }\r\n    /**\r\n     * @param repoInfo - The info for the websocket endpoint.\r\n     * @param transportSessionId - Optional transportSessionId if this is connecting to an existing transport\r\n     *                                         session\r\n     * @param lastSessionId - Optional lastSessionId if there was a previous connection\r\n     * @returns connection url\r\n     */\r\n    static connectionURL_(repoInfo, transportSessionId, lastSessionId, appCheckToken, applicationId) {\r\n        const urlParams = {};\r\n        urlParams[VERSION_PARAM] = PROTOCOL_VERSION;\r\n        if (!isNodeSdk() &&\r\n            typeof location !== 'undefined' &&\r\n            location.hostname &&\r\n            FORGE_DOMAIN_RE.test(location.hostname)) {\r\n            urlParams[REFERER_PARAM] = FORGE_REF;\r\n        }\r\n        if (transportSessionId) {\r\n            urlParams[TRANSPORT_SESSION_PARAM] = transportSessionId;\r\n        }\r\n        if (lastSessionId) {\r\n            urlParams[LAST_SESSION_PARAM] = lastSessionId;\r\n        }\r\n        if (appCheckToken) {\r\n            urlParams[APP_CHECK_TOKEN_PARAM] = appCheckToken;\r\n        }\r\n        if (applicationId) {\r\n            urlParams[APPLICATION_ID_PARAM] = applicationId;\r\n        }\r\n        return repoInfoConnectionURL(repoInfo, WEBSOCKET, urlParams);\r\n    }\r\n    /**\r\n     * @param onMessage - Callback when messages arrive\r\n     * @param onDisconnect - Callback with connection lost.\r\n     */\r\n    open(onMessage, onDisconnect) {\r\n        this.onDisconnect = onDisconnect;\r\n        this.onMessage = onMessage;\r\n        this.log_('Websocket connecting to ' + this.connURL);\r\n        this.everConnected_ = false;\r\n        // Assume failure until proven otherwise.\r\n        PersistentStorage.set('previous_websocket_failure', true);\r\n        try {\r\n            let options;\r\n            if (isNodeSdk()) {\r\n                const device = this.nodeAdmin ? 'AdminNode' : 'Node';\r\n                // UA Format: Firebase/<wire_protocol>/<sdk_version>/<platform>/<device>\r\n                options = {\r\n                    headers: {\r\n                        'User-Agent': `Firebase/${PROTOCOL_VERSION}/${SDK_VERSION}/${process.platform}/${device}`,\r\n                        'X-Firebase-GMPID': this.applicationId || ''\r\n                    }\r\n                };\r\n                // If using Node with admin creds, AppCheck-related checks are unnecessary.\r\n                // Note that we send the credentials here even if they aren't admin credentials, which is\r\n                // not a problem.\r\n                // Note that this header is just used to bypass appcheck, and the token should still be sent\r\n                // through the websocket connection once it is established.\r\n                if (this.authToken) {\r\n                    options.headers['Authorization'] = `Bearer ${this.authToken}`;\r\n                }\r\n                if (this.appCheckToken) {\r\n                    options.headers['X-Firebase-AppCheck'] = this.appCheckToken;\r\n                }\r\n                // Plumb appropriate http_proxy environment variable into faye-websocket if it exists.\r\n                const env = process['env'];\r\n                const proxy = this.connURL.indexOf('wss://') === 0\r\n                    ? env['HTTPS_PROXY'] || env['https_proxy']\r\n                    : env['HTTP_PROXY'] || env['http_proxy'];\r\n                if (proxy) {\r\n                    options['proxy'] = { origin: proxy };\r\n                }\r\n            }\r\n            this.mySock = new WebSocketImpl(this.connURL, [], options);\r\n        }\r\n        catch (e) {\r\n            this.log_('Error instantiating WebSocket.');\r\n            const error = e.message || e.data;\r\n            if (error) {\r\n                this.log_(error);\r\n            }\r\n            this.onClosed_();\r\n            return;\r\n        }\r\n        this.mySock.onopen = () => {\r\n            this.log_('Websocket connected.');\r\n            this.everConnected_ = true;\r\n        };\r\n        this.mySock.onclose = () => {\r\n            this.log_('Websocket connection was disconnected.');\r\n            this.mySock = null;\r\n            this.onClosed_();\r\n        };\r\n        this.mySock.onmessage = m => {\r\n            this.handleIncomingFrame(m);\r\n        };\r\n        this.mySock.onerror = e => {\r\n            this.log_('WebSocket error.  Closing connection.');\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            const error = e.message || e.data;\r\n            if (error) {\r\n                this.log_(error);\r\n            }\r\n            this.onClosed_();\r\n        };\r\n    }\r\n    /**\r\n     * No-op for websockets, we don't need to do anything once the connection is confirmed as open\r\n     */\r\n    start() { }\r\n    static forceDisallow() {\r\n        WebSocketConnection.forceDisallow_ = true;\r\n    }\r\n    static isAvailable() {\r\n        let isOldAndroid = false;\r\n        if (typeof navigator !== 'undefined' && navigator.userAgent) {\r\n            const oldAndroidRegex = /Android ([0-9]{0,}\\.[0-9]{0,})/;\r\n            const oldAndroidMatch = navigator.userAgent.match(oldAndroidRegex);\r\n            if (oldAndroidMatch && oldAndroidMatch.length > 1) {\r\n                if (parseFloat(oldAndroidMatch[1]) < 4.4) {\r\n                    isOldAndroid = true;\r\n                }\r\n            }\r\n        }\r\n        return (!isOldAndroid &&\r\n            WebSocketImpl !== null &&\r\n            !WebSocketConnection.forceDisallow_);\r\n    }\r\n    /**\r\n     * Returns true if we previously failed to connect with this transport.\r\n     */\r\n    static previouslyFailed() {\r\n        // If our persistent storage is actually only in-memory storage,\r\n        // we default to assuming that it previously failed to be safe.\r\n        return (PersistentStorage.isInMemoryStorage ||\r\n            PersistentStorage.get('previous_websocket_failure') === true);\r\n    }\r\n    markConnectionHealthy() {\r\n        PersistentStorage.remove('previous_websocket_failure');\r\n    }\r\n    appendFrame_(data) {\r\n        this.frames.push(data);\r\n        if (this.frames.length === this.totalFrames) {\r\n            const fullMess = this.frames.join('');\r\n            this.frames = null;\r\n            const jsonMess = jsonEval(fullMess);\r\n            //handle the message\r\n            this.onMessage(jsonMess);\r\n        }\r\n    }\r\n    /**\r\n     * @param frameCount - The number of frames we are expecting from the server\r\n     */\r\n    handleNewFrameCount_(frameCount) {\r\n        this.totalFrames = frameCount;\r\n        this.frames = [];\r\n    }\r\n    /**\r\n     * Attempts to parse a frame count out of some text. If it can't, assumes a value of 1\r\n     * @returns Any remaining data to be process, or null if there is none\r\n     */\r\n    extractFrameCount_(data) {\r\n        assert(this.frames === null, 'We already have a frame buffer');\r\n        // TODO: The server is only supposed to send up to 9999 frames (i.e. length <= 4), but that isn't being enforced\r\n        // currently.  So allowing larger frame counts (length <= 6).  See https://app.asana.com/0/search/8688598998380/8237608042508\r\n        if (data.length <= 6) {\r\n            const frameCount = Number(data);\r\n            if (!isNaN(frameCount)) {\r\n                this.handleNewFrameCount_(frameCount);\r\n                return null;\r\n            }\r\n        }\r\n        this.handleNewFrameCount_(1);\r\n        return data;\r\n    }\r\n    /**\r\n     * Process a websocket frame that has arrived from the server.\r\n     * @param mess - The frame data\r\n     */\r\n    handleIncomingFrame(mess) {\r\n        if (this.mySock === null) {\r\n            return; // Chrome apparently delivers incoming packets even after we .close() the connection sometimes.\r\n        }\r\n        const data = mess['data'];\r\n        this.bytesReceived += data.length;\r\n        this.stats_.incrementCounter('bytes_received', data.length);\r\n        this.resetKeepAlive();\r\n        if (this.frames !== null) {\r\n            // we're buffering\r\n            this.appendFrame_(data);\r\n        }\r\n        else {\r\n            // try to parse out a frame count, otherwise, assume 1 and process it\r\n            const remainingData = this.extractFrameCount_(data);\r\n            if (remainingData !== null) {\r\n                this.appendFrame_(remainingData);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Send a message to the server\r\n     * @param data - The JSON object to transmit\r\n     */\r\n    send(data) {\r\n        this.resetKeepAlive();\r\n        const dataStr = stringify(data);\r\n        this.bytesSent += dataStr.length;\r\n        this.stats_.incrementCounter('bytes_sent', dataStr.length);\r\n        //We can only fit a certain amount in each websocket frame, so we need to split this request\r\n        //up into multiple pieces if it doesn't fit in one request.\r\n        const dataSegs = splitStringBySize(dataStr, WEBSOCKET_MAX_FRAME_SIZE);\r\n        //Send the length header\r\n        if (dataSegs.length > 1) {\r\n            this.sendString_(String(dataSegs.length));\r\n        }\r\n        //Send the actual data in segments.\r\n        for (let i = 0; i < dataSegs.length; i++) {\r\n            this.sendString_(dataSegs[i]);\r\n        }\r\n    }\r\n    shutdown_() {\r\n        this.isClosed_ = true;\r\n        if (this.keepaliveTimer) {\r\n            clearInterval(this.keepaliveTimer);\r\n            this.keepaliveTimer = null;\r\n        }\r\n        if (this.mySock) {\r\n            this.mySock.close();\r\n            this.mySock = null;\r\n        }\r\n    }\r\n    onClosed_() {\r\n        if (!this.isClosed_) {\r\n            this.log_('WebSocket is closing itself');\r\n            this.shutdown_();\r\n            // since this is an internal close, trigger the close listener\r\n            if (this.onDisconnect) {\r\n                this.onDisconnect(this.everConnected_);\r\n                this.onDisconnect = null;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * External-facing close handler.\r\n     * Close the websocket and kill the connection.\r\n     */\r\n    close() {\r\n        if (!this.isClosed_) {\r\n            this.log_('WebSocket is being closed');\r\n            this.shutdown_();\r\n        }\r\n    }\r\n    /**\r\n     * Kill the current keepalive timer and start a new one, to ensure that it always fires N seconds after\r\n     * the last activity.\r\n     */\r\n    resetKeepAlive() {\r\n        clearInterval(this.keepaliveTimer);\r\n        this.keepaliveTimer = setInterval(() => {\r\n            //If there has been no websocket activity for a while, send a no-op\r\n            if (this.mySock) {\r\n                this.sendString_('0');\r\n            }\r\n            this.resetKeepAlive();\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        }, Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL));\r\n    }\r\n    /**\r\n     * Send a string over the websocket.\r\n     *\r\n     * @param str - String to send.\r\n     */\r\n    sendString_(str) {\r\n        // Firefox seems to sometimes throw exceptions (NS_ERROR_UNEXPECTED) from websocket .send()\r\n        // calls for some unknown reason.  We treat these as an error and disconnect.\r\n        // See https://app.asana.com/0/58926111402292/68021340250410\r\n        try {\r\n            this.mySock.send(str);\r\n        }\r\n        catch (e) {\r\n            this.log_('Exception thrown from WebSocket.send():', e.message || e.data, 'Closing connection.');\r\n            setTimeout(this.onClosed_.bind(this), 0);\r\n        }\r\n    }\r\n}\r\n/**\r\n * Number of response before we consider the connection \"healthy.\"\r\n */\r\nWebSocketConnection.responsesRequiredToBeHealthy = 2;\r\n/**\r\n * Time to wait for the connection te become healthy before giving up.\r\n */\r\nWebSocketConnection.healthyTimeout = 30000;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Currently simplistic, this class manages what transport a Connection should use at various stages of its\r\n * lifecycle.\r\n *\r\n * It starts with longpolling in a browser, and httppolling on node. It then upgrades to websockets if\r\n * they are available.\r\n */\r\nclass TransportManager {\r\n    /**\r\n     * @param repoInfo - Metadata around the namespace we're connecting to\r\n     */\r\n    constructor(repoInfo) {\r\n        this.initTransports_(repoInfo);\r\n    }\r\n    static get ALL_TRANSPORTS() {\r\n        return [BrowserPollConnection, WebSocketConnection];\r\n    }\r\n    /**\r\n     * Returns whether transport has been selected to ensure WebSocketConnection or BrowserPollConnection are not called after\r\n     * TransportManager has already set up transports_\r\n     */\r\n    static get IS_TRANSPORT_INITIALIZED() {\r\n        return this.globalTransportInitialized_;\r\n    }\r\n    initTransports_(repoInfo) {\r\n        const isWebSocketsAvailable = WebSocketConnection && WebSocketConnection['isAvailable']();\r\n        let isSkipPollConnection = isWebSocketsAvailable && !WebSocketConnection.previouslyFailed();\r\n        if (repoInfo.webSocketOnly) {\r\n            if (!isWebSocketsAvailable) {\r\n                warn(\"wss:// URL used, but browser isn't known to support websockets.  Trying anyway.\");\r\n            }\r\n            isSkipPollConnection = true;\r\n        }\r\n        if (isSkipPollConnection) {\r\n            this.transports_ = [WebSocketConnection];\r\n        }\r\n        else {\r\n            const transports = (this.transports_ = []);\r\n            for (const transport of TransportManager.ALL_TRANSPORTS) {\r\n                if (transport && transport['isAvailable']()) {\r\n                    transports.push(transport);\r\n                }\r\n            }\r\n            TransportManager.globalTransportInitialized_ = true;\r\n        }\r\n    }\r\n    /**\r\n     * @returns The constructor for the initial transport to use\r\n     */\r\n    initialTransport() {\r\n        if (this.transports_.length > 0) {\r\n            return this.transports_[0];\r\n        }\r\n        else {\r\n            throw new Error('No transports available');\r\n        }\r\n    }\r\n    /**\r\n     * @returns The constructor for the next transport, or null\r\n     */\r\n    upgradeTransport() {\r\n        if (this.transports_.length > 1) {\r\n            return this.transports_[1];\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n}\r\n// Keeps track of whether the TransportManager has already chosen a transport to use\r\nTransportManager.globalTransportInitialized_ = false;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Abort upgrade attempt if it takes longer than 60s.\r\nconst UPGRADE_TIMEOUT = 60000;\r\n// For some transports (WebSockets), we need to \"validate\" the transport by exchanging a few requests and responses.\r\n// If we haven't sent enough requests within 5s, we'll start sending noop ping requests.\r\nconst DELAY_BEFORE_SENDING_EXTRA_REQUESTS = 5000;\r\n// If the initial data sent triggers a lot of bandwidth (i.e. it's a large put or a listen for a large amount of data)\r\n// then we may not be able to exchange our ping/pong requests within the healthy timeout.  So if we reach the timeout\r\n// but we've sent/received enough bytes, we don't cancel the connection.\r\nconst BYTES_SENT_HEALTHY_OVERRIDE = 10 * 1024;\r\nconst BYTES_RECEIVED_HEALTHY_OVERRIDE = 100 * 1024;\r\nconst MESSAGE_TYPE = 't';\r\nconst MESSAGE_DATA = 'd';\r\nconst CONTROL_SHUTDOWN = 's';\r\nconst CONTROL_RESET = 'r';\r\nconst CONTROL_ERROR = 'e';\r\nconst CONTROL_PONG = 'o';\r\nconst SWITCH_ACK = 'a';\r\nconst END_TRANSMISSION = 'n';\r\nconst PING = 'p';\r\nconst SERVER_HELLO = 'h';\r\n/**\r\n * Creates a new real-time connection to the server using whichever method works\r\n * best in the current browser.\r\n */\r\nclass Connection {\r\n    /**\r\n     * @param id - an id for this connection\r\n     * @param repoInfo_ - the info for the endpoint to connect to\r\n     * @param applicationId_ - the Firebase App ID for this project\r\n     * @param appCheckToken_ - The App Check Token for this device.\r\n     * @param authToken_ - The auth token for this session.\r\n     * @param onMessage_ - the callback to be triggered when a server-push message arrives\r\n     * @param onReady_ - the callback to be triggered when this connection is ready to send messages.\r\n     * @param onDisconnect_ - the callback to be triggered when a connection was lost\r\n     * @param onKill_ - the callback to be triggered when this connection has permanently shut down.\r\n     * @param lastSessionId - last session id in persistent connection. is used to clean up old session in real-time server\r\n     */\r\n    constructor(id, repoInfo_, applicationId_, appCheckToken_, authToken_, onMessage_, onReady_, onDisconnect_, onKill_, lastSessionId) {\r\n        this.id = id;\r\n        this.repoInfo_ = repoInfo_;\r\n        this.applicationId_ = applicationId_;\r\n        this.appCheckToken_ = appCheckToken_;\r\n        this.authToken_ = authToken_;\r\n        this.onMessage_ = onMessage_;\r\n        this.onReady_ = onReady_;\r\n        this.onDisconnect_ = onDisconnect_;\r\n        this.onKill_ = onKill_;\r\n        this.lastSessionId = lastSessionId;\r\n        this.connectionCount = 0;\r\n        this.pendingDataMessages = [];\r\n        this.state_ = 0 /* RealtimeState.CONNECTING */;\r\n        this.log_ = logWrapper('c:' + this.id + ':');\r\n        this.transportManager_ = new TransportManager(repoInfo_);\r\n        this.log_('Connection created');\r\n        this.start_();\r\n    }\r\n    /**\r\n     * Starts a connection attempt\r\n     */\r\n    start_() {\r\n        const conn = this.transportManager_.initialTransport();\r\n        this.conn_ = new conn(this.nextTransportId_(), this.repoInfo_, this.applicationId_, this.appCheckToken_, this.authToken_, null, this.lastSessionId);\r\n        // For certain transports (WebSockets), we need to send and receive several messages back and forth before we\r\n        // can consider the transport healthy.\r\n        this.primaryResponsesRequired_ = conn['responsesRequiredToBeHealthy'] || 0;\r\n        const onMessageReceived = this.connReceiver_(this.conn_);\r\n        const onConnectionLost = this.disconnReceiver_(this.conn_);\r\n        this.tx_ = this.conn_;\r\n        this.rx_ = this.conn_;\r\n        this.secondaryConn_ = null;\r\n        this.isHealthy_ = false;\r\n        /*\r\n         * Firefox doesn't like when code from one iframe tries to create another iframe by way of the parent frame.\r\n         * This can occur in the case of a redirect, i.e. we guessed wrong on what server to connect to and received a reset.\r\n         * Somehow, setTimeout seems to make this ok. That doesn't make sense from a security perspective, since you should\r\n         * still have the context of your originating frame.\r\n         */\r\n        setTimeout(() => {\r\n            // this.conn_ gets set to null in some of the tests. Check to make sure it still exists before using it\r\n            this.conn_ && this.conn_.open(onMessageReceived, onConnectionLost);\r\n        }, Math.floor(0));\r\n        const healthyTimeoutMS = conn['healthyTimeout'] || 0;\r\n        if (healthyTimeoutMS > 0) {\r\n            this.healthyTimeout_ = setTimeoutNonBlocking(() => {\r\n                this.healthyTimeout_ = null;\r\n                if (!this.isHealthy_) {\r\n                    if (this.conn_ &&\r\n                        this.conn_.bytesReceived > BYTES_RECEIVED_HEALTHY_OVERRIDE) {\r\n                        this.log_('Connection exceeded healthy timeout but has received ' +\r\n                            this.conn_.bytesReceived +\r\n                            ' bytes.  Marking connection healthy.');\r\n                        this.isHealthy_ = true;\r\n                        this.conn_.markConnectionHealthy();\r\n                    }\r\n                    else if (this.conn_ &&\r\n                        this.conn_.bytesSent > BYTES_SENT_HEALTHY_OVERRIDE) {\r\n                        this.log_('Connection exceeded healthy timeout but has sent ' +\r\n                            this.conn_.bytesSent +\r\n                            ' bytes.  Leaving connection alive.');\r\n                        // NOTE: We don't want to mark it healthy, since we have no guarantee that the bytes have made it to\r\n                        // the server.\r\n                    }\r\n                    else {\r\n                        this.log_('Closing unhealthy connection after timeout.');\r\n                        this.close();\r\n                    }\r\n                }\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            }, Math.floor(healthyTimeoutMS));\r\n        }\r\n    }\r\n    nextTransportId_() {\r\n        return 'c:' + this.id + ':' + this.connectionCount++;\r\n    }\r\n    disconnReceiver_(conn) {\r\n        return everConnected => {\r\n            if (conn === this.conn_) {\r\n                this.onConnectionLost_(everConnected);\r\n            }\r\n            else if (conn === this.secondaryConn_) {\r\n                this.log_('Secondary connection lost.');\r\n                this.onSecondaryConnectionLost_();\r\n            }\r\n            else {\r\n                this.log_('closing an old connection');\r\n            }\r\n        };\r\n    }\r\n    connReceiver_(conn) {\r\n        return (message) => {\r\n            if (this.state_ !== 2 /* RealtimeState.DISCONNECTED */) {\r\n                if (conn === this.rx_) {\r\n                    this.onPrimaryMessageReceived_(message);\r\n                }\r\n                else if (conn === this.secondaryConn_) {\r\n                    this.onSecondaryMessageReceived_(message);\r\n                }\r\n                else {\r\n                    this.log_('message on old connection');\r\n                }\r\n            }\r\n        };\r\n    }\r\n    /**\r\n     * @param dataMsg - An arbitrary data message to be sent to the server\r\n     */\r\n    sendRequest(dataMsg) {\r\n        // wrap in a data message envelope and send it on\r\n        const msg = { t: 'd', d: dataMsg };\r\n        this.sendData_(msg);\r\n    }\r\n    tryCleanupConnection() {\r\n        if (this.tx_ === this.secondaryConn_ && this.rx_ === this.secondaryConn_) {\r\n            this.log_('cleaning up and promoting a connection: ' + this.secondaryConn_.connId);\r\n            this.conn_ = this.secondaryConn_;\r\n            this.secondaryConn_ = null;\r\n            // the server will shutdown the old connection\r\n        }\r\n    }\r\n    onSecondaryControl_(controlData) {\r\n        if (MESSAGE_TYPE in controlData) {\r\n            const cmd = controlData[MESSAGE_TYPE];\r\n            if (cmd === SWITCH_ACK) {\r\n                this.upgradeIfSecondaryHealthy_();\r\n            }\r\n            else if (cmd === CONTROL_RESET) {\r\n                // Most likely the session wasn't valid. Abandon the switch attempt\r\n                this.log_('Got a reset on secondary, closing it');\r\n                this.secondaryConn_.close();\r\n                // If we were already using this connection for something, than we need to fully close\r\n                if (this.tx_ === this.secondaryConn_ ||\r\n                    this.rx_ === this.secondaryConn_) {\r\n                    this.close();\r\n                }\r\n            }\r\n            else if (cmd === CONTROL_PONG) {\r\n                this.log_('got pong on secondary.');\r\n                this.secondaryResponsesRequired_--;\r\n                this.upgradeIfSecondaryHealthy_();\r\n            }\r\n        }\r\n    }\r\n    onSecondaryMessageReceived_(parsedData) {\r\n        const layer = requireKey('t', parsedData);\r\n        const data = requireKey('d', parsedData);\r\n        if (layer === 'c') {\r\n            this.onSecondaryControl_(data);\r\n        }\r\n        else if (layer === 'd') {\r\n            // got a data message, but we're still second connection. Need to buffer it up\r\n            this.pendingDataMessages.push(data);\r\n        }\r\n        else {\r\n            throw new Error('Unknown protocol layer: ' + layer);\r\n        }\r\n    }\r\n    upgradeIfSecondaryHealthy_() {\r\n        if (this.secondaryResponsesRequired_ <= 0) {\r\n            this.log_('Secondary connection is healthy.');\r\n            this.isHealthy_ = true;\r\n            this.secondaryConn_.markConnectionHealthy();\r\n            this.proceedWithUpgrade_();\r\n        }\r\n        else {\r\n            // Send a ping to make sure the connection is healthy.\r\n            this.log_('sending ping on secondary.');\r\n            this.secondaryConn_.send({ t: 'c', d: { t: PING, d: {} } });\r\n        }\r\n    }\r\n    proceedWithUpgrade_() {\r\n        // tell this connection to consider itself open\r\n        this.secondaryConn_.start();\r\n        // send ack\r\n        this.log_('sending client ack on secondary');\r\n        this.secondaryConn_.send({ t: 'c', d: { t: SWITCH_ACK, d: {} } });\r\n        // send end packet on primary transport, switch to sending on this one\r\n        // can receive on this one, buffer responses until end received on primary transport\r\n        this.log_('Ending transmission on primary');\r\n        this.conn_.send({ t: 'c', d: { t: END_TRANSMISSION, d: {} } });\r\n        this.tx_ = this.secondaryConn_;\r\n        this.tryCleanupConnection();\r\n    }\r\n    onPrimaryMessageReceived_(parsedData) {\r\n        // Must refer to parsedData properties in quotes, so closure doesn't touch them.\r\n        const layer = requireKey('t', parsedData);\r\n        const data = requireKey('d', parsedData);\r\n        if (layer === 'c') {\r\n            this.onControl_(data);\r\n        }\r\n        else if (layer === 'd') {\r\n            this.onDataMessage_(data);\r\n        }\r\n    }\r\n    onDataMessage_(message) {\r\n        this.onPrimaryResponse_();\r\n        // We don't do anything with data messages, just kick them up a level\r\n        this.onMessage_(message);\r\n    }\r\n    onPrimaryResponse_() {\r\n        if (!this.isHealthy_) {\r\n            this.primaryResponsesRequired_--;\r\n            if (this.primaryResponsesRequired_ <= 0) {\r\n                this.log_('Primary connection is healthy.');\r\n                this.isHealthy_ = true;\r\n                this.conn_.markConnectionHealthy();\r\n            }\r\n        }\r\n    }\r\n    onControl_(controlData) {\r\n        const cmd = requireKey(MESSAGE_TYPE, controlData);\r\n        if (MESSAGE_DATA in controlData) {\r\n            const payload = controlData[MESSAGE_DATA];\r\n            if (cmd === SERVER_HELLO) {\r\n                const handshakePayload = Object.assign({}, payload);\r\n                if (this.repoInfo_.isUsingEmulator) {\r\n                    // Upon connecting, the emulator will pass the hostname that it's aware of, but we prefer the user's set hostname via `connectDatabaseEmulator` over what the emulator passes.\r\n                    handshakePayload.h = this.repoInfo_.host;\r\n                }\r\n                this.onHandshake_(handshakePayload);\r\n            }\r\n            else if (cmd === END_TRANSMISSION) {\r\n                this.log_('recvd end transmission on primary');\r\n                this.rx_ = this.secondaryConn_;\r\n                for (let i = 0; i < this.pendingDataMessages.length; ++i) {\r\n                    this.onDataMessage_(this.pendingDataMessages[i]);\r\n                }\r\n                this.pendingDataMessages = [];\r\n                this.tryCleanupConnection();\r\n            }\r\n            else if (cmd === CONTROL_SHUTDOWN) {\r\n                // This was previously the 'onKill' callback passed to the lower-level connection\r\n                // payload in this case is the reason for the shutdown. Generally a human-readable error\r\n                this.onConnectionShutdown_(payload);\r\n            }\r\n            else if (cmd === CONTROL_RESET) {\r\n                // payload in this case is the host we should contact\r\n                this.onReset_(payload);\r\n            }\r\n            else if (cmd === CONTROL_ERROR) {\r\n                error('Server Error: ' + payload);\r\n            }\r\n            else if (cmd === CONTROL_PONG) {\r\n                this.log_('got pong on primary.');\r\n                this.onPrimaryResponse_();\r\n                this.sendPingOnPrimaryIfNecessary_();\r\n            }\r\n            else {\r\n                error('Unknown control packet command: ' + cmd);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * @param handshake - The handshake data returned from the server\r\n     */\r\n    onHandshake_(handshake) {\r\n        const timestamp = handshake.ts;\r\n        const version = handshake.v;\r\n        const host = handshake.h;\r\n        this.sessionId = handshake.s;\r\n        this.repoInfo_.host = host;\r\n        // if we've already closed the connection, then don't bother trying to progress further\r\n        if (this.state_ === 0 /* RealtimeState.CONNECTING */) {\r\n            this.conn_.start();\r\n            this.onConnectionEstablished_(this.conn_, timestamp);\r\n            if (PROTOCOL_VERSION !== version) {\r\n                warn('Protocol version mismatch detected');\r\n            }\r\n            // TODO: do we want to upgrade? when? maybe a delay?\r\n            this.tryStartUpgrade_();\r\n        }\r\n    }\r\n    tryStartUpgrade_() {\r\n        const conn = this.transportManager_.upgradeTransport();\r\n        if (conn) {\r\n            this.startUpgrade_(conn);\r\n        }\r\n    }\r\n    startUpgrade_(conn) {\r\n        this.secondaryConn_ = new conn(this.nextTransportId_(), this.repoInfo_, this.applicationId_, this.appCheckToken_, this.authToken_, this.sessionId);\r\n        // For certain transports (WebSockets), we need to send and receive several messages back and forth before we\r\n        // can consider the transport healthy.\r\n        this.secondaryResponsesRequired_ =\r\n            conn['responsesRequiredToBeHealthy'] || 0;\r\n        const onMessage = this.connReceiver_(this.secondaryConn_);\r\n        const onDisconnect = this.disconnReceiver_(this.secondaryConn_);\r\n        this.secondaryConn_.open(onMessage, onDisconnect);\r\n        // If we haven't successfully upgraded after UPGRADE_TIMEOUT, give up and kill the secondary.\r\n        setTimeoutNonBlocking(() => {\r\n            if (this.secondaryConn_) {\r\n                this.log_('Timed out trying to upgrade.');\r\n                this.secondaryConn_.close();\r\n            }\r\n        }, Math.floor(UPGRADE_TIMEOUT));\r\n    }\r\n    onReset_(host) {\r\n        this.log_('Reset packet received.  New host: ' + host);\r\n        this.repoInfo_.host = host;\r\n        // TODO: if we're already \"connected\", we need to trigger a disconnect at the next layer up.\r\n        // We don't currently support resets after the connection has already been established\r\n        if (this.state_ === 1 /* RealtimeState.CONNECTED */) {\r\n            this.close();\r\n        }\r\n        else {\r\n            // Close whatever connections we have open and start again.\r\n            this.closeConnections_();\r\n            this.start_();\r\n        }\r\n    }\r\n    onConnectionEstablished_(conn, timestamp) {\r\n        this.log_('Realtime connection established.');\r\n        this.conn_ = conn;\r\n        this.state_ = 1 /* RealtimeState.CONNECTED */;\r\n        if (this.onReady_) {\r\n            this.onReady_(timestamp, this.sessionId);\r\n            this.onReady_ = null;\r\n        }\r\n        // If after 5 seconds we haven't sent enough requests to the server to get the connection healthy,\r\n        // send some pings.\r\n        if (this.primaryResponsesRequired_ === 0) {\r\n            this.log_('Primary connection is healthy.');\r\n            this.isHealthy_ = true;\r\n        }\r\n        else {\r\n            setTimeoutNonBlocking(() => {\r\n                this.sendPingOnPrimaryIfNecessary_();\r\n            }, Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS));\r\n        }\r\n    }\r\n    sendPingOnPrimaryIfNecessary_() {\r\n        // If the connection isn't considered healthy yet, we'll send a noop ping packet request.\r\n        if (!this.isHealthy_ && this.state_ === 1 /* RealtimeState.CONNECTED */) {\r\n            this.log_('sending ping on primary.');\r\n            this.sendData_({ t: 'c', d: { t: PING, d: {} } });\r\n        }\r\n    }\r\n    onSecondaryConnectionLost_() {\r\n        const conn = this.secondaryConn_;\r\n        this.secondaryConn_ = null;\r\n        if (this.tx_ === conn || this.rx_ === conn) {\r\n            // we are relying on this connection already in some capacity. Therefore, a failure is real\r\n            this.close();\r\n        }\r\n    }\r\n    /**\r\n     * @param everConnected - Whether or not the connection ever reached a server. Used to determine if\r\n     * we should flush the host cache\r\n     */\r\n    onConnectionLost_(everConnected) {\r\n        this.conn_ = null;\r\n        // NOTE: IF you're seeing a Firefox error for this line, I think it might be because it's getting\r\n        // called on window close and RealtimeState.CONNECTING is no longer defined.  Just a guess.\r\n        if (!everConnected && this.state_ === 0 /* RealtimeState.CONNECTING */) {\r\n            this.log_('Realtime connection failed.');\r\n            // Since we failed to connect at all, clear any cached entry for this namespace in case the machine went away\r\n            if (this.repoInfo_.isCacheableHost()) {\r\n                PersistentStorage.remove('host:' + this.repoInfo_.host);\r\n                // reset the internal host to what we would show the user, i.e. <ns>.firebaseio.com\r\n                this.repoInfo_.internalHost = this.repoInfo_.host;\r\n            }\r\n        }\r\n        else if (this.state_ === 1 /* RealtimeState.CONNECTED */) {\r\n            this.log_('Realtime connection lost.');\r\n        }\r\n        this.close();\r\n    }\r\n    onConnectionShutdown_(reason) {\r\n        this.log_('Connection shutdown command received. Shutting down...');\r\n        if (this.onKill_) {\r\n            this.onKill_(reason);\r\n            this.onKill_ = null;\r\n        }\r\n        // We intentionally don't want to fire onDisconnect (kill is a different case),\r\n        // so clear the callback.\r\n        this.onDisconnect_ = null;\r\n        this.close();\r\n    }\r\n    sendData_(data) {\r\n        if (this.state_ !== 1 /* RealtimeState.CONNECTED */) {\r\n            throw 'Connection is not connected';\r\n        }\r\n        else {\r\n            this.tx_.send(data);\r\n        }\r\n    }\r\n    /**\r\n     * Cleans up this connection, calling the appropriate callbacks\r\n     */\r\n    close() {\r\n        if (this.state_ !== 2 /* RealtimeState.DISCONNECTED */) {\r\n            this.log_('Closing realtime connection.');\r\n            this.state_ = 2 /* RealtimeState.DISCONNECTED */;\r\n            this.closeConnections_();\r\n            if (this.onDisconnect_) {\r\n                this.onDisconnect_();\r\n                this.onDisconnect_ = null;\r\n            }\r\n        }\r\n    }\r\n    closeConnections_() {\r\n        this.log_('Shutting down all connections');\r\n        if (this.conn_) {\r\n            this.conn_.close();\r\n            this.conn_ = null;\r\n        }\r\n        if (this.secondaryConn_) {\r\n            this.secondaryConn_.close();\r\n            this.secondaryConn_ = null;\r\n        }\r\n        if (this.healthyTimeout_) {\r\n            clearTimeout(this.healthyTimeout_);\r\n            this.healthyTimeout_ = null;\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Interface defining the set of actions that can be performed against the Firebase server\r\n * (basically corresponds to our wire protocol).\r\n *\r\n * @interface\r\n */\r\nclass ServerActions {\r\n    put(pathString, data, onComplete, hash) { }\r\n    merge(pathString, data, onComplete, hash) { }\r\n    /**\r\n     * Refreshes the auth token for the current connection.\r\n     * @param token - The authentication token\r\n     */\r\n    refreshAuthToken(token) { }\r\n    /**\r\n     * Refreshes the app check token for the current connection.\r\n     * @param token The app check token\r\n     */\r\n    refreshAppCheckToken(token) { }\r\n    onDisconnectPut(pathString, data, onComplete) { }\r\n    onDisconnectMerge(pathString, data, onComplete) { }\r\n    onDisconnectCancel(pathString, onComplete) { }\r\n    reportStats(stats) { }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Base class to be used if you want to emit events. Call the constructor with\r\n * the set of allowed event names.\r\n */\r\nclass EventEmitter {\r\n    constructor(allowedEvents_) {\r\n        this.allowedEvents_ = allowedEvents_;\r\n        this.listeners_ = {};\r\n        assert(Array.isArray(allowedEvents_) && allowedEvents_.length > 0, 'Requires a non-empty array');\r\n    }\r\n    /**\r\n     * To be called by derived classes to trigger events.\r\n     */\r\n    trigger(eventType, ...varArgs) {\r\n        if (Array.isArray(this.listeners_[eventType])) {\r\n            // Clone the list, since callbacks could add/remove listeners.\r\n            const listeners = [...this.listeners_[eventType]];\r\n            for (let i = 0; i < listeners.length; i++) {\r\n                listeners[i].callback.apply(listeners[i].context, varArgs);\r\n            }\r\n        }\r\n    }\r\n    on(eventType, callback, context) {\r\n        this.validateEventType_(eventType);\r\n        this.listeners_[eventType] = this.listeners_[eventType] || [];\r\n        this.listeners_[eventType].push({ callback, context });\r\n        const eventData = this.getInitialEvent(eventType);\r\n        if (eventData) {\r\n            callback.apply(context, eventData);\r\n        }\r\n    }\r\n    off(eventType, callback, context) {\r\n        this.validateEventType_(eventType);\r\n        const listeners = this.listeners_[eventType] || [];\r\n        for (let i = 0; i < listeners.length; i++) {\r\n            if (listeners[i].callback === callback &&\r\n                (!context || context === listeners[i].context)) {\r\n                listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    validateEventType_(eventType) {\r\n        assert(this.allowedEvents_.find(et => {\r\n            return et === eventType;\r\n        }), 'Unknown event: ' + eventType);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Monitors online state (as reported by window.online/offline events).\r\n *\r\n * The expectation is that this could have many false positives (thinks we are online\r\n * when we're not), but no false negatives.  So we can safely use it to determine when\r\n * we definitely cannot reach the internet.\r\n */\r\nclass OnlineMonitor extends EventEmitter {\r\n    constructor() {\r\n        super(['online']);\r\n        this.online_ = true;\r\n        // We've had repeated complaints that Cordova apps can get stuck \"offline\", e.g.\r\n        // https://forum.ionicframework.com/t/firebase-connection-is-lost-and-never-come-back/43810\r\n        // It would seem that the 'online' event does not always fire consistently. So we disable it\r\n        // for Cordova.\r\n        if (typeof window !== 'undefined' &&\r\n            typeof window.addEventListener !== 'undefined' &&\r\n            !isMobileCordova()) {\r\n            window.addEventListener('online', () => {\r\n                if (!this.online_) {\r\n                    this.online_ = true;\r\n                    this.trigger('online', true);\r\n                }\r\n            }, false);\r\n            window.addEventListener('offline', () => {\r\n                if (this.online_) {\r\n                    this.online_ = false;\r\n                    this.trigger('online', false);\r\n                }\r\n            }, false);\r\n        }\r\n    }\r\n    static getInstance() {\r\n        return new OnlineMonitor();\r\n    }\r\n    getInitialEvent(eventType) {\r\n        assert(eventType === 'online', 'Unknown event type: ' + eventType);\r\n        return [this.online_];\r\n    }\r\n    currentlyOnline() {\r\n        return this.online_;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Maximum key depth. */\r\nconst MAX_PATH_DEPTH = 32;\r\n/** Maximum number of (UTF8) bytes in a Firebase path. */\r\nconst MAX_PATH_LENGTH_BYTES = 768;\r\n/**\r\n * An immutable object representing a parsed path.  It's immutable so that you\r\n * can pass them around to other functions without worrying about them changing\r\n * it.\r\n */\r\nclass Path {\r\n    /**\r\n     * @param pathOrString - Path string to parse, or another path, or the raw\r\n     * tokens array\r\n     */\r\n    constructor(pathOrString, pieceNum) {\r\n        if (pieceNum === void 0) {\r\n            this.pieces_ = pathOrString.split('/');\r\n            // Remove empty pieces.\r\n            let copyTo = 0;\r\n            for (let i = 0; i < this.pieces_.length; i++) {\r\n                if (this.pieces_[i].length > 0) {\r\n                    this.pieces_[copyTo] = this.pieces_[i];\r\n                    copyTo++;\r\n                }\r\n            }\r\n            this.pieces_.length = copyTo;\r\n            this.pieceNum_ = 0;\r\n        }\r\n        else {\r\n            this.pieces_ = pathOrString;\r\n            this.pieceNum_ = pieceNum;\r\n        }\r\n    }\r\n    toString() {\r\n        let pathString = '';\r\n        for (let i = this.pieceNum_; i < this.pieces_.length; i++) {\r\n            if (this.pieces_[i] !== '') {\r\n                pathString += '/' + this.pieces_[i];\r\n            }\r\n        }\r\n        return pathString || '/';\r\n    }\r\n}\r\nfunction newEmptyPath() {\r\n    return new Path('');\r\n}\r\nfunction pathGetFront(path) {\r\n    if (path.pieceNum_ >= path.pieces_.length) {\r\n        return null;\r\n    }\r\n    return path.pieces_[path.pieceNum_];\r\n}\r\n/**\r\n * @returns The number of segments in this path\r\n */\r\nfunction pathGetLength(path) {\r\n    return path.pieces_.length - path.pieceNum_;\r\n}\r\nfunction pathPopFront(path) {\r\n    let pieceNum = path.pieceNum_;\r\n    if (pieceNum < path.pieces_.length) {\r\n        pieceNum++;\r\n    }\r\n    return new Path(path.pieces_, pieceNum);\r\n}\r\nfunction pathGetBack(path) {\r\n    if (path.pieceNum_ < path.pieces_.length) {\r\n        return path.pieces_[path.pieces_.length - 1];\r\n    }\r\n    return null;\r\n}\r\nfunction pathToUrlEncodedString(path) {\r\n    let pathString = '';\r\n    for (let i = path.pieceNum_; i < path.pieces_.length; i++) {\r\n        if (path.pieces_[i] !== '') {\r\n            pathString += '/' + encodeURIComponent(String(path.pieces_[i]));\r\n        }\r\n    }\r\n    return pathString || '/';\r\n}\r\n/**\r\n * Shallow copy of the parts of the path.\r\n *\r\n */\r\nfunction pathSlice(path, begin = 0) {\r\n    return path.pieces_.slice(path.pieceNum_ + begin);\r\n}\r\nfunction pathParent(path) {\r\n    if (path.pieceNum_ >= path.pieces_.length) {\r\n        return null;\r\n    }\r\n    const pieces = [];\r\n    for (let i = path.pieceNum_; i < path.pieces_.length - 1; i++) {\r\n        pieces.push(path.pieces_[i]);\r\n    }\r\n    return new Path(pieces, 0);\r\n}\r\nfunction pathChild(path, childPathObj) {\r\n    const pieces = [];\r\n    for (let i = path.pieceNum_; i < path.pieces_.length; i++) {\r\n        pieces.push(path.pieces_[i]);\r\n    }\r\n    if (childPathObj instanceof Path) {\r\n        for (let i = childPathObj.pieceNum_; i < childPathObj.pieces_.length; i++) {\r\n            pieces.push(childPathObj.pieces_[i]);\r\n        }\r\n    }\r\n    else {\r\n        const childPieces = childPathObj.split('/');\r\n        for (let i = 0; i < childPieces.length; i++) {\r\n            if (childPieces[i].length > 0) {\r\n                pieces.push(childPieces[i]);\r\n            }\r\n        }\r\n    }\r\n    return new Path(pieces, 0);\r\n}\r\n/**\r\n * @returns True if there are no segments in this path\r\n */\r\nfunction pathIsEmpty(path) {\r\n    return path.pieceNum_ >= path.pieces_.length;\r\n}\r\n/**\r\n * @returns The path from outerPath to innerPath\r\n */\r\nfunction newRelativePath(outerPath, innerPath) {\r\n    const outer = pathGetFront(outerPath), inner = pathGetFront(innerPath);\r\n    if (outer === null) {\r\n        return innerPath;\r\n    }\r\n    else if (outer === inner) {\r\n        return newRelativePath(pathPopFront(outerPath), pathPopFront(innerPath));\r\n    }\r\n    else {\r\n        throw new Error('INTERNAL ERROR: innerPath (' +\r\n            innerPath +\r\n            ') is not within ' +\r\n            'outerPath (' +\r\n            outerPath +\r\n            ')');\r\n    }\r\n}\r\n/**\r\n * @returns -1, 0, 1 if left is less, equal, or greater than the right.\r\n */\r\nfunction pathCompare(left, right) {\r\n    const leftKeys = pathSlice(left, 0);\r\n    const rightKeys = pathSlice(right, 0);\r\n    for (let i = 0; i < leftKeys.length && i < rightKeys.length; i++) {\r\n        const cmp = nameCompare(leftKeys[i], rightKeys[i]);\r\n        if (cmp !== 0) {\r\n            return cmp;\r\n        }\r\n    }\r\n    if (leftKeys.length === rightKeys.length) {\r\n        return 0;\r\n    }\r\n    return leftKeys.length < rightKeys.length ? -1 : 1;\r\n}\r\n/**\r\n * @returns true if paths are the same.\r\n */\r\nfunction pathEquals(path, other) {\r\n    if (pathGetLength(path) !== pathGetLength(other)) {\r\n        return false;\r\n    }\r\n    for (let i = path.pieceNum_, j = other.pieceNum_; i <= path.pieces_.length; i++, j++) {\r\n        if (path.pieces_[i] !== other.pieces_[j]) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n/**\r\n * @returns True if this path is a parent of (or the same as) other\r\n */\r\nfunction pathContains(path, other) {\r\n    let i = path.pieceNum_;\r\n    let j = other.pieceNum_;\r\n    if (pathGetLength(path) > pathGetLength(other)) {\r\n        return false;\r\n    }\r\n    while (i < path.pieces_.length) {\r\n        if (path.pieces_[i] !== other.pieces_[j]) {\r\n            return false;\r\n        }\r\n        ++i;\r\n        ++j;\r\n    }\r\n    return true;\r\n}\r\n/**\r\n * Dynamic (mutable) path used to count path lengths.\r\n *\r\n * This class is used to efficiently check paths for valid\r\n * length (in UTF8 bytes) and depth (used in path validation).\r\n *\r\n * Throws Error exception if path is ever invalid.\r\n *\r\n * The definition of a path always begins with '/'.\r\n */\r\nclass ValidationPath {\r\n    /**\r\n     * @param path - Initial Path.\r\n     * @param errorPrefix_ - Prefix for any error messages.\r\n     */\r\n    constructor(path, errorPrefix_) {\r\n        this.errorPrefix_ = errorPrefix_;\r\n        this.parts_ = pathSlice(path, 0);\r\n        /** Initialize to number of '/' chars needed in path. */\r\n        this.byteLength_ = Math.max(1, this.parts_.length);\r\n        for (let i = 0; i < this.parts_.length; i++) {\r\n            this.byteLength_ += stringLength(this.parts_[i]);\r\n        }\r\n        validationPathCheckValid(this);\r\n    }\r\n}\r\nfunction validationPathPush(validationPath, child) {\r\n    // Count the needed '/'\r\n    if (validationPath.parts_.length > 0) {\r\n        validationPath.byteLength_ += 1;\r\n    }\r\n    validationPath.parts_.push(child);\r\n    validationPath.byteLength_ += stringLength(child);\r\n    validationPathCheckValid(validationPath);\r\n}\r\nfunction validationPathPop(validationPath) {\r\n    const last = validationPath.parts_.pop();\r\n    validationPath.byteLength_ -= stringLength(last);\r\n    // Un-count the previous '/'\r\n    if (validationPath.parts_.length > 0) {\r\n        validationPath.byteLength_ -= 1;\r\n    }\r\n}\r\nfunction validationPathCheckValid(validationPath) {\r\n    if (validationPath.byteLength_ > MAX_PATH_LENGTH_BYTES) {\r\n        throw new Error(validationPath.errorPrefix_ +\r\n            'has a key path longer than ' +\r\n            MAX_PATH_LENGTH_BYTES +\r\n            ' bytes (' +\r\n            validationPath.byteLength_ +\r\n            ').');\r\n    }\r\n    if (validationPath.parts_.length > MAX_PATH_DEPTH) {\r\n        throw new Error(validationPath.errorPrefix_ +\r\n            'path specified exceeds the maximum depth that can be written (' +\r\n            MAX_PATH_DEPTH +\r\n            ') or object contains a cycle ' +\r\n            validationPathToErrorString(validationPath));\r\n    }\r\n}\r\n/**\r\n * String for use in error messages - uses '.' notation for path.\r\n */\r\nfunction validationPathToErrorString(validationPath) {\r\n    if (validationPath.parts_.length === 0) {\r\n        return '';\r\n    }\r\n    return \"in property '\" + validationPath.parts_.join('.') + \"'\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass VisibilityMonitor extends EventEmitter {\r\n    constructor() {\r\n        super(['visible']);\r\n        let hidden;\r\n        let visibilityChange;\r\n        if (typeof document !== 'undefined' &&\r\n            typeof document.addEventListener !== 'undefined') {\r\n            if (typeof document['hidden'] !== 'undefined') {\r\n                // Opera 12.10 and Firefox 18 and later support\r\n                visibilityChange = 'visibilitychange';\r\n                hidden = 'hidden';\r\n            }\r\n            else if (typeof document['mozHidden'] !== 'undefined') {\r\n                visibilityChange = 'mozvisibilitychange';\r\n                hidden = 'mozHidden';\r\n            }\r\n            else if (typeof document['msHidden'] !== 'undefined') {\r\n                visibilityChange = 'msvisibilitychange';\r\n                hidden = 'msHidden';\r\n            }\r\n            else if (typeof document['webkitHidden'] !== 'undefined') {\r\n                visibilityChange = 'webkitvisibilitychange';\r\n                hidden = 'webkitHidden';\r\n            }\r\n        }\r\n        // Initially, we always assume we are visible. This ensures that in browsers\r\n        // without page visibility support or in cases where we are never visible\r\n        // (e.g. chrome extension), we act as if we are visible, i.e. don't delay\r\n        // reconnects\r\n        this.visible_ = true;\r\n        if (visibilityChange) {\r\n            document.addEventListener(visibilityChange, () => {\r\n                const visible = !document[hidden];\r\n                if (visible !== this.visible_) {\r\n                    this.visible_ = visible;\r\n                    this.trigger('visible', visible);\r\n                }\r\n            }, false);\r\n        }\r\n    }\r\n    static getInstance() {\r\n        return new VisibilityMonitor();\r\n    }\r\n    getInitialEvent(eventType) {\r\n        assert(eventType === 'visible', 'Unknown event type: ' + eventType);\r\n        return [this.visible_];\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst RECONNECT_MIN_DELAY = 1000;\r\nconst RECONNECT_MAX_DELAY_DEFAULT = 60 * 5 * 1000; // 5 minutes in milliseconds (Case: 1858)\r\nconst RECONNECT_MAX_DELAY_FOR_ADMINS = 30 * 1000; // 30 seconds for admin clients (likely to be a backend server)\r\nconst RECONNECT_DELAY_MULTIPLIER = 1.3;\r\nconst RECONNECT_DELAY_RESET_TIMEOUT = 30000; // Reset delay back to MIN_DELAY after being connected for 30sec.\r\nconst SERVER_KILL_INTERRUPT_REASON = 'server_kill';\r\n// If auth fails repeatedly, we'll assume something is wrong and log a warning / back off.\r\nconst INVALID_TOKEN_THRESHOLD = 3;\r\n/**\r\n * Firebase connection.  Abstracts wire protocol and handles reconnecting.\r\n *\r\n * NOTE: All JSON objects sent to the realtime connection must have property names enclosed\r\n * in quotes to make sure the closure compiler does not minify them.\r\n */\r\nclass PersistentConnection extends ServerActions {\r\n    /**\r\n     * @param repoInfo_ - Data about the namespace we are connecting to\r\n     * @param applicationId_ - The Firebase App ID for this project\r\n     * @param onDataUpdate_ - A callback for new data from the server\r\n     */\r\n    constructor(repoInfo_, applicationId_, onDataUpdate_, onConnectStatus_, onServerInfoUpdate_, authTokenProvider_, appCheckTokenProvider_, authOverride_) {\r\n        super();\r\n        this.repoInfo_ = repoInfo_;\r\n        this.applicationId_ = applicationId_;\r\n        this.onDataUpdate_ = onDataUpdate_;\r\n        this.onConnectStatus_ = onConnectStatus_;\r\n        this.onServerInfoUpdate_ = onServerInfoUpdate_;\r\n        this.authTokenProvider_ = authTokenProvider_;\r\n        this.appCheckTokenProvider_ = appCheckTokenProvider_;\r\n        this.authOverride_ = authOverride_;\r\n        // Used for diagnostic logging.\r\n        this.id = PersistentConnection.nextPersistentConnectionId_++;\r\n        this.log_ = logWrapper('p:' + this.id + ':');\r\n        this.interruptReasons_ = {};\r\n        this.listens = new Map();\r\n        this.outstandingPuts_ = [];\r\n        this.outstandingGets_ = [];\r\n        this.outstandingPutCount_ = 0;\r\n        this.outstandingGetCount_ = 0;\r\n        this.onDisconnectRequestQueue_ = [];\r\n        this.connected_ = false;\r\n        this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n        this.maxReconnectDelay_ = RECONNECT_MAX_DELAY_DEFAULT;\r\n        this.securityDebugCallback_ = null;\r\n        this.lastSessionId = null;\r\n        this.establishConnectionTimer_ = null;\r\n        this.visible_ = false;\r\n        // Before we get connected, we keep a queue of pending messages to send.\r\n        this.requestCBHash_ = {};\r\n        this.requestNumber_ = 0;\r\n        this.realtime_ = null;\r\n        this.authToken_ = null;\r\n        this.appCheckToken_ = null;\r\n        this.forceTokenRefresh_ = false;\r\n        this.invalidAuthTokenCount_ = 0;\r\n        this.invalidAppCheckTokenCount_ = 0;\r\n        this.firstConnection_ = true;\r\n        this.lastConnectionAttemptTime_ = null;\r\n        this.lastConnectionEstablishedTime_ = null;\r\n        if (authOverride_ && !isNodeSdk()) {\r\n            throw new Error('Auth override specified in options, but not supported on non Node.js platforms');\r\n        }\r\n        VisibilityMonitor.getInstance().on('visible', this.onVisible_, this);\r\n        if (repoInfo_.host.indexOf('fblocal') === -1) {\r\n            OnlineMonitor.getInstance().on('online', this.onOnline_, this);\r\n        }\r\n    }\r\n    sendRequest(action, body, onResponse) {\r\n        const curReqNum = ++this.requestNumber_;\r\n        const msg = { r: curReqNum, a: action, b: body };\r\n        this.log_(stringify(msg));\r\n        assert(this.connected_, \"sendRequest call when we're not connected not allowed.\");\r\n        this.realtime_.sendRequest(msg);\r\n        if (onResponse) {\r\n            this.requestCBHash_[curReqNum] = onResponse;\r\n        }\r\n    }\r\n    get(query) {\r\n        this.initConnection_();\r\n        const deferred = new Deferred();\r\n        const request = {\r\n            p: query._path.toString(),\r\n            q: query._queryObject\r\n        };\r\n        const outstandingGet = {\r\n            action: 'g',\r\n            request,\r\n            onComplete: (message) => {\r\n                const payload = message['d'];\r\n                if (message['s'] === 'ok') {\r\n                    deferred.resolve(payload);\r\n                }\r\n                else {\r\n                    deferred.reject(payload);\r\n                }\r\n            }\r\n        };\r\n        this.outstandingGets_.push(outstandingGet);\r\n        this.outstandingGetCount_++;\r\n        const index = this.outstandingGets_.length - 1;\r\n        if (this.connected_) {\r\n            this.sendGet_(index);\r\n        }\r\n        return deferred.promise;\r\n    }\r\n    listen(query, currentHashFn, tag, onComplete) {\r\n        this.initConnection_();\r\n        const queryId = query._queryIdentifier;\r\n        const pathString = query._path.toString();\r\n        this.log_('Listen called for ' + pathString + ' ' + queryId);\r\n        if (!this.listens.has(pathString)) {\r\n            this.listens.set(pathString, new Map());\r\n        }\r\n        assert(query._queryParams.isDefault() || !query._queryParams.loadsAllData(), 'listen() called for non-default but complete query');\r\n        assert(!this.listens.get(pathString).has(queryId), `listen() called twice for same path/queryId.`);\r\n        const listenSpec = {\r\n            onComplete,\r\n            hashFn: currentHashFn,\r\n            query,\r\n            tag\r\n        };\r\n        this.listens.get(pathString).set(queryId, listenSpec);\r\n        if (this.connected_) {\r\n            this.sendListen_(listenSpec);\r\n        }\r\n    }\r\n    sendGet_(index) {\r\n        const get = this.outstandingGets_[index];\r\n        this.sendRequest('g', get.request, (message) => {\r\n            delete this.outstandingGets_[index];\r\n            this.outstandingGetCount_--;\r\n            if (this.outstandingGetCount_ === 0) {\r\n                this.outstandingGets_ = [];\r\n            }\r\n            if (get.onComplete) {\r\n                get.onComplete(message);\r\n            }\r\n        });\r\n    }\r\n    sendListen_(listenSpec) {\r\n        const query = listenSpec.query;\r\n        const pathString = query._path.toString();\r\n        const queryId = query._queryIdentifier;\r\n        this.log_('Listen on ' + pathString + ' for ' + queryId);\r\n        const req = { /*path*/ p: pathString };\r\n        const action = 'q';\r\n        // Only bother to send query if it's non-default.\r\n        if (listenSpec.tag) {\r\n            req['q'] = query._queryObject;\r\n            req['t'] = listenSpec.tag;\r\n        }\r\n        req[ /*hash*/'h'] = listenSpec.hashFn();\r\n        this.sendRequest(action, req, (message) => {\r\n            const payload = message[ /*data*/'d'];\r\n            const status = message[ /*status*/'s'];\r\n            // print warnings in any case...\r\n            PersistentConnection.warnOnListenWarnings_(payload, query);\r\n            const currentListenSpec = this.listens.get(pathString) &&\r\n                this.listens.get(pathString).get(queryId);\r\n            // only trigger actions if the listen hasn't been removed and readded\r\n            if (currentListenSpec === listenSpec) {\r\n                this.log_('listen response', message);\r\n                if (status !== 'ok') {\r\n                    this.removeListen_(pathString, queryId);\r\n                }\r\n                if (listenSpec.onComplete) {\r\n                    listenSpec.onComplete(status, payload);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    static warnOnListenWarnings_(payload, query) {\r\n        if (payload && typeof payload === 'object' && contains(payload, 'w')) {\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            const warnings = safeGet(payload, 'w');\r\n            if (Array.isArray(warnings) && ~warnings.indexOf('no_index')) {\r\n                const indexSpec = '\".indexOn\": \"' + query._queryParams.getIndex().toString() + '\"';\r\n                const indexPath = query._path.toString();\r\n                warn(`Using an unspecified index. Your data will be downloaded and ` +\r\n                    `filtered on the client. Consider adding ${indexSpec} at ` +\r\n                    `${indexPath} to your security rules for better performance.`);\r\n            }\r\n        }\r\n    }\r\n    refreshAuthToken(token) {\r\n        this.authToken_ = token;\r\n        this.log_('Auth token refreshed');\r\n        if (this.authToken_) {\r\n            this.tryAuth();\r\n        }\r\n        else {\r\n            //If we're connected we want to let the server know to unauthenticate us. If we're not connected, simply delete\r\n            //the credential so we dont become authenticated next time we connect.\r\n            if (this.connected_) {\r\n                this.sendRequest('unauth', {}, () => { });\r\n            }\r\n        }\r\n        this.reduceReconnectDelayIfAdminCredential_(token);\r\n    }\r\n    reduceReconnectDelayIfAdminCredential_(credential) {\r\n        // NOTE: This isn't intended to be bulletproof (a malicious developer can always just modify the client).\r\n        // Additionally, we don't bother resetting the max delay back to the default if auth fails / expires.\r\n        const isFirebaseSecret = credential && credential.length === 40;\r\n        if (isFirebaseSecret || isAdmin(credential)) {\r\n            this.log_('Admin auth credential detected.  Reducing max reconnect time.');\r\n            this.maxReconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;\r\n        }\r\n    }\r\n    refreshAppCheckToken(token) {\r\n        this.appCheckToken_ = token;\r\n        this.log_('App check token refreshed');\r\n        if (this.appCheckToken_) {\r\n            this.tryAppCheck();\r\n        }\r\n        else {\r\n            //If we're connected we want to let the server know to unauthenticate us.\r\n            //If we're not connected, simply delete the credential so we dont become\r\n            // authenticated next time we connect.\r\n            if (this.connected_) {\r\n                this.sendRequest('unappeck', {}, () => { });\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Attempts to authenticate with the given credentials. If the authentication attempt fails, it's triggered like\r\n     * a auth revoked (the connection is closed).\r\n     */\r\n    tryAuth() {\r\n        if (this.connected_ && this.authToken_) {\r\n            const token = this.authToken_;\r\n            const authMethod = isValidFormat(token) ? 'auth' : 'gauth';\r\n            const requestData = { cred: token };\r\n            if (this.authOverride_ === null) {\r\n                requestData['noauth'] = true;\r\n            }\r\n            else if (typeof this.authOverride_ === 'object') {\r\n                requestData['authvar'] = this.authOverride_;\r\n            }\r\n            this.sendRequest(authMethod, requestData, (res) => {\r\n                const status = res[ /*status*/'s'];\r\n                const data = res[ /*data*/'d'] || 'error';\r\n                if (this.authToken_ === token) {\r\n                    if (status === 'ok') {\r\n                        this.invalidAuthTokenCount_ = 0;\r\n                    }\r\n                    else {\r\n                        // Triggers reconnect and force refresh for auth token\r\n                        this.onAuthRevoked_(status, data);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * Attempts to authenticate with the given token. If the authentication\r\n     * attempt fails, it's triggered like the token was revoked (the connection is\r\n     * closed).\r\n     */\r\n    tryAppCheck() {\r\n        if (this.connected_ && this.appCheckToken_) {\r\n            this.sendRequest('appcheck', { 'token': this.appCheckToken_ }, (res) => {\r\n                const status = res[ /*status*/'s'];\r\n                const data = res[ /*data*/'d'] || 'error';\r\n                if (status === 'ok') {\r\n                    this.invalidAppCheckTokenCount_ = 0;\r\n                }\r\n                else {\r\n                    this.onAppCheckRevoked_(status, data);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    unlisten(query, tag) {\r\n        const pathString = query._path.toString();\r\n        const queryId = query._queryIdentifier;\r\n        this.log_('Unlisten called for ' + pathString + ' ' + queryId);\r\n        assert(query._queryParams.isDefault() || !query._queryParams.loadsAllData(), 'unlisten() called for non-default but complete query');\r\n        const listen = this.removeListen_(pathString, queryId);\r\n        if (listen && this.connected_) {\r\n            this.sendUnlisten_(pathString, queryId, query._queryObject, tag);\r\n        }\r\n    }\r\n    sendUnlisten_(pathString, queryId, queryObj, tag) {\r\n        this.log_('Unlisten on ' + pathString + ' for ' + queryId);\r\n        const req = { /*path*/ p: pathString };\r\n        const action = 'n';\r\n        // Only bother sending queryId if it's non-default.\r\n        if (tag) {\r\n            req['q'] = queryObj;\r\n            req['t'] = tag;\r\n        }\r\n        this.sendRequest(action, req);\r\n    }\r\n    onDisconnectPut(pathString, data, onComplete) {\r\n        this.initConnection_();\r\n        if (this.connected_) {\r\n            this.sendOnDisconnect_('o', pathString, data, onComplete);\r\n        }\r\n        else {\r\n            this.onDisconnectRequestQueue_.push({\r\n                pathString,\r\n                action: 'o',\r\n                data,\r\n                onComplete\r\n            });\r\n        }\r\n    }\r\n    onDisconnectMerge(pathString, data, onComplete) {\r\n        this.initConnection_();\r\n        if (this.connected_) {\r\n            this.sendOnDisconnect_('om', pathString, data, onComplete);\r\n        }\r\n        else {\r\n            this.onDisconnectRequestQueue_.push({\r\n                pathString,\r\n                action: 'om',\r\n                data,\r\n                onComplete\r\n            });\r\n        }\r\n    }\r\n    onDisconnectCancel(pathString, onComplete) {\r\n        this.initConnection_();\r\n        if (this.connected_) {\r\n            this.sendOnDisconnect_('oc', pathString, null, onComplete);\r\n        }\r\n        else {\r\n            this.onDisconnectRequestQueue_.push({\r\n                pathString,\r\n                action: 'oc',\r\n                data: null,\r\n                onComplete\r\n            });\r\n        }\r\n    }\r\n    sendOnDisconnect_(action, pathString, data, onComplete) {\r\n        const request = { /*path*/ p: pathString, /*data*/ d: data };\r\n        this.log_('onDisconnect ' + action, request);\r\n        this.sendRequest(action, request, (response) => {\r\n            if (onComplete) {\r\n                setTimeout(() => {\r\n                    onComplete(response[ /*status*/'s'], response[ /* data */'d']);\r\n                }, Math.floor(0));\r\n            }\r\n        });\r\n    }\r\n    put(pathString, data, onComplete, hash) {\r\n        this.putInternal('p', pathString, data, onComplete, hash);\r\n    }\r\n    merge(pathString, data, onComplete, hash) {\r\n        this.putInternal('m', pathString, data, onComplete, hash);\r\n    }\r\n    putInternal(action, pathString, data, onComplete, hash) {\r\n        this.initConnection_();\r\n        const request = {\r\n            /*path*/ p: pathString,\r\n            /*data*/ d: data\r\n        };\r\n        if (hash !== undefined) {\r\n            request[ /*hash*/'h'] = hash;\r\n        }\r\n        // TODO: Only keep track of the most recent put for a given path?\r\n        this.outstandingPuts_.push({\r\n            action,\r\n            request,\r\n            onComplete\r\n        });\r\n        this.outstandingPutCount_++;\r\n        const index = this.outstandingPuts_.length - 1;\r\n        if (this.connected_) {\r\n            this.sendPut_(index);\r\n        }\r\n        else {\r\n            this.log_('Buffering put: ' + pathString);\r\n        }\r\n    }\r\n    sendPut_(index) {\r\n        const action = this.outstandingPuts_[index].action;\r\n        const request = this.outstandingPuts_[index].request;\r\n        const onComplete = this.outstandingPuts_[index].onComplete;\r\n        this.outstandingPuts_[index].queued = this.connected_;\r\n        this.sendRequest(action, request, (message) => {\r\n            this.log_(action + ' response', message);\r\n            delete this.outstandingPuts_[index];\r\n            this.outstandingPutCount_--;\r\n            // Clean up array occasionally.\r\n            if (this.outstandingPutCount_ === 0) {\r\n                this.outstandingPuts_ = [];\r\n            }\r\n            if (onComplete) {\r\n                onComplete(message[ /*status*/'s'], message[ /* data */'d']);\r\n            }\r\n        });\r\n    }\r\n    reportStats(stats) {\r\n        // If we're not connected, we just drop the stats.\r\n        if (this.connected_) {\r\n            const request = { /*counters*/ c: stats };\r\n            this.log_('reportStats', request);\r\n            this.sendRequest(/*stats*/ 's', request, result => {\r\n                const status = result[ /*status*/'s'];\r\n                if (status !== 'ok') {\r\n                    const errorReason = result[ /* data */'d'];\r\n                    this.log_('reportStats', 'Error sending stats: ' + errorReason);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    onDataMessage_(message) {\r\n        if ('r' in message) {\r\n            // this is a response\r\n            this.log_('from server: ' + stringify(message));\r\n            const reqNum = message['r'];\r\n            const onResponse = this.requestCBHash_[reqNum];\r\n            if (onResponse) {\r\n                delete this.requestCBHash_[reqNum];\r\n                onResponse(message[ /*body*/'b']);\r\n            }\r\n        }\r\n        else if ('error' in message) {\r\n            throw 'A server-side error has occurred: ' + message['error'];\r\n        }\r\n        else if ('a' in message) {\r\n            // a and b are action and body, respectively\r\n            this.onDataPush_(message['a'], message['b']);\r\n        }\r\n    }\r\n    onDataPush_(action, body) {\r\n        this.log_('handleServerMessage', action, body);\r\n        if (action === 'd') {\r\n            this.onDataUpdate_(body[ /*path*/'p'], body[ /*data*/'d'], \r\n            /*isMerge*/ false, body['t']);\r\n        }\r\n        else if (action === 'm') {\r\n            this.onDataUpdate_(body[ /*path*/'p'], body[ /*data*/'d'], \r\n            /*isMerge=*/ true, body['t']);\r\n        }\r\n        else if (action === 'c') {\r\n            this.onListenRevoked_(body[ /*path*/'p'], body[ /*query*/'q']);\r\n        }\r\n        else if (action === 'ac') {\r\n            this.onAuthRevoked_(body[ /*status code*/'s'], body[ /* explanation */'d']);\r\n        }\r\n        else if (action === 'apc') {\r\n            this.onAppCheckRevoked_(body[ /*status code*/'s'], body[ /* explanation */'d']);\r\n        }\r\n        else if (action === 'sd') {\r\n            this.onSecurityDebugPacket_(body);\r\n        }\r\n        else {\r\n            error('Unrecognized action received from server: ' +\r\n                stringify(action) +\r\n                '\\nAre you using the latest client?');\r\n        }\r\n    }\r\n    onReady_(timestamp, sessionId) {\r\n        this.log_('connection ready');\r\n        this.connected_ = true;\r\n        this.lastConnectionEstablishedTime_ = new Date().getTime();\r\n        this.handleTimestamp_(timestamp);\r\n        this.lastSessionId = sessionId;\r\n        if (this.firstConnection_) {\r\n            this.sendConnectStats_();\r\n        }\r\n        this.restoreState_();\r\n        this.firstConnection_ = false;\r\n        this.onConnectStatus_(true);\r\n    }\r\n    scheduleConnect_(timeout) {\r\n        assert(!this.realtime_, \"Scheduling a connect when we're already connected/ing?\");\r\n        if (this.establishConnectionTimer_) {\r\n            clearTimeout(this.establishConnectionTimer_);\r\n        }\r\n        // NOTE: Even when timeout is 0, it's important to do a setTimeout to work around an infuriating \"Security Error\" in\r\n        // Firefox when trying to write to our long-polling iframe in some scenarios (e.g. Forge or our unit tests).\r\n        this.establishConnectionTimer_ = setTimeout(() => {\r\n            this.establishConnectionTimer_ = null;\r\n            this.establishConnection_();\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        }, Math.floor(timeout));\r\n    }\r\n    initConnection_() {\r\n        if (!this.realtime_ && this.firstConnection_) {\r\n            this.scheduleConnect_(0);\r\n        }\r\n    }\r\n    onVisible_(visible) {\r\n        // NOTE: Tabbing away and back to a window will defeat our reconnect backoff, but I think that's fine.\r\n        if (visible &&\r\n            !this.visible_ &&\r\n            this.reconnectDelay_ === this.maxReconnectDelay_) {\r\n            this.log_('Window became visible.  Reducing delay.');\r\n            this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n            if (!this.realtime_) {\r\n                this.scheduleConnect_(0);\r\n            }\r\n        }\r\n        this.visible_ = visible;\r\n    }\r\n    onOnline_(online) {\r\n        if (online) {\r\n            this.log_('Browser went online.');\r\n            this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n            if (!this.realtime_) {\r\n                this.scheduleConnect_(0);\r\n            }\r\n        }\r\n        else {\r\n            this.log_('Browser went offline.  Killing connection.');\r\n            if (this.realtime_) {\r\n                this.realtime_.close();\r\n            }\r\n        }\r\n    }\r\n    onRealtimeDisconnect_() {\r\n        this.log_('data client disconnected');\r\n        this.connected_ = false;\r\n        this.realtime_ = null;\r\n        // Since we don't know if our sent transactions succeeded or not, we need to cancel them.\r\n        this.cancelSentTransactions_();\r\n        // Clear out the pending requests.\r\n        this.requestCBHash_ = {};\r\n        if (this.shouldReconnect_()) {\r\n            if (!this.visible_) {\r\n                this.log_(\"Window isn't visible.  Delaying reconnect.\");\r\n                this.reconnectDelay_ = this.maxReconnectDelay_;\r\n                this.lastConnectionAttemptTime_ = new Date().getTime();\r\n            }\r\n            else if (this.lastConnectionEstablishedTime_) {\r\n                // If we've been connected long enough, reset reconnect delay to minimum.\r\n                const timeSinceLastConnectSucceeded = new Date().getTime() - this.lastConnectionEstablishedTime_;\r\n                if (timeSinceLastConnectSucceeded > RECONNECT_DELAY_RESET_TIMEOUT) {\r\n                    this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n                }\r\n                this.lastConnectionEstablishedTime_ = null;\r\n            }\r\n            const timeSinceLastConnectAttempt = new Date().getTime() - this.lastConnectionAttemptTime_;\r\n            let reconnectDelay = Math.max(0, this.reconnectDelay_ - timeSinceLastConnectAttempt);\r\n            reconnectDelay = Math.random() * reconnectDelay;\r\n            this.log_('Trying to reconnect in ' + reconnectDelay + 'ms');\r\n            this.scheduleConnect_(reconnectDelay);\r\n            // Adjust reconnect delay for next time.\r\n            this.reconnectDelay_ = Math.min(this.maxReconnectDelay_, this.reconnectDelay_ * RECONNECT_DELAY_MULTIPLIER);\r\n        }\r\n        this.onConnectStatus_(false);\r\n    }\r\n    async establishConnection_() {\r\n        if (this.shouldReconnect_()) {\r\n            this.log_('Making a connection attempt');\r\n            this.lastConnectionAttemptTime_ = new Date().getTime();\r\n            this.lastConnectionEstablishedTime_ = null;\r\n            const onDataMessage = this.onDataMessage_.bind(this);\r\n            const onReady = this.onReady_.bind(this);\r\n            const onDisconnect = this.onRealtimeDisconnect_.bind(this);\r\n            const connId = this.id + ':' + PersistentConnection.nextConnectionId_++;\r\n            const lastSessionId = this.lastSessionId;\r\n            let canceled = false;\r\n            let connection = null;\r\n            const closeFn = function () {\r\n                if (connection) {\r\n                    connection.close();\r\n                }\r\n                else {\r\n                    canceled = true;\r\n                    onDisconnect();\r\n                }\r\n            };\r\n            const sendRequestFn = function (msg) {\r\n                assert(connection, \"sendRequest call when we're not connected not allowed.\");\r\n                connection.sendRequest(msg);\r\n            };\r\n            this.realtime_ = {\r\n                close: closeFn,\r\n                sendRequest: sendRequestFn\r\n            };\r\n            const forceRefresh = this.forceTokenRefresh_;\r\n            this.forceTokenRefresh_ = false;\r\n            try {\r\n                // First fetch auth and app check token, and establish connection after\r\n                // fetching the token was successful\r\n                const [authToken, appCheckToken] = await Promise.all([\r\n                    this.authTokenProvider_.getToken(forceRefresh),\r\n                    this.appCheckTokenProvider_.getToken(forceRefresh)\r\n                ]);\r\n                if (!canceled) {\r\n                    log('getToken() completed. Creating connection.');\r\n                    this.authToken_ = authToken && authToken.accessToken;\r\n                    this.appCheckToken_ = appCheckToken && appCheckToken.token;\r\n                    connection = new Connection(connId, this.repoInfo_, this.applicationId_, this.appCheckToken_, this.authToken_, onDataMessage, onReady, onDisconnect, \r\n                    /* onKill= */ reason => {\r\n                        warn(reason + ' (' + this.repoInfo_.toString() + ')');\r\n                        this.interrupt(SERVER_KILL_INTERRUPT_REASON);\r\n                    }, lastSessionId);\r\n                }\r\n                else {\r\n                    log('getToken() completed but was canceled');\r\n                }\r\n            }\r\n            catch (error) {\r\n                this.log_('Failed to get token: ' + error);\r\n                if (!canceled) {\r\n                    if (this.repoInfo_.nodeAdmin) {\r\n                        // This may be a critical error for the Admin Node.js SDK, so log a warning.\r\n                        // But getToken() may also just have temporarily failed, so we still want to\r\n                        // continue retrying.\r\n                        warn(error);\r\n                    }\r\n                    closeFn();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    interrupt(reason) {\r\n        log('Interrupting connection for reason: ' + reason);\r\n        this.interruptReasons_[reason] = true;\r\n        if (this.realtime_) {\r\n            this.realtime_.close();\r\n        }\r\n        else {\r\n            if (this.establishConnectionTimer_) {\r\n                clearTimeout(this.establishConnectionTimer_);\r\n                this.establishConnectionTimer_ = null;\r\n            }\r\n            if (this.connected_) {\r\n                this.onRealtimeDisconnect_();\r\n            }\r\n        }\r\n    }\r\n    resume(reason) {\r\n        log('Resuming connection for reason: ' + reason);\r\n        delete this.interruptReasons_[reason];\r\n        if (isEmpty(this.interruptReasons_)) {\r\n            this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n            if (!this.realtime_) {\r\n                this.scheduleConnect_(0);\r\n            }\r\n        }\r\n    }\r\n    handleTimestamp_(timestamp) {\r\n        const delta = timestamp - new Date().getTime();\r\n        this.onServerInfoUpdate_({ serverTimeOffset: delta });\r\n    }\r\n    cancelSentTransactions_() {\r\n        for (let i = 0; i < this.outstandingPuts_.length; i++) {\r\n            const put = this.outstandingPuts_[i];\r\n            if (put && /*hash*/ 'h' in put.request && put.queued) {\r\n                if (put.onComplete) {\r\n                    put.onComplete('disconnect');\r\n                }\r\n                delete this.outstandingPuts_[i];\r\n                this.outstandingPutCount_--;\r\n            }\r\n        }\r\n        // Clean up array occasionally.\r\n        if (this.outstandingPutCount_ === 0) {\r\n            this.outstandingPuts_ = [];\r\n        }\r\n    }\r\n    onListenRevoked_(pathString, query) {\r\n        // Remove the listen and manufacture a \"permission_denied\" error for the failed listen.\r\n        let queryId;\r\n        if (!query) {\r\n            queryId = 'default';\r\n        }\r\n        else {\r\n            queryId = query.map(q => ObjectToUniqueKey(q)).join('$');\r\n        }\r\n        const listen = this.removeListen_(pathString, queryId);\r\n        if (listen && listen.onComplete) {\r\n            listen.onComplete('permission_denied');\r\n        }\r\n    }\r\n    removeListen_(pathString, queryId) {\r\n        const normalizedPathString = new Path(pathString).toString(); // normalize path.\r\n        let listen;\r\n        if (this.listens.has(normalizedPathString)) {\r\n            const map = this.listens.get(normalizedPathString);\r\n            listen = map.get(queryId);\r\n            map.delete(queryId);\r\n            if (map.size === 0) {\r\n                this.listens.delete(normalizedPathString);\r\n            }\r\n        }\r\n        else {\r\n            // all listens for this path has already been removed\r\n            listen = undefined;\r\n        }\r\n        return listen;\r\n    }\r\n    onAuthRevoked_(statusCode, explanation) {\r\n        log('Auth token revoked: ' + statusCode + '/' + explanation);\r\n        this.authToken_ = null;\r\n        this.forceTokenRefresh_ = true;\r\n        this.realtime_.close();\r\n        if (statusCode === 'invalid_token' || statusCode === 'permission_denied') {\r\n            // We'll wait a couple times before logging the warning / increasing the\r\n            // retry period since oauth tokens will report as \"invalid\" if they're\r\n            // just expired. Plus there may be transient issues that resolve themselves.\r\n            this.invalidAuthTokenCount_++;\r\n            if (this.invalidAuthTokenCount_ >= INVALID_TOKEN_THRESHOLD) {\r\n                // Set a long reconnect delay because recovery is unlikely\r\n                this.reconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;\r\n                // Notify the auth token provider that the token is invalid, which will log\r\n                // a warning\r\n                this.authTokenProvider_.notifyForInvalidToken();\r\n            }\r\n        }\r\n    }\r\n    onAppCheckRevoked_(statusCode, explanation) {\r\n        log('App check token revoked: ' + statusCode + '/' + explanation);\r\n        this.appCheckToken_ = null;\r\n        this.forceTokenRefresh_ = true;\r\n        // Note: We don't close the connection as the developer may not have\r\n        // enforcement enabled. The backend closes connections with enforcements.\r\n        if (statusCode === 'invalid_token' || statusCode === 'permission_denied') {\r\n            // We'll wait a couple times before logging the warning / increasing the\r\n            // retry period since oauth tokens will report as \"invalid\" if they're\r\n            // just expired. Plus there may be transient issues that resolve themselves.\r\n            this.invalidAppCheckTokenCount_++;\r\n            if (this.invalidAppCheckTokenCount_ >= INVALID_TOKEN_THRESHOLD) {\r\n                this.appCheckTokenProvider_.notifyForInvalidToken();\r\n            }\r\n        }\r\n    }\r\n    onSecurityDebugPacket_(body) {\r\n        if (this.securityDebugCallback_) {\r\n            this.securityDebugCallback_(body);\r\n        }\r\n        else {\r\n            if ('msg' in body) {\r\n                console.log('FIREBASE: ' + body['msg'].replace('\\n', '\\nFIREBASE: '));\r\n            }\r\n        }\r\n    }\r\n    restoreState_() {\r\n        //Re-authenticate ourselves if we have a credential stored.\r\n        this.tryAuth();\r\n        this.tryAppCheck();\r\n        // Puts depend on having received the corresponding data update from the server before they complete, so we must\r\n        // make sure to send listens before puts.\r\n        for (const queries of this.listens.values()) {\r\n            for (const listenSpec of queries.values()) {\r\n                this.sendListen_(listenSpec);\r\n            }\r\n        }\r\n        for (let i = 0; i < this.outstandingPuts_.length; i++) {\r\n            if (this.outstandingPuts_[i]) {\r\n                this.sendPut_(i);\r\n            }\r\n        }\r\n        while (this.onDisconnectRequestQueue_.length) {\r\n            const request = this.onDisconnectRequestQueue_.shift();\r\n            this.sendOnDisconnect_(request.action, request.pathString, request.data, request.onComplete);\r\n        }\r\n        for (let i = 0; i < this.outstandingGets_.length; i++) {\r\n            if (this.outstandingGets_[i]) {\r\n                this.sendGet_(i);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Sends client stats for first connection\r\n     */\r\n    sendConnectStats_() {\r\n        const stats = {};\r\n        let clientName = 'js';\r\n        if (isNodeSdk()) {\r\n            if (this.repoInfo_.nodeAdmin) {\r\n                clientName = 'admin_node';\r\n            }\r\n            else {\r\n                clientName = 'node';\r\n            }\r\n        }\r\n        stats['sdk.' + clientName + '.' + SDK_VERSION.replace(/\\./g, '-')] = 1;\r\n        if (isMobileCordova()) {\r\n            stats['framework.cordova'] = 1;\r\n        }\r\n        else if (isReactNative()) {\r\n            stats['framework.reactnative'] = 1;\r\n        }\r\n        this.reportStats(stats);\r\n    }\r\n    shouldReconnect_() {\r\n        const online = OnlineMonitor.getInstance().currentlyOnline();\r\n        return isEmpty(this.interruptReasons_) && online;\r\n    }\r\n}\r\nPersistentConnection.nextPersistentConnectionId_ = 0;\r\n/**\r\n * Counter for number of connections created. Mainly used for tagging in the logs\r\n */\r\nPersistentConnection.nextConnectionId_ = 0;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass NamedNode {\r\n    constructor(name, node) {\r\n        this.name = name;\r\n        this.node = node;\r\n    }\r\n    static Wrap(name, node) {\r\n        return new NamedNode(name, node);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass Index {\r\n    /**\r\n     * @returns A standalone comparison function for\r\n     * this index\r\n     */\r\n    getCompare() {\r\n        return this.compare.bind(this);\r\n    }\r\n    /**\r\n     * Given a before and after value for a node, determine if the indexed value has changed. Even if they are different,\r\n     * it's possible that the changes are isolated to parts of the snapshot that are not indexed.\r\n     *\r\n     *\r\n     * @returns True if the portion of the snapshot being indexed changed between oldNode and newNode\r\n     */\r\n    indexedValueChanged(oldNode, newNode) {\r\n        const oldWrapped = new NamedNode(MIN_NAME, oldNode);\r\n        const newWrapped = new NamedNode(MIN_NAME, newNode);\r\n        return this.compare(oldWrapped, newWrapped) !== 0;\r\n    }\r\n    /**\r\n     * @returns a node wrapper that will sort equal to or less than\r\n     * any other node wrapper, using this index\r\n     */\r\n    minPost() {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        return NamedNode.MIN;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet __EMPTY_NODE;\r\nclass KeyIndex extends Index {\r\n    static get __EMPTY_NODE() {\r\n        return __EMPTY_NODE;\r\n    }\r\n    static set __EMPTY_NODE(val) {\r\n        __EMPTY_NODE = val;\r\n    }\r\n    compare(a, b) {\r\n        return nameCompare(a.name, b.name);\r\n    }\r\n    isDefinedOn(node) {\r\n        // We could probably return true here (since every node has a key), but it's never called\r\n        // so just leaving unimplemented for now.\r\n        throw assertionError('KeyIndex.isDefinedOn not expected to be called.');\r\n    }\r\n    indexedValueChanged(oldNode, newNode) {\r\n        return false; // The key for a node never changes.\r\n    }\r\n    minPost() {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        return NamedNode.MIN;\r\n    }\r\n    maxPost() {\r\n        // TODO: This should really be created once and cached in a static property, but\r\n        // NamedNode isn't defined yet, so I can't use it in a static.  Bleh.\r\n        return new NamedNode(MAX_NAME, __EMPTY_NODE);\r\n    }\r\n    makePost(indexValue, name) {\r\n        assert(typeof indexValue === 'string', 'KeyIndex indexValue must always be a string.');\r\n        // We just use empty node, but it'll never be compared, since our comparator only looks at name.\r\n        return new NamedNode(indexValue, __EMPTY_NODE);\r\n    }\r\n    /**\r\n     * @returns String representation for inclusion in a query spec\r\n     */\r\n    toString() {\r\n        return '.key';\r\n    }\r\n}\r\nconst KEY_INDEX = new KeyIndex();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An iterator over an LLRBNode.\r\n */\r\nclass SortedMapIterator {\r\n    /**\r\n     * @param node - Node to iterate.\r\n     * @param isReverse_ - Whether or not to iterate in reverse\r\n     */\r\n    constructor(node, startKey, comparator, isReverse_, resultGenerator_ = null) {\r\n        this.isReverse_ = isReverse_;\r\n        this.resultGenerator_ = resultGenerator_;\r\n        this.nodeStack_ = [];\r\n        let cmp = 1;\r\n        while (!node.isEmpty()) {\r\n            node = node;\r\n            cmp = startKey ? comparator(node.key, startKey) : 1;\r\n            // flip the comparison if we're going in reverse\r\n            if (isReverse_) {\r\n                cmp *= -1;\r\n            }\r\n            if (cmp < 0) {\r\n                // This node is less than our start key. ignore it\r\n                if (this.isReverse_) {\r\n                    node = node.left;\r\n                }\r\n                else {\r\n                    node = node.right;\r\n                }\r\n            }\r\n            else if (cmp === 0) {\r\n                // This node is exactly equal to our start key. Push it on the stack, but stop iterating;\r\n                this.nodeStack_.push(node);\r\n                break;\r\n            }\r\n            else {\r\n                // This node is greater than our start key, add it to the stack and move to the next one\r\n                this.nodeStack_.push(node);\r\n                if (this.isReverse_) {\r\n                    node = node.right;\r\n                }\r\n                else {\r\n                    node = node.left;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    getNext() {\r\n        if (this.nodeStack_.length === 0) {\r\n            return null;\r\n        }\r\n        let node = this.nodeStack_.pop();\r\n        let result;\r\n        if (this.resultGenerator_) {\r\n            result = this.resultGenerator_(node.key, node.value);\r\n        }\r\n        else {\r\n            result = { key: node.key, value: node.value };\r\n        }\r\n        if (this.isReverse_) {\r\n            node = node.left;\r\n            while (!node.isEmpty()) {\r\n                this.nodeStack_.push(node);\r\n                node = node.right;\r\n            }\r\n        }\r\n        else {\r\n            node = node.right;\r\n            while (!node.isEmpty()) {\r\n                this.nodeStack_.push(node);\r\n                node = node.left;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    hasNext() {\r\n        return this.nodeStack_.length > 0;\r\n    }\r\n    peek() {\r\n        if (this.nodeStack_.length === 0) {\r\n            return null;\r\n        }\r\n        const node = this.nodeStack_[this.nodeStack_.length - 1];\r\n        if (this.resultGenerator_) {\r\n            return this.resultGenerator_(node.key, node.value);\r\n        }\r\n        else {\r\n            return { key: node.key, value: node.value };\r\n        }\r\n    }\r\n}\r\n/**\r\n * Represents a node in a Left-leaning Red-Black tree.\r\n */\r\nclass LLRBNode {\r\n    /**\r\n     * @param key - Key associated with this node.\r\n     * @param value - Value associated with this node.\r\n     * @param color - Whether this node is red.\r\n     * @param left - Left child.\r\n     * @param right - Right child.\r\n     */\r\n    constructor(key, value, color, left, right) {\r\n        this.key = key;\r\n        this.value = value;\r\n        this.color = color != null ? color : LLRBNode.RED;\r\n        this.left =\r\n            left != null ? left : SortedMap.EMPTY_NODE;\r\n        this.right =\r\n            right != null ? right : SortedMap.EMPTY_NODE;\r\n    }\r\n    /**\r\n     * Returns a copy of the current node, optionally replacing pieces of it.\r\n     *\r\n     * @param key - New key for the node, or null.\r\n     * @param value - New value for the node, or null.\r\n     * @param color - New color for the node, or null.\r\n     * @param left - New left child for the node, or null.\r\n     * @param right - New right child for the node, or null.\r\n     * @returns The node copy.\r\n     */\r\n    copy(key, value, color, left, right) {\r\n        return new LLRBNode(key != null ? key : this.key, value != null ? value : this.value, color != null ? color : this.color, left != null ? left : this.left, right != null ? right : this.right);\r\n    }\r\n    /**\r\n     * @returns The total number of nodes in the tree.\r\n     */\r\n    count() {\r\n        return this.left.count() + 1 + this.right.count();\r\n    }\r\n    /**\r\n     * @returns True if the tree is empty.\r\n     */\r\n    isEmpty() {\r\n        return false;\r\n    }\r\n    /**\r\n     * Traverses the tree in key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param action - Callback function to be called for each\r\n     *   node.  If it returns true, traversal is aborted.\r\n     * @returns The first truthy value returned by action, or the last falsey\r\n     *   value returned by action\r\n     */\r\n    inorderTraversal(action) {\r\n        return (this.left.inorderTraversal(action) ||\r\n            !!action(this.key, this.value) ||\r\n            this.right.inorderTraversal(action));\r\n    }\r\n    /**\r\n     * Traverses the tree in reverse key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param action - Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @returns True if traversal was aborted.\r\n     */\r\n    reverseTraversal(action) {\r\n        return (this.right.reverseTraversal(action) ||\r\n            action(this.key, this.value) ||\r\n            this.left.reverseTraversal(action));\r\n    }\r\n    /**\r\n     * @returns The minimum node in the tree.\r\n     */\r\n    min_() {\r\n        if (this.left.isEmpty()) {\r\n            return this;\r\n        }\r\n        else {\r\n            return this.left.min_();\r\n        }\r\n    }\r\n    /**\r\n     * @returns The maximum key in the tree.\r\n     */\r\n    minKey() {\r\n        return this.min_().key;\r\n    }\r\n    /**\r\n     * @returns The maximum key in the tree.\r\n     */\r\n    maxKey() {\r\n        if (this.right.isEmpty()) {\r\n            return this.key;\r\n        }\r\n        else {\r\n            return this.right.maxKey();\r\n        }\r\n    }\r\n    /**\r\n     * @param key - Key to insert.\r\n     * @param value - Value to insert.\r\n     * @param comparator - Comparator.\r\n     * @returns New tree, with the key/value added.\r\n     */\r\n    insert(key, value, comparator) {\r\n        let n = this;\r\n        const cmp = comparator(key, n.key);\r\n        if (cmp < 0) {\r\n            n = n.copy(null, null, null, n.left.insert(key, value, comparator), null);\r\n        }\r\n        else if (cmp === 0) {\r\n            n = n.copy(null, value, null, null, null);\r\n        }\r\n        else {\r\n            n = n.copy(null, null, null, null, n.right.insert(key, value, comparator));\r\n        }\r\n        return n.fixUp_();\r\n    }\r\n    /**\r\n     * @returns New tree, with the minimum key removed.\r\n     */\r\n    removeMin_() {\r\n        if (this.left.isEmpty()) {\r\n            return SortedMap.EMPTY_NODE;\r\n        }\r\n        let n = this;\r\n        if (!n.left.isRed_() && !n.left.left.isRed_()) {\r\n            n = n.moveRedLeft_();\r\n        }\r\n        n = n.copy(null, null, null, n.left.removeMin_(), null);\r\n        return n.fixUp_();\r\n    }\r\n    /**\r\n     * @param key - The key of the item to remove.\r\n     * @param comparator - Comparator.\r\n     * @returns New tree, with the specified item removed.\r\n     */\r\n    remove(key, comparator) {\r\n        let n, smallest;\r\n        n = this;\r\n        if (comparator(key, n.key) < 0) {\r\n            if (!n.left.isEmpty() && !n.left.isRed_() && !n.left.left.isRed_()) {\r\n                n = n.moveRedLeft_();\r\n            }\r\n            n = n.copy(null, null, null, n.left.remove(key, comparator), null);\r\n        }\r\n        else {\r\n            if (n.left.isRed_()) {\r\n                n = n.rotateRight_();\r\n            }\r\n            if (!n.right.isEmpty() && !n.right.isRed_() && !n.right.left.isRed_()) {\r\n                n = n.moveRedRight_();\r\n            }\r\n            if (comparator(key, n.key) === 0) {\r\n                if (n.right.isEmpty()) {\r\n                    return SortedMap.EMPTY_NODE;\r\n                }\r\n                else {\r\n                    smallest = n.right.min_();\r\n                    n = n.copy(smallest.key, smallest.value, null, null, n.right.removeMin_());\r\n                }\r\n            }\r\n            n = n.copy(null, null, null, null, n.right.remove(key, comparator));\r\n        }\r\n        return n.fixUp_();\r\n    }\r\n    /**\r\n     * @returns Whether this is a RED node.\r\n     */\r\n    isRed_() {\r\n        return this.color;\r\n    }\r\n    /**\r\n     * @returns New tree after performing any needed rotations.\r\n     */\r\n    fixUp_() {\r\n        let n = this;\r\n        if (n.right.isRed_() && !n.left.isRed_()) {\r\n            n = n.rotateLeft_();\r\n        }\r\n        if (n.left.isRed_() && n.left.left.isRed_()) {\r\n            n = n.rotateRight_();\r\n        }\r\n        if (n.left.isRed_() && n.right.isRed_()) {\r\n            n = n.colorFlip_();\r\n        }\r\n        return n;\r\n    }\r\n    /**\r\n     * @returns New tree, after moveRedLeft.\r\n     */\r\n    moveRedLeft_() {\r\n        let n = this.colorFlip_();\r\n        if (n.right.left.isRed_()) {\r\n            n = n.copy(null, null, null, null, n.right.rotateRight_());\r\n            n = n.rotateLeft_();\r\n            n = n.colorFlip_();\r\n        }\r\n        return n;\r\n    }\r\n    /**\r\n     * @returns New tree, after moveRedRight.\r\n     */\r\n    moveRedRight_() {\r\n        let n = this.colorFlip_();\r\n        if (n.left.left.isRed_()) {\r\n            n = n.rotateRight_();\r\n            n = n.colorFlip_();\r\n        }\r\n        return n;\r\n    }\r\n    /**\r\n     * @returns New tree, after rotateLeft.\r\n     */\r\n    rotateLeft_() {\r\n        const nl = this.copy(null, null, LLRBNode.RED, null, this.right.left);\r\n        return this.right.copy(null, null, this.color, nl, null);\r\n    }\r\n    /**\r\n     * @returns New tree, after rotateRight.\r\n     */\r\n    rotateRight_() {\r\n        const nr = this.copy(null, null, LLRBNode.RED, this.left.right, null);\r\n        return this.left.copy(null, null, this.color, null, nr);\r\n    }\r\n    /**\r\n     * @returns Newt ree, after colorFlip.\r\n     */\r\n    colorFlip_() {\r\n        const left = this.left.copy(null, null, !this.left.color, null, null);\r\n        const right = this.right.copy(null, null, !this.right.color, null, null);\r\n        return this.copy(null, null, !this.color, left, right);\r\n    }\r\n    /**\r\n     * For testing.\r\n     *\r\n     * @returns True if all is well.\r\n     */\r\n    checkMaxDepth_() {\r\n        const blackDepth = this.check_();\r\n        return Math.pow(2.0, blackDepth) <= this.count() + 1;\r\n    }\r\n    check_() {\r\n        if (this.isRed_() && this.left.isRed_()) {\r\n            throw new Error('Red node has red child(' + this.key + ',' + this.value + ')');\r\n        }\r\n        if (this.right.isRed_()) {\r\n            throw new Error('Right child of (' + this.key + ',' + this.value + ') is red');\r\n        }\r\n        const blackDepth = this.left.check_();\r\n        if (blackDepth !== this.right.check_()) {\r\n            throw new Error('Black depths differ');\r\n        }\r\n        else {\r\n            return blackDepth + (this.isRed_() ? 0 : 1);\r\n        }\r\n    }\r\n}\r\nLLRBNode.RED = true;\r\nLLRBNode.BLACK = false;\r\n/**\r\n * Represents an empty node (a leaf node in the Red-Black Tree).\r\n */\r\nclass LLRBEmptyNode {\r\n    /**\r\n     * Returns a copy of the current node.\r\n     *\r\n     * @returns The node copy.\r\n     */\r\n    copy(key, value, color, left, right) {\r\n        return this;\r\n    }\r\n    /**\r\n     * Returns a copy of the tree, with the specified key/value added.\r\n     *\r\n     * @param key - Key to be added.\r\n     * @param value - Value to be added.\r\n     * @param comparator - Comparator.\r\n     * @returns New tree, with item added.\r\n     */\r\n    insert(key, value, comparator) {\r\n        return new LLRBNode(key, value, null);\r\n    }\r\n    /**\r\n     * Returns a copy of the tree, with the specified key removed.\r\n     *\r\n     * @param key - The key to remove.\r\n     * @param comparator - Comparator.\r\n     * @returns New tree, with item removed.\r\n     */\r\n    remove(key, comparator) {\r\n        return this;\r\n    }\r\n    /**\r\n     * @returns The total number of nodes in the tree.\r\n     */\r\n    count() {\r\n        return 0;\r\n    }\r\n    /**\r\n     * @returns True if the tree is empty.\r\n     */\r\n    isEmpty() {\r\n        return true;\r\n    }\r\n    /**\r\n     * Traverses the tree in key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param action - Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @returns True if traversal was aborted.\r\n     */\r\n    inorderTraversal(action) {\r\n        return false;\r\n    }\r\n    /**\r\n     * Traverses the tree in reverse key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param action - Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @returns True if traversal was aborted.\r\n     */\r\n    reverseTraversal(action) {\r\n        return false;\r\n    }\r\n    minKey() {\r\n        return null;\r\n    }\r\n    maxKey() {\r\n        return null;\r\n    }\r\n    check_() {\r\n        return 0;\r\n    }\r\n    /**\r\n     * @returns Whether this node is red.\r\n     */\r\n    isRed_() {\r\n        return false;\r\n    }\r\n}\r\n/**\r\n * An immutable sorted map implementation, based on a Left-leaning Red-Black\r\n * tree.\r\n */\r\nclass SortedMap {\r\n    /**\r\n     * @param comparator_ - Key comparator.\r\n     * @param root_ - Optional root node for the map.\r\n     */\r\n    constructor(comparator_, root_ = SortedMap.EMPTY_NODE) {\r\n        this.comparator_ = comparator_;\r\n        this.root_ = root_;\r\n    }\r\n    /**\r\n     * Returns a copy of the map, with the specified key/value added or replaced.\r\n     * (TODO: We should perhaps rename this method to 'put')\r\n     *\r\n     * @param key - Key to be added.\r\n     * @param value - Value to be added.\r\n     * @returns New map, with item added.\r\n     */\r\n    insert(key, value) {\r\n        return new SortedMap(this.comparator_, this.root_\r\n            .insert(key, value, this.comparator_)\r\n            .copy(null, null, LLRBNode.BLACK, null, null));\r\n    }\r\n    /**\r\n     * Returns a copy of the map, with the specified key removed.\r\n     *\r\n     * @param key - The key to remove.\r\n     * @returns New map, with item removed.\r\n     */\r\n    remove(key) {\r\n        return new SortedMap(this.comparator_, this.root_\r\n            .remove(key, this.comparator_)\r\n            .copy(null, null, LLRBNode.BLACK, null, null));\r\n    }\r\n    /**\r\n     * Returns the value of the node with the given key, or null.\r\n     *\r\n     * @param key - The key to look up.\r\n     * @returns The value of the node with the given key, or null if the\r\n     * key doesn't exist.\r\n     */\r\n    get(key) {\r\n        let cmp;\r\n        let node = this.root_;\r\n        while (!node.isEmpty()) {\r\n            cmp = this.comparator_(key, node.key);\r\n            if (cmp === 0) {\r\n                return node.value;\r\n            }\r\n            else if (cmp < 0) {\r\n                node = node.left;\r\n            }\r\n            else if (cmp > 0) {\r\n                node = node.right;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    /**\r\n     * Returns the key of the item *before* the specified key, or null if key is the first item.\r\n     * @param key - The key to find the predecessor of\r\n     * @returns The predecessor key.\r\n     */\r\n    getPredecessorKey(key) {\r\n        let cmp, node = this.root_, rightParent = null;\r\n        while (!node.isEmpty()) {\r\n            cmp = this.comparator_(key, node.key);\r\n            if (cmp === 0) {\r\n                if (!node.left.isEmpty()) {\r\n                    node = node.left;\r\n                    while (!node.right.isEmpty()) {\r\n                        node = node.right;\r\n                    }\r\n                    return node.key;\r\n                }\r\n                else if (rightParent) {\r\n                    return rightParent.key;\r\n                }\r\n                else {\r\n                    return null; // first item.\r\n                }\r\n            }\r\n            else if (cmp < 0) {\r\n                node = node.left;\r\n            }\r\n            else if (cmp > 0) {\r\n                rightParent = node;\r\n                node = node.right;\r\n            }\r\n        }\r\n        throw new Error('Attempted to find predecessor key for a nonexistent key.  What gives?');\r\n    }\r\n    /**\r\n     * @returns True if the map is empty.\r\n     */\r\n    isEmpty() {\r\n        return this.root_.isEmpty();\r\n    }\r\n    /**\r\n     * @returns The total number of nodes in the map.\r\n     */\r\n    count() {\r\n        return this.root_.count();\r\n    }\r\n    /**\r\n     * @returns The minimum key in the map.\r\n     */\r\n    minKey() {\r\n        return this.root_.minKey();\r\n    }\r\n    /**\r\n     * @returns The maximum key in the map.\r\n     */\r\n    maxKey() {\r\n        return this.root_.maxKey();\r\n    }\r\n    /**\r\n     * Traverses the map in key order and calls the specified action function\r\n     * for each key/value pair.\r\n     *\r\n     * @param action - Callback function to be called\r\n     * for each key/value pair.  If action returns true, traversal is aborted.\r\n     * @returns The first truthy value returned by action, or the last falsey\r\n     *   value returned by action\r\n     */\r\n    inorderTraversal(action) {\r\n        return this.root_.inorderTraversal(action);\r\n    }\r\n    /**\r\n     * Traverses the map in reverse key order and calls the specified action function\r\n     * for each key/value pair.\r\n     *\r\n     * @param action - Callback function to be called\r\n     * for each key/value pair.  If action returns true, traversal is aborted.\r\n     * @returns True if the traversal was aborted.\r\n     */\r\n    reverseTraversal(action) {\r\n        return this.root_.reverseTraversal(action);\r\n    }\r\n    /**\r\n     * Returns an iterator over the SortedMap.\r\n     * @returns The iterator.\r\n     */\r\n    getIterator(resultGenerator) {\r\n        return new SortedMapIterator(this.root_, null, this.comparator_, false, resultGenerator);\r\n    }\r\n    getIteratorFrom(key, resultGenerator) {\r\n        return new SortedMapIterator(this.root_, key, this.comparator_, false, resultGenerator);\r\n    }\r\n    getReverseIteratorFrom(key, resultGenerator) {\r\n        return new SortedMapIterator(this.root_, key, this.comparator_, true, resultGenerator);\r\n    }\r\n    getReverseIterator(resultGenerator) {\r\n        return new SortedMapIterator(this.root_, null, this.comparator_, true, resultGenerator);\r\n    }\r\n}\r\n/**\r\n * Always use the same empty node, to reduce memory.\r\n */\r\nSortedMap.EMPTY_NODE = new LLRBEmptyNode();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction NAME_ONLY_COMPARATOR(left, right) {\r\n    return nameCompare(left.name, right.name);\r\n}\r\nfunction NAME_COMPARATOR(left, right) {\r\n    return nameCompare(left, right);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet MAX_NODE$2;\r\nfunction setMaxNode$1(val) {\r\n    MAX_NODE$2 = val;\r\n}\r\nconst priorityHashText = function (priority) {\r\n    if (typeof priority === 'number') {\r\n        return 'number:' + doubleToIEEE754String(priority);\r\n    }\r\n    else {\r\n        return 'string:' + priority;\r\n    }\r\n};\r\n/**\r\n * Validates that a priority snapshot Node is valid.\r\n */\r\nconst validatePriorityNode = function (priorityNode) {\r\n    if (priorityNode.isLeafNode()) {\r\n        const val = priorityNode.val();\r\n        assert(typeof val === 'string' ||\r\n            typeof val === 'number' ||\r\n            (typeof val === 'object' && contains(val, '.sv')), 'Priority must be a string or number.');\r\n    }\r\n    else {\r\n        assert(priorityNode === MAX_NODE$2 || priorityNode.isEmpty(), 'priority of unexpected type.');\r\n    }\r\n    // Don't call getPriority() on MAX_NODE to avoid hitting assertion.\r\n    assert(priorityNode === MAX_NODE$2 || priorityNode.getPriority().isEmpty(), \"Priority nodes can't have a priority of their own.\");\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet __childrenNodeConstructor;\r\n/**\r\n * LeafNode is a class for storing leaf nodes in a DataSnapshot.  It\r\n * implements Node and stores the value of the node (a string,\r\n * number, or boolean) accessible via getValue().\r\n */\r\nclass LeafNode {\r\n    /**\r\n     * @param value_ - The value to store in this leaf node. The object type is\r\n     * possible in the event of a deferred value\r\n     * @param priorityNode_ - The priority of this node.\r\n     */\r\n    constructor(value_, priorityNode_ = LeafNode.__childrenNodeConstructor.EMPTY_NODE) {\r\n        this.value_ = value_;\r\n        this.priorityNode_ = priorityNode_;\r\n        this.lazyHash_ = null;\r\n        assert(this.value_ !== undefined && this.value_ !== null, \"LeafNode shouldn't be created with null/undefined value.\");\r\n        validatePriorityNode(this.priorityNode_);\r\n    }\r\n    static set __childrenNodeConstructor(val) {\r\n        __childrenNodeConstructor = val;\r\n    }\r\n    static get __childrenNodeConstructor() {\r\n        return __childrenNodeConstructor;\r\n    }\r\n    /** @inheritDoc */\r\n    isLeafNode() {\r\n        return true;\r\n    }\r\n    /** @inheritDoc */\r\n    getPriority() {\r\n        return this.priorityNode_;\r\n    }\r\n    /** @inheritDoc */\r\n    updatePriority(newPriorityNode) {\r\n        return new LeafNode(this.value_, newPriorityNode);\r\n    }\r\n    /** @inheritDoc */\r\n    getImmediateChild(childName) {\r\n        // Hack to treat priority as a regular child\r\n        if (childName === '.priority') {\r\n            return this.priorityNode_;\r\n        }\r\n        else {\r\n            return LeafNode.__childrenNodeConstructor.EMPTY_NODE;\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    getChild(path) {\r\n        if (pathIsEmpty(path)) {\r\n            return this;\r\n        }\r\n        else if (pathGetFront(path) === '.priority') {\r\n            return this.priorityNode_;\r\n        }\r\n        else {\r\n            return LeafNode.__childrenNodeConstructor.EMPTY_NODE;\r\n        }\r\n    }\r\n    hasChild() {\r\n        return false;\r\n    }\r\n    /** @inheritDoc */\r\n    getPredecessorChildName(childName, childNode) {\r\n        return null;\r\n    }\r\n    /** @inheritDoc */\r\n    updateImmediateChild(childName, newChildNode) {\r\n        if (childName === '.priority') {\r\n            return this.updatePriority(newChildNode);\r\n        }\r\n        else if (newChildNode.isEmpty() && childName !== '.priority') {\r\n            return this;\r\n        }\r\n        else {\r\n            return LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(childName, newChildNode).updatePriority(this.priorityNode_);\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    updateChild(path, newChildNode) {\r\n        const front = pathGetFront(path);\r\n        if (front === null) {\r\n            return newChildNode;\r\n        }\r\n        else if (newChildNode.isEmpty() && front !== '.priority') {\r\n            return this;\r\n        }\r\n        else {\r\n            assert(front !== '.priority' || pathGetLength(path) === 1, '.priority must be the last token in a path');\r\n            return this.updateImmediateChild(front, LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(pathPopFront(path), newChildNode));\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    isEmpty() {\r\n        return false;\r\n    }\r\n    /** @inheritDoc */\r\n    numChildren() {\r\n        return 0;\r\n    }\r\n    /** @inheritDoc */\r\n    forEachChild(index, action) {\r\n        return false;\r\n    }\r\n    val(exportFormat) {\r\n        if (exportFormat && !this.getPriority().isEmpty()) {\r\n            return {\r\n                '.value': this.getValue(),\r\n                '.priority': this.getPriority().val()\r\n            };\r\n        }\r\n        else {\r\n            return this.getValue();\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    hash() {\r\n        if (this.lazyHash_ === null) {\r\n            let toHash = '';\r\n            if (!this.priorityNode_.isEmpty()) {\r\n                toHash +=\r\n                    'priority:' +\r\n                        priorityHashText(this.priorityNode_.val()) +\r\n                        ':';\r\n            }\r\n            const type = typeof this.value_;\r\n            toHash += type + ':';\r\n            if (type === 'number') {\r\n                toHash += doubleToIEEE754String(this.value_);\r\n            }\r\n            else {\r\n                toHash += this.value_;\r\n            }\r\n            this.lazyHash_ = sha1(toHash);\r\n        }\r\n        return this.lazyHash_;\r\n    }\r\n    /**\r\n     * Returns the value of the leaf node.\r\n     * @returns The value of the node.\r\n     */\r\n    getValue() {\r\n        return this.value_;\r\n    }\r\n    compareTo(other) {\r\n        if (other === LeafNode.__childrenNodeConstructor.EMPTY_NODE) {\r\n            return 1;\r\n        }\r\n        else if (other instanceof LeafNode.__childrenNodeConstructor) {\r\n            return -1;\r\n        }\r\n        else {\r\n            assert(other.isLeafNode(), 'Unknown node type');\r\n            return this.compareToLeafNode_(other);\r\n        }\r\n    }\r\n    /**\r\n     * Comparison specifically for two leaf nodes\r\n     */\r\n    compareToLeafNode_(otherLeaf) {\r\n        const otherLeafType = typeof otherLeaf.value_;\r\n        const thisLeafType = typeof this.value_;\r\n        const otherIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(otherLeafType);\r\n        const thisIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(thisLeafType);\r\n        assert(otherIndex >= 0, 'Unknown leaf type: ' + otherLeafType);\r\n        assert(thisIndex >= 0, 'Unknown leaf type: ' + thisLeafType);\r\n        if (otherIndex === thisIndex) {\r\n            // Same type, compare values\r\n            if (thisLeafType === 'object') {\r\n                // Deferred value nodes are all equal, but we should also never get to this point...\r\n                return 0;\r\n            }\r\n            else {\r\n                // Note that this works because true > false, all others are number or string comparisons\r\n                if (this.value_ < otherLeaf.value_) {\r\n                    return -1;\r\n                }\r\n                else if (this.value_ === otherLeaf.value_) {\r\n                    return 0;\r\n                }\r\n                else {\r\n                    return 1;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            return thisIndex - otherIndex;\r\n        }\r\n    }\r\n    withIndex() {\r\n        return this;\r\n    }\r\n    isIndexed() {\r\n        return true;\r\n    }\r\n    equals(other) {\r\n        if (other === this) {\r\n            return true;\r\n        }\r\n        else if (other.isLeafNode()) {\r\n            const otherLeaf = other;\r\n            return (this.value_ === otherLeaf.value_ &&\r\n                this.priorityNode_.equals(otherLeaf.priorityNode_));\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n}\r\n/**\r\n * The sort order for comparing leaf nodes of different types. If two leaf nodes have\r\n * the same type, the comparison falls back to their value\r\n */\r\nLeafNode.VALUE_TYPE_ORDER = ['object', 'boolean', 'number', 'string'];\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet nodeFromJSON$1;\r\nlet MAX_NODE$1;\r\nfunction setNodeFromJSON(val) {\r\n    nodeFromJSON$1 = val;\r\n}\r\nfunction setMaxNode(val) {\r\n    MAX_NODE$1 = val;\r\n}\r\nclass PriorityIndex extends Index {\r\n    compare(a, b) {\r\n        const aPriority = a.node.getPriority();\r\n        const bPriority = b.node.getPriority();\r\n        const indexCmp = aPriority.compareTo(bPriority);\r\n        if (indexCmp === 0) {\r\n            return nameCompare(a.name, b.name);\r\n        }\r\n        else {\r\n            return indexCmp;\r\n        }\r\n    }\r\n    isDefinedOn(node) {\r\n        return !node.getPriority().isEmpty();\r\n    }\r\n    indexedValueChanged(oldNode, newNode) {\r\n        return !oldNode.getPriority().equals(newNode.getPriority());\r\n    }\r\n    minPost() {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        return NamedNode.MIN;\r\n    }\r\n    maxPost() {\r\n        return new NamedNode(MAX_NAME, new LeafNode('[PRIORITY-POST]', MAX_NODE$1));\r\n    }\r\n    makePost(indexValue, name) {\r\n        const priorityNode = nodeFromJSON$1(indexValue);\r\n        return new NamedNode(name, new LeafNode('[PRIORITY-POST]', priorityNode));\r\n    }\r\n    /**\r\n     * @returns String representation for inclusion in a query spec\r\n     */\r\n    toString() {\r\n        return '.priority';\r\n    }\r\n}\r\nconst PRIORITY_INDEX = new PriorityIndex();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst LOG_2 = Math.log(2);\r\nclass Base12Num {\r\n    constructor(length) {\r\n        const logBase2 = (num) => \r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        parseInt((Math.log(num) / LOG_2), 10);\r\n        const bitMask = (bits) => parseInt(Array(bits + 1).join('1'), 2);\r\n        this.count = logBase2(length + 1);\r\n        this.current_ = this.count - 1;\r\n        const mask = bitMask(this.count);\r\n        this.bits_ = (length + 1) & mask;\r\n    }\r\n    nextBitIsOne() {\r\n        //noinspection JSBitwiseOperatorUsage\r\n        const result = !(this.bits_ & (0x1 << this.current_));\r\n        this.current_--;\r\n        return result;\r\n    }\r\n}\r\n/**\r\n * Takes a list of child nodes and constructs a SortedSet using the given comparison\r\n * function\r\n *\r\n * Uses the algorithm described in the paper linked here:\r\n * http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.46.1458\r\n *\r\n * @param childList - Unsorted list of children\r\n * @param cmp - The comparison method to be used\r\n * @param keyFn - An optional function to extract K from a node wrapper, if K's\r\n * type is not NamedNode\r\n * @param mapSortFn - An optional override for comparator used by the generated sorted map\r\n */\r\nconst buildChildSet = function (childList, cmp, keyFn, mapSortFn) {\r\n    childList.sort(cmp);\r\n    const buildBalancedTree = function (low, high) {\r\n        const length = high - low;\r\n        let namedNode;\r\n        let key;\r\n        if (length === 0) {\r\n            return null;\r\n        }\r\n        else if (length === 1) {\r\n            namedNode = childList[low];\r\n            key = keyFn ? keyFn(namedNode) : namedNode;\r\n            return new LLRBNode(key, namedNode.node, LLRBNode.BLACK, null, null);\r\n        }\r\n        else {\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            const middle = parseInt((length / 2), 10) + low;\r\n            const left = buildBalancedTree(low, middle);\r\n            const right = buildBalancedTree(middle + 1, high);\r\n            namedNode = childList[middle];\r\n            key = keyFn ? keyFn(namedNode) : namedNode;\r\n            return new LLRBNode(key, namedNode.node, LLRBNode.BLACK, left, right);\r\n        }\r\n    };\r\n    const buildFrom12Array = function (base12) {\r\n        let node = null;\r\n        let root = null;\r\n        let index = childList.length;\r\n        const buildPennant = function (chunkSize, color) {\r\n            const low = index - chunkSize;\r\n            const high = index;\r\n            index -= chunkSize;\r\n            const childTree = buildBalancedTree(low + 1, high);\r\n            const namedNode = childList[low];\r\n            const key = keyFn ? keyFn(namedNode) : namedNode;\r\n            attachPennant(new LLRBNode(key, namedNode.node, color, null, childTree));\r\n        };\r\n        const attachPennant = function (pennant) {\r\n            if (node) {\r\n                node.left = pennant;\r\n                node = pennant;\r\n            }\r\n            else {\r\n                root = pennant;\r\n                node = pennant;\r\n            }\r\n        };\r\n        for (let i = 0; i < base12.count; ++i) {\r\n            const isOne = base12.nextBitIsOne();\r\n            // The number of nodes taken in each slice is 2^(arr.length - (i + 1))\r\n            const chunkSize = Math.pow(2, base12.count - (i + 1));\r\n            if (isOne) {\r\n                buildPennant(chunkSize, LLRBNode.BLACK);\r\n            }\r\n            else {\r\n                // current == 2\r\n                buildPennant(chunkSize, LLRBNode.BLACK);\r\n                buildPennant(chunkSize, LLRBNode.RED);\r\n            }\r\n        }\r\n        return root;\r\n    };\r\n    const base12 = new Base12Num(childList.length);\r\n    const root = buildFrom12Array(base12);\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    return new SortedMap(mapSortFn || cmp, root);\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet _defaultIndexMap;\r\nconst fallbackObject = {};\r\nclass IndexMap {\r\n    constructor(indexes_, indexSet_) {\r\n        this.indexes_ = indexes_;\r\n        this.indexSet_ = indexSet_;\r\n    }\r\n    /**\r\n     * The default IndexMap for nodes without a priority\r\n     */\r\n    static get Default() {\r\n        assert(fallbackObject && PRIORITY_INDEX, 'ChildrenNode.ts has not been loaded');\r\n        _defaultIndexMap =\r\n            _defaultIndexMap ||\r\n                new IndexMap({ '.priority': fallbackObject }, { '.priority': PRIORITY_INDEX });\r\n        return _defaultIndexMap;\r\n    }\r\n    get(indexKey) {\r\n        const sortedMap = safeGet(this.indexes_, indexKey);\r\n        if (!sortedMap) {\r\n            throw new Error('No index defined for ' + indexKey);\r\n        }\r\n        if (sortedMap instanceof SortedMap) {\r\n            return sortedMap;\r\n        }\r\n        else {\r\n            // The index exists, but it falls back to just name comparison. Return null so that the calling code uses the\r\n            // regular child map\r\n            return null;\r\n        }\r\n    }\r\n    hasIndex(indexDefinition) {\r\n        return contains(this.indexSet_, indexDefinition.toString());\r\n    }\r\n    addIndex(indexDefinition, existingChildren) {\r\n        assert(indexDefinition !== KEY_INDEX, \"KeyIndex always exists and isn't meant to be added to the IndexMap.\");\r\n        const childList = [];\r\n        let sawIndexedValue = false;\r\n        const iter = existingChildren.getIterator(NamedNode.Wrap);\r\n        let next = iter.getNext();\r\n        while (next) {\r\n            sawIndexedValue =\r\n                sawIndexedValue || indexDefinition.isDefinedOn(next.node);\r\n            childList.push(next);\r\n            next = iter.getNext();\r\n        }\r\n        let newIndex;\r\n        if (sawIndexedValue) {\r\n            newIndex = buildChildSet(childList, indexDefinition.getCompare());\r\n        }\r\n        else {\r\n            newIndex = fallbackObject;\r\n        }\r\n        const indexName = indexDefinition.toString();\r\n        const newIndexSet = Object.assign({}, this.indexSet_);\r\n        newIndexSet[indexName] = indexDefinition;\r\n        const newIndexes = Object.assign({}, this.indexes_);\r\n        newIndexes[indexName] = newIndex;\r\n        return new IndexMap(newIndexes, newIndexSet);\r\n    }\r\n    /**\r\n     * Ensure that this node is properly tracked in any indexes that we're maintaining\r\n     */\r\n    addToIndexes(namedNode, existingChildren) {\r\n        const newIndexes = map(this.indexes_, (indexedChildren, indexName) => {\r\n            const index = safeGet(this.indexSet_, indexName);\r\n            assert(index, 'Missing index implementation for ' + indexName);\r\n            if (indexedChildren === fallbackObject) {\r\n                // Check to see if we need to index everything\r\n                if (index.isDefinedOn(namedNode.node)) {\r\n                    // We need to build this index\r\n                    const childList = [];\r\n                    const iter = existingChildren.getIterator(NamedNode.Wrap);\r\n                    let next = iter.getNext();\r\n                    while (next) {\r\n                        if (next.name !== namedNode.name) {\r\n                            childList.push(next);\r\n                        }\r\n                        next = iter.getNext();\r\n                    }\r\n                    childList.push(namedNode);\r\n                    return buildChildSet(childList, index.getCompare());\r\n                }\r\n                else {\r\n                    // No change, this remains a fallback\r\n                    return fallbackObject;\r\n                }\r\n            }\r\n            else {\r\n                const existingSnap = existingChildren.get(namedNode.name);\r\n                let newChildren = indexedChildren;\r\n                if (existingSnap) {\r\n                    newChildren = newChildren.remove(new NamedNode(namedNode.name, existingSnap));\r\n                }\r\n                return newChildren.insert(namedNode, namedNode.node);\r\n            }\r\n        });\r\n        return new IndexMap(newIndexes, this.indexSet_);\r\n    }\r\n    /**\r\n     * Create a new IndexMap instance with the given value removed\r\n     */\r\n    removeFromIndexes(namedNode, existingChildren) {\r\n        const newIndexes = map(this.indexes_, (indexedChildren) => {\r\n            if (indexedChildren === fallbackObject) {\r\n                // This is the fallback. Just return it, nothing to do in this case\r\n                return indexedChildren;\r\n            }\r\n            else {\r\n                const existingSnap = existingChildren.get(namedNode.name);\r\n                if (existingSnap) {\r\n                    return indexedChildren.remove(new NamedNode(namedNode.name, existingSnap));\r\n                }\r\n                else {\r\n                    // No record of this child\r\n                    return indexedChildren;\r\n                }\r\n            }\r\n        });\r\n        return new IndexMap(newIndexes, this.indexSet_);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// TODO: For memory savings, don't store priorityNode_ if it's empty.\r\nlet EMPTY_NODE;\r\n/**\r\n * ChildrenNode is a class for storing internal nodes in a DataSnapshot\r\n * (i.e. nodes with children).  It implements Node and stores the\r\n * list of children in the children property, sorted by child name.\r\n */\r\nclass ChildrenNode {\r\n    /**\r\n     * @param children_ - List of children of this node..\r\n     * @param priorityNode_ - The priority of this node (as a snapshot node).\r\n     */\r\n    constructor(children_, priorityNode_, indexMap_) {\r\n        this.children_ = children_;\r\n        this.priorityNode_ = priorityNode_;\r\n        this.indexMap_ = indexMap_;\r\n        this.lazyHash_ = null;\r\n        /**\r\n         * Note: The only reason we allow null priority is for EMPTY_NODE, since we can't use\r\n         * EMPTY_NODE as the priority of EMPTY_NODE.  We might want to consider making EMPTY_NODE its own\r\n         * class instead of an empty ChildrenNode.\r\n         */\r\n        if (this.priorityNode_) {\r\n            validatePriorityNode(this.priorityNode_);\r\n        }\r\n        if (this.children_.isEmpty()) {\r\n            assert(!this.priorityNode_ || this.priorityNode_.isEmpty(), 'An empty node cannot have a priority');\r\n        }\r\n    }\r\n    static get EMPTY_NODE() {\r\n        return (EMPTY_NODE ||\r\n            (EMPTY_NODE = new ChildrenNode(new SortedMap(NAME_COMPARATOR), null, IndexMap.Default)));\r\n    }\r\n    /** @inheritDoc */\r\n    isLeafNode() {\r\n        return false;\r\n    }\r\n    /** @inheritDoc */\r\n    getPriority() {\r\n        return this.priorityNode_ || EMPTY_NODE;\r\n    }\r\n    /** @inheritDoc */\r\n    updatePriority(newPriorityNode) {\r\n        if (this.children_.isEmpty()) {\r\n            // Don't allow priorities on empty nodes\r\n            return this;\r\n        }\r\n        else {\r\n            return new ChildrenNode(this.children_, newPriorityNode, this.indexMap_);\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    getImmediateChild(childName) {\r\n        // Hack to treat priority as a regular child\r\n        if (childName === '.priority') {\r\n            return this.getPriority();\r\n        }\r\n        else {\r\n            const child = this.children_.get(childName);\r\n            return child === null ? EMPTY_NODE : child;\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    getChild(path) {\r\n        const front = pathGetFront(path);\r\n        if (front === null) {\r\n            return this;\r\n        }\r\n        return this.getImmediateChild(front).getChild(pathPopFront(path));\r\n    }\r\n    /** @inheritDoc */\r\n    hasChild(childName) {\r\n        return this.children_.get(childName) !== null;\r\n    }\r\n    /** @inheritDoc */\r\n    updateImmediateChild(childName, newChildNode) {\r\n        assert(newChildNode, 'We should always be passing snapshot nodes');\r\n        if (childName === '.priority') {\r\n            return this.updatePriority(newChildNode);\r\n        }\r\n        else {\r\n            const namedNode = new NamedNode(childName, newChildNode);\r\n            let newChildren, newIndexMap;\r\n            if (newChildNode.isEmpty()) {\r\n                newChildren = this.children_.remove(childName);\r\n                newIndexMap = this.indexMap_.removeFromIndexes(namedNode, this.children_);\r\n            }\r\n            else {\r\n                newChildren = this.children_.insert(childName, newChildNode);\r\n                newIndexMap = this.indexMap_.addToIndexes(namedNode, this.children_);\r\n            }\r\n            const newPriority = newChildren.isEmpty()\r\n                ? EMPTY_NODE\r\n                : this.priorityNode_;\r\n            return new ChildrenNode(newChildren, newPriority, newIndexMap);\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    updateChild(path, newChildNode) {\r\n        const front = pathGetFront(path);\r\n        if (front === null) {\r\n            return newChildNode;\r\n        }\r\n        else {\r\n            assert(pathGetFront(path) !== '.priority' || pathGetLength(path) === 1, '.priority must be the last token in a path');\r\n            const newImmediateChild = this.getImmediateChild(front).updateChild(pathPopFront(path), newChildNode);\r\n            return this.updateImmediateChild(front, newImmediateChild);\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    isEmpty() {\r\n        return this.children_.isEmpty();\r\n    }\r\n    /** @inheritDoc */\r\n    numChildren() {\r\n        return this.children_.count();\r\n    }\r\n    /** @inheritDoc */\r\n    val(exportFormat) {\r\n        if (this.isEmpty()) {\r\n            return null;\r\n        }\r\n        const obj = {};\r\n        let numKeys = 0, maxKey = 0, allIntegerKeys = true;\r\n        this.forEachChild(PRIORITY_INDEX, (key, childNode) => {\r\n            obj[key] = childNode.val(exportFormat);\r\n            numKeys++;\r\n            if (allIntegerKeys && ChildrenNode.INTEGER_REGEXP_.test(key)) {\r\n                maxKey = Math.max(maxKey, Number(key));\r\n            }\r\n            else {\r\n                allIntegerKeys = false;\r\n            }\r\n        });\r\n        if (!exportFormat && allIntegerKeys && maxKey < 2 * numKeys) {\r\n            // convert to array.\r\n            const array = [];\r\n            // eslint-disable-next-line guard-for-in\r\n            for (const key in obj) {\r\n                array[key] = obj[key];\r\n            }\r\n            return array;\r\n        }\r\n        else {\r\n            if (exportFormat && !this.getPriority().isEmpty()) {\r\n                obj['.priority'] = this.getPriority().val();\r\n            }\r\n            return obj;\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    hash() {\r\n        if (this.lazyHash_ === null) {\r\n            let toHash = '';\r\n            if (!this.getPriority().isEmpty()) {\r\n                toHash +=\r\n                    'priority:' +\r\n                        priorityHashText(this.getPriority().val()) +\r\n                        ':';\r\n            }\r\n            this.forEachChild(PRIORITY_INDEX, (key, childNode) => {\r\n                const childHash = childNode.hash();\r\n                if (childHash !== '') {\r\n                    toHash += ':' + key + ':' + childHash;\r\n                }\r\n            });\r\n            this.lazyHash_ = toHash === '' ? '' : sha1(toHash);\r\n        }\r\n        return this.lazyHash_;\r\n    }\r\n    /** @inheritDoc */\r\n    getPredecessorChildName(childName, childNode, index) {\r\n        const idx = this.resolveIndex_(index);\r\n        if (idx) {\r\n            const predecessor = idx.getPredecessorKey(new NamedNode(childName, childNode));\r\n            return predecessor ? predecessor.name : null;\r\n        }\r\n        else {\r\n            return this.children_.getPredecessorKey(childName);\r\n        }\r\n    }\r\n    getFirstChildName(indexDefinition) {\r\n        const idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            const minKey = idx.minKey();\r\n            return minKey && minKey.name;\r\n        }\r\n        else {\r\n            return this.children_.minKey();\r\n        }\r\n    }\r\n    getFirstChild(indexDefinition) {\r\n        const minKey = this.getFirstChildName(indexDefinition);\r\n        if (minKey) {\r\n            return new NamedNode(minKey, this.children_.get(minKey));\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n    /**\r\n     * Given an index, return the key name of the largest value we have, according to that index\r\n     */\r\n    getLastChildName(indexDefinition) {\r\n        const idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            const maxKey = idx.maxKey();\r\n            return maxKey && maxKey.name;\r\n        }\r\n        else {\r\n            return this.children_.maxKey();\r\n        }\r\n    }\r\n    getLastChild(indexDefinition) {\r\n        const maxKey = this.getLastChildName(indexDefinition);\r\n        if (maxKey) {\r\n            return new NamedNode(maxKey, this.children_.get(maxKey));\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n    forEachChild(index, action) {\r\n        const idx = this.resolveIndex_(index);\r\n        if (idx) {\r\n            return idx.inorderTraversal(wrappedNode => {\r\n                return action(wrappedNode.name, wrappedNode.node);\r\n            });\r\n        }\r\n        else {\r\n            return this.children_.inorderTraversal(action);\r\n        }\r\n    }\r\n    getIterator(indexDefinition) {\r\n        return this.getIteratorFrom(indexDefinition.minPost(), indexDefinition);\r\n    }\r\n    getIteratorFrom(startPost, indexDefinition) {\r\n        const idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            return idx.getIteratorFrom(startPost, key => key);\r\n        }\r\n        else {\r\n            const iterator = this.children_.getIteratorFrom(startPost.name, NamedNode.Wrap);\r\n            let next = iterator.peek();\r\n            while (next != null && indexDefinition.compare(next, startPost) < 0) {\r\n                iterator.getNext();\r\n                next = iterator.peek();\r\n            }\r\n            return iterator;\r\n        }\r\n    }\r\n    getReverseIterator(indexDefinition) {\r\n        return this.getReverseIteratorFrom(indexDefinition.maxPost(), indexDefinition);\r\n    }\r\n    getReverseIteratorFrom(endPost, indexDefinition) {\r\n        const idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            return idx.getReverseIteratorFrom(endPost, key => {\r\n                return key;\r\n            });\r\n        }\r\n        else {\r\n            const iterator = this.children_.getReverseIteratorFrom(endPost.name, NamedNode.Wrap);\r\n            let next = iterator.peek();\r\n            while (next != null && indexDefinition.compare(next, endPost) > 0) {\r\n                iterator.getNext();\r\n                next = iterator.peek();\r\n            }\r\n            return iterator;\r\n        }\r\n    }\r\n    compareTo(other) {\r\n        if (this.isEmpty()) {\r\n            if (other.isEmpty()) {\r\n                return 0;\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n        }\r\n        else if (other.isLeafNode() || other.isEmpty()) {\r\n            return 1;\r\n        }\r\n        else if (other === MAX_NODE) {\r\n            return -1;\r\n        }\r\n        else {\r\n            // Must be another node with children.\r\n            return 0;\r\n        }\r\n    }\r\n    withIndex(indexDefinition) {\r\n        if (indexDefinition === KEY_INDEX ||\r\n            this.indexMap_.hasIndex(indexDefinition)) {\r\n            return this;\r\n        }\r\n        else {\r\n            const newIndexMap = this.indexMap_.addIndex(indexDefinition, this.children_);\r\n            return new ChildrenNode(this.children_, this.priorityNode_, newIndexMap);\r\n        }\r\n    }\r\n    isIndexed(index) {\r\n        return index === KEY_INDEX || this.indexMap_.hasIndex(index);\r\n    }\r\n    equals(other) {\r\n        if (other === this) {\r\n            return true;\r\n        }\r\n        else if (other.isLeafNode()) {\r\n            return false;\r\n        }\r\n        else {\r\n            const otherChildrenNode = other;\r\n            if (!this.getPriority().equals(otherChildrenNode.getPriority())) {\r\n                return false;\r\n            }\r\n            else if (this.children_.count() === otherChildrenNode.children_.count()) {\r\n                const thisIter = this.getIterator(PRIORITY_INDEX);\r\n                const otherIter = otherChildrenNode.getIterator(PRIORITY_INDEX);\r\n                let thisCurrent = thisIter.getNext();\r\n                let otherCurrent = otherIter.getNext();\r\n                while (thisCurrent && otherCurrent) {\r\n                    if (thisCurrent.name !== otherCurrent.name ||\r\n                        !thisCurrent.node.equals(otherCurrent.node)) {\r\n                        return false;\r\n                    }\r\n                    thisCurrent = thisIter.getNext();\r\n                    otherCurrent = otherIter.getNext();\r\n                }\r\n                return thisCurrent === null && otherCurrent === null;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Returns a SortedMap ordered by index, or null if the default (by-key) ordering can be used\r\n     * instead.\r\n     *\r\n     */\r\n    resolveIndex_(indexDefinition) {\r\n        if (indexDefinition === KEY_INDEX) {\r\n            return null;\r\n        }\r\n        else {\r\n            return this.indexMap_.get(indexDefinition.toString());\r\n        }\r\n    }\r\n}\r\nChildrenNode.INTEGER_REGEXP_ = /^(0|[1-9]\\d*)$/;\r\nclass MaxNode extends ChildrenNode {\r\n    constructor() {\r\n        super(new SortedMap(NAME_COMPARATOR), ChildrenNode.EMPTY_NODE, IndexMap.Default);\r\n    }\r\n    compareTo(other) {\r\n        if (other === this) {\r\n            return 0;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    }\r\n    equals(other) {\r\n        // Not that we every compare it, but MAX_NODE is only ever equal to itself\r\n        return other === this;\r\n    }\r\n    getPriority() {\r\n        return this;\r\n    }\r\n    getImmediateChild(childName) {\r\n        return ChildrenNode.EMPTY_NODE;\r\n    }\r\n    isEmpty() {\r\n        return false;\r\n    }\r\n}\r\n/**\r\n * Marker that will sort higher than any other snapshot.\r\n */\r\nconst MAX_NODE = new MaxNode();\r\nObject.defineProperties(NamedNode, {\r\n    MIN: {\r\n        value: new NamedNode(MIN_NAME, ChildrenNode.EMPTY_NODE)\r\n    },\r\n    MAX: {\r\n        value: new NamedNode(MAX_NAME, MAX_NODE)\r\n    }\r\n});\r\n/**\r\n * Reference Extensions\r\n */\r\nKeyIndex.__EMPTY_NODE = ChildrenNode.EMPTY_NODE;\r\nLeafNode.__childrenNodeConstructor = ChildrenNode;\r\nsetMaxNode$1(MAX_NODE);\r\nsetMaxNode(MAX_NODE);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst USE_HINZE = true;\r\n/**\r\n * Constructs a snapshot node representing the passed JSON and returns it.\r\n * @param json - JSON to create a node for.\r\n * @param priority - Optional priority to use.  This will be ignored if the\r\n * passed JSON contains a .priority property.\r\n */\r\nfunction nodeFromJSON(json, priority = null) {\r\n    if (json === null) {\r\n        return ChildrenNode.EMPTY_NODE;\r\n    }\r\n    if (typeof json === 'object' && '.priority' in json) {\r\n        priority = json['.priority'];\r\n    }\r\n    assert(priority === null ||\r\n        typeof priority === 'string' ||\r\n        typeof priority === 'number' ||\r\n        (typeof priority === 'object' && '.sv' in priority), 'Invalid priority type found: ' + typeof priority);\r\n    if (typeof json === 'object' && '.value' in json && json['.value'] !== null) {\r\n        json = json['.value'];\r\n    }\r\n    // Valid leaf nodes include non-objects or server-value wrapper objects\r\n    if (typeof json !== 'object' || '.sv' in json) {\r\n        const jsonLeaf = json;\r\n        return new LeafNode(jsonLeaf, nodeFromJSON(priority));\r\n    }\r\n    if (!(json instanceof Array) && USE_HINZE) {\r\n        const children = [];\r\n        let childrenHavePriority = false;\r\n        const hinzeJsonObj = json;\r\n        each(hinzeJsonObj, (key, child) => {\r\n            if (key.substring(0, 1) !== '.') {\r\n                // Ignore metadata nodes\r\n                const childNode = nodeFromJSON(child);\r\n                if (!childNode.isEmpty()) {\r\n                    childrenHavePriority =\r\n                        childrenHavePriority || !childNode.getPriority().isEmpty();\r\n                    children.push(new NamedNode(key, childNode));\r\n                }\r\n            }\r\n        });\r\n        if (children.length === 0) {\r\n            return ChildrenNode.EMPTY_NODE;\r\n        }\r\n        const childSet = buildChildSet(children, NAME_ONLY_COMPARATOR, namedNode => namedNode.name, NAME_COMPARATOR);\r\n        if (childrenHavePriority) {\r\n            const sortedChildSet = buildChildSet(children, PRIORITY_INDEX.getCompare());\r\n            return new ChildrenNode(childSet, nodeFromJSON(priority), new IndexMap({ '.priority': sortedChildSet }, { '.priority': PRIORITY_INDEX }));\r\n        }\r\n        else {\r\n            return new ChildrenNode(childSet, nodeFromJSON(priority), IndexMap.Default);\r\n        }\r\n    }\r\n    else {\r\n        let node = ChildrenNode.EMPTY_NODE;\r\n        each(json, (key, childData) => {\r\n            if (contains(json, key)) {\r\n                if (key.substring(0, 1) !== '.') {\r\n                    // ignore metadata nodes.\r\n                    const childNode = nodeFromJSON(childData);\r\n                    if (childNode.isLeafNode() || !childNode.isEmpty()) {\r\n                        node = node.updateImmediateChild(key, childNode);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return node.updatePriority(nodeFromJSON(priority));\r\n    }\r\n}\r\nsetNodeFromJSON(nodeFromJSON);\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass PathIndex extends Index {\r\n    constructor(indexPath_) {\r\n        super();\r\n        this.indexPath_ = indexPath_;\r\n        assert(!pathIsEmpty(indexPath_) && pathGetFront(indexPath_) !== '.priority', \"Can't create PathIndex with empty path or .priority key\");\r\n    }\r\n    extractChild(snap) {\r\n        return snap.getChild(this.indexPath_);\r\n    }\r\n    isDefinedOn(node) {\r\n        return !node.getChild(this.indexPath_).isEmpty();\r\n    }\r\n    compare(a, b) {\r\n        const aChild = this.extractChild(a.node);\r\n        const bChild = this.extractChild(b.node);\r\n        const indexCmp = aChild.compareTo(bChild);\r\n        if (indexCmp === 0) {\r\n            return nameCompare(a.name, b.name);\r\n        }\r\n        else {\r\n            return indexCmp;\r\n        }\r\n    }\r\n    makePost(indexValue, name) {\r\n        const valueNode = nodeFromJSON(indexValue);\r\n        const node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, valueNode);\r\n        return new NamedNode(name, node);\r\n    }\r\n    maxPost() {\r\n        const node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, MAX_NODE);\r\n        return new NamedNode(MAX_NAME, node);\r\n    }\r\n    toString() {\r\n        return pathSlice(this.indexPath_, 0).join('/');\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass ValueIndex extends Index {\r\n    compare(a, b) {\r\n        const indexCmp = a.node.compareTo(b.node);\r\n        if (indexCmp === 0) {\r\n            return nameCompare(a.name, b.name);\r\n        }\r\n        else {\r\n            return indexCmp;\r\n        }\r\n    }\r\n    isDefinedOn(node) {\r\n        return true;\r\n    }\r\n    indexedValueChanged(oldNode, newNode) {\r\n        return !oldNode.equals(newNode);\r\n    }\r\n    minPost() {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        return NamedNode.MIN;\r\n    }\r\n    maxPost() {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        return NamedNode.MAX;\r\n    }\r\n    makePost(indexValue, name) {\r\n        const valueNode = nodeFromJSON(indexValue);\r\n        return new NamedNode(name, valueNode);\r\n    }\r\n    /**\r\n     * @returns String representation for inclusion in a query spec\r\n     */\r\n    toString() {\r\n        return '.value';\r\n    }\r\n}\r\nconst VALUE_INDEX = new ValueIndex();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction changeValue(snapshotNode) {\r\n    return { type: \"value\" /* ChangeType.VALUE */, snapshotNode };\r\n}\r\nfunction changeChildAdded(childName, snapshotNode) {\r\n    return { type: \"child_added\" /* ChangeType.CHILD_ADDED */, snapshotNode, childName };\r\n}\r\nfunction changeChildRemoved(childName, snapshotNode) {\r\n    return { type: \"child_removed\" /* ChangeType.CHILD_REMOVED */, snapshotNode, childName };\r\n}\r\nfunction changeChildChanged(childName, snapshotNode, oldSnap) {\r\n    return {\r\n        type: \"child_changed\" /* ChangeType.CHILD_CHANGED */,\r\n        snapshotNode,\r\n        childName,\r\n        oldSnap\r\n    };\r\n}\r\nfunction changeChildMoved(childName, snapshotNode) {\r\n    return { type: \"child_moved\" /* ChangeType.CHILD_MOVED */, snapshotNode, childName };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Doesn't really filter nodes but applies an index to the node and keeps track of any changes\r\n */\r\nclass IndexedFilter {\r\n    constructor(index_) {\r\n        this.index_ = index_;\r\n    }\r\n    updateChild(snap, key, newChild, affectedPath, source, optChangeAccumulator) {\r\n        assert(snap.isIndexed(this.index_), 'A node must be indexed if only a child is updated');\r\n        const oldChild = snap.getImmediateChild(key);\r\n        // Check if anything actually changed.\r\n        if (oldChild.getChild(affectedPath).equals(newChild.getChild(affectedPath))) {\r\n            // There's an edge case where a child can enter or leave the view because affectedPath was set to null.\r\n            // In this case, affectedPath will appear null in both the old and new snapshots.  So we need\r\n            // to avoid treating these cases as \"nothing changed.\"\r\n            if (oldChild.isEmpty() === newChild.isEmpty()) {\r\n                // Nothing changed.\r\n                // This assert should be valid, but it's expensive (can dominate perf testing) so don't actually do it.\r\n                //assert(oldChild.equals(newChild), 'Old and new snapshots should be equal.');\r\n                return snap;\r\n            }\r\n        }\r\n        if (optChangeAccumulator != null) {\r\n            if (newChild.isEmpty()) {\r\n                if (snap.hasChild(key)) {\r\n                    optChangeAccumulator.trackChildChange(changeChildRemoved(key, oldChild));\r\n                }\r\n                else {\r\n                    assert(snap.isLeafNode(), 'A child remove without an old child only makes sense on a leaf node');\r\n                }\r\n            }\r\n            else if (oldChild.isEmpty()) {\r\n                optChangeAccumulator.trackChildChange(changeChildAdded(key, newChild));\r\n            }\r\n            else {\r\n                optChangeAccumulator.trackChildChange(changeChildChanged(key, newChild, oldChild));\r\n            }\r\n        }\r\n        if (snap.isLeafNode() && newChild.isEmpty()) {\r\n            return snap;\r\n        }\r\n        else {\r\n            // Make sure the node is indexed\r\n            return snap.updateImmediateChild(key, newChild).withIndex(this.index_);\r\n        }\r\n    }\r\n    updateFullNode(oldSnap, newSnap, optChangeAccumulator) {\r\n        if (optChangeAccumulator != null) {\r\n            if (!oldSnap.isLeafNode()) {\r\n                oldSnap.forEachChild(PRIORITY_INDEX, (key, childNode) => {\r\n                    if (!newSnap.hasChild(key)) {\r\n                        optChangeAccumulator.trackChildChange(changeChildRemoved(key, childNode));\r\n                    }\r\n                });\r\n            }\r\n            if (!newSnap.isLeafNode()) {\r\n                newSnap.forEachChild(PRIORITY_INDEX, (key, childNode) => {\r\n                    if (oldSnap.hasChild(key)) {\r\n                        const oldChild = oldSnap.getImmediateChild(key);\r\n                        if (!oldChild.equals(childNode)) {\r\n                            optChangeAccumulator.trackChildChange(changeChildChanged(key, childNode, oldChild));\r\n                        }\r\n                    }\r\n                    else {\r\n                        optChangeAccumulator.trackChildChange(changeChildAdded(key, childNode));\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        return newSnap.withIndex(this.index_);\r\n    }\r\n    updatePriority(oldSnap, newPriority) {\r\n        if (oldSnap.isEmpty()) {\r\n            return ChildrenNode.EMPTY_NODE;\r\n        }\r\n        else {\r\n            return oldSnap.updatePriority(newPriority);\r\n        }\r\n    }\r\n    filtersNodes() {\r\n        return false;\r\n    }\r\n    getIndexedFilter() {\r\n        return this;\r\n    }\r\n    getIndex() {\r\n        return this.index_;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Filters nodes by range and uses an IndexFilter to track any changes after filtering the node\r\n */\r\nclass RangedFilter {\r\n    constructor(params) {\r\n        this.indexedFilter_ = new IndexedFilter(params.getIndex());\r\n        this.index_ = params.getIndex();\r\n        this.startPost_ = RangedFilter.getStartPost_(params);\r\n        this.endPost_ = RangedFilter.getEndPost_(params);\r\n        this.startIsInclusive_ = !params.startAfterSet_;\r\n        this.endIsInclusive_ = !params.endBeforeSet_;\r\n    }\r\n    getStartPost() {\r\n        return this.startPost_;\r\n    }\r\n    getEndPost() {\r\n        return this.endPost_;\r\n    }\r\n    matches(node) {\r\n        const isWithinStart = this.startIsInclusive_\r\n            ? this.index_.compare(this.getStartPost(), node) <= 0\r\n            : this.index_.compare(this.getStartPost(), node) < 0;\r\n        const isWithinEnd = this.endIsInclusive_\r\n            ? this.index_.compare(node, this.getEndPost()) <= 0\r\n            : this.index_.compare(node, this.getEndPost()) < 0;\r\n        return isWithinStart && isWithinEnd;\r\n    }\r\n    updateChild(snap, key, newChild, affectedPath, source, optChangeAccumulator) {\r\n        if (!this.matches(new NamedNode(key, newChild))) {\r\n            newChild = ChildrenNode.EMPTY_NODE;\r\n        }\r\n        return this.indexedFilter_.updateChild(snap, key, newChild, affectedPath, source, optChangeAccumulator);\r\n    }\r\n    updateFullNode(oldSnap, newSnap, optChangeAccumulator) {\r\n        if (newSnap.isLeafNode()) {\r\n            // Make sure we have a children node with the correct index, not a leaf node;\r\n            newSnap = ChildrenNode.EMPTY_NODE;\r\n        }\r\n        let filtered = newSnap.withIndex(this.index_);\r\n        // Don't support priorities on queries\r\n        filtered = filtered.updatePriority(ChildrenNode.EMPTY_NODE);\r\n        const self = this;\r\n        newSnap.forEachChild(PRIORITY_INDEX, (key, childNode) => {\r\n            if (!self.matches(new NamedNode(key, childNode))) {\r\n                filtered = filtered.updateImmediateChild(key, ChildrenNode.EMPTY_NODE);\r\n            }\r\n        });\r\n        return this.indexedFilter_.updateFullNode(oldSnap, filtered, optChangeAccumulator);\r\n    }\r\n    updatePriority(oldSnap, newPriority) {\r\n        // Don't support priorities on queries\r\n        return oldSnap;\r\n    }\r\n    filtersNodes() {\r\n        return true;\r\n    }\r\n    getIndexedFilter() {\r\n        return this.indexedFilter_;\r\n    }\r\n    getIndex() {\r\n        return this.index_;\r\n    }\r\n    static getStartPost_(params) {\r\n        if (params.hasStart()) {\r\n            const startName = params.getIndexStartName();\r\n            return params.getIndex().makePost(params.getIndexStartValue(), startName);\r\n        }\r\n        else {\r\n            return params.getIndex().minPost();\r\n        }\r\n    }\r\n    static getEndPost_(params) {\r\n        if (params.hasEnd()) {\r\n            const endName = params.getIndexEndName();\r\n            return params.getIndex().makePost(params.getIndexEndValue(), endName);\r\n        }\r\n        else {\r\n            return params.getIndex().maxPost();\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Applies a limit and a range to a node and uses RangedFilter to do the heavy lifting where possible\r\n */\r\nclass LimitedFilter {\r\n    constructor(params) {\r\n        this.withinDirectionalStart = (node) => this.reverse_ ? this.withinEndPost(node) : this.withinStartPost(node);\r\n        this.withinDirectionalEnd = (node) => this.reverse_ ? this.withinStartPost(node) : this.withinEndPost(node);\r\n        this.withinStartPost = (node) => {\r\n            const compareRes = this.index_.compare(this.rangedFilter_.getStartPost(), node);\r\n            return this.startIsInclusive_ ? compareRes <= 0 : compareRes < 0;\r\n        };\r\n        this.withinEndPost = (node) => {\r\n            const compareRes = this.index_.compare(node, this.rangedFilter_.getEndPost());\r\n            return this.endIsInclusive_ ? compareRes <= 0 : compareRes < 0;\r\n        };\r\n        this.rangedFilter_ = new RangedFilter(params);\r\n        this.index_ = params.getIndex();\r\n        this.limit_ = params.getLimit();\r\n        this.reverse_ = !params.isViewFromLeft();\r\n        this.startIsInclusive_ = !params.startAfterSet_;\r\n        this.endIsInclusive_ = !params.endBeforeSet_;\r\n    }\r\n    updateChild(snap, key, newChild, affectedPath, source, optChangeAccumulator) {\r\n        if (!this.rangedFilter_.matches(new NamedNode(key, newChild))) {\r\n            newChild = ChildrenNode.EMPTY_NODE;\r\n        }\r\n        if (snap.getImmediateChild(key).equals(newChild)) {\r\n            // No change\r\n            return snap;\r\n        }\r\n        else if (snap.numChildren() < this.limit_) {\r\n            return this.rangedFilter_\r\n                .getIndexedFilter()\r\n                .updateChild(snap, key, newChild, affectedPath, source, optChangeAccumulator);\r\n        }\r\n        else {\r\n            return this.fullLimitUpdateChild_(snap, key, newChild, source, optChangeAccumulator);\r\n        }\r\n    }\r\n    updateFullNode(oldSnap, newSnap, optChangeAccumulator) {\r\n        let filtered;\r\n        if (newSnap.isLeafNode() || newSnap.isEmpty()) {\r\n            // Make sure we have a children node with the correct index, not a leaf node;\r\n            filtered = ChildrenNode.EMPTY_NODE.withIndex(this.index_);\r\n        }\r\n        else {\r\n            if (this.limit_ * 2 < newSnap.numChildren() &&\r\n                newSnap.isIndexed(this.index_)) {\r\n                // Easier to build up a snapshot, since what we're given has more than twice the elements we want\r\n                filtered = ChildrenNode.EMPTY_NODE.withIndex(this.index_);\r\n                // anchor to the startPost, endPost, or last element as appropriate\r\n                let iterator;\r\n                if (this.reverse_) {\r\n                    iterator = newSnap.getReverseIteratorFrom(this.rangedFilter_.getEndPost(), this.index_);\r\n                }\r\n                else {\r\n                    iterator = newSnap.getIteratorFrom(this.rangedFilter_.getStartPost(), this.index_);\r\n                }\r\n                let count = 0;\r\n                while (iterator.hasNext() && count < this.limit_) {\r\n                    const next = iterator.getNext();\r\n                    if (!this.withinDirectionalStart(next)) {\r\n                        // if we have not reached the start, skip to the next element\r\n                        continue;\r\n                    }\r\n                    else if (!this.withinDirectionalEnd(next)) {\r\n                        // if we have reached the end, stop adding elements\r\n                        break;\r\n                    }\r\n                    else {\r\n                        filtered = filtered.updateImmediateChild(next.name, next.node);\r\n                        count++;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                // The snap contains less than twice the limit. Faster to delete from the snap than build up a new one\r\n                filtered = newSnap.withIndex(this.index_);\r\n                // Don't support priorities on queries\r\n                filtered = filtered.updatePriority(ChildrenNode.EMPTY_NODE);\r\n                let iterator;\r\n                if (this.reverse_) {\r\n                    iterator = filtered.getReverseIterator(this.index_);\r\n                }\r\n                else {\r\n                    iterator = filtered.getIterator(this.index_);\r\n                }\r\n                let count = 0;\r\n                while (iterator.hasNext()) {\r\n                    const next = iterator.getNext();\r\n                    const inRange = count < this.limit_ &&\r\n                        this.withinDirectionalStart(next) &&\r\n                        this.withinDirectionalEnd(next);\r\n                    if (inRange) {\r\n                        count++;\r\n                    }\r\n                    else {\r\n                        filtered = filtered.updateImmediateChild(next.name, ChildrenNode.EMPTY_NODE);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return this.rangedFilter_\r\n            .getIndexedFilter()\r\n            .updateFullNode(oldSnap, filtered, optChangeAccumulator);\r\n    }\r\n    updatePriority(oldSnap, newPriority) {\r\n        // Don't support priorities on queries\r\n        return oldSnap;\r\n    }\r\n    filtersNodes() {\r\n        return true;\r\n    }\r\n    getIndexedFilter() {\r\n        return this.rangedFilter_.getIndexedFilter();\r\n    }\r\n    getIndex() {\r\n        return this.index_;\r\n    }\r\n    fullLimitUpdateChild_(snap, childKey, childSnap, source, changeAccumulator) {\r\n        // TODO: rename all cache stuff etc to general snap terminology\r\n        let cmp;\r\n        if (this.reverse_) {\r\n            const indexCmp = this.index_.getCompare();\r\n            cmp = (a, b) => indexCmp(b, a);\r\n        }\r\n        else {\r\n            cmp = this.index_.getCompare();\r\n        }\r\n        const oldEventCache = snap;\r\n        assert(oldEventCache.numChildren() === this.limit_, '');\r\n        const newChildNamedNode = new NamedNode(childKey, childSnap);\r\n        const windowBoundary = this.reverse_\r\n            ? oldEventCache.getFirstChild(this.index_)\r\n            : oldEventCache.getLastChild(this.index_);\r\n        const inRange = this.rangedFilter_.matches(newChildNamedNode);\r\n        if (oldEventCache.hasChild(childKey)) {\r\n            const oldChildSnap = oldEventCache.getImmediateChild(childKey);\r\n            let nextChild = source.getChildAfterChild(this.index_, windowBoundary, this.reverse_);\r\n            while (nextChild != null &&\r\n                (nextChild.name === childKey || oldEventCache.hasChild(nextChild.name))) {\r\n                // There is a weird edge case where a node is updated as part of a merge in the write tree, but hasn't\r\n                // been applied to the limited filter yet. Ignore this next child which will be updated later in\r\n                // the limited filter...\r\n                nextChild = source.getChildAfterChild(this.index_, nextChild, this.reverse_);\r\n            }\r\n            const compareNext = nextChild == null ? 1 : cmp(nextChild, newChildNamedNode);\r\n            const remainsInWindow = inRange && !childSnap.isEmpty() && compareNext >= 0;\r\n            if (remainsInWindow) {\r\n                if (changeAccumulator != null) {\r\n                    changeAccumulator.trackChildChange(changeChildChanged(childKey, childSnap, oldChildSnap));\r\n                }\r\n                return oldEventCache.updateImmediateChild(childKey, childSnap);\r\n            }\r\n            else {\r\n                if (changeAccumulator != null) {\r\n                    changeAccumulator.trackChildChange(changeChildRemoved(childKey, oldChildSnap));\r\n                }\r\n                const newEventCache = oldEventCache.updateImmediateChild(childKey, ChildrenNode.EMPTY_NODE);\r\n                const nextChildInRange = nextChild != null && this.rangedFilter_.matches(nextChild);\r\n                if (nextChildInRange) {\r\n                    if (changeAccumulator != null) {\r\n                        changeAccumulator.trackChildChange(changeChildAdded(nextChild.name, nextChild.node));\r\n                    }\r\n                    return newEventCache.updateImmediateChild(nextChild.name, nextChild.node);\r\n                }\r\n                else {\r\n                    return newEventCache;\r\n                }\r\n            }\r\n        }\r\n        else if (childSnap.isEmpty()) {\r\n            // we're deleting a node, but it was not in the window, so ignore it\r\n            return snap;\r\n        }\r\n        else if (inRange) {\r\n            if (cmp(windowBoundary, newChildNamedNode) >= 0) {\r\n                if (changeAccumulator != null) {\r\n                    changeAccumulator.trackChildChange(changeChildRemoved(windowBoundary.name, windowBoundary.node));\r\n                    changeAccumulator.trackChildChange(changeChildAdded(childKey, childSnap));\r\n                }\r\n                return oldEventCache\r\n                    .updateImmediateChild(childKey, childSnap)\r\n                    .updateImmediateChild(windowBoundary.name, ChildrenNode.EMPTY_NODE);\r\n            }\r\n            else {\r\n                return snap;\r\n            }\r\n        }\r\n        else {\r\n            return snap;\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This class is an immutable-from-the-public-api struct containing a set of query parameters defining a\r\n * range to be returned for a particular location. It is assumed that validation of parameters is done at the\r\n * user-facing API level, so it is not done here.\r\n *\r\n * @internal\r\n */\r\nclass QueryParams {\r\n    constructor() {\r\n        this.limitSet_ = false;\r\n        this.startSet_ = false;\r\n        this.startNameSet_ = false;\r\n        this.startAfterSet_ = false; // can only be true if startSet_ is true\r\n        this.endSet_ = false;\r\n        this.endNameSet_ = false;\r\n        this.endBeforeSet_ = false; // can only be true if endSet_ is true\r\n        this.limit_ = 0;\r\n        this.viewFrom_ = '';\r\n        this.indexStartValue_ = null;\r\n        this.indexStartName_ = '';\r\n        this.indexEndValue_ = null;\r\n        this.indexEndName_ = '';\r\n        this.index_ = PRIORITY_INDEX;\r\n    }\r\n    hasStart() {\r\n        return this.startSet_;\r\n    }\r\n    /**\r\n     * @returns True if it would return from left.\r\n     */\r\n    isViewFromLeft() {\r\n        if (this.viewFrom_ === '') {\r\n            // limit(), rather than limitToFirst or limitToLast was called.\r\n            // This means that only one of startSet_ and endSet_ is true. Use them\r\n            // to calculate which side of the view to anchor to. If neither is set,\r\n            // anchor to the end.\r\n            return this.startSet_;\r\n        }\r\n        else {\r\n            return this.viewFrom_ === \"l\" /* WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_LEFT */;\r\n        }\r\n    }\r\n    /**\r\n     * Only valid to call if hasStart() returns true\r\n     */\r\n    getIndexStartValue() {\r\n        assert(this.startSet_, 'Only valid if start has been set');\r\n        return this.indexStartValue_;\r\n    }\r\n    /**\r\n     * Only valid to call if hasStart() returns true.\r\n     * Returns the starting key name for the range defined by these query parameters\r\n     */\r\n    getIndexStartName() {\r\n        assert(this.startSet_, 'Only valid if start has been set');\r\n        if (this.startNameSet_) {\r\n            return this.indexStartName_;\r\n        }\r\n        else {\r\n            return MIN_NAME;\r\n        }\r\n    }\r\n    hasEnd() {\r\n        return this.endSet_;\r\n    }\r\n    /**\r\n     * Only valid to call if hasEnd() returns true.\r\n     */\r\n    getIndexEndValue() {\r\n        assert(this.endSet_, 'Only valid if end has been set');\r\n        return this.indexEndValue_;\r\n    }\r\n    /**\r\n     * Only valid to call if hasEnd() returns true.\r\n     * Returns the end key name for the range defined by these query parameters\r\n     */\r\n    getIndexEndName() {\r\n        assert(this.endSet_, 'Only valid if end has been set');\r\n        if (this.endNameSet_) {\r\n            return this.indexEndName_;\r\n        }\r\n        else {\r\n            return MAX_NAME;\r\n        }\r\n    }\r\n    hasLimit() {\r\n        return this.limitSet_;\r\n    }\r\n    /**\r\n     * @returns True if a limit has been set and it has been explicitly anchored\r\n     */\r\n    hasAnchoredLimit() {\r\n        return this.limitSet_ && this.viewFrom_ !== '';\r\n    }\r\n    /**\r\n     * Only valid to call if hasLimit() returns true\r\n     */\r\n    getLimit() {\r\n        assert(this.limitSet_, 'Only valid if limit has been set');\r\n        return this.limit_;\r\n    }\r\n    getIndex() {\r\n        return this.index_;\r\n    }\r\n    loadsAllData() {\r\n        return !(this.startSet_ || this.endSet_ || this.limitSet_);\r\n    }\r\n    isDefault() {\r\n        return this.loadsAllData() && this.index_ === PRIORITY_INDEX;\r\n    }\r\n    copy() {\r\n        const copy = new QueryParams();\r\n        copy.limitSet_ = this.limitSet_;\r\n        copy.limit_ = this.limit_;\r\n        copy.startSet_ = this.startSet_;\r\n        copy.startAfterSet_ = this.startAfterSet_;\r\n        copy.indexStartValue_ = this.indexStartValue_;\r\n        copy.startNameSet_ = this.startNameSet_;\r\n        copy.indexStartName_ = this.indexStartName_;\r\n        copy.endSet_ = this.endSet_;\r\n        copy.endBeforeSet_ = this.endBeforeSet_;\r\n        copy.indexEndValue_ = this.indexEndValue_;\r\n        copy.endNameSet_ = this.endNameSet_;\r\n        copy.indexEndName_ = this.indexEndName_;\r\n        copy.index_ = this.index_;\r\n        copy.viewFrom_ = this.viewFrom_;\r\n        return copy;\r\n    }\r\n}\r\nfunction queryParamsGetNodeFilter(queryParams) {\r\n    if (queryParams.loadsAllData()) {\r\n        return new IndexedFilter(queryParams.getIndex());\r\n    }\r\n    else if (queryParams.hasLimit()) {\r\n        return new LimitedFilter(queryParams);\r\n    }\r\n    else {\r\n        return new RangedFilter(queryParams);\r\n    }\r\n}\r\nfunction queryParamsLimitToFirst(queryParams, newLimit) {\r\n    const newParams = queryParams.copy();\r\n    newParams.limitSet_ = true;\r\n    newParams.limit_ = newLimit;\r\n    newParams.viewFrom_ = \"l\" /* WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_LEFT */;\r\n    return newParams;\r\n}\r\nfunction queryParamsLimitToLast(queryParams, newLimit) {\r\n    const newParams = queryParams.copy();\r\n    newParams.limitSet_ = true;\r\n    newParams.limit_ = newLimit;\r\n    newParams.viewFrom_ = \"r\" /* WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_RIGHT */;\r\n    return newParams;\r\n}\r\nfunction queryParamsStartAt(queryParams, indexValue, key) {\r\n    const newParams = queryParams.copy();\r\n    newParams.startSet_ = true;\r\n    if (indexValue === undefined) {\r\n        indexValue = null;\r\n    }\r\n    newParams.indexStartValue_ = indexValue;\r\n    if (key != null) {\r\n        newParams.startNameSet_ = true;\r\n        newParams.indexStartName_ = key;\r\n    }\r\n    else {\r\n        newParams.startNameSet_ = false;\r\n        newParams.indexStartName_ = '';\r\n    }\r\n    return newParams;\r\n}\r\nfunction queryParamsStartAfter(queryParams, indexValue, key) {\r\n    let params;\r\n    if (queryParams.index_ === KEY_INDEX || !!key) {\r\n        params = queryParamsStartAt(queryParams, indexValue, key);\r\n    }\r\n    else {\r\n        params = queryParamsStartAt(queryParams, indexValue, MAX_NAME);\r\n    }\r\n    params.startAfterSet_ = true;\r\n    return params;\r\n}\r\nfunction queryParamsEndAt(queryParams, indexValue, key) {\r\n    const newParams = queryParams.copy();\r\n    newParams.endSet_ = true;\r\n    if (indexValue === undefined) {\r\n        indexValue = null;\r\n    }\r\n    newParams.indexEndValue_ = indexValue;\r\n    if (key !== undefined) {\r\n        newParams.endNameSet_ = true;\r\n        newParams.indexEndName_ = key;\r\n    }\r\n    else {\r\n        newParams.endNameSet_ = false;\r\n        newParams.indexEndName_ = '';\r\n    }\r\n    return newParams;\r\n}\r\nfunction queryParamsEndBefore(queryParams, indexValue, key) {\r\n    let params;\r\n    if (queryParams.index_ === KEY_INDEX || !!key) {\r\n        params = queryParamsEndAt(queryParams, indexValue, key);\r\n    }\r\n    else {\r\n        params = queryParamsEndAt(queryParams, indexValue, MIN_NAME);\r\n    }\r\n    params.endBeforeSet_ = true;\r\n    return params;\r\n}\r\nfunction queryParamsOrderBy(queryParams, index) {\r\n    const newParams = queryParams.copy();\r\n    newParams.index_ = index;\r\n    return newParams;\r\n}\r\n/**\r\n * Returns a set of REST query string parameters representing this query.\r\n *\r\n * @returns query string parameters\r\n */\r\nfunction queryParamsToRestQueryStringParameters(queryParams) {\r\n    const qs = {};\r\n    if (queryParams.isDefault()) {\r\n        return qs;\r\n    }\r\n    let orderBy;\r\n    if (queryParams.index_ === PRIORITY_INDEX) {\r\n        orderBy = \"$priority\" /* REST_QUERY_CONSTANTS.PRIORITY_INDEX */;\r\n    }\r\n    else if (queryParams.index_ === VALUE_INDEX) {\r\n        orderBy = \"$value\" /* REST_QUERY_CONSTANTS.VALUE_INDEX */;\r\n    }\r\n    else if (queryParams.index_ === KEY_INDEX) {\r\n        orderBy = \"$key\" /* REST_QUERY_CONSTANTS.KEY_INDEX */;\r\n    }\r\n    else {\r\n        assert(queryParams.index_ instanceof PathIndex, 'Unrecognized index type!');\r\n        orderBy = queryParams.index_.toString();\r\n    }\r\n    qs[\"orderBy\" /* REST_QUERY_CONSTANTS.ORDER_BY */] = stringify(orderBy);\r\n    if (queryParams.startSet_) {\r\n        const startParam = queryParams.startAfterSet_\r\n            ? \"startAfter\" /* REST_QUERY_CONSTANTS.START_AFTER */\r\n            : \"startAt\" /* REST_QUERY_CONSTANTS.START_AT */;\r\n        qs[startParam] = stringify(queryParams.indexStartValue_);\r\n        if (queryParams.startNameSet_) {\r\n            qs[startParam] += ',' + stringify(queryParams.indexStartName_);\r\n        }\r\n    }\r\n    if (queryParams.endSet_) {\r\n        const endParam = queryParams.endBeforeSet_\r\n            ? \"endBefore\" /* REST_QUERY_CONSTANTS.END_BEFORE */\r\n            : \"endAt\" /* REST_QUERY_CONSTANTS.END_AT */;\r\n        qs[endParam] = stringify(queryParams.indexEndValue_);\r\n        if (queryParams.endNameSet_) {\r\n            qs[endParam] += ',' + stringify(queryParams.indexEndName_);\r\n        }\r\n    }\r\n    if (queryParams.limitSet_) {\r\n        if (queryParams.isViewFromLeft()) {\r\n            qs[\"limitToFirst\" /* REST_QUERY_CONSTANTS.LIMIT_TO_FIRST */] = queryParams.limit_;\r\n        }\r\n        else {\r\n            qs[\"limitToLast\" /* REST_QUERY_CONSTANTS.LIMIT_TO_LAST */] = queryParams.limit_;\r\n        }\r\n    }\r\n    return qs;\r\n}\r\nfunction queryParamsGetQueryObject(queryParams) {\r\n    const obj = {};\r\n    if (queryParams.startSet_) {\r\n        obj[\"sp\" /* WIRE_PROTOCOL_CONSTANTS.INDEX_START_VALUE */] =\r\n            queryParams.indexStartValue_;\r\n        if (queryParams.startNameSet_) {\r\n            obj[\"sn\" /* WIRE_PROTOCOL_CONSTANTS.INDEX_START_NAME */] =\r\n                queryParams.indexStartName_;\r\n        }\r\n        obj[\"sin\" /* WIRE_PROTOCOL_CONSTANTS.INDEX_START_IS_INCLUSIVE */] =\r\n            !queryParams.startAfterSet_;\r\n    }\r\n    if (queryParams.endSet_) {\r\n        obj[\"ep\" /* WIRE_PROTOCOL_CONSTANTS.INDEX_END_VALUE */] = queryParams.indexEndValue_;\r\n        if (queryParams.endNameSet_) {\r\n            obj[\"en\" /* WIRE_PROTOCOL_CONSTANTS.INDEX_END_NAME */] = queryParams.indexEndName_;\r\n        }\r\n        obj[\"ein\" /* WIRE_PROTOCOL_CONSTANTS.INDEX_END_IS_INCLUSIVE */] =\r\n            !queryParams.endBeforeSet_;\r\n    }\r\n    if (queryParams.limitSet_) {\r\n        obj[\"l\" /* WIRE_PROTOCOL_CONSTANTS.LIMIT */] = queryParams.limit_;\r\n        let viewFrom = queryParams.viewFrom_;\r\n        if (viewFrom === '') {\r\n            if (queryParams.isViewFromLeft()) {\r\n                viewFrom = \"l\" /* WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_LEFT */;\r\n            }\r\n            else {\r\n                viewFrom = \"r\" /* WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_RIGHT */;\r\n            }\r\n        }\r\n        obj[\"vf\" /* WIRE_PROTOCOL_CONSTANTS.VIEW_FROM */] = viewFrom;\r\n    }\r\n    // For now, priority index is the default, so we only specify if it's some other index\r\n    if (queryParams.index_ !== PRIORITY_INDEX) {\r\n        obj[\"i\" /* WIRE_PROTOCOL_CONSTANTS.INDEX */] = queryParams.index_.toString();\r\n    }\r\n    return obj;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An implementation of ServerActions that communicates with the server via REST requests.\r\n * This is mostly useful for compatibility with crawlers, where we don't want to spin up a full\r\n * persistent connection (using WebSockets or long-polling)\r\n */\r\nclass ReadonlyRestClient extends ServerActions {\r\n    /**\r\n     * @param repoInfo_ - Data about the namespace we are connecting to\r\n     * @param onDataUpdate_ - A callback for new data from the server\r\n     */\r\n    constructor(repoInfo_, onDataUpdate_, authTokenProvider_, appCheckTokenProvider_) {\r\n        super();\r\n        this.repoInfo_ = repoInfo_;\r\n        this.onDataUpdate_ = onDataUpdate_;\r\n        this.authTokenProvider_ = authTokenProvider_;\r\n        this.appCheckTokenProvider_ = appCheckTokenProvider_;\r\n        /** @private {function(...[*])} */\r\n        this.log_ = logWrapper('p:rest:');\r\n        /**\r\n         * We don't actually need to track listens, except to prevent us calling an onComplete for a listen\r\n         * that's been removed. :-/\r\n         */\r\n        this.listens_ = {};\r\n    }\r\n    reportStats(stats) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    static getListenId_(query, tag) {\r\n        if (tag !== undefined) {\r\n            return 'tag$' + tag;\r\n        }\r\n        else {\r\n            assert(query._queryParams.isDefault(), \"should have a tag if it's not a default query.\");\r\n            return query._path.toString();\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    listen(query, currentHashFn, tag, onComplete) {\r\n        const pathString = query._path.toString();\r\n        this.log_('Listen called for ' + pathString + ' ' + query._queryIdentifier);\r\n        // Mark this listener so we can tell if it's removed.\r\n        const listenId = ReadonlyRestClient.getListenId_(query, tag);\r\n        const thisListen = {};\r\n        this.listens_[listenId] = thisListen;\r\n        const queryStringParameters = queryParamsToRestQueryStringParameters(query._queryParams);\r\n        this.restRequest_(pathString + '.json', queryStringParameters, (error, result) => {\r\n            let data = result;\r\n            if (error === 404) {\r\n                data = null;\r\n                error = null;\r\n            }\r\n            if (error === null) {\r\n                this.onDataUpdate_(pathString, data, /*isMerge=*/ false, tag);\r\n            }\r\n            if (safeGet(this.listens_, listenId) === thisListen) {\r\n                let status;\r\n                if (!error) {\r\n                    status = 'ok';\r\n                }\r\n                else if (error === 401) {\r\n                    status = 'permission_denied';\r\n                }\r\n                else {\r\n                    status = 'rest_error:' + error;\r\n                }\r\n                onComplete(status, null);\r\n            }\r\n        });\r\n    }\r\n    /** @inheritDoc */\r\n    unlisten(query, tag) {\r\n        const listenId = ReadonlyRestClient.getListenId_(query, tag);\r\n        delete this.listens_[listenId];\r\n    }\r\n    get(query) {\r\n        const queryStringParameters = queryParamsToRestQueryStringParameters(query._queryParams);\r\n        const pathString = query._path.toString();\r\n        const deferred = new Deferred();\r\n        this.restRequest_(pathString + '.json', queryStringParameters, (error, result) => {\r\n            let data = result;\r\n            if (error === 404) {\r\n                data = null;\r\n                error = null;\r\n            }\r\n            if (error === null) {\r\n                this.onDataUpdate_(pathString, data, \r\n                /*isMerge=*/ false, \r\n                /*tag=*/ null);\r\n                deferred.resolve(data);\r\n            }\r\n            else {\r\n                deferred.reject(new Error(data));\r\n            }\r\n        });\r\n        return deferred.promise;\r\n    }\r\n    /** @inheritDoc */\r\n    refreshAuthToken(token) {\r\n        // no-op since we just always call getToken.\r\n    }\r\n    /**\r\n     * Performs a REST request to the given path, with the provided query string parameters,\r\n     * and any auth credentials we have.\r\n     */\r\n    restRequest_(pathString, queryStringParameters = {}, callback) {\r\n        queryStringParameters['format'] = 'export';\r\n        return Promise.all([\r\n            this.authTokenProvider_.getToken(/*forceRefresh=*/ false),\r\n            this.appCheckTokenProvider_.getToken(/*forceRefresh=*/ false)\r\n        ]).then(([authToken, appCheckToken]) => {\r\n            if (authToken && authToken.accessToken) {\r\n                queryStringParameters['auth'] = authToken.accessToken;\r\n            }\r\n            if (appCheckToken && appCheckToken.token) {\r\n                queryStringParameters['ac'] = appCheckToken.token;\r\n            }\r\n            const url = (this.repoInfo_.secure ? 'https://' : 'http://') +\r\n                this.repoInfo_.host +\r\n                pathString +\r\n                '?' +\r\n                'ns=' +\r\n                this.repoInfo_.namespace +\r\n                querystring(queryStringParameters);\r\n            this.log_('Sending REST request for ' + url);\r\n            const xhr = new XMLHttpRequest();\r\n            xhr.onreadystatechange = () => {\r\n                if (callback && xhr.readyState === 4) {\r\n                    this.log_('REST Response for ' + url + ' received. status:', xhr.status, 'response:', xhr.responseText);\r\n                    let res = null;\r\n                    if (xhr.status >= 200 && xhr.status < 300) {\r\n                        try {\r\n                            res = jsonEval(xhr.responseText);\r\n                        }\r\n                        catch (e) {\r\n                            warn('Failed to parse JSON response for ' +\r\n                                url +\r\n                                ': ' +\r\n                                xhr.responseText);\r\n                        }\r\n                        callback(null, res);\r\n                    }\r\n                    else {\r\n                        // 401 and 404 are expected.\r\n                        if (xhr.status !== 401 && xhr.status !== 404) {\r\n                            warn('Got unsuccessful REST response for ' +\r\n                                url +\r\n                                ' Status: ' +\r\n                                xhr.status);\r\n                        }\r\n                        callback(xhr.status);\r\n                    }\r\n                    callback = null;\r\n                }\r\n            };\r\n            xhr.open('GET', url, /*asynchronous=*/ true);\r\n            xhr.send();\r\n        });\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Mutable object which basically just stores a reference to the \"latest\" immutable snapshot.\r\n */\r\nclass SnapshotHolder {\r\n    constructor() {\r\n        this.rootNode_ = ChildrenNode.EMPTY_NODE;\r\n    }\r\n    getNode(path) {\r\n        return this.rootNode_.getChild(path);\r\n    }\r\n    updateSnapshot(path, newSnapshotNode) {\r\n        this.rootNode_ = this.rootNode_.updateChild(path, newSnapshotNode);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction newSparseSnapshotTree() {\r\n    return {\r\n        value: null,\r\n        children: new Map()\r\n    };\r\n}\r\n/**\r\n * Stores the given node at the specified path. If there is already a node\r\n * at a shallower path, it merges the new data into that snapshot node.\r\n *\r\n * @param path - Path to look up snapshot for.\r\n * @param data - The new data, or null.\r\n */\r\nfunction sparseSnapshotTreeRemember(sparseSnapshotTree, path, data) {\r\n    if (pathIsEmpty(path)) {\r\n        sparseSnapshotTree.value = data;\r\n        sparseSnapshotTree.children.clear();\r\n    }\r\n    else if (sparseSnapshotTree.value !== null) {\r\n        sparseSnapshotTree.value = sparseSnapshotTree.value.updateChild(path, data);\r\n    }\r\n    else {\r\n        const childKey = pathGetFront(path);\r\n        if (!sparseSnapshotTree.children.has(childKey)) {\r\n            sparseSnapshotTree.children.set(childKey, newSparseSnapshotTree());\r\n        }\r\n        const child = sparseSnapshotTree.children.get(childKey);\r\n        path = pathPopFront(path);\r\n        sparseSnapshotTreeRemember(child, path, data);\r\n    }\r\n}\r\n/**\r\n * Purge the data at path from the cache.\r\n *\r\n * @param path - Path to look up snapshot for.\r\n * @returns True if this node should now be removed.\r\n */\r\nfunction sparseSnapshotTreeForget(sparseSnapshotTree, path) {\r\n    if (pathIsEmpty(path)) {\r\n        sparseSnapshotTree.value = null;\r\n        sparseSnapshotTree.children.clear();\r\n        return true;\r\n    }\r\n    else {\r\n        if (sparseSnapshotTree.value !== null) {\r\n            if (sparseSnapshotTree.value.isLeafNode()) {\r\n                // We're trying to forget a node that doesn't exist\r\n                return false;\r\n            }\r\n            else {\r\n                const value = sparseSnapshotTree.value;\r\n                sparseSnapshotTree.value = null;\r\n                value.forEachChild(PRIORITY_INDEX, (key, tree) => {\r\n                    sparseSnapshotTreeRemember(sparseSnapshotTree, new Path(key), tree);\r\n                });\r\n                return sparseSnapshotTreeForget(sparseSnapshotTree, path);\r\n            }\r\n        }\r\n        else if (sparseSnapshotTree.children.size > 0) {\r\n            const childKey = pathGetFront(path);\r\n            path = pathPopFront(path);\r\n            if (sparseSnapshotTree.children.has(childKey)) {\r\n                const safeToRemove = sparseSnapshotTreeForget(sparseSnapshotTree.children.get(childKey), path);\r\n                if (safeToRemove) {\r\n                    sparseSnapshotTree.children.delete(childKey);\r\n                }\r\n            }\r\n            return sparseSnapshotTree.children.size === 0;\r\n        }\r\n        else {\r\n            return true;\r\n        }\r\n    }\r\n}\r\n/**\r\n * Recursively iterates through all of the stored tree and calls the\r\n * callback on each one.\r\n *\r\n * @param prefixPath - Path to look up node for.\r\n * @param func - The function to invoke for each tree.\r\n */\r\nfunction sparseSnapshotTreeForEachTree(sparseSnapshotTree, prefixPath, func) {\r\n    if (sparseSnapshotTree.value !== null) {\r\n        func(prefixPath, sparseSnapshotTree.value);\r\n    }\r\n    else {\r\n        sparseSnapshotTreeForEachChild(sparseSnapshotTree, (key, tree) => {\r\n            const path = new Path(prefixPath.toString() + '/' + key);\r\n            sparseSnapshotTreeForEachTree(tree, path, func);\r\n        });\r\n    }\r\n}\r\n/**\r\n * Iterates through each immediate child and triggers the callback.\r\n * Only seems to be used in tests.\r\n *\r\n * @param func - The function to invoke for each child.\r\n */\r\nfunction sparseSnapshotTreeForEachChild(sparseSnapshotTree, func) {\r\n    sparseSnapshotTree.children.forEach((tree, key) => {\r\n        func(key, tree);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns the delta from the previous call to get stats.\r\n *\r\n * @param collection_ - The collection to \"listen\" to.\r\n */\r\nclass StatsListener {\r\n    constructor(collection_) {\r\n        this.collection_ = collection_;\r\n        this.last_ = null;\r\n    }\r\n    get() {\r\n        const newStats = this.collection_.get();\r\n        const delta = Object.assign({}, newStats);\r\n        if (this.last_) {\r\n            each(this.last_, (stat, value) => {\r\n                delta[stat] = delta[stat] - value;\r\n            });\r\n        }\r\n        this.last_ = newStats;\r\n        return delta;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Assuming some apps may have a short amount of time on page, and a bulk of firebase operations probably\r\n// happen on page load, we try to report our first set of stats pretty quickly, but we wait at least 10\r\n// seconds to try to ensure the Firebase connection is established / settled.\r\nconst FIRST_STATS_MIN_TIME = 10 * 1000;\r\nconst FIRST_STATS_MAX_TIME = 30 * 1000;\r\n// We'll continue to report stats on average every 5 minutes.\r\nconst REPORT_STATS_INTERVAL = 5 * 60 * 1000;\r\nclass StatsReporter {\r\n    constructor(collection, server_) {\r\n        this.server_ = server_;\r\n        this.statsToReport_ = {};\r\n        this.statsListener_ = new StatsListener(collection);\r\n        const timeout = FIRST_STATS_MIN_TIME +\r\n            (FIRST_STATS_MAX_TIME - FIRST_STATS_MIN_TIME) * Math.random();\r\n        setTimeoutNonBlocking(this.reportStats_.bind(this), Math.floor(timeout));\r\n    }\r\n    reportStats_() {\r\n        const stats = this.statsListener_.get();\r\n        const reportedStats = {};\r\n        let haveStatsToReport = false;\r\n        each(stats, (stat, value) => {\r\n            if (value > 0 && contains(this.statsToReport_, stat)) {\r\n                reportedStats[stat] = value;\r\n                haveStatsToReport = true;\r\n            }\r\n        });\r\n        if (haveStatsToReport) {\r\n            this.server_.reportStats(reportedStats);\r\n        }\r\n        // queue our next run.\r\n        setTimeoutNonBlocking(this.reportStats_.bind(this), Math.floor(Math.random() * 2 * REPORT_STATS_INTERVAL));\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n *\r\n * @enum\r\n */\r\nvar OperationType;\r\n(function (OperationType) {\r\n    OperationType[OperationType[\"OVERWRITE\"] = 0] = \"OVERWRITE\";\r\n    OperationType[OperationType[\"MERGE\"] = 1] = \"MERGE\";\r\n    OperationType[OperationType[\"ACK_USER_WRITE\"] = 2] = \"ACK_USER_WRITE\";\r\n    OperationType[OperationType[\"LISTEN_COMPLETE\"] = 3] = \"LISTEN_COMPLETE\";\r\n})(OperationType || (OperationType = {}));\r\nfunction newOperationSourceUser() {\r\n    return {\r\n        fromUser: true,\r\n        fromServer: false,\r\n        queryId: null,\r\n        tagged: false\r\n    };\r\n}\r\nfunction newOperationSourceServer() {\r\n    return {\r\n        fromUser: false,\r\n        fromServer: true,\r\n        queryId: null,\r\n        tagged: false\r\n    };\r\n}\r\nfunction newOperationSourceServerTaggedQuery(queryId) {\r\n    return {\r\n        fromUser: false,\r\n        fromServer: true,\r\n        queryId,\r\n        tagged: true\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass AckUserWrite {\r\n    /**\r\n     * @param affectedTree - A tree containing true for each affected path. Affected paths can't overlap.\r\n     */\r\n    constructor(\r\n    /** @inheritDoc */ path, \r\n    /** @inheritDoc */ affectedTree, \r\n    /** @inheritDoc */ revert) {\r\n        this.path = path;\r\n        this.affectedTree = affectedTree;\r\n        this.revert = revert;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.ACK_USER_WRITE;\r\n        /** @inheritDoc */\r\n        this.source = newOperationSourceUser();\r\n    }\r\n    operationForChild(childName) {\r\n        if (!pathIsEmpty(this.path)) {\r\n            assert(pathGetFront(this.path) === childName, 'operationForChild called for unrelated child.');\r\n            return new AckUserWrite(pathPopFront(this.path), this.affectedTree, this.revert);\r\n        }\r\n        else if (this.affectedTree.value != null) {\r\n            assert(this.affectedTree.children.isEmpty(), 'affectedTree should not have overlapping affected paths.');\r\n            // All child locations are affected as well; just return same operation.\r\n            return this;\r\n        }\r\n        else {\r\n            const childTree = this.affectedTree.subtree(new Path(childName));\r\n            return new AckUserWrite(newEmptyPath(), childTree, this.revert);\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass ListenComplete {\r\n    constructor(source, path) {\r\n        this.source = source;\r\n        this.path = path;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.LISTEN_COMPLETE;\r\n    }\r\n    operationForChild(childName) {\r\n        if (pathIsEmpty(this.path)) {\r\n            return new ListenComplete(this.source, newEmptyPath());\r\n        }\r\n        else {\r\n            return new ListenComplete(this.source, pathPopFront(this.path));\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass Overwrite {\r\n    constructor(source, path, snap) {\r\n        this.source = source;\r\n        this.path = path;\r\n        this.snap = snap;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.OVERWRITE;\r\n    }\r\n    operationForChild(childName) {\r\n        if (pathIsEmpty(this.path)) {\r\n            return new Overwrite(this.source, newEmptyPath(), this.snap.getImmediateChild(childName));\r\n        }\r\n        else {\r\n            return new Overwrite(this.source, pathPopFront(this.path), this.snap);\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass Merge {\r\n    constructor(\r\n    /** @inheritDoc */ source, \r\n    /** @inheritDoc */ path, \r\n    /** @inheritDoc */ children) {\r\n        this.source = source;\r\n        this.path = path;\r\n        this.children = children;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.MERGE;\r\n    }\r\n    operationForChild(childName) {\r\n        if (pathIsEmpty(this.path)) {\r\n            const childTree = this.children.subtree(new Path(childName));\r\n            if (childTree.isEmpty()) {\r\n                // This child is unaffected\r\n                return null;\r\n            }\r\n            else if (childTree.value) {\r\n                // We have a snapshot for the child in question.  This becomes an overwrite of the child.\r\n                return new Overwrite(this.source, newEmptyPath(), childTree.value);\r\n            }\r\n            else {\r\n                // This is a merge at a deeper level\r\n                return new Merge(this.source, newEmptyPath(), childTree);\r\n            }\r\n        }\r\n        else {\r\n            assert(pathGetFront(this.path) === childName, \"Can't get a merge for a child not on the path of the operation\");\r\n            return new Merge(this.source, pathPopFront(this.path), this.children);\r\n        }\r\n    }\r\n    toString() {\r\n        return ('Operation(' +\r\n            this.path +\r\n            ': ' +\r\n            this.source.toString() +\r\n            ' merge: ' +\r\n            this.children.toString() +\r\n            ')');\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A cache node only stores complete children. Additionally it holds a flag whether the node can be considered fully\r\n * initialized in the sense that we know at one point in time this represented a valid state of the world, e.g.\r\n * initialized with data from the server, or a complete overwrite by the client. The filtered flag also tracks\r\n * whether a node potentially had children removed due to a filter.\r\n */\r\nclass CacheNode {\r\n    constructor(node_, fullyInitialized_, filtered_) {\r\n        this.node_ = node_;\r\n        this.fullyInitialized_ = fullyInitialized_;\r\n        this.filtered_ = filtered_;\r\n    }\r\n    /**\r\n     * Returns whether this node was fully initialized with either server data or a complete overwrite by the client\r\n     */\r\n    isFullyInitialized() {\r\n        return this.fullyInitialized_;\r\n    }\r\n    /**\r\n     * Returns whether this node is potentially missing children due to a filter applied to the node\r\n     */\r\n    isFiltered() {\r\n        return this.filtered_;\r\n    }\r\n    isCompleteForPath(path) {\r\n        if (pathIsEmpty(path)) {\r\n            return this.isFullyInitialized() && !this.filtered_;\r\n        }\r\n        const childKey = pathGetFront(path);\r\n        return this.isCompleteForChild(childKey);\r\n    }\r\n    isCompleteForChild(key) {\r\n        return ((this.isFullyInitialized() && !this.filtered_) || this.node_.hasChild(key));\r\n    }\r\n    getNode() {\r\n        return this.node_;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An EventGenerator is used to convert \"raw\" changes (Change) as computed by the\r\n * CacheDiffer into actual events (Event) that can be raised.  See generateEventsForChanges()\r\n * for details.\r\n *\r\n */\r\nclass EventGenerator {\r\n    constructor(query_) {\r\n        this.query_ = query_;\r\n        this.index_ = this.query_._queryParams.getIndex();\r\n    }\r\n}\r\n/**\r\n * Given a set of raw changes (no moved events and prevName not specified yet), and a set of\r\n * EventRegistrations that should be notified of these changes, generate the actual events to be raised.\r\n *\r\n * Notes:\r\n *  - child_moved events will be synthesized at this time for any child_changed events that affect\r\n *    our index.\r\n *  - prevName will be calculated based on the index ordering.\r\n */\r\nfunction eventGeneratorGenerateEventsForChanges(eventGenerator, changes, eventCache, eventRegistrations) {\r\n    const events = [];\r\n    const moves = [];\r\n    changes.forEach(change => {\r\n        if (change.type === \"child_changed\" /* ChangeType.CHILD_CHANGED */ &&\r\n            eventGenerator.index_.indexedValueChanged(change.oldSnap, change.snapshotNode)) {\r\n            moves.push(changeChildMoved(change.childName, change.snapshotNode));\r\n        }\r\n    });\r\n    eventGeneratorGenerateEventsForType(eventGenerator, events, \"child_removed\" /* ChangeType.CHILD_REMOVED */, changes, eventRegistrations, eventCache);\r\n    eventGeneratorGenerateEventsForType(eventGenerator, events, \"child_added\" /* ChangeType.CHILD_ADDED */, changes, eventRegistrations, eventCache);\r\n    eventGeneratorGenerateEventsForType(eventGenerator, events, \"child_moved\" /* ChangeType.CHILD_MOVED */, moves, eventRegistrations, eventCache);\r\n    eventGeneratorGenerateEventsForType(eventGenerator, events, \"child_changed\" /* ChangeType.CHILD_CHANGED */, changes, eventRegistrations, eventCache);\r\n    eventGeneratorGenerateEventsForType(eventGenerator, events, \"value\" /* ChangeType.VALUE */, changes, eventRegistrations, eventCache);\r\n    return events;\r\n}\r\n/**\r\n * Given changes of a single change type, generate the corresponding events.\r\n */\r\nfunction eventGeneratorGenerateEventsForType(eventGenerator, events, eventType, changes, registrations, eventCache) {\r\n    const filteredChanges = changes.filter(change => change.type === eventType);\r\n    filteredChanges.sort((a, b) => eventGeneratorCompareChanges(eventGenerator, a, b));\r\n    filteredChanges.forEach(change => {\r\n        const materializedChange = eventGeneratorMaterializeSingleChange(eventGenerator, change, eventCache);\r\n        registrations.forEach(registration => {\r\n            if (registration.respondsTo(change.type)) {\r\n                events.push(registration.createEvent(materializedChange, eventGenerator.query_));\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction eventGeneratorMaterializeSingleChange(eventGenerator, change, eventCache) {\r\n    if (change.type === 'value' || change.type === 'child_removed') {\r\n        return change;\r\n    }\r\n    else {\r\n        change.prevName = eventCache.getPredecessorChildName(change.childName, change.snapshotNode, eventGenerator.index_);\r\n        return change;\r\n    }\r\n}\r\nfunction eventGeneratorCompareChanges(eventGenerator, a, b) {\r\n    if (a.childName == null || b.childName == null) {\r\n        throw assertionError('Should only compare child_ events.');\r\n    }\r\n    const aWrapped = new NamedNode(a.childName, a.snapshotNode);\r\n    const bWrapped = new NamedNode(b.childName, b.snapshotNode);\r\n    return eventGenerator.index_.compare(aWrapped, bWrapped);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction newViewCache(eventCache, serverCache) {\r\n    return { eventCache, serverCache };\r\n}\r\nfunction viewCacheUpdateEventSnap(viewCache, eventSnap, complete, filtered) {\r\n    return newViewCache(new CacheNode(eventSnap, complete, filtered), viewCache.serverCache);\r\n}\r\nfunction viewCacheUpdateServerSnap(viewCache, serverSnap, complete, filtered) {\r\n    return newViewCache(viewCache.eventCache, new CacheNode(serverSnap, complete, filtered));\r\n}\r\nfunction viewCacheGetCompleteEventSnap(viewCache) {\r\n    return viewCache.eventCache.isFullyInitialized()\r\n        ? viewCache.eventCache.getNode()\r\n        : null;\r\n}\r\nfunction viewCacheGetCompleteServerSnap(viewCache) {\r\n    return viewCache.serverCache.isFullyInitialized()\r\n        ? viewCache.serverCache.getNode()\r\n        : null;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet emptyChildrenSingleton;\r\n/**\r\n * Singleton empty children collection.\r\n *\r\n */\r\nconst EmptyChildren = () => {\r\n    if (!emptyChildrenSingleton) {\r\n        emptyChildrenSingleton = new SortedMap(stringCompare);\r\n    }\r\n    return emptyChildrenSingleton;\r\n};\r\n/**\r\n * A tree with immutable elements.\r\n */\r\nclass ImmutableTree {\r\n    constructor(value, children = EmptyChildren()) {\r\n        this.value = value;\r\n        this.children = children;\r\n    }\r\n    static fromObject(obj) {\r\n        let tree = new ImmutableTree(null);\r\n        each(obj, (childPath, childSnap) => {\r\n            tree = tree.set(new Path(childPath), childSnap);\r\n        });\r\n        return tree;\r\n    }\r\n    /**\r\n     * True if the value is empty and there are no children\r\n     */\r\n    isEmpty() {\r\n        return this.value === null && this.children.isEmpty();\r\n    }\r\n    /**\r\n     * Given a path and predicate, return the first node and the path to that node\r\n     * where the predicate returns true.\r\n     *\r\n     * TODO Do a perf test -- If we're creating a bunch of `{path: value:}`\r\n     * objects on the way back out, it may be better to pass down a pathSoFar obj.\r\n     *\r\n     * @param relativePath - The remainder of the path\r\n     * @param predicate - The predicate to satisfy to return a node\r\n     */\r\n    findRootMostMatchingPathAndValue(relativePath, predicate) {\r\n        if (this.value != null && predicate(this.value)) {\r\n            return { path: newEmptyPath(), value: this.value };\r\n        }\r\n        else {\r\n            if (pathIsEmpty(relativePath)) {\r\n                return null;\r\n            }\r\n            else {\r\n                const front = pathGetFront(relativePath);\r\n                const child = this.children.get(front);\r\n                if (child !== null) {\r\n                    const childExistingPathAndValue = child.findRootMostMatchingPathAndValue(pathPopFront(relativePath), predicate);\r\n                    if (childExistingPathAndValue != null) {\r\n                        const fullPath = pathChild(new Path(front), childExistingPathAndValue.path);\r\n                        return { path: fullPath, value: childExistingPathAndValue.value };\r\n                    }\r\n                    else {\r\n                        return null;\r\n                    }\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Find, if it exists, the shortest subpath of the given path that points a defined\r\n     * value in the tree\r\n     */\r\n    findRootMostValueAndPath(relativePath) {\r\n        return this.findRootMostMatchingPathAndValue(relativePath, () => true);\r\n    }\r\n    /**\r\n     * @returns The subtree at the given path\r\n     */\r\n    subtree(relativePath) {\r\n        if (pathIsEmpty(relativePath)) {\r\n            return this;\r\n        }\r\n        else {\r\n            const front = pathGetFront(relativePath);\r\n            const childTree = this.children.get(front);\r\n            if (childTree !== null) {\r\n                return childTree.subtree(pathPopFront(relativePath));\r\n            }\r\n            else {\r\n                return new ImmutableTree(null);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Sets a value at the specified path.\r\n     *\r\n     * @param relativePath - Path to set value at.\r\n     * @param toSet - Value to set.\r\n     * @returns Resulting tree.\r\n     */\r\n    set(relativePath, toSet) {\r\n        if (pathIsEmpty(relativePath)) {\r\n            return new ImmutableTree(toSet, this.children);\r\n        }\r\n        else {\r\n            const front = pathGetFront(relativePath);\r\n            const child = this.children.get(front) || new ImmutableTree(null);\r\n            const newChild = child.set(pathPopFront(relativePath), toSet);\r\n            const newChildren = this.children.insert(front, newChild);\r\n            return new ImmutableTree(this.value, newChildren);\r\n        }\r\n    }\r\n    /**\r\n     * Removes the value at the specified path.\r\n     *\r\n     * @param relativePath - Path to value to remove.\r\n     * @returns Resulting tree.\r\n     */\r\n    remove(relativePath) {\r\n        if (pathIsEmpty(relativePath)) {\r\n            if (this.children.isEmpty()) {\r\n                return new ImmutableTree(null);\r\n            }\r\n            else {\r\n                return new ImmutableTree(null, this.children);\r\n            }\r\n        }\r\n        else {\r\n            const front = pathGetFront(relativePath);\r\n            const child = this.children.get(front);\r\n            if (child) {\r\n                const newChild = child.remove(pathPopFront(relativePath));\r\n                let newChildren;\r\n                if (newChild.isEmpty()) {\r\n                    newChildren = this.children.remove(front);\r\n                }\r\n                else {\r\n                    newChildren = this.children.insert(front, newChild);\r\n                }\r\n                if (this.value === null && newChildren.isEmpty()) {\r\n                    return new ImmutableTree(null);\r\n                }\r\n                else {\r\n                    return new ImmutableTree(this.value, newChildren);\r\n                }\r\n            }\r\n            else {\r\n                return this;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Gets a value from the tree.\r\n     *\r\n     * @param relativePath - Path to get value for.\r\n     * @returns Value at path, or null.\r\n     */\r\n    get(relativePath) {\r\n        if (pathIsEmpty(relativePath)) {\r\n            return this.value;\r\n        }\r\n        else {\r\n            const front = pathGetFront(relativePath);\r\n            const child = this.children.get(front);\r\n            if (child) {\r\n                return child.get(pathPopFront(relativePath));\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Replace the subtree at the specified path with the given new tree.\r\n     *\r\n     * @param relativePath - Path to replace subtree for.\r\n     * @param newTree - New tree.\r\n     * @returns Resulting tree.\r\n     */\r\n    setTree(relativePath, newTree) {\r\n        if (pathIsEmpty(relativePath)) {\r\n            return newTree;\r\n        }\r\n        else {\r\n            const front = pathGetFront(relativePath);\r\n            const child = this.children.get(front) || new ImmutableTree(null);\r\n            const newChild = child.setTree(pathPopFront(relativePath), newTree);\r\n            let newChildren;\r\n            if (newChild.isEmpty()) {\r\n                newChildren = this.children.remove(front);\r\n            }\r\n            else {\r\n                newChildren = this.children.insert(front, newChild);\r\n            }\r\n            return new ImmutableTree(this.value, newChildren);\r\n        }\r\n    }\r\n    /**\r\n     * Performs a depth first fold on this tree. Transforms a tree into a single\r\n     * value, given a function that operates on the path to a node, an optional\r\n     * current value, and a map of child names to folded subtrees\r\n     */\r\n    fold(fn) {\r\n        return this.fold_(newEmptyPath(), fn);\r\n    }\r\n    /**\r\n     * Recursive helper for public-facing fold() method\r\n     */\r\n    fold_(pathSoFar, fn) {\r\n        const accum = {};\r\n        this.children.inorderTraversal((childKey, childTree) => {\r\n            accum[childKey] = childTree.fold_(pathChild(pathSoFar, childKey), fn);\r\n        });\r\n        return fn(pathSoFar, this.value, accum);\r\n    }\r\n    /**\r\n     * Find the first matching value on the given path. Return the result of applying f to it.\r\n     */\r\n    findOnPath(path, f) {\r\n        return this.findOnPath_(path, newEmptyPath(), f);\r\n    }\r\n    findOnPath_(pathToFollow, pathSoFar, f) {\r\n        const result = this.value ? f(pathSoFar, this.value) : false;\r\n        if (result) {\r\n            return result;\r\n        }\r\n        else {\r\n            if (pathIsEmpty(pathToFollow)) {\r\n                return null;\r\n            }\r\n            else {\r\n                const front = pathGetFront(pathToFollow);\r\n                const nextChild = this.children.get(front);\r\n                if (nextChild) {\r\n                    return nextChild.findOnPath_(pathPopFront(pathToFollow), pathChild(pathSoFar, front), f);\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    foreachOnPath(path, f) {\r\n        return this.foreachOnPath_(path, newEmptyPath(), f);\r\n    }\r\n    foreachOnPath_(pathToFollow, currentRelativePath, f) {\r\n        if (pathIsEmpty(pathToFollow)) {\r\n            return this;\r\n        }\r\n        else {\r\n            if (this.value) {\r\n                f(currentRelativePath, this.value);\r\n            }\r\n            const front = pathGetFront(pathToFollow);\r\n            const nextChild = this.children.get(front);\r\n            if (nextChild) {\r\n                return nextChild.foreachOnPath_(pathPopFront(pathToFollow), pathChild(currentRelativePath, front), f);\r\n            }\r\n            else {\r\n                return new ImmutableTree(null);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Calls the given function for each node in the tree that has a value.\r\n     *\r\n     * @param f - A function to be called with the path from the root of the tree to\r\n     * a node, and the value at that node. Called in depth-first order.\r\n     */\r\n    foreach(f) {\r\n        this.foreach_(newEmptyPath(), f);\r\n    }\r\n    foreach_(currentRelativePath, f) {\r\n        this.children.inorderTraversal((childName, childTree) => {\r\n            childTree.foreach_(pathChild(currentRelativePath, childName), f);\r\n        });\r\n        if (this.value) {\r\n            f(currentRelativePath, this.value);\r\n        }\r\n    }\r\n    foreachChild(f) {\r\n        this.children.inorderTraversal((childName, childTree) => {\r\n            if (childTree.value) {\r\n                f(childName, childTree.value);\r\n            }\r\n        });\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This class holds a collection of writes that can be applied to nodes in unison. It abstracts away the logic with\r\n * dealing with priority writes and multiple nested writes. At any given path there is only allowed to be one write\r\n * modifying that path. Any write to an existing path or shadowing an existing path will modify that existing write\r\n * to reflect the write added.\r\n */\r\nclass CompoundWrite {\r\n    constructor(writeTree_) {\r\n        this.writeTree_ = writeTree_;\r\n    }\r\n    static empty() {\r\n        return new CompoundWrite(new ImmutableTree(null));\r\n    }\r\n}\r\nfunction compoundWriteAddWrite(compoundWrite, path, node) {\r\n    if (pathIsEmpty(path)) {\r\n        return new CompoundWrite(new ImmutableTree(node));\r\n    }\r\n    else {\r\n        const rootmost = compoundWrite.writeTree_.findRootMostValueAndPath(path);\r\n        if (rootmost != null) {\r\n            const rootMostPath = rootmost.path;\r\n            let value = rootmost.value;\r\n            const relativePath = newRelativePath(rootMostPath, path);\r\n            value = value.updateChild(relativePath, node);\r\n            return new CompoundWrite(compoundWrite.writeTree_.set(rootMostPath, value));\r\n        }\r\n        else {\r\n            const subtree = new ImmutableTree(node);\r\n            const newWriteTree = compoundWrite.writeTree_.setTree(path, subtree);\r\n            return new CompoundWrite(newWriteTree);\r\n        }\r\n    }\r\n}\r\nfunction compoundWriteAddWrites(compoundWrite, path, updates) {\r\n    let newWrite = compoundWrite;\r\n    each(updates, (childKey, node) => {\r\n        newWrite = compoundWriteAddWrite(newWrite, pathChild(path, childKey), node);\r\n    });\r\n    return newWrite;\r\n}\r\n/**\r\n * Will remove a write at the given path and deeper paths. This will <em>not</em> modify a write at a higher\r\n * location, which must be removed by calling this method with that path.\r\n *\r\n * @param compoundWrite - The CompoundWrite to remove.\r\n * @param path - The path at which a write and all deeper writes should be removed\r\n * @returns The new CompoundWrite with the removed path\r\n */\r\nfunction compoundWriteRemoveWrite(compoundWrite, path) {\r\n    if (pathIsEmpty(path)) {\r\n        return CompoundWrite.empty();\r\n    }\r\n    else {\r\n        const newWriteTree = compoundWrite.writeTree_.setTree(path, new ImmutableTree(null));\r\n        return new CompoundWrite(newWriteTree);\r\n    }\r\n}\r\n/**\r\n * Returns whether this CompoundWrite will fully overwrite a node at a given location and can therefore be\r\n * considered \"complete\".\r\n *\r\n * @param compoundWrite - The CompoundWrite to check.\r\n * @param path - The path to check for\r\n * @returns Whether there is a complete write at that path\r\n */\r\nfunction compoundWriteHasCompleteWrite(compoundWrite, path) {\r\n    return compoundWriteGetCompleteNode(compoundWrite, path) != null;\r\n}\r\n/**\r\n * Returns a node for a path if and only if the node is a \"complete\" overwrite at that path. This will not aggregate\r\n * writes from deeper paths, but will return child nodes from a more shallow path.\r\n *\r\n * @param compoundWrite - The CompoundWrite to get the node from.\r\n * @param path - The path to get a complete write\r\n * @returns The node if complete at that path, or null otherwise.\r\n */\r\nfunction compoundWriteGetCompleteNode(compoundWrite, path) {\r\n    const rootmost = compoundWrite.writeTree_.findRootMostValueAndPath(path);\r\n    if (rootmost != null) {\r\n        return compoundWrite.writeTree_\r\n            .get(rootmost.path)\r\n            .getChild(newRelativePath(rootmost.path, path));\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\r\n/**\r\n * Returns all children that are guaranteed to be a complete overwrite.\r\n *\r\n * @param compoundWrite - The CompoundWrite to get children from.\r\n * @returns A list of all complete children.\r\n */\r\nfunction compoundWriteGetCompleteChildren(compoundWrite) {\r\n    const children = [];\r\n    const node = compoundWrite.writeTree_.value;\r\n    if (node != null) {\r\n        // If it's a leaf node, it has no children; so nothing to do.\r\n        if (!node.isLeafNode()) {\r\n            node.forEachChild(PRIORITY_INDEX, (childName, childNode) => {\r\n                children.push(new NamedNode(childName, childNode));\r\n            });\r\n        }\r\n    }\r\n    else {\r\n        compoundWrite.writeTree_.children.inorderTraversal((childName, childTree) => {\r\n            if (childTree.value != null) {\r\n                children.push(new NamedNode(childName, childTree.value));\r\n            }\r\n        });\r\n    }\r\n    return children;\r\n}\r\nfunction compoundWriteChildCompoundWrite(compoundWrite, path) {\r\n    if (pathIsEmpty(path)) {\r\n        return compoundWrite;\r\n    }\r\n    else {\r\n        const shadowingNode = compoundWriteGetCompleteNode(compoundWrite, path);\r\n        if (shadowingNode != null) {\r\n            return new CompoundWrite(new ImmutableTree(shadowingNode));\r\n        }\r\n        else {\r\n            return new CompoundWrite(compoundWrite.writeTree_.subtree(path));\r\n        }\r\n    }\r\n}\r\n/**\r\n * Returns true if this CompoundWrite is empty and therefore does not modify any nodes.\r\n * @returns Whether this CompoundWrite is empty\r\n */\r\nfunction compoundWriteIsEmpty(compoundWrite) {\r\n    return compoundWrite.writeTree_.isEmpty();\r\n}\r\n/**\r\n * Applies this CompoundWrite to a node. The node is returned with all writes from this CompoundWrite applied to the\r\n * node\r\n * @param node - The node to apply this CompoundWrite to\r\n * @returns The node with all writes applied\r\n */\r\nfunction compoundWriteApply(compoundWrite, node) {\r\n    return applySubtreeWrite(newEmptyPath(), compoundWrite.writeTree_, node);\r\n}\r\nfunction applySubtreeWrite(relativePath, writeTree, node) {\r\n    if (writeTree.value != null) {\r\n        // Since there a write is always a leaf, we're done here\r\n        return node.updateChild(relativePath, writeTree.value);\r\n    }\r\n    else {\r\n        let priorityWrite = null;\r\n        writeTree.children.inorderTraversal((childKey, childTree) => {\r\n            if (childKey === '.priority') {\r\n                // Apply priorities at the end so we don't update priorities for either empty nodes or forget\r\n                // to apply priorities to empty nodes that are later filled\r\n                assert(childTree.value !== null, 'Priority writes must always be leaf nodes');\r\n                priorityWrite = childTree.value;\r\n            }\r\n            else {\r\n                node = applySubtreeWrite(pathChild(relativePath, childKey), childTree, node);\r\n            }\r\n        });\r\n        // If there was a priority write, we only apply it if the node is not empty\r\n        if (!node.getChild(relativePath).isEmpty() && priorityWrite !== null) {\r\n            node = node.updateChild(pathChild(relativePath, '.priority'), priorityWrite);\r\n        }\r\n        return node;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Create a new WriteTreeRef for the given path. For use with a new sync point at the given path.\r\n *\r\n */\r\nfunction writeTreeChildWrites(writeTree, path) {\r\n    return newWriteTreeRef(path, writeTree);\r\n}\r\n/**\r\n * Record a new overwrite from user code.\r\n *\r\n * @param visible - This is set to false by some transactions. It should be excluded from event caches\r\n */\r\nfunction writeTreeAddOverwrite(writeTree, path, snap, writeId, visible) {\r\n    assert(writeId > writeTree.lastWriteId, 'Stacking an older write on top of newer ones');\r\n    if (visible === undefined) {\r\n        visible = true;\r\n    }\r\n    writeTree.allWrites.push({\r\n        path,\r\n        snap,\r\n        writeId,\r\n        visible\r\n    });\r\n    if (visible) {\r\n        writeTree.visibleWrites = compoundWriteAddWrite(writeTree.visibleWrites, path, snap);\r\n    }\r\n    writeTree.lastWriteId = writeId;\r\n}\r\n/**\r\n * Record a new merge from user code.\r\n */\r\nfunction writeTreeAddMerge(writeTree, path, changedChildren, writeId) {\r\n    assert(writeId > writeTree.lastWriteId, 'Stacking an older merge on top of newer ones');\r\n    writeTree.allWrites.push({\r\n        path,\r\n        children: changedChildren,\r\n        writeId,\r\n        visible: true\r\n    });\r\n    writeTree.visibleWrites = compoundWriteAddWrites(writeTree.visibleWrites, path, changedChildren);\r\n    writeTree.lastWriteId = writeId;\r\n}\r\nfunction writeTreeGetWrite(writeTree, writeId) {\r\n    for (let i = 0; i < writeTree.allWrites.length; i++) {\r\n        const record = writeTree.allWrites[i];\r\n        if (record.writeId === writeId) {\r\n            return record;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n/**\r\n * Remove a write (either an overwrite or merge) that has been successfully acknowledge by the server. Recalculates\r\n * the tree if necessary.  We return true if it may have been visible, meaning views need to reevaluate.\r\n *\r\n * @returns true if the write may have been visible (meaning we'll need to reevaluate / raise\r\n * events as a result).\r\n */\r\nfunction writeTreeRemoveWrite(writeTree, writeId) {\r\n    // Note: disabling this check. It could be a transaction that preempted another transaction, and thus was applied\r\n    // out of order.\r\n    //const validClear = revert || this.allWrites_.length === 0 || writeId <= this.allWrites_[0].writeId;\r\n    //assert(validClear, \"Either we don't have this write, or it's the first one in the queue\");\r\n    const idx = writeTree.allWrites.findIndex(s => {\r\n        return s.writeId === writeId;\r\n    });\r\n    assert(idx >= 0, 'removeWrite called with nonexistent writeId.');\r\n    const writeToRemove = writeTree.allWrites[idx];\r\n    writeTree.allWrites.splice(idx, 1);\r\n    let removedWriteWasVisible = writeToRemove.visible;\r\n    let removedWriteOverlapsWithOtherWrites = false;\r\n    let i = writeTree.allWrites.length - 1;\r\n    while (removedWriteWasVisible && i >= 0) {\r\n        const currentWrite = writeTree.allWrites[i];\r\n        if (currentWrite.visible) {\r\n            if (i >= idx &&\r\n                writeTreeRecordContainsPath_(currentWrite, writeToRemove.path)) {\r\n                // The removed write was completely shadowed by a subsequent write.\r\n                removedWriteWasVisible = false;\r\n            }\r\n            else if (pathContains(writeToRemove.path, currentWrite.path)) {\r\n                // Either we're covering some writes or they're covering part of us (depending on which came first).\r\n                removedWriteOverlapsWithOtherWrites = true;\r\n            }\r\n        }\r\n        i--;\r\n    }\r\n    if (!removedWriteWasVisible) {\r\n        return false;\r\n    }\r\n    else if (removedWriteOverlapsWithOtherWrites) {\r\n        // There's some shadowing going on. Just rebuild the visible writes from scratch.\r\n        writeTreeResetTree_(writeTree);\r\n        return true;\r\n    }\r\n    else {\r\n        // There's no shadowing.  We can safely just remove the write(s) from visibleWrites.\r\n        if (writeToRemove.snap) {\r\n            writeTree.visibleWrites = compoundWriteRemoveWrite(writeTree.visibleWrites, writeToRemove.path);\r\n        }\r\n        else {\r\n            const children = writeToRemove.children;\r\n            each(children, (childName) => {\r\n                writeTree.visibleWrites = compoundWriteRemoveWrite(writeTree.visibleWrites, pathChild(writeToRemove.path, childName));\r\n            });\r\n        }\r\n        return true;\r\n    }\r\n}\r\nfunction writeTreeRecordContainsPath_(writeRecord, path) {\r\n    if (writeRecord.snap) {\r\n        return pathContains(writeRecord.path, path);\r\n    }\r\n    else {\r\n        for (const childName in writeRecord.children) {\r\n            if (writeRecord.children.hasOwnProperty(childName) &&\r\n                pathContains(pathChild(writeRecord.path, childName), path)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}\r\n/**\r\n * Re-layer the writes and merges into a tree so we can efficiently calculate event snapshots\r\n */\r\nfunction writeTreeResetTree_(writeTree) {\r\n    writeTree.visibleWrites = writeTreeLayerTree_(writeTree.allWrites, writeTreeDefaultFilter_, newEmptyPath());\r\n    if (writeTree.allWrites.length > 0) {\r\n        writeTree.lastWriteId =\r\n            writeTree.allWrites[writeTree.allWrites.length - 1].writeId;\r\n    }\r\n    else {\r\n        writeTree.lastWriteId = -1;\r\n    }\r\n}\r\n/**\r\n * The default filter used when constructing the tree. Keep everything that's visible.\r\n */\r\nfunction writeTreeDefaultFilter_(write) {\r\n    return write.visible;\r\n}\r\n/**\r\n * Static method. Given an array of WriteRecords, a filter for which ones to include, and a path, construct the tree of\r\n * event data at that path.\r\n */\r\nfunction writeTreeLayerTree_(writes, filter, treeRoot) {\r\n    let compoundWrite = CompoundWrite.empty();\r\n    for (let i = 0; i < writes.length; ++i) {\r\n        const write = writes[i];\r\n        // Theory, a later set will either:\r\n        // a) abort a relevant transaction, so no need to worry about excluding it from calculating that transaction\r\n        // b) not be relevant to a transaction (separate branch), so again will not affect the data for that transaction\r\n        if (filter(write)) {\r\n            const writePath = write.path;\r\n            let relativePath;\r\n            if (write.snap) {\r\n                if (pathContains(treeRoot, writePath)) {\r\n                    relativePath = newRelativePath(treeRoot, writePath);\r\n                    compoundWrite = compoundWriteAddWrite(compoundWrite, relativePath, write.snap);\r\n                }\r\n                else if (pathContains(writePath, treeRoot)) {\r\n                    relativePath = newRelativePath(writePath, treeRoot);\r\n                    compoundWrite = compoundWriteAddWrite(compoundWrite, newEmptyPath(), write.snap.getChild(relativePath));\r\n                }\r\n                else ;\r\n            }\r\n            else if (write.children) {\r\n                if (pathContains(treeRoot, writePath)) {\r\n                    relativePath = newRelativePath(treeRoot, writePath);\r\n                    compoundWrite = compoundWriteAddWrites(compoundWrite, relativePath, write.children);\r\n                }\r\n                else if (pathContains(writePath, treeRoot)) {\r\n                    relativePath = newRelativePath(writePath, treeRoot);\r\n                    if (pathIsEmpty(relativePath)) {\r\n                        compoundWrite = compoundWriteAddWrites(compoundWrite, newEmptyPath(), write.children);\r\n                    }\r\n                    else {\r\n                        const child = safeGet(write.children, pathGetFront(relativePath));\r\n                        if (child) {\r\n                            // There exists a child in this node that matches the root path\r\n                            const deepNode = child.getChild(pathPopFront(relativePath));\r\n                            compoundWrite = compoundWriteAddWrite(compoundWrite, newEmptyPath(), deepNode);\r\n                        }\r\n                    }\r\n                }\r\n                else ;\r\n            }\r\n            else {\r\n                throw assertionError('WriteRecord should have .snap or .children');\r\n            }\r\n        }\r\n    }\r\n    return compoundWrite;\r\n}\r\n/**\r\n * Given optional, underlying server data, and an optional set of constraints (exclude some sets, include hidden\r\n * writes), attempt to calculate a complete snapshot for the given path\r\n *\r\n * @param writeIdsToExclude - An optional set to be excluded\r\n * @param includeHiddenWrites - Defaults to false, whether or not to layer on writes with visible set to false\r\n */\r\nfunction writeTreeCalcCompleteEventCache(writeTree, treePath, completeServerCache, writeIdsToExclude, includeHiddenWrites) {\r\n    if (!writeIdsToExclude && !includeHiddenWrites) {\r\n        const shadowingNode = compoundWriteGetCompleteNode(writeTree.visibleWrites, treePath);\r\n        if (shadowingNode != null) {\r\n            return shadowingNode;\r\n        }\r\n        else {\r\n            const subMerge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);\r\n            if (compoundWriteIsEmpty(subMerge)) {\r\n                return completeServerCache;\r\n            }\r\n            else if (completeServerCache == null &&\r\n                !compoundWriteHasCompleteWrite(subMerge, newEmptyPath())) {\r\n                // We wouldn't have a complete snapshot, since there's no underlying data and no complete shadow\r\n                return null;\r\n            }\r\n            else {\r\n                const layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;\r\n                return compoundWriteApply(subMerge, layeredCache);\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        const merge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);\r\n        if (!includeHiddenWrites && compoundWriteIsEmpty(merge)) {\r\n            return completeServerCache;\r\n        }\r\n        else {\r\n            // If the server cache is null, and we don't have a complete cache, we need to return null\r\n            if (!includeHiddenWrites &&\r\n                completeServerCache == null &&\r\n                !compoundWriteHasCompleteWrite(merge, newEmptyPath())) {\r\n                return null;\r\n            }\r\n            else {\r\n                const filter = function (write) {\r\n                    return ((write.visible || includeHiddenWrites) &&\r\n                        (!writeIdsToExclude ||\r\n                            !~writeIdsToExclude.indexOf(write.writeId)) &&\r\n                        (pathContains(write.path, treePath) ||\r\n                            pathContains(treePath, write.path)));\r\n                };\r\n                const mergeAtPath = writeTreeLayerTree_(writeTree.allWrites, filter, treePath);\r\n                const layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;\r\n                return compoundWriteApply(mergeAtPath, layeredCache);\r\n            }\r\n        }\r\n    }\r\n}\r\n/**\r\n * With optional, underlying server data, attempt to return a children node of children that we have complete data for.\r\n * Used when creating new views, to pre-fill their complete event children snapshot.\r\n */\r\nfunction writeTreeCalcCompleteEventChildren(writeTree, treePath, completeServerChildren) {\r\n    let completeChildren = ChildrenNode.EMPTY_NODE;\r\n    const topLevelSet = compoundWriteGetCompleteNode(writeTree.visibleWrites, treePath);\r\n    if (topLevelSet) {\r\n        if (!topLevelSet.isLeafNode()) {\r\n            // we're shadowing everything. Return the children.\r\n            topLevelSet.forEachChild(PRIORITY_INDEX, (childName, childSnap) => {\r\n                completeChildren = completeChildren.updateImmediateChild(childName, childSnap);\r\n            });\r\n        }\r\n        return completeChildren;\r\n    }\r\n    else if (completeServerChildren) {\r\n        // Layer any children we have on top of this\r\n        // We know we don't have a top-level set, so just enumerate existing children\r\n        const merge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);\r\n        completeServerChildren.forEachChild(PRIORITY_INDEX, (childName, childNode) => {\r\n            const node = compoundWriteApply(compoundWriteChildCompoundWrite(merge, new Path(childName)), childNode);\r\n            completeChildren = completeChildren.updateImmediateChild(childName, node);\r\n        });\r\n        // Add any complete children we have from the set\r\n        compoundWriteGetCompleteChildren(merge).forEach(namedNode => {\r\n            completeChildren = completeChildren.updateImmediateChild(namedNode.name, namedNode.node);\r\n        });\r\n        return completeChildren;\r\n    }\r\n    else {\r\n        // We don't have anything to layer on top of. Layer on any children we have\r\n        // Note that we can return an empty snap if we have a defined delete\r\n        const merge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);\r\n        compoundWriteGetCompleteChildren(merge).forEach(namedNode => {\r\n            completeChildren = completeChildren.updateImmediateChild(namedNode.name, namedNode.node);\r\n        });\r\n        return completeChildren;\r\n    }\r\n}\r\n/**\r\n * Given that the underlying server data has updated, determine what, if anything, needs to be\r\n * applied to the event cache.\r\n *\r\n * Possibilities:\r\n *\r\n * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\r\n *\r\n * 2. Some write is completely shadowing. No events to be raised\r\n *\r\n * 3. Is partially shadowed. Events\r\n *\r\n * Either existingEventSnap or existingServerSnap must exist\r\n */\r\nfunction writeTreeCalcEventCacheAfterServerOverwrite(writeTree, treePath, childPath, existingEventSnap, existingServerSnap) {\r\n    assert(existingEventSnap || existingServerSnap, 'Either existingEventSnap or existingServerSnap must exist');\r\n    const path = pathChild(treePath, childPath);\r\n    if (compoundWriteHasCompleteWrite(writeTree.visibleWrites, path)) {\r\n        // At this point we can probably guarantee that we're in case 2, meaning no events\r\n        // May need to check visibility while doing the findRootMostValueAndPath call\r\n        return null;\r\n    }\r\n    else {\r\n        // No complete shadowing. We're either partially shadowing or not shadowing at all.\r\n        const childMerge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, path);\r\n        if (compoundWriteIsEmpty(childMerge)) {\r\n            // We're not shadowing at all. Case 1\r\n            return existingServerSnap.getChild(childPath);\r\n        }\r\n        else {\r\n            // This could be more efficient if the serverNode + updates doesn't change the eventSnap\r\n            // However this is tricky to find out, since user updates don't necessary change the server\r\n            // snap, e.g. priority updates on empty nodes, or deep deletes. Another special case is if the server\r\n            // adds nodes, but doesn't change any existing writes. It is therefore not enough to\r\n            // only check if the updates change the serverNode.\r\n            // Maybe check if the merge tree contains these special cases and only do a full overwrite in that case?\r\n            return compoundWriteApply(childMerge, existingServerSnap.getChild(childPath));\r\n        }\r\n    }\r\n}\r\n/**\r\n * Returns a complete child for a given server snap after applying all user writes or null if there is no\r\n * complete child for this ChildKey.\r\n */\r\nfunction writeTreeCalcCompleteChild(writeTree, treePath, childKey, existingServerSnap) {\r\n    const path = pathChild(treePath, childKey);\r\n    const shadowingNode = compoundWriteGetCompleteNode(writeTree.visibleWrites, path);\r\n    if (shadowingNode != null) {\r\n        return shadowingNode;\r\n    }\r\n    else {\r\n        if (existingServerSnap.isCompleteForChild(childKey)) {\r\n            const childMerge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, path);\r\n            return compoundWriteApply(childMerge, existingServerSnap.getNode().getImmediateChild(childKey));\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n}\r\n/**\r\n * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\r\n * a higher path, this will return the child of that write relative to the write and this path.\r\n * Returns null if there is no write at this path.\r\n */\r\nfunction writeTreeShadowingWrite(writeTree, path) {\r\n    return compoundWriteGetCompleteNode(writeTree.visibleWrites, path);\r\n}\r\n/**\r\n * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\r\n * the window, but may now be in the window.\r\n */\r\nfunction writeTreeCalcIndexedSlice(writeTree, treePath, completeServerData, startPost, count, reverse, index) {\r\n    let toIterate;\r\n    const merge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);\r\n    const shadowingNode = compoundWriteGetCompleteNode(merge, newEmptyPath());\r\n    if (shadowingNode != null) {\r\n        toIterate = shadowingNode;\r\n    }\r\n    else if (completeServerData != null) {\r\n        toIterate = compoundWriteApply(merge, completeServerData);\r\n    }\r\n    else {\r\n        // no children to iterate on\r\n        return [];\r\n    }\r\n    toIterate = toIterate.withIndex(index);\r\n    if (!toIterate.isEmpty() && !toIterate.isLeafNode()) {\r\n        const nodes = [];\r\n        const cmp = index.getCompare();\r\n        const iter = reverse\r\n            ? toIterate.getReverseIteratorFrom(startPost, index)\r\n            : toIterate.getIteratorFrom(startPost, index);\r\n        let next = iter.getNext();\r\n        while (next && nodes.length < count) {\r\n            if (cmp(next, startPost) !== 0) {\r\n                nodes.push(next);\r\n            }\r\n            next = iter.getNext();\r\n        }\r\n        return nodes;\r\n    }\r\n    else {\r\n        return [];\r\n    }\r\n}\r\nfunction newWriteTree() {\r\n    return {\r\n        visibleWrites: CompoundWrite.empty(),\r\n        allWrites: [],\r\n        lastWriteId: -1\r\n    };\r\n}\r\n/**\r\n * If possible, returns a complete event cache, using the underlying server data if possible. In addition, can be used\r\n * to get a cache that includes hidden writes, and excludes arbitrary writes. Note that customizing the returned node\r\n * can lead to a more expensive calculation.\r\n *\r\n * @param writeIdsToExclude - Optional writes to exclude.\r\n * @param includeHiddenWrites - Defaults to false, whether or not to layer on writes with visible set to false\r\n */\r\nfunction writeTreeRefCalcCompleteEventCache(writeTreeRef, completeServerCache, writeIdsToExclude, includeHiddenWrites) {\r\n    return writeTreeCalcCompleteEventCache(writeTreeRef.writeTree, writeTreeRef.treePath, completeServerCache, writeIdsToExclude, includeHiddenWrites);\r\n}\r\n/**\r\n * If possible, returns a children node containing all of the complete children we have data for. The returned data is a\r\n * mix of the given server data and write data.\r\n *\r\n */\r\nfunction writeTreeRefCalcCompleteEventChildren(writeTreeRef, completeServerChildren) {\r\n    return writeTreeCalcCompleteEventChildren(writeTreeRef.writeTree, writeTreeRef.treePath, completeServerChildren);\r\n}\r\n/**\r\n * Given that either the underlying server data has updated or the outstanding writes have updated, determine what,\r\n * if anything, needs to be applied to the event cache.\r\n *\r\n * Possibilities:\r\n *\r\n * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\r\n *\r\n * 2. Some write is completely shadowing. No events to be raised\r\n *\r\n * 3. Is partially shadowed. Events should be raised\r\n *\r\n * Either existingEventSnap or existingServerSnap must exist, this is validated via an assert\r\n *\r\n *\r\n */\r\nfunction writeTreeRefCalcEventCacheAfterServerOverwrite(writeTreeRef, path, existingEventSnap, existingServerSnap) {\r\n    return writeTreeCalcEventCacheAfterServerOverwrite(writeTreeRef.writeTree, writeTreeRef.treePath, path, existingEventSnap, existingServerSnap);\r\n}\r\n/**\r\n * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\r\n * a higher path, this will return the child of that write relative to the write and this path.\r\n * Returns null if there is no write at this path.\r\n *\r\n */\r\nfunction writeTreeRefShadowingWrite(writeTreeRef, path) {\r\n    return writeTreeShadowingWrite(writeTreeRef.writeTree, pathChild(writeTreeRef.treePath, path));\r\n}\r\n/**\r\n * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\r\n * the window, but may now be in the window\r\n */\r\nfunction writeTreeRefCalcIndexedSlice(writeTreeRef, completeServerData, startPost, count, reverse, index) {\r\n    return writeTreeCalcIndexedSlice(writeTreeRef.writeTree, writeTreeRef.treePath, completeServerData, startPost, count, reverse, index);\r\n}\r\n/**\r\n * Returns a complete child for a given server snap after applying all user writes or null if there is no\r\n * complete child for this ChildKey.\r\n */\r\nfunction writeTreeRefCalcCompleteChild(writeTreeRef, childKey, existingServerCache) {\r\n    return writeTreeCalcCompleteChild(writeTreeRef.writeTree, writeTreeRef.treePath, childKey, existingServerCache);\r\n}\r\n/**\r\n * Return a WriteTreeRef for a child.\r\n */\r\nfunction writeTreeRefChild(writeTreeRef, childName) {\r\n    return newWriteTreeRef(pathChild(writeTreeRef.treePath, childName), writeTreeRef.writeTree);\r\n}\r\nfunction newWriteTreeRef(path, writeTree) {\r\n    return {\r\n        treePath: path,\r\n        writeTree\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass ChildChangeAccumulator {\r\n    constructor() {\r\n        this.changeMap = new Map();\r\n    }\r\n    trackChildChange(change) {\r\n        const type = change.type;\r\n        const childKey = change.childName;\r\n        assert(type === \"child_added\" /* ChangeType.CHILD_ADDED */ ||\r\n            type === \"child_changed\" /* ChangeType.CHILD_CHANGED */ ||\r\n            type === \"child_removed\" /* ChangeType.CHILD_REMOVED */, 'Only child changes supported for tracking');\r\n        assert(childKey !== '.priority', 'Only non-priority child changes can be tracked.');\r\n        const oldChange = this.changeMap.get(childKey);\r\n        if (oldChange) {\r\n            const oldType = oldChange.type;\r\n            if (type === \"child_added\" /* ChangeType.CHILD_ADDED */ &&\r\n                oldType === \"child_removed\" /* ChangeType.CHILD_REMOVED */) {\r\n                this.changeMap.set(childKey, changeChildChanged(childKey, change.snapshotNode, oldChange.snapshotNode));\r\n            }\r\n            else if (type === \"child_removed\" /* ChangeType.CHILD_REMOVED */ &&\r\n                oldType === \"child_added\" /* ChangeType.CHILD_ADDED */) {\r\n                this.changeMap.delete(childKey);\r\n            }\r\n            else if (type === \"child_removed\" /* ChangeType.CHILD_REMOVED */ &&\r\n                oldType === \"child_changed\" /* ChangeType.CHILD_CHANGED */) {\r\n                this.changeMap.set(childKey, changeChildRemoved(childKey, oldChange.oldSnap));\r\n            }\r\n            else if (type === \"child_changed\" /* ChangeType.CHILD_CHANGED */ &&\r\n                oldType === \"child_added\" /* ChangeType.CHILD_ADDED */) {\r\n                this.changeMap.set(childKey, changeChildAdded(childKey, change.snapshotNode));\r\n            }\r\n            else if (type === \"child_changed\" /* ChangeType.CHILD_CHANGED */ &&\r\n                oldType === \"child_changed\" /* ChangeType.CHILD_CHANGED */) {\r\n                this.changeMap.set(childKey, changeChildChanged(childKey, change.snapshotNode, oldChange.oldSnap));\r\n            }\r\n            else {\r\n                throw assertionError('Illegal combination of changes: ' +\r\n                    change +\r\n                    ' occurred after ' +\r\n                    oldChange);\r\n            }\r\n        }\r\n        else {\r\n            this.changeMap.set(childKey, change);\r\n        }\r\n    }\r\n    getChanges() {\r\n        return Array.from(this.changeMap.values());\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An implementation of CompleteChildSource that never returns any additional children\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nclass NoCompleteChildSource_ {\r\n    getCompleteChild(childKey) {\r\n        return null;\r\n    }\r\n    getChildAfterChild(index, child, reverse) {\r\n        return null;\r\n    }\r\n}\r\n/**\r\n * Singleton instance.\r\n */\r\nconst NO_COMPLETE_CHILD_SOURCE = new NoCompleteChildSource_();\r\n/**\r\n * An implementation of CompleteChildSource that uses a WriteTree in addition to any other server data or\r\n * old event caches available to calculate complete children.\r\n */\r\nclass WriteTreeCompleteChildSource {\r\n    constructor(writes_, viewCache_, optCompleteServerCache_ = null) {\r\n        this.writes_ = writes_;\r\n        this.viewCache_ = viewCache_;\r\n        this.optCompleteServerCache_ = optCompleteServerCache_;\r\n    }\r\n    getCompleteChild(childKey) {\r\n        const node = this.viewCache_.eventCache;\r\n        if (node.isCompleteForChild(childKey)) {\r\n            return node.getNode().getImmediateChild(childKey);\r\n        }\r\n        else {\r\n            const serverNode = this.optCompleteServerCache_ != null\r\n                ? new CacheNode(this.optCompleteServerCache_, true, false)\r\n                : this.viewCache_.serverCache;\r\n            return writeTreeRefCalcCompleteChild(this.writes_, childKey, serverNode);\r\n        }\r\n    }\r\n    getChildAfterChild(index, child, reverse) {\r\n        const completeServerData = this.optCompleteServerCache_ != null\r\n            ? this.optCompleteServerCache_\r\n            : viewCacheGetCompleteServerSnap(this.viewCache_);\r\n        const nodes = writeTreeRefCalcIndexedSlice(this.writes_, completeServerData, child, 1, reverse, index);\r\n        if (nodes.length === 0) {\r\n            return null;\r\n        }\r\n        else {\r\n            return nodes[0];\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction newViewProcessor(filter) {\r\n    return { filter };\r\n}\r\nfunction viewProcessorAssertIndexed(viewProcessor, viewCache) {\r\n    assert(viewCache.eventCache.getNode().isIndexed(viewProcessor.filter.getIndex()), 'Event snap not indexed');\r\n    assert(viewCache.serverCache.getNode().isIndexed(viewProcessor.filter.getIndex()), 'Server snap not indexed');\r\n}\r\nfunction viewProcessorApplyOperation(viewProcessor, oldViewCache, operation, writesCache, completeCache) {\r\n    const accumulator = new ChildChangeAccumulator();\r\n    let newViewCache, filterServerNode;\r\n    if (operation.type === OperationType.OVERWRITE) {\r\n        const overwrite = operation;\r\n        if (overwrite.source.fromUser) {\r\n            newViewCache = viewProcessorApplyUserOverwrite(viewProcessor, oldViewCache, overwrite.path, overwrite.snap, writesCache, completeCache, accumulator);\r\n        }\r\n        else {\r\n            assert(overwrite.source.fromServer, 'Unknown source.');\r\n            // We filter the node if it's a tagged update or the node has been previously filtered  and the\r\n            // update is not at the root in which case it is ok (and necessary) to mark the node unfiltered\r\n            // again\r\n            filterServerNode =\r\n                overwrite.source.tagged ||\r\n                    (oldViewCache.serverCache.isFiltered() && !pathIsEmpty(overwrite.path));\r\n            newViewCache = viewProcessorApplyServerOverwrite(viewProcessor, oldViewCache, overwrite.path, overwrite.snap, writesCache, completeCache, filterServerNode, accumulator);\r\n        }\r\n    }\r\n    else if (operation.type === OperationType.MERGE) {\r\n        const merge = operation;\r\n        if (merge.source.fromUser) {\r\n            newViewCache = viewProcessorApplyUserMerge(viewProcessor, oldViewCache, merge.path, merge.children, writesCache, completeCache, accumulator);\r\n        }\r\n        else {\r\n            assert(merge.source.fromServer, 'Unknown source.');\r\n            // We filter the node if it's a tagged update or the node has been previously filtered\r\n            filterServerNode =\r\n                merge.source.tagged || oldViewCache.serverCache.isFiltered();\r\n            newViewCache = viewProcessorApplyServerMerge(viewProcessor, oldViewCache, merge.path, merge.children, writesCache, completeCache, filterServerNode, accumulator);\r\n        }\r\n    }\r\n    else if (operation.type === OperationType.ACK_USER_WRITE) {\r\n        const ackUserWrite = operation;\r\n        if (!ackUserWrite.revert) {\r\n            newViewCache = viewProcessorAckUserWrite(viewProcessor, oldViewCache, ackUserWrite.path, ackUserWrite.affectedTree, writesCache, completeCache, accumulator);\r\n        }\r\n        else {\r\n            newViewCache = viewProcessorRevertUserWrite(viewProcessor, oldViewCache, ackUserWrite.path, writesCache, completeCache, accumulator);\r\n        }\r\n    }\r\n    else if (operation.type === OperationType.LISTEN_COMPLETE) {\r\n        newViewCache = viewProcessorListenComplete(viewProcessor, oldViewCache, operation.path, writesCache, accumulator);\r\n    }\r\n    else {\r\n        throw assertionError('Unknown operation type: ' + operation.type);\r\n    }\r\n    const changes = accumulator.getChanges();\r\n    viewProcessorMaybeAddValueEvent(oldViewCache, newViewCache, changes);\r\n    return { viewCache: newViewCache, changes };\r\n}\r\nfunction viewProcessorMaybeAddValueEvent(oldViewCache, newViewCache, accumulator) {\r\n    const eventSnap = newViewCache.eventCache;\r\n    if (eventSnap.isFullyInitialized()) {\r\n        const isLeafOrEmpty = eventSnap.getNode().isLeafNode() || eventSnap.getNode().isEmpty();\r\n        const oldCompleteSnap = viewCacheGetCompleteEventSnap(oldViewCache);\r\n        if (accumulator.length > 0 ||\r\n            !oldViewCache.eventCache.isFullyInitialized() ||\r\n            (isLeafOrEmpty && !eventSnap.getNode().equals(oldCompleteSnap)) ||\r\n            !eventSnap.getNode().getPriority().equals(oldCompleteSnap.getPriority())) {\r\n            accumulator.push(changeValue(viewCacheGetCompleteEventSnap(newViewCache)));\r\n        }\r\n    }\r\n}\r\nfunction viewProcessorGenerateEventCacheAfterServerEvent(viewProcessor, viewCache, changePath, writesCache, source, accumulator) {\r\n    const oldEventSnap = viewCache.eventCache;\r\n    if (writeTreeRefShadowingWrite(writesCache, changePath) != null) {\r\n        // we have a shadowing write, ignore changes\r\n        return viewCache;\r\n    }\r\n    else {\r\n        let newEventCache, serverNode;\r\n        if (pathIsEmpty(changePath)) {\r\n            // TODO: figure out how this plays with \"sliding ack windows\"\r\n            assert(viewCache.serverCache.isFullyInitialized(), 'If change path is empty, we must have complete server data');\r\n            if (viewCache.serverCache.isFiltered()) {\r\n                // We need to special case this, because we need to only apply writes to complete children, or\r\n                // we might end up raising events for incomplete children. If the server data is filtered deep\r\n                // writes cannot be guaranteed to be complete\r\n                const serverCache = viewCacheGetCompleteServerSnap(viewCache);\r\n                const completeChildren = serverCache instanceof ChildrenNode\r\n                    ? serverCache\r\n                    : ChildrenNode.EMPTY_NODE;\r\n                const completeEventChildren = writeTreeRefCalcCompleteEventChildren(writesCache, completeChildren);\r\n                newEventCache = viewProcessor.filter.updateFullNode(viewCache.eventCache.getNode(), completeEventChildren, accumulator);\r\n            }\r\n            else {\r\n                const completeNode = writeTreeRefCalcCompleteEventCache(writesCache, viewCacheGetCompleteServerSnap(viewCache));\r\n                newEventCache = viewProcessor.filter.updateFullNode(viewCache.eventCache.getNode(), completeNode, accumulator);\r\n            }\r\n        }\r\n        else {\r\n            const childKey = pathGetFront(changePath);\r\n            if (childKey === '.priority') {\r\n                assert(pathGetLength(changePath) === 1, \"Can't have a priority with additional path components\");\r\n                const oldEventNode = oldEventSnap.getNode();\r\n                serverNode = viewCache.serverCache.getNode();\r\n                // we might have overwrites for this priority\r\n                const updatedPriority = writeTreeRefCalcEventCacheAfterServerOverwrite(writesCache, changePath, oldEventNode, serverNode);\r\n                if (updatedPriority != null) {\r\n                    newEventCache = viewProcessor.filter.updatePriority(oldEventNode, updatedPriority);\r\n                }\r\n                else {\r\n                    // priority didn't change, keep old node\r\n                    newEventCache = oldEventSnap.getNode();\r\n                }\r\n            }\r\n            else {\r\n                const childChangePath = pathPopFront(changePath);\r\n                // update child\r\n                let newEventChild;\r\n                if (oldEventSnap.isCompleteForChild(childKey)) {\r\n                    serverNode = viewCache.serverCache.getNode();\r\n                    const eventChildUpdate = writeTreeRefCalcEventCacheAfterServerOverwrite(writesCache, changePath, oldEventSnap.getNode(), serverNode);\r\n                    if (eventChildUpdate != null) {\r\n                        newEventChild = oldEventSnap\r\n                            .getNode()\r\n                            .getImmediateChild(childKey)\r\n                            .updateChild(childChangePath, eventChildUpdate);\r\n                    }\r\n                    else {\r\n                        // Nothing changed, just keep the old child\r\n                        newEventChild = oldEventSnap.getNode().getImmediateChild(childKey);\r\n                    }\r\n                }\r\n                else {\r\n                    newEventChild = writeTreeRefCalcCompleteChild(writesCache, childKey, viewCache.serverCache);\r\n                }\r\n                if (newEventChild != null) {\r\n                    newEventCache = viewProcessor.filter.updateChild(oldEventSnap.getNode(), childKey, newEventChild, childChangePath, source, accumulator);\r\n                }\r\n                else {\r\n                    // no complete child available or no change\r\n                    newEventCache = oldEventSnap.getNode();\r\n                }\r\n            }\r\n        }\r\n        return viewCacheUpdateEventSnap(viewCache, newEventCache, oldEventSnap.isFullyInitialized() || pathIsEmpty(changePath), viewProcessor.filter.filtersNodes());\r\n    }\r\n}\r\nfunction viewProcessorApplyServerOverwrite(viewProcessor, oldViewCache, changePath, changedSnap, writesCache, completeCache, filterServerNode, accumulator) {\r\n    const oldServerSnap = oldViewCache.serverCache;\r\n    let newServerCache;\r\n    const serverFilter = filterServerNode\r\n        ? viewProcessor.filter\r\n        : viewProcessor.filter.getIndexedFilter();\r\n    if (pathIsEmpty(changePath)) {\r\n        newServerCache = serverFilter.updateFullNode(oldServerSnap.getNode(), changedSnap, null);\r\n    }\r\n    else if (serverFilter.filtersNodes() && !oldServerSnap.isFiltered()) {\r\n        // we want to filter the server node, but we didn't filter the server node yet, so simulate a full update\r\n        const newServerNode = oldServerSnap\r\n            .getNode()\r\n            .updateChild(changePath, changedSnap);\r\n        newServerCache = serverFilter.updateFullNode(oldServerSnap.getNode(), newServerNode, null);\r\n    }\r\n    else {\r\n        const childKey = pathGetFront(changePath);\r\n        if (!oldServerSnap.isCompleteForPath(changePath) &&\r\n            pathGetLength(changePath) > 1) {\r\n            // We don't update incomplete nodes with updates intended for other listeners\r\n            return oldViewCache;\r\n        }\r\n        const childChangePath = pathPopFront(changePath);\r\n        const childNode = oldServerSnap.getNode().getImmediateChild(childKey);\r\n        const newChildNode = childNode.updateChild(childChangePath, changedSnap);\r\n        if (childKey === '.priority') {\r\n            newServerCache = serverFilter.updatePriority(oldServerSnap.getNode(), newChildNode);\r\n        }\r\n        else {\r\n            newServerCache = serverFilter.updateChild(oldServerSnap.getNode(), childKey, newChildNode, childChangePath, NO_COMPLETE_CHILD_SOURCE, null);\r\n        }\r\n    }\r\n    const newViewCache = viewCacheUpdateServerSnap(oldViewCache, newServerCache, oldServerSnap.isFullyInitialized() || pathIsEmpty(changePath), serverFilter.filtersNodes());\r\n    const source = new WriteTreeCompleteChildSource(writesCache, newViewCache, completeCache);\r\n    return viewProcessorGenerateEventCacheAfterServerEvent(viewProcessor, newViewCache, changePath, writesCache, source, accumulator);\r\n}\r\nfunction viewProcessorApplyUserOverwrite(viewProcessor, oldViewCache, changePath, changedSnap, writesCache, completeCache, accumulator) {\r\n    const oldEventSnap = oldViewCache.eventCache;\r\n    let newViewCache, newEventCache;\r\n    const source = new WriteTreeCompleteChildSource(writesCache, oldViewCache, completeCache);\r\n    if (pathIsEmpty(changePath)) {\r\n        newEventCache = viewProcessor.filter.updateFullNode(oldViewCache.eventCache.getNode(), changedSnap, accumulator);\r\n        newViewCache = viewCacheUpdateEventSnap(oldViewCache, newEventCache, true, viewProcessor.filter.filtersNodes());\r\n    }\r\n    else {\r\n        const childKey = pathGetFront(changePath);\r\n        if (childKey === '.priority') {\r\n            newEventCache = viewProcessor.filter.updatePriority(oldViewCache.eventCache.getNode(), changedSnap);\r\n            newViewCache = viewCacheUpdateEventSnap(oldViewCache, newEventCache, oldEventSnap.isFullyInitialized(), oldEventSnap.isFiltered());\r\n        }\r\n        else {\r\n            const childChangePath = pathPopFront(changePath);\r\n            const oldChild = oldEventSnap.getNode().getImmediateChild(childKey);\r\n            let newChild;\r\n            if (pathIsEmpty(childChangePath)) {\r\n                // Child overwrite, we can replace the child\r\n                newChild = changedSnap;\r\n            }\r\n            else {\r\n                const childNode = source.getCompleteChild(childKey);\r\n                if (childNode != null) {\r\n                    if (pathGetBack(childChangePath) === '.priority' &&\r\n                        childNode.getChild(pathParent(childChangePath)).isEmpty()) {\r\n                        // This is a priority update on an empty node. If this node exists on the server, the\r\n                        // server will send down the priority in the update, so ignore for now\r\n                        newChild = childNode;\r\n                    }\r\n                    else {\r\n                        newChild = childNode.updateChild(childChangePath, changedSnap);\r\n                    }\r\n                }\r\n                else {\r\n                    // There is no complete child node available\r\n                    newChild = ChildrenNode.EMPTY_NODE;\r\n                }\r\n            }\r\n            if (!oldChild.equals(newChild)) {\r\n                const newEventSnap = viewProcessor.filter.updateChild(oldEventSnap.getNode(), childKey, newChild, childChangePath, source, accumulator);\r\n                newViewCache = viewCacheUpdateEventSnap(oldViewCache, newEventSnap, oldEventSnap.isFullyInitialized(), viewProcessor.filter.filtersNodes());\r\n            }\r\n            else {\r\n                newViewCache = oldViewCache;\r\n            }\r\n        }\r\n    }\r\n    return newViewCache;\r\n}\r\nfunction viewProcessorCacheHasChild(viewCache, childKey) {\r\n    return viewCache.eventCache.isCompleteForChild(childKey);\r\n}\r\nfunction viewProcessorApplyUserMerge(viewProcessor, viewCache, path, changedChildren, writesCache, serverCache, accumulator) {\r\n    // HACK: In the case of a limit query, there may be some changes that bump things out of the\r\n    // window leaving room for new items.  It's important we process these changes first, so we\r\n    // iterate the changes twice, first processing any that affect items currently in view.\r\n    // TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\r\n    // and event snap.  I'm not sure if this will result in edge cases when a child is in one but\r\n    // not the other.\r\n    let curViewCache = viewCache;\r\n    changedChildren.foreach((relativePath, childNode) => {\r\n        const writePath = pathChild(path, relativePath);\r\n        if (viewProcessorCacheHasChild(viewCache, pathGetFront(writePath))) {\r\n            curViewCache = viewProcessorApplyUserOverwrite(viewProcessor, curViewCache, writePath, childNode, writesCache, serverCache, accumulator);\r\n        }\r\n    });\r\n    changedChildren.foreach((relativePath, childNode) => {\r\n        const writePath = pathChild(path, relativePath);\r\n        if (!viewProcessorCacheHasChild(viewCache, pathGetFront(writePath))) {\r\n            curViewCache = viewProcessorApplyUserOverwrite(viewProcessor, curViewCache, writePath, childNode, writesCache, serverCache, accumulator);\r\n        }\r\n    });\r\n    return curViewCache;\r\n}\r\nfunction viewProcessorApplyMerge(viewProcessor, node, merge) {\r\n    merge.foreach((relativePath, childNode) => {\r\n        node = node.updateChild(relativePath, childNode);\r\n    });\r\n    return node;\r\n}\r\nfunction viewProcessorApplyServerMerge(viewProcessor, viewCache, path, changedChildren, writesCache, serverCache, filterServerNode, accumulator) {\r\n    // If we don't have a cache yet, this merge was intended for a previously listen in the same location. Ignore it and\r\n    // wait for the complete data update coming soon.\r\n    if (viewCache.serverCache.getNode().isEmpty() &&\r\n        !viewCache.serverCache.isFullyInitialized()) {\r\n        return viewCache;\r\n    }\r\n    // HACK: In the case of a limit query, there may be some changes that bump things out of the\r\n    // window leaving room for new items.  It's important we process these changes first, so we\r\n    // iterate the changes twice, first processing any that affect items currently in view.\r\n    // TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\r\n    // and event snap.  I'm not sure if this will result in edge cases when a child is in one but\r\n    // not the other.\r\n    let curViewCache = viewCache;\r\n    let viewMergeTree;\r\n    if (pathIsEmpty(path)) {\r\n        viewMergeTree = changedChildren;\r\n    }\r\n    else {\r\n        viewMergeTree = new ImmutableTree(null).setTree(path, changedChildren);\r\n    }\r\n    const serverNode = viewCache.serverCache.getNode();\r\n    viewMergeTree.children.inorderTraversal((childKey, childTree) => {\r\n        if (serverNode.hasChild(childKey)) {\r\n            const serverChild = viewCache.serverCache\r\n                .getNode()\r\n                .getImmediateChild(childKey);\r\n            const newChild = viewProcessorApplyMerge(viewProcessor, serverChild, childTree);\r\n            curViewCache = viewProcessorApplyServerOverwrite(viewProcessor, curViewCache, new Path(childKey), newChild, writesCache, serverCache, filterServerNode, accumulator);\r\n        }\r\n    });\r\n    viewMergeTree.children.inorderTraversal((childKey, childMergeTree) => {\r\n        const isUnknownDeepMerge = !viewCache.serverCache.isCompleteForChild(childKey) &&\r\n            childMergeTree.value === null;\r\n        if (!serverNode.hasChild(childKey) && !isUnknownDeepMerge) {\r\n            const serverChild = viewCache.serverCache\r\n                .getNode()\r\n                .getImmediateChild(childKey);\r\n            const newChild = viewProcessorApplyMerge(viewProcessor, serverChild, childMergeTree);\r\n            curViewCache = viewProcessorApplyServerOverwrite(viewProcessor, curViewCache, new Path(childKey), newChild, writesCache, serverCache, filterServerNode, accumulator);\r\n        }\r\n    });\r\n    return curViewCache;\r\n}\r\nfunction viewProcessorAckUserWrite(viewProcessor, viewCache, ackPath, affectedTree, writesCache, completeCache, accumulator) {\r\n    if (writeTreeRefShadowingWrite(writesCache, ackPath) != null) {\r\n        return viewCache;\r\n    }\r\n    // Only filter server node if it is currently filtered\r\n    const filterServerNode = viewCache.serverCache.isFiltered();\r\n    // Essentially we'll just get our existing server cache for the affected paths and re-apply it as a server update\r\n    // now that it won't be shadowed.\r\n    const serverCache = viewCache.serverCache;\r\n    if (affectedTree.value != null) {\r\n        // This is an overwrite.\r\n        if ((pathIsEmpty(ackPath) && serverCache.isFullyInitialized()) ||\r\n            serverCache.isCompleteForPath(ackPath)) {\r\n            return viewProcessorApplyServerOverwrite(viewProcessor, viewCache, ackPath, serverCache.getNode().getChild(ackPath), writesCache, completeCache, filterServerNode, accumulator);\r\n        }\r\n        else if (pathIsEmpty(ackPath)) {\r\n            // This is a goofy edge case where we are acking data at this location but don't have full data.  We\r\n            // should just re-apply whatever we have in our cache as a merge.\r\n            let changedChildren = new ImmutableTree(null);\r\n            serverCache.getNode().forEachChild(KEY_INDEX, (name, node) => {\r\n                changedChildren = changedChildren.set(new Path(name), node);\r\n            });\r\n            return viewProcessorApplyServerMerge(viewProcessor, viewCache, ackPath, changedChildren, writesCache, completeCache, filterServerNode, accumulator);\r\n        }\r\n        else {\r\n            return viewCache;\r\n        }\r\n    }\r\n    else {\r\n        // This is a merge.\r\n        let changedChildren = new ImmutableTree(null);\r\n        affectedTree.foreach((mergePath, value) => {\r\n            const serverCachePath = pathChild(ackPath, mergePath);\r\n            if (serverCache.isCompleteForPath(serverCachePath)) {\r\n                changedChildren = changedChildren.set(mergePath, serverCache.getNode().getChild(serverCachePath));\r\n            }\r\n        });\r\n        return viewProcessorApplyServerMerge(viewProcessor, viewCache, ackPath, changedChildren, writesCache, completeCache, filterServerNode, accumulator);\r\n    }\r\n}\r\nfunction viewProcessorListenComplete(viewProcessor, viewCache, path, writesCache, accumulator) {\r\n    const oldServerNode = viewCache.serverCache;\r\n    const newViewCache = viewCacheUpdateServerSnap(viewCache, oldServerNode.getNode(), oldServerNode.isFullyInitialized() || pathIsEmpty(path), oldServerNode.isFiltered());\r\n    return viewProcessorGenerateEventCacheAfterServerEvent(viewProcessor, newViewCache, path, writesCache, NO_COMPLETE_CHILD_SOURCE, accumulator);\r\n}\r\nfunction viewProcessorRevertUserWrite(viewProcessor, viewCache, path, writesCache, completeServerCache, accumulator) {\r\n    let complete;\r\n    if (writeTreeRefShadowingWrite(writesCache, path) != null) {\r\n        return viewCache;\r\n    }\r\n    else {\r\n        const source = new WriteTreeCompleteChildSource(writesCache, viewCache, completeServerCache);\r\n        const oldEventCache = viewCache.eventCache.getNode();\r\n        let newEventCache;\r\n        if (pathIsEmpty(path) || pathGetFront(path) === '.priority') {\r\n            let newNode;\r\n            if (viewCache.serverCache.isFullyInitialized()) {\r\n                newNode = writeTreeRefCalcCompleteEventCache(writesCache, viewCacheGetCompleteServerSnap(viewCache));\r\n            }\r\n            else {\r\n                const serverChildren = viewCache.serverCache.getNode();\r\n                assert(serverChildren instanceof ChildrenNode, 'serverChildren would be complete if leaf node');\r\n                newNode = writeTreeRefCalcCompleteEventChildren(writesCache, serverChildren);\r\n            }\r\n            newNode = newNode;\r\n            newEventCache = viewProcessor.filter.updateFullNode(oldEventCache, newNode, accumulator);\r\n        }\r\n        else {\r\n            const childKey = pathGetFront(path);\r\n            let newChild = writeTreeRefCalcCompleteChild(writesCache, childKey, viewCache.serverCache);\r\n            if (newChild == null &&\r\n                viewCache.serverCache.isCompleteForChild(childKey)) {\r\n                newChild = oldEventCache.getImmediateChild(childKey);\r\n            }\r\n            if (newChild != null) {\r\n                newEventCache = viewProcessor.filter.updateChild(oldEventCache, childKey, newChild, pathPopFront(path), source, accumulator);\r\n            }\r\n            else if (viewCache.eventCache.getNode().hasChild(childKey)) {\r\n                // No complete child available, delete the existing one, if any\r\n                newEventCache = viewProcessor.filter.updateChild(oldEventCache, childKey, ChildrenNode.EMPTY_NODE, pathPopFront(path), source, accumulator);\r\n            }\r\n            else {\r\n                newEventCache = oldEventCache;\r\n            }\r\n            if (newEventCache.isEmpty() &&\r\n                viewCache.serverCache.isFullyInitialized()) {\r\n                // We might have reverted all child writes. Maybe the old event was a leaf node\r\n                complete = writeTreeRefCalcCompleteEventCache(writesCache, viewCacheGetCompleteServerSnap(viewCache));\r\n                if (complete.isLeafNode()) {\r\n                    newEventCache = viewProcessor.filter.updateFullNode(newEventCache, complete, accumulator);\r\n                }\r\n            }\r\n        }\r\n        complete =\r\n            viewCache.serverCache.isFullyInitialized() ||\r\n                writeTreeRefShadowingWrite(writesCache, newEmptyPath()) != null;\r\n        return viewCacheUpdateEventSnap(viewCache, newEventCache, complete, viewProcessor.filter.filtersNodes());\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A view represents a specific location and query that has 1 or more event registrations.\r\n *\r\n * It does several things:\r\n *  - Maintains the list of event registrations for this location/query.\r\n *  - Maintains a cache of the data visible for this location/query.\r\n *  - Applies new operations (via applyOperation), updates the cache, and based on the event\r\n *    registrations returns the set of events to be raised.\r\n */\r\nclass View {\r\n    constructor(query_, initialViewCache) {\r\n        this.query_ = query_;\r\n        this.eventRegistrations_ = [];\r\n        const params = this.query_._queryParams;\r\n        const indexFilter = new IndexedFilter(params.getIndex());\r\n        const filter = queryParamsGetNodeFilter(params);\r\n        this.processor_ = newViewProcessor(filter);\r\n        const initialServerCache = initialViewCache.serverCache;\r\n        const initialEventCache = initialViewCache.eventCache;\r\n        // Don't filter server node with other filter than index, wait for tagged listen\r\n        const serverSnap = indexFilter.updateFullNode(ChildrenNode.EMPTY_NODE, initialServerCache.getNode(), null);\r\n        const eventSnap = filter.updateFullNode(ChildrenNode.EMPTY_NODE, initialEventCache.getNode(), null);\r\n        const newServerCache = new CacheNode(serverSnap, initialServerCache.isFullyInitialized(), indexFilter.filtersNodes());\r\n        const newEventCache = new CacheNode(eventSnap, initialEventCache.isFullyInitialized(), filter.filtersNodes());\r\n        this.viewCache_ = newViewCache(newEventCache, newServerCache);\r\n        this.eventGenerator_ = new EventGenerator(this.query_);\r\n    }\r\n    get query() {\r\n        return this.query_;\r\n    }\r\n}\r\nfunction viewGetServerCache(view) {\r\n    return view.viewCache_.serverCache.getNode();\r\n}\r\nfunction viewGetCompleteNode(view) {\r\n    return viewCacheGetCompleteEventSnap(view.viewCache_);\r\n}\r\nfunction viewGetCompleteServerCache(view, path) {\r\n    const cache = viewCacheGetCompleteServerSnap(view.viewCache_);\r\n    if (cache) {\r\n        // If this isn't a \"loadsAllData\" view, then cache isn't actually a complete cache and\r\n        // we need to see if it contains the child we're interested in.\r\n        if (view.query._queryParams.loadsAllData() ||\r\n            (!pathIsEmpty(path) &&\r\n                !cache.getImmediateChild(pathGetFront(path)).isEmpty())) {\r\n            return cache.getChild(path);\r\n        }\r\n    }\r\n    return null;\r\n}\r\nfunction viewIsEmpty(view) {\r\n    return view.eventRegistrations_.length === 0;\r\n}\r\nfunction viewAddEventRegistration(view, eventRegistration) {\r\n    view.eventRegistrations_.push(eventRegistration);\r\n}\r\n/**\r\n * @param eventRegistration - If null, remove all callbacks.\r\n * @param cancelError - If a cancelError is provided, appropriate cancel events will be returned.\r\n * @returns Cancel events, if cancelError was provided.\r\n */\r\nfunction viewRemoveEventRegistration(view, eventRegistration, cancelError) {\r\n    const cancelEvents = [];\r\n    if (cancelError) {\r\n        assert(eventRegistration == null, 'A cancel should cancel all event registrations.');\r\n        const path = view.query._path;\r\n        view.eventRegistrations_.forEach(registration => {\r\n            const maybeEvent = registration.createCancelEvent(cancelError, path);\r\n            if (maybeEvent) {\r\n                cancelEvents.push(maybeEvent);\r\n            }\r\n        });\r\n    }\r\n    if (eventRegistration) {\r\n        let remaining = [];\r\n        for (let i = 0; i < view.eventRegistrations_.length; ++i) {\r\n            const existing = view.eventRegistrations_[i];\r\n            if (!existing.matches(eventRegistration)) {\r\n                remaining.push(existing);\r\n            }\r\n            else if (eventRegistration.hasAnyCallback()) {\r\n                // We're removing just this one\r\n                remaining = remaining.concat(view.eventRegistrations_.slice(i + 1));\r\n                break;\r\n            }\r\n        }\r\n        view.eventRegistrations_ = remaining;\r\n    }\r\n    else {\r\n        view.eventRegistrations_ = [];\r\n    }\r\n    return cancelEvents;\r\n}\r\n/**\r\n * Applies the given Operation, updates our cache, and returns the appropriate events.\r\n */\r\nfunction viewApplyOperation(view, operation, writesCache, completeServerCache) {\r\n    if (operation.type === OperationType.MERGE &&\r\n        operation.source.queryId !== null) {\r\n        assert(viewCacheGetCompleteServerSnap(view.viewCache_), 'We should always have a full cache before handling merges');\r\n        assert(viewCacheGetCompleteEventSnap(view.viewCache_), 'Missing event cache, even though we have a server cache');\r\n    }\r\n    const oldViewCache = view.viewCache_;\r\n    const result = viewProcessorApplyOperation(view.processor_, oldViewCache, operation, writesCache, completeServerCache);\r\n    viewProcessorAssertIndexed(view.processor_, result.viewCache);\r\n    assert(result.viewCache.serverCache.isFullyInitialized() ||\r\n        !oldViewCache.serverCache.isFullyInitialized(), 'Once a server snap is complete, it should never go back');\r\n    view.viewCache_ = result.viewCache;\r\n    return viewGenerateEventsForChanges_(view, result.changes, result.viewCache.eventCache.getNode(), null);\r\n}\r\nfunction viewGetInitialEvents(view, registration) {\r\n    const eventSnap = view.viewCache_.eventCache;\r\n    const initialChanges = [];\r\n    if (!eventSnap.getNode().isLeafNode()) {\r\n        const eventNode = eventSnap.getNode();\r\n        eventNode.forEachChild(PRIORITY_INDEX, (key, childNode) => {\r\n            initialChanges.push(changeChildAdded(key, childNode));\r\n        });\r\n    }\r\n    if (eventSnap.isFullyInitialized()) {\r\n        initialChanges.push(changeValue(eventSnap.getNode()));\r\n    }\r\n    return viewGenerateEventsForChanges_(view, initialChanges, eventSnap.getNode(), registration);\r\n}\r\nfunction viewGenerateEventsForChanges_(view, changes, eventCache, eventRegistration) {\r\n    const registrations = eventRegistration\r\n        ? [eventRegistration]\r\n        : view.eventRegistrations_;\r\n    return eventGeneratorGenerateEventsForChanges(view.eventGenerator_, changes, eventCache, registrations);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet referenceConstructor$1;\r\n/**\r\n * SyncPoint represents a single location in a SyncTree with 1 or more event registrations, meaning we need to\r\n * maintain 1 or more Views at this location to cache server data and raise appropriate events for server changes\r\n * and user writes (set, transaction, update).\r\n *\r\n * It's responsible for:\r\n *  - Maintaining the set of 1 or more views necessary at this location (a SyncPoint with 0 views should be removed).\r\n *  - Proxying user / server operations to the views as appropriate (i.e. applyServerOverwrite,\r\n *    applyUserOverwrite, etc.)\r\n */\r\nclass SyncPoint {\r\n    constructor() {\r\n        /**\r\n         * The Views being tracked at this location in the tree, stored as a map where the key is a\r\n         * queryId and the value is the View for that query.\r\n         *\r\n         * NOTE: This list will be quite small (usually 1, but perhaps 2 or 3; any more is an odd use case).\r\n         */\r\n        this.views = new Map();\r\n    }\r\n}\r\nfunction syncPointSetReferenceConstructor(val) {\r\n    assert(!referenceConstructor$1, '__referenceConstructor has already been defined');\r\n    referenceConstructor$1 = val;\r\n}\r\nfunction syncPointGetReferenceConstructor() {\r\n    assert(referenceConstructor$1, 'Reference.ts has not been loaded');\r\n    return referenceConstructor$1;\r\n}\r\nfunction syncPointIsEmpty(syncPoint) {\r\n    return syncPoint.views.size === 0;\r\n}\r\nfunction syncPointApplyOperation(syncPoint, operation, writesCache, optCompleteServerCache) {\r\n    const queryId = operation.source.queryId;\r\n    if (queryId !== null) {\r\n        const view = syncPoint.views.get(queryId);\r\n        assert(view != null, 'SyncTree gave us an op for an invalid query.');\r\n        return viewApplyOperation(view, operation, writesCache, optCompleteServerCache);\r\n    }\r\n    else {\r\n        let events = [];\r\n        for (const view of syncPoint.views.values()) {\r\n            events = events.concat(viewApplyOperation(view, operation, writesCache, optCompleteServerCache));\r\n        }\r\n        return events;\r\n    }\r\n}\r\n/**\r\n * Get a view for the specified query.\r\n *\r\n * @param query - The query to return a view for\r\n * @param writesCache\r\n * @param serverCache\r\n * @param serverCacheComplete\r\n * @returns Events to raise.\r\n */\r\nfunction syncPointGetView(syncPoint, query, writesCache, serverCache, serverCacheComplete) {\r\n    const queryId = query._queryIdentifier;\r\n    const view = syncPoint.views.get(queryId);\r\n    if (!view) {\r\n        // TODO: make writesCache take flag for complete server node\r\n        let eventCache = writeTreeRefCalcCompleteEventCache(writesCache, serverCacheComplete ? serverCache : null);\r\n        let eventCacheComplete = false;\r\n        if (eventCache) {\r\n            eventCacheComplete = true;\r\n        }\r\n        else if (serverCache instanceof ChildrenNode) {\r\n            eventCache = writeTreeRefCalcCompleteEventChildren(writesCache, serverCache);\r\n            eventCacheComplete = false;\r\n        }\r\n        else {\r\n            eventCache = ChildrenNode.EMPTY_NODE;\r\n            eventCacheComplete = false;\r\n        }\r\n        const viewCache = newViewCache(new CacheNode(eventCache, eventCacheComplete, false), new CacheNode(serverCache, serverCacheComplete, false));\r\n        return new View(query, viewCache);\r\n    }\r\n    return view;\r\n}\r\n/**\r\n * Add an event callback for the specified query.\r\n *\r\n * @param query\r\n * @param eventRegistration\r\n * @param writesCache\r\n * @param serverCache - Complete server cache, if we have it.\r\n * @param serverCacheComplete\r\n * @returns Events to raise.\r\n */\r\nfunction syncPointAddEventRegistration(syncPoint, query, eventRegistration, writesCache, serverCache, serverCacheComplete) {\r\n    const view = syncPointGetView(syncPoint, query, writesCache, serverCache, serverCacheComplete);\r\n    if (!syncPoint.views.has(query._queryIdentifier)) {\r\n        syncPoint.views.set(query._queryIdentifier, view);\r\n    }\r\n    // This is guaranteed to exist now, we just created anything that was missing\r\n    viewAddEventRegistration(view, eventRegistration);\r\n    return viewGetInitialEvents(view, eventRegistration);\r\n}\r\n/**\r\n * Remove event callback(s).  Return cancelEvents if a cancelError is specified.\r\n *\r\n * If query is the default query, we'll check all views for the specified eventRegistration.\r\n * If eventRegistration is null, we'll remove all callbacks for the specified view(s).\r\n *\r\n * @param eventRegistration - If null, remove all callbacks.\r\n * @param cancelError - If a cancelError is provided, appropriate cancel events will be returned.\r\n * @returns removed queries and any cancel events\r\n */\r\nfunction syncPointRemoveEventRegistration(syncPoint, query, eventRegistration, cancelError) {\r\n    const queryId = query._queryIdentifier;\r\n    const removed = [];\r\n    let cancelEvents = [];\r\n    const hadCompleteView = syncPointHasCompleteView(syncPoint);\r\n    if (queryId === 'default') {\r\n        // When you do ref.off(...), we search all views for the registration to remove.\r\n        for (const [viewQueryId, view] of syncPoint.views.entries()) {\r\n            cancelEvents = cancelEvents.concat(viewRemoveEventRegistration(view, eventRegistration, cancelError));\r\n            if (viewIsEmpty(view)) {\r\n                syncPoint.views.delete(viewQueryId);\r\n                // We'll deal with complete views later.\r\n                if (!view.query._queryParams.loadsAllData()) {\r\n                    removed.push(view.query);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        // remove the callback from the specific view.\r\n        const view = syncPoint.views.get(queryId);\r\n        if (view) {\r\n            cancelEvents = cancelEvents.concat(viewRemoveEventRegistration(view, eventRegistration, cancelError));\r\n            if (viewIsEmpty(view)) {\r\n                syncPoint.views.delete(queryId);\r\n                // We'll deal with complete views later.\r\n                if (!view.query._queryParams.loadsAllData()) {\r\n                    removed.push(view.query);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (hadCompleteView && !syncPointHasCompleteView(syncPoint)) {\r\n        // We removed our last complete view.\r\n        removed.push(new (syncPointGetReferenceConstructor())(query._repo, query._path));\r\n    }\r\n    return { removed, events: cancelEvents };\r\n}\r\nfunction syncPointGetQueryViews(syncPoint) {\r\n    const result = [];\r\n    for (const view of syncPoint.views.values()) {\r\n        if (!view.query._queryParams.loadsAllData()) {\r\n            result.push(view);\r\n        }\r\n    }\r\n    return result;\r\n}\r\n/**\r\n * @param path - The path to the desired complete snapshot\r\n * @returns A complete cache, if it exists\r\n */\r\nfunction syncPointGetCompleteServerCache(syncPoint, path) {\r\n    let serverCache = null;\r\n    for (const view of syncPoint.views.values()) {\r\n        serverCache = serverCache || viewGetCompleteServerCache(view, path);\r\n    }\r\n    return serverCache;\r\n}\r\nfunction syncPointViewForQuery(syncPoint, query) {\r\n    const params = query._queryParams;\r\n    if (params.loadsAllData()) {\r\n        return syncPointGetCompleteView(syncPoint);\r\n    }\r\n    else {\r\n        const queryId = query._queryIdentifier;\r\n        return syncPoint.views.get(queryId);\r\n    }\r\n}\r\nfunction syncPointViewExistsForQuery(syncPoint, query) {\r\n    return syncPointViewForQuery(syncPoint, query) != null;\r\n}\r\nfunction syncPointHasCompleteView(syncPoint) {\r\n    return syncPointGetCompleteView(syncPoint) != null;\r\n}\r\nfunction syncPointGetCompleteView(syncPoint) {\r\n    for (const view of syncPoint.views.values()) {\r\n        if (view.query._queryParams.loadsAllData()) {\r\n            return view;\r\n        }\r\n    }\r\n    return null;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nlet referenceConstructor;\r\nfunction syncTreeSetReferenceConstructor(val) {\r\n    assert(!referenceConstructor, '__referenceConstructor has already been defined');\r\n    referenceConstructor = val;\r\n}\r\nfunction syncTreeGetReferenceConstructor() {\r\n    assert(referenceConstructor, 'Reference.ts has not been loaded');\r\n    return referenceConstructor;\r\n}\r\n/**\r\n * Static tracker for next query tag.\r\n */\r\nlet syncTreeNextQueryTag_ = 1;\r\n/**\r\n * SyncTree is the central class for managing event callback registration, data caching, views\r\n * (query processing), and event generation.  There are typically two SyncTree instances for\r\n * each Repo, one for the normal Firebase data, and one for the .info data.\r\n *\r\n * It has a number of responsibilities, including:\r\n *  - Tracking all user event callbacks (registered via addEventRegistration() and removeEventRegistration()).\r\n *  - Applying and caching data changes for user set(), transaction(), and update() calls\r\n *    (applyUserOverwrite(), applyUserMerge()).\r\n *  - Applying and caching data changes for server data changes (applyServerOverwrite(),\r\n *    applyServerMerge()).\r\n *  - Generating user-facing events for server and user changes (all of the apply* methods\r\n *    return the set of events that need to be raised as a result).\r\n *  - Maintaining the appropriate set of server listens to ensure we are always subscribed\r\n *    to the correct set of paths and queries to satisfy the current set of user event\r\n *    callbacks (listens are started/stopped using the provided listenProvider).\r\n *\r\n * NOTE: Although SyncTree tracks event callbacks and calculates events to raise, the actual\r\n * events are returned to the caller rather than raised synchronously.\r\n *\r\n */\r\nclass SyncTree {\r\n    /**\r\n     * @param listenProvider_ - Used by SyncTree to start / stop listening\r\n     *   to server data.\r\n     */\r\n    constructor(listenProvider_) {\r\n        this.listenProvider_ = listenProvider_;\r\n        /**\r\n         * Tree of SyncPoints.  There's a SyncPoint at any location that has 1 or more views.\r\n         */\r\n        this.syncPointTree_ = new ImmutableTree(null);\r\n        /**\r\n         * A tree of all pending user writes (user-initiated set()'s, transaction()'s, update()'s, etc.).\r\n         */\r\n        this.pendingWriteTree_ = newWriteTree();\r\n        this.tagToQueryMap = new Map();\r\n        this.queryToTagMap = new Map();\r\n    }\r\n}\r\n/**\r\n * Apply the data changes for a user-generated set() or transaction() call.\r\n *\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeApplyUserOverwrite(syncTree, path, newData, writeId, visible) {\r\n    // Record pending write.\r\n    writeTreeAddOverwrite(syncTree.pendingWriteTree_, path, newData, writeId, visible);\r\n    if (!visible) {\r\n        return [];\r\n    }\r\n    else {\r\n        return syncTreeApplyOperationToSyncPoints_(syncTree, new Overwrite(newOperationSourceUser(), path, newData));\r\n    }\r\n}\r\n/**\r\n * Apply the data from a user-generated update() call\r\n *\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeApplyUserMerge(syncTree, path, changedChildren, writeId) {\r\n    // Record pending merge.\r\n    writeTreeAddMerge(syncTree.pendingWriteTree_, path, changedChildren, writeId);\r\n    const changeTree = ImmutableTree.fromObject(changedChildren);\r\n    return syncTreeApplyOperationToSyncPoints_(syncTree, new Merge(newOperationSourceUser(), path, changeTree));\r\n}\r\n/**\r\n * Acknowledge a pending user write that was previously registered with applyUserOverwrite() or applyUserMerge().\r\n *\r\n * @param revert - True if the given write failed and needs to be reverted\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeAckUserWrite(syncTree, writeId, revert = false) {\r\n    const write = writeTreeGetWrite(syncTree.pendingWriteTree_, writeId);\r\n    const needToReevaluate = writeTreeRemoveWrite(syncTree.pendingWriteTree_, writeId);\r\n    if (!needToReevaluate) {\r\n        return [];\r\n    }\r\n    else {\r\n        let affectedTree = new ImmutableTree(null);\r\n        if (write.snap != null) {\r\n            // overwrite\r\n            affectedTree = affectedTree.set(newEmptyPath(), true);\r\n        }\r\n        else {\r\n            each(write.children, (pathString) => {\r\n                affectedTree = affectedTree.set(new Path(pathString), true);\r\n            });\r\n        }\r\n        return syncTreeApplyOperationToSyncPoints_(syncTree, new AckUserWrite(write.path, affectedTree, revert));\r\n    }\r\n}\r\n/**\r\n * Apply new server data for the specified path..\r\n *\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeApplyServerOverwrite(syncTree, path, newData) {\r\n    return syncTreeApplyOperationToSyncPoints_(syncTree, new Overwrite(newOperationSourceServer(), path, newData));\r\n}\r\n/**\r\n * Apply new server data to be merged in at the specified path.\r\n *\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeApplyServerMerge(syncTree, path, changedChildren) {\r\n    const changeTree = ImmutableTree.fromObject(changedChildren);\r\n    return syncTreeApplyOperationToSyncPoints_(syncTree, new Merge(newOperationSourceServer(), path, changeTree));\r\n}\r\n/**\r\n * Apply a listen complete for a query\r\n *\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeApplyListenComplete(syncTree, path) {\r\n    return syncTreeApplyOperationToSyncPoints_(syncTree, new ListenComplete(newOperationSourceServer(), path));\r\n}\r\n/**\r\n * Apply a listen complete for a tagged query\r\n *\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeApplyTaggedListenComplete(syncTree, path, tag) {\r\n    const queryKey = syncTreeQueryKeyForTag_(syncTree, tag);\r\n    if (queryKey) {\r\n        const r = syncTreeParseQueryKey_(queryKey);\r\n        const queryPath = r.path, queryId = r.queryId;\r\n        const relativePath = newRelativePath(queryPath, path);\r\n        const op = new ListenComplete(newOperationSourceServerTaggedQuery(queryId), relativePath);\r\n        return syncTreeApplyTaggedOperation_(syncTree, queryPath, op);\r\n    }\r\n    else {\r\n        // We've already removed the query. No big deal, ignore the update\r\n        return [];\r\n    }\r\n}\r\n/**\r\n * Remove event callback(s).\r\n *\r\n * If query is the default query, we'll check all queries for the specified eventRegistration.\r\n * If eventRegistration is null, we'll remove all callbacks for the specified query/queries.\r\n *\r\n * @param eventRegistration - If null, all callbacks are removed.\r\n * @param cancelError - If a cancelError is provided, appropriate cancel events will be returned.\r\n * @param skipListenerDedup - When performing a `get()`, we don't add any new listeners, so no\r\n *  deduping needs to take place. This flag allows toggling of that behavior\r\n * @returns Cancel events, if cancelError was provided.\r\n */\r\nfunction syncTreeRemoveEventRegistration(syncTree, query, eventRegistration, cancelError, skipListenerDedup = false) {\r\n    // Find the syncPoint first. Then deal with whether or not it has matching listeners\r\n    const path = query._path;\r\n    const maybeSyncPoint = syncTree.syncPointTree_.get(path);\r\n    let cancelEvents = [];\r\n    // A removal on a default query affects all queries at that location. A removal on an indexed query, even one without\r\n    // other query constraints, does *not* affect all queries at that location. So this check must be for 'default', and\r\n    // not loadsAllData().\r\n    if (maybeSyncPoint &&\r\n        (query._queryIdentifier === 'default' ||\r\n            syncPointViewExistsForQuery(maybeSyncPoint, query))) {\r\n        const removedAndEvents = syncPointRemoveEventRegistration(maybeSyncPoint, query, eventRegistration, cancelError);\r\n        if (syncPointIsEmpty(maybeSyncPoint)) {\r\n            syncTree.syncPointTree_ = syncTree.syncPointTree_.remove(path);\r\n        }\r\n        const removed = removedAndEvents.removed;\r\n        cancelEvents = removedAndEvents.events;\r\n        if (!skipListenerDedup) {\r\n            /**\r\n             * We may have just removed one of many listeners and can short-circuit this whole process\r\n             * We may also not have removed a default listener, in which case all of the descendant listeners should already be\r\n             * properly set up.\r\n             */\r\n            // Since indexed queries can shadow if they don't have other query constraints, check for loadsAllData(), instead of\r\n            // queryId === 'default'\r\n            const removingDefault = -1 !==\r\n                removed.findIndex(query => {\r\n                    return query._queryParams.loadsAllData();\r\n                });\r\n            const covered = syncTree.syncPointTree_.findOnPath(path, (relativePath, parentSyncPoint) => syncPointHasCompleteView(parentSyncPoint));\r\n            if (removingDefault && !covered) {\r\n                const subtree = syncTree.syncPointTree_.subtree(path);\r\n                // There are potentially child listeners. Determine what if any listens we need to send before executing the\r\n                // removal\r\n                if (!subtree.isEmpty()) {\r\n                    // We need to fold over our subtree and collect the listeners to send\r\n                    const newViews = syncTreeCollectDistinctViewsForSubTree_(subtree);\r\n                    // Ok, we've collected all the listens we need. Set them up.\r\n                    for (let i = 0; i < newViews.length; ++i) {\r\n                        const view = newViews[i], newQuery = view.query;\r\n                        const listener = syncTreeCreateListenerForView_(syncTree, view);\r\n                        syncTree.listenProvider_.startListening(syncTreeQueryForListening_(newQuery), syncTreeTagForQuery(syncTree, newQuery), listener.hashFn, listener.onComplete);\r\n                    }\r\n                }\r\n                // Otherwise there's nothing below us, so nothing we need to start listening on\r\n            }\r\n            // If we removed anything and we're not covered by a higher up listen, we need to stop listening on this query\r\n            // The above block has us covered in terms of making sure we're set up on listens lower in the tree.\r\n            // Also, note that if we have a cancelError, it's already been removed at the provider level.\r\n            if (!covered && removed.length > 0 && !cancelError) {\r\n                // If we removed a default, then we weren't listening on any of the other queries here. Just cancel the one\r\n                // default. Otherwise, we need to iterate through and cancel each individual query\r\n                if (removingDefault) {\r\n                    // We don't tag default listeners\r\n                    const defaultTag = null;\r\n                    syncTree.listenProvider_.stopListening(syncTreeQueryForListening_(query), defaultTag);\r\n                }\r\n                else {\r\n                    removed.forEach((queryToRemove) => {\r\n                        const tagToRemove = syncTree.queryToTagMap.get(syncTreeMakeQueryKey_(queryToRemove));\r\n                        syncTree.listenProvider_.stopListening(syncTreeQueryForListening_(queryToRemove), tagToRemove);\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        // Now, clear all of the tags we're tracking for the removed listens\r\n        syncTreeRemoveTags_(syncTree, removed);\r\n    }\r\n    return cancelEvents;\r\n}\r\n/**\r\n * Apply new server data for the specified tagged query.\r\n *\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeApplyTaggedQueryOverwrite(syncTree, path, snap, tag) {\r\n    const queryKey = syncTreeQueryKeyForTag_(syncTree, tag);\r\n    if (queryKey != null) {\r\n        const r = syncTreeParseQueryKey_(queryKey);\r\n        const queryPath = r.path, queryId = r.queryId;\r\n        const relativePath = newRelativePath(queryPath, path);\r\n        const op = new Overwrite(newOperationSourceServerTaggedQuery(queryId), relativePath, snap);\r\n        return syncTreeApplyTaggedOperation_(syncTree, queryPath, op);\r\n    }\r\n    else {\r\n        // Query must have been removed already\r\n        return [];\r\n    }\r\n}\r\n/**\r\n * Apply server data to be merged in for the specified tagged query.\r\n *\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeApplyTaggedQueryMerge(syncTree, path, changedChildren, tag) {\r\n    const queryKey = syncTreeQueryKeyForTag_(syncTree, tag);\r\n    if (queryKey) {\r\n        const r = syncTreeParseQueryKey_(queryKey);\r\n        const queryPath = r.path, queryId = r.queryId;\r\n        const relativePath = newRelativePath(queryPath, path);\r\n        const changeTree = ImmutableTree.fromObject(changedChildren);\r\n        const op = new Merge(newOperationSourceServerTaggedQuery(queryId), relativePath, changeTree);\r\n        return syncTreeApplyTaggedOperation_(syncTree, queryPath, op);\r\n    }\r\n    else {\r\n        // We've already removed the query. No big deal, ignore the update\r\n        return [];\r\n    }\r\n}\r\n/**\r\n * Add an event callback for the specified query.\r\n *\r\n * @returns Events to raise.\r\n */\r\nfunction syncTreeAddEventRegistration(syncTree, query, eventRegistration, skipSetupListener = false) {\r\n    const path = query._path;\r\n    let serverCache = null;\r\n    let foundAncestorDefaultView = false;\r\n    // Any covering writes will necessarily be at the root, so really all we need to find is the server cache.\r\n    // Consider optimizing this once there's a better understanding of what actual behavior will be.\r\n    syncTree.syncPointTree_.foreachOnPath(path, (pathToSyncPoint, sp) => {\r\n        const relativePath = newRelativePath(pathToSyncPoint, path);\r\n        serverCache =\r\n            serverCache || syncPointGetCompleteServerCache(sp, relativePath);\r\n        foundAncestorDefaultView =\r\n            foundAncestorDefaultView || syncPointHasCompleteView(sp);\r\n    });\r\n    let syncPoint = syncTree.syncPointTree_.get(path);\r\n    if (!syncPoint) {\r\n        syncPoint = new SyncPoint();\r\n        syncTree.syncPointTree_ = syncTree.syncPointTree_.set(path, syncPoint);\r\n    }\r\n    else {\r\n        foundAncestorDefaultView =\r\n            foundAncestorDefaultView || syncPointHasCompleteView(syncPoint);\r\n        serverCache =\r\n            serverCache || syncPointGetCompleteServerCache(syncPoint, newEmptyPath());\r\n    }\r\n    let serverCacheComplete;\r\n    if (serverCache != null) {\r\n        serverCacheComplete = true;\r\n    }\r\n    else {\r\n        serverCacheComplete = false;\r\n        serverCache = ChildrenNode.EMPTY_NODE;\r\n        const subtree = syncTree.syncPointTree_.subtree(path);\r\n        subtree.foreachChild((childName, childSyncPoint) => {\r\n            const completeCache = syncPointGetCompleteServerCache(childSyncPoint, newEmptyPath());\r\n            if (completeCache) {\r\n                serverCache = serverCache.updateImmediateChild(childName, completeCache);\r\n            }\r\n        });\r\n    }\r\n    const viewAlreadyExists = syncPointViewExistsForQuery(syncPoint, query);\r\n    if (!viewAlreadyExists && !query._queryParams.loadsAllData()) {\r\n        // We need to track a tag for this query\r\n        const queryKey = syncTreeMakeQueryKey_(query);\r\n        assert(!syncTree.queryToTagMap.has(queryKey), 'View does not exist, but we have a tag');\r\n        const tag = syncTreeGetNextQueryTag_();\r\n        syncTree.queryToTagMap.set(queryKey, tag);\r\n        syncTree.tagToQueryMap.set(tag, queryKey);\r\n    }\r\n    const writesCache = writeTreeChildWrites(syncTree.pendingWriteTree_, path);\r\n    let events = syncPointAddEventRegistration(syncPoint, query, eventRegistration, writesCache, serverCache, serverCacheComplete);\r\n    if (!viewAlreadyExists && !foundAncestorDefaultView && !skipSetupListener) {\r\n        const view = syncPointViewForQuery(syncPoint, query);\r\n        events = events.concat(syncTreeSetupListener_(syncTree, query, view));\r\n    }\r\n    return events;\r\n}\r\n/**\r\n * Returns a complete cache, if we have one, of the data at a particular path. If the location does not have a\r\n * listener above it, we will get a false \"null\". This shouldn't be a problem because transactions will always\r\n * have a listener above, and atomic operations would correctly show a jitter of <increment value> ->\r\n *     <incremented total> as the write is applied locally and then acknowledged at the server.\r\n *\r\n * Note: this method will *include* hidden writes from transaction with applyLocally set to false.\r\n *\r\n * @param path - The path to the data we want\r\n * @param writeIdsToExclude - A specific set to be excluded\r\n */\r\nfunction syncTreeCalcCompleteEventCache(syncTree, path, writeIdsToExclude) {\r\n    const includeHiddenSets = true;\r\n    const writeTree = syncTree.pendingWriteTree_;\r\n    const serverCache = syncTree.syncPointTree_.findOnPath(path, (pathSoFar, syncPoint) => {\r\n        const relativePath = newRelativePath(pathSoFar, path);\r\n        const serverCache = syncPointGetCompleteServerCache(syncPoint, relativePath);\r\n        if (serverCache) {\r\n            return serverCache;\r\n        }\r\n    });\r\n    return writeTreeCalcCompleteEventCache(writeTree, path, serverCache, writeIdsToExclude, includeHiddenSets);\r\n}\r\nfunction syncTreeGetServerValue(syncTree, query) {\r\n    const path = query._path;\r\n    let serverCache = null;\r\n    // Any covering writes will necessarily be at the root, so really all we need to find is the server cache.\r\n    // Consider optimizing this once there's a better understanding of what actual behavior will be.\r\n    syncTree.syncPointTree_.foreachOnPath(path, (pathToSyncPoint, sp) => {\r\n        const relativePath = newRelativePath(pathToSyncPoint, path);\r\n        serverCache =\r\n            serverCache || syncPointGetCompleteServerCache(sp, relativePath);\r\n    });\r\n    let syncPoint = syncTree.syncPointTree_.get(path);\r\n    if (!syncPoint) {\r\n        syncPoint = new SyncPoint();\r\n        syncTree.syncPointTree_ = syncTree.syncPointTree_.set(path, syncPoint);\r\n    }\r\n    else {\r\n        serverCache =\r\n            serverCache || syncPointGetCompleteServerCache(syncPoint, newEmptyPath());\r\n    }\r\n    const serverCacheComplete = serverCache != null;\r\n    const serverCacheNode = serverCacheComplete\r\n        ? new CacheNode(serverCache, true, false)\r\n        : null;\r\n    const writesCache = writeTreeChildWrites(syncTree.pendingWriteTree_, query._path);\r\n    const view = syncPointGetView(syncPoint, query, writesCache, serverCacheComplete ? serverCacheNode.getNode() : ChildrenNode.EMPTY_NODE, serverCacheComplete);\r\n    return viewGetCompleteNode(view);\r\n}\r\n/**\r\n * A helper method that visits all descendant and ancestor SyncPoints, applying the operation.\r\n *\r\n * NOTES:\r\n * - Descendant SyncPoints will be visited first (since we raise events depth-first).\r\n *\r\n * - We call applyOperation() on each SyncPoint passing three things:\r\n *   1. A version of the Operation that has been made relative to the SyncPoint location.\r\n *   2. A WriteTreeRef of any writes we have cached at the SyncPoint location.\r\n *   3. A snapshot Node with cached server data, if we have it.\r\n *\r\n * - We concatenate all of the events returned by each SyncPoint and return the result.\r\n */\r\nfunction syncTreeApplyOperationToSyncPoints_(syncTree, operation) {\r\n    return syncTreeApplyOperationHelper_(operation, syncTree.syncPointTree_, \r\n    /*serverCache=*/ null, writeTreeChildWrites(syncTree.pendingWriteTree_, newEmptyPath()));\r\n}\r\n/**\r\n * Recursive helper for applyOperationToSyncPoints_\r\n */\r\nfunction syncTreeApplyOperationHelper_(operation, syncPointTree, serverCache, writesCache) {\r\n    if (pathIsEmpty(operation.path)) {\r\n        return syncTreeApplyOperationDescendantsHelper_(operation, syncPointTree, serverCache, writesCache);\r\n    }\r\n    else {\r\n        const syncPoint = syncPointTree.get(newEmptyPath());\r\n        // If we don't have cached server data, see if we can get it from this SyncPoint.\r\n        if (serverCache == null && syncPoint != null) {\r\n            serverCache = syncPointGetCompleteServerCache(syncPoint, newEmptyPath());\r\n        }\r\n        let events = [];\r\n        const childName = pathGetFront(operation.path);\r\n        const childOperation = operation.operationForChild(childName);\r\n        const childTree = syncPointTree.children.get(childName);\r\n        if (childTree && childOperation) {\r\n            const childServerCache = serverCache\r\n                ? serverCache.getImmediateChild(childName)\r\n                : null;\r\n            const childWritesCache = writeTreeRefChild(writesCache, childName);\r\n            events = events.concat(syncTreeApplyOperationHelper_(childOperation, childTree, childServerCache, childWritesCache));\r\n        }\r\n        if (syncPoint) {\r\n            events = events.concat(syncPointApplyOperation(syncPoint, operation, writesCache, serverCache));\r\n        }\r\n        return events;\r\n    }\r\n}\r\n/**\r\n * Recursive helper for applyOperationToSyncPoints_\r\n */\r\nfunction syncTreeApplyOperationDescendantsHelper_(operation, syncPointTree, serverCache, writesCache) {\r\n    const syncPoint = syncPointTree.get(newEmptyPath());\r\n    // If we don't have cached server data, see if we can get it from this SyncPoint.\r\n    if (serverCache == null && syncPoint != null) {\r\n        serverCache = syncPointGetCompleteServerCache(syncPoint, newEmptyPath());\r\n    }\r\n    let events = [];\r\n    syncPointTree.children.inorderTraversal((childName, childTree) => {\r\n        const childServerCache = serverCache\r\n            ? serverCache.getImmediateChild(childName)\r\n            : null;\r\n        const childWritesCache = writeTreeRefChild(writesCache, childName);\r\n        const childOperation = operation.operationForChild(childName);\r\n        if (childOperation) {\r\n            events = events.concat(syncTreeApplyOperationDescendantsHelper_(childOperation, childTree, childServerCache, childWritesCache));\r\n        }\r\n    });\r\n    if (syncPoint) {\r\n        events = events.concat(syncPointApplyOperation(syncPoint, operation, writesCache, serverCache));\r\n    }\r\n    return events;\r\n}\r\nfunction syncTreeCreateListenerForView_(syncTree, view) {\r\n    const query = view.query;\r\n    const tag = syncTreeTagForQuery(syncTree, query);\r\n    return {\r\n        hashFn: () => {\r\n            const cache = viewGetServerCache(view) || ChildrenNode.EMPTY_NODE;\r\n            return cache.hash();\r\n        },\r\n        onComplete: (status) => {\r\n            if (status === 'ok') {\r\n                if (tag) {\r\n                    return syncTreeApplyTaggedListenComplete(syncTree, query._path, tag);\r\n                }\r\n                else {\r\n                    return syncTreeApplyListenComplete(syncTree, query._path);\r\n                }\r\n            }\r\n            else {\r\n                // If a listen failed, kill all of the listeners here, not just the one that triggered the error.\r\n                // Note that this may need to be scoped to just this listener if we change permissions on filtered children\r\n                const error = errorForServerCode(status, query);\r\n                return syncTreeRemoveEventRegistration(syncTree, query, \r\n                /*eventRegistration*/ null, error);\r\n            }\r\n        }\r\n    };\r\n}\r\n/**\r\n * Return the tag associated with the given query.\r\n */\r\nfunction syncTreeTagForQuery(syncTree, query) {\r\n    const queryKey = syncTreeMakeQueryKey_(query);\r\n    return syncTree.queryToTagMap.get(queryKey);\r\n}\r\n/**\r\n * Given a query, computes a \"queryKey\" suitable for use in our queryToTagMap_.\r\n */\r\nfunction syncTreeMakeQueryKey_(query) {\r\n    return query._path.toString() + '$' + query._queryIdentifier;\r\n}\r\n/**\r\n * Return the query associated with the given tag, if we have one\r\n */\r\nfunction syncTreeQueryKeyForTag_(syncTree, tag) {\r\n    return syncTree.tagToQueryMap.get(tag);\r\n}\r\n/**\r\n * Given a queryKey (created by makeQueryKey), parse it back into a path and queryId.\r\n */\r\nfunction syncTreeParseQueryKey_(queryKey) {\r\n    const splitIndex = queryKey.indexOf('$');\r\n    assert(splitIndex !== -1 && splitIndex < queryKey.length - 1, 'Bad queryKey.');\r\n    return {\r\n        queryId: queryKey.substr(splitIndex + 1),\r\n        path: new Path(queryKey.substr(0, splitIndex))\r\n    };\r\n}\r\n/**\r\n * A helper method to apply tagged operations\r\n */\r\nfunction syncTreeApplyTaggedOperation_(syncTree, queryPath, operation) {\r\n    const syncPoint = syncTree.syncPointTree_.get(queryPath);\r\n    assert(syncPoint, \"Missing sync point for query tag that we're tracking\");\r\n    const writesCache = writeTreeChildWrites(syncTree.pendingWriteTree_, queryPath);\r\n    return syncPointApplyOperation(syncPoint, operation, writesCache, null);\r\n}\r\n/**\r\n * This collapses multiple unfiltered views into a single view, since we only need a single\r\n * listener for them.\r\n */\r\nfunction syncTreeCollectDistinctViewsForSubTree_(subtree) {\r\n    return subtree.fold((relativePath, maybeChildSyncPoint, childMap) => {\r\n        if (maybeChildSyncPoint && syncPointHasCompleteView(maybeChildSyncPoint)) {\r\n            const completeView = syncPointGetCompleteView(maybeChildSyncPoint);\r\n            return [completeView];\r\n        }\r\n        else {\r\n            // No complete view here, flatten any deeper listens into an array\r\n            let views = [];\r\n            if (maybeChildSyncPoint) {\r\n                views = syncPointGetQueryViews(maybeChildSyncPoint);\r\n            }\r\n            each(childMap, (_key, childViews) => {\r\n                views = views.concat(childViews);\r\n            });\r\n            return views;\r\n        }\r\n    });\r\n}\r\n/**\r\n * Normalizes a query to a query we send the server for listening\r\n *\r\n * @returns The normalized query\r\n */\r\nfunction syncTreeQueryForListening_(query) {\r\n    if (query._queryParams.loadsAllData() && !query._queryParams.isDefault()) {\r\n        // We treat queries that load all data as default queries\r\n        // Cast is necessary because ref() technically returns Firebase which is actually fb.api.Firebase which inherits\r\n        // from Query\r\n        return new (syncTreeGetReferenceConstructor())(query._repo, query._path);\r\n    }\r\n    else {\r\n        return query;\r\n    }\r\n}\r\nfunction syncTreeRemoveTags_(syncTree, queries) {\r\n    for (let j = 0; j < queries.length; ++j) {\r\n        const removedQuery = queries[j];\r\n        if (!removedQuery._queryParams.loadsAllData()) {\r\n            // We should have a tag for this\r\n            const removedQueryKey = syncTreeMakeQueryKey_(removedQuery);\r\n            const removedQueryTag = syncTree.queryToTagMap.get(removedQueryKey);\r\n            syncTree.queryToTagMap.delete(removedQueryKey);\r\n            syncTree.tagToQueryMap.delete(removedQueryTag);\r\n        }\r\n    }\r\n}\r\n/**\r\n * Static accessor for query tags.\r\n */\r\nfunction syncTreeGetNextQueryTag_() {\r\n    return syncTreeNextQueryTag_++;\r\n}\r\n/**\r\n * For a given new listen, manage the de-duplication of outstanding subscriptions.\r\n *\r\n * @returns This method can return events to support synchronous data sources\r\n */\r\nfunction syncTreeSetupListener_(syncTree, query, view) {\r\n    const path = query._path;\r\n    const tag = syncTreeTagForQuery(syncTree, query);\r\n    const listener = syncTreeCreateListenerForView_(syncTree, view);\r\n    const events = syncTree.listenProvider_.startListening(syncTreeQueryForListening_(query), tag, listener.hashFn, listener.onComplete);\r\n    const subtree = syncTree.syncPointTree_.subtree(path);\r\n    // The root of this subtree has our query. We're here because we definitely need to send a listen for that, but we\r\n    // may need to shadow other listens as well.\r\n    if (tag) {\r\n        assert(!syncPointHasCompleteView(subtree.value), \"If we're adding a query, it shouldn't be shadowed\");\r\n    }\r\n    else {\r\n        // Shadow everything at or below this location, this is a default listener.\r\n        const queriesToStop = subtree.fold((relativePath, maybeChildSyncPoint, childMap) => {\r\n            if (!pathIsEmpty(relativePath) &&\r\n                maybeChildSyncPoint &&\r\n                syncPointHasCompleteView(maybeChildSyncPoint)) {\r\n                return [syncPointGetCompleteView(maybeChildSyncPoint).query];\r\n            }\r\n            else {\r\n                // No default listener here, flatten any deeper queries into an array\r\n                let queries = [];\r\n                if (maybeChildSyncPoint) {\r\n                    queries = queries.concat(syncPointGetQueryViews(maybeChildSyncPoint).map(view => view.query));\r\n                }\r\n                each(childMap, (_key, childQueries) => {\r\n                    queries = queries.concat(childQueries);\r\n                });\r\n                return queries;\r\n            }\r\n        });\r\n        for (let i = 0; i < queriesToStop.length; ++i) {\r\n            const queryToStop = queriesToStop[i];\r\n            syncTree.listenProvider_.stopListening(syncTreeQueryForListening_(queryToStop), syncTreeTagForQuery(syncTree, queryToStop));\r\n        }\r\n    }\r\n    return events;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass ExistingValueProvider {\r\n    constructor(node_) {\r\n        this.node_ = node_;\r\n    }\r\n    getImmediateChild(childName) {\r\n        const child = this.node_.getImmediateChild(childName);\r\n        return new ExistingValueProvider(child);\r\n    }\r\n    node() {\r\n        return this.node_;\r\n    }\r\n}\r\nclass DeferredValueProvider {\r\n    constructor(syncTree, path) {\r\n        this.syncTree_ = syncTree;\r\n        this.path_ = path;\r\n    }\r\n    getImmediateChild(childName) {\r\n        const childPath = pathChild(this.path_, childName);\r\n        return new DeferredValueProvider(this.syncTree_, childPath);\r\n    }\r\n    node() {\r\n        return syncTreeCalcCompleteEventCache(this.syncTree_, this.path_);\r\n    }\r\n}\r\n/**\r\n * Generate placeholders for deferred values.\r\n */\r\nconst generateWithValues = function (values) {\r\n    values = values || {};\r\n    values['timestamp'] = values['timestamp'] || new Date().getTime();\r\n    return values;\r\n};\r\n/**\r\n * Value to use when firing local events. When writing server values, fire\r\n * local events with an approximate value, otherwise return value as-is.\r\n */\r\nconst resolveDeferredLeafValue = function (value, existingVal, serverValues) {\r\n    if (!value || typeof value !== 'object') {\r\n        return value;\r\n    }\r\n    assert('.sv' in value, 'Unexpected leaf node or priority contents');\r\n    if (typeof value['.sv'] === 'string') {\r\n        return resolveScalarDeferredValue(value['.sv'], existingVal, serverValues);\r\n    }\r\n    else if (typeof value['.sv'] === 'object') {\r\n        return resolveComplexDeferredValue(value['.sv'], existingVal);\r\n    }\r\n    else {\r\n        assert(false, 'Unexpected server value: ' + JSON.stringify(value, null, 2));\r\n    }\r\n};\r\nconst resolveScalarDeferredValue = function (op, existing, serverValues) {\r\n    switch (op) {\r\n        case 'timestamp':\r\n            return serverValues['timestamp'];\r\n        default:\r\n            assert(false, 'Unexpected server value: ' + op);\r\n    }\r\n};\r\nconst resolveComplexDeferredValue = function (op, existing, unused) {\r\n    if (!op.hasOwnProperty('increment')) {\r\n        assert(false, 'Unexpected server value: ' + JSON.stringify(op, null, 2));\r\n    }\r\n    const delta = op['increment'];\r\n    if (typeof delta !== 'number') {\r\n        assert(false, 'Unexpected increment value: ' + delta);\r\n    }\r\n    const existingNode = existing.node();\r\n    assert(existingNode !== null && typeof existingNode !== 'undefined', 'Expected ChildrenNode.EMPTY_NODE for nulls');\r\n    // Incrementing a non-number sets the value to the incremented amount\r\n    if (!existingNode.isLeafNode()) {\r\n        return delta;\r\n    }\r\n    const leaf = existingNode;\r\n    const existingVal = leaf.getValue();\r\n    if (typeof existingVal !== 'number') {\r\n        return delta;\r\n    }\r\n    // No need to do over/underflow arithmetic here because JS only handles floats under the covers\r\n    return existingVal + delta;\r\n};\r\n/**\r\n * Recursively replace all deferred values and priorities in the tree with the\r\n * specified generated replacement values.\r\n * @param path - path to which write is relative\r\n * @param node - new data written at path\r\n * @param syncTree - current data\r\n */\r\nconst resolveDeferredValueTree = function (path, node, syncTree, serverValues) {\r\n    return resolveDeferredValue(node, new DeferredValueProvider(syncTree, path), serverValues);\r\n};\r\n/**\r\n * Recursively replace all deferred values and priorities in the node with the\r\n * specified generated replacement values.  If there are no server values in the node,\r\n * it'll be returned as-is.\r\n */\r\nconst resolveDeferredValueSnapshot = function (node, existing, serverValues) {\r\n    return resolveDeferredValue(node, new ExistingValueProvider(existing), serverValues);\r\n};\r\nfunction resolveDeferredValue(node, existingVal, serverValues) {\r\n    const rawPri = node.getPriority().val();\r\n    const priority = resolveDeferredLeafValue(rawPri, existingVal.getImmediateChild('.priority'), serverValues);\r\n    let newNode;\r\n    if (node.isLeafNode()) {\r\n        const leafNode = node;\r\n        const value = resolveDeferredLeafValue(leafNode.getValue(), existingVal, serverValues);\r\n        if (value !== leafNode.getValue() ||\r\n            priority !== leafNode.getPriority().val()) {\r\n            return new LeafNode(value, nodeFromJSON(priority));\r\n        }\r\n        else {\r\n            return node;\r\n        }\r\n    }\r\n    else {\r\n        const childrenNode = node;\r\n        newNode = childrenNode;\r\n        if (priority !== childrenNode.getPriority().val()) {\r\n            newNode = newNode.updatePriority(new LeafNode(priority));\r\n        }\r\n        childrenNode.forEachChild(PRIORITY_INDEX, (childName, childNode) => {\r\n            const newChildNode = resolveDeferredValue(childNode, existingVal.getImmediateChild(childName), serverValues);\r\n            if (newChildNode !== childNode) {\r\n                newNode = newNode.updateImmediateChild(childName, newChildNode);\r\n            }\r\n        });\r\n        return newNode;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A light-weight tree, traversable by path.  Nodes can have both values and children.\r\n * Nodes are not enumerated (by forEachChild) unless they have a value or non-empty\r\n * children.\r\n */\r\nclass Tree {\r\n    /**\r\n     * @param name - Optional name of the node.\r\n     * @param parent - Optional parent node.\r\n     * @param node - Optional node to wrap.\r\n     */\r\n    constructor(name = '', parent = null, node = { children: {}, childCount: 0 }) {\r\n        this.name = name;\r\n        this.parent = parent;\r\n        this.node = node;\r\n    }\r\n}\r\n/**\r\n * Returns a sub-Tree for the given path.\r\n *\r\n * @param pathObj - Path to look up.\r\n * @returns Tree for path.\r\n */\r\nfunction treeSubTree(tree, pathObj) {\r\n    // TODO: Require pathObj to be Path?\r\n    let path = pathObj instanceof Path ? pathObj : new Path(pathObj);\r\n    let child = tree, next = pathGetFront(path);\r\n    while (next !== null) {\r\n        const childNode = safeGet(child.node.children, next) || {\r\n            children: {},\r\n            childCount: 0\r\n        };\r\n        child = new Tree(next, child, childNode);\r\n        path = pathPopFront(path);\r\n        next = pathGetFront(path);\r\n    }\r\n    return child;\r\n}\r\n/**\r\n * Returns the data associated with this tree node.\r\n *\r\n * @returns The data or null if no data exists.\r\n */\r\nfunction treeGetValue(tree) {\r\n    return tree.node.value;\r\n}\r\n/**\r\n * Sets data to this tree node.\r\n *\r\n * @param value - Value to set.\r\n */\r\nfunction treeSetValue(tree, value) {\r\n    tree.node.value = value;\r\n    treeUpdateParents(tree);\r\n}\r\n/**\r\n * @returns Whether the tree has any children.\r\n */\r\nfunction treeHasChildren(tree) {\r\n    return tree.node.childCount > 0;\r\n}\r\n/**\r\n * @returns Whether the tree is empty (no value or children).\r\n */\r\nfunction treeIsEmpty(tree) {\r\n    return treeGetValue(tree) === undefined && !treeHasChildren(tree);\r\n}\r\n/**\r\n * Calls action for each child of this tree node.\r\n *\r\n * @param action - Action to be called for each child.\r\n */\r\nfunction treeForEachChild(tree, action) {\r\n    each(tree.node.children, (child, childTree) => {\r\n        action(new Tree(child, tree, childTree));\r\n    });\r\n}\r\n/**\r\n * Does a depth-first traversal of this node's descendants, calling action for each one.\r\n *\r\n * @param action - Action to be called for each child.\r\n * @param includeSelf - Whether to call action on this node as well. Defaults to\r\n *   false.\r\n * @param childrenFirst - Whether to call action on children before calling it on\r\n *   parent.\r\n */\r\nfunction treeForEachDescendant(tree, action, includeSelf, childrenFirst) {\r\n    if (includeSelf && !childrenFirst) {\r\n        action(tree);\r\n    }\r\n    treeForEachChild(tree, child => {\r\n        treeForEachDescendant(child, action, true, childrenFirst);\r\n    });\r\n    if (includeSelf && childrenFirst) {\r\n        action(tree);\r\n    }\r\n}\r\n/**\r\n * Calls action on each ancestor node.\r\n *\r\n * @param action - Action to be called on each parent; return\r\n *   true to abort.\r\n * @param includeSelf - Whether to call action on this node as well.\r\n * @returns true if the action callback returned true.\r\n */\r\nfunction treeForEachAncestor(tree, action, includeSelf) {\r\n    let node = includeSelf ? tree : tree.parent;\r\n    while (node !== null) {\r\n        if (action(node)) {\r\n            return true;\r\n        }\r\n        node = node.parent;\r\n    }\r\n    return false;\r\n}\r\n/**\r\n * @returns The path of this tree node, as a Path.\r\n */\r\nfunction treeGetPath(tree) {\r\n    return new Path(tree.parent === null\r\n        ? tree.name\r\n        : treeGetPath(tree.parent) + '/' + tree.name);\r\n}\r\n/**\r\n * Adds or removes this child from its parent based on whether it's empty or not.\r\n */\r\nfunction treeUpdateParents(tree) {\r\n    if (tree.parent !== null) {\r\n        treeUpdateChild(tree.parent, tree.name, tree);\r\n    }\r\n}\r\n/**\r\n * Adds or removes the passed child to this tree node, depending on whether it's empty.\r\n *\r\n * @param childName - The name of the child to update.\r\n * @param child - The child to update.\r\n */\r\nfunction treeUpdateChild(tree, childName, child) {\r\n    const childEmpty = treeIsEmpty(child);\r\n    const childExists = contains(tree.node.children, childName);\r\n    if (childEmpty && childExists) {\r\n        delete tree.node.children[childName];\r\n        tree.node.childCount--;\r\n        treeUpdateParents(tree);\r\n    }\r\n    else if (!childEmpty && !childExists) {\r\n        tree.node.children[childName] = child.node;\r\n        tree.node.childCount++;\r\n        treeUpdateParents(tree);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * True for invalid Firebase keys\r\n */\r\nconst INVALID_KEY_REGEX_ = /[\\[\\].#$\\/\\u0000-\\u001F\\u007F]/;\r\n/**\r\n * True for invalid Firebase paths.\r\n * Allows '/' in paths.\r\n */\r\nconst INVALID_PATH_REGEX_ = /[\\[\\].#$\\u0000-\\u001F\\u007F]/;\r\n/**\r\n * Maximum number of characters to allow in leaf value\r\n */\r\nconst MAX_LEAF_SIZE_ = 10 * 1024 * 1024;\r\nconst isValidKey = function (key) {\r\n    return (typeof key === 'string' && key.length !== 0 && !INVALID_KEY_REGEX_.test(key));\r\n};\r\nconst isValidPathString = function (pathString) {\r\n    return (typeof pathString === 'string' &&\r\n        pathString.length !== 0 &&\r\n        !INVALID_PATH_REGEX_.test(pathString));\r\n};\r\nconst isValidRootPathString = function (pathString) {\r\n    if (pathString) {\r\n        // Allow '/.info/' at the beginning.\r\n        pathString = pathString.replace(/^\\/*\\.info(\\/|$)/, '/');\r\n    }\r\n    return isValidPathString(pathString);\r\n};\r\nconst isValidPriority = function (priority) {\r\n    return (priority === null ||\r\n        typeof priority === 'string' ||\r\n        (typeof priority === 'number' && !isInvalidJSONNumber(priority)) ||\r\n        (priority &&\r\n            typeof priority === 'object' &&\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            contains(priority, '.sv')));\r\n};\r\n/**\r\n * Pre-validate a datum passed as an argument to Firebase function.\r\n */\r\nconst validateFirebaseDataArg = function (fnName, value, path, optional) {\r\n    if (optional && value === undefined) {\r\n        return;\r\n    }\r\n    validateFirebaseData(errorPrefix(fnName, 'value'), value, path);\r\n};\r\n/**\r\n * Validate a data object client-side before sending to server.\r\n */\r\nconst validateFirebaseData = function (errorPrefix, data, path_) {\r\n    const path = path_ instanceof Path ? new ValidationPath(path_, errorPrefix) : path_;\r\n    if (data === undefined) {\r\n        throw new Error(errorPrefix + 'contains undefined ' + validationPathToErrorString(path));\r\n    }\r\n    if (typeof data === 'function') {\r\n        throw new Error(errorPrefix +\r\n            'contains a function ' +\r\n            validationPathToErrorString(path) +\r\n            ' with contents = ' +\r\n            data.toString());\r\n    }\r\n    if (isInvalidJSONNumber(data)) {\r\n        throw new Error(errorPrefix +\r\n            'contains ' +\r\n            data.toString() +\r\n            ' ' +\r\n            validationPathToErrorString(path));\r\n    }\r\n    // Check max leaf size, but try to avoid the utf8 conversion if we can.\r\n    if (typeof data === 'string' &&\r\n        data.length > MAX_LEAF_SIZE_ / 3 &&\r\n        stringLength(data) > MAX_LEAF_SIZE_) {\r\n        throw new Error(errorPrefix +\r\n            'contains a string greater than ' +\r\n            MAX_LEAF_SIZE_ +\r\n            ' utf8 bytes ' +\r\n            validationPathToErrorString(path) +\r\n            \" ('\" +\r\n            data.substring(0, 50) +\r\n            \"...')\");\r\n    }\r\n    // TODO = Perf = Consider combining the recursive validation of keys into NodeFromJSON\r\n    // to save extra walking of large objects.\r\n    if (data && typeof data === 'object') {\r\n        let hasDotValue = false;\r\n        let hasActualChild = false;\r\n        each(data, (key, value) => {\r\n            if (key === '.value') {\r\n                hasDotValue = true;\r\n            }\r\n            else if (key !== '.priority' && key !== '.sv') {\r\n                hasActualChild = true;\r\n                if (!isValidKey(key)) {\r\n                    throw new Error(errorPrefix +\r\n                        ' contains an invalid key (' +\r\n                        key +\r\n                        ') ' +\r\n                        validationPathToErrorString(path) +\r\n                        '.  Keys must be non-empty strings ' +\r\n                        'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"');\r\n                }\r\n            }\r\n            validationPathPush(path, key);\r\n            validateFirebaseData(errorPrefix, value, path);\r\n            validationPathPop(path);\r\n        });\r\n        if (hasDotValue && hasActualChild) {\r\n            throw new Error(errorPrefix +\r\n                ' contains \".value\" child ' +\r\n                validationPathToErrorString(path) +\r\n                ' in addition to actual children.');\r\n        }\r\n    }\r\n};\r\n/**\r\n * Pre-validate paths passed in the firebase function.\r\n */\r\nconst validateFirebaseMergePaths = function (errorPrefix, mergePaths) {\r\n    let i, curPath;\r\n    for (i = 0; i < mergePaths.length; i++) {\r\n        curPath = mergePaths[i];\r\n        const keys = pathSlice(curPath);\r\n        for (let j = 0; j < keys.length; j++) {\r\n            if (keys[j] === '.priority' && j === keys.length - 1) ;\r\n            else if (!isValidKey(keys[j])) {\r\n                throw new Error(errorPrefix +\r\n                    'contains an invalid key (' +\r\n                    keys[j] +\r\n                    ') in path ' +\r\n                    curPath.toString() +\r\n                    '. Keys must be non-empty strings ' +\r\n                    'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"');\r\n            }\r\n        }\r\n    }\r\n    // Check that update keys are not descendants of each other.\r\n    // We rely on the property that sorting guarantees that ancestors come\r\n    // right before descendants.\r\n    mergePaths.sort(pathCompare);\r\n    let prevPath = null;\r\n    for (i = 0; i < mergePaths.length; i++) {\r\n        curPath = mergePaths[i];\r\n        if (prevPath !== null && pathContains(prevPath, curPath)) {\r\n            throw new Error(errorPrefix +\r\n                'contains a path ' +\r\n                prevPath.toString() +\r\n                ' that is ancestor of another path ' +\r\n                curPath.toString());\r\n        }\r\n        prevPath = curPath;\r\n    }\r\n};\r\n/**\r\n * pre-validate an object passed as an argument to firebase function (\r\n * must be an object - e.g. for firebase.update()).\r\n */\r\nconst validateFirebaseMergeDataArg = function (fnName, data, path, optional) {\r\n    if (optional && data === undefined) {\r\n        return;\r\n    }\r\n    const errorPrefix$1 = errorPrefix(fnName, 'values');\r\n    if (!(data && typeof data === 'object') || Array.isArray(data)) {\r\n        throw new Error(errorPrefix$1 + ' must be an object containing the children to replace.');\r\n    }\r\n    const mergePaths = [];\r\n    each(data, (key, value) => {\r\n        const curPath = new Path(key);\r\n        validateFirebaseData(errorPrefix$1, value, pathChild(path, curPath));\r\n        if (pathGetBack(curPath) === '.priority') {\r\n            if (!isValidPriority(value)) {\r\n                throw new Error(errorPrefix$1 +\r\n                    \"contains an invalid value for '\" +\r\n                    curPath.toString() +\r\n                    \"', which must be a valid \" +\r\n                    'Firebase priority (a string, finite number, server value, or null).');\r\n            }\r\n        }\r\n        mergePaths.push(curPath);\r\n    });\r\n    validateFirebaseMergePaths(errorPrefix$1, mergePaths);\r\n};\r\nconst validatePriority = function (fnName, priority, optional) {\r\n    if (optional && priority === undefined) {\r\n        return;\r\n    }\r\n    if (isInvalidJSONNumber(priority)) {\r\n        throw new Error(errorPrefix(fnName, 'priority') +\r\n            'is ' +\r\n            priority.toString() +\r\n            ', but must be a valid Firebase priority (a string, finite number, ' +\r\n            'server value, or null).');\r\n    }\r\n    // Special case to allow importing data with a .sv.\r\n    if (!isValidPriority(priority)) {\r\n        throw new Error(errorPrefix(fnName, 'priority') +\r\n            'must be a valid Firebase priority ' +\r\n            '(a string, finite number, server value, or null).');\r\n    }\r\n};\r\nconst validateKey = function (fnName, argumentName, key, optional) {\r\n    if (optional && key === undefined) {\r\n        return;\r\n    }\r\n    if (!isValidKey(key)) {\r\n        throw new Error(errorPrefix(fnName, argumentName) +\r\n            'was an invalid key = \"' +\r\n            key +\r\n            '\".  Firebase keys must be non-empty strings and ' +\r\n            'can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\").');\r\n    }\r\n};\r\n/**\r\n * @internal\r\n */\r\nconst validatePathString = function (fnName, argumentName, pathString, optional) {\r\n    if (optional && pathString === undefined) {\r\n        return;\r\n    }\r\n    if (!isValidPathString(pathString)) {\r\n        throw new Error(errorPrefix(fnName, argumentName) +\r\n            'was an invalid path = \"' +\r\n            pathString +\r\n            '\". Paths must be non-empty strings and ' +\r\n            'can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\"');\r\n    }\r\n};\r\nconst validateRootPathString = function (fnName, argumentName, pathString, optional) {\r\n    if (pathString) {\r\n        // Allow '/.info/' at the beginning.\r\n        pathString = pathString.replace(/^\\/*\\.info(\\/|$)/, '/');\r\n    }\r\n    validatePathString(fnName, argumentName, pathString, optional);\r\n};\r\n/**\r\n * @internal\r\n */\r\nconst validateWritablePath = function (fnName, path) {\r\n    if (pathGetFront(path) === '.info') {\r\n        throw new Error(fnName + \" failed = Can't modify data under /.info/\");\r\n    }\r\n};\r\nconst validateUrl = function (fnName, parsedUrl) {\r\n    // TODO = Validate server better.\r\n    const pathString = parsedUrl.path.toString();\r\n    if (!(typeof parsedUrl.repoInfo.host === 'string') ||\r\n        parsedUrl.repoInfo.host.length === 0 ||\r\n        (!isValidKey(parsedUrl.repoInfo.namespace) &&\r\n            parsedUrl.repoInfo.host.split(':')[0] !== 'localhost') ||\r\n        (pathString.length !== 0 && !isValidRootPathString(pathString))) {\r\n        throw new Error(errorPrefix(fnName, 'url') +\r\n            'must be a valid firebase URL and ' +\r\n            'the path can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\".');\r\n    }\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The event queue serves a few purposes:\r\n * 1. It ensures we maintain event order in the face of event callbacks doing operations that result in more\r\n *    events being queued.\r\n * 2. raiseQueuedEvents() handles being called reentrantly nicely.  That is, if in the course of raising events,\r\n *    raiseQueuedEvents() is called again, the \"inner\" call will pick up raising events where the \"outer\" call\r\n *    left off, ensuring that the events are still raised synchronously and in order.\r\n * 3. You can use raiseEventsAtPath and raiseEventsForChangedPath to ensure only relevant previously-queued\r\n *    events are raised synchronously.\r\n *\r\n * NOTE: This can all go away if/when we move to async events.\r\n *\r\n */\r\nclass EventQueue {\r\n    constructor() {\r\n        this.eventLists_ = [];\r\n        /**\r\n         * Tracks recursion depth of raiseQueuedEvents_, for debugging purposes.\r\n         */\r\n        this.recursionDepth_ = 0;\r\n    }\r\n}\r\n/**\r\n * @param eventDataList - The new events to queue.\r\n */\r\nfunction eventQueueQueueEvents(eventQueue, eventDataList) {\r\n    // We group events by path, storing them in a single EventList, to make it easier to skip over them quickly.\r\n    let currList = null;\r\n    for (let i = 0; i < eventDataList.length; i++) {\r\n        const data = eventDataList[i];\r\n        const path = data.getPath();\r\n        if (currList !== null && !pathEquals(path, currList.path)) {\r\n            eventQueue.eventLists_.push(currList);\r\n            currList = null;\r\n        }\r\n        if (currList === null) {\r\n            currList = { events: [], path };\r\n        }\r\n        currList.events.push(data);\r\n    }\r\n    if (currList) {\r\n        eventQueue.eventLists_.push(currList);\r\n    }\r\n}\r\n/**\r\n * Queues the specified events and synchronously raises all events (including previously queued ones)\r\n * for the specified path.\r\n *\r\n * It is assumed that the new events are all for the specified path.\r\n *\r\n * @param path - The path to raise events for.\r\n * @param eventDataList - The new events to raise.\r\n */\r\nfunction eventQueueRaiseEventsAtPath(eventQueue, path, eventDataList) {\r\n    eventQueueQueueEvents(eventQueue, eventDataList);\r\n    eventQueueRaiseQueuedEventsMatchingPredicate(eventQueue, eventPath => pathEquals(eventPath, path));\r\n}\r\n/**\r\n * Queues the specified events and synchronously raises all events (including previously queued ones) for\r\n * locations related to the specified change path (i.e. all ancestors and descendants).\r\n *\r\n * It is assumed that the new events are all related (ancestor or descendant) to the specified path.\r\n *\r\n * @param changedPath - The path to raise events for.\r\n * @param eventDataList - The events to raise\r\n */\r\nfunction eventQueueRaiseEventsForChangedPath(eventQueue, changedPath, eventDataList) {\r\n    eventQueueQueueEvents(eventQueue, eventDataList);\r\n    eventQueueRaiseQueuedEventsMatchingPredicate(eventQueue, eventPath => pathContains(eventPath, changedPath) ||\r\n        pathContains(changedPath, eventPath));\r\n}\r\nfunction eventQueueRaiseQueuedEventsMatchingPredicate(eventQueue, predicate) {\r\n    eventQueue.recursionDepth_++;\r\n    let sentAll = true;\r\n    for (let i = 0; i < eventQueue.eventLists_.length; i++) {\r\n        const eventList = eventQueue.eventLists_[i];\r\n        if (eventList) {\r\n            const eventPath = eventList.path;\r\n            if (predicate(eventPath)) {\r\n                eventListRaise(eventQueue.eventLists_[i]);\r\n                eventQueue.eventLists_[i] = null;\r\n            }\r\n            else {\r\n                sentAll = false;\r\n            }\r\n        }\r\n    }\r\n    if (sentAll) {\r\n        eventQueue.eventLists_ = [];\r\n    }\r\n    eventQueue.recursionDepth_--;\r\n}\r\n/**\r\n * Iterates through the list and raises each event\r\n */\r\nfunction eventListRaise(eventList) {\r\n    for (let i = 0; i < eventList.events.length; i++) {\r\n        const eventData = eventList.events[i];\r\n        if (eventData !== null) {\r\n            eventList.events[i] = null;\r\n            const eventFn = eventData.getEventRunner();\r\n            if (logger) {\r\n                log('event: ' + eventData.toString());\r\n            }\r\n            exceptionGuard(eventFn);\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst INTERRUPT_REASON = 'repo_interrupt';\r\n/**\r\n * If a transaction does not succeed after 25 retries, we abort it. Among other\r\n * things this ensure that if there's ever a bug causing a mismatch between\r\n * client / server hashes for some data, we won't retry indefinitely.\r\n */\r\nconst MAX_TRANSACTION_RETRIES = 25;\r\n/**\r\n * A connection to a single data repository.\r\n */\r\nclass Repo {\r\n    constructor(repoInfo_, forceRestClient_, authTokenProvider_, appCheckProvider_) {\r\n        this.repoInfo_ = repoInfo_;\r\n        this.forceRestClient_ = forceRestClient_;\r\n        this.authTokenProvider_ = authTokenProvider_;\r\n        this.appCheckProvider_ = appCheckProvider_;\r\n        this.dataUpdateCount = 0;\r\n        this.statsListener_ = null;\r\n        this.eventQueue_ = new EventQueue();\r\n        this.nextWriteId_ = 1;\r\n        this.interceptServerDataCallback_ = null;\r\n        /** A list of data pieces and paths to be set when this client disconnects. */\r\n        this.onDisconnect_ = newSparseSnapshotTree();\r\n        /** Stores queues of outstanding transactions for Firebase locations. */\r\n        this.transactionQueueTree_ = new Tree();\r\n        // TODO: This should be @private but it's used by test_access.js and internal.js\r\n        this.persistentConnection_ = null;\r\n        // This key is intentionally not updated if RepoInfo is later changed or replaced\r\n        this.key = this.repoInfo_.toURLString();\r\n    }\r\n    /**\r\n     * @returns The URL corresponding to the root of this Firebase.\r\n     */\r\n    toString() {\r\n        return ((this.repoInfo_.secure ? 'https://' : 'http://') + this.repoInfo_.host);\r\n    }\r\n}\r\nfunction repoStart(repo, appId, authOverride) {\r\n    repo.stats_ = statsManagerGetCollection(repo.repoInfo_);\r\n    if (repo.forceRestClient_ || beingCrawled()) {\r\n        repo.server_ = new ReadonlyRestClient(repo.repoInfo_, (pathString, data, isMerge, tag) => {\r\n            repoOnDataUpdate(repo, pathString, data, isMerge, tag);\r\n        }, repo.authTokenProvider_, repo.appCheckProvider_);\r\n        // Minor hack: Fire onConnect immediately, since there's no actual connection.\r\n        setTimeout(() => repoOnConnectStatus(repo, /* connectStatus= */ true), 0);\r\n    }\r\n    else {\r\n        // Validate authOverride\r\n        if (typeof authOverride !== 'undefined' && authOverride !== null) {\r\n            if (typeof authOverride !== 'object') {\r\n                throw new Error('Only objects are supported for option databaseAuthVariableOverride');\r\n            }\r\n            try {\r\n                stringify(authOverride);\r\n            }\r\n            catch (e) {\r\n                throw new Error('Invalid authOverride provided: ' + e);\r\n            }\r\n        }\r\n        repo.persistentConnection_ = new PersistentConnection(repo.repoInfo_, appId, (pathString, data, isMerge, tag) => {\r\n            repoOnDataUpdate(repo, pathString, data, isMerge, tag);\r\n        }, (connectStatus) => {\r\n            repoOnConnectStatus(repo, connectStatus);\r\n        }, (updates) => {\r\n            repoOnServerInfoUpdate(repo, updates);\r\n        }, repo.authTokenProvider_, repo.appCheckProvider_, authOverride);\r\n        repo.server_ = repo.persistentConnection_;\r\n    }\r\n    repo.authTokenProvider_.addTokenChangeListener(token => {\r\n        repo.server_.refreshAuthToken(token);\r\n    });\r\n    repo.appCheckProvider_.addTokenChangeListener(result => {\r\n        repo.server_.refreshAppCheckToken(result.token);\r\n    });\r\n    // In the case of multiple Repos for the same repoInfo (i.e. there are multiple Firebase.Contexts being used),\r\n    // we only want to create one StatsReporter.  As such, we'll report stats over the first Repo created.\r\n    repo.statsReporter_ = statsManagerGetOrCreateReporter(repo.repoInfo_, () => new StatsReporter(repo.stats_, repo.server_));\r\n    // Used for .info.\r\n    repo.infoData_ = new SnapshotHolder();\r\n    repo.infoSyncTree_ = new SyncTree({\r\n        startListening: (query, tag, currentHashFn, onComplete) => {\r\n            let infoEvents = [];\r\n            const node = repo.infoData_.getNode(query._path);\r\n            // This is possibly a hack, but we have different semantics for .info endpoints. We don't raise null events\r\n            // on initial data...\r\n            if (!node.isEmpty()) {\r\n                infoEvents = syncTreeApplyServerOverwrite(repo.infoSyncTree_, query._path, node);\r\n                setTimeout(() => {\r\n                    onComplete('ok');\r\n                }, 0);\r\n            }\r\n            return infoEvents;\r\n        },\r\n        stopListening: () => { }\r\n    });\r\n    repoUpdateInfo(repo, 'connected', false);\r\n    repo.serverSyncTree_ = new SyncTree({\r\n        startListening: (query, tag, currentHashFn, onComplete) => {\r\n            repo.server_.listen(query, currentHashFn, tag, (status, data) => {\r\n                const events = onComplete(status, data);\r\n                eventQueueRaiseEventsForChangedPath(repo.eventQueue_, query._path, events);\r\n            });\r\n            // No synchronous events for network-backed sync trees\r\n            return [];\r\n        },\r\n        stopListening: (query, tag) => {\r\n            repo.server_.unlisten(query, tag);\r\n        }\r\n    });\r\n}\r\n/**\r\n * @returns The time in milliseconds, taking the server offset into account if we have one.\r\n */\r\nfunction repoServerTime(repo) {\r\n    const offsetNode = repo.infoData_.getNode(new Path('.info/serverTimeOffset'));\r\n    const offset = offsetNode.val() || 0;\r\n    return new Date().getTime() + offset;\r\n}\r\n/**\r\n * Generate ServerValues using some variables from the repo object.\r\n */\r\nfunction repoGenerateServerValues(repo) {\r\n    return generateWithValues({\r\n        timestamp: repoServerTime(repo)\r\n    });\r\n}\r\n/**\r\n * Called by realtime when we get new messages from the server.\r\n */\r\nfunction repoOnDataUpdate(repo, pathString, data, isMerge, tag) {\r\n    // For testing.\r\n    repo.dataUpdateCount++;\r\n    const path = new Path(pathString);\r\n    data = repo.interceptServerDataCallback_\r\n        ? repo.interceptServerDataCallback_(pathString, data)\r\n        : data;\r\n    let events = [];\r\n    if (tag) {\r\n        if (isMerge) {\r\n            const taggedChildren = map(data, (raw) => nodeFromJSON(raw));\r\n            events = syncTreeApplyTaggedQueryMerge(repo.serverSyncTree_, path, taggedChildren, tag);\r\n        }\r\n        else {\r\n            const taggedSnap = nodeFromJSON(data);\r\n            events = syncTreeApplyTaggedQueryOverwrite(repo.serverSyncTree_, path, taggedSnap, tag);\r\n        }\r\n    }\r\n    else if (isMerge) {\r\n        const changedChildren = map(data, (raw) => nodeFromJSON(raw));\r\n        events = syncTreeApplyServerMerge(repo.serverSyncTree_, path, changedChildren);\r\n    }\r\n    else {\r\n        const snap = nodeFromJSON(data);\r\n        events = syncTreeApplyServerOverwrite(repo.serverSyncTree_, path, snap);\r\n    }\r\n    let affectedPath = path;\r\n    if (events.length > 0) {\r\n        // Since we have a listener outstanding for each transaction, receiving any events\r\n        // is a proxy for some change having occurred.\r\n        affectedPath = repoRerunTransactions(repo, path);\r\n    }\r\n    eventQueueRaiseEventsForChangedPath(repo.eventQueue_, affectedPath, events);\r\n}\r\nfunction repoOnConnectStatus(repo, connectStatus) {\r\n    repoUpdateInfo(repo, 'connected', connectStatus);\r\n    if (connectStatus === false) {\r\n        repoRunOnDisconnectEvents(repo);\r\n    }\r\n}\r\nfunction repoOnServerInfoUpdate(repo, updates) {\r\n    each(updates, (key, value) => {\r\n        repoUpdateInfo(repo, key, value);\r\n    });\r\n}\r\nfunction repoUpdateInfo(repo, pathString, value) {\r\n    const path = new Path('/.info/' + pathString);\r\n    const newNode = nodeFromJSON(value);\r\n    repo.infoData_.updateSnapshot(path, newNode);\r\n    const events = syncTreeApplyServerOverwrite(repo.infoSyncTree_, path, newNode);\r\n    eventQueueRaiseEventsForChangedPath(repo.eventQueue_, path, events);\r\n}\r\nfunction repoGetNextWriteId(repo) {\r\n    return repo.nextWriteId_++;\r\n}\r\n/**\r\n * The purpose of `getValue` is to return the latest known value\r\n * satisfying `query`.\r\n *\r\n * This method will first check for in-memory cached values\r\n * belonging to active listeners. If they are found, such values\r\n * are considered to be the most up-to-date.\r\n *\r\n * If the client is not connected, this method will wait until the\r\n *  repo has established a connection and then request the value for `query`.\r\n * If the client is not able to retrieve the query result for another reason,\r\n * it reports an error.\r\n *\r\n * @param query - The query to surface a value for.\r\n */\r\nfunction repoGetValue(repo, query, eventRegistration) {\r\n    // Only active queries are cached. There is no persisted cache.\r\n    const cached = syncTreeGetServerValue(repo.serverSyncTree_, query);\r\n    if (cached != null) {\r\n        return Promise.resolve(cached);\r\n    }\r\n    return repo.server_.get(query).then(payload => {\r\n        const node = nodeFromJSON(payload).withIndex(query._queryParams.getIndex());\r\n        /**\r\n         * Below we simulate the actions of an `onlyOnce` `onValue()` event where:\r\n         * Add an event registration,\r\n         * Update data at the path,\r\n         * Raise any events,\r\n         * Cleanup the SyncTree\r\n         */\r\n        syncTreeAddEventRegistration(repo.serverSyncTree_, query, eventRegistration, true);\r\n        let events;\r\n        if (query._queryParams.loadsAllData()) {\r\n            events = syncTreeApplyServerOverwrite(repo.serverSyncTree_, query._path, node);\r\n        }\r\n        else {\r\n            const tag = syncTreeTagForQuery(repo.serverSyncTree_, query);\r\n            events = syncTreeApplyTaggedQueryOverwrite(repo.serverSyncTree_, query._path, node, tag);\r\n        }\r\n        /*\r\n         * We need to raise events in the scenario where `get()` is called at a parent path, and\r\n         * while the `get()` is pending, `onValue` is called at a child location. While get() is waiting\r\n         * for the data, `onValue` will register a new event. Then, get() will come back, and update the syncTree\r\n         * and its corresponding serverCache, including the child location where `onValue` is called. Then,\r\n         * `onValue` will receive the event from the server, but look at the syncTree and see that the data received\r\n         * from the server is already at the SyncPoint, and so the `onValue` callback will never get fired.\r\n         * Calling `eventQueueRaiseEventsForChangedPath()` is the correct way to propagate the events and\r\n         * ensure the corresponding child events will get fired.\r\n         */\r\n        eventQueueRaiseEventsForChangedPath(repo.eventQueue_, query._path, events);\r\n        syncTreeRemoveEventRegistration(repo.serverSyncTree_, query, eventRegistration, null, true);\r\n        return node;\r\n    }, err => {\r\n        repoLog(repo, 'get for query ' + stringify(query) + ' failed: ' + err);\r\n        return Promise.reject(new Error(err));\r\n    });\r\n}\r\nfunction repoSetWithPriority(repo, path, newVal, newPriority, onComplete) {\r\n    repoLog(repo, 'set', {\r\n        path: path.toString(),\r\n        value: newVal,\r\n        priority: newPriority\r\n    });\r\n    // TODO: Optimize this behavior to either (a) store flag to skip resolving where possible and / or\r\n    // (b) store unresolved paths on JSON parse\r\n    const serverValues = repoGenerateServerValues(repo);\r\n    const newNodeUnresolved = nodeFromJSON(newVal, newPriority);\r\n    const existing = syncTreeCalcCompleteEventCache(repo.serverSyncTree_, path);\r\n    const newNode = resolveDeferredValueSnapshot(newNodeUnresolved, existing, serverValues);\r\n    const writeId = repoGetNextWriteId(repo);\r\n    const events = syncTreeApplyUserOverwrite(repo.serverSyncTree_, path, newNode, writeId, true);\r\n    eventQueueQueueEvents(repo.eventQueue_, events);\r\n    repo.server_.put(path.toString(), newNodeUnresolved.val(/*export=*/ true), (status, errorReason) => {\r\n        const success = status === 'ok';\r\n        if (!success) {\r\n            warn('set at ' + path + ' failed: ' + status);\r\n        }\r\n        const clearEvents = syncTreeAckUserWrite(repo.serverSyncTree_, writeId, !success);\r\n        eventQueueRaiseEventsForChangedPath(repo.eventQueue_, path, clearEvents);\r\n        repoCallOnCompleteCallback(repo, onComplete, status, errorReason);\r\n    });\r\n    const affectedPath = repoAbortTransactions(repo, path);\r\n    repoRerunTransactions(repo, affectedPath);\r\n    // We queued the events above, so just flush the queue here\r\n    eventQueueRaiseEventsForChangedPath(repo.eventQueue_, affectedPath, []);\r\n}\r\nfunction repoUpdate(repo, path, childrenToMerge, onComplete) {\r\n    repoLog(repo, 'update', { path: path.toString(), value: childrenToMerge });\r\n    // Start with our existing data and merge each child into it.\r\n    let empty = true;\r\n    const serverValues = repoGenerateServerValues(repo);\r\n    const changedChildren = {};\r\n    each(childrenToMerge, (changedKey, changedValue) => {\r\n        empty = false;\r\n        changedChildren[changedKey] = resolveDeferredValueTree(pathChild(path, changedKey), nodeFromJSON(changedValue), repo.serverSyncTree_, serverValues);\r\n    });\r\n    if (!empty) {\r\n        const writeId = repoGetNextWriteId(repo);\r\n        const events = syncTreeApplyUserMerge(repo.serverSyncTree_, path, changedChildren, writeId);\r\n        eventQueueQueueEvents(repo.eventQueue_, events);\r\n        repo.server_.merge(path.toString(), childrenToMerge, (status, errorReason) => {\r\n            const success = status === 'ok';\r\n            if (!success) {\r\n                warn('update at ' + path + ' failed: ' + status);\r\n            }\r\n            const clearEvents = syncTreeAckUserWrite(repo.serverSyncTree_, writeId, !success);\r\n            const affectedPath = clearEvents.length > 0 ? repoRerunTransactions(repo, path) : path;\r\n            eventQueueRaiseEventsForChangedPath(repo.eventQueue_, affectedPath, clearEvents);\r\n            repoCallOnCompleteCallback(repo, onComplete, status, errorReason);\r\n        });\r\n        each(childrenToMerge, (changedPath) => {\r\n            const affectedPath = repoAbortTransactions(repo, pathChild(path, changedPath));\r\n            repoRerunTransactions(repo, affectedPath);\r\n        });\r\n        // We queued the events above, so just flush the queue here\r\n        eventQueueRaiseEventsForChangedPath(repo.eventQueue_, path, []);\r\n    }\r\n    else {\r\n        log(\"update() called with empty data.  Don't do anything.\");\r\n        repoCallOnCompleteCallback(repo, onComplete, 'ok', undefined);\r\n    }\r\n}\r\n/**\r\n * Applies all of the changes stored up in the onDisconnect_ tree.\r\n */\r\nfunction repoRunOnDisconnectEvents(repo) {\r\n    repoLog(repo, 'onDisconnectEvents');\r\n    const serverValues = repoGenerateServerValues(repo);\r\n    const resolvedOnDisconnectTree = newSparseSnapshotTree();\r\n    sparseSnapshotTreeForEachTree(repo.onDisconnect_, newEmptyPath(), (path, node) => {\r\n        const resolved = resolveDeferredValueTree(path, node, repo.serverSyncTree_, serverValues);\r\n        sparseSnapshotTreeRemember(resolvedOnDisconnectTree, path, resolved);\r\n    });\r\n    let events = [];\r\n    sparseSnapshotTreeForEachTree(resolvedOnDisconnectTree, newEmptyPath(), (path, snap) => {\r\n        events = events.concat(syncTreeApplyServerOverwrite(repo.serverSyncTree_, path, snap));\r\n        const affectedPath = repoAbortTransactions(repo, path);\r\n        repoRerunTransactions(repo, affectedPath);\r\n    });\r\n    repo.onDisconnect_ = newSparseSnapshotTree();\r\n    eventQueueRaiseEventsForChangedPath(repo.eventQueue_, newEmptyPath(), events);\r\n}\r\nfunction repoOnDisconnectCancel(repo, path, onComplete) {\r\n    repo.server_.onDisconnectCancel(path.toString(), (status, errorReason) => {\r\n        if (status === 'ok') {\r\n            sparseSnapshotTreeForget(repo.onDisconnect_, path);\r\n        }\r\n        repoCallOnCompleteCallback(repo, onComplete, status, errorReason);\r\n    });\r\n}\r\nfunction repoOnDisconnectSet(repo, path, value, onComplete) {\r\n    const newNode = nodeFromJSON(value);\r\n    repo.server_.onDisconnectPut(path.toString(), newNode.val(/*export=*/ true), (status, errorReason) => {\r\n        if (status === 'ok') {\r\n            sparseSnapshotTreeRemember(repo.onDisconnect_, path, newNode);\r\n        }\r\n        repoCallOnCompleteCallback(repo, onComplete, status, errorReason);\r\n    });\r\n}\r\nfunction repoOnDisconnectSetWithPriority(repo, path, value, priority, onComplete) {\r\n    const newNode = nodeFromJSON(value, priority);\r\n    repo.server_.onDisconnectPut(path.toString(), newNode.val(/*export=*/ true), (status, errorReason) => {\r\n        if (status === 'ok') {\r\n            sparseSnapshotTreeRemember(repo.onDisconnect_, path, newNode);\r\n        }\r\n        repoCallOnCompleteCallback(repo, onComplete, status, errorReason);\r\n    });\r\n}\r\nfunction repoOnDisconnectUpdate(repo, path, childrenToMerge, onComplete) {\r\n    if (isEmpty(childrenToMerge)) {\r\n        log(\"onDisconnect().update() called with empty data.  Don't do anything.\");\r\n        repoCallOnCompleteCallback(repo, onComplete, 'ok', undefined);\r\n        return;\r\n    }\r\n    repo.server_.onDisconnectMerge(path.toString(), childrenToMerge, (status, errorReason) => {\r\n        if (status === 'ok') {\r\n            each(childrenToMerge, (childName, childNode) => {\r\n                const newChildNode = nodeFromJSON(childNode);\r\n                sparseSnapshotTreeRemember(repo.onDisconnect_, pathChild(path, childName), newChildNode);\r\n            });\r\n        }\r\n        repoCallOnCompleteCallback(repo, onComplete, status, errorReason);\r\n    });\r\n}\r\nfunction repoAddEventCallbackForQuery(repo, query, eventRegistration) {\r\n    let events;\r\n    if (pathGetFront(query._path) === '.info') {\r\n        events = syncTreeAddEventRegistration(repo.infoSyncTree_, query, eventRegistration);\r\n    }\r\n    else {\r\n        events = syncTreeAddEventRegistration(repo.serverSyncTree_, query, eventRegistration);\r\n    }\r\n    eventQueueRaiseEventsAtPath(repo.eventQueue_, query._path, events);\r\n}\r\nfunction repoRemoveEventCallbackForQuery(repo, query, eventRegistration) {\r\n    // These are guaranteed not to raise events, since we're not passing in a cancelError. However, we can future-proof\r\n    // a little bit by handling the return values anyways.\r\n    let events;\r\n    if (pathGetFront(query._path) === '.info') {\r\n        events = syncTreeRemoveEventRegistration(repo.infoSyncTree_, query, eventRegistration);\r\n    }\r\n    else {\r\n        events = syncTreeRemoveEventRegistration(repo.serverSyncTree_, query, eventRegistration);\r\n    }\r\n    eventQueueRaiseEventsAtPath(repo.eventQueue_, query._path, events);\r\n}\r\nfunction repoInterrupt(repo) {\r\n    if (repo.persistentConnection_) {\r\n        repo.persistentConnection_.interrupt(INTERRUPT_REASON);\r\n    }\r\n}\r\nfunction repoResume(repo) {\r\n    if (repo.persistentConnection_) {\r\n        repo.persistentConnection_.resume(INTERRUPT_REASON);\r\n    }\r\n}\r\nfunction repoLog(repo, ...varArgs) {\r\n    let prefix = '';\r\n    if (repo.persistentConnection_) {\r\n        prefix = repo.persistentConnection_.id + ':';\r\n    }\r\n    log(prefix, ...varArgs);\r\n}\r\nfunction repoCallOnCompleteCallback(repo, callback, status, errorReason) {\r\n    if (callback) {\r\n        exceptionGuard(() => {\r\n            if (status === 'ok') {\r\n                callback(null);\r\n            }\r\n            else {\r\n                const code = (status || 'error').toUpperCase();\r\n                let message = code;\r\n                if (errorReason) {\r\n                    message += ': ' + errorReason;\r\n                }\r\n                const error = new Error(message);\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                error.code = code;\r\n                callback(error);\r\n            }\r\n        });\r\n    }\r\n}\r\n/**\r\n * Creates a new transaction, adds it to the transactions we're tracking, and\r\n * sends it to the server if possible.\r\n *\r\n * @param path - Path at which to do transaction.\r\n * @param transactionUpdate - Update callback.\r\n * @param onComplete - Completion callback.\r\n * @param unwatcher - Function that will be called when the transaction no longer\r\n * need data updates for `path`.\r\n * @param applyLocally - Whether or not to make intermediate results visible\r\n */\r\nfunction repoStartTransaction(repo, path, transactionUpdate, onComplete, unwatcher, applyLocally) {\r\n    repoLog(repo, 'transaction on ' + path);\r\n    // Initialize transaction.\r\n    const transaction = {\r\n        path,\r\n        update: transactionUpdate,\r\n        onComplete,\r\n        // One of TransactionStatus enums.\r\n        status: null,\r\n        // Used when combining transactions at different locations to figure out\r\n        // which one goes first.\r\n        order: LUIDGenerator(),\r\n        // Whether to raise local events for this transaction.\r\n        applyLocally,\r\n        // Count of how many times we've retried the transaction.\r\n        retryCount: 0,\r\n        // Function to call to clean up our .on() listener.\r\n        unwatcher,\r\n        // Stores why a transaction was aborted.\r\n        abortReason: null,\r\n        currentWriteId: null,\r\n        currentInputSnapshot: null,\r\n        currentOutputSnapshotRaw: null,\r\n        currentOutputSnapshotResolved: null\r\n    };\r\n    // Run transaction initially.\r\n    const currentState = repoGetLatestState(repo, path, undefined);\r\n    transaction.currentInputSnapshot = currentState;\r\n    const newVal = transaction.update(currentState.val());\r\n    if (newVal === undefined) {\r\n        // Abort transaction.\r\n        transaction.unwatcher();\r\n        transaction.currentOutputSnapshotRaw = null;\r\n        transaction.currentOutputSnapshotResolved = null;\r\n        if (transaction.onComplete) {\r\n            transaction.onComplete(null, false, transaction.currentInputSnapshot);\r\n        }\r\n    }\r\n    else {\r\n        validateFirebaseData('transaction failed: Data returned ', newVal, transaction.path);\r\n        // Mark as run and add to our queue.\r\n        transaction.status = 0 /* TransactionStatus.RUN */;\r\n        const queueNode = treeSubTree(repo.transactionQueueTree_, path);\r\n        const nodeQueue = treeGetValue(queueNode) || [];\r\n        nodeQueue.push(transaction);\r\n        treeSetValue(queueNode, nodeQueue);\r\n        // Update visibleData and raise events\r\n        // Note: We intentionally raise events after updating all of our\r\n        // transaction state, since the user could start new transactions from the\r\n        // event callbacks.\r\n        let priorityForNode;\r\n        if (typeof newVal === 'object' &&\r\n            newVal !== null &&\r\n            contains(newVal, '.priority')) {\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            priorityForNode = safeGet(newVal, '.priority');\r\n            assert(isValidPriority(priorityForNode), 'Invalid priority returned by transaction. ' +\r\n                'Priority must be a valid string, finite number, server value, or null.');\r\n        }\r\n        else {\r\n            const currentNode = syncTreeCalcCompleteEventCache(repo.serverSyncTree_, path) ||\r\n                ChildrenNode.EMPTY_NODE;\r\n            priorityForNode = currentNode.getPriority().val();\r\n        }\r\n        const serverValues = repoGenerateServerValues(repo);\r\n        const newNodeUnresolved = nodeFromJSON(newVal, priorityForNode);\r\n        const newNode = resolveDeferredValueSnapshot(newNodeUnresolved, currentState, serverValues);\r\n        transaction.currentOutputSnapshotRaw = newNodeUnresolved;\r\n        transaction.currentOutputSnapshotResolved = newNode;\r\n        transaction.currentWriteId = repoGetNextWriteId(repo);\r\n        const events = syncTreeApplyUserOverwrite(repo.serverSyncTree_, path, newNode, transaction.currentWriteId, transaction.applyLocally);\r\n        eventQueueRaiseEventsForChangedPath(repo.eventQueue_, path, events);\r\n        repoSendReadyTransactions(repo, repo.transactionQueueTree_);\r\n    }\r\n}\r\n/**\r\n * @param excludeSets - A specific set to exclude\r\n */\r\nfunction repoGetLatestState(repo, path, excludeSets) {\r\n    return (syncTreeCalcCompleteEventCache(repo.serverSyncTree_, path, excludeSets) ||\r\n        ChildrenNode.EMPTY_NODE);\r\n}\r\n/**\r\n * Sends any already-run transactions that aren't waiting for outstanding\r\n * transactions to complete.\r\n *\r\n * Externally it's called with no arguments, but it calls itself recursively\r\n * with a particular transactionQueueTree node to recurse through the tree.\r\n *\r\n * @param node - transactionQueueTree node to start at.\r\n */\r\nfunction repoSendReadyTransactions(repo, node = repo.transactionQueueTree_) {\r\n    // Before recursing, make sure any completed transactions are removed.\r\n    if (!node) {\r\n        repoPruneCompletedTransactionsBelowNode(repo, node);\r\n    }\r\n    if (treeGetValue(node)) {\r\n        const queue = repoBuildTransactionQueue(repo, node);\r\n        assert(queue.length > 0, 'Sending zero length transaction queue');\r\n        const allRun = queue.every((transaction) => transaction.status === 0 /* TransactionStatus.RUN */);\r\n        // If they're all run (and not sent), we can send them.  Else, we must wait.\r\n        if (allRun) {\r\n            repoSendTransactionQueue(repo, treeGetPath(node), queue);\r\n        }\r\n    }\r\n    else if (treeHasChildren(node)) {\r\n        treeForEachChild(node, childNode => {\r\n            repoSendReadyTransactions(repo, childNode);\r\n        });\r\n    }\r\n}\r\n/**\r\n * Given a list of run transactions, send them to the server and then handle\r\n * the result (success or failure).\r\n *\r\n * @param path - The location of the queue.\r\n * @param queue - Queue of transactions under the specified location.\r\n */\r\nfunction repoSendTransactionQueue(repo, path, queue) {\r\n    // Mark transactions as sent and increment retry count!\r\n    const setsToIgnore = queue.map(txn => {\r\n        return txn.currentWriteId;\r\n    });\r\n    const latestState = repoGetLatestState(repo, path, setsToIgnore);\r\n    let snapToSend = latestState;\r\n    const latestHash = latestState.hash();\r\n    for (let i = 0; i < queue.length; i++) {\r\n        const txn = queue[i];\r\n        assert(txn.status === 0 /* TransactionStatus.RUN */, 'tryToSendTransactionQueue_: items in queue should all be run.');\r\n        txn.status = 1 /* TransactionStatus.SENT */;\r\n        txn.retryCount++;\r\n        const relativePath = newRelativePath(path, txn.path);\r\n        // If we've gotten to this point, the output snapshot must be defined.\r\n        snapToSend = snapToSend.updateChild(relativePath /** @type {!Node} */, txn.currentOutputSnapshotRaw);\r\n    }\r\n    const dataToSend = snapToSend.val(true);\r\n    const pathToSend = path;\r\n    // Send the put.\r\n    repo.server_.put(pathToSend.toString(), dataToSend, (status) => {\r\n        repoLog(repo, 'transaction put response', {\r\n            path: pathToSend.toString(),\r\n            status\r\n        });\r\n        let events = [];\r\n        if (status === 'ok') {\r\n            // Queue up the callbacks and fire them after cleaning up all of our\r\n            // transaction state, since the callback could trigger more\r\n            // transactions or sets.\r\n            const callbacks = [];\r\n            for (let i = 0; i < queue.length; i++) {\r\n                queue[i].status = 2 /* TransactionStatus.COMPLETED */;\r\n                events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, queue[i].currentWriteId));\r\n                if (queue[i].onComplete) {\r\n                    // We never unset the output snapshot, and given that this\r\n                    // transaction is complete, it should be set\r\n                    callbacks.push(() => queue[i].onComplete(null, true, queue[i].currentOutputSnapshotResolved));\r\n                }\r\n                queue[i].unwatcher();\r\n            }\r\n            // Now remove the completed transactions.\r\n            repoPruneCompletedTransactionsBelowNode(repo, treeSubTree(repo.transactionQueueTree_, path));\r\n            // There may be pending transactions that we can now send.\r\n            repoSendReadyTransactions(repo, repo.transactionQueueTree_);\r\n            eventQueueRaiseEventsForChangedPath(repo.eventQueue_, path, events);\r\n            // Finally, trigger onComplete callbacks.\r\n            for (let i = 0; i < callbacks.length; i++) {\r\n                exceptionGuard(callbacks[i]);\r\n            }\r\n        }\r\n        else {\r\n            // transactions are no longer sent.  Update their status appropriately.\r\n            if (status === 'datastale') {\r\n                for (let i = 0; i < queue.length; i++) {\r\n                    if (queue[i].status === 3 /* TransactionStatus.SENT_NEEDS_ABORT */) {\r\n                        queue[i].status = 4 /* TransactionStatus.NEEDS_ABORT */;\r\n                    }\r\n                    else {\r\n                        queue[i].status = 0 /* TransactionStatus.RUN */;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                warn('transaction at ' + pathToSend.toString() + ' failed: ' + status);\r\n                for (let i = 0; i < queue.length; i++) {\r\n                    queue[i].status = 4 /* TransactionStatus.NEEDS_ABORT */;\r\n                    queue[i].abortReason = status;\r\n                }\r\n            }\r\n            repoRerunTransactions(repo, path);\r\n        }\r\n    }, latestHash);\r\n}\r\n/**\r\n * Finds all transactions dependent on the data at changedPath and reruns them.\r\n *\r\n * Should be called any time cached data changes.\r\n *\r\n * Return the highest path that was affected by rerunning transactions. This\r\n * is the path at which events need to be raised for.\r\n *\r\n * @param changedPath - The path in mergedData that changed.\r\n * @returns The rootmost path that was affected by rerunning transactions.\r\n */\r\nfunction repoRerunTransactions(repo, changedPath) {\r\n    const rootMostTransactionNode = repoGetAncestorTransactionNode(repo, changedPath);\r\n    const path = treeGetPath(rootMostTransactionNode);\r\n    const queue = repoBuildTransactionQueue(repo, rootMostTransactionNode);\r\n    repoRerunTransactionQueue(repo, queue, path);\r\n    return path;\r\n}\r\n/**\r\n * Does all the work of rerunning transactions (as well as cleans up aborted\r\n * transactions and whatnot).\r\n *\r\n * @param queue - The queue of transactions to run.\r\n * @param path - The path the queue is for.\r\n */\r\nfunction repoRerunTransactionQueue(repo, queue, path) {\r\n    if (queue.length === 0) {\r\n        return; // Nothing to do!\r\n    }\r\n    // Queue up the callbacks and fire them after cleaning up all of our\r\n    // transaction state, since the callback could trigger more transactions or\r\n    // sets.\r\n    const callbacks = [];\r\n    let events = [];\r\n    // Ignore all of the sets we're going to re-run.\r\n    const txnsToRerun = queue.filter(q => {\r\n        return q.status === 0 /* TransactionStatus.RUN */;\r\n    });\r\n    const setsToIgnore = txnsToRerun.map(q => {\r\n        return q.currentWriteId;\r\n    });\r\n    for (let i = 0; i < queue.length; i++) {\r\n        const transaction = queue[i];\r\n        const relativePath = newRelativePath(path, transaction.path);\r\n        let abortTransaction = false, abortReason;\r\n        assert(relativePath !== null, 'rerunTransactionsUnderNode_: relativePath should not be null.');\r\n        if (transaction.status === 4 /* TransactionStatus.NEEDS_ABORT */) {\r\n            abortTransaction = true;\r\n            abortReason = transaction.abortReason;\r\n            events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, transaction.currentWriteId, true));\r\n        }\r\n        else if (transaction.status === 0 /* TransactionStatus.RUN */) {\r\n            if (transaction.retryCount >= MAX_TRANSACTION_RETRIES) {\r\n                abortTransaction = true;\r\n                abortReason = 'maxretry';\r\n                events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, transaction.currentWriteId, true));\r\n            }\r\n            else {\r\n                // This code reruns a transaction\r\n                const currentNode = repoGetLatestState(repo, transaction.path, setsToIgnore);\r\n                transaction.currentInputSnapshot = currentNode;\r\n                const newData = queue[i].update(currentNode.val());\r\n                if (newData !== undefined) {\r\n                    validateFirebaseData('transaction failed: Data returned ', newData, transaction.path);\r\n                    let newDataNode = nodeFromJSON(newData);\r\n                    const hasExplicitPriority = typeof newData === 'object' &&\r\n                        newData != null &&\r\n                        contains(newData, '.priority');\r\n                    if (!hasExplicitPriority) {\r\n                        // Keep the old priority if there wasn't a priority explicitly specified.\r\n                        newDataNode = newDataNode.updatePriority(currentNode.getPriority());\r\n                    }\r\n                    const oldWriteId = transaction.currentWriteId;\r\n                    const serverValues = repoGenerateServerValues(repo);\r\n                    const newNodeResolved = resolveDeferredValueSnapshot(newDataNode, currentNode, serverValues);\r\n                    transaction.currentOutputSnapshotRaw = newDataNode;\r\n                    transaction.currentOutputSnapshotResolved = newNodeResolved;\r\n                    transaction.currentWriteId = repoGetNextWriteId(repo);\r\n                    // Mutates setsToIgnore in place\r\n                    setsToIgnore.splice(setsToIgnore.indexOf(oldWriteId), 1);\r\n                    events = events.concat(syncTreeApplyUserOverwrite(repo.serverSyncTree_, transaction.path, newNodeResolved, transaction.currentWriteId, transaction.applyLocally));\r\n                    events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, oldWriteId, true));\r\n                }\r\n                else {\r\n                    abortTransaction = true;\r\n                    abortReason = 'nodata';\r\n                    events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, transaction.currentWriteId, true));\r\n                }\r\n            }\r\n        }\r\n        eventQueueRaiseEventsForChangedPath(repo.eventQueue_, path, events);\r\n        events = [];\r\n        if (abortTransaction) {\r\n            // Abort.\r\n            queue[i].status = 2 /* TransactionStatus.COMPLETED */;\r\n            // Removing a listener can trigger pruning which can muck with\r\n            // mergedData/visibleData (as it prunes data). So defer the unwatcher\r\n            // until we're done.\r\n            (function (unwatcher) {\r\n                setTimeout(unwatcher, Math.floor(0));\r\n            })(queue[i].unwatcher);\r\n            if (queue[i].onComplete) {\r\n                if (abortReason === 'nodata') {\r\n                    callbacks.push(() => queue[i].onComplete(null, false, queue[i].currentInputSnapshot));\r\n                }\r\n                else {\r\n                    callbacks.push(() => queue[i].onComplete(new Error(abortReason), false, null));\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // Clean up completed transactions.\r\n    repoPruneCompletedTransactionsBelowNode(repo, repo.transactionQueueTree_);\r\n    // Now fire callbacks, now that we're in a good, known state.\r\n    for (let i = 0; i < callbacks.length; i++) {\r\n        exceptionGuard(callbacks[i]);\r\n    }\r\n    // Try to send the transaction result to the server.\r\n    repoSendReadyTransactions(repo, repo.transactionQueueTree_);\r\n}\r\n/**\r\n * Returns the rootmost ancestor node of the specified path that has a pending\r\n * transaction on it, or just returns the node for the given path if there are\r\n * no pending transactions on any ancestor.\r\n *\r\n * @param path - The location to start at.\r\n * @returns The rootmost node with a transaction.\r\n */\r\nfunction repoGetAncestorTransactionNode(repo, path) {\r\n    let front;\r\n    // Start at the root and walk deeper into the tree towards path until we\r\n    // find a node with pending transactions.\r\n    let transactionNode = repo.transactionQueueTree_;\r\n    front = pathGetFront(path);\r\n    while (front !== null && treeGetValue(transactionNode) === undefined) {\r\n        transactionNode = treeSubTree(transactionNode, front);\r\n        path = pathPopFront(path);\r\n        front = pathGetFront(path);\r\n    }\r\n    return transactionNode;\r\n}\r\n/**\r\n * Builds the queue of all transactions at or below the specified\r\n * transactionNode.\r\n *\r\n * @param transactionNode\r\n * @returns The generated queue.\r\n */\r\nfunction repoBuildTransactionQueue(repo, transactionNode) {\r\n    // Walk any child transaction queues and aggregate them into a single queue.\r\n    const transactionQueue = [];\r\n    repoAggregateTransactionQueuesForNode(repo, transactionNode, transactionQueue);\r\n    // Sort them by the order the transactions were created.\r\n    transactionQueue.sort((a, b) => a.order - b.order);\r\n    return transactionQueue;\r\n}\r\nfunction repoAggregateTransactionQueuesForNode(repo, node, queue) {\r\n    const nodeQueue = treeGetValue(node);\r\n    if (nodeQueue) {\r\n        for (let i = 0; i < nodeQueue.length; i++) {\r\n            queue.push(nodeQueue[i]);\r\n        }\r\n    }\r\n    treeForEachChild(node, child => {\r\n        repoAggregateTransactionQueuesForNode(repo, child, queue);\r\n    });\r\n}\r\n/**\r\n * Remove COMPLETED transactions at or below this node in the transactionQueueTree_.\r\n */\r\nfunction repoPruneCompletedTransactionsBelowNode(repo, node) {\r\n    const queue = treeGetValue(node);\r\n    if (queue) {\r\n        let to = 0;\r\n        for (let from = 0; from < queue.length; from++) {\r\n            if (queue[from].status !== 2 /* TransactionStatus.COMPLETED */) {\r\n                queue[to] = queue[from];\r\n                to++;\r\n            }\r\n        }\r\n        queue.length = to;\r\n        treeSetValue(node, queue.length > 0 ? queue : undefined);\r\n    }\r\n    treeForEachChild(node, childNode => {\r\n        repoPruneCompletedTransactionsBelowNode(repo, childNode);\r\n    });\r\n}\r\n/**\r\n * Aborts all transactions on ancestors or descendants of the specified path.\r\n * Called when doing a set() or update() since we consider them incompatible\r\n * with transactions.\r\n *\r\n * @param path - Path for which we want to abort related transactions.\r\n */\r\nfunction repoAbortTransactions(repo, path) {\r\n    const affectedPath = treeGetPath(repoGetAncestorTransactionNode(repo, path));\r\n    const transactionNode = treeSubTree(repo.transactionQueueTree_, path);\r\n    treeForEachAncestor(transactionNode, (node) => {\r\n        repoAbortTransactionsOnNode(repo, node);\r\n    });\r\n    repoAbortTransactionsOnNode(repo, transactionNode);\r\n    treeForEachDescendant(transactionNode, (node) => {\r\n        repoAbortTransactionsOnNode(repo, node);\r\n    });\r\n    return affectedPath;\r\n}\r\n/**\r\n * Abort transactions stored in this transaction queue node.\r\n *\r\n * @param node - Node to abort transactions for.\r\n */\r\nfunction repoAbortTransactionsOnNode(repo, node) {\r\n    const queue = treeGetValue(node);\r\n    if (queue) {\r\n        // Queue up the callbacks and fire them after cleaning up all of our\r\n        // transaction state, since the callback could trigger more transactions\r\n        // or sets.\r\n        const callbacks = [];\r\n        // Go through queue.  Any already-sent transactions must be marked for\r\n        // abort, while the unsent ones can be immediately aborted and removed.\r\n        let events = [];\r\n        let lastSent = -1;\r\n        for (let i = 0; i < queue.length; i++) {\r\n            if (queue[i].status === 3 /* TransactionStatus.SENT_NEEDS_ABORT */) ;\r\n            else if (queue[i].status === 1 /* TransactionStatus.SENT */) {\r\n                assert(lastSent === i - 1, 'All SENT items should be at beginning of queue.');\r\n                lastSent = i;\r\n                // Mark transaction for abort when it comes back.\r\n                queue[i].status = 3 /* TransactionStatus.SENT_NEEDS_ABORT */;\r\n                queue[i].abortReason = 'set';\r\n            }\r\n            else {\r\n                assert(queue[i].status === 0 /* TransactionStatus.RUN */, 'Unexpected transaction status in abort');\r\n                // We can abort it immediately.\r\n                queue[i].unwatcher();\r\n                events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, queue[i].currentWriteId, true));\r\n                if (queue[i].onComplete) {\r\n                    callbacks.push(queue[i].onComplete.bind(null, new Error('set'), false, null));\r\n                }\r\n            }\r\n        }\r\n        if (lastSent === -1) {\r\n            // We're not waiting for any sent transactions.  We can clear the queue.\r\n            treeSetValue(node, undefined);\r\n        }\r\n        else {\r\n            // Remove the transactions we aborted.\r\n            queue.length = lastSent + 1;\r\n        }\r\n        // Now fire the callbacks.\r\n        eventQueueRaiseEventsForChangedPath(repo.eventQueue_, treeGetPath(node), events);\r\n        for (let i = 0; i < callbacks.length; i++) {\r\n            exceptionGuard(callbacks[i]);\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction decodePath(pathString) {\r\n    let pathStringDecoded = '';\r\n    const pieces = pathString.split('/');\r\n    for (let i = 0; i < pieces.length; i++) {\r\n        if (pieces[i].length > 0) {\r\n            let piece = pieces[i];\r\n            try {\r\n                piece = decodeURIComponent(piece.replace(/\\+/g, ' '));\r\n            }\r\n            catch (e) { }\r\n            pathStringDecoded += '/' + piece;\r\n        }\r\n    }\r\n    return pathStringDecoded;\r\n}\r\n/**\r\n * @returns key value hash\r\n */\r\nfunction decodeQuery(queryString) {\r\n    const results = {};\r\n    if (queryString.charAt(0) === '?') {\r\n        queryString = queryString.substring(1);\r\n    }\r\n    for (const segment of queryString.split('&')) {\r\n        if (segment.length === 0) {\r\n            continue;\r\n        }\r\n        const kv = segment.split('=');\r\n        if (kv.length === 2) {\r\n            results[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1]);\r\n        }\r\n        else {\r\n            warn(`Invalid query segment '${segment}' in query '${queryString}'`);\r\n        }\r\n    }\r\n    return results;\r\n}\r\nconst parseRepoInfo = function (dataURL, nodeAdmin) {\r\n    const parsedUrl = parseDatabaseURL(dataURL), namespace = parsedUrl.namespace;\r\n    if (parsedUrl.domain === 'firebase.com') {\r\n        fatal(parsedUrl.host +\r\n            ' is no longer supported. ' +\r\n            'Please use <YOUR FIREBASE>.firebaseio.com instead');\r\n    }\r\n    // Catch common error of uninitialized namespace value.\r\n    if ((!namespace || namespace === 'undefined') &&\r\n        parsedUrl.domain !== 'localhost') {\r\n        fatal('Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com');\r\n    }\r\n    if (!parsedUrl.secure) {\r\n        warnIfPageIsSecure();\r\n    }\r\n    const webSocketOnly = parsedUrl.scheme === 'ws' || parsedUrl.scheme === 'wss';\r\n    return {\r\n        repoInfo: new RepoInfo(parsedUrl.host, parsedUrl.secure, namespace, webSocketOnly, nodeAdmin, \r\n        /*persistenceKey=*/ '', \r\n        /*includeNamespaceInQueryParams=*/ namespace !== parsedUrl.subdomain),\r\n        path: new Path(parsedUrl.pathString)\r\n    };\r\n};\r\nconst parseDatabaseURL = function (dataURL) {\r\n    // Default to empty strings in the event of a malformed string.\r\n    let host = '', domain = '', subdomain = '', pathString = '', namespace = '';\r\n    // Always default to SSL, unless otherwise specified.\r\n    let secure = true, scheme = 'https', port = 443;\r\n    // Don't do any validation here. The caller is responsible for validating the result of parsing.\r\n    if (typeof dataURL === 'string') {\r\n        // Parse scheme.\r\n        let colonInd = dataURL.indexOf('//');\r\n        if (colonInd >= 0) {\r\n            scheme = dataURL.substring(0, colonInd - 1);\r\n            dataURL = dataURL.substring(colonInd + 2);\r\n        }\r\n        // Parse host, path, and query string.\r\n        let slashInd = dataURL.indexOf('/');\r\n        if (slashInd === -1) {\r\n            slashInd = dataURL.length;\r\n        }\r\n        let questionMarkInd = dataURL.indexOf('?');\r\n        if (questionMarkInd === -1) {\r\n            questionMarkInd = dataURL.length;\r\n        }\r\n        host = dataURL.substring(0, Math.min(slashInd, questionMarkInd));\r\n        if (slashInd < questionMarkInd) {\r\n            // For pathString, questionMarkInd will always come after slashInd\r\n            pathString = decodePath(dataURL.substring(slashInd, questionMarkInd));\r\n        }\r\n        const queryParams = decodeQuery(dataURL.substring(Math.min(dataURL.length, questionMarkInd)));\r\n        // If we have a port, use scheme for determining if it's secure.\r\n        colonInd = host.indexOf(':');\r\n        if (colonInd >= 0) {\r\n            secure = scheme === 'https' || scheme === 'wss';\r\n            port = parseInt(host.substring(colonInd + 1), 10);\r\n        }\r\n        else {\r\n            colonInd = host.length;\r\n        }\r\n        const hostWithoutPort = host.slice(0, colonInd);\r\n        if (hostWithoutPort.toLowerCase() === 'localhost') {\r\n            domain = 'localhost';\r\n        }\r\n        else if (hostWithoutPort.split('.').length <= 2) {\r\n            domain = hostWithoutPort;\r\n        }\r\n        else {\r\n            // Interpret the subdomain of a 3 or more component URL as the namespace name.\r\n            const dotInd = host.indexOf('.');\r\n            subdomain = host.substring(0, dotInd).toLowerCase();\r\n            domain = host.substring(dotInd + 1);\r\n            // Normalize namespaces to lowercase to share storage / connection.\r\n            namespace = subdomain;\r\n        }\r\n        // Always treat the value of the `ns` as the namespace name if it is present.\r\n        if ('ns' in queryParams) {\r\n            namespace = queryParams['ns'];\r\n        }\r\n    }\r\n    return {\r\n        host,\r\n        port,\r\n        domain,\r\n        subdomain,\r\n        secure,\r\n        scheme,\r\n        pathString,\r\n        namespace\r\n    };\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Modeled after base64 web-safe chars, but ordered by ASCII.\r\nconst PUSH_CHARS = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\r\n/**\r\n * Fancy ID generator that creates 20-character string identifiers with the\r\n * following properties:\r\n *\r\n * 1. They're based on timestamp so that they sort *after* any existing ids.\r\n * 2. They contain 72-bits of random data after the timestamp so that IDs won't\r\n *    collide with other clients' IDs.\r\n * 3. They sort *lexicographically* (so the timestamp is converted to characters\r\n *    that will sort properly).\r\n * 4. They're monotonically increasing. Even if you generate more than one in\r\n *    the same timestamp, the latter ones will sort after the former ones. We do\r\n *    this by using the previous random bits but \"incrementing\" them by 1 (only\r\n *    in the case of a timestamp collision).\r\n */\r\nconst nextPushId = (function () {\r\n    // Timestamp of last push, used to prevent local collisions if you push twice\r\n    // in one ms.\r\n    let lastPushTime = 0;\r\n    // We generate 72-bits of randomness which get turned into 12 characters and\r\n    // appended to the timestamp to prevent collisions with other clients. We\r\n    // store the last characters we generated because in the event of a collision,\r\n    // we'll use those same characters except \"incremented\" by one.\r\n    const lastRandChars = [];\r\n    return function (now) {\r\n        const duplicateTime = now === lastPushTime;\r\n        lastPushTime = now;\r\n        let i;\r\n        const timeStampChars = new Array(8);\r\n        for (i = 7; i >= 0; i--) {\r\n            timeStampChars[i] = PUSH_CHARS.charAt(now % 64);\r\n            // NOTE: Can't use << here because javascript will convert to int and lose\r\n            // the upper bits.\r\n            now = Math.floor(now / 64);\r\n        }\r\n        assert(now === 0, 'Cannot push at time == 0');\r\n        let id = timeStampChars.join('');\r\n        if (!duplicateTime) {\r\n            for (i = 0; i < 12; i++) {\r\n                lastRandChars[i] = Math.floor(Math.random() * 64);\r\n            }\r\n        }\r\n        else {\r\n            // If the timestamp hasn't changed since last push, use the same random\r\n            // number, except incremented by 1.\r\n            for (i = 11; i >= 0 && lastRandChars[i] === 63; i--) {\r\n                lastRandChars[i] = 0;\r\n            }\r\n            lastRandChars[i]++;\r\n        }\r\n        for (i = 0; i < 12; i++) {\r\n            id += PUSH_CHARS.charAt(lastRandChars[i]);\r\n        }\r\n        assert(id.length === 20, 'nextPushId: Length should be 20.');\r\n        return id;\r\n    };\r\n})();\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Encapsulates the data needed to raise an event\r\n */\r\nclass DataEvent {\r\n    /**\r\n     * @param eventType - One of: value, child_added, child_changed, child_moved, child_removed\r\n     * @param eventRegistration - The function to call to with the event data. User provided\r\n     * @param snapshot - The data backing the event\r\n     * @param prevName - Optional, the name of the previous child for child_* events.\r\n     */\r\n    constructor(eventType, eventRegistration, snapshot, prevName) {\r\n        this.eventType = eventType;\r\n        this.eventRegistration = eventRegistration;\r\n        this.snapshot = snapshot;\r\n        this.prevName = prevName;\r\n    }\r\n    getPath() {\r\n        const ref = this.snapshot.ref;\r\n        if (this.eventType === 'value') {\r\n            return ref._path;\r\n        }\r\n        else {\r\n            return ref.parent._path;\r\n        }\r\n    }\r\n    getEventType() {\r\n        return this.eventType;\r\n    }\r\n    getEventRunner() {\r\n        return this.eventRegistration.getEventRunner(this);\r\n    }\r\n    toString() {\r\n        return (this.getPath().toString() +\r\n            ':' +\r\n            this.eventType +\r\n            ':' +\r\n            stringify(this.snapshot.exportVal()));\r\n    }\r\n}\r\nclass CancelEvent {\r\n    constructor(eventRegistration, error, path) {\r\n        this.eventRegistration = eventRegistration;\r\n        this.error = error;\r\n        this.path = path;\r\n    }\r\n    getPath() {\r\n        return this.path;\r\n    }\r\n    getEventType() {\r\n        return 'cancel';\r\n    }\r\n    getEventRunner() {\r\n        return this.eventRegistration.getEventRunner(this);\r\n    }\r\n    toString() {\r\n        return this.path.toString() + ':cancel';\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A wrapper class that converts events from the database@exp SDK to the legacy\r\n * Database SDK. Events are not converted directly as event registration relies\r\n * on reference comparison of the original user callback (see `matches()`) and\r\n * relies on equality of the legacy SDK's `context` object.\r\n */\r\nclass CallbackContext {\r\n    constructor(snapshotCallback, cancelCallback) {\r\n        this.snapshotCallback = snapshotCallback;\r\n        this.cancelCallback = cancelCallback;\r\n    }\r\n    onValue(expDataSnapshot, previousChildName) {\r\n        this.snapshotCallback.call(null, expDataSnapshot, previousChildName);\r\n    }\r\n    onCancel(error) {\r\n        assert(this.hasCancelCallback, 'Raising a cancel event on a listener with no cancel callback');\r\n        return this.cancelCallback.call(null, error);\r\n    }\r\n    get hasCancelCallback() {\r\n        return !!this.cancelCallback;\r\n    }\r\n    matches(other) {\r\n        return (this.snapshotCallback === other.snapshotCallback ||\r\n            (this.snapshotCallback.userCallback !== undefined &&\r\n                this.snapshotCallback.userCallback ===\r\n                    other.snapshotCallback.userCallback &&\r\n                this.snapshotCallback.context === other.snapshotCallback.context));\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The `onDisconnect` class allows you to write or clear data when your client\r\n * disconnects from the Database server. These updates occur whether your\r\n * client disconnects cleanly or not, so you can rely on them to clean up data\r\n * even if a connection is dropped or a client crashes.\r\n *\r\n * The `onDisconnect` class is most commonly used to manage presence in\r\n * applications where it is useful to detect how many clients are connected and\r\n * when other clients disconnect. See\r\n * {@link https://firebase.google.com/docs/database/web/offline-capabilities | Enabling Offline Capabilities in JavaScript}\r\n * for more information.\r\n *\r\n * To avoid problems when a connection is dropped before the requests can be\r\n * transferred to the Database server, these functions should be called before\r\n * writing any data.\r\n *\r\n * Note that `onDisconnect` operations are only triggered once. If you want an\r\n * operation to occur each time a disconnect occurs, you'll need to re-establish\r\n * the `onDisconnect` operations each time you reconnect.\r\n */\r\nclass OnDisconnect {\r\n    /** @hideconstructor */\r\n    constructor(_repo, _path) {\r\n        this._repo = _repo;\r\n        this._path = _path;\r\n    }\r\n    /**\r\n     * Cancels all previously queued `onDisconnect()` set or update events for this\r\n     * location and all children.\r\n     *\r\n     * If a write has been queued for this location via a `set()` or `update()` at a\r\n     * parent location, the write at this location will be canceled, though writes\r\n     * to sibling locations will still occur.\r\n     *\r\n     * @returns Resolves when synchronization to the server is complete.\r\n     */\r\n    cancel() {\r\n        const deferred = new Deferred();\r\n        repoOnDisconnectCancel(this._repo, this._path, deferred.wrapCallback(() => { }));\r\n        return deferred.promise;\r\n    }\r\n    /**\r\n     * Ensures the data at this location is deleted when the client is disconnected\r\n     * (due to closing the browser, navigating to a new page, or network issues).\r\n     *\r\n     * @returns Resolves when synchronization to the server is complete.\r\n     */\r\n    remove() {\r\n        validateWritablePath('OnDisconnect.remove', this._path);\r\n        const deferred = new Deferred();\r\n        repoOnDisconnectSet(this._repo, this._path, null, deferred.wrapCallback(() => { }));\r\n        return deferred.promise;\r\n    }\r\n    /**\r\n     * Ensures the data at this location is set to the specified value when the\r\n     * client is disconnected (due to closing the browser, navigating to a new page,\r\n     * or network issues).\r\n     *\r\n     * `set()` is especially useful for implementing \"presence\" systems, where a\r\n     * value should be changed or cleared when a user disconnects so that they\r\n     * appear \"offline\" to other users. See\r\n     * {@link https://firebase.google.com/docs/database/web/offline-capabilities | Enabling Offline Capabilities in JavaScript}\r\n     * for more information.\r\n     *\r\n     * Note that `onDisconnect` operations are only triggered once. If you want an\r\n     * operation to occur each time a disconnect occurs, you'll need to re-establish\r\n     * the `onDisconnect` operations each time.\r\n     *\r\n     * @param value - The value to be written to this location on disconnect (can\r\n     * be an object, array, string, number, boolean, or null).\r\n     * @returns Resolves when synchronization to the Database is complete.\r\n     */\r\n    set(value) {\r\n        validateWritablePath('OnDisconnect.set', this._path);\r\n        validateFirebaseDataArg('OnDisconnect.set', value, this._path, false);\r\n        const deferred = new Deferred();\r\n        repoOnDisconnectSet(this._repo, this._path, value, deferred.wrapCallback(() => { }));\r\n        return deferred.promise;\r\n    }\r\n    /**\r\n     * Ensures the data at this location is set to the specified value and priority\r\n     * when the client is disconnected (due to closing the browser, navigating to a\r\n     * new page, or network issues).\r\n     *\r\n     * @param value - The value to be written to this location on disconnect (can\r\n     * be an object, array, string, number, boolean, or null).\r\n     * @param priority - The priority to be written (string, number, or null).\r\n     * @returns Resolves when synchronization to the Database is complete.\r\n     */\r\n    setWithPriority(value, priority) {\r\n        validateWritablePath('OnDisconnect.setWithPriority', this._path);\r\n        validateFirebaseDataArg('OnDisconnect.setWithPriority', value, this._path, false);\r\n        validatePriority('OnDisconnect.setWithPriority', priority, false);\r\n        const deferred = new Deferred();\r\n        repoOnDisconnectSetWithPriority(this._repo, this._path, value, priority, deferred.wrapCallback(() => { }));\r\n        return deferred.promise;\r\n    }\r\n    /**\r\n     * Writes multiple values at this location when the client is disconnected (due\r\n     * to closing the browser, navigating to a new page, or network issues).\r\n     *\r\n     * The `values` argument contains multiple property-value pairs that will be\r\n     * written to the Database together. Each child property can either be a simple\r\n     * property (for example, \"name\") or a relative path (for example, \"name/first\")\r\n     * from the current location to the data to update.\r\n     *\r\n     * As opposed to the `set()` method, `update()` can be use to selectively update\r\n     * only the referenced properties at the current location (instead of replacing\r\n     * all the child properties at the current location).\r\n     *\r\n     * @param values - Object containing multiple values.\r\n     * @returns Resolves when synchronization to the Database is complete.\r\n     */\r\n    update(values) {\r\n        validateWritablePath('OnDisconnect.update', this._path);\r\n        validateFirebaseMergeDataArg('OnDisconnect.update', values, this._path, false);\r\n        const deferred = new Deferred();\r\n        repoOnDisconnectUpdate(this._repo, this._path, values, deferred.wrapCallback(() => { }));\r\n        return deferred.promise;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @internal\r\n */\r\nclass QueryImpl {\r\n    /**\r\n     * @hideconstructor\r\n     */\r\n    constructor(_repo, _path, _queryParams, _orderByCalled) {\r\n        this._repo = _repo;\r\n        this._path = _path;\r\n        this._queryParams = _queryParams;\r\n        this._orderByCalled = _orderByCalled;\r\n    }\r\n    get key() {\r\n        if (pathIsEmpty(this._path)) {\r\n            return null;\r\n        }\r\n        else {\r\n            return pathGetBack(this._path);\r\n        }\r\n    }\r\n    get ref() {\r\n        return new ReferenceImpl(this._repo, this._path);\r\n    }\r\n    get _queryIdentifier() {\r\n        const obj = queryParamsGetQueryObject(this._queryParams);\r\n        const id = ObjectToUniqueKey(obj);\r\n        return id === '{}' ? 'default' : id;\r\n    }\r\n    /**\r\n     * An object representation of the query parameters used by this Query.\r\n     */\r\n    get _queryObject() {\r\n        return queryParamsGetQueryObject(this._queryParams);\r\n    }\r\n    isEqual(other) {\r\n        other = getModularInstance(other);\r\n        if (!(other instanceof QueryImpl)) {\r\n            return false;\r\n        }\r\n        const sameRepo = this._repo === other._repo;\r\n        const samePath = pathEquals(this._path, other._path);\r\n        const sameQueryIdentifier = this._queryIdentifier === other._queryIdentifier;\r\n        return sameRepo && samePath && sameQueryIdentifier;\r\n    }\r\n    toJSON() {\r\n        return this.toString();\r\n    }\r\n    toString() {\r\n        return this._repo.toString() + pathToUrlEncodedString(this._path);\r\n    }\r\n}\r\n/**\r\n * Validates that no other order by call has been made\r\n */\r\nfunction validateNoPreviousOrderByCall(query, fnName) {\r\n    if (query._orderByCalled === true) {\r\n        throw new Error(fnName + \": You can't combine multiple orderBy calls.\");\r\n    }\r\n}\r\n/**\r\n * Validates start/end values for queries.\r\n */\r\nfunction validateQueryEndpoints(params) {\r\n    let startNode = null;\r\n    let endNode = null;\r\n    if (params.hasStart()) {\r\n        startNode = params.getIndexStartValue();\r\n    }\r\n    if (params.hasEnd()) {\r\n        endNode = params.getIndexEndValue();\r\n    }\r\n    if (params.getIndex() === KEY_INDEX) {\r\n        const tooManyArgsError = 'Query: When ordering by key, you may only pass one argument to ' +\r\n            'startAt(), endAt(), or equalTo().';\r\n        const wrongArgTypeError = 'Query: When ordering by key, the argument passed to startAt(), startAfter(), ' +\r\n            'endAt(), endBefore(), or equalTo() must be a string.';\r\n        if (params.hasStart()) {\r\n            const startName = params.getIndexStartName();\r\n            if (startName !== MIN_NAME) {\r\n                throw new Error(tooManyArgsError);\r\n            }\r\n            else if (typeof startNode !== 'string') {\r\n                throw new Error(wrongArgTypeError);\r\n            }\r\n        }\r\n        if (params.hasEnd()) {\r\n            const endName = params.getIndexEndName();\r\n            if (endName !== MAX_NAME) {\r\n                throw new Error(tooManyArgsError);\r\n            }\r\n            else if (typeof endNode !== 'string') {\r\n                throw new Error(wrongArgTypeError);\r\n            }\r\n        }\r\n    }\r\n    else if (params.getIndex() === PRIORITY_INDEX) {\r\n        if ((startNode != null && !isValidPriority(startNode)) ||\r\n            (endNode != null && !isValidPriority(endNode))) {\r\n            throw new Error('Query: When ordering by priority, the first argument passed to startAt(), ' +\r\n                'startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value ' +\r\n                '(null, a number, or a string).');\r\n        }\r\n    }\r\n    else {\r\n        assert(params.getIndex() instanceof PathIndex ||\r\n            params.getIndex() === VALUE_INDEX, 'unknown index type.');\r\n        if ((startNode != null && typeof startNode === 'object') ||\r\n            (endNode != null && typeof endNode === 'object')) {\r\n            throw new Error('Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or ' +\r\n                'equalTo() cannot be an object.');\r\n        }\r\n    }\r\n}\r\n/**\r\n * Validates that limit* has been called with the correct combination of parameters\r\n */\r\nfunction validateLimit(params) {\r\n    if (params.hasStart() &&\r\n        params.hasEnd() &&\r\n        params.hasLimit() &&\r\n        !params.hasAnchoredLimit()) {\r\n        throw new Error(\"Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use \" +\r\n            'limitToFirst() or limitToLast() instead.');\r\n    }\r\n}\r\n/**\r\n * @internal\r\n */\r\nclass ReferenceImpl extends QueryImpl {\r\n    /** @hideconstructor */\r\n    constructor(repo, path) {\r\n        super(repo, path, new QueryParams(), false);\r\n    }\r\n    get parent() {\r\n        const parentPath = pathParent(this._path);\r\n        return parentPath === null\r\n            ? null\r\n            : new ReferenceImpl(this._repo, parentPath);\r\n    }\r\n    get root() {\r\n        let ref = this;\r\n        while (ref.parent !== null) {\r\n            ref = ref.parent;\r\n        }\r\n        return ref;\r\n    }\r\n}\r\n/**\r\n * A `DataSnapshot` contains data from a Database location.\r\n *\r\n * Any time you read data from the Database, you receive the data as a\r\n * `DataSnapshot`. A `DataSnapshot` is passed to the event callbacks you attach\r\n * with `on()` or `once()`. You can extract the contents of the snapshot as a\r\n * JavaScript object by calling the `val()` method. Alternatively, you can\r\n * traverse into the snapshot by calling `child()` to return child snapshots\r\n * (which you could then call `val()` on).\r\n *\r\n * A `DataSnapshot` is an efficiently generated, immutable copy of the data at\r\n * a Database location. It cannot be modified and will never change (to modify\r\n * data, you always call the `set()` method on a `Reference` directly).\r\n */\r\nclass DataSnapshot {\r\n    /**\r\n     * @param _node - A SnapshotNode to wrap.\r\n     * @param ref - The location this snapshot came from.\r\n     * @param _index - The iteration order for this snapshot\r\n     * @hideconstructor\r\n     */\r\n    constructor(_node, \r\n    /**\r\n     * The location of this DataSnapshot.\r\n     */\r\n    ref, _index) {\r\n        this._node = _node;\r\n        this.ref = ref;\r\n        this._index = _index;\r\n    }\r\n    /**\r\n     * Gets the priority value of the data in this `DataSnapshot`.\r\n     *\r\n     * Applications need not use priority but can order collections by\r\n     * ordinary properties (see\r\n     * {@link https://firebase.google.com/docs/database/web/lists-of-data#sorting_and_filtering_data |Sorting and filtering data}\r\n     * ).\r\n     */\r\n    get priority() {\r\n        // typecast here because we never return deferred values or internal priorities (MAX_PRIORITY)\r\n        return this._node.getPriority().val();\r\n    }\r\n    /**\r\n     * The key (last part of the path) of the location of this `DataSnapshot`.\r\n     *\r\n     * The last token in a Database location is considered its key. For example,\r\n     * \"ada\" is the key for the /users/ada/ node. Accessing the key on any\r\n     * `DataSnapshot` will return the key for the location that generated it.\r\n     * However, accessing the key on the root URL of a Database will return\r\n     * `null`.\r\n     */\r\n    get key() {\r\n        return this.ref.key;\r\n    }\r\n    /** Returns the number of child properties of this `DataSnapshot`. */\r\n    get size() {\r\n        return this._node.numChildren();\r\n    }\r\n    /**\r\n     * Gets another `DataSnapshot` for the location at the specified relative path.\r\n     *\r\n     * Passing a relative path to the `child()` method of a DataSnapshot returns\r\n     * another `DataSnapshot` for the location at the specified relative path. The\r\n     * relative path can either be a simple child name (for example, \"ada\") or a\r\n     * deeper, slash-separated path (for example, \"ada/name/first\"). If the child\r\n     * location has no data, an empty `DataSnapshot` (that is, a `DataSnapshot`\r\n     * whose value is `null`) is returned.\r\n     *\r\n     * @param path - A relative path to the location of child data.\r\n     */\r\n    child(path) {\r\n        const childPath = new Path(path);\r\n        const childRef = child(this.ref, path);\r\n        return new DataSnapshot(this._node.getChild(childPath), childRef, PRIORITY_INDEX);\r\n    }\r\n    /**\r\n     * Returns true if this `DataSnapshot` contains any data. It is slightly more\r\n     * efficient than using `snapshot.val() !== null`.\r\n     */\r\n    exists() {\r\n        return !this._node.isEmpty();\r\n    }\r\n    /**\r\n     * Exports the entire contents of the DataSnapshot as a JavaScript object.\r\n     *\r\n     * The `exportVal()` method is similar to `val()`, except priority information\r\n     * is included (if available), making it suitable for backing up your data.\r\n     *\r\n     * @returns The DataSnapshot's contents as a JavaScript value (Object,\r\n     *   Array, string, number, boolean, or `null`).\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    exportVal() {\r\n        return this._node.val(true);\r\n    }\r\n    /**\r\n     * Enumerates the top-level children in the `IteratedDataSnapshot`.\r\n     *\r\n     * Because of the way JavaScript objects work, the ordering of data in the\r\n     * JavaScript object returned by `val()` is not guaranteed to match the\r\n     * ordering on the server nor the ordering of `onChildAdded()` events. That is\r\n     * where `forEach()` comes in handy. It guarantees the children of a\r\n     * `DataSnapshot` will be iterated in their query order.\r\n     *\r\n     * If no explicit `orderBy*()` method is used, results are returned\r\n     * ordered by key (unless priorities are used, in which case, results are\r\n     * returned by priority).\r\n     *\r\n     * @param action - A function that will be called for each child DataSnapshot.\r\n     * The callback can return true to cancel further enumeration.\r\n     * @returns true if enumeration was canceled due to your callback returning\r\n     * true.\r\n     */\r\n    forEach(action) {\r\n        if (this._node.isLeafNode()) {\r\n            return false;\r\n        }\r\n        const childrenNode = this._node;\r\n        // Sanitize the return value to a boolean. ChildrenNode.forEachChild has a weird return type...\r\n        return !!childrenNode.forEachChild(this._index, (key, node) => {\r\n            return action(new DataSnapshot(node, child(this.ref, key), PRIORITY_INDEX));\r\n        });\r\n    }\r\n    /**\r\n     * Returns true if the specified child path has (non-null) data.\r\n     *\r\n     * @param path - A relative path to the location of a potential child.\r\n     * @returns `true` if data exists at the specified child path; else\r\n     *  `false`.\r\n     */\r\n    hasChild(path) {\r\n        const childPath = new Path(path);\r\n        return !this._node.getChild(childPath).isEmpty();\r\n    }\r\n    /**\r\n     * Returns whether or not the `DataSnapshot` has any non-`null` child\r\n     * properties.\r\n     *\r\n     * You can use `hasChildren()` to determine if a `DataSnapshot` has any\r\n     * children. If it does, you can enumerate them using `forEach()`. If it\r\n     * doesn't, then either this snapshot contains a primitive value (which can be\r\n     * retrieved with `val()`) or it is empty (in which case, `val()` will return\r\n     * `null`).\r\n     *\r\n     * @returns true if this snapshot has any children; else false.\r\n     */\r\n    hasChildren() {\r\n        if (this._node.isLeafNode()) {\r\n            return false;\r\n        }\r\n        else {\r\n            return !this._node.isEmpty();\r\n        }\r\n    }\r\n    /**\r\n     * Returns a JSON-serializable representation of this object.\r\n     */\r\n    toJSON() {\r\n        return this.exportVal();\r\n    }\r\n    /**\r\n     * Extracts a JavaScript value from a `DataSnapshot`.\r\n     *\r\n     * Depending on the data in a `DataSnapshot`, the `val()` method may return a\r\n     * scalar type (string, number, or boolean), an array, or an object. It may\r\n     * also return null, indicating that the `DataSnapshot` is empty (contains no\r\n     * data).\r\n     *\r\n     * @returns The DataSnapshot's contents as a JavaScript value (Object,\r\n     *   Array, string, number, boolean, or `null`).\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    val() {\r\n        return this._node.val();\r\n    }\r\n}\r\n/**\r\n *\r\n * Returns a `Reference` representing the location in the Database\r\n * corresponding to the provided path. If no path is provided, the `Reference`\r\n * will point to the root of the Database.\r\n *\r\n * @param db - The database instance to obtain a reference for.\r\n * @param path - Optional path representing the location the returned\r\n *   `Reference` will point. If not provided, the returned `Reference` will\r\n *   point to the root of the Database.\r\n * @returns If a path is provided, a `Reference`\r\n *   pointing to the provided path. Otherwise, a `Reference` pointing to the\r\n *   root of the Database.\r\n */\r\nfunction ref(db, path) {\r\n    db = getModularInstance(db);\r\n    db._checkNotDeleted('ref');\r\n    return path !== undefined ? child(db._root, path) : db._root;\r\n}\r\n/**\r\n * Returns a `Reference` representing the location in the Database\r\n * corresponding to the provided Firebase URL.\r\n *\r\n * An exception is thrown if the URL is not a valid Firebase Database URL or it\r\n * has a different domain than the current `Database` instance.\r\n *\r\n * Note that all query parameters (`orderBy`, `limitToLast`, etc.) are ignored\r\n * and are not applied to the returned `Reference`.\r\n *\r\n * @param db - The database instance to obtain a reference for.\r\n * @param url - The Firebase URL at which the returned `Reference` will\r\n *   point.\r\n * @returns A `Reference` pointing to the provided\r\n *   Firebase URL.\r\n */\r\nfunction refFromURL(db, url) {\r\n    db = getModularInstance(db);\r\n    db._checkNotDeleted('refFromURL');\r\n    const parsedURL = parseRepoInfo(url, db._repo.repoInfo_.nodeAdmin);\r\n    validateUrl('refFromURL', parsedURL);\r\n    const repoInfo = parsedURL.repoInfo;\r\n    if (!db._repo.repoInfo_.isCustomHost() &&\r\n        repoInfo.host !== db._repo.repoInfo_.host) {\r\n        fatal('refFromURL' +\r\n            ': Host name does not match the current database: ' +\r\n            '(found ' +\r\n            repoInfo.host +\r\n            ' but expected ' +\r\n            db._repo.repoInfo_.host +\r\n            ')');\r\n    }\r\n    return ref(db, parsedURL.path.toString());\r\n}\r\n/**\r\n * Gets a `Reference` for the location at the specified relative path.\r\n *\r\n * The relative path can either be a simple child name (for example, \"ada\") or\r\n * a deeper slash-separated path (for example, \"ada/name/first\").\r\n *\r\n * @param parent - The parent location.\r\n * @param path - A relative path from this location to the desired child\r\n *   location.\r\n * @returns The specified child location.\r\n */\r\nfunction child(parent, path) {\r\n    parent = getModularInstance(parent);\r\n    if (pathGetFront(parent._path) === null) {\r\n        validateRootPathString('child', 'path', path, false);\r\n    }\r\n    else {\r\n        validatePathString('child', 'path', path, false);\r\n    }\r\n    return new ReferenceImpl(parent._repo, pathChild(parent._path, path));\r\n}\r\n/**\r\n * Returns an `OnDisconnect` object - see\r\n * {@link https://firebase.google.com/docs/database/web/offline-capabilities | Enabling Offline Capabilities in JavaScript}\r\n * for more information on how to use it.\r\n *\r\n * @param ref - The reference to add OnDisconnect triggers for.\r\n */\r\nfunction onDisconnect(ref) {\r\n    ref = getModularInstance(ref);\r\n    return new OnDisconnect(ref._repo, ref._path);\r\n}\r\n/**\r\n * Generates a new child location using a unique key and returns its\r\n * `Reference`.\r\n *\r\n * This is the most common pattern for adding data to a collection of items.\r\n *\r\n * If you provide a value to `push()`, the value is written to the\r\n * generated location. If you don't pass a value, nothing is written to the\r\n * database and the child remains empty (but you can use the `Reference`\r\n * elsewhere).\r\n *\r\n * The unique keys generated by `push()` are ordered by the current time, so the\r\n * resulting list of items is chronologically sorted. The keys are also\r\n * designed to be unguessable (they contain 72 random bits of entropy).\r\n *\r\n * See {@link https://firebase.google.com/docs/database/web/lists-of-data#append_to_a_list_of_data | Append to a list of data}.\r\n * See {@link https://firebase.googleblog.com/2015/02/the-2120-ways-to-ensure-unique_68.html | The 2^120 Ways to Ensure Unique Identifiers}.\r\n *\r\n * @param parent - The parent location.\r\n * @param value - Optional value to be written at the generated location.\r\n * @returns Combined `Promise` and `Reference`; resolves when write is complete,\r\n * but can be used immediately as the `Reference` to the child location.\r\n */\r\nfunction push(parent, value) {\r\n    parent = getModularInstance(parent);\r\n    validateWritablePath('push', parent._path);\r\n    validateFirebaseDataArg('push', value, parent._path, true);\r\n    const now = repoServerTime(parent._repo);\r\n    const name = nextPushId(now);\r\n    // push() returns a ThennableReference whose promise is fulfilled with a\r\n    // regular Reference. We use child() to create handles to two different\r\n    // references. The first is turned into a ThennableReference below by adding\r\n    // then() and catch() methods and is used as the return value of push(). The\r\n    // second remains a regular Reference and is used as the fulfilled value of\r\n    // the first ThennableReference.\r\n    const thenablePushRef = child(parent, name);\r\n    const pushRef = child(parent, name);\r\n    let promise;\r\n    if (value != null) {\r\n        promise = set(pushRef, value).then(() => pushRef);\r\n    }\r\n    else {\r\n        promise = Promise.resolve(pushRef);\r\n    }\r\n    thenablePushRef.then = promise.then.bind(promise);\r\n    thenablePushRef.catch = promise.then.bind(promise, undefined);\r\n    return thenablePushRef;\r\n}\r\n/**\r\n * Removes the data at this Database location.\r\n *\r\n * Any data at child locations will also be deleted.\r\n *\r\n * The effect of the remove will be visible immediately and the corresponding\r\n * event 'value' will be triggered. Synchronization of the remove to the\r\n * Firebase servers will also be started, and the returned Promise will resolve\r\n * when complete. If provided, the onComplete callback will be called\r\n * asynchronously after synchronization has finished.\r\n *\r\n * @param ref - The location to remove.\r\n * @returns Resolves when remove on server is complete.\r\n */\r\nfunction remove(ref) {\r\n    validateWritablePath('remove', ref._path);\r\n    return set(ref, null);\r\n}\r\n/**\r\n * Writes data to this Database location.\r\n *\r\n * This will overwrite any data at this location and all child locations.\r\n *\r\n * The effect of the write will be visible immediately, and the corresponding\r\n * events (\"value\", \"child_added\", etc.) will be triggered. Synchronization of\r\n * the data to the Firebase servers will also be started, and the returned\r\n * Promise will resolve when complete. If provided, the `onComplete` callback\r\n * will be called asynchronously after synchronization has finished.\r\n *\r\n * Passing `null` for the new value is equivalent to calling `remove()`; namely,\r\n * all data at this location and all child locations will be deleted.\r\n *\r\n * `set()` will remove any priority stored at this location, so if priority is\r\n * meant to be preserved, you need to use `setWithPriority()` instead.\r\n *\r\n * Note that modifying data with `set()` will cancel any pending transactions\r\n * at that location, so extreme care should be taken if mixing `set()` and\r\n * `transaction()` to modify the same data.\r\n *\r\n * A single `set()` will generate a single \"value\" event at the location where\r\n * the `set()` was performed.\r\n *\r\n * @param ref - The location to write to.\r\n * @param value - The value to be written (string, number, boolean, object,\r\n *   array, or null).\r\n * @returns Resolves when write to server is complete.\r\n */\r\nfunction set(ref, value) {\r\n    ref = getModularInstance(ref);\r\n    validateWritablePath('set', ref._path);\r\n    validateFirebaseDataArg('set', value, ref._path, false);\r\n    const deferred = new Deferred();\r\n    repoSetWithPriority(ref._repo, ref._path, value, \r\n    /*priority=*/ null, deferred.wrapCallback(() => { }));\r\n    return deferred.promise;\r\n}\r\n/**\r\n * Sets a priority for the data at this Database location.\r\n *\r\n * Applications need not use priority but can order collections by\r\n * ordinary properties (see\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#sorting_and_filtering_data | Sorting and filtering data}\r\n * ).\r\n *\r\n * @param ref - The location to write to.\r\n * @param priority - The priority to be written (string, number, or null).\r\n * @returns Resolves when write to server is complete.\r\n */\r\nfunction setPriority(ref, priority) {\r\n    ref = getModularInstance(ref);\r\n    validateWritablePath('setPriority', ref._path);\r\n    validatePriority('setPriority', priority, false);\r\n    const deferred = new Deferred();\r\n    repoSetWithPriority(ref._repo, pathChild(ref._path, '.priority'), priority, null, deferred.wrapCallback(() => { }));\r\n    return deferred.promise;\r\n}\r\n/**\r\n * Writes data the Database location. Like `set()` but also specifies the\r\n * priority for that data.\r\n *\r\n * Applications need not use priority but can order collections by\r\n * ordinary properties (see\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#sorting_and_filtering_data | Sorting and filtering data}\r\n * ).\r\n *\r\n * @param ref - The location to write to.\r\n * @param value - The value to be written (string, number, boolean, object,\r\n *   array, or null).\r\n * @param priority - The priority to be written (string, number, or null).\r\n * @returns Resolves when write to server is complete.\r\n */\r\nfunction setWithPriority(ref, value, priority) {\r\n    validateWritablePath('setWithPriority', ref._path);\r\n    validateFirebaseDataArg('setWithPriority', value, ref._path, false);\r\n    validatePriority('setWithPriority', priority, false);\r\n    if (ref.key === '.length' || ref.key === '.keys') {\r\n        throw 'setWithPriority failed: ' + ref.key + ' is a read-only object.';\r\n    }\r\n    const deferred = new Deferred();\r\n    repoSetWithPriority(ref._repo, ref._path, value, priority, deferred.wrapCallback(() => { }));\r\n    return deferred.promise;\r\n}\r\n/**\r\n * Writes multiple values to the Database at once.\r\n *\r\n * The `values` argument contains multiple property-value pairs that will be\r\n * written to the Database together. Each child property can either be a simple\r\n * property (for example, \"name\") or a relative path (for example,\r\n * \"name/first\") from the current location to the data to update.\r\n *\r\n * As opposed to the `set()` method, `update()` can be use to selectively update\r\n * only the referenced properties at the current location (instead of replacing\r\n * all the child properties at the current location).\r\n *\r\n * The effect of the write will be visible immediately, and the corresponding\r\n * events ('value', 'child_added', etc.) will be triggered. Synchronization of\r\n * the data to the Firebase servers will also be started, and the returned\r\n * Promise will resolve when complete. If provided, the `onComplete` callback\r\n * will be called asynchronously after synchronization has finished.\r\n *\r\n * A single `update()` will generate a single \"value\" event at the location\r\n * where the `update()` was performed, regardless of how many children were\r\n * modified.\r\n *\r\n * Note that modifying data with `update()` will cancel any pending\r\n * transactions at that location, so extreme care should be taken if mixing\r\n * `update()` and `transaction()` to modify the same data.\r\n *\r\n * Passing `null` to `update()` will remove the data at this location.\r\n *\r\n * See\r\n * {@link https://firebase.googleblog.com/2015/09/introducing-multi-location-updates-and_86.html | Introducing multi-location updates and more}.\r\n *\r\n * @param ref - The location to write to.\r\n * @param values - Object containing multiple values.\r\n * @returns Resolves when update on server is complete.\r\n */\r\nfunction update(ref, values) {\r\n    validateFirebaseMergeDataArg('update', values, ref._path, false);\r\n    const deferred = new Deferred();\r\n    repoUpdate(ref._repo, ref._path, values, deferred.wrapCallback(() => { }));\r\n    return deferred.promise;\r\n}\r\n/**\r\n * Gets the most up-to-date result for this query.\r\n *\r\n * @param query - The query to run.\r\n * @returns A `Promise` which resolves to the resulting DataSnapshot if a value is\r\n * available, or rejects if the client is unable to return a value (e.g., if the\r\n * server is unreachable and there is nothing cached).\r\n */\r\nfunction get(query) {\r\n    query = getModularInstance(query);\r\n    const callbackContext = new CallbackContext(() => { });\r\n    const container = new ValueEventRegistration(callbackContext);\r\n    return repoGetValue(query._repo, query, container).then(node => {\r\n        return new DataSnapshot(node, new ReferenceImpl(query._repo, query._path), query._queryParams.getIndex());\r\n    });\r\n}\r\n/**\r\n * Represents registration for 'value' events.\r\n */\r\nclass ValueEventRegistration {\r\n    constructor(callbackContext) {\r\n        this.callbackContext = callbackContext;\r\n    }\r\n    respondsTo(eventType) {\r\n        return eventType === 'value';\r\n    }\r\n    createEvent(change, query) {\r\n        const index = query._queryParams.getIndex();\r\n        return new DataEvent('value', this, new DataSnapshot(change.snapshotNode, new ReferenceImpl(query._repo, query._path), index));\r\n    }\r\n    getEventRunner(eventData) {\r\n        if (eventData.getEventType() === 'cancel') {\r\n            return () => this.callbackContext.onCancel(eventData.error);\r\n        }\r\n        else {\r\n            return () => this.callbackContext.onValue(eventData.snapshot, null);\r\n        }\r\n    }\r\n    createCancelEvent(error, path) {\r\n        if (this.callbackContext.hasCancelCallback) {\r\n            return new CancelEvent(this, error, path);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n    matches(other) {\r\n        if (!(other instanceof ValueEventRegistration)) {\r\n            return false;\r\n        }\r\n        else if (!other.callbackContext || !this.callbackContext) {\r\n            // If no callback specified, we consider it to match any callback.\r\n            return true;\r\n        }\r\n        else {\r\n            return other.callbackContext.matches(this.callbackContext);\r\n        }\r\n    }\r\n    hasAnyCallback() {\r\n        return this.callbackContext !== null;\r\n    }\r\n}\r\n/**\r\n * Represents the registration of a child_x event.\r\n */\r\nclass ChildEventRegistration {\r\n    constructor(eventType, callbackContext) {\r\n        this.eventType = eventType;\r\n        this.callbackContext = callbackContext;\r\n    }\r\n    respondsTo(eventType) {\r\n        let eventToCheck = eventType === 'children_added' ? 'child_added' : eventType;\r\n        eventToCheck =\r\n            eventToCheck === 'children_removed' ? 'child_removed' : eventToCheck;\r\n        return this.eventType === eventToCheck;\r\n    }\r\n    createCancelEvent(error, path) {\r\n        if (this.callbackContext.hasCancelCallback) {\r\n            return new CancelEvent(this, error, path);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n    createEvent(change, query) {\r\n        assert(change.childName != null, 'Child events should have a childName.');\r\n        const childRef = child(new ReferenceImpl(query._repo, query._path), change.childName);\r\n        const index = query._queryParams.getIndex();\r\n        return new DataEvent(change.type, this, new DataSnapshot(change.snapshotNode, childRef, index), change.prevName);\r\n    }\r\n    getEventRunner(eventData) {\r\n        if (eventData.getEventType() === 'cancel') {\r\n            return () => this.callbackContext.onCancel(eventData.error);\r\n        }\r\n        else {\r\n            return () => this.callbackContext.onValue(eventData.snapshot, eventData.prevName);\r\n        }\r\n    }\r\n    matches(other) {\r\n        if (other instanceof ChildEventRegistration) {\r\n            return (this.eventType === other.eventType &&\r\n                (!this.callbackContext ||\r\n                    !other.callbackContext ||\r\n                    this.callbackContext.matches(other.callbackContext)));\r\n        }\r\n        return false;\r\n    }\r\n    hasAnyCallback() {\r\n        return !!this.callbackContext;\r\n    }\r\n}\r\nfunction addEventListener(query, eventType, callback, cancelCallbackOrListenOptions, options) {\r\n    let cancelCallback;\r\n    if (typeof cancelCallbackOrListenOptions === 'object') {\r\n        cancelCallback = undefined;\r\n        options = cancelCallbackOrListenOptions;\r\n    }\r\n    if (typeof cancelCallbackOrListenOptions === 'function') {\r\n        cancelCallback = cancelCallbackOrListenOptions;\r\n    }\r\n    if (options && options.onlyOnce) {\r\n        const userCallback = callback;\r\n        const onceCallback = (dataSnapshot, previousChildName) => {\r\n            repoRemoveEventCallbackForQuery(query._repo, query, container);\r\n            userCallback(dataSnapshot, previousChildName);\r\n        };\r\n        onceCallback.userCallback = callback.userCallback;\r\n        onceCallback.context = callback.context;\r\n        callback = onceCallback;\r\n    }\r\n    const callbackContext = new CallbackContext(callback, cancelCallback || undefined);\r\n    const container = eventType === 'value'\r\n        ? new ValueEventRegistration(callbackContext)\r\n        : new ChildEventRegistration(eventType, callbackContext);\r\n    repoAddEventCallbackForQuery(query._repo, query, container);\r\n    return () => repoRemoveEventCallbackForQuery(query._repo, query, container);\r\n}\r\nfunction onValue(query, callback, cancelCallbackOrListenOptions, options) {\r\n    return addEventListener(query, 'value', callback, cancelCallbackOrListenOptions, options);\r\n}\r\nfunction onChildAdded(query, callback, cancelCallbackOrListenOptions, options) {\r\n    return addEventListener(query, 'child_added', callback, cancelCallbackOrListenOptions, options);\r\n}\r\nfunction onChildChanged(query, callback, cancelCallbackOrListenOptions, options) {\r\n    return addEventListener(query, 'child_changed', callback, cancelCallbackOrListenOptions, options);\r\n}\r\nfunction onChildMoved(query, callback, cancelCallbackOrListenOptions, options) {\r\n    return addEventListener(query, 'child_moved', callback, cancelCallbackOrListenOptions, options);\r\n}\r\nfunction onChildRemoved(query, callback, cancelCallbackOrListenOptions, options) {\r\n    return addEventListener(query, 'child_removed', callback, cancelCallbackOrListenOptions, options);\r\n}\r\n/**\r\n * Detaches a callback previously attached with the corresponding `on*()` (`onValue`, `onChildAdded`) listener.\r\n * Note: This is not the recommended way to remove a listener. Instead, please use the returned callback function from\r\n * the respective `on*` callbacks.\r\n *\r\n * Detach a callback previously attached with `on*()`. Calling `off()` on a parent listener\r\n * will not automatically remove listeners registered on child nodes, `off()`\r\n * must also be called on any child listeners to remove the callback.\r\n *\r\n * If a callback is not specified, all callbacks for the specified eventType\r\n * will be removed. Similarly, if no eventType is specified, all callbacks\r\n * for the `Reference` will be removed.\r\n *\r\n * Individual listeners can also be removed by invoking their unsubscribe\r\n * callbacks.\r\n *\r\n * @param query - The query that the listener was registered with.\r\n * @param eventType - One of the following strings: \"value\", \"child_added\",\r\n * \"child_changed\", \"child_removed\", or \"child_moved.\" If omitted, all callbacks\r\n * for the `Reference` will be removed.\r\n * @param callback - The callback function that was passed to `on()` or\r\n * `undefined` to remove all callbacks.\r\n */\r\nfunction off(query, eventType, callback) {\r\n    let container = null;\r\n    const expCallback = callback ? new CallbackContext(callback) : null;\r\n    if (eventType === 'value') {\r\n        container = new ValueEventRegistration(expCallback);\r\n    }\r\n    else if (eventType) {\r\n        container = new ChildEventRegistration(eventType, expCallback);\r\n    }\r\n    repoRemoveEventCallbackForQuery(query._repo, query, container);\r\n}\r\n/**\r\n * A `QueryConstraint` is used to narrow the set of documents returned by a\r\n * Database query. `QueryConstraint`s are created by invoking {@link endAt},\r\n * {@link endBefore}, {@link startAt}, {@link startAfter}, {@link\r\n * limitToFirst}, {@link limitToLast}, {@link orderByChild},\r\n * {@link orderByChild}, {@link orderByKey} , {@link orderByPriority} ,\r\n * {@link orderByValue}  or {@link equalTo} and\r\n * can then be passed to {@link query} to create a new query instance that\r\n * also contains this `QueryConstraint`.\r\n */\r\nclass QueryConstraint {\r\n}\r\nclass QueryEndAtConstraint extends QueryConstraint {\r\n    constructor(_value, _key) {\r\n        super();\r\n        this._value = _value;\r\n        this._key = _key;\r\n        this.type = 'endAt';\r\n    }\r\n    _apply(query) {\r\n        validateFirebaseDataArg('endAt', this._value, query._path, true);\r\n        const newParams = queryParamsEndAt(query._queryParams, this._value, this._key);\r\n        validateLimit(newParams);\r\n        validateQueryEndpoints(newParams);\r\n        if (query._queryParams.hasEnd()) {\r\n            throw new Error('endAt: Starting point was already set (by another call to endAt, ' +\r\n                'endBefore or equalTo).');\r\n        }\r\n        return new QueryImpl(query._repo, query._path, newParams, query._orderByCalled);\r\n    }\r\n}\r\n/**\r\n * Creates a `QueryConstraint` with the specified ending point.\r\n *\r\n * Using `startAt()`, `startAfter()`, `endBefore()`, `endAt()` and `equalTo()`\r\n * allows you to choose arbitrary starting and ending points for your queries.\r\n *\r\n * The ending point is inclusive, so children with exactly the specified value\r\n * will be included in the query. The optional key argument can be used to\r\n * further limit the range of the query. If it is specified, then children that\r\n * have exactly the specified value must also have a key name less than or equal\r\n * to the specified key.\r\n *\r\n * You can read more about `endAt()` in\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#filtering_data | Filtering data}.\r\n *\r\n * @param value - The value to end at. The argument type depends on which\r\n * `orderBy*()` function was used in this query. Specify a value that matches\r\n * the `orderBy*()` type. When used in combination with `orderByKey()`, the\r\n * value must be a string.\r\n * @param key - The child key to end at, among the children with the previously\r\n * specified priority. This argument is only allowed if ordering by child,\r\n * value, or priority.\r\n */\r\nfunction endAt(value, key) {\r\n    validateKey('endAt', 'key', key, true);\r\n    return new QueryEndAtConstraint(value, key);\r\n}\r\nclass QueryEndBeforeConstraint extends QueryConstraint {\r\n    constructor(_value, _key) {\r\n        super();\r\n        this._value = _value;\r\n        this._key = _key;\r\n        this.type = 'endBefore';\r\n    }\r\n    _apply(query) {\r\n        validateFirebaseDataArg('endBefore', this._value, query._path, false);\r\n        const newParams = queryParamsEndBefore(query._queryParams, this._value, this._key);\r\n        validateLimit(newParams);\r\n        validateQueryEndpoints(newParams);\r\n        if (query._queryParams.hasEnd()) {\r\n            throw new Error('endBefore: Starting point was already set (by another call to endAt, ' +\r\n                'endBefore or equalTo).');\r\n        }\r\n        return new QueryImpl(query._repo, query._path, newParams, query._orderByCalled);\r\n    }\r\n}\r\n/**\r\n * Creates a `QueryConstraint` with the specified ending point (exclusive).\r\n *\r\n * Using `startAt()`, `startAfter()`, `endBefore()`, `endAt()` and `equalTo()`\r\n * allows you to choose arbitrary starting and ending points for your queries.\r\n *\r\n * The ending point is exclusive. If only a value is provided, children\r\n * with a value less than the specified value will be included in the query.\r\n * If a key is specified, then children must have a value less than or equal\r\n * to the specified value and a key name less than the specified key.\r\n *\r\n * @param value - The value to end before. The argument type depends on which\r\n * `orderBy*()` function was used in this query. Specify a value that matches\r\n * the `orderBy*()` type. When used in combination with `orderByKey()`, the\r\n * value must be a string.\r\n * @param key - The child key to end before, among the children with the\r\n * previously specified priority. This argument is only allowed if ordering by\r\n * child, value, or priority.\r\n */\r\nfunction endBefore(value, key) {\r\n    validateKey('endBefore', 'key', key, true);\r\n    return new QueryEndBeforeConstraint(value, key);\r\n}\r\nclass QueryStartAtConstraint extends QueryConstraint {\r\n    constructor(_value, _key) {\r\n        super();\r\n        this._value = _value;\r\n        this._key = _key;\r\n        this.type = 'startAt';\r\n    }\r\n    _apply(query) {\r\n        validateFirebaseDataArg('startAt', this._value, query._path, true);\r\n        const newParams = queryParamsStartAt(query._queryParams, this._value, this._key);\r\n        validateLimit(newParams);\r\n        validateQueryEndpoints(newParams);\r\n        if (query._queryParams.hasStart()) {\r\n            throw new Error('startAt: Starting point was already set (by another call to startAt, ' +\r\n                'startBefore or equalTo).');\r\n        }\r\n        return new QueryImpl(query._repo, query._path, newParams, query._orderByCalled);\r\n    }\r\n}\r\n/**\r\n * Creates a `QueryConstraint` with the specified starting point.\r\n *\r\n * Using `startAt()`, `startAfter()`, `endBefore()`, `endAt()` and `equalTo()`\r\n * allows you to choose arbitrary starting and ending points for your queries.\r\n *\r\n * The starting point is inclusive, so children with exactly the specified value\r\n * will be included in the query. The optional key argument can be used to\r\n * further limit the range of the query. If it is specified, then children that\r\n * have exactly the specified value must also have a key name greater than or\r\n * equal to the specified key.\r\n *\r\n * You can read more about `startAt()` in\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#filtering_data | Filtering data}.\r\n *\r\n * @param value - The value to start at. The argument type depends on which\r\n * `orderBy*()` function was used in this query. Specify a value that matches\r\n * the `orderBy*()` type. When used in combination with `orderByKey()`, the\r\n * value must be a string.\r\n * @param key - The child key to start at. This argument is only allowed if\r\n * ordering by child, value, or priority.\r\n */\r\nfunction startAt(value = null, key) {\r\n    validateKey('startAt', 'key', key, true);\r\n    return new QueryStartAtConstraint(value, key);\r\n}\r\nclass QueryStartAfterConstraint extends QueryConstraint {\r\n    constructor(_value, _key) {\r\n        super();\r\n        this._value = _value;\r\n        this._key = _key;\r\n        this.type = 'startAfter';\r\n    }\r\n    _apply(query) {\r\n        validateFirebaseDataArg('startAfter', this._value, query._path, false);\r\n        const newParams = queryParamsStartAfter(query._queryParams, this._value, this._key);\r\n        validateLimit(newParams);\r\n        validateQueryEndpoints(newParams);\r\n        if (query._queryParams.hasStart()) {\r\n            throw new Error('startAfter: Starting point was already set (by another call to startAt, ' +\r\n                'startAfter, or equalTo).');\r\n        }\r\n        return new QueryImpl(query._repo, query._path, newParams, query._orderByCalled);\r\n    }\r\n}\r\n/**\r\n * Creates a `QueryConstraint` with the specified starting point (exclusive).\r\n *\r\n * Using `startAt()`, `startAfter()`, `endBefore()`, `endAt()` and `equalTo()`\r\n * allows you to choose arbitrary starting and ending points for your queries.\r\n *\r\n * The starting point is exclusive. If only a value is provided, children\r\n * with a value greater than the specified value will be included in the query.\r\n * If a key is specified, then children must have a value greater than or equal\r\n * to the specified value and a a key name greater than the specified key.\r\n *\r\n * @param value - The value to start after. The argument type depends on which\r\n * `orderBy*()` function was used in this query. Specify a value that matches\r\n * the `orderBy*()` type. When used in combination with `orderByKey()`, the\r\n * value must be a string.\r\n * @param key - The child key to start after. This argument is only allowed if\r\n * ordering by child, value, or priority.\r\n */\r\nfunction startAfter(value, key) {\r\n    validateKey('startAfter', 'key', key, true);\r\n    return new QueryStartAfterConstraint(value, key);\r\n}\r\nclass QueryLimitToFirstConstraint extends QueryConstraint {\r\n    constructor(_limit) {\r\n        super();\r\n        this._limit = _limit;\r\n        this.type = 'limitToFirst';\r\n    }\r\n    _apply(query) {\r\n        if (query._queryParams.hasLimit()) {\r\n            throw new Error('limitToFirst: Limit was already set (by another call to limitToFirst ' +\r\n                'or limitToLast).');\r\n        }\r\n        return new QueryImpl(query._repo, query._path, queryParamsLimitToFirst(query._queryParams, this._limit), query._orderByCalled);\r\n    }\r\n}\r\n/**\r\n * Creates a new `QueryConstraint` that if limited to the first specific number\r\n * of children.\r\n *\r\n * The `limitToFirst()` method is used to set a maximum number of children to be\r\n * synced for a given callback. If we set a limit of 100, we will initially only\r\n * receive up to 100 `child_added` events. If we have fewer than 100 messages\r\n * stored in our Database, a `child_added` event will fire for each message.\r\n * However, if we have over 100 messages, we will only receive a `child_added`\r\n * event for the first 100 ordered messages. As items change, we will receive\r\n * `child_removed` events for each item that drops out of the active list so\r\n * that the total number stays at 100.\r\n *\r\n * You can read more about `limitToFirst()` in\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#filtering_data | Filtering data}.\r\n *\r\n * @param limit - The maximum number of nodes to include in this query.\r\n */\r\nfunction limitToFirst(limit) {\r\n    if (typeof limit !== 'number' || Math.floor(limit) !== limit || limit <= 0) {\r\n        throw new Error('limitToFirst: First argument must be a positive integer.');\r\n    }\r\n    return new QueryLimitToFirstConstraint(limit);\r\n}\r\nclass QueryLimitToLastConstraint extends QueryConstraint {\r\n    constructor(_limit) {\r\n        super();\r\n        this._limit = _limit;\r\n        this.type = 'limitToLast';\r\n    }\r\n    _apply(query) {\r\n        if (query._queryParams.hasLimit()) {\r\n            throw new Error('limitToLast: Limit was already set (by another call to limitToFirst ' +\r\n                'or limitToLast).');\r\n        }\r\n        return new QueryImpl(query._repo, query._path, queryParamsLimitToLast(query._queryParams, this._limit), query._orderByCalled);\r\n    }\r\n}\r\n/**\r\n * Creates a new `QueryConstraint` that is limited to return only the last\r\n * specified number of children.\r\n *\r\n * The `limitToLast()` method is used to set a maximum number of children to be\r\n * synced for a given callback. If we set a limit of 100, we will initially only\r\n * receive up to 100 `child_added` events. If we have fewer than 100 messages\r\n * stored in our Database, a `child_added` event will fire for each message.\r\n * However, if we have over 100 messages, we will only receive a `child_added`\r\n * event for the last 100 ordered messages. As items change, we will receive\r\n * `child_removed` events for each item that drops out of the active list so\r\n * that the total number stays at 100.\r\n *\r\n * You can read more about `limitToLast()` in\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#filtering_data | Filtering data}.\r\n *\r\n * @param limit - The maximum number of nodes to include in this query.\r\n */\r\nfunction limitToLast(limit) {\r\n    if (typeof limit !== 'number' || Math.floor(limit) !== limit || limit <= 0) {\r\n        throw new Error('limitToLast: First argument must be a positive integer.');\r\n    }\r\n    return new QueryLimitToLastConstraint(limit);\r\n}\r\nclass QueryOrderByChildConstraint extends QueryConstraint {\r\n    constructor(_path) {\r\n        super();\r\n        this._path = _path;\r\n        this.type = 'orderByChild';\r\n    }\r\n    _apply(query) {\r\n        validateNoPreviousOrderByCall(query, 'orderByChild');\r\n        const parsedPath = new Path(this._path);\r\n        if (pathIsEmpty(parsedPath)) {\r\n            throw new Error('orderByChild: cannot pass in empty path. Use orderByValue() instead.');\r\n        }\r\n        const index = new PathIndex(parsedPath);\r\n        const newParams = queryParamsOrderBy(query._queryParams, index);\r\n        validateQueryEndpoints(newParams);\r\n        return new QueryImpl(query._repo, query._path, newParams, \r\n        /*orderByCalled=*/ true);\r\n    }\r\n}\r\n/**\r\n * Creates a new `QueryConstraint` that orders by the specified child key.\r\n *\r\n * Queries can only order by one key at a time. Calling `orderByChild()`\r\n * multiple times on the same query is an error.\r\n *\r\n * Firebase queries allow you to order your data by any child key on the fly.\r\n * However, if you know in advance what your indexes will be, you can define\r\n * them via the .indexOn rule in your Security Rules for better performance. See\r\n * the{@link https://firebase.google.com/docs/database/security/indexing-data}\r\n * rule for more information.\r\n *\r\n * You can read more about `orderByChild()` in\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#sort_data | Sort data}.\r\n *\r\n * @param path - The path to order by.\r\n */\r\nfunction orderByChild(path) {\r\n    if (path === '$key') {\r\n        throw new Error('orderByChild: \"$key\" is invalid.  Use orderByKey() instead.');\r\n    }\r\n    else if (path === '$priority') {\r\n        throw new Error('orderByChild: \"$priority\" is invalid.  Use orderByPriority() instead.');\r\n    }\r\n    else if (path === '$value') {\r\n        throw new Error('orderByChild: \"$value\" is invalid.  Use orderByValue() instead.');\r\n    }\r\n    validatePathString('orderByChild', 'path', path, false);\r\n    return new QueryOrderByChildConstraint(path);\r\n}\r\nclass QueryOrderByKeyConstraint extends QueryConstraint {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.type = 'orderByKey';\r\n    }\r\n    _apply(query) {\r\n        validateNoPreviousOrderByCall(query, 'orderByKey');\r\n        const newParams = queryParamsOrderBy(query._queryParams, KEY_INDEX);\r\n        validateQueryEndpoints(newParams);\r\n        return new QueryImpl(query._repo, query._path, newParams, \r\n        /*orderByCalled=*/ true);\r\n    }\r\n}\r\n/**\r\n * Creates a new `QueryConstraint` that orders by the key.\r\n *\r\n * Sorts the results of a query by their (ascending) key values.\r\n *\r\n * You can read more about `orderByKey()` in\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#sort_data | Sort data}.\r\n */\r\nfunction orderByKey() {\r\n    return new QueryOrderByKeyConstraint();\r\n}\r\nclass QueryOrderByPriorityConstraint extends QueryConstraint {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.type = 'orderByPriority';\r\n    }\r\n    _apply(query) {\r\n        validateNoPreviousOrderByCall(query, 'orderByPriority');\r\n        const newParams = queryParamsOrderBy(query._queryParams, PRIORITY_INDEX);\r\n        validateQueryEndpoints(newParams);\r\n        return new QueryImpl(query._repo, query._path, newParams, \r\n        /*orderByCalled=*/ true);\r\n    }\r\n}\r\n/**\r\n * Creates a new `QueryConstraint` that orders by priority.\r\n *\r\n * Applications need not use priority but can order collections by\r\n * ordinary properties (see\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#sort_data | Sort data}\r\n * for alternatives to priority.\r\n */\r\nfunction orderByPriority() {\r\n    return new QueryOrderByPriorityConstraint();\r\n}\r\nclass QueryOrderByValueConstraint extends QueryConstraint {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.type = 'orderByValue';\r\n    }\r\n    _apply(query) {\r\n        validateNoPreviousOrderByCall(query, 'orderByValue');\r\n        const newParams = queryParamsOrderBy(query._queryParams, VALUE_INDEX);\r\n        validateQueryEndpoints(newParams);\r\n        return new QueryImpl(query._repo, query._path, newParams, \r\n        /*orderByCalled=*/ true);\r\n    }\r\n}\r\n/**\r\n * Creates a new `QueryConstraint` that orders by value.\r\n *\r\n * If the children of a query are all scalar values (string, number, or\r\n * boolean), you can order the results by their (ascending) values.\r\n *\r\n * You can read more about `orderByValue()` in\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#sort_data | Sort data}.\r\n */\r\nfunction orderByValue() {\r\n    return new QueryOrderByValueConstraint();\r\n}\r\nclass QueryEqualToValueConstraint extends QueryConstraint {\r\n    constructor(_value, _key) {\r\n        super();\r\n        this._value = _value;\r\n        this._key = _key;\r\n        this.type = 'equalTo';\r\n    }\r\n    _apply(query) {\r\n        validateFirebaseDataArg('equalTo', this._value, query._path, false);\r\n        if (query._queryParams.hasStart()) {\r\n            throw new Error('equalTo: Starting point was already set (by another call to startAt/startAfter or ' +\r\n                'equalTo).');\r\n        }\r\n        if (query._queryParams.hasEnd()) {\r\n            throw new Error('equalTo: Ending point was already set (by another call to endAt/endBefore or ' +\r\n                'equalTo).');\r\n        }\r\n        return new QueryEndAtConstraint(this._value, this._key)._apply(new QueryStartAtConstraint(this._value, this._key)._apply(query));\r\n    }\r\n}\r\n/**\r\n * Creates a `QueryConstraint` that includes children that match the specified\r\n * value.\r\n *\r\n * Using `startAt()`, `startAfter()`, `endBefore()`, `endAt()` and `equalTo()`\r\n * allows you to choose arbitrary starting and ending points for your queries.\r\n *\r\n * The optional key argument can be used to further limit the range of the\r\n * query. If it is specified, then children that have exactly the specified\r\n * value must also have exactly the specified key as their key name. This can be\r\n * used to filter result sets with many matches for the same value.\r\n *\r\n * You can read more about `equalTo()` in\r\n * {@link https://firebase.google.com/docs/database/web/lists-of-data#filtering_data | Filtering data}.\r\n *\r\n * @param value - The value to match for. The argument type depends on which\r\n * `orderBy*()` function was used in this query. Specify a value that matches\r\n * the `orderBy*()` type. When used in combination with `orderByKey()`, the\r\n * value must be a string.\r\n * @param key - The child key to start at, among the children with the\r\n * previously specified priority. This argument is only allowed if ordering by\r\n * child, value, or priority.\r\n */\r\nfunction equalTo(value, key) {\r\n    validateKey('equalTo', 'key', key, true);\r\n    return new QueryEqualToValueConstraint(value, key);\r\n}\r\n/**\r\n * Creates a new immutable instance of `Query` that is extended to also include\r\n * additional query constraints.\r\n *\r\n * @param query - The Query instance to use as a base for the new constraints.\r\n * @param queryConstraints - The list of `QueryConstraint`s to apply.\r\n * @throws if any of the provided query constraints cannot be combined with the\r\n * existing or new constraints.\r\n */\r\nfunction query(query, ...queryConstraints) {\r\n    let queryImpl = getModularInstance(query);\r\n    for (const constraint of queryConstraints) {\r\n        queryImpl = constraint._apply(queryImpl);\r\n    }\r\n    return queryImpl;\r\n}\r\n/**\r\n * Define reference constructor in various modules\r\n *\r\n * We are doing this here to avoid several circular\r\n * dependency issues\r\n */\r\nsyncPointSetReferenceConstructor(ReferenceImpl);\r\nsyncTreeSetReferenceConstructor(ReferenceImpl);\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This variable is also defined in the firebase Node.js Admin SDK. Before\r\n * modifying this definition, consult the definition in:\r\n *\r\n * https://github.com/firebase/firebase-admin-node\r\n *\r\n * and make sure the two are consistent.\r\n */\r\nconst FIREBASE_DATABASE_EMULATOR_HOST_VAR = 'FIREBASE_DATABASE_EMULATOR_HOST';\r\n/**\r\n * Creates and caches `Repo` instances.\r\n */\r\nconst repos = {};\r\n/**\r\n * If true, any new `Repo` will be created to use `ReadonlyRestClient` (for testing purposes).\r\n */\r\nlet useRestClient = false;\r\n/**\r\n * Update an existing `Repo` in place to point to a new host/port.\r\n */\r\nfunction repoManagerApplyEmulatorSettings(repo, host, port, tokenProvider) {\r\n    repo.repoInfo_ = new RepoInfo(`${host}:${port}`, \r\n    /* secure= */ false, repo.repoInfo_.namespace, repo.repoInfo_.webSocketOnly, repo.repoInfo_.nodeAdmin, repo.repoInfo_.persistenceKey, repo.repoInfo_.includeNamespaceInQueryParams, \r\n    /*isUsingEmulator=*/ true);\r\n    if (tokenProvider) {\r\n        repo.authTokenProvider_ = tokenProvider;\r\n    }\r\n}\r\n/**\r\n * This function should only ever be called to CREATE a new database instance.\r\n * @internal\r\n */\r\nfunction repoManagerDatabaseFromApp(app, authProvider, appCheckProvider, url, nodeAdmin) {\r\n    let dbUrl = url || app.options.databaseURL;\r\n    if (dbUrl === undefined) {\r\n        if (!app.options.projectId) {\r\n            fatal(\"Can't determine Firebase Database URL. Be sure to include \" +\r\n                ' a Project ID when calling firebase.initializeApp().');\r\n        }\r\n        log('Using default host for project ', app.options.projectId);\r\n        dbUrl = `${app.options.projectId}-default-rtdb.firebaseio.com`;\r\n    }\r\n    let parsedUrl = parseRepoInfo(dbUrl, nodeAdmin);\r\n    let repoInfo = parsedUrl.repoInfo;\r\n    let isEmulator;\r\n    let dbEmulatorHost = undefined;\r\n    if (typeof process !== 'undefined' && process.env) {\r\n        dbEmulatorHost = process.env[FIREBASE_DATABASE_EMULATOR_HOST_VAR];\r\n    }\r\n    if (dbEmulatorHost) {\r\n        isEmulator = true;\r\n        dbUrl = `http://${dbEmulatorHost}?ns=${repoInfo.namespace}`;\r\n        parsedUrl = parseRepoInfo(dbUrl, nodeAdmin);\r\n        repoInfo = parsedUrl.repoInfo;\r\n    }\r\n    else {\r\n        isEmulator = !parsedUrl.repoInfo.secure;\r\n    }\r\n    const authTokenProvider = nodeAdmin && isEmulator\r\n        ? new EmulatorTokenProvider(EmulatorTokenProvider.OWNER)\r\n        : new FirebaseAuthTokenProvider(app.name, app.options, authProvider);\r\n    validateUrl('Invalid Firebase Database URL', parsedUrl);\r\n    if (!pathIsEmpty(parsedUrl.path)) {\r\n        fatal('Database URL must point to the root of a Firebase Database ' +\r\n            '(not including a child path).');\r\n    }\r\n    const repo = repoManagerCreateRepo(repoInfo, app, authTokenProvider, new AppCheckTokenProvider(app.name, appCheckProvider));\r\n    return new Database(repo, app);\r\n}\r\n/**\r\n * Remove the repo and make sure it is disconnected.\r\n *\r\n */\r\nfunction repoManagerDeleteRepo(repo, appName) {\r\n    const appRepos = repos[appName];\r\n    // This should never happen...\r\n    if (!appRepos || appRepos[repo.key] !== repo) {\r\n        fatal(`Database ${appName}(${repo.repoInfo_}) has already been deleted.`);\r\n    }\r\n    repoInterrupt(repo);\r\n    delete appRepos[repo.key];\r\n}\r\n/**\r\n * Ensures a repo doesn't already exist and then creates one using the\r\n * provided app.\r\n *\r\n * @param repoInfo - The metadata about the Repo\r\n * @returns The Repo object for the specified server / repoName.\r\n */\r\nfunction repoManagerCreateRepo(repoInfo, app, authTokenProvider, appCheckProvider) {\r\n    let appRepos = repos[app.name];\r\n    if (!appRepos) {\r\n        appRepos = {};\r\n        repos[app.name] = appRepos;\r\n    }\r\n    let repo = appRepos[repoInfo.toURLString()];\r\n    if (repo) {\r\n        fatal('Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.');\r\n    }\r\n    repo = new Repo(repoInfo, useRestClient, authTokenProvider, appCheckProvider);\r\n    appRepos[repoInfo.toURLString()] = repo;\r\n    return repo;\r\n}\r\n/**\r\n * Forces us to use ReadonlyRestClient instead of PersistentConnection for new Repos.\r\n */\r\nfunction repoManagerForceRestClient(forceRestClient) {\r\n    useRestClient = forceRestClient;\r\n}\r\n/**\r\n * Class representing a Firebase Realtime Database.\r\n */\r\nclass Database {\r\n    /** @hideconstructor */\r\n    constructor(_repoInternal, \r\n    /** The {@link @firebase/app#FirebaseApp} associated with this Realtime Database instance. */\r\n    app) {\r\n        this._repoInternal = _repoInternal;\r\n        this.app = app;\r\n        /** Represents a `Database` instance. */\r\n        this['type'] = 'database';\r\n        /** Track if the instance has been used (root or repo accessed) */\r\n        this._instanceStarted = false;\r\n    }\r\n    get _repo() {\r\n        if (!this._instanceStarted) {\r\n            repoStart(this._repoInternal, this.app.options.appId, this.app.options['databaseAuthVariableOverride']);\r\n            this._instanceStarted = true;\r\n        }\r\n        return this._repoInternal;\r\n    }\r\n    get _root() {\r\n        if (!this._rootInternal) {\r\n            this._rootInternal = new ReferenceImpl(this._repo, newEmptyPath());\r\n        }\r\n        return this._rootInternal;\r\n    }\r\n    _delete() {\r\n        if (this._rootInternal !== null) {\r\n            repoManagerDeleteRepo(this._repo, this.app.name);\r\n            this._repoInternal = null;\r\n            this._rootInternal = null;\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    _checkNotDeleted(apiName) {\r\n        if (this._rootInternal === null) {\r\n            fatal('Cannot call ' + apiName + ' on a deleted database.');\r\n        }\r\n    }\r\n}\r\nfunction checkTransportInit() {\r\n    if (TransportManager.IS_TRANSPORT_INITIALIZED) {\r\n        warn('Transport has already been initialized. Please call this function before calling ref or setting up a listener');\r\n    }\r\n}\r\n/**\r\n * Force the use of websockets instead of longPolling.\r\n */\r\nfunction forceWebSockets() {\r\n    checkTransportInit();\r\n    BrowserPollConnection.forceDisallow();\r\n}\r\n/**\r\n * Force the use of longPolling instead of websockets. This will be ignored if websocket protocol is used in databaseURL.\r\n */\r\nfunction forceLongPolling() {\r\n    checkTransportInit();\r\n    WebSocketConnection.forceDisallow();\r\n    BrowserPollConnection.forceAllow();\r\n}\r\n/**\r\n * Returns the instance of the Realtime Database SDK that is associated with the provided\r\n * {@link @firebase/app#FirebaseApp}. Initializes a new instance with default settings if\r\n * no instance exists or if the existing instance uses a custom database URL.\r\n *\r\n * @param app - The {@link @firebase/app#FirebaseApp} instance that the returned Realtime\r\n * Database instance is associated with.\r\n * @param url - The URL of the Realtime Database instance to connect to. If not\r\n * provided, the SDK connects to the default instance of the Firebase App.\r\n * @returns The `Database` instance of the provided app.\r\n */\r\nfunction getDatabase(app = getApp(), url) {\r\n    const db = _getProvider(app, 'database').getImmediate({\r\n        identifier: url\r\n    });\r\n    if (!db._instanceStarted) {\r\n        const emulator = getDefaultEmulatorHostnameAndPort('database');\r\n        if (emulator) {\r\n            connectDatabaseEmulator(db, ...emulator);\r\n        }\r\n    }\r\n    return db;\r\n}\r\n/**\r\n * Modify the provided instance to communicate with the Realtime Database\r\n * emulator.\r\n *\r\n * <p>Note: This method must be called before performing any other operation.\r\n *\r\n * @param db - The instance to modify.\r\n * @param host - The emulator host (ex: localhost)\r\n * @param port - The emulator port (ex: 8080)\r\n * @param options.mockUserToken - the mock auth token to use for unit testing Security Rules\r\n */\r\nfunction connectDatabaseEmulator(db, host, port, options = {}) {\r\n    db = getModularInstance(db);\r\n    db._checkNotDeleted('useEmulator');\r\n    if (db._instanceStarted) {\r\n        fatal('Cannot call useEmulator() after instance has already been initialized.');\r\n    }\r\n    const repo = db._repoInternal;\r\n    let tokenProvider = undefined;\r\n    if (repo.repoInfo_.nodeAdmin) {\r\n        if (options.mockUserToken) {\r\n            fatal('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the \"firebase\" package instead of \"firebase-admin\".');\r\n        }\r\n        tokenProvider = new EmulatorTokenProvider(EmulatorTokenProvider.OWNER);\r\n    }\r\n    else if (options.mockUserToken) {\r\n        const token = typeof options.mockUserToken === 'string'\r\n            ? options.mockUserToken\r\n            : createMockUserToken(options.mockUserToken, db.app.options.projectId);\r\n        tokenProvider = new EmulatorTokenProvider(token);\r\n    }\r\n    // Modify the repo to apply emulator settings\r\n    repoManagerApplyEmulatorSettings(repo, host, port, tokenProvider);\r\n}\r\n/**\r\n * Disconnects from the server (all Database operations will be completed\r\n * offline).\r\n *\r\n * The client automatically maintains a persistent connection to the Database\r\n * server, which will remain active indefinitely and reconnect when\r\n * disconnected. However, the `goOffline()` and `goOnline()` methods may be used\r\n * to control the client connection in cases where a persistent connection is\r\n * undesirable.\r\n *\r\n * While offline, the client will no longer receive data updates from the\r\n * Database. However, all Database operations performed locally will continue to\r\n * immediately fire events, allowing your application to continue behaving\r\n * normally. Additionally, each operation performed locally will automatically\r\n * be queued and retried upon reconnection to the Database server.\r\n *\r\n * To reconnect to the Database and begin receiving remote events, see\r\n * `goOnline()`.\r\n *\r\n * @param db - The instance to disconnect.\r\n */\r\nfunction goOffline(db) {\r\n    db = getModularInstance(db);\r\n    db._checkNotDeleted('goOffline');\r\n    repoInterrupt(db._repo);\r\n}\r\n/**\r\n * Reconnects to the server and synchronizes the offline Database state\r\n * with the server state.\r\n *\r\n * This method should be used after disabling the active connection with\r\n * `goOffline()`. Once reconnected, the client will transmit the proper data\r\n * and fire the appropriate events so that your client \"catches up\"\r\n * automatically.\r\n *\r\n * @param db - The instance to reconnect.\r\n */\r\nfunction goOnline(db) {\r\n    db = getModularInstance(db);\r\n    db._checkNotDeleted('goOnline');\r\n    repoResume(db._repo);\r\n}\r\nfunction enableLogging(logger, persistent) {\r\n    enableLogging$1(logger, persistent);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerDatabase(variant) {\r\n    setSDKVersion(SDK_VERSION$1);\r\n    _registerComponent(new Component('database', (container, { instanceIdentifier: url }) => {\r\n        const app = container.getProvider('app').getImmediate();\r\n        const authProvider = container.getProvider('auth-internal');\r\n        const appCheckProvider = container.getProvider('app-check-internal');\r\n        return repoManagerDatabaseFromApp(app, authProvider, appCheckProvider, url);\r\n    }, \"PUBLIC\" /* ComponentType.PUBLIC */).setMultipleInstances(true));\r\n    registerVersion(name, version, variant);\r\n    // BUILD_TARGET will be replaced by values like esm5, esm2017, cjs5, etc during the compilation\r\n    registerVersion(name, version, 'esm2017');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst SERVER_TIMESTAMP = {\r\n    '.sv': 'timestamp'\r\n};\r\n/**\r\n * Returns a placeholder value for auto-populating the current timestamp (time\r\n * since the Unix epoch, in milliseconds) as determined by the Firebase\r\n * servers.\r\n */\r\nfunction serverTimestamp() {\r\n    return SERVER_TIMESTAMP;\r\n}\r\n/**\r\n * Returns a placeholder value that can be used to atomically increment the\r\n * current database value by the provided delta.\r\n *\r\n * @param delta - the amount to modify the current value atomically.\r\n * @returns A placeholder value for modifying data atomically server-side.\r\n */\r\nfunction increment(delta) {\r\n    return {\r\n        '.sv': {\r\n            'increment': delta\r\n        }\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A type for the resolve value of {@link runTransaction}.\r\n */\r\nclass TransactionResult {\r\n    /** @hideconstructor */\r\n    constructor(\r\n    /** Whether the transaction was successfully committed. */\r\n    committed, \r\n    /** The resulting data snapshot. */\r\n    snapshot) {\r\n        this.committed = committed;\r\n        this.snapshot = snapshot;\r\n    }\r\n    /** Returns a JSON-serializable representation of this object. */\r\n    toJSON() {\r\n        return { committed: this.committed, snapshot: this.snapshot.toJSON() };\r\n    }\r\n}\r\n/**\r\n * Atomically modifies the data at this location.\r\n *\r\n * Atomically modify the data at this location. Unlike a normal `set()`, which\r\n * just overwrites the data regardless of its previous value, `runTransaction()` is\r\n * used to modify the existing value to a new value, ensuring there are no\r\n * conflicts with other clients writing to the same location at the same time.\r\n *\r\n * To accomplish this, you pass `runTransaction()` an update function which is\r\n * used to transform the current value into a new value. If another client\r\n * writes to the location before your new value is successfully written, your\r\n * update function will be called again with the new current value, and the\r\n * write will be retried. This will happen repeatedly until your write succeeds\r\n * without conflict or you abort the transaction by not returning a value from\r\n * your update function.\r\n *\r\n * Note: Modifying data with `set()` will cancel any pending transactions at\r\n * that location, so extreme care should be taken if mixing `set()` and\r\n * `runTransaction()` to update the same data.\r\n *\r\n * Note: When using transactions with Security and Firebase Rules in place, be\r\n * aware that a client needs `.read` access in addition to `.write` access in\r\n * order to perform a transaction. This is because the client-side nature of\r\n * transactions requires the client to read the data in order to transactionally\r\n * update it.\r\n *\r\n * @param ref - The location to atomically modify.\r\n * @param transactionUpdate - A developer-supplied function which will be passed\r\n * the current data stored at this location (as a JavaScript object). The\r\n * function should return the new value it would like written (as a JavaScript\r\n * object). If `undefined` is returned (i.e. you return with no arguments) the\r\n * transaction will be aborted and the data at this location will not be\r\n * modified.\r\n * @param options - An options object to configure transactions.\r\n * @returns A `Promise` that can optionally be used instead of the `onComplete`\r\n * callback to handle success and failure.\r\n */\r\nfunction runTransaction(ref, \r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntransactionUpdate, options) {\r\n    var _a;\r\n    ref = getModularInstance(ref);\r\n    validateWritablePath('Reference.transaction', ref._path);\r\n    if (ref.key === '.length' || ref.key === '.keys') {\r\n        throw ('Reference.transaction failed: ' + ref.key + ' is a read-only object.');\r\n    }\r\n    const applyLocally = (_a = options === null || options === void 0 ? void 0 : options.applyLocally) !== null && _a !== void 0 ? _a : true;\r\n    const deferred = new Deferred();\r\n    const promiseComplete = (error, committed, node) => {\r\n        let dataSnapshot = null;\r\n        if (error) {\r\n            deferred.reject(error);\r\n        }\r\n        else {\r\n            dataSnapshot = new DataSnapshot(node, new ReferenceImpl(ref._repo, ref._path), PRIORITY_INDEX);\r\n            deferred.resolve(new TransactionResult(committed, dataSnapshot));\r\n        }\r\n    };\r\n    // Add a watch to make sure we get server updates.\r\n    const unwatcher = onValue(ref, () => { });\r\n    repoStartTransaction(ref._repo, ref._path, transactionUpdate, promiseComplete, unwatcher, applyLocally);\r\n    return deferred.promise;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nPersistentConnection;\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nPersistentConnection.prototype.simpleListen = function (pathString, onComplete) {\r\n    this.sendRequest('q', { p: pathString }, onComplete);\r\n};\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nPersistentConnection.prototype.echo = function (data, onEcho) {\r\n    this.sendRequest('echo', { d: data }, onEcho);\r\n};\r\n// RealTimeConnection properties that we use in tests.\r\nConnection;\r\n/**\r\n * @internal\r\n */\r\nconst hijackHash = function (newHash) {\r\n    const oldPut = PersistentConnection.prototype.put;\r\n    PersistentConnection.prototype.put = function (pathString, data, onComplete, hash) {\r\n        if (hash !== undefined) {\r\n            hash = newHash();\r\n        }\r\n        oldPut.call(this, pathString, data, onComplete, hash);\r\n    };\r\n    return function () {\r\n        PersistentConnection.prototype.put = oldPut;\r\n    };\r\n};\r\nRepoInfo;\r\n/**\r\n * Forces the RepoManager to create Repos that use ReadonlyRestClient instead of PersistentConnection.\r\n * @internal\r\n */\r\nconst forceRestClient = function (forceRestClient) {\r\n    repoManagerForceRestClient(forceRestClient);\r\n};\n\n/**\r\n * @license\r\n * Copyright 2023 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Used by console to create a database based on the app,\r\n * passed database URL and a custom auth implementation.\r\n * @internal\r\n * @param app - A valid FirebaseApp-like object\r\n * @param url - A valid Firebase databaseURL\r\n * @param version - custom version e.g. firebase-admin version\r\n * @param customAppCheckImpl - custom app check implementation\r\n * @param customAuthImpl - custom auth implementation\r\n */\r\nfunction _initStandalone({ app, url, version, customAuthImpl, customAppCheckImpl, nodeAdmin = false }) {\r\n    setSDKVersion(version);\r\n    /**\r\n     * ComponentContainer('database-standalone') is just a placeholder that doesn't perform\r\n     * any actual function.\r\n     */\r\n    const componentContainer = new ComponentContainer('database-standalone');\r\n    const authProvider = new Provider('auth-internal', componentContainer);\r\n    let appCheckProvider;\r\n    if (customAppCheckImpl) {\r\n        appCheckProvider = new Provider('app-check-internal', componentContainer);\r\n        appCheckProvider.setComponent(new Component('app-check-internal', () => customAppCheckImpl, \"PRIVATE\" /* ComponentType.PRIVATE */));\r\n    }\r\n    authProvider.setComponent(new Component('auth-internal', () => customAuthImpl, \"PRIVATE\" /* ComponentType.PRIVATE */));\r\n    return repoManagerDatabaseFromApp(app, authProvider, appCheckProvider, url, nodeAdmin);\r\n}\n\n/**\r\n * Firebase Realtime Database\r\n *\r\n * @packageDocumentation\r\n */\r\nregisterDatabase();\n\nexport { DataSnapshot, Database, OnDisconnect, QueryConstraint, TransactionResult, QueryImpl as _QueryImpl, QueryParams as _QueryParams, ReferenceImpl as _ReferenceImpl, forceRestClient as _TEST_ACCESS_forceRestClient, hijackHash as _TEST_ACCESS_hijackHash, _initStandalone, repoManagerDatabaseFromApp as _repoManagerDatabaseFromApp, setSDKVersion as _setSDKVersion, validatePathString as _validatePathString, validateWritablePath as _validateWritablePath, child, connectDatabaseEmulator, enableLogging, endAt, endBefore, equalTo, forceLongPolling, forceWebSockets, get, getDatabase, goOffline, goOnline, increment, limitToFirst, limitToLast, off, onChildAdded, onChildChanged, onChildMoved, onChildRemoved, onDisconnect, onValue, orderByChild, orderByKey, orderByPriority, orderByValue, push, query, ref, refFromURL, remove, runTransaction, serverTimestamp, set, setPriority, setWithPriority, startAfter, startAt, update };\n//# sourceMappingURL=index.esm2017.js.map\n","/**\n * Matchmaking System\n * Handles automatic party matching using Firebase Realtime Database\n */\n\nimport { initializeApp } from 'firebase/app';\nimport {\n    getDatabase,\n    ref,\n    push,\n    set,\n    remove,\n    onValue,\n    off,\n    serverTimestamp,\n    onDisconnect,\n    query,\n    orderByChild\n} from 'firebase/database';\nimport { getPlayerName, getInviteCode } from './metaProgression.js';\nimport { joinPartyAsClient, getParty, getPartySize, isPartyFull } from './partySystem.js';\n\n// Firebase configuration\nconst firebaseConfig = {\n    apiKey: \"AIzaSyCiodw7WUk-nxFoTDUpCVFF7hA9RUObQj4\",\n    authDomain: \"supersmashtexty.firebaseapp.com\",\n    databaseURL: \"https://supersmashtexty-default-rtdb.firebaseio.com\",\n    projectId: \"supersmashtexty\",\n    storageBucket: \"supersmashtexty.firebasestorage.app\",\n    messagingSenderId: \"212983770797\",\n    appId: \"1:212983770797:web:000257ef09b3b68fb3e024\"\n};\n\n// Firebase state\nlet app = null;\nlet database = null;\nlet isInitialized = false;\n\n// Matchmaking state\nlet isSearching = false;\nlet queueEntryRef = null;\nlet queueListener = null;\nlet kaplayInstance = null;\nlet matchmakingCallbacks = null;\n\n/**\n * Initialize Firebase (lazy initialization)\n */\nfunction initFirebase() {\n    if (isInitialized) return true;\n\n    try {\n        // Check if config has been set up\n        if (firebaseConfig.apiKey === \"YOUR_API_KEY\") {\n            console.warn('[Matchmaking] Firebase not configured. Please update firebaseConfig in matchmakingSystem.js');\n            return false;\n        }\n\n        app = initializeApp(firebaseConfig);\n        database = getDatabase(app);\n        isInitialized = true;\n        console.log('[Matchmaking] Firebase initialized');\n        return true;\n    } catch (err) {\n        console.error('[Matchmaking] Failed to initialize Firebase:', err);\n        return false;\n    }\n}\n\n/**\n * Store Kaplay reference for scene navigation\n * @param {Object} k - Kaplay instance\n */\nexport function setupGlobalMatchHandler(k) {\n    kaplayInstance = k;\n    console.log('[Matchmaking] Global match handler set up');\n}\n\n/**\n * Check if currently searching for a match\n * @returns {boolean} True if searching\n */\nexport function isMatchmaking() {\n    return isSearching;\n}\n\n/**\n * Start matchmaking - add to queue and listen for matches\n * @param {Object} callbacks - Callback functions\n * @param {Function} callbacks.onSearchStart - Called when search starts\n * @param {Function} callbacks.onMatchFound - Called when match is found (receives hostInviteCode or null if we're host)\n * @param {Function} callbacks.onError - Called on error\n * @param {Function} callbacks.onSearchEnd - Called when search ends (success or cancel)\n * @returns {boolean} True if search started successfully\n */\nexport async function startMatchmaking(callbacks = {}) {\n    if (isSearching) {\n        console.log('[Matchmaking] Already searching');\n        return false;\n    }\n\n    if (!initFirebase()) {\n        callbacks.onError?.('Firebase not configured');\n        return false;\n    }\n\n    // Check if party is full\n    if (isPartyFull()) {\n        console.log('[Matchmaking] Party is full, cannot search');\n        callbacks.onError?.('Party is full');\n        return false;\n    }\n\n    matchmakingCallbacks = callbacks;\n    isSearching = true;\n    callbacks.onSearchStart?.();\n\n    try {\n        const playerName = getPlayerName();\n        const inviteCode = getInviteCode();\n\n        // Add ourselves to the queue\n        const queueRef = ref(database, 'matchmaking/queue');\n        queueEntryRef = push(queueRef);\n\n        await set(queueEntryRef, {\n            inviteCode: inviteCode,\n            playerName: playerName,\n            timestamp: serverTimestamp()\n        });\n\n        // Set up auto-remove on disconnect\n        onDisconnect(queueEntryRef).remove();\n\n        console.log('[Matchmaking] Added to queue:', inviteCode);\n\n        // Listen for changes in the queue\n        const orderedQueueRef = query(queueRef, orderByChild('timestamp'));\n        queueListener = onValue(orderedQueueRef, async (snapshot) => {\n            if (!isSearching) return;\n\n            const queueData = snapshot.val();\n            if (!queueData) return;\n\n            // Convert to array and sort by timestamp\n            const players = Object.entries(queueData)\n                .map(([key, value]) => ({ key, ...value }))\n                .filter(p => p.timestamp) // Filter out entries without timestamp yet\n                .sort((a, b) => a.timestamp - b.timestamp);\n\n            console.log('[Matchmaking] Queue updated:', players.length, 'players');\n\n            if (players.length >= 2) {\n                // Find our entry\n                const ourEntry = players.find(p => p.inviteCode === inviteCode);\n                if (!ourEntry) return;\n\n                // The earliest player becomes the host\n                const hostEntry = players[0];\n\n                if (hostEntry.inviteCode === inviteCode) {\n                    // We are the host - wait for others to join us\n                    console.log('[Matchmaking] We are the host, waiting for players to join...');\n                    // Don't do anything yet - other players will join us\n                    // We'll be removed from queue when someone joins our party\n                } else {\n                    // We should join the host\n                    console.log('[Matchmaking] Found host:', hostEntry.inviteCode, '- attempting to join');\n\n                    // Stop listening before attempting to join (don't notify yet)\n                    stopMatchmaking(false);\n\n                    try {\n                        const success = await joinPartyAsClient(hostEntry.inviteCode);\n                        if (success) {\n                            console.log('[Matchmaking] Successfully joined host');\n                            callbacks.onMatchFound?.(hostEntry.inviteCode);\n\n                            // Navigate to menu if in a different scene\n                            if (kaplayInstance) {\n                                kaplayInstance.go('menu');\n                            }\n                        } else {\n                            console.log('[Matchmaking] Failed to join host, restarting search');\n                            // Failed to join - restart search\n                            callbacks.onError?.('Failed to connect to host');\n                            // Could restart search here if desired\n                        }\n                    } catch (err) {\n                        console.error('[Matchmaking] Error joining host:', err);\n                        callbacks.onError?.('Connection error');\n                    }\n\n                    // Now notify search ended\n                    callbacks.onSearchEnd?.();\n                }\n            }\n        });\n\n        return true;\n    } catch (err) {\n        console.error('[Matchmaking] Failed to start matchmaking:', err);\n        isSearching = false;\n        callbacks.onError?.(err.message);\n        callbacks.onSearchEnd?.();\n        return false;\n    }\n}\n\n/**\n * Stop matchmaking - remove from queue and cancel listener\n * @param {boolean} notifyEnd - Whether to call onSearchEnd callback (default true)\n */\nexport async function stopMatchmaking(notifyEnd = true) {\n    if (!isSearching && !queueEntryRef) {\n        return;\n    }\n\n    console.log('[Matchmaking] Stopping matchmaking');\n    isSearching = false;\n\n    // Remove queue listener\n    if (queueListener && database) {\n        const queueRef = ref(database, 'matchmaking/queue');\n        off(queueRef);\n        queueListener = null;\n    }\n\n    // Remove ourselves from the queue (fire and forget - don't block UI)\n    if (queueEntryRef) {\n        const entryToRemove = queueEntryRef;\n        queueEntryRef = null;\n        remove(entryToRemove)\n            .then(() => console.log('[Matchmaking] Removed from queue'))\n            .catch(err => console.error('[Matchmaking] Failed to remove from queue:', err));\n    }\n\n    if (notifyEnd) {\n        matchmakingCallbacks?.onSearchEnd?.();\n    }\n    matchmakingCallbacks = null;\n}\n\n/**\n * Called by partySystem when a player joins the party\n * If we're the host and were matchmaking, remove ourselves from queue\n */\nexport function onPlayerJoinedParty() {\n    const party = getParty();\n\n    // Only hosts need to handle this\n    if (!party.isHost) return;\n\n    // If we were matchmaking, stop and notify\n    if (isSearching || queueEntryRef) {\n        console.log('[Matchmaking] Player joined our party - stopping matchmaking');\n\n        // Save callbacks before stopMatchmaking clears them\n        const callbacks = matchmakingCallbacks;\n\n        // Stop matchmaking but don't call onSearchEnd yet (we'll call onMatchFound instead)\n        stopMatchmaking(false);\n\n        // Notify that we found a match (we're the host, so hostCode is null)\n        callbacks?.onMatchFound?.(null);\n        callbacks?.onSearchEnd?.();\n\n        // Navigate to menu if in a different scene\n        if (kaplayInstance) {\n            kaplayInstance.go('menu');\n        }\n    }\n}\n\n/**\n * Check if Firebase is configured\n * @returns {boolean} True if Firebase config is set up\n */\nexport function isFirebaseConfigured() {\n    return firebaseConfig.apiKey !== \"YOUR_API_KEY\";\n}\n","/**\n * Party System\n * Manages multiplayer party state and joining\n */\n\nimport { getPlayerName, getInviteCode, getSelectedCharacter, setInviteCode, getPermanentUpgradeLevel, getSelectedPortrait, getPlayerLevel, getTotalXP, getSaveStats, getUnlockedAchievements, getUnlockedPortraits } from './metaProgression.js';\nimport {\n    initNetwork,\n    connectToHost,\n    onMessage,\n    onConnectionChange,\n    broadcast,\n    sendToHost,\n    sendToPeer,\n    getConnectedPeers,\n    getNetworkInfo,\n    disconnect\n} from './networkSystem.js';\nimport { sendInitialGameState, handlePlayerDisconnect as cleanupDisconnectedPlayer } from './multiplayerGame.js';\nimport { onPlayerJoinedParty } from './matchmakingSystem.js';\n\n// Party state\nconst party = {\n    slots: [\n        { playerId: 'local', playerName: null, inviteCode: null, selectedCharacter: null, selectedPortrait: null, playerLevel: 1, isLocal: true, peerId: null, isReady: false }, // Slot 1: Local player\n        { playerId: null, playerName: null, inviteCode: null, selectedCharacter: null, selectedPortrait: null, playerLevel: 1, isLocal: false, peerId: null, isReady: false }, // Slot 2: Empty\n        { playerId: null, playerName: null, inviteCode: null, selectedCharacter: null, selectedPortrait: null, playerLevel: 1, isLocal: false, peerId: null, isReady: false }, // Slot 3: Empty\n        { playerId: null, playerName: null, inviteCode: null, selectedCharacter: null, selectedPortrait: null, playerLevel: 1, isLocal: false, peerId: null, isReady: false }  // Slot 4: Empty\n    ],\n    isHost: true, // Local player is always the host for now\n    maxSlots: 4,\n    peerIdToSlot: new Map(), // Map peer IDs to slot indices\n    networkInitialized: false,\n    kaplayInstance: null, // Reference to kaplay instance for client game start\n    hostInviteCode: null, // The host's invite code (null if we are the host, or the code we joined if we're a client)\n    // Disconnect handling\n    disconnectedPlayers: new Map(), // Map slotIndex -> { disconnectTime, playerData }\n    reconnectWindow: 15000, // 15 seconds to reconnect\n    // Ready-up and countdown\n    countdownActive: false,\n    countdownStartTime: 0,\n    countdownDuration: 3000, // 3 seconds countdown\n    // Party emotes\n    activeEmotes: new Map(), // Map slotIndex -> { emoteType, startTime }\n    emoteCallbacks: [] // Callbacks to notify when emotes are received\n};\n\n// Flags to prevent duplicate handler registration (memory leak/freeze prevention)\nlet partyHostHandlersRegistered = false;\nlet partyClientHandlersRegistered = false;\n\n/**\n * Initialize party system\n * @param {Object} k - Kaplay instance (optional, used for client game start)\n */\nexport async function initParty(k = null) {\n    // Store kaplay instance for client game start\n    if (k) {\n        party.kaplayInstance = k;\n    }\n\n    // Only set local player info in slot 0 if we're the host\n    // For clients, their slot info is set by party_sync from the host\n    if (party.isHost) {\n        const playerName = getPlayerName();\n        const inviteCode = getInviteCode();\n        const selectedCharacter = getSelectedCharacter();\n        const selectedPortrait = getSelectedPortrait();\n\n        party.slots[0].playerId = 'local';\n        party.slots[0].playerName = playerName || 'Player'; // Fallback if name not set\n        party.slots[0].inviteCode = inviteCode || '000000'; // Fallback if code not set\n        party.slots[0].selectedCharacter = selectedCharacter || 'survivor'; // Fallback if character not set\n        party.slots[0].selectedPortrait = selectedPortrait || 'default'; // Fallback if portrait not set\n        party.slots[0].playerLevel = getPlayerLevel();\n        party.slots[0].isLocal = true;\n        party.slots[0].permanentUpgradeLevels = {\n            startingHealth: getPermanentUpgradeLevel('startingHealth'),\n            startingDamage: getPermanentUpgradeLevel('startingDamage'),\n            startingSpeed: getPermanentUpgradeLevel('startingSpeed'),\n            propDurability: getPermanentUpgradeLevel('propDurability'),\n            propDropChance: getPermanentUpgradeLevel('propDropChance')\n        };\n\n        console.log('[PartySystem] Host player initialized in slot 0:', {\n            name: party.slots[0].playerName,\n            code: party.slots[0].inviteCode,\n            character: party.slots[0].selectedCharacter\n        });\n    } else {\n        console.log('[PartySystem] Client mode - preserving existing slot assignments');\n    }\n\n    // Initialize network as host so other players can connect\n    // This is needed because we display the invite code in the UI,\n    // meaning we're always potentially hosting\n    if (!party.networkInitialized) {\n        try {\n            console.log('[PartySystem] Initializing network as host...');\n            const inviteCode = getInviteCode();\n            const actualCode = await initNetwork(inviteCode, true);\n\n            // If the code changed (because it was taken), update it\n            if (actualCode !== inviteCode) {\n                console.log(`[PartySystem] Invite code changed: ${inviteCode} -> ${actualCode}`);\n                setInviteCode(actualCode);\n                party.slots[0].inviteCode = actualCode;\n            }\n\n            party.networkInitialized = true;\n            party.isHost = true;\n            setupNetworkHandlers();\n            console.log('[PartySystem] Network initialized as host - ready to accept connections');\n        } catch (err) {\n            console.error('[PartySystem] Failed to initialize network as host:', err);\n            console.log('[PartySystem] Multiplayer disabled - running in single-player mode');\n            // Continue anyway - single-player will still work\n        }\n    }\n}\n\n/**\n * Set up network message handlers (for host)\n */\nexport function setupNetworkHandlers() {\n    // Prevent duplicate handler registration (causes memory leaks and freezes)\n    if (partyHostHandlersRegistered) {\n        return;\n    }\n    partyHostHandlersRegistered = true;\n\n    // Handle join requests from clients\n    onMessage('join_request', (payload, fromPeerId) => {\n        console.log('[PartySystem] Join request from:', fromPeerId);\n        console.log('[PartySystem] Payload:', {\n            playerName: payload.playerName,\n            inviteCode: payload.inviteCode,\n            selectedCharacter: payload.selectedCharacter\n        });\n\n        // Validate payload has required data\n        if (!payload.playerName) {\n            console.warn('[PartySystem] Join request missing playerName, using default');\n        }\n\n        // Add player to party\n        const slotIndex = addPlayerToPartyFromNetwork(\n            payload.playerName || 'Player',\n            payload.inviteCode || '000000',\n            payload.selectedCharacter || 'survivor',\n            payload.selectedPortrait || 'default',\n            fromPeerId,\n            payload.permanentUpgradeLevels || null,\n            payload.playerLevel || 1\n        );\n\n        if (slotIndex !== null) {\n            // Send party sync to the new player\n            const partySyncData = {\n                slots: party.slots.map(slot => ({\n                    playerId: slot.playerId,\n                    playerName: slot.playerName,\n                    inviteCode: slot.inviteCode,\n                    selectedCharacter: slot.selectedCharacter,\n                    selectedPortrait: slot.selectedPortrait,\n                    playerLevel: slot.playerLevel,\n                    permanentUpgradeLevels: slot.permanentUpgradeLevels,\n                    isLocal: false // All remote for the client\n                })),\n                yourSlotIndex: slotIndex\n            };\n\n            console.log('[PartySystem] Sending party_sync to new player:', {\n                hostName: partySyncData.slots[0].playerName,\n                hostCharacter: partySyncData.slots[0].selectedCharacter,\n                newPlayerSlot: slotIndex\n            });\n\n            sendToPeer(fromPeerId, 'party_sync', partySyncData);\n\n            // Send immediate game state if in-game (don't wait for next broadcast cycle)\n            // This helps clients joining mid-game see entities immediately\n            // Use a slightly longer delay to ensure client has processed party_sync\n            // and initialized their game scene handlers\n            setTimeout(() => {\n                sendInitialGameState(fromPeerId);\n            }, 250); // Increased delay for slower connections\n\n            // Broadcast updated party to all other clients\n            broadcastPartyUpdate();\n\n            // Notify matchmaking system that a player joined (host removes self from queue)\n            onPlayerJoinedParty();\n        } else {\n            // Party full - send rejection\n            sendToPeer(fromPeerId, 'join_rejected', { reason: 'Party full' });\n        }\n    });\n\n    // Handle player info updates from clients\n    onMessage('player_info', (payload, fromPeerId) => {\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\n        if (slotIndex !== undefined) {\n            if (payload.playerName) {\n                party.slots[slotIndex].playerName = payload.playerName;\n            }\n            broadcastPartyUpdate();\n        }\n    });\n\n    // Handle character changes from clients\n    onMessage('character_change', (payload, fromPeerId) => {\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\n        if (slotIndex !== undefined) {\n            console.log(`[PartySystem] Player in slot ${slotIndex} changed character to:`, payload.selectedCharacter);\n            party.slots[slotIndex].selectedCharacter = payload.selectedCharacter;\n            broadcastPartyUpdate();\n        }\n    });\n\n    // Handle ready state changes from clients\n    onMessage('ready_change', (payload, fromPeerId) => {\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\n        if (slotIndex !== undefined) {\n            console.log(`[PartySystem] Player in slot ${slotIndex} ready state:`, payload.isReady);\n            party.slots[slotIndex].isReady = payload.isReady;\n            broadcastPartyUpdate();\n            // Check if all players are ready\n            checkAllReady();\n        }\n    });\n\n    // Handle party emotes from clients - rebroadcast to all\n    onMessage('party_emote', (payload, fromPeerId) => {\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\n        if (slotIndex !== undefined) {\n            // Set the slot index from the verified peer\n            payload.slotIndex = slotIndex;\n            // Store emote and notify callbacks\n            handlePartyEmote(payload);\n            // Rebroadcast to all clients\n            broadcast('party_emote', payload);\n        }\n    });\n\n    // Handle profile requests from clients\n    onMessage('profile_request', (payload, fromPeerId) => {\n        const targetSlot = payload.targetSlot;\n        if (targetSlot === 0) {\n            // Client wants host's profile\n            handleProfileRequest(payload, fromPeerId);\n        } else {\n            // Client wants another client's profile - forward the request\n            const targetPeerId = party.slots[targetSlot]?.peerId;\n            if (targetPeerId) {\n                sendToPeer(targetPeerId, 'profile_request', {\n                    requestingSlot: party.peerIdToSlot.get(fromPeerId),\n                    forwardTo: fromPeerId\n                });\n            }\n        }\n    });\n\n    // Handle profile responses from clients\n    onMessage('profile_response', (payload, fromPeerId) => {\n        const slotIndex = party.peerIdToSlot.get(fromPeerId);\n        if (slotIndex !== undefined) {\n            payload.slotIndex = slotIndex;\n            // Check if this is a forwarded response\n            if (payload.forwardTo) {\n                sendToPeer(payload.forwardTo, 'profile_response', payload);\n            } else {\n                // This is for the host\n                handleProfileResponse(payload);\n            }\n        }\n    });\n\n    // Handle connection changes\n    onConnectionChange((event, peerId) => {\n        if (event === 'leave') {\n            handlePlayerDisconnect(peerId);\n        }\n    });\n}\n\n/**\n * Get party state\n * @returns {object} Party state\n */\nexport function getParty() {\n    return party;\n}\n\n/**\n * Get local player\n * @returns {object} Local player slot\n */\nexport function getLocalPlayer() {\n    return party.slots[0];\n}\n\n// Re-export helper functions from metaProgression for convenience\nexport { getPlayerName, getInviteCode, getSelectedCharacter };\n\n/**\n * Get party size (number of players)\n * @returns {number} Number of players in party\n */\nexport function getPartySize() {\n    return party.slots.filter(slot => slot.playerId !== null).length;\n}\n\n/**\n * Check if party is full\n * @returns {boolean} True if all slots filled\n */\nexport function isPartyFull() {\n    return getPartySize() >= party.maxSlots;\n}\n\n/**\n * Get the invite code to display in UI\n * Returns the host's code if we're a client, or our own code if we're the host\n * @returns {string} Invite code to display\n */\nexport function getDisplayInviteCode() {\n    // If we're a client, show the host's code we joined\n    if (!party.isHost && party.hostInviteCode) {\n        return party.hostInviteCode;\n    }\n    // If we're the host, show our own code\n    return getInviteCode();\n}\n\n/**\n * Add player to party (when they join via code) - LEGACY, use joinPartyAsClient\n * @param {string} playerName - Player name\n * @param {string} inviteCode - Player invite code\n * @returns {number|null} Slot index if successful, null if party full\n */\nexport function addPlayerToParty(playerName, inviteCode) {\n    // Find first empty slot\n    for (let i = 1; i < party.slots.length; i++) {\n        if (party.slots[i].playerId === null) {\n            party.slots[i].playerId = `player_${Date.now()}_${i}`;\n            party.slots[i].playerName = playerName;\n            party.slots[i].inviteCode = inviteCode;\n            return i;\n        }\n    }\n    return null; // Party full\n}\n\n/**\n * Add player to party from network (host only)\n * @param {string} playerName - Player name\n * @param {string} inviteCode - Player invite code\n * @param {string} selectedCharacter - Player's selected character key\n * @param {string} peerId - Peer ID of the joining player\n * @returns {number|null} Slot index if successful, null if party full\n */\nfunction addPlayerToPartyFromNetwork(playerName, inviteCode, selectedCharacter, selectedPortrait, peerId, permanentUpgradeLevels = null, playerLevel = 1) {\n    // Find first empty slot\n    for (let i = 1; i < party.slots.length; i++) {\n        if (party.slots[i].playerId === null) {\n            party.slots[i].playerId = `player_${Date.now()}_${i}`;\n            party.slots[i].playerName = playerName;\n            party.slots[i].inviteCode = inviteCode;\n            party.slots[i].selectedCharacter = selectedCharacter;\n            party.slots[i].selectedPortrait = selectedPortrait;\n            party.slots[i].playerLevel = playerLevel;\n            party.slots[i].peerId = peerId;\n            party.slots[i].permanentUpgradeLevels = permanentUpgradeLevels;\n            party.peerIdToSlot.set(peerId, i);\n            return i;\n        }\n    }\n    return null; // Party full\n}\n\n/**\n * Join a party as a client\n * @param {string} hostInviteCode - Host's 6-digit invite code\n * @returns {Promise<boolean>} True if successfully joined\n */\nexport async function joinPartyAsClient(hostInviteCode) {\n    // Save local player info before clearing (for restoration on failure)\n    const savedLocalPlayer = {\n        playerName: getPlayerName(),\n        inviteCode: getInviteCode(),\n        selectedCharacter: getSelectedCharacter()\n    };\n\n    try {\n        // Always clear party slots when joining as client - they'll be repopulated by party_sync\n        console.log('[PartySystem] Joining as client - clearing all party slots');\n        for (let i = 0; i < party.slots.length; i++) {\n            party.slots[i] = {\n                playerId: null,\n                playerName: null,\n                inviteCode: null,\n                selectedCharacter: null,\n                selectedPortrait: null,\n                playerLevel: 1,\n                isLocal: false,\n                peerId: null,\n                isReady: false\n            };\n        }\n\n        // If we were initialized as host, disconnect and re-initialize as client\n        if (party.networkInitialized && party.isHost) {\n            console.log('[PartySystem] Switching from host to client - disconnecting current peer...');\n            disconnect();\n            party.networkInitialized = false;\n            party.isHost = false;\n            // Reset handler flags to allow client handler registration\n            partyHostHandlersRegistered = false;\n            partyClientHandlersRegistered = false;\n        }\n\n        // Initialize network as client\n        if (!party.networkInitialized) {\n            await initNetwork('client', false);\n            party.networkInitialized = true;\n            party.isHost = false;\n        }\n\n        // Store the host's invite code so we can display it\n        party.hostInviteCode = hostInviteCode;\n\n        // Set up client message handlers\n        setupClientHandlers();\n\n        // Connect to host\n        await connectToHost(hostInviteCode);\n\n        // Send our player info including selected character, portrait, and permanent upgrades\n        sendToHost('join_request', {\n            playerName: savedLocalPlayer.playerName,\n            inviteCode: savedLocalPlayer.inviteCode,\n            selectedCharacter: savedLocalPlayer.selectedCharacter,\n            selectedPortrait: getSelectedPortrait() || 'default',\n            playerLevel: getPlayerLevel(),\n            permanentUpgradeLevels: {\n                startingHealth: getPermanentUpgradeLevel('startingHealth'),\n                startingDamage: getPermanentUpgradeLevel('startingDamage'),\n                startingSpeed: getPermanentUpgradeLevel('startingSpeed'),\n                propDurability: getPermanentUpgradeLevel('propDurability'),\n                propDropChance: getPermanentUpgradeLevel('propDropChance')\n            }\n        });\n\n        return true;\n    } catch (err) {\n        console.error('Failed to join party:', err);\n\n        // Restore local player to solo party state on failure\n        console.log('[PartySystem] Restoring local player after join failure');\n        restoreLocalPlayerToSoloParty(savedLocalPlayer);\n\n        return false;\n    }\n}\n\n/**\n * Restore local player to solo party state (after failed/cancelled join)\n * @param {Object} playerInfo - Saved player info {playerName, inviteCode, selectedCharacter}\n */\nexport function restoreLocalPlayerToSoloParty(playerInfo) {\n    // Disconnect network if still trying to connect as client\n    if (party.networkInitialized && !party.isHost) {\n        disconnect();\n    }\n\n    // Reset to host state\n    party.isHost = true;\n    party.hostInviteCode = null;\n    party.networkInitialized = false;\n\n    // Reset handler registration flags to allow re-registration\n    partyHostHandlersRegistered = false;\n    partyClientHandlersRegistered = false;\n\n    // Clear all slots\n    for (let i = 0; i < party.slots.length; i++) {\n        party.slots[i] = {\n            playerId: null,\n            playerName: null,\n            inviteCode: null,\n            selectedCharacter: null,\n            selectedPortrait: null,\n            playerLevel: 1,\n            isLocal: false,\n            peerId: null,\n            isReady: false\n        };\n    }\n\n    // Restore local player in slot 0\n    party.slots[0] = {\n        playerId: 'local',\n        playerName: playerInfo.playerName || getPlayerName(),\n        inviteCode: playerInfo.inviteCode || getInviteCode(),\n        selectedCharacter: playerInfo.selectedCharacter || getSelectedCharacter(),\n        selectedPortrait: getSelectedPortrait() || 'default',\n        playerLevel: getPlayerLevel(),\n        isLocal: true,\n        peerId: null\n    };\n\n    // Re-initialize as host (will restart network)\n    initParty(party.kaplayInstance).catch(err => {\n        console.warn('[PartySystem] Failed to re-initialize as host:', err);\n    });\n}\n\n/**\n * Set up network message handlers for client\n */\nfunction setupClientHandlers() {\n    // Prevent duplicate handler registration (causes memory leaks and freezes)\n    if (partyClientHandlersRegistered) {\n        return;\n    }\n    partyClientHandlersRegistered = true;\n\n    // Receive party state from host\n    onMessage('party_sync', (payload) => {\n        console.log('[PartySystem] Received party sync:', {\n            hostName: payload.slots[0].playerName,\n            hostCharacter: payload.slots[0].selectedCharacter,\n            yourSlot: payload.yourSlotIndex,\n            totalSlots: payload.slots.filter(s => s.playerId !== null).length\n        });\n\n        // Update our party state\n        party.slots = payload.slots;\n\n        // Mark our own slot as local\n        if (payload.yourSlotIndex !== undefined) {\n            party.slots[payload.yourSlotIndex].isLocal = true;\n            console.log(`[PartySystem] Marked slot ${payload.yourSlotIndex} as local`);\n        }\n\n        // Mark host's slot (slot 0) as remote\n        party.slots[0].isLocal = false;\n\n        // Debug: log party size and host info after sync\n        const partySize = party.slots.filter(s => s.playerId !== null).length;\n        console.log(`[PartySystem] Party synced successfully:`, {\n            partySize,\n            hostInSlot0: party.slots[0].playerName,\n            localSlot: payload.yourSlotIndex\n        });\n    });\n\n    // Handle join rejection\n    onMessage('join_rejected', (payload) => {\n        console.error('Join rejected:', payload.reason);\n        alert(`Failed to join party: ${payload.reason}`);\n    });\n\n    // Handle game start from host\n    onMessage('game_start', (payload) => {\n        console.log('Host started game - joining...');\n        // Automatically join the game when host starts\n        if (party.kaplayInstance) {\n            party.kaplayInstance.go('game', { resetState: true });\n        } else {\n            console.error('Cannot join game: Kaplay instance not available');\n        }\n    });\n\n    // Handle countdown start from host\n    onMessage('countdown_start', (payload) => {\n        console.log('[PartySystem] Countdown started by host:', payload.duration);\n        party.countdownActive = true;\n        party.countdownStartTime = Date.now();\n        party.countdownDuration = payload.duration || 3000;\n    });\n\n    // Handle countdown cancel from host\n    onMessage('countdown_cancel', () => {\n        console.log('[PartySystem] Countdown cancelled by host');\n        party.countdownActive = false;\n        party.countdownStartTime = 0;\n    });\n\n    // Handle party update with ready states\n    onMessage('party_update', (payload) => {\n        // Find which slot is local before updating\n        const localSlotIndex = party.slots.findIndex(slot => slot.isLocal);\n\n        // Update slots (includes ready states)\n        party.slots = payload.slots;\n\n        // Re-mark local slot (preserve isLocal flag)\n        if (localSlotIndex !== -1) {\n            party.slots[localSlotIndex].isLocal = true;\n        }\n    });\n\n    // Handle party emotes from host\n    onMessage('party_emote', (payload) => {\n        handlePartyEmote(payload);\n    });\n\n    // Handle profile request (forwarded from host or direct from host)\n    onMessage('profile_request', (payload) => {\n        handleProfileRequest(payload);\n    });\n\n    // Handle profile response\n    onMessage('profile_response', (payload) => {\n        handleProfileResponse(payload);\n    });\n\n    // Handle host disconnect\n    onConnectionChange((event) => {\n        if (event === 'host_disconnect') {\n            console.log('[PartySystem] Host disconnected - returning to solo party');\n            alert('Host disconnected - returning to main menu');\n\n            // Restore local player to solo party state\n            const savedLocalPlayer = {\n                playerName: getPlayerName(),\n                inviteCode: getInviteCode(),\n                selectedCharacter: getSelectedCharacter()\n            };\n            restoreLocalPlayerToSoloParty(savedLocalPlayer);\n\n            // Return to main menu\n            if (party.kaplayInstance) {\n                party.kaplayInstance.go('menu');\n            }\n        }\n    });\n}\n\n/**\n * Broadcast party update to all clients (host only)\n */\nfunction broadcastPartyUpdate() {\n    if (!party.isHost) return;\n\n    broadcast('party_update', {\n        slots: party.slots.map(slot => ({\n            playerId: slot.playerId,\n            playerName: slot.playerName,\n            inviteCode: slot.inviteCode,\n            selectedCharacter: slot.selectedCharacter,\n            selectedPortrait: slot.selectedPortrait,\n            permanentUpgradeLevels: slot.permanentUpgradeLevels,\n            isLocal: false, // Always false for remote players\n            isReady: slot.isReady || false,\n            isDisconnected: slot.isDisconnected || false\n        }))\n    });\n}\n\n/**\n * Broadcast game start to all clients (host only)\n */\nexport function broadcastGameStart() {\n    if (!party.isHost) return;\n\n    console.log('Broadcasting game start to all clients');\n    broadcast('game_start', {});\n}\n\n/**\n * Handle player disconnect (host only)\n * Starts a reconnection window instead of immediately removing\n * @param {string} peerId - Peer ID of disconnected player\n */\nfunction handlePlayerDisconnect(peerId) {\n    const slotIndex = party.peerIdToSlot.get(peerId);\n    if (slotIndex !== undefined) {\n        console.log('[PartySystem] Player disconnected from slot', slotIndex, '- starting reconnection window');\n\n        // Store player data for potential reconnection\n        const playerData = { ...party.slots[slotIndex] };\n\n        // Mark player as disconnected (but don't remove yet)\n        party.disconnectedPlayers.set(slotIndex, {\n            disconnectTime: Date.now(),\n            playerData: playerData,\n            peerId: peerId\n        });\n\n        // Mark the slot as disconnected (but keep the player info)\n        party.slots[slotIndex].isDisconnected = true;\n\n        // Broadcast disconnect status to all clients\n        broadcast('player_disconnected', {\n            slotIndex: slotIndex,\n            reconnectWindow: party.reconnectWindow\n        });\n\n        party.peerIdToSlot.delete(peerId);\n\n        // Set timeout to fully remove player if they don't reconnect\n        setTimeout(() => {\n            finalizeDisconnect(slotIndex);\n        }, party.reconnectWindow);\n    }\n}\n\n/**\n * Finalize player disconnect after reconnection window expires\n * @param {number} slotIndex - Slot index of the disconnected player\n */\nfunction finalizeDisconnect(slotIndex) {\n    const disconnectData = party.disconnectedPlayers.get(slotIndex);\n    if (!disconnectData) return; // Player already reconnected or was removed\n\n    console.log('[PartySystem] Reconnection window expired for slot', slotIndex, '- removing player');\n\n    // Clean up player entity from the game\n    cleanupDisconnectedPlayer(slotIndex);\n\n    // Remove from party\n    removePlayerFromParty(slotIndex);\n    party.disconnectedPlayers.delete(slotIndex);\n\n    // Broadcast final removal\n    broadcast('player_removed', { slotIndex: slotIndex });\n    broadcastPartyUpdate();\n}\n\n/**\n * Attempt to reconnect a player to their previous slot\n * @param {string} peerId - New peer ID of reconnecting player\n * @param {string} playerName - Player name for verification\n * @returns {number|null} - Slot index if reconnected, null if not found\n */\nexport function attemptReconnect(peerId, playerName) {\n    // Check if there's a disconnected player with this name\n    for (const [slotIndex, data] of party.disconnectedPlayers) {\n        if (data.playerData.playerName === playerName) {\n            console.log('[PartySystem] Player', playerName, 'reconnected to slot', slotIndex);\n\n            // Restore player to their slot\n            party.slots[slotIndex] = { ...data.playerData };\n            party.slots[slotIndex].peerId = peerId;\n            party.slots[slotIndex].isDisconnected = false;\n            party.peerIdToSlot.set(peerId, slotIndex);\n\n            // Clear disconnect data\n            party.disconnectedPlayers.delete(slotIndex);\n\n            // Broadcast reconnection\n            broadcast('player_reconnected', { slotIndex: slotIndex });\n            broadcastPartyUpdate();\n\n            return slotIndex;\n        }\n    }\n    return null;\n}\n\n/**\n * Check if a player slot is disconnected\n * @param {number} slotIndex - Slot index to check\n * @returns {boolean} - True if player is disconnected\n */\nexport function isPlayerDisconnected(slotIndex) {\n    return party.slots[slotIndex]?.isDisconnected || false;\n}\n\n/**\n * Get time remaining for reconnection window\n * @param {number} slotIndex - Slot index to check\n * @returns {number} - Milliseconds remaining, 0 if not disconnected\n */\nexport function getReconnectTimeRemaining(slotIndex) {\n    const data = party.disconnectedPlayers.get(slotIndex);\n    if (!data) return 0;\n\n    const elapsed = Date.now() - data.disconnectTime;\n    return Math.max(0, party.reconnectWindow - elapsed);\n}\n\n/**\n * Remove player from party and shift remaining players up to fill the gap\n * @param {number} slotIndex - Slot to remove (1-3, can't remove slot 0)\n */\nfunction removePlayerFromPartyAndShift(slotIndex) {\n    if (slotIndex <= 0 || slotIndex >= party.slots.length) return;\n\n    console.log(`[PartySystem] Removing player from slot ${slotIndex} and shifting remaining players up`);\n\n    // Shift all players above this slot down by one\n    for (let i = slotIndex; i < party.slots.length - 1; i++) {\n        const nextSlot = party.slots[i + 1];\n\n        // Move next slot to current slot\n        party.slots[i] = { ...nextSlot };\n\n        // Update peer ID mapping if this slot has a peer\n        if (nextSlot.peerId) {\n            party.peerIdToSlot.set(nextSlot.peerId, i);\n        }\n    }\n\n    // Clear the last slot\n    party.slots[party.slots.length - 1] = {\n        playerId: null,\n        playerName: null,\n        inviteCode: null,\n        selectedCharacter: null,\n        selectedPortrait: null,\n        playerLevel: 1,\n        isLocal: false,\n        peerId: null,\n        isReady: false\n    };\n\n    console.log('[PartySystem] Slots after shift:', party.slots.map((s, i) => `${i}: ${s.playerName || 'empty'}`));\n}\n\n/**\n * Remove player from party\n * @param {number} slotIndex - Slot to clear (1-3, can't remove slot 0)\n * @returns {boolean} True if successful\n */\nexport function removePlayerFromParty(slotIndex) {\n    if (slotIndex > 0 && slotIndex < party.slots.length) {\n        // Remove from peer map if present\n        const peerId = party.slots[slotIndex].peerId;\n        if (peerId) {\n            party.peerIdToSlot.delete(peerId);\n        }\n\n        party.slots[slotIndex] = {\n            playerId: null,\n            playerName: null,\n            inviteCode: null,\n            selectedCharacter: null,\n            selectedPortrait: null,\n            playerLevel: 1,\n            isLocal: false,\n            peerId: null,\n            isReady: false\n        };\n        return true;\n    }\n    return false;\n}\n\n/**\n * Update local player name\n * @param {string} newName - New player name\n */\nexport function updateLocalPlayerName(newName) {\n    party.slots[0].playerName = newName;\n}\n\n/**\n * Clear all remote players (used when disconnecting)\n */\nexport function clearRemotePlayers() {\n    for (let i = 1; i < party.slots.length; i++) {\n        removePlayerFromParty(i);\n    }\n}\n\n/**\n * Get formatted party info for display\n * @returns {Array} Array of slot info for UI\n */\nexport function getPartyDisplayInfo() {\n    return party.slots.map((slot, index) => ({\n        slotNumber: index + 1,\n        isEmpty: slot.playerId === null,\n        playerName: slot.playerName || 'Empty Slot',\n        isLocal: slot.isLocal,\n        inviteCode: slot.inviteCode,\n        selectedCharacter: slot.selectedCharacter || 'survivor',\n        selectedPortrait: slot.selectedPortrait || 'default',\n        playerLevel: slot.playerLevel || 1,\n        isReady: slot.isReady || false,\n        isDisconnected: slot.isDisconnected || false\n    }));\n}\n\n/**\n * Check if multiplayer is available\n * @returns {boolean} True if multiplayer was successfully initialized\n */\nexport function isMultiplayerAvailable() {\n    return party.networkInitialized;\n}\n\n/**\n * Broadcast local player's character change to all party members\n * @param {string} characterKey - The new character key (e.g., 'scout', 'tank')\n */\nexport function broadcastCharacterChange(characterKey) {\n    // Update local slot\n    party.slots[0].selectedCharacter = characterKey;\n\n    if (!party.networkInitialized) {\n        return; // No network, no need to broadcast\n    }\n\n    if (party.isHost) {\n        // Host broadcasts to all clients\n        broadcastPartyUpdate();\n    } else {\n        // Client sends to host\n        sendToHost('character_change', {\n            selectedCharacter: characterKey\n        });\n    }\n}\n\n// ==========================================\n// Ready-up System\n// ==========================================\n\n/**\n * Toggle ready state for local player\n * @returns {boolean} - New ready state\n */\nexport function toggleReady() {\n    const localSlot = getLocalPlayerSlot();\n    if (localSlot === null) return false;\n\n    party.slots[localSlot].isReady = !party.slots[localSlot].isReady;\n\n    // Broadcast ready state change\n    if (party.networkInitialized) {\n        if (party.isHost) {\n            broadcastPartyUpdate();\n            // Check if all players are ready\n            checkAllReady();\n        } else {\n            sendToHost('ready_change', {\n                isReady: party.slots[localSlot].isReady\n            });\n        }\n    }\n\n    return party.slots[localSlot].isReady;\n}\n\n/**\n * Get local player slot index\n * @returns {number|null} - Local player slot index, or null if not found\n */\nexport function getLocalPlayerSlot() {\n    const index = party.slots.findIndex(s => s.isLocal);\n    return index >= 0 ? index : null;\n}\n\n/**\n * Check if local player is ready\n * @returns {boolean} - True if ready\n */\nexport function isLocalPlayerReady() {\n    const localSlot = getLocalPlayerSlot();\n    return localSlot !== null && party.slots[localSlot].isReady;\n}\n\n/**\n * Check if all players are ready (host only)\n * @returns {boolean} - True if all ready\n */\nexport function areAllPlayersReady() {\n    const occupiedSlots = party.slots.filter(s => s.playerId !== null);\n    if (occupiedSlots.length < 2) return false; // Need at least 2 players\n\n    return occupiedSlots.every(s => s.isReady);\n}\n\n/**\n * Check if all players are ready and start countdown (host only)\n */\nfunction checkAllReady() {\n    if (!party.isHost) return;\n\n    if (areAllPlayersReady() && !party.countdownActive) {\n        startCountdown();\n    } else if (!areAllPlayersReady() && party.countdownActive) {\n        cancelCountdown();\n    }\n}\n\n/**\n * Start the game countdown (host only)\n */\nfunction startCountdown() {\n    if (!party.isHost) return;\n\n    party.countdownActive = true;\n    party.countdownStartTime = Date.now();\n\n    // Broadcast countdown start\n    broadcast('countdown_start', {\n        duration: party.countdownDuration\n    });\n\n    console.log('[PartySystem] Countdown started');\n}\n\n/**\n * Cancel the game countdown (host only)\n */\nfunction cancelCountdown() {\n    if (!party.isHost) return;\n\n    party.countdownActive = false;\n    party.countdownStartTime = 0;\n\n    // Broadcast countdown cancel\n    broadcast('countdown_cancel', {});\n\n    console.log('[PartySystem] Countdown cancelled');\n}\n\n/**\n * Get countdown state\n * @returns {Object} - { active, timeRemaining }\n */\nexport function getCountdownState() {\n    if (!party.countdownActive) {\n        return { active: false, timeRemaining: 0 };\n    }\n\n    const elapsed = Date.now() - party.countdownStartTime;\n    const remaining = Math.max(0, party.countdownDuration - elapsed);\n\n    return {\n        active: true,\n        timeRemaining: remaining\n    };\n}\n\n/**\n * Reset all ready states (called after game ends)\n */\nexport function resetAllReadyStates() {\n    party.slots.forEach(slot => {\n        slot.isReady = false;\n    });\n    party.countdownActive = false;\n    party.countdownStartTime = 0;\n}\n\n// ==========================================\n// Party Emotes System\n// ==========================================\n\n/**\n * Handle incoming party emote (store and notify callbacks)\n * @param {Object} payload - { slotIndex, emoteType }\n */\nfunction handlePartyEmote(payload) {\n    const { slotIndex, emoteType } = payload;\n\n    // Store the emote with timestamp\n    party.activeEmotes.set(slotIndex, {\n        emoteType,\n        startTime: Date.now()\n    });\n\n    // Notify all registered callbacks\n    party.emoteCallbacks.forEach(callback => {\n        try {\n            callback(slotIndex, emoteType);\n        } catch (err) {\n            console.error('[PartySystem] Emote callback error:', err);\n        }\n    });\n}\n\n/**\n * Broadcast an emote from the local player\n * @param {string} emoteType - 'exclamation' or 'heart'\n */\nexport function broadcastPartyEmote(emoteType) {\n    const localSlot = getLocalPlayerSlot();\n    if (localSlot === null) return;\n\n    const payload = { slotIndex: localSlot, emoteType };\n\n    // Handle locally first\n    handlePartyEmote(payload);\n\n    // Send to network if available\n    if (party.networkInitialized) {\n        if (party.isHost) {\n            // Host broadcasts directly to all clients\n            broadcast('party_emote', payload);\n        } else {\n            // Client sends to host (who will rebroadcast)\n            sendToHost('party_emote', payload);\n        }\n    }\n}\n\n/**\n * Register a callback to be notified when emotes are received\n * @param {Function} callback - (slotIndex, emoteType) => void\n */\nexport function onPartyEmote(callback) {\n    party.emoteCallbacks.push(callback);\n}\n\n/**\n * Unregister an emote callback\n * @param {Function} callback - The callback to remove\n */\nexport function offPartyEmote(callback) {\n    const index = party.emoteCallbacks.indexOf(callback);\n    if (index !== -1) {\n        party.emoteCallbacks.splice(index, 1);\n    }\n}\n\n/**\n * Get active emote for a slot (if still valid)\n * @param {number} slotIndex - Slot to check\n * @param {number} maxAge - Max age in ms (default 2000ms)\n * @returns {string|null} - Emote type or null if no active emote\n */\nexport function getActiveEmote(slotIndex, maxAge = 2000) {\n    const emote = party.activeEmotes.get(slotIndex);\n    if (!emote) return null;\n\n    const age = Date.now() - emote.startTime;\n    if (age > maxAge) {\n        party.activeEmotes.delete(slotIndex);\n        return null;\n    }\n\n    return emote.emoteType;\n}\n\n/**\n * Clear all active emotes\n */\nexport function clearActiveEmotes() {\n    party.activeEmotes.clear();\n}\n\n/**\n * Clear all party callbacks to prevent memory leaks\n * Call this when cleaning up multiplayer session\n */\nexport function clearPartyCallbacks() {\n    party.emoteCallbacks = [];\n    party.activeEmotes.clear();\n    // Reset handler registration flags to allow re-registration on next session\n    partyHostHandlersRegistered = false;\n    partyClientHandlersRegistered = false;\n}\n\n// ==========================================\n// Profile Request System\n// ==========================================\n\n// Store pending profile request callbacks\nconst profileRequestCallbacks = new Map();\n\n/**\n * Get local player's profile data for sharing\n * @returns {Object} Profile data object\n */\nexport function getLocalProfileData() {\n    return {\n        playerName: getPlayerName(),\n        selectedPortrait: getSelectedPortrait(),\n        playerLevel: getPlayerLevel(),\n        totalXP: getTotalXP(),\n        stats: getSaveStats(),\n        achievements: getUnlockedAchievements(),\n        unlockedPortraits: getUnlockedPortraits()\n    };\n}\n\n/**\n * Request another player's profile data\n * @param {number} slotIndex - The slot index of the player to request\n * @param {Function} callback - Callback function (profileData) => void\n */\nexport function requestPlayerProfile(slotIndex, callback) {\n    const slot = party.slots[slotIndex];\n    if (!slot || slot.playerId === null) {\n        console.warn('[PartySystem] Cannot request profile for empty slot:', slotIndex);\n        callback(null);\n        return;\n    }\n\n    // If requesting our own profile, return local data\n    if (slot.isLocal) {\n        callback(getLocalProfileData());\n        return;\n    }\n\n    // Store the callback\n    profileRequestCallbacks.set(slotIndex, callback);\n\n    // Send the request\n    if (party.isHost) {\n        // Host sends directly to the peer\n        const peerId = slot.peerId;\n        if (peerId) {\n            sendToPeer(peerId, 'profile_request', { requestingSlot: getLocalPlayerSlot() });\n        } else {\n            console.warn('[PartySystem] No peerId for slot:', slotIndex);\n            callback(null);\n            profileRequestCallbacks.delete(slotIndex);\n        }\n    } else {\n        // Client sends request through host\n        sendToHost('profile_request', { targetSlot: slotIndex });\n    }\n\n    // Timeout after 5 seconds\n    setTimeout(() => {\n        if (profileRequestCallbacks.has(slotIndex)) {\n            console.warn('[PartySystem] Profile request timed out for slot:', slotIndex);\n            const cb = profileRequestCallbacks.get(slotIndex);\n            profileRequestCallbacks.delete(slotIndex);\n            cb(null);\n        }\n    }, 5000);\n}\n\n/**\n * Handle incoming profile request (called by message handlers)\n * @param {Object} payload - Request payload\n * @param {string} fromPeerId - Peer ID of requester (for host)\n */\nfunction handleProfileRequest(payload, fromPeerId = null) {\n    const profileData = getLocalProfileData();\n\n    if (party.isHost && fromPeerId) {\n        // Host responding to client request\n        sendToPeer(fromPeerId, 'profile_response', {\n            slotIndex: getLocalPlayerSlot(),\n            profileData\n        });\n    } else {\n        // Client responding to host\n        sendToHost('profile_response', {\n            slotIndex: getLocalPlayerSlot(),\n            profileData\n        });\n    }\n}\n\n/**\n * Handle incoming profile response\n * @param {Object} payload - Response payload with slotIndex and profileData\n */\nfunction handleProfileResponse(payload) {\n    const { slotIndex, profileData } = payload;\n\n    const callback = profileRequestCallbacks.get(slotIndex);\n    if (callback) {\n        profileRequestCallbacks.delete(slotIndex);\n        callback(profileData);\n    }\n}\n","/**\n * Boss Type Definitions\n *\n * All boss types and their properties.\n * Bosses have armor/shield systems and higher stats than regular enemies.\n */\n\nexport const BOSS_TYPES = {\n    gatekeeper: {\n        name: 'Studio Head',\n        coreChar: 'GG',\n        armorChar: '[]',\n        shieldChar: '{}',\n        color: [255, 50, 50], // Red\n        armorColor: [200, 200, 200], // Gray/white for armor\n        shieldColor: [100, 200, 255], // Light blue for shields\n        baseHealth: 500,\n        baseArmorHealth: 125, // 100-150 range, using middle\n        baseShieldHealth: 0, // No shields by default\n        baseSpeed: 70, // 60-80 range, using middle\n        size: 28,\n        baseXPValue: 125, // 100-150 range\n        damageReduction: 0.3, // 30% damage reduction when armor is active\n        shieldRegenRate: 0, // HP per second (0 = no regen)\n    },\n    swarmQueen: {\n        name: 'Showrunner',\n        coreChar: 'QQ',\n        armorChar: '[]',\n        shieldChar: '{}',\n        color: [200, 100, 255], // Purple\n        armorColor: [200, 200, 200],\n        shieldColor: [100, 200, 255], // Light blue for shields\n        baseHealth: 800,\n        baseArmorHealth: 175, // 150-200 range\n        baseShieldHealth: 0, // No shields by default\n        baseSpeed: 50, // 40-60 range\n        size: 28,\n        baseXPValue: 250, // 200-300 range\n        damageReduction: 0.35, // 35% damage reduction\n        shieldRegenRate: 0, // HP per second (0 = no regen)\n    },\n    twinGuardianMelee: {\n        name: 'Co-Host (Melee)',\n        coreChar: '',\n        armorChar: '[]',\n        shieldChar: '{}',\n        color: [255, 50, 50], // Red\n        armorColor: [200, 200, 200],\n        shieldColor: [100, 200, 255], // Light blue for shields\n        baseHealth: 600,\n        baseArmorHealth: 125,\n        baseShieldHealth: 0, // No shields by default\n        baseSpeed: 110, // Faster, aggressive\n        size: 28,\n        baseXPValue: 175, // Half of total (350/2)\n        damageReduction: 0.3,\n        meleeDamage: 22, // 20-25 range, using middle\n        shieldRegenRate: 0, // HP per second (0 = no regen)\n    },\n    twinGuardianRanged: {\n        name: 'Co-Host (Ranged)',\n        coreChar: '',\n        armorChar: '[]',\n        shieldChar: '{}',\n        color: [100, 150, 255], // Blue\n        armorColor: [200, 200, 200],\n        shieldColor: [100, 200, 255], // Light blue for shields\n        baseHealth: 600,\n        baseArmorHealth: 125,\n        baseShieldHealth: 0, // No shields by default\n        baseSpeed: 70, // 60-80 range, slower, maintains distance\n        size: 28,\n        baseXPValue: 175, // Half of total (350/2)\n        damageReduction: 0.3,\n        projectileDamage: 13, // 12-15 range, using middle\n        projectileSpeed: 250,\n        fireRate: 1.0, // Shots per second\n        shieldRegenRate: 0, // HP per second (0 = no regen)\n    }\n};\n\n/**\n * Get boss definition by type key\n * @param {string} type - Boss type key\n * @returns {object} Boss configuration\n */\nexport function getBossDefinition(type) {\n    return BOSS_TYPES[type] || BOSS_TYPES.gatekeeper;\n}\n\n/**\n * Get all boss types\n * @returns {Array<string>} Array of boss type keys\n */\nexport function getAllBossTypes() {\n    return Object.keys(BOSS_TYPES);\n}\n","/**\n * Boss Entity\n *\n * Creates and manages boss entities with advanced mechanics:\n * - Multi-layered defense system (shields, armor, health)\n * - Shield regeneration mechanics\n * - Visual state updates based on defense layers\n * - Unique boss types: Gatekeeper, Swarm Queen, Twin Guardians\n * - Spawning mechanics and minion control\n * - Floor-based stat scaling\n */\n\n// Entity imports\nimport { createEnemy } from './enemy.js';\nimport { createProjectile } from './projectile.js';\n\n// Data imports\nimport { getBossDefinition } from '../data/bosses.js';\n\n// Multiplayer imports\nimport { isMultiplayerActive, isHost, registerEnemy, broadcastDeathEvent, broadcastBossEnrage } from '../systems/multiplayerGame.js';\n\nexport function createBoss(k, x, y, type = 'gatekeeper', floor = 1, rng = null) {\n    const baseConfig = getBossDefinition(type);\n    \n    // Scale stats based on floor\n    const floorMultiplier = 1 + (floor - 1) * 0.2; // 20% increase per floor\n    const config = {\n        coreChar: baseConfig.coreChar,\n        armorChar: baseConfig.armorChar || '()',\n        shieldChar: baseConfig.shieldChar || '{}',\n        color: baseConfig.color,\n        armorColor: baseConfig.armorColor || [200, 200, 200],\n        shieldColor: baseConfig.shieldColor || [100, 200, 255],\n        health: Math.floor(baseConfig.baseHealth * floorMultiplier),\n        armorHealth: Math.floor((baseConfig.baseArmorHealth || 0) * floorMultiplier),\n        maxArmorHealth: Math.floor((baseConfig.baseArmorHealth || 0) * floorMultiplier),\n        shieldHealth: Math.floor((baseConfig.baseShieldHealth || 0) * floorMultiplier),\n        maxShieldHealth: Math.floor((baseConfig.baseShieldHealth || 0) * floorMultiplier),\n        speed: Math.floor(baseConfig.baseSpeed * (1 + (floor - 1) * 0.05)),\n        size: baseConfig.size,\n        xpValue: Math.floor(baseConfig.baseXPValue * floorMultiplier),\n        damageReduction: baseConfig.damageReduction || 0,\n        shieldRegenRate: (baseConfig.shieldRegenRate || 0) * floorMultiplier // Scale regen with floor\n    };\n    \n    // Build the visual representation based on armor state\n    function getBossVisual() {\n        const leftArmor = config.armorHealth > config.maxArmorHealth * 0.5 ? '(' : '';\n        const rightArmor = config.armorHealth > 0 ? ')' : '';\n        return `${leftArmor}${config.coreChar}${rightArmor}`;\n    }\n    \n    // Create boss entity with dynamic text\n    const boss = k.add([\n        k.text(getBossVisual(), { size: config.size }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...config.color),\n        k.area(),\n        k.health(config.health),\n        'boss'\n    ]);\n\n    boss.maxHealth = config.health;\n    boss.speed = config.speed;\n    boss.xpValue = config.xpValue;\n    boss.type = type;\n    boss.floor = floor;\n    boss.textSize = config.size; // Store text size for later use\n    boss.rng = rng; // Store seeded RNG for multiplayer synchronization\n    \n    // Store boss-specific stats\n    if (baseConfig.meleeDamage) boss.meleeDamage = baseConfig.meleeDamage;\n    if (baseConfig.projectileDamage) boss.projectileDamage = baseConfig.projectileDamage;\n    if (baseConfig.projectileSpeed) boss.projectileSpeed = baseConfig.projectileSpeed;\n    if (baseConfig.fireRate) boss.fireRate = baseConfig.fireRate;\n    \n    // Initialize enraged state for Twin Guardians\n    if (type === 'twinGuardianMelee' || type === 'twinGuardianRanged') {\n        boss.enraged = false;\n        boss.enrage = function() {\n            if (this.enraged) return;\n            this.enraged = true;\n            this.speed = Math.floor(this.speed * 1.5);\n            if (this.type === 'twinGuardianMelee') {\n                this.chargeCooldownTimer = 0;\n                this.meleeDamage = Math.floor(this.meleeDamage * 1.25);\n            } else { // Ranged\n                this.fireRate = this.fireRate * 1.5;\n                this.projectileDamage = Math.floor(this.projectileDamage * 1.25);\n            }\n            this.color = k.rgb(255, 200, 0);\n        }\n    }\n    \n    // Armor properties\n    boss.armorHealth = config.armorHealth;\n    boss.maxArmorHealth = config.maxArmorHealth;\n    boss.damageReduction = config.damageReduction;\n    boss.coreChar = config.coreChar;\n    boss.armorChar = config.armorChar;\n    boss.armorColor = config.armorColor;\n    \n    // Shield properties\n    boss.shieldHealth = config.shieldHealth;\n    boss.maxShieldHealth = config.maxShieldHealth;\n    boss.shieldRegenRate = config.shieldRegenRate;\n    boss.shieldChar = config.shieldChar;\n    boss.shieldColor = config.shieldColor;\n    boss.shieldRegenTimer = 0; // Timer for shield regeneration\n    boss.shieldRegenCooldown = 0; // Cooldown after taking damage (prevents regen)\n    boss.lastDamageTime = 0; // Track when last damaged\n    \n    // Function to update visual representation\n    boss.updateVisual = function() {\n        // Priority: Shields > Armor > Core\n        // Shields: {GG}\n        // Armor: [GG]\n        // Core: GG\n        \n        let leftShield = '';\n        let rightShield = '';\n        let leftArmor = '';\n        let rightArmor = '';\n        \n        // Shields take priority (outermost layer)\n        // Size scales with health: Full =  , Medium =  , Low =  \n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\n        if (boss.shieldHealth > 0) {\n            const shieldPercent = boss.shieldHealth / boss.maxShieldHealth;\n            \n            if (shieldPercent > 0.66) {\n                // Full shield (66-100%): Double brackets   (mathematical double brackets)\n                leftShield = '';\n                rightShield = '';\n            } else if (shieldPercent > 0.33) {\n                // Medium shield (33-66%): Left/right white parenthesis  \n                leftShield = '';\n                rightShield = '';\n            } else {\n                // Low shield (0-33%): Left/right angle brackets  \n                leftShield = '';\n                rightShield = '';\n            }\n        }\n        \n        // Armor (middle layer, can appear with shields: {[GG]})\n        // Size scales with health: Full =  , Medium =  , Low =  \n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\n        if (boss.armorHealth > 0) {\n            const armorPercent = boss.armorHealth / boss.maxArmorHealth;\n            \n            if (armorPercent > 0.66) {\n                // Full armor (66-100%): Double brackets   (mathematical double brackets)\n                leftArmor = '';\n                rightArmor = '';\n            } else if (armorPercent > 0.33) {\n                // Medium armor (33-66%): Left/right angle brackets  \n                leftArmor = '';\n                rightArmor = '';\n            } else {\n                // Low armor (0-33%): Left/right double angle brackets  \n                leftArmor = '';\n                rightArmor = '';\n            }\n        }\n        \n        // Visual format: {[GG]} (shields outside, armor inside)\n        const visual = `${leftShield}${leftArmor}${boss.coreChar}${rightArmor}${rightShield}`;\n        \n        // Update text directly (same approach as enemy and miniboss)\n        boss.text = visual;\n        \n        // Update color - use shield color if shields exist, otherwise boss color\n        if (boss.shieldHealth > 0) {\n            boss.color = k.rgb(...config.shieldColor);\n        } else {\n            boss.color = k.rgb(...config.color);\n        }\n    };\n    \n    // Function to take damage (handles shields, then armor, then health)\n    boss.takeDamage = function(damage) {\n        let shieldChanged = false;\n        let armorChanged = false;\n        const previousShieldHealth = boss.shieldHealth;\n        const previousArmorHealth = boss.armorHealth;\n        \n        // Track damage time for shield regen cooldown\n        boss.lastDamageTime = k.time();\n        const shieldRegenCooldownDuration = 3.0; // 3 seconds cooldown after taking damage\n        boss.shieldRegenCooldown = shieldRegenCooldownDuration;\n        \n        // Priority: Shields > Armor > Health\n        // Shields take normal damage (no reduction)\n        if (boss.shieldHealth > 0) {\n            const shieldDamage = Math.min(damage, boss.shieldHealth);\n            boss.shieldHealth = Math.max(0, boss.shieldHealth - shieldDamage);\n            shieldChanged = (boss.shieldHealth !== previousShieldHealth);\n            \n            // Remaining damage goes to armor/health\n            const remainingDamage = damage - shieldDamage;\n            if (remainingDamage > 0) {\n                boss.takeDamageInternal(remainingDamage);\n            }\n        } else {\n            // No shields - damage goes to armor/health\n            boss.takeDamageInternal(damage);\n        }\n        \n        armorChanged = (boss.armorHealth !== previousArmorHealth);\n        \n        // Update visual when shields or armor change\n        if (shieldChanged || armorChanged) {\n            boss.updateVisual();\n        }\n    };\n    \n    // Internal damage function (handles armor and health)\n    boss.takeDamageInternal = function(damage) {\n        // If armor exists, armor takes reduced damage first\n        if (boss.armorHealth > 0) {\n            // Apply damage reduction to armor damage\n            const reducedDamage = Math.floor(damage * (1 - boss.damageReduction));\n            const armorDamage = Math.min(reducedDamage, boss.armorHealth);\n            boss.armorHealth = Math.max(0, boss.armorHealth - armorDamage);\n            \n            // Remaining damage goes to boss, but reduced if armor still exists\n            const remainingDamage = damage - reducedDamage;\n            if (remainingDamage > 0) {\n                // If armor still exists, apply damage reduction\n                // If armor is destroyed, remaining damage goes through at full\n                const damageMultiplier = boss.armorHealth > 0 ? (1 - boss.damageReduction) : 1;\n                const finalDamage = Math.floor(remainingDamage * damageMultiplier);\n                boss.hurt(finalDamage);\n            }\n        } else {\n            // No armor - full damage\n            boss.hurt(damage);\n        }\n    };\n    \n    // Boss-specific mechanics initialization\n    boss.attackTimer = 0;\n    boss.minionSpawnTimer = 0;\n    boss.chargeCooldownTimer = 0; // Time until next charge can start\n    boss.chargeDurationTimer = 0; // Time spent charging\n    boss.radialBurstTimer = 0;\n    boss.isCharging = false;\n    boss.chargeDirection = null;\n    boss.chargeSpeed = 0;\n    boss.spawnedMinions = []; // Track minions for cleanup\n    boss.enraged = false; // For twin guardians enrage system\n    boss.twinPartner = null; // Reference to other guardian (for enrage system)\n    \n    // Get current phase based on health\n    boss.getPhase = function() {\n        const healthPercent = boss.hp() / boss.maxHealth;\n        if (healthPercent > 0.75) return 1;\n        if (healthPercent > 0.5) return 2;\n        return 3; // Enraged\n    };\n    \n    // Spawn minions function\n    boss.spawnMinions = function() {\n        if (!boss.exists()) return;\n\n        const phase = boss.getPhase();\n        const minionCount = phase === 1 ? 2 : phase === 2 ? 3 : 3; // 2-3 minions\n\n        for (let i = 0; i < minionCount; i++) {\n            // Spawn minions around boss in a circle\n            // Use seeded RNG if available (multiplayer), otherwise Math.random()\n            const angleVariation = boss.rng ? boss.rng.next() * 0.5 : Math.random() * 0.5;\n            const angle = (Math.PI * 2 / minionCount) * i + angleVariation;\n\n            const distanceVariation = boss.rng ? boss.rng.next() * 20 : Math.random() * 20;\n            const spawnDistance = 40 + distanceVariation;\n\n            const spawnX = boss.pos.x + Math.cos(angle) * spawnDistance;\n            const spawnY = boss.pos.y + Math.sin(angle) * spawnDistance;\n\n            // Randomly choose rusher or basic (as proxy for shooter)\n            const minionTypeRoll = boss.rng ? boss.rng.next() : Math.random();\n            const minionType = minionTypeRoll < 0.5 ? 'rusher' : 'basic';\n            const minion = createEnemy(k, spawnX, spawnY, minionType, floor);\n            minion.isBossMinion = true; // Mark as boss minion\n            boss.spawnedMinions.push(minion);\n\n            // Register minion for multiplayer sync\n            if (isMultiplayerActive() && isHost()) {\n                registerEnemy(minion, { type: minionType, floor: floor, isBossMinion: true });\n            }\n        }\n    };\n    \n    // Radial burst attack (8 directions)\n    boss.radialBurst = function() {\n        if (!boss.exists()) return;\n        \n        const directions = [\n            k.vec2(0, -1),   // N\n            k.vec2(0.707, -0.707), // NE\n            k.vec2(1, 0),    // E\n            k.vec2(0.707, 0.707),  // SE\n            k.vec2(0, 1),    // S\n            k.vec2(-0.707, 0.707), // SW\n            k.vec2(-1, 0),   // W\n            k.vec2(-0.707, -0.707) // NW\n        ];\n        \n        const phase = boss.getPhase();\n        const projectileSpeed = 200;\n        const projectileDamage = 12;\n        \n        directions.forEach(dir => {\n            const projectile = createProjectile(k, boss.pos.x, boss.pos.y, dir, projectileSpeed, projectileDamage, 0, 0, false);\n            projectile.isBossProjectile = true; // Mark as boss projectile\n            projectile.color = k.rgb(255, 100, 100); // Red color for boss projectiles\n        });\n    };\n    \n    // Charge attack\n    boss.startCharge = function(targetPos) {\n        if (!boss.exists()) return;\n        \n        boss.isCharging = true;\n        const dir = k.vec2(targetPos.x - boss.pos.x, targetPos.y - boss.pos.y);\n        if (dir.len() > 0) {\n            boss.chargeDirection = dir.unit();\n            // Charge speed is set before calling startCharge, or use default based on phase\n            if (!boss.chargeSpeed || boss.chargeSpeed === 0) {\n                const phase = boss.getPhase ? boss.getPhase() : 1;\n                boss.chargeSpeed = boss.speed * (phase === 1 ? 2.5 : phase === 2 ? 3.0 : 3.5); // Faster in later phases\n            }\n        }\n    };\n    \n    // AI based on boss type\n    boss.onUpdate(() => {\n        if (k.paused) return;\n        \n        // Shield regeneration (if shields exist and regen rate > 0)\n        // Only regen if cooldown has expired (not damaged recently) and boss is alive\n        if (boss.shieldRegenRate > 0 && boss.shieldHealth < boss.maxShieldHealth && boss.hp() > 0 && !boss.isDead) {\n            // Update cooldown timer\n            if (boss.shieldRegenCooldown > 0) {\n                boss.shieldRegenCooldown -= k.dt();\n            }\n            \n            // Only regenerate if cooldown has expired\n            if (boss.shieldRegenCooldown <= 0) {\n                boss.shieldRegenTimer += k.dt();\n                const regenInterval = 1.0; // Regenerate every second\n                \n                if (boss.shieldRegenTimer >= regenInterval) {\n                    const regenAmount = boss.shieldRegenRate * regenInterval;\n                    boss.shieldHealth = Math.min(boss.maxShieldHealth, boss.shieldHealth + regenAmount);\n                    boss.shieldRegenTimer = 0;\n                    \n                    // Update visual if shield regenerated\n                    if (boss.shieldHealth > 0) {\n                        boss.updateVisual();\n                    }\n                }\n            }\n        }\n\n        // Process burn DoT (Damage over Time) from flamethrower\n        if (boss.burnDuration > 0 && boss.hp() > 0 && !boss.isDead) {\n            boss.burnTimer = (boss.burnTimer || 0) + k.dt();\n            const burnTickInterval = 0.5; // Deal burn damage every 0.5 seconds\n\n            if (boss.burnTimer >= burnTickInterval) {\n                // In multiplayer, only host deals burn damage\n                if (!isMultiplayerActive() || isHost()) {\n                    // Deal burn damage\n                    if (boss.takeDamage) {\n                        boss.takeDamage(boss.burnDamage);\n                    } else {\n                        boss.hurt(boss.burnDamage);\n                    }\n                }\n\n                // Visual feedback for burn damage (orange tint) on all clients\n                const originalColor = boss.color;\n                boss.color = k.rgb(255, 150, 50);\n                k.wait(0.1, () => {\n                    if (boss.exists()) {\n                        boss.updateVisual();\n                    }\n                });\n\n                boss.burnTimer = 0;\n            }\n\n            // Decrease burn duration\n            boss.burnDuration -= k.dt();\n            if (boss.burnDuration <= 0) {\n                boss.burnDamage = 0;\n                boss.burnTimer = 0;\n            }\n        }\n\n        const player = k.get('player')[0];\n        if (!player || !player.exists()) return;\n        \n        const phase = boss.getPhase();\n        \n        // Gatekeeper-specific mechanics\n        if (boss.type === 'gatekeeper') {\n            boss.attackTimer += k.dt();\n            boss.minionSpawnTimer += k.dt();\n            boss.radialBurstTimer += k.dt();\n            \n            // Phase-based timing\n            const minionSpawnInterval = phase === 1 ? 8 : phase === 2 ? 6 : 5; // 8s  6s  5s\n            const chargeCooldown = 10; // 10 seconds between charges\n            const radialBurstInterval = phase === 1 ? 8 : phase === 2 ? 6 : 5; // 8s  6s  5s\n            \n            // Handle charge attack\n            if (boss.isCharging) {\n                const chargeMove = boss.chargeDirection.scale(boss.chargeSpeed * k.dt());\n                boss.pos.x += chargeMove.x;\n                boss.pos.y += chargeMove.y;\n                \n                // Track charge duration\n                boss.chargeDurationTimer += k.dt();\n                const chargeDuration = 1.0;\n                if (boss.chargeDurationTimer >= chargeDuration) {\n                    boss.isCharging = false;\n                    boss.chargeDurationTimer = 0;\n                    boss.chargeCooldownTimer = 0; // Reset cooldown after charge ends\n                }\n            } else {\n                // Increment charge cooldown timer when not charging\n                boss.chargeCooldownTimer += k.dt();\n                // Normal movement (slower when not charging)\n                const dir = k.vec2(\n                    player.pos.x - boss.pos.x,\n                    player.pos.y - boss.pos.y\n                );\n                const distance = dir.len();\n                \n                if (distance > 0) {\n                    const normalized = dir.unit();\n                    // Movement speed scales with phase\n                    const moveSpeed = boss.speed * (phase === 1 ? 1.0 : phase === 2 ? 1.2 : 1.5);\n                    const moveAmount = normalized.scale(moveSpeed * k.dt());\n                    \n                    // Check collision with obstacles\n                    const newX = boss.pos.x + moveAmount.x;\n                    const newY = boss.pos.y + moveAmount.y;\n                    \n                    let canMoveX = true;\n                    let canMoveY = true;\n                    \n                    const obstacles = k.get('obstacle');\n                    const bossSize = boss.size || 14;\n                    \n                    for (const obstacle of obstacles) {\n                        if (!obstacle.exists()) continue;\n                        \n                        const obsLeft = obstacle.pos.x - obstacle.width / 2;\n                        const obsRight = obstacle.pos.x + obstacle.width / 2;\n                        const obsTop = obstacle.pos.y - obstacle.height / 2;\n                        const obsBottom = obstacle.pos.y + obstacle.height / 2;\n                        \n                        // Check X movement\n                        const bossLeftX = newX - bossSize;\n                        const bossRightX = newX + bossSize;\n                        const bossTopX = boss.pos.y - bossSize;\n                        const bossBottomX = boss.pos.y + bossSize;\n                        \n                        if (bossRightX > obsLeft && bossLeftX < obsRight &&\n                            bossBottomX > obsTop && bossTopX < obsBottom) {\n                            canMoveX = false;\n                            if (boss.isCharging) {\n                                boss.isCharging = false;\n                                boss.chargeTimer = 0;\n                            }\n                        }\n                        \n                        // Check Y movement\n                        const bossLeftY = boss.pos.x - bossSize;\n                        const bossRightY = boss.pos.x + bossSize;\n                        const bossTopY = newY - bossSize;\n                        const bossBottomY = newY + bossSize;\n                        \n                        if (bossRightY > obsLeft && bossLeftY < obsRight &&\n                            bossBottomY > obsTop && bossTopY < obsBottom) {\n                            canMoveY = false;\n                            if (boss.isCharging) {\n                                boss.isCharging = false;\n                                boss.chargeTimer = 0;\n                            }\n                        }\n                    }\n                    \n                    // Apply movement if no collision\n                    if (canMoveX) boss.pos.x = newX;\n                    if (canMoveY) boss.pos.y = newY;\n                }\n                \n                // Spawn minions\n                if (boss.minionSpawnTimer >= minionSpawnInterval) {\n                    boss.spawnMinions();\n                    boss.minionSpawnTimer = 0;\n                }\n                \n                // Charge attack\n                if (boss.chargeCooldownTimer >= chargeCooldown) {\n                    // Brief telegraph (flash color)\n                    boss.color = k.rgb(255, 255, 0);\n                    k.wait(0.3, () => {\n                        if (boss.exists()) {\n                            boss.color = k.rgb(...config.color);\n                            boss.startCharge(player.pos);\n                        }\n                    });\n                    boss.chargeCooldownTimer = 0;\n                }\n                \n                // Radial burst\n                if (boss.radialBurstTimer >= radialBurstInterval) {\n                    boss.radialBurst();\n                    boss.radialBurstTimer = 0;\n                }\n            }\n        } else if (boss.type === 'twinGuardianMelee') {\n            // Melee Guardian AI: Charge player, melee attacks\n            boss.attackTimer += k.dt();\n            boss.chargeCooldownTimer += k.dt();\n            \n            const chargeCooldown = 8; // 8 seconds between charges\n            const chargeDistance = 150; // Distance to start charge\n            \n            const dir = k.vec2(\n                player.pos.x - boss.pos.x,\n                player.pos.y - boss.pos.y\n            );\n            const distance = dir.len();\n            \n            // Handle charge attack\n            if (boss.isCharging) {\n                const chargeMove = boss.chargeDirection.scale(boss.chargeSpeed * k.dt());\n                boss.pos.x += chargeMove.x;\n                boss.pos.y += chargeMove.y;\n                \n                boss.chargeDurationTimer += k.dt();\n                const chargeDuration = 1.2;\n                if (boss.chargeDurationTimer >= chargeDuration) {\n                    boss.isCharging = false;\n                    boss.chargeDurationTimer = 0;\n                    boss.chargeCooldownTimer = 0;\n                }\n            } else {\n                // Normal movement - charge at player\n                if (distance > 0) {\n                    const normalized = dir.unit();\n                    const moveSpeed = boss.speed * (boss.enraged ? 1.5 : 1.0);\n                    const moveAmount = normalized.scale(moveSpeed * k.dt());\n                    \n                    // Check collision with obstacles\n                    const newX = boss.pos.x + moveAmount.x;\n                    const newY = boss.pos.y + moveAmount.y;\n                    \n                    let canMoveX = true;\n                    let canMoveY = true;\n                    \n                    const obstacles = k.get('obstacle');\n                    const bossSize = boss.size || 14;\n                    \n                    for (const obstacle of obstacles) {\n                        if (!obstacle.exists()) continue;\n                        \n                        const obsLeft = obstacle.pos.x - obstacle.width / 2;\n                        const obsRight = obstacle.pos.x + obstacle.width / 2;\n                        const obsTop = obstacle.pos.y - obstacle.height / 2;\n                        const obsBottom = obstacle.pos.y + obstacle.height / 2;\n                        \n                        const bossLeftX = newX - bossSize;\n                        const bossRightX = newX + bossSize;\n                        const bossTopX = boss.pos.y - bossSize;\n                        const bossBottomX = boss.pos.y + bossSize;\n                        \n                        if (bossRightX > obsLeft && bossLeftX < obsRight &&\n                            bossBottomX > obsTop && bossTopX < obsBottom) {\n                            canMoveX = false;\n                        }\n                        \n                        const bossLeftY = boss.pos.x - bossSize;\n                        const bossRightY = boss.pos.x + bossSize;\n                        const bossTopY = newY - bossSize;\n                        const bossBottomY = newY + bossSize;\n                        \n                        if (bossRightY > obsLeft && bossLeftY < obsRight &&\n                            bossBottomY > obsTop && bossTopY < obsBottom) {\n                            canMoveY = false;\n                        }\n                    }\n                    \n                    if (canMoveX) boss.pos.x = newX;\n                    if (canMoveY) boss.pos.y = newY;\n                }\n                \n                // Charge attack when close enough\n                if (boss.chargeCooldownTimer >= chargeCooldown && distance < chargeDistance) {\n                    boss.color = k.rgb(255, 255, 0); // Yellow telegraph\n                    k.wait(0.3, () => {\n                        if (boss.exists()) {\n                            boss.color = k.rgb(...config.color);\n                            // Set charge speed based on enrage\n                            const chargeSpeedMultiplier = boss.enraged ? 3.5 : 2.5;\n                            boss.chargeSpeed = boss.speed * chargeSpeedMultiplier;\n                            boss.startCharge(player.pos);\n                        }\n                    });\n                    boss.chargeCooldownTimer = 0;\n                }\n            }\n        } else if (boss.type === 'twinGuardianRanged') {\n            // Ranged Guardian AI: Maintain distance, fire projectiles\n            boss.attackTimer += k.dt();\n            \n            const preferredDistance = 200; // Maintain this distance from player\n            const dir = k.vec2(\n                player.pos.x - boss.pos.x,\n                player.pos.y - boss.pos.y\n            );\n            const distance = dir.len();\n            \n            // Movement: maintain distance from player\n            if (distance > 0) {\n                const normalized = dir.unit();\n                let moveSpeed = boss.speed * (boss.enraged ? 1.5 : 1.0);\n                \n                // Move away if too close, move closer if too far\n                if (distance < preferredDistance) {\n                    // Move away from player\n                    const moveAmount = normalized.scale(-moveSpeed * k.dt());\n                    const newX = boss.pos.x + moveAmount.x;\n                    const newY = boss.pos.y + moveAmount.y;\n                    \n                    // Check collision with obstacles\n                    let canMoveX = true;\n                    let canMoveY = true;\n                    const obstacles = k.get('obstacle');\n                    const bossSize = boss.size || 14;\n                    \n                    for (const obstacle of obstacles) {\n                        if (!obstacle.exists()) continue;\n                        \n                        const obsLeft = obstacle.pos.x - obstacle.width / 2;\n                        const obsRight = obstacle.pos.x + obstacle.width / 2;\n                        const obsTop = obstacle.pos.y - obstacle.height / 2;\n                        const obsBottom = obstacle.pos.y + obstacle.height / 2;\n                        \n                        const bossLeftX = newX - bossSize;\n                        const bossRightX = newX + bossSize;\n                        const bossTopX = boss.pos.y - bossSize;\n                        const bossBottomX = boss.pos.y + bossSize;\n                        \n                        if (bossRightX > obsLeft && bossLeftX < obsRight &&\n                            bossBottomX > obsTop && bossTopX < obsBottom) {\n                            canMoveX = false;\n                        }\n                        \n                        const bossLeftY = boss.pos.x - bossSize;\n                        const bossRightY = boss.pos.x + bossSize;\n                        const bossTopY = newY - bossSize;\n                        const bossBottomY = newY + bossSize;\n                        \n                        if (bossRightY > obsLeft && bossLeftY < obsRight &&\n                            bossBottomY > obsTop && bossTopY < obsBottom) {\n                            canMoveY = false;\n                        }\n                    }\n                    \n                    if (canMoveX) boss.pos.x = newX;\n                    if (canMoveY) boss.pos.y = newY;\n                } else if (distance > preferredDistance * 1.5) {\n                    // Move closer if too far\n                    const moveAmount = normalized.scale(moveSpeed * k.dt());\n                    const newX = boss.pos.x + moveAmount.x;\n                    const newY = boss.pos.y + moveAmount.y;\n                    \n                    // Check collision (same as above)\n                    let canMoveX = true;\n                    let canMoveY = true;\n                    const obstacles = k.get('obstacle');\n                    const bossSize = boss.size || 14;\n                    \n                    for (const obstacle of obstacles) {\n                        if (!obstacle.exists()) continue;\n                        \n                        const obsLeft = obstacle.pos.x - obstacle.width / 2;\n                        const obsRight = obstacle.pos.x + obstacle.width / 2;\n                        const obsTop = obstacle.pos.y - obstacle.height / 2;\n                        const obsBottom = obstacle.pos.y + obstacle.height / 2;\n                        \n                        const bossLeftX = newX - bossSize;\n                        const bossRightX = newX + bossSize;\n                        const bossTopX = boss.pos.y - bossSize;\n                        const bossBottomX = boss.pos.y + bossSize;\n                        \n                        if (bossRightX > obsLeft && bossLeftX < obsRight &&\n                            bossBottomX > obsTop && bossTopX < obsBottom) {\n                            canMoveX = false;\n                        }\n                        \n                        const bossLeftY = boss.pos.x - bossSize;\n                        const bossRightY = boss.pos.x + bossSize;\n                        const bossTopY = newY - bossSize;\n                        const bossBottomY = newY + bossSize;\n                        \n                        if (bossRightY > obsLeft && bossLeftY < obsRight &&\n                            bossBottomY > obsTop && bossTopY < obsBottom) {\n                            canMoveY = false;\n                        }\n                    }\n                    \n                    if (canMoveX) boss.pos.x = newX;\n                    if (canMoveY) boss.pos.y = newY;\n                }\n            }\n            \n            // Fire projectiles at player\n            const fireInterval = 1 / (boss.fireRate * (boss.enraged ? 1.5 : 1.0));\n            if (boss.attackTimer >= fireInterval) {\n                if (distance > 0) {\n                    const direction = dir.unit();\n                    const projectile = createProjectile(\n                        k, \n                        boss.pos.x, \n                        boss.pos.y, \n                        direction, \n                        boss.projectileSpeed, \n                        boss.projectileDamage * (boss.enraged ? 1.25 : 1.0), \n                        0, // piercing\n                        0, // obstaclePiercing\n                        false // isCrit\n                    );\n                    projectile.isBossProjectile = true;\n                    projectile.color = k.rgb(100, 150, 255); // Blue for ranged guardian\n                }\n                boss.attackTimer = 0;\n            }\n        } else if (boss.type === 'swarmQueen') {\n            // Swarm Queen mechanics\n            boss.minionSpawnTimer += k.dt();\n            \n            // Get health percentage for escalating spawn rate\n            const healthPercent = boss.hp() / boss.maxHealth;\n            let spawnInterval;\n            if (healthPercent > 0.66) {\n                spawnInterval = 5; // Every 5 seconds\n            } else if (healthPercent > 0.33) {\n                spawnInterval = 3; // Every 3 seconds\n            } else {\n                spawnInterval = 2; // Every 2 seconds (enraged)\n            }\n            \n            // Count active minions\n            const activeMinions = boss.spawnedMinions.filter(m => m.exists() && m.hp() > 0);\n            const maxMinions = 8; // Up to 8 minions active\n            \n            // Spawn minions if under limit\n            if (boss.minionSpawnTimer >= spawnInterval && activeMinions.length < maxMinions) {\n                // Spawn Bat or Slime (using fast or basic as proxy)\n                // Use seeded RNG for multiplayer consistency\n                const minionType = (boss.rng ? boss.rng.next() : Math.random()) < 0.5 ? 'fast' : 'basic';\n                const angle = (boss.rng ? boss.rng.next() : Math.random()) * Math.PI * 2;\n                const spawnDistance = 50 + (boss.rng ? boss.rng.next() : Math.random()) * 30;\n                const spawnX = boss.pos.x + Math.cos(angle) * spawnDistance;\n                const spawnY = boss.pos.y + Math.sin(angle) * spawnDistance;\n                \n                const minion = createEnemy(k, spawnX, spawnY, minionType, floor);\n                minion.isBossMinion = true;\n                boss.spawnedMinions.push(minion);\n                \n                // Remove dead minions from tracking\n                boss.spawnedMinions = boss.spawnedMinions.filter(m => m.exists());\n                \n                boss.minionSpawnTimer = 0;\n            }\n            \n            // Positioning: Move to center, maintain distance from player\n            const centerX = k.width() / 2;\n            const centerY = k.height() / 2;\n            const preferredDistance = 150; // Distance from player\n            \n            const toCenter = k.vec2(centerX - boss.pos.x, centerY - boss.pos.y);\n            const toPlayer = k.vec2(player.pos.x - boss.pos.x, player.pos.y - boss.pos.y);\n            const playerDistance = toPlayer.len();\n            \n            // Move toward center, but maintain distance from player\n            let moveDir = k.vec2(0, 0);\n            \n            if (toCenter.len() > 30) {\n                // Move toward center\n                moveDir = moveDir.add(toCenter.unit().scale(0.5));\n            }\n            \n            if (playerDistance < preferredDistance) {\n                // Move away from player\n                moveDir = moveDir.add(toPlayer.unit().scale(-1));\n            }\n            \n            if (moveDir.len() > 0) {\n                const normalized = moveDir.unit();\n                const moveAmount = normalized.scale(boss.speed * k.dt());\n                \n                // Check collision with obstacles\n                const newX = boss.pos.x + moveAmount.x;\n                const newY = boss.pos.y + moveAmount.y;\n                \n                let canMoveX = true;\n                let canMoveY = true;\n                \n                const obstacles = k.get('obstacle');\n                const bossSize = boss.size || 14;\n                \n                for (const obstacle of obstacles) {\n                    if (!obstacle.exists()) continue;\n                    \n                    const obsLeft = obstacle.pos.x - obstacle.width / 2;\n                    const obsRight = obstacle.pos.x + obstacle.width / 2;\n                    const obsTop = obstacle.pos.y - obstacle.height / 2;\n                    const obsBottom = obstacle.pos.y + obstacle.height / 2;\n                    \n                    const bossLeftX = newX - bossSize;\n                    const bossRightX = newX + bossSize;\n                    const bossTopX = boss.pos.y - bossSize;\n                    const bossBottomX = boss.pos.y + bossSize;\n                    \n                    if (bossRightX > obsLeft && bossLeftX < obsRight &&\n                        bossBottomX > obsTop && bossTopX < obsBottom) {\n                        canMoveX = false;\n                    }\n                    \n                    const bossLeftY = boss.pos.x - bossSize;\n                    const bossRightY = boss.pos.x + bossSize;\n                    const bossTopY = newY - bossSize;\n                    const bossBottomY = newY + bossSize;\n                    \n                    if (bossRightY > obsLeft && bossLeftY < obsRight &&\n                        bossBottomY > obsTop && bossTopY < obsBottom) {\n                        canMoveY = false;\n                    }\n                }\n                \n                if (canMoveX) boss.pos.x = newX;\n                if (canMoveY) boss.pos.y = newY;\n            }\n        } else {\n            // Default behavior for other boss types (just movement)\n            const dir = k.vec2(\n                player.pos.x - boss.pos.x,\n                player.pos.y - boss.pos.y\n            );\n            const distance = dir.len();\n            \n            if (distance > 0) {\n                const normalized = dir.unit();\n                const moveAmount = normalized.scale(boss.speed * k.dt());\n                \n                // Check collision with obstacles (same as before)\n                const newX = boss.pos.x + moveAmount.x;\n                const newY = boss.pos.y + moveAmount.y;\n                \n                let canMoveX = true;\n                let canMoveY = true;\n                \n                const obstacles = k.get('obstacle');\n                const bossSize = boss.size || 14;\n                \n                for (const obstacle of obstacles) {\n                    if (!obstacle.exists()) continue;\n                    \n                    const obsLeft = obstacle.pos.x - obstacle.width / 2;\n                    const obsRight = obstacle.pos.x + obstacle.width / 2;\n                    const obsTop = obstacle.pos.y - obstacle.height / 2;\n                    const obsBottom = obstacle.pos.y + obstacle.height / 2;\n                    \n                    const bossLeftX = newX - bossSize;\n                    const bossRightX = newX + bossSize;\n                    const bossTopX = boss.pos.y - bossSize;\n                    const bossBottomX = boss.pos.y + bossSize;\n                    \n                    if (bossRightX > obsLeft && bossLeftX < obsRight &&\n                        bossBottomX > obsTop && bossTopX < obsBottom) {\n                        canMoveX = false;\n                    }\n                    \n                    const bossLeftY = boss.pos.x - bossSize;\n                    const bossRightY = boss.pos.x + bossSize;\n                    const bossTopY = newY - bossSize;\n                    const bossBottomY = newY + bossSize;\n                    \n                    if (bossRightY > obsLeft && bossLeftY < obsRight &&\n                        bossBottomY > obsTop && bossTopY < obsBottom) {\n                        canMoveY = false;\n                    }\n                }\n                \n                if (canMoveX) boss.pos.x = newX;\n                if (canMoveY) boss.pos.y = newY;\n            }\n        }\n        \n        // Keep boss in bounds (room boundaries) - same as player and enemies\n        const roomWidth = k.width();\n        const roomHeight = k.height();\n        const margin = 20;\n        const bossSize = boss.size || 14;\n        \n        boss.pos.x = k.clamp(boss.pos.x, margin + bossSize, roomWidth - margin - bossSize);\n        boss.pos.y = k.clamp(boss.pos.y, margin + bossSize, roomHeight - margin - bossSize);\n    });\n\n    // Mark as not dead initially\n    boss.isDead = false;\n\n    boss.onDeath(() => {\n        // In multiplayer, broadcast death event from host\n        if (isMultiplayerActive() && isHost() && boss.mpEntityId) {\n            broadcastDeathEvent({\n                entityId: boss.mpEntityId,\n                entityType: 'boss',\n                x: boss.pos.x,\n                y: boss.pos.y,\n                xpDropped: boss.xpValue\n            });\n        }\n    });\n    \n    // Swarm Queen death explosion handler\n    if (type === 'swarmQueen') {\n        boss.onDeath(() => {\n            // Spawn 8-12 minions in burst on death\n            // Use seeded RNG for multiplayer consistency\n            const minionCount = 8 + Math.floor((boss.rng ? boss.rng.next() : Math.random()) * 5); // 8-12 minions\n            for (let i = 0; i < minionCount; i++) {\n                const angle = (Math.PI * 2 / minionCount) * i + (boss.rng ? boss.rng.next() : Math.random()) * 0.3;\n                const spawnDistance = 40 + (boss.rng ? boss.rng.next() : Math.random()) * 20;\n                const spawnX = boss.pos.x + Math.cos(angle) * spawnDistance;\n                const spawnY = boss.pos.y + Math.sin(angle) * spawnDistance;\n\n                const minionType = (boss.rng ? boss.rng.next() : Math.random()) < 0.5 ? 'fast' : 'basic';\n                const minion = createEnemy(k, spawnX, spawnY, minionType, floor);\n                minion.isBossMinion = true;\n            }\n        });\n    }\n    \n    // Initialize visual\n    boss.updateVisual();\n\n    // Multiplayer: Register boss for network sync if host\n    if (isMultiplayerActive() && isHost()) {\n        registerEnemy(boss, { type, floor, isBoss: true });\n        boss.enemyType = type; // Store type for sync\n    }\n\n    return boss;\n}\n\n// Spawn twin guardians as separate entities from opposite doors\nexport function createTwinGuardians(k, door1, door2, floor = 1, rng = null) {\n    // Spawn melee guardian from first door\n    const meleeGuardian = createBoss(k, door1.pos.x, door1.pos.y, 'twinGuardianMelee', floor, rng);\n\n    // Spawn ranged guardian from second door\n    const rangedGuardian = createBoss(k, door2.pos.x, door2.pos.y, 'twinGuardianRanged', floor, rng);\n    \n    // Link them together for enrage system\n    meleeGuardian.twinPartner = rangedGuardian;\n    rangedGuardian.twinPartner = meleeGuardian;\n    \n    // Set up death handlers for enrage system\n    meleeGuardian.onDeath(() => {\n        if (rangedGuardian && rangedGuardian.exists() && !rangedGuardian.enraged) {\n            // Enrage the ranged guardian\n            rangedGuardian.enrage();\n            if (isMultiplayerActive() && isHost()) {\n                broadcastBossEnrage(rangedGuardian.networkId);\n            }\n        }\n    });\n\n    rangedGuardian.onDeath(() => {\n        if (meleeGuardian && meleeGuardian.exists() && !meleeGuardian.enraged) {\n            // Enrage the melee guardian\n            meleeGuardian.enrage();\n            if (isMultiplayerActive() && isHost()) {\n                broadcastBossEnrage(meleeGuardian.networkId);\n            }\n        }\n    });\n    \n    return [meleeGuardian, rangedGuardian];\n}\n\n","/**\n * Powerup Weapon System\n *\n * Handles temporary weapon powerups that drop during gameplay:\n * - Limited ammo or timed duration\n * - More powerful than starting weapons\n * - Reverts to starting weapon when depleted\n */\n\nimport { WEAPON_DEFINITIONS } from '../data/weapons.js';\nimport { isMultiplayerActive, isHost, broadcastPowerupExpired } from './multiplayerGame.js';\nimport { getPermanentUpgradeLevel } from './metaProgression.js';\n\n// Powerup weapon definitions\nexport const POWERUP_WEAPONS = {\n    orbital: {\n        weaponKey: 'orbital',\n        name: 'Orbital Weapons',\n        duration: 30, // seconds\n        isTimeBased: true,\n        dropChance: 0.15, // 15% chance from enemies\n        icon: '',\n        color: [100, 200, 255]\n    },\n    explosive: {\n        weaponKey: 'explosive',\n        name: 'Explosive Launcher',\n        ammo: 20, // number of shots\n        isAmmoBased: true,\n        dropChance: 0.12, // 12% chance from enemies\n        icon: '',\n        color: [255, 100, 50]\n    },\n    chainLightning: {\n        weaponKey: 'chainLightning',\n        name: 'Chain Lightning',\n        ammo: 25, // number of shots\n        isAmmoBased: true,\n        dropChance: 0.12, // 12% chance from enemies\n        icon: '',\n        color: [255, 255, 100]\n    }\n};\n\n/**\n * Check if enemy should drop powerup weapon\n * @param {string} enemyType - Type of enemy killed\n * @param {number} floor - Current floor\n * @returns {string|null} - Powerup weapon key or null\n */\nexport function rollPowerupDrop(enemyType, floor = 1) {\n    // Only drop from tougher enemies\n    const eligibleEnemies = ['heavyTank', 'golem', 'shieldBearer', 'spawner', 'mage'];\n\n    if (!eligibleEnemies.includes(enemyType)) {\n        return null;\n    }\n\n    // Increased chance on higher floors\n    const floorMultiplier = 1 + (floor - 1) * 0.1;\n    \n    // Get prop drop chance upgrade level (+5% per level, max 25%)\n    const dropChanceLevel = getPermanentUpgradeLevel('propDropChance');\n    const dropChanceBonus = dropChanceLevel * 0.05; // +5% per level\n\n    for (const [key, powerup] of Object.entries(POWERUP_WEAPONS)) {\n        const adjustedChance = powerup.dropChance * floorMultiplier + dropChanceBonus;\n        // Cap at 100% chance\n        const finalChance = Math.min(adjustedChance, 1.0);\n        if (Math.random() < finalChance) {\n            return key;\n        }\n    }\n\n    return null;\n}\n\n/**\n * Apply powerup weapon to player\n * @param {object} player - Player entity\n * @param {string} powerupKey - Powerup weapon key\n */\nexport function applyPowerupWeapon(player, powerupKey) {\n    const powerup = POWERUP_WEAPONS[powerupKey];\n    if (!powerup) return;\n\n    const weaponDef = WEAPON_DEFINITIONS[powerup.weaponKey];\n    if (!weaponDef) return;\n\n    // Store original weapon state\n    if (!player.originalWeapon) {\n        player.originalWeapon = {\n            weaponKey: player.weaponKey,\n            weaponDef: player.weaponDef,\n            fireRate: player.fireRate,\n            projectileSpeed: player.projectileSpeed,\n            projectileDamage: player.projectileDamage,\n            projectileCount: player.projectileCount,\n            piercing: player.piercing,\n            obstaclePiercing: player.obstaclePiercing,\n            critChance: player.critChance,\n            critDamage: player.critDamage,\n            spreadAngle: player.spreadAngle,\n            weaponRange: player.weaponRange,\n            weaponCategory: player.weaponCategory\n        };\n\n        // Store weapon-specific properties if they exist\n        if (player.orbitRadius) player.originalWeapon.orbitRadius = player.orbitRadius;\n        if (player.rotationSpeed) player.originalWeapon.rotationSpeed = player.rotationSpeed;\n        if (player.explosionRadius) player.originalWeapon.explosionRadius = player.explosionRadius;\n        if (player.explosionDamage) player.originalWeapon.explosionDamage = player.explosionDamage;\n        if (player.chainRange) player.originalWeapon.chainRange = player.chainRange;\n        if (player.maxJumps) player.originalWeapon.maxJumps = player.maxJumps;\n        if (player.chainDamageReduction) player.originalWeapon.chainDamageReduction = player.chainDamageReduction;\n    }\n\n    // Apply powerup weapon\n    player.powerupWeapon = powerupKey;\n    player.weaponKey = powerup.weaponKey;\n    player.weaponDef = weaponDef;\n\n    // Apply weapon stats (don't use upgrade multipliers for powerups)\n    player.fireRate = weaponDef.fireRate;\n    player.projectileSpeed = weaponDef.projectileSpeed;\n    player.projectileDamage = weaponDef.baseDamage;\n    player.projectileCount = weaponDef.projectileCount;\n    player.piercing = weaponDef.piercing;\n    player.obstaclePiercing = weaponDef.obstaclePiercing;\n    player.critChance = weaponDef.critChance;\n    player.critDamage = weaponDef.critDamage;\n    player.spreadAngle = weaponDef.spreadAngle;\n    player.weaponRange = weaponDef.range;\n    player.weaponCategory = weaponDef.category;\n\n    // Apply weapon-specific properties\n    if (weaponDef.orbitRadius) {\n        player.orbitRadius = weaponDef.orbitRadius;\n        player.rotationSpeed = weaponDef.rotationSpeed;\n        player.orbitalOrbs = [];\n        player.orbitalAngles = [];\n        player.orbitalNeedsReinit = true;\n    }\n    if (weaponDef.explosionRadius) {\n        player.explosionRadius = weaponDef.explosionRadius;\n        player.explosionDamage = weaponDef.explosionDamage;\n    }\n    if (weaponDef.chainRange) {\n        player.chainRange = weaponDef.chainRange;\n        player.maxJumps = weaponDef.maxJumps;\n        player.chainDamageReduction = weaponDef.chainDamageReduction;\n    }\n\n    // Set ammo or duration\n    if (powerup.isAmmoBased) {\n        player.powerupAmmo = powerup.ammo;\n        player.powerupDuration = null;\n    } else if (powerup.isTimeBased) {\n        // Get prop durability upgrade level (+2 seconds per level, max +10 seconds)\n        const durabilityLevel = getPermanentUpgradeLevel('propDurability');\n        const durabilityBonus = durabilityLevel * 2; // +2 seconds per level\n        player.powerupDuration = powerup.duration + durabilityBonus;\n        player.powerupAmmo = null;\n    }\n}\n\n/**\n * Restore player's original weapon\n * @param {object} player - Player entity\n */\nexport function restoreOriginalWeapon(player) {\n    if (!player.originalWeapon) return;\n\n    const original = player.originalWeapon;\n\n    // Restore weapon state\n    player.weaponKey = original.weaponKey;\n    player.weaponDef = original.weaponDef;\n    player.fireRate = original.fireRate;\n    player.projectileSpeed = original.projectileSpeed;\n    player.projectileDamage = original.projectileDamage;\n    player.projectileCount = original.projectileCount;\n    player.piercing = original.piercing;\n    player.obstaclePiercing = original.obstaclePiercing;\n    player.critChance = original.critChance;\n    player.critDamage = original.critDamage;\n    player.spreadAngle = original.spreadAngle;\n    player.weaponRange = original.weaponRange;\n    player.weaponCategory = original.weaponCategory;\n\n    // Restore weapon-specific properties\n    if (original.orbitRadius) player.orbitRadius = original.orbitRadius;\n    if (original.rotationSpeed) player.rotationSpeed = original.rotationSpeed;\n    if (original.explosionRadius) player.explosionRadius = original.explosionRadius;\n    if (original.explosionDamage) player.explosionDamage = original.explosionDamage;\n    if (original.chainRange) player.chainRange = original.chainRange;\n    if (original.maxJumps) player.maxJumps = original.maxJumps;\n    if (original.chainDamageReduction) player.chainDamageReduction = original.chainDamageReduction;\n\n    // Clean up orbital weapons if switching away from orbital\n    if (player.weaponKey !== 'orbital' && player.orbitalOrbs) {\n        player.orbitalOrbs = [];\n        player.orbitalAngles = [];\n    }\n\n    // Clear powerup state\n    player.powerupWeapon = null;\n    player.powerupAmmo = null;\n    player.powerupDuration = null;\n    player.originalWeapon = null;\n}\n\n/**\n * Update powerup weapon state (called each shot for ammo-based, or each frame for time-based)\n * @param {object} player - Player entity\n * @param {number} dt - Delta time (for time-based powerups)\n * @returns {boolean} - True if powerup expired\n */\nexport function updatePowerupWeapon(player, dt = 0) {\n    if (!player.powerupWeapon) return false;\n\n    const powerup = POWERUP_WEAPONS[player.powerupWeapon];\n    if (!powerup) return false;\n\n    // Update ammo-based powerups\n    if (powerup.isAmmoBased && player.powerupAmmo !== null) {\n        if (player.powerupAmmo <= 0) {\n            // Broadcast expiration before restoring (only host in multiplayer)\n            if (isMultiplayerActive() && isHost() && player.slotIndex !== undefined) {\n                broadcastPowerupExpired(player.slotIndex, player.powerupWeapon);\n            }\n            restoreOriginalWeapon(player);\n            return true;\n        }\n    }\n\n    // Update time-based powerups\n    if (powerup.isTimeBased && player.powerupDuration !== null) {\n        player.powerupDuration -= dt;\n        if (player.powerupDuration <= 0) {\n            // Broadcast expiration before restoring (only host in multiplayer)\n            if (isMultiplayerActive() && isHost() && player.slotIndex !== undefined) {\n                broadcastPowerupExpired(player.slotIndex, player.powerupWeapon);\n            }\n            restoreOriginalWeapon(player);\n            return true;\n        }\n    }\n\n    return false;\n}\n\n/**\n * Decrement powerup ammo (call when player fires)\n * @param {object} player - Player entity\n */\nexport function decrementPowerupAmmo(player) {\n    if (!player.powerupWeapon) return;\n\n    const powerup = POWERUP_WEAPONS[player.powerupWeapon];\n    if (powerup && powerup.isAmmoBased && player.powerupAmmo !== null) {\n        player.powerupAmmo = Math.max(0, player.powerupAmmo - 1);\n    }\n}\n\n/**\n * Get powerup weapon display info\n * @param {object} player - Player entity\n * @returns {object|null} - Display info or null\n */\nexport function getPowerupDisplay(player) {\n    if (!player.powerupWeapon) return null;\n\n    const powerup = POWERUP_WEAPONS[player.powerupWeapon];\n    if (!powerup) return null;\n\n    return {\n        name: powerup.name,\n        icon: powerup.icon,\n        color: powerup.color,\n        ammo: player.powerupAmmo,\n        duration: player.powerupDuration,\n        isAmmoBased: powerup.isAmmoBased,\n        isTimeBased: powerup.isTimeBased\n    };\n}\n","// Pickup entity definitions\nimport { PICKUP_CONFIG } from '../config/constants.js';\nimport { POWERUP_WEAPONS } from '../systems/powerupWeapons.js';\nimport { registerPickup, isHost, isMultiplayerActive, unregisterPickup } from '../systems/multiplayerGame.js';\n\nexport function createXPPickup(k, x, y, value) {\n    const pickup = k.add([\n        k.text('+', { size: 16 }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...PICKUP_CONFIG.XP_COLOR),\n        k.area(),\n        k.scale(1),\n        'xpPickup'\n    ]);\n\n    pickup.value = value;\n    pickup.lifetime = PICKUP_CONFIG.XP_LIFETIME;\n    pickup.age = 0;\n    pickup.collected = false;\n\n    // Magnetization state\n    pickup.magnetizing = false; // Whether this pickup is being pulled toward player\n    pickup.magnetizeSpeed = 0; // Current magnetization speed (for acceleration)\n    pickup.targetPlayer = null; // Reference to player being magnetized to\n    pickup.isFlyingToUI = false;\n\n    // Bounce physics\n    pickup.velocityY = -150 - Math.random() * 100; // Initial upward velocity (randomized)\n    pickup.gravity = 600; // Gravity acceleration\n    pickup.groundY = y; // Ground level (spawn position)\n    pickup.bounceDamping = 0.5; // Energy loss per bounce\n    pickup.bouncing = true; // Whether still bouncing\n\n    // Visual effect - slight pulsing\n    let pulseDir = 1;\n    pickup.onUpdate(() => {\n        if (pickup.isFlyingToUI) {\n            const targetPos = k.vec2(k.width() / 2, k.height() - 18); // XP bar position\n            const dir = targetPos.sub(pickup.pos);\n            if (dir.len() < 10) {\n                k.destroy(pickup);\n            } else {\n                pickup.pos = pickup.pos.add(dir.unit().scale(1000 * k.dt()));\n            }\n            return;\n        }\n\n        if (k.paused) {\n            // Still allow animation during pause for visual feedback\n            const pulse = Math.sin(pickup.age * PICKUP_CONFIG.XP_PULSE_SPEED) * PICKUP_CONFIG.XP_PULSE_AMOUNT;\n            pickup.scale = k.vec2(1 + pulse);\n            return;\n        }\n\n        pickup.age += k.dt();\n\n        // Pulse animation\n        const pulse = Math.sin(pickup.age * PICKUP_CONFIG.XP_PULSE_SPEED) * PICKUP_CONFIG.XP_PULSE_AMOUNT;\n        pickup.scale = k.vec2(1 + pulse);\n\n        // Bounce physics (only when not magnetizing)\n        if (!pickup.magnetizing && pickup.bouncing) {\n            // Apply gravity\n            pickup.velocityY += pickup.gravity * k.dt();\n            pickup.pos.y += pickup.velocityY * k.dt();\n\n            // Check for ground collision\n            if (pickup.pos.y >= pickup.groundY) {\n                pickup.pos.y = pickup.groundY;\n                pickup.velocityY = -pickup.velocityY * pickup.bounceDamping;\n\n                // Stop bouncing if velocity is very small\n                if (Math.abs(pickup.velocityY) < 20) {\n                    pickup.bouncing = false;\n                    pickup.velocityY = 0;\n                }\n            }\n        }\n\n        // Magnetization movement - once magnetizing starts, it never stops\n        if (pickup.magnetizing && pickup.targetPlayer && pickup.targetPlayer.exists()) {\n            pickup.bouncing = false; // Stop bouncing when magnetizing\n\n            // Calculate direction to player\n            const dirToPlayer = k.vec2(\n                pickup.targetPlayer.pos.x - pickup.pos.x,\n                pickup.targetPlayer.pos.y - pickup.pos.y\n            );\n            const distance = dirToPlayer.len();\n\n            if (distance > 0) {\n                // Normalize direction\n                const dir = dirToPlayer.scale(1 / distance);\n\n                // Accelerate magnetization speed\n                pickup.magnetizeSpeed = Math.min(\n                    pickup.magnetizeSpeed + PICKUP_CONFIG.MAGNETIZE_ACCELERATION * k.dt(),\n                    PICKUP_CONFIG.MAGNETIZE_SPEED\n                );\n\n                // Move toward player\n                pickup.pos = pickup.pos.add(dir.scale(pickup.magnetizeSpeed * k.dt()));\n            }\n        }\n\n        // Despawn after lifetime\n        if (pickup.age >= pickup.lifetime) {\n            k.destroy(pickup);\n        }\n    });\n\n    // Multiplayer: Register pickup for network sync if host\n    pickup.pickupType = 'xp'; // Mark type for sync\n    if (isMultiplayerActive() && isHost()) {\n        registerPickup(pickup, { type: 'xpPickup', value });\n    }\n\n    // Cleanup: Remove from tracking map when destroyed (prevents memory leak)\n    if (isMultiplayerActive()) {\n        pickup.onDestroy(() => {\n            unregisterPickup(pickup);\n        });\n    }\n\n    return pickup;\n}\n\n// Currency icons for different types of money\nconst CURRENCY_ICONS = ['$', '', '', '', '', '', '', ''];\n\n// Get a random currency icon\nexport function getRandomCurrencyIcon() {\n    return CURRENCY_ICONS[Math.floor(Math.random() * CURRENCY_ICONS.length)];\n}\n\n// Create a currency pickup that can be collected for money\nexport function createCurrencyPickup(k, x, y, value, icon = null) {\n    // Use provided icon or random one\n    const currencyIcon = icon || getRandomCurrencyIcon();\n\n    const pickup = k.add([\n        k.text(currencyIcon, { size: 9 }), // Reduced from 18 to 9 (50% smaller)\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...PICKUP_CONFIG.CURRENCY_COLOR),\n        k.area(),\n        k.scale(1),\n        k.opacity(1),\n        'currencyPickup'\n    ]);\n\n    pickup.value = value;\n    pickup.lifetime = PICKUP_CONFIG.CURRENCY_LIFETIME;\n    pickup.age = 0;\n    pickup.collected = false;\n\n    // Magnetization state\n    pickup.magnetizing = false;\n    pickup.magnetizeSpeed = 0;\n    pickup.targetPlayer = null;\n    pickup.isFlyingToUI = false;\n\n    // Bounce physics\n    pickup.velocityY = -150 - Math.random() * 100; // Initial upward velocity (randomized)\n    pickup.gravity = 600; // Gravity acceleration\n    pickup.groundY = y; // Ground level (spawn position)\n    pickup.bounceDamping = 0.5; // Energy loss per bounce\n    pickup.bouncing = true; // Whether still bouncing\n\n    // Visual effect - slight pulsing with rotation, and flashing before despawn\n    pickup.onUpdate(() => {\n        if (pickup.isFlyingToUI) {\n            const targetPos = k.vec2(k.width() - 20, 20); // Currency UI position\n            const dir = targetPos.sub(pickup.pos);\n            if (dir.len() < 10) {\n                k.destroy(pickup);\n            } else {\n                pickup.pos = pickup.pos.add(dir.unit().scale(1000 * k.dt()));\n            }\n            return;\n        }\n\n        if (k.paused) {\n            // Still allow animation during pause for visual feedback\n            const pulse = Math.sin(pickup.age * PICKUP_CONFIG.CURRENCY_PULSE_SPEED) * PICKUP_CONFIG.CURRENCY_PULSE_AMOUNT;\n            pickup.scale = k.vec2(1 + pulse);\n            return;\n        }\n\n        pickup.age += k.dt();\n\n        // Pulse animation\n        const pulse = Math.sin(pickup.age * PICKUP_CONFIG.CURRENCY_PULSE_SPEED) * PICKUP_CONFIG.CURRENCY_PULSE_AMOUNT;\n        pickup.scale = k.vec2(1 + pulse);\n\n        // Flashing effect when about to despawn (last 4 seconds)\n        const timeRemaining = pickup.lifetime - pickup.age;\n        if (timeRemaining <= 4 && timeRemaining > 0) {\n            // Flash faster as time runs out: 4Hz at 4s, up to 12Hz at 0s\n            const flashSpeed = 4 + (4 - timeRemaining) * 2;\n            const flash = Math.sin(pickup.age * flashSpeed * Math.PI * 2);\n            // Opacity oscillates between 0.3 and 1.0\n            pickup.opacity = 0.65 + flash * 0.35;\n            // Also make it brighter/whiter when visible\n            if (flash > 0) {\n                pickup.color = k.rgb(255, 255, 200); // Bright gold/white flash\n            } else {\n                pickup.color = k.rgb(...PICKUP_CONFIG.CURRENCY_COLOR);\n            }\n        } else {\n            pickup.opacity = 1;\n        }\n\n        // Bounce physics (only when not magnetizing)\n        if (!pickup.magnetizing && pickup.bouncing) {\n            // Apply gravity\n            pickup.velocityY += pickup.gravity * k.dt();\n            pickup.pos.y += pickup.velocityY * k.dt();\n\n            // Check for ground collision\n            if (pickup.pos.y >= pickup.groundY) {\n                pickup.pos.y = pickup.groundY;\n                pickup.velocityY = -pickup.velocityY * pickup.bounceDamping;\n\n                // Stop bouncing if velocity is very small\n                if (Math.abs(pickup.velocityY) < 20) {\n                    pickup.bouncing = false;\n                    pickup.velocityY = 0;\n                }\n            }\n        }\n\n        // Magnetization movement - once magnetizing starts, it never stops\n        if (pickup.magnetizing && pickup.targetPlayer && pickup.targetPlayer.exists()) {\n            pickup.bouncing = false; // Stop bouncing when magnetizing\n\n            // Calculate direction to player\n            const dirToPlayer = k.vec2(\n                pickup.targetPlayer.pos.x - pickup.pos.x,\n                pickup.targetPlayer.pos.y - pickup.pos.y\n            );\n            const distance = dirToPlayer.len();\n\n            if (distance > 0) {\n                // Normalize direction\n                const dir = dirToPlayer.scale(1 / distance);\n\n                // Accelerate magnetization speed\n                pickup.magnetizeSpeed = Math.min(\n                    pickup.magnetizeSpeed + PICKUP_CONFIG.MAGNETIZE_ACCELERATION * k.dt(),\n                    PICKUP_CONFIG.MAGNETIZE_SPEED\n                );\n\n                // Move toward player\n                pickup.pos = pickup.pos.add(dir.scale(pickup.magnetizeSpeed * k.dt()));\n            }\n        }\n\n        // Despawn after lifetime\n        if (pickup.age >= pickup.lifetime) {\n            k.destroy(pickup);\n        }\n    });\n\n    // Multiplayer: Register pickup for network sync if host\n    pickup.pickupType = 'currency'; // Mark type for sync\n    if (isMultiplayerActive() && isHost()) {\n        registerPickup(pickup, { type: 'currencyPickup', value, icon: currencyIcon });\n    }\n\n    // Cleanup: Remove from tracking map when destroyed (prevents memory leak)\n    if (isMultiplayerActive()) {\n        pickup.onDestroy(() => {\n            unregisterPickup(pickup);\n        });\n    }\n\n    return pickup;\n}\n\n// Create a powerup weapon pickup that can be collected for temporary weapon\nexport function createPowerupWeaponPickup(k, x, y, powerupKey) {\n    const powerup = POWERUP_WEAPONS[powerupKey];\n    if (!powerup) return null;\n\n    const pickup = k.add([\n        k.text(powerup.icon, { size: 24 }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...powerup.color),\n        k.area(),\n        k.scale(1),\n        'powerupWeaponPickup'\n    ]);\n\n    pickup.powerupKey = powerupKey;\n    pickup.lifetime = PICKUP_CONFIG.CURRENCY_LIFETIME; // Same lifetime as currency\n    pickup.age = 0;\n    pickup.collected = false;\n\n    // Magnetization state\n    pickup.magnetizing = false;\n    pickup.magnetizeSpeed = 0;\n    pickup.targetPlayer = null;\n\n    // Bounce physics\n    pickup.velocityY = -150 - Math.random() * 100; // Initial upward velocity (randomized)\n    pickup.gravity = 600; // Gravity acceleration\n    pickup.groundY = y; // Ground level (spawn position)\n    pickup.bounceDamping = 0.5; // Energy loss per bounce\n    pickup.bouncing = true; // Whether still bouncing\n\n    // Visual effect - pulsing and rotating\n    pickup.onUpdate(() => {\n        if (k.paused) {\n            // Still allow animation during pause for visual feedback\n            const pulse = Math.sin(pickup.age * 4) * 0.15;\n            pickup.scale = k.vec2(1 + pulse);\n            pickup.angle = Math.sin(pickup.age * 2) * 10;\n            return;\n        }\n\n        pickup.age += k.dt();\n\n        // Pulse animation (more pronounced than other pickups)\n        const pulse = Math.sin(pickup.age * 4) * 0.15;\n        pickup.scale = k.vec2(1 + pulse);\n\n        // Gentle rotation\n        pickup.angle = Math.sin(pickup.age * 2) * 10;\n\n        // Bounce physics (only when not magnetizing)\n        if (!pickup.magnetizing && pickup.bouncing) {\n            // Apply gravity\n            pickup.velocityY += pickup.gravity * k.dt();\n            pickup.pos.y += pickup.velocityY * k.dt();\n\n            // Check for ground collision\n            if (pickup.pos.y >= pickup.groundY) {\n                pickup.pos.y = pickup.groundY;\n                pickup.velocityY = -pickup.velocityY * pickup.bounceDamping;\n\n                // Stop bouncing if velocity is very small\n                if (Math.abs(pickup.velocityY) < 20) {\n                    pickup.bouncing = false;\n                    pickup.velocityY = 0;\n                }\n            }\n        }\n\n        // Magnetization movement - once magnetizing starts, it never stops\n        if (pickup.magnetizing && pickup.targetPlayer && pickup.targetPlayer.exists()) {\n            pickup.bouncing = false; // Stop bouncing when magnetizing\n\n            // Calculate direction to player\n            const dirToPlayer = k.vec2(\n                pickup.targetPlayer.pos.x - pickup.pos.x,\n                pickup.targetPlayer.pos.y - pickup.pos.y\n            );\n            const distance = dirToPlayer.len();\n\n            if (distance > 0) {\n                // Normalize direction\n                const dir = dirToPlayer.scale(1 / distance);\n\n                // Accelerate magnetization speed\n                pickup.magnetizeSpeed = Math.min(\n                    pickup.magnetizeSpeed + PICKUP_CONFIG.MAGNETIZE_ACCELERATION * k.dt(),\n                    PICKUP_CONFIG.MAGNETIZE_SPEED\n                );\n\n                // Move toward player\n                pickup.pos = pickup.pos.add(dir.scale(pickup.magnetizeSpeed * k.dt()));\n            }\n        }\n\n        // Despawn after lifetime\n        if (pickup.age >= pickup.lifetime) {\n            k.destroy(pickup);\n        }\n    });\n\n    // Multiplayer: Register pickup for network sync if host\n    pickup.pickupType = 'powerup'; // Mark type for sync\n    if (isMultiplayerActive() && isHost()) {\n        registerPickup(pickup);\n    }\n\n    // Cleanup: Remove from tracking map when destroyed (prevents memory leak)\n    if (isMultiplayerActive()) {\n        pickup.onDestroy(() => {\n            unregisterPickup(pickup);\n        });\n    }\n\n    return pickup;\n}\n","/**\n * Seeded Random Number Generator\n *\n * Uses the Mulberry32 algorithm for deterministic random number generation.\n * This ensures that the same seed always produces the same sequence of random numbers,\n * which is critical for multiplayer synchronization.\n *\n * Usage:\n *   const rng = new SeededRandom(12345);\n *   const value = rng.next(); // 0 to 1\n *   const num = rng.range(1, 10); // 1 to 9\n *   const choice = rng.choose(['a', 'b', 'c']); // random element\n */\n\nexport class SeededRandom {\n    /**\n     * Create a new seeded random number generator\n     * @param {number} seed - The seed value (must be a 32-bit integer)\n     */\n    constructor(seed) {\n        // Ensure seed is a 32-bit integer\n        this.seed = seed >>> 0;\n        this.originalSeed = this.seed;\n    }\n\n    /**\n     * Generate the next random number (0 to 1, exclusive)\n     * Uses Mulberry32 algorithm for high-quality deterministic randomness\n     * @returns {number} Random number between 0 and 1\n     */\n    next() {\n        let t = this.seed += 0x6D2B79F5;\n        t = Math.imul(t ^ t >>> 15, t | 1);\n        t ^= t + Math.imul(t ^ t >>> 7, t | 61);\n        return ((t ^ t >>> 14) >>> 0) / 4294967296;\n    }\n\n    /**\n     * Generate a random integer in range [min, max)\n     * @param {number} min - Minimum value (inclusive)\n     * @param {number} max - Maximum value (exclusive)\n     * @returns {number} Random integer\n     */\n    range(min, max) {\n        if (max <= min) {\n            console.warn(`SeededRandom.range: Invalid range [${min}, ${max}). Returning min.`);\n            return min;\n        }\n        return Math.floor(min + this.next() * (max - min));\n    }\n\n    /**\n     * Generate a random float in range [min, max)\n     * @param {number} min - Minimum value (inclusive)\n     * @param {number} max - Maximum value (exclusive)\n     * @returns {number} Random float\n     */\n    rangeFloat(min, max) {\n        return min + this.next() * (max - min);\n    }\n\n    /**\n     * Choose a random element from an array\n     * @param {Array} array - Array to choose from\n     * @returns {*} Random element from array\n     */\n    choose(array) {\n        if (!array || array.length === 0) return undefined;\n        return array[this.range(0, array.length)];\n    }\n\n    /**\n     * Shuffle an array using Fisher-Yates algorithm\n     * @param {Array} array - Array to shuffle (modified in place)\n     * @returns {Array} The shuffled array\n     */\n    shuffle(array) {\n        const arr = [...array]; // Create copy to avoid mutation\n        for (let i = arr.length - 1; i > 0; i--) {\n            const j = this.range(0, i + 1);\n            [arr[i], arr[j]] = [arr[j], arr[i]];\n        }\n        return arr;\n    }\n\n    /**\n     * Roll a probability check\n     * @param {number} probability - Probability of success (0 to 1)\n     * @returns {boolean} True if roll succeeds\n     */\n    probability(probability) {\n        return this.next() < probability;\n    }\n\n    /**\n     * Reset the RNG to its original seed\n     */\n    reset() {\n        this.seed = this.originalSeed;\n    }\n\n    /**\n     * Get current seed state (for saving/loading)\n     * @returns {number} Current seed\n     */\n    getState() {\n        return this.seed;\n    }\n\n    /**\n     * Set seed state (for loading)\n     * @param {number} state - Seed state to restore\n     */\n    setState(state) {\n        this.seed = state >>> 0;\n    }\n}\n\n/**\n * Create a seed from multiple components\n * Useful for creating deterministic seeds from game state\n * @param  {...number} components - Numbers to combine into a seed\n * @returns {number} Combined seed\n */\nexport function createSeed(...components) {\n    let seed = 0;\n    for (let i = 0; i < components.length; i++) {\n        seed = ((seed << 5) - seed + components[i]) | 0;\n    }\n    return seed >>> 0;\n}\n\n/**\n * Create a seed from a string\n * @param {string} str - String to convert to seed\n * @returns {number} Seed value\n */\nexport function seedFromString(str) {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n        hash = ((hash << 5) - hash + str.charCodeAt(i)) | 0;\n    }\n    return hash >>> 0;\n}\n","/**\n * Connection Quality Indicator System\n *\n * Measures and displays latency/ping for multiplayer connections.\n * Provides visual feedback on connection quality.\n */\n\nimport { onMessage, sendToPeer, sendToHost, getNetworkInfo } from './networkSystem.js';\nimport { isHost, isMultiplayerActive } from './multiplayerGame.js';\n\n// Connection quality state\nconst connectionState = {\n    // Map of peerId -> { latency, lastPingTime, pingId }\n    peers: new Map(),\n    localLatency: 0,\n    pingInterval: 2000, // Ping every 2 seconds\n    pingTimeout: 5000, // Consider disconnected after 5s without response\n    lastPingId: 0,\n    lastPingSentTime: 0,\n    handlersRegistered: false\n};\n\n// Quality thresholds (in ms)\nconst QUALITY_THRESHOLDS = {\n    GOOD: 100,      // < 100ms = green\n    MEDIUM: 200,    // 100-200ms = yellow\n    POOR: 500       // > 200ms = red, > 500ms = critical\n};\n\n/**\n * Initialize connection quality monitoring\n * Call this when multiplayer starts\n */\nexport function initConnectionQuality() {\n    if (connectionState.handlersRegistered) return;\n    connectionState.handlersRegistered = true;\n\n    // Handle ping requests (respond with pong)\n    onMessage('ping', (payload, fromPeerId) => {\n        // Respond immediately with the same ping ID\n        if (isHost()) {\n            sendToPeer(fromPeerId, 'pong', { pingId: payload.pingId, serverTime: Date.now() });\n        } else {\n            sendToHost('pong', { pingId: payload.pingId, serverTime: Date.now() });\n        }\n    });\n\n    // Handle pong responses (calculate latency)\n    onMessage('pong', (payload, fromPeerId) => {\n        const now = Date.now();\n        const pingId = payload.pingId;\n\n        if (isHost()) {\n            // Host received pong from a client\n            const peerState = connectionState.peers.get(fromPeerId);\n            if (peerState && peerState.pingId === pingId) {\n                const latency = now - peerState.lastPingTime;\n                peerState.latency = latency;\n            }\n        } else {\n            // Client received pong from host\n            if (connectionState.lastPingId === pingId) {\n                connectionState.localLatency = now - connectionState.lastPingSentTime;\n            }\n        }\n    });\n}\n\n/**\n * Send a ping to measure latency\n * Call this periodically (e.g., every 2 seconds)\n * @param {string} peerId - Peer ID to ping (host only, for clients leave empty)\n */\nexport function sendPing(peerId = null) {\n    const pingId = Date.now();\n\n    if (isHost() && peerId) {\n        // Host pinging a specific client\n        let peerState = connectionState.peers.get(peerId);\n        if (!peerState) {\n            peerState = { latency: 0, lastPingTime: 0, pingId: 0 };\n            connectionState.peers.set(peerId, peerState);\n        }\n        peerState.pingId = pingId;\n        peerState.lastPingTime = Date.now();\n        sendToPeer(peerId, 'ping', { pingId });\n    } else if (!isHost()) {\n        // Client pinging host\n        connectionState.lastPingId = pingId;\n        connectionState.lastPingSentTime = Date.now();\n        sendToHost('ping', { pingId });\n    }\n}\n\n/**\n * Get latency for a specific peer (host only)\n * @param {string} peerId - Peer ID\n * @returns {number} - Latency in ms (0 if unknown)\n */\nexport function getPeerLatency(peerId) {\n    const peerState = connectionState.peers.get(peerId);\n    return peerState ? peerState.latency : 0;\n}\n\n/**\n * Get local latency to host (client only)\n * @returns {number} - Latency in ms\n */\nexport function getLocalLatency() {\n    return connectionState.localLatency;\n}\n\n/**\n * Get quality level from latency\n * @param {number} latencyMs - Latency in milliseconds\n * @returns {string} - 'good', 'medium', 'poor', or 'critical'\n */\nexport function getQualityLevel(latencyMs) {\n    if (latencyMs < QUALITY_THRESHOLDS.GOOD) return 'good';\n    if (latencyMs < QUALITY_THRESHOLDS.MEDIUM) return 'medium';\n    if (latencyMs < QUALITY_THRESHOLDS.POOR) return 'poor';\n    return 'critical';\n}\n\n/**\n * Get quality icon based on latency\n * @param {number} latencyMs - Latency in milliseconds\n * @returns {Object} - { icon: string, color: number[] }\n */\nexport function getQualityIcon(latencyMs) {\n    const quality = getQualityLevel(latencyMs);\n\n    switch (quality) {\n        case 'good':\n            return { icon: '', color: [100, 255, 100] }; // Green\n        case 'medium':\n            return { icon: '', color: [255, 255, 100] }; // Yellow\n        case 'poor':\n            return { icon: '', color: [255, 150, 100] }; // Orange\n        case 'critical':\n            return { icon: '', color: [255, 100, 100] }; // Red\n        default:\n            return { icon: '', color: [150, 150, 150] }; // Gray (unknown)\n    }\n}\n\n/**\n * Get formatted latency string\n * @param {number} latencyMs - Latency in milliseconds\n * @returns {string} - Formatted latency (e.g., \"45ms\")\n */\nexport function formatLatency(latencyMs) {\n    if (latencyMs <= 0) return '?ms';\n    return `${Math.round(latencyMs)}ms`;\n}\n\n/**\n * Get all peer latencies (host only)\n * @returns {Map<string, number>} - Map of peerId -> latency\n */\nexport function getAllPeerLatencies() {\n    const latencies = new Map();\n    connectionState.peers.forEach((state, peerId) => {\n        latencies.set(peerId, state.latency);\n    });\n    return latencies;\n}\n\n/**\n * Clear connection state for a peer\n * @param {string} peerId - Peer ID to clear\n */\nexport function clearPeerConnection(peerId) {\n    connectionState.peers.delete(peerId);\n}\n\n/**\n * Reset all connection quality state\n */\nexport function resetConnectionQuality() {\n    connectionState.peers.clear();\n    connectionState.localLatency = 0;\n    connectionState.lastPingId = 0;\n    connectionState.lastPingSentTime = 0;\n}\n\n/**\n * Update connection quality display for all players\n * Should be called in the game's update loop\n * @param {Object} k - Kaplay instance\n * @param {Function} getConnectedPeers - Function to get connected peer IDs\n */\nexport function updateConnectionQuality(k, getConnectedPeers) {\n    if (!isMultiplayerActive()) return;\n\n    const now = Date.now();\n\n    // Only ping every interval\n    if (now - connectionState.lastPingSentTime < connectionState.pingInterval) {\n        return;\n    }\n\n    if (isHost()) {\n        // Host: ping all connected clients\n        const peers = getConnectedPeers();\n        peers.forEach(peerId => {\n            sendPing(peerId);\n        });\n    } else {\n        // Client: ping host\n        sendPing();\n    }\n}\n","// Upgrade system - handles upgrade definitions and application\nimport { isUpgradeValidForWeapon, getWeaponDefinition, WEAPON_DEFINITIONS } from '../data/weapons.js';\n\n// Upgrade stack limits\nexport const UPGRADE_STACK_LIMITS = {\n    damage: 10, // 10 stacks = 250% total (25% per stack)\n    fireRate: 10, // 10 stacks = ~620% total (20% per stack, multiplicative)\n    speed: 10, // 10 stacks = ~405% total (15% per stack, multiplicative)\n    health: 10, // 10 stacks = +200 HP total (20 per stack)\n    projectileSpeed: 10, // 10 stacks = ~931% total (25% per stack, multiplicative)\n    xpGain: 10, // 10 stacks = +150% total (15% per stack)\n    pickupRadius: 10, // 10 stacks = ~5766% total (50% per stack, multiplicative)\n    multiShot: 5, // 5 stacks = +5 projectiles total\n    piercing: 5, // 5 stacks = +5 penetration total\n    obstaclePiercing: 5, // 5 stacks = +5 obstacle penetration total\n    critChance: 10, // 10 stacks = +100% crit chance total (10% per stack)\n    critDamage: 10, // 10 stacks = +500% crit damage total (50% per stack)\n    spreadShot: 5, // 5 stacks = +150 spread total (30 per stack)\n    pelletCount: 5, // 5 stacks = +5 pellets total\n    range: 5, // 5 stacks = ~305% total (25% per stack, multiplicative)\n    dot: 10, // 10 stacks = +250% DoT total (25% per stack)\n    orbitalCount: 5, // 5 stacks = +5 orbs total\n    orbitalSpeed: 10, // 10 stacks = ~5766% total (50% per stack, multiplicative)\n    orbitalRadius: 10, // 10 stacks = ~619% total (20% per stack, multiplicative)\n    explosionRadius: 10, // 10 stacks = ~931% total (25% per stack, multiplicative)\n    explosionDamage: 10, // 10 stacks = ~931% total (25% per stack, multiplicative)\n    chainJumps: 5, // 5 stacks = +5 jumps total\n    chainRange: 10, // 10 stacks = ~931% total (25% per stack, multiplicative)\n    chainDamage: 10, // 10 stacks = -100% damage reduction (minimum 5% per jump)\n    defense: 10, // 10 stacks = +20 damage reduction total (2 per stack)\n    // New upgrades\n    lifesteal: 5, // 5 stacks = 10% lifesteal total (2% per stack)\n    dodgeChance: 5, // 5 stacks = 25% dodge chance total (5% per stack)\n    thorns: 5, // 5 stacks = 75% reflected damage total (15% per stack)\n    aoeSize: 10, // 10 stacks = +150% AoE size total (15% per stack)\n    knockback: 5, // 5 stacks = +100% knockback total (20% per stack)\n    magnetRange: 10, // 10 stacks = +250% pickup radius total (25% per stack)\n    invulnTime: 5, // 5 stacks = +0.75s invuln total (0.15s per stack)\n    moveDamage: 5, // 5 stacks = +10% damage per speed stack (2% per stack)\n    lowHealthDmg: 5, // 5 stacks = +25% damage per 10% missing HP (5% per stack)\n    killSpeed: 5 // 5 stacks = +15% speed on kill for 3s (3% per stack)\n};\n\n// Basic upgrade definitions\n// Each upgrade can specify which weapons it's valid for\nexport const UPGRADES = {\n    damage: {\n        name: 'Damage Boost',\n        icon: '',\n        description: '+25% damage',\n        category: 'weapon',\n        upgradeCategory: 'damage',\n        maxStacks: 10,\n        getDescription: (stacks) => `+25% damage${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.damage})` : ''}`,\n        apply: (player) => {\n            // Stackable: recalculate from base damage\n            const stacks = player.upgradeStacks?.damage || 0;\n            const baseDamage = player.baseProjectileDamage || player.weaponDef?.baseDamage || 10;\n            const multiplier = Math.pow(1.25, stacks);\n            player.projectileDamage = Math.floor(baseDamage * multiplier);\n        }\n    },\n    fireRate: {\n        name: 'Fire Rate',\n        icon: '',\n        description: '+20% fire rate',\n        category: 'weapon',\n        upgradeCategory: 'fireRate',\n        maxStacks: 10,\n        getDescription: (stacks) => `+20% fire rate${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.fireRate})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.fireRate || 0;\n            const baseFireRate = player.baseFireRate || player.weaponDef?.fireRate || 1.5;\n            const multiplier = Math.pow(1.2, stacks);\n            player.fireRate = baseFireRate * multiplier;\n        }\n    },\n    speed: {\n        name: 'Movement Speed',\n        icon: '',\n        description: '+15% movement speed',\n        category: 'passive',\n        maxStacks: 10,\n        getDescription: (stacks) => `+15% movement speed${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.speed})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.speed || 0;\n            const baseSpeed = player.characterData?.stats?.speed || 150;\n            const multiplier = Math.pow(1.15, stacks);\n            player.speed = Math.floor(baseSpeed * multiplier);\n            player.originalSpeed = player.speed;\n        }\n    },\n    health: {\n        name: 'Max Health',\n        icon: '',\n        description: '+20 max HP',\n        category: 'passive',\n        maxStacks: 10,\n        getDescription: (stacks) => `+20 max HP${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.health})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.health || 0;\n            const baseHealth = player.characterData?.stats?.health || 100;\n            const bonusHP = stacks * 20;\n            const oldMaxHealth = player.maxHealth;\n            player.maxHealth = baseHealth + bonusHP;\n            // Heal the difference\n            const hpDiff = player.maxHealth - oldMaxHealth;\n            if (hpDiff > 0) {\n                player.setHP(player.hp() + hpDiff);\n            }\n        }\n    },\n    projectileSpeed: {\n        name: 'Projectile Speed',\n        icon: '',\n        description: '+25% projectile speed',\n        category: 'weapon',\n        maxStacks: 10,\n        getDescription: (stacks) => `+25% projectile speed${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.projectileSpeed})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.projectileSpeed || 0;\n            const baseSpeed = player.baseProjectileSpeed || player.weaponDef?.projectileSpeed || 300;\n            const multiplier = Math.pow(1.25, stacks);\n            player.projectileSpeed = Math.floor(baseSpeed * multiplier);\n        }\n    },\n    xpGain: {\n        name: 'XP Gain',\n        icon: '',\n        description: '+15% XP from enemies',\n        category: 'passive',\n        maxStacks: 10,\n        getDescription: (stacks) => `+15% XP from enemies${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.xpGain})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.xpGain || 0;\n            const baseMultiplier = player.characterData?.ability === 'xpBoost' ? 1.1 : 1.0;\n            player.xpMultiplier = baseMultiplier + (stacks * 0.15);\n        }\n    },\n    pickupRadius: {\n        name: 'Pickup Radius',\n        icon: '',\n        description: '+50% pickup range',\n        category: 'passive',\n        maxStacks: 10,\n        getDescription: (stacks) => `+50% pickup range${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.pickupRadius})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.pickupRadius || 0;\n            const baseRadius = 30;\n            const multiplier = Math.pow(1.5, stacks);\n            player.pickupRadius = Math.floor(baseRadius * multiplier);\n        }\n    },\n    multiShot: {\n        name: 'Multi-Shot',\n        icon: '',\n        description: '+1 projectile per shot',\n        category: 'weapon',\n        upgradeCategory: 'multiShot',\n        validWeapons: ['pistol', 'smg', 'sniper'],\n        maxStacks: 5,\n        getDescription: (stacks) => `+1 projectile per shot${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.multiShot})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.multiShot || 0;\n            const baseCount = player.weaponDef?.projectileCount || 1;\n            player.projectileCount = baseCount + stacks;\n        }\n    },\n    piercing: {\n        name: 'Piercing',\n        icon: '',\n        description: '+1 enemy penetration',\n        category: 'weapon',\n        upgradeCategory: 'piercing',\n        maxStacks: 5,\n        getDescription: (stacks) => `+1 enemy penetration${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.piercing})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.piercing || 0;\n            const basePiercing = player.weaponDef?.piercing || 0;\n            player.piercing = basePiercing + stacks;\n        }\n    },\n    obstaclePiercing: {\n        name: 'Obstacle Piercing',\n        icon: '',\n        description: '+1 obstacle penetration',\n        category: 'weapon',\n        maxStacks: 5,\n        getDescription: (stacks) => `+1 obstacle penetration${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.obstaclePiercing})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.obstaclePiercing || 0;\n            const baseObstaclePiercing = player.weaponDef?.obstaclePiercing || 0;\n            player.obstaclePiercing = baseObstaclePiercing + stacks;\n        }\n    },\n    critChance: {\n        name: 'Critical Strike',\n        icon: '',\n        description: '+10% crit chance',\n        category: 'weapon',\n        upgradeCategory: 'crit',\n        maxStacks: 10,\n        getDescription: (stacks) => `+10% crit chance${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.critChance})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.critChance || 0;\n            const baseCritChance = player.weaponDef?.critChance || 0.05;\n            let finalCritChance = baseCritChance + (stacks * 0.1);\n            // Apply character bonus if applicable\n            if (player.characterData?.ability === 'critBoost') {\n                finalCritChance *= 1.5;\n            }\n            player.critChance = finalCritChance;\n        }\n    },\n    critDamage: {\n        name: 'Critical Power',\n        icon: '',\n        description: '+50% crit damage',\n        category: 'weapon',\n        upgradeCategory: 'crit',\n        maxStacks: 10,\n        getDescription: (stacks) => `+50% crit damage${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.critDamage})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.critDamage || 0;\n            const baseCritDamage = player.weaponDef?.critDamage || 2.0;\n            let finalCritDamage = baseCritDamage + (stacks * 0.5);\n            // Apply character bonus if applicable\n            if (player.characterData?.ability === 'critBoost') {\n                finalCritDamage *= 1.25;\n            }\n            player.critDamage = finalCritDamage;\n        }\n    },\n    spreadShot: {\n        name: 'Spread Shot',\n        icon: '',\n        description: '+30 spread angle',\n        category: 'weapon',\n        upgradeCategory: 'spread',\n        validWeapons: ['shotgun'], // Only shotgun has 'spread' in upgradeCategories\n        maxStacks: 5,\n        getDescription: (stacks) => `+30 spread angle${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.spreadShot})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.spreadShot || 0;\n            const baseSpread = player.weaponDef?.spreadAngle || 0;\n            player.spreadAngle = baseSpread + (stacks * 30);\n        }\n    },\n    pelletCount: {\n        name: 'More Pellets',\n        icon: '',\n        description: '+1 pellet per shot',\n        category: 'weapon',\n        upgradeCategory: 'pelletCount',\n        validWeapons: ['shotgun'],\n        maxStacks: 5,\n        getDescription: (stacks) => `+1 pellet per shot${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.pelletCount})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.pelletCount || 0;\n            const baseCount = player.weaponDef?.projectileCount || 3;\n            player.projectileCount = baseCount + stacks;\n        }\n    },\n    range: {\n        name: 'Extended Range',\n        icon: '',\n        description: '+25% weapon range',\n        category: 'weapon',\n        upgradeCategory: 'range',\n        validWeapons: ['sniper', 'flamethrower', 'explosive'], // All weapons with 'range' in upgradeCategories\n        maxStacks: 5,\n        getDescription: (stacks) => `+25% weapon range${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.range})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.range || 0;\n            const baseRange = player.weaponDef?.range || 600;\n            const multiplier = Math.pow(1.25, stacks);\n            player.weaponRange = Math.floor(baseRange * multiplier);\n        }\n    },\n    dot: {\n        name: 'Burn Damage',\n        icon: '',\n        description: '+25% fire damage over time',\n        category: 'weapon',\n        upgradeCategory: 'dot',\n        validWeapons: ['flamethrower'],\n        maxStacks: 10,\n        getDescription: (stacks) => `+25% fire damage over time${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.dot})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.dot || 0;\n            const baseMultiplier = player.characterData?.ability === 'fireDot' ? 1.25 : 1.0;\n            player.fireDotMultiplier = baseMultiplier + (stacks * 0.25);\n        }\n    },\n    orbitalCount: {\n        name: 'Extra Orb',\n        icon: '',\n        description: '+1 orbital orb',\n        category: 'weapon',\n        upgradeCategory: 'orbitalCount',\n        validWeapons: ['orbital'],\n        maxStacks: 5,\n        getDescription: (stacks) => `+1 orbital orb${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.orbitalCount})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.orbitalCount || 0;\n            const baseCount = player.weaponDef?.projectileCount || 1;\n            player.projectileCount = baseCount + stacks;\n            // Reinitialize orbital weapons if needed\n            if (player.weaponKey === 'orbital' && player.orbitalOrbs) {\n                // Mark for reinitialization\n                player.orbitalNeedsReinit = true;\n            }\n        }\n    },\n    orbitalSpeed: {\n        name: 'Faster Orbit',\n        icon: '',\n        description: '+50% orbital rotation speed',\n        category: 'weapon',\n        upgradeCategory: 'orbitalSpeed',\n        validWeapons: ['orbital'],\n        maxStacks: 10,\n        getDescription: (stacks) => `+50% orbital rotation speed${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.orbitalSpeed})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.orbitalSpeed || 0;\n            const baseSpeed = player.weaponDef?.rotationSpeed || 180;\n            const multiplier = Math.pow(1.5, stacks);\n            player.rotationSpeed = baseSpeed * multiplier;\n        }\n    },\n    orbitalRadius: {\n        name: 'Wider Orbit',\n        icon: '',\n        description: '+20% orbital radius',\n        category: 'weapon',\n        upgradeCategory: 'orbitalRadius',\n        validWeapons: ['orbital'],\n        maxStacks: 10,\n        getDescription: (stacks) => `+20% orbital radius${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.orbitalRadius})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.orbitalRadius || 0;\n            const baseRadius = player.weaponDef?.orbitRadius || 45;\n            const multiplier = Math.pow(1.2, stacks);\n            player.orbitRadius = Math.floor(baseRadius * multiplier);\n        }\n    },\n    explosionRadius: {\n        name: 'Bigger Explosion',\n        icon: '',\n        description: '+25% explosion radius',\n        category: 'weapon',\n        upgradeCategory: 'explosionRadius',\n        validWeapons: ['explosive'],\n        maxStacks: 10,\n        getDescription: (stacks) => `+25% explosion radius${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.explosionRadius})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.explosionRadius || 0;\n            const baseRadius = player.weaponDef?.explosionRadius || 50;\n            const multiplier = Math.pow(1.25, stacks);\n            player.explosionRadius = Math.floor(baseRadius * multiplier);\n        }\n    },\n    explosionDamage: {\n        name: 'Explosive Power',\n        icon: '',\n        description: '+25% explosion damage',\n        category: 'weapon',\n        upgradeCategory: 'explosionDamage',\n        validWeapons: ['explosive'],\n        maxStacks: 10,\n        getDescription: (stacks) => `+25% explosion damage${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.explosionDamage})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.explosionDamage || 0;\n            const baseDamage = player.weaponDef?.explosionDamage || 15;\n            const multiplier = Math.pow(1.25, stacks);\n            player.explosionDamage = Math.floor(baseDamage * multiplier);\n        }\n    },\n    chainJumps: {\n        name: 'More Chains',\n        icon: '',\n        description: '+1 chain jump',\n        category: 'weapon',\n        upgradeCategory: 'chainJumps',\n        validWeapons: ['chainLightning'],\n        maxStacks: 5,\n        getDescription: (stacks) => `+1 chain jump${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.chainJumps})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.chainJumps || 0;\n            const baseJumps = player.weaponDef?.maxJumps || 3;\n            player.maxJumps = baseJumps + stacks;\n        }\n    },\n    chainRange: {\n        name: 'Longer Chain',\n        icon: '',\n        description: '+25% chain range',\n        category: 'weapon',\n        upgradeCategory: 'chainRange',\n        validWeapons: ['chainLightning'],\n        maxStacks: 10,\n        getDescription: (stacks) => `+25% chain range${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.chainRange})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.chainRange || 0;\n            const baseRange = player.weaponDef?.chainRange || 70;\n            const multiplier = Math.pow(1.25, stacks);\n            player.chainRange = Math.floor(baseRange * multiplier);\n        }\n    },\n    chainDamage: {\n        name: 'Chain Power',\n        icon: '',\n        description: '-10% damage reduction per jump',\n        category: 'weapon',\n        upgradeCategory: 'chainDamage',\n        validWeapons: ['chainLightning'],\n        maxStacks: 10,\n        getDescription: (stacks) => `-10% damage reduction per jump${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.chainDamage})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.chainDamage || 0;\n            const baseReduction = player.weaponDef?.chainDamageReduction || 0.15;\n            // Reduce damage reduction (so damage stays higher)\n            player.chainDamageReduction = Math.max(0.05, baseReduction - (stacks * 0.1));\n        }\n    },\n    defense: {\n        name: 'Armor',\n        icon: '',\n        description: '+2 damage reduction',\n        category: 'passive',\n        maxStacks: 10,\n        getDescription: (stacks) => `+2 damage reduction${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.defense})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.defense || 0;\n            const baseDefense = player.characterData?.ability === 'tankStats' ? 0.15 : 0;\n            player.defense = baseDefense + (stacks * 2);\n        }\n    },\n\n    // ========================================\n    // NEW UPGRADES\n    // ========================================\n\n    lifesteal: {\n        name: 'Life Drain',\n        icon: '',\n        description: 'Heal 2% of damage dealt',\n        category: 'passive',\n        maxStacks: 5,\n        getDescription: (stacks) => `Heal ${(stacks || 1) * 2}% of damage dealt${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.lifesteal})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.lifesteal || 0;\n            player.lifestealPercent = stacks * 0.02; // 2% per stack\n        }\n    },\n    dodgeChance: {\n        name: 'Evasion',\n        icon: '',\n        description: '+5% dodge chance',\n        category: 'passive',\n        maxStacks: 5,\n        getDescription: (stacks) => `+${(stacks || 1) * 5}% dodge chance${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.dodgeChance})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.dodgeChance || 0;\n            // Add to existing dodge chance (Scout has base 10%)\n            const baseDodge = player.characterData?.ability === 'dodgeChance' ? 0.1 : 0;\n            player.dodgeChance = baseDodge + (stacks * 0.05); // 5% per stack\n        }\n    },\n    thorns: {\n        name: 'Thorns',\n        icon: '',\n        description: 'Reflect 15% damage to attackers',\n        category: 'passive',\n        maxStacks: 5,\n        getDescription: (stacks) => `Reflect ${(stacks || 1) * 15}% damage${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.thorns})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.thorns || 0;\n            player.thornsPercent = stacks * 0.15; // 15% per stack\n        }\n    },\n    aoeSize: {\n        name: 'Blast Radius',\n        icon: '',\n        description: '+15% explosion/area size',\n        category: 'weapon',\n        upgradeCategory: 'explosionRadius',\n        maxStacks: 10,\n        getDescription: (stacks) => `+${(stacks || 1) * 15}% AoE size${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.aoeSize})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.aoeSize || 0;\n            player.aoeSizeMultiplier = 1 + (stacks * 0.15); // 15% per stack\n            // Also update explosion radius if player has explosive weapon\n            if (player.explosionRadius) {\n                const baseRadius = player.weaponDef?.explosionRadius || 50;\n                player.explosionRadius = Math.floor(baseRadius * player.aoeSizeMultiplier);\n            }\n        }\n    },\n    knockback: {\n        name: 'Impact Force',\n        icon: '',\n        description: '+20% knockback',\n        category: 'weapon',\n        maxStacks: 5,\n        getDescription: (stacks) => `+${(stacks || 1) * 20}% knockback${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.knockback})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.knockback || 0;\n            player.knockbackMultiplier = 1 + (stacks * 0.2); // 20% per stack\n        }\n    },\n    magnetRange: {\n        name: 'Treasure Hunter',\n        icon: '',\n        description: '+25% pickup radius',\n        category: 'passive',\n        maxStacks: 10,\n        getDescription: (stacks) => `+${(stacks || 1) * 25}% pickup radius${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.magnetRange})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.magnetRange || 0;\n            const baseRadius = 30;\n            // Additive with pickupRadius upgrade\n            const pickupStacks = player.upgradeStacks?.pickupRadius || 0;\n            const pickupMultiplier = Math.pow(1.5, pickupStacks);\n            player.pickupRadius = Math.floor(baseRadius * pickupMultiplier * (1 + stacks * 0.25));\n        }\n    },\n    invulnTime: {\n        name: 'Iron Skin',\n        icon: '',\n        description: '+0.15s invulnerability frames',\n        category: 'passive',\n        maxStacks: 5,\n        getDescription: (stacks) => `+${((stacks || 1) * 0.15).toFixed(2)}s invuln${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.invulnTime})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.invulnTime || 0;\n            const baseDuration = 1.0; // Base invulnerability duration\n            player.invulnerableDuration = baseDuration + (stacks * 0.15); // 0.15s per stack\n        }\n    },\n    moveDamage: {\n        name: 'Momentum',\n        icon: '',\n        description: '+2% damage per speed stack',\n        category: 'passive',\n        maxStacks: 5,\n        getDescription: (stacks) => `+${(stacks || 1) * 2}% damage per speed stack${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.moveDamage})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.moveDamage || 0;\n            player.moveDamageBonus = stacks * 0.02; // 2% per stack\n            // Damage bonus is applied dynamically based on speed stacks in combat\n        }\n    },\n    lowHealthDmg: {\n        name: 'Desperation',\n        icon: '',\n        description: '+5% damage per 10% missing HP',\n        category: 'passive',\n        maxStacks: 5,\n        getDescription: (stacks) => `+${(stacks || 1) * 5}% damage per 10% missing HP${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.lowHealthDmg})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.lowHealthDmg || 0;\n            player.lowHealthDmgBonus = stacks * 0.05; // 5% per stack per 10% missing HP\n            // Damage bonus is applied dynamically based on HP percentage in combat\n        }\n    },\n    killSpeed: {\n        name: 'Bloodlust',\n        icon: '',\n        description: '+3% speed for 3s on kill',\n        category: 'passive',\n        maxStacks: 5,\n        getDescription: (stacks) => `+${(stacks || 1) * 3}% speed for 3s on kill${stacks > 0 ? ` (${stacks}/${UPGRADE_STACK_LIMITS.killSpeed})` : ''}`,\n        apply: (player) => {\n            const stacks = player.upgradeStacks?.killSpeed || 0;\n            player.killSpeedBonus = stacks * 0.03; // 3% per stack\n            player.killSpeedDuration = 3.0; // 3 seconds\n            player.killSpeedStacks = 0; // Active kill stacks (managed in combat)\n            player.killSpeedTimer = 0; // Timer for speed buff decay\n        }\n    }\n};\n\n// Check if upgrade is valid for player\nfunction isUpgradeValidForPlayer(upgrade, player) {\n    // Passive upgrades\n    if (upgrade.category === 'passive') {\n        // Check stack limit\n        const stacks = player.upgradeStacks?.[upgrade.key] || 0;\n        const maxStacks = upgrade.maxStacks || UPGRADE_STACK_LIMITS[upgrade.key] || 10;\n        if (stacks >= maxStacks) {\n            return false;\n        }\n        return true;\n    }\n\n    // Weapon stat upgrades\n    if (upgrade.category === 'weapon') {\n        // Check stack limit\n        const stacks = player.upgradeStacks?.[upgrade.key] || 0;\n        const maxStacks = upgrade.maxStacks || UPGRADE_STACK_LIMITS[upgrade.key] || 10;\n        if (stacks >= maxStacks) {\n            return false;\n        }\n\n        // Check weapon validity - only show upgrades for character's starting weapon\n        // (not powerup weapons, since those are temporary)\n        const startingWeapon = player.characterData?.weapon || player.weaponKey || 'pistol';\n\n        if (upgrade.validWeapons) {\n            // Must match starting weapon exactly\n            return upgrade.validWeapons.includes(startingWeapon);\n        }\n\n        if (upgrade.upgradeCategory) {\n            return isUpgradeValidForWeapon(startingWeapon, upgrade.upgradeCategory);\n        }\n\n        return true;\n    }\n\n    return true;\n}\n\n// Get random upgrades for draft (weapon-aware)\n// @param {number} count - Number of upgrades to return\n// @param {Object} player - Player object to filter valid upgrades\n// @param {SeededRandom} rng - Optional seeded RNG for multiplayer synchronization\nexport function getRandomUpgrades(count = 3, player = null, rng = null) {\n    const upgradeKeys = Object.keys(UPGRADES);\n\n    // Map upgrade keys to full upgrade objects\n    let allOptions = upgradeKeys.map(key => ({ key, ...UPGRADES[key], type: 'upgrade' }));\n\n    // Filter based on player state\n    let validOptions = allOptions;\n    if (player) {\n        validOptions = allOptions.filter(option => isUpgradeValidForPlayer(option, player));\n    }\n\n    // If not enough valid options, fall back to all options\n    if (validOptions.length < count) {\n        validOptions = allOptions;\n    }\n\n    const selected = [];\n    const used = new Set();\n\n    while (selected.length < count && selected.length < validOptions.length) {\n        // Use seeded RNG if provided (for multiplayer sync), otherwise Math.random()\n        const randomIndex = rng\n            ? rng.range(0, validOptions.length)\n            : Math.floor(Math.random() * validOptions.length);\n        const option = validOptions[randomIndex];\n        if (!used.has(option.key)) {\n            used.add(option.key);\n            selected.push(option);\n        }\n    }\n\n    return selected;\n}\n\n// Apply upgrade to player\nexport function applyUpgrade(player, upgradeKey) {\n    // Get the upgrade\n    const upgrade = UPGRADES[upgradeKey];\n    if (!upgrade) return;\n    \n    // Track upgrade\n    if (upgrade.category === 'passive') {\n        if (!player.passiveUpgrades.includes(upgradeKey)) {\n            player.passiveUpgrades.push(upgradeKey);\n        }\n    }\n    \n    // Increment stack count\n    if (!player.upgradeStacks) {\n        player.upgradeStacks = {};\n    }\n    player.upgradeStacks[upgradeKey] = (player.upgradeStacks[upgradeKey] || 0) + 1;\n    \n    // Apply upgrade (will recalculate from base values)\n    recalculateAllUpgrades(player);\n}\n\n// Recalculate all upgrades from base values\nexport function recalculateAllUpgrades(player) {\n    // Apply all upgrades in order\n    Object.keys(UPGRADES).forEach(key => {\n        if (player.upgradeStacks && player.upgradeStacks[key] > 0) {\n            UPGRADES[key].apply(player);\n        }\n    });\n}\n\n// Get upgrade description with stack count\nexport function getUpgradeDescription(upgrade, player) {\n    if (!upgrade) return '';\n    \n    if (upgrade.getDescription) {\n        const stacks = player?.upgradeStacks?.[upgrade.key] || 0;\n        return upgrade.getDescription(stacks);\n    }\n    \n    if (upgrade.weaponKey) {\n        return upgrade.getDescription ? upgrade.getDescription() : upgrade.description;\n    }\n    \n    return upgrade.description;\n}\n","/**\n * UI Configuration & Design System\n *\n * Centralized UI styling for consistent design across all game scenes\n */\n\n// =============================================================================\n// SIZE SYSTEM - Button Hierarchy\n// =============================================================================\n\nexport const UI_SIZES = {\n    // Button sizes - use these for consistent button dimensions\n    BUTTON: {\n        XS: { width: 80, height: 24 },    // Tab buttons, small actions\n        SM: { width: 120, height: 30 },   // Secondary actions, back buttons\n        MD: { width: 160, height: 36 },   // Standard actions\n        LG: { width: 280, height: 45 },   // Primary CTAs (Play, Start, Confirm)\n        XL: { width: 320, height: 50 }    // Full-width menu buttons\n    },\n    // Card sizes - use these for consistent card dimensions\n    CARD: {\n        FULL: { width: 340, height: 105 },  // Shop items, detailed cards\n        HALF: { width: 165, height: 100 },  // Character select, dual-column\n        ICON: { width: 60, height: 60 }     // Stat icons, cosmetic previews\n    },\n    // Progress bar sizes\n    PROGRESS: {\n        STANDARD: { width: 100, height: 8 },   // Upgrade progress\n        WIDE: { width: 200, height: 12 },      // XP bars, loading\n        NARROW: { width: 80, height: 6 }       // Inline stats\n    }\n};\n\n// =============================================================================\n// TYPOGRAPHY SCALE\n// =============================================================================\n\nexport const UI_TEXT_SIZES = {\n    H1: 24,              // Scene titles (was TITLE at 36, reduced for better fit)\n    H2: 18,              // Section headers\n    BODY: 16,            // Main content\n    SMALL: 14,           // Descriptions\n    TINY: 12,            // Labels, hints\n    MICRO: 11,           // Stats, fine print\n    // Legacy names (for backwards compatibility)\n    TITLE: 36,           // Scene titles (legacy)\n    HEADER: 24,          // Section headers (legacy)\n    LABEL: 18,           // Important labels (legacy)\n    BUTTON: 20,          // Button text (legacy)\n    HUD: 16              // In-game HUD (legacy)\n};\n\n// =============================================================================\n// COLORS\n// =============================================================================\n\nexport const UI_COLORS = {\n    // Primary Actions\n    PRIMARY: [80, 180, 80],           // Green - Start, Confirm\n    PRIMARY_HOVER: [120, 220, 120],\n\n    // Secondary Actions\n    SECONDARY: [80, 120, 200],        // Blue - Info, Navigate\n    SECONDARY_HOVER: [120, 160, 255],\n\n    // Tertiary Actions\n    TERTIARY: [180, 80, 180],         // Purple - Special\n    TERTIARY_HOVER: [220, 120, 220],\n\n    // Shop/Currency\n    GOLD: [200, 150, 50],             // Gold - Shop, Currency\n    GOLD_HOVER: [240, 190, 90],\n\n    // Neutral\n    NEUTRAL: [100, 100, 120],         // Gray - Settings, Cancel\n    NEUTRAL_HOVER: [140, 140, 160],\n\n    // Destructive\n    DANGER: [180, 50, 50],            // Red - Quit, Delete\n    DANGER_HOVER: [220, 90, 90],\n\n    // Status Colors\n    SUCCESS: [100, 255, 100],         // Green - Success messages\n    WARNING: [255, 200, 100],         // Orange - Warnings\n    ERROR: [255, 100, 100],           // Red - Errors\n    INFO: [100, 200, 255],            // Blue - Info messages\n\n    // Text Colors\n    TEXT_PRIMARY: [255, 255, 255],    // White - Primary text\n    TEXT_SECONDARY: [200, 200, 200],  // Light gray - Secondary text\n    TEXT_TERTIARY: [150, 150, 150],   // Medium gray - Tertiary text\n    TEXT_DISABLED: [100, 100, 100],   // Dark gray - Disabled text\n\n    // Background Colors\n    BG_DARK: [20, 20, 30],            // Dark background\n    BG_MEDIUM: [40, 40, 50],          // Medium background\n    BG_LIGHT: [60, 60, 70],           // Light background\n    BG_DISABLED: [60, 60, 60],        // Disabled background\n\n    // UI Element Colors\n    BORDER: [150, 180, 255],          // Standard border\n    BORDER_HOVER: [255, 255, 255],    // Hovered border\n    BORDER_ACTIVE: [100, 200, 255],   // Active border\n\n    // HUD Colors\n    HEALTH_FULL: [100, 255, 100],     // Green health\n    HEALTH_MEDIUM: [255, 255, 100],   // Yellow health\n    HEALTH_LOW: [255, 100, 100],      // Red health\n    XP_BAR: [100, 200, 255],          // Blue XP bar\n\n    // Boss/Enemy Colors\n    BOSS_NAME: [255, 200, 100],       // Gold for boss names\n    MINIBOSS_NAME: [255, 150, 100],   // Orange for miniboss names\n};\n\n// =============================================================================\n// SPACING - Standard spacing scale\n// =============================================================================\n\nexport const UI_SPACING = {\n    // Standard spacing scale\n    XS: 4,                    // Extra small spacing\n    SM: 8,                    // Small spacing\n    MD: 16,                   // Medium spacing\n    LG: 24,                   // Large spacing\n    XL: 32,                   // Extra large spacing\n    // Legacy spacing (for backwards compatibility)\n    BUTTON_VERTICAL: 65,      // Vertical spacing between menu buttons\n    BUTTON_HORIZONTAL: 20,    // Horizontal spacing between buttons\n    ITEM_SPACING: 50,         // Spacing between list items\n    SECTION_SPACING: 100,     // Spacing between major sections\n    CONTENT_MARGIN: 40,       // Margin from screen edges\n    PADDING_SMALL: 10,        // Small padding\n    PADDING_MEDIUM: 20,       // Medium padding\n    PADDING_LARGE: 40         // Large padding\n};\n\n// =============================================================================\n// BUTTON DEFAULTS\n// =============================================================================\n\nexport const UI_BUTTON = {\n    WIDTH: 300,\n    HEIGHT: 50,\n    BORDER_WIDTH: 2,\n    HOVER_SCALE: 1.05,\n    TRANSITION_TIME: 0.15\n};\n\n// =============================================================================\n// TERMINOLOGY (Standardized)\n// =============================================================================\n\nexport const UI_TERMS = {\n    HEALTH: 'HP',             // Use \"HP\" not \"Health\"\n    EXPERIENCE: 'XP',         // Use \"XP\" not \"Experience\"\n    LEVEL: 'Level',           // Capitalize\n    FLOOR: 'Floor',           // Capitalize\n    ROOM: 'Room',             // Capitalize\n    CURRENCY: 'Silver',       // Default currency name (can be overridden)\n    DAMAGE: 'Damage',\n    SPEED: 'Speed',\n    BOSS: 'BOSS',             // ALL CAPS for emphasis\n    MINIBOSS: 'MINIBOSS'\n};\n\n// =============================================================================\n// TEXT FORMATTING FUNCTIONS\n// =============================================================================\n\n/**\n * Format button text (ALL CAPS)\n */\nexport function formatButtonText(text) {\n    return text.toUpperCase();\n}\n\n/**\n * Format section header (Title Case)\n */\nexport function formatHeader(text) {\n    return text.split(' ')\n        .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n        .join(' ');\n}\n\n/**\n * Format status text (ALL CAPS)\n */\nexport function formatStatus(text) {\n    return text.toUpperCase();\n}\n\n/**\n * Format stat label (Sentence case)\n */\nexport function formatStatLabel(text) {\n    return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();\n}\n\n/**\n * Format floor and room display\n */\nexport function formatFloorRoom(floor, room, abbreviated = false) {\n    if (abbreviated) {\n        return `F${floor} R${room}`;\n    }\n    return `Floor ${floor}, Room ${room}`;\n}\n\n/**\n * Format health display\n */\nexport function formatHealth(current, max) {\n    return `${UI_TERMS.HEALTH}: ${current}/${max}`;\n}\n\n/**\n * Format XP display\n */\nexport function formatXP(current, max) {\n    return `${current}/${max}`;\n}\n\n// =============================================================================\n// Z-LAYER SYSTEM\n// =============================================================================\n\nexport const UI_Z_LAYERS = {\n    BACKGROUND: 0,\n    GAME_ENTITIES: 10,\n    PARTICLES: 50,\n    UI_BACKGROUND: 100,\n    UI_ELEMENTS: 200,\n    UI_TEXT: 300,\n    OVERLAY: 500,\n    MODAL: 1500,\n    TOOLTIP: 2000,\n    PAUSE_MENU: 2001,\n    DEBUG: 9999\n};\n\n// =============================================================================\n// ANIMATION TIMINGS\n// =============================================================================\n\nexport const UI_ANIMATIONS = {\n    FAST: 0.1,\n    NORMAL: 0.2,\n    SLOW: 0.3,\n    PULSE_SPEED: 2,\n    WAVE_SPEED: 1\n};\n\n// =============================================================================\n// CURRENCY SYMBOLS (for rotating display)\n// =============================================================================\n\nexport const CURRENCY_SYMBOLS = ['$', '', '', '', '', '', '', ''];\n\n/**\n * Create background particle effects for menu scenes\n * @param {Object} k - Kaplay instance\n * @param {Object} options - Configuration options\n * @param {number} options.patternCount - Number of pulsing patterns (default: 12)\n * @param {number} options.particleCount - Number of falling particles (default: 20)\n * @param {boolean} options.includeCursorFollowers - Include cursor-following ships (default: false)\n */\nexport function createMenuParticles(k, options = {}) {\n    const {\n        patternCount = 12,\n        particleCount = 20,\n        includeCursorFollowers = false\n    } = options;\n\n    // Pulsing geometric ASCII patterns\n    const patterns = ['', '', '', '', '', '', '', ''];\n    for (let i = 0; i < patternCount; i++) {\n        const pattern = k.add([\n            k.text(patterns[Math.floor(Math.random() * patterns.length)], { size: 20 }),\n            k.pos(Math.random() * k.width(), Math.random() * k.height()),\n            k.color(...UI_COLORS.BG_LIGHT),\n            k.opacity(0.15),\n            k.scale(1),\n            k.z(UI_Z_LAYERS.PARTICLES)\n        ]);\n\n        pattern.pulseTime = Math.random() * Math.PI * 2;\n        pattern.pulseSpeed = 1 + Math.random() * 2;\n\n        pattern.onUpdate(() => {\n            pattern.pulseTime += k.dt() * pattern.pulseSpeed;\n            const scale = 0.8 + Math.sin(pattern.pulseTime) * 0.3;\n            pattern.scale = k.vec2(scale, scale);\n            pattern.opacity = 0.1 + Math.abs(Math.sin(pattern.pulseTime)) * 0.15;\n        });\n    }\n\n    // Falling particles\n    for (let i = 0; i < particleCount; i++) {\n        const particle = k.add([\n            k.text(['*', '+', '', ''][Math.floor(Math.random() * 4)], { size: 12 }),\n            k.pos(Math.random() * k.width(), Math.random() * k.height()),\n            k.color(...UI_COLORS.BG_LIGHT),\n            k.opacity(0.3 + Math.random() * 0.3),\n            k.z(UI_Z_LAYERS.PARTICLES)\n        ]);\n\n        particle.speed = 10 + Math.random() * 20;\n        particle.onUpdate(() => {\n            particle.pos.y += particle.speed * k.dt();\n            if (particle.pos.y > k.height()) {\n                particle.pos.y = 0;\n                particle.pos.x = Math.random() * k.width();\n            }\n        });\n    }\n\n    // Cursor-following ships/asteroids (optional easter egg)\n    if (includeCursorFollowers) {\n        const cursorFollowers = [];\n        k.loop(5, () => {\n            if (cursorFollowers.length < 3 && Math.random() < 0.3) {\n                const shipChars = ['', '', '', '', '', '', ''];\n                const ship = k.add([\n                    k.text(shipChars[Math.floor(Math.random() * shipChars.length)], { size: 16 }),\n                    k.pos(Math.random() * k.width(), Math.random() * k.height()),\n                    k.color(100 + Math.random() * 100, 100 + Math.random() * 100, 200 + Math.random() * 55),\n                    k.opacity(0.4 + Math.random() * 0.2),\n                    k.rotate(Math.random() * 360),\n                    k.z(UI_Z_LAYERS.PARTICLES)\n                ]);\n\n                ship.followSpeed = 20 + Math.random() * 30;\n                ship.rotationSpeed = 50 + Math.random() * 100;\n                ship.lifetime = 15 + Math.random() * 10;\n\n                ship.onUpdate(() => {\n                    // Follow mouse cursor\n                    const mousePos = k.mousePos();\n                    const dir = mousePos.sub(ship.pos);\n                    const dist = dir.len();\n\n                    if (dist > 5) {\n                        const normalized = dir.scale(1 / dist);\n                        ship.pos = ship.pos.add(normalized.scale(ship.followSpeed * k.dt()));\n                    }\n\n                    // Rotate slowly\n                    ship.angle += ship.rotationSpeed * k.dt();\n\n                    // Fade out over lifetime\n                    ship.lifetime -= k.dt();\n                    if (ship.lifetime <= 0) {\n                        k.destroy(ship);\n                        const index = cursorFollowers.indexOf(ship);\n                        if (index > -1) cursorFollowers.splice(index, 1);\n                    }\n                });\n\n                cursorFollowers.push(ship);\n            }\n        });\n    }\n}\n\n/**\n * ASCII block art definitions for sub-menu titles\n * Each title is rendered as multi-line ASCII art using block characters\n */\nconst ASCII_TITLES = {\n    'CONTESTANTS': [\n        '           ',\n        '    ',\n        '                              ',\n        '                            ',\n        '                      ',\n        '                           '\n    ],\n    'MERCH': [\n        '       ',\n        '   ',\n        '       ',\n        '       ',\n        '      ',\n        '          '\n    ],\n    'OPTIONS': [\n        '        ',\n        '  ',\n        '             ',\n        '             ',\n        '            ',\n        '                 '\n    ],\n    'RATINGS AND RECORDS': [\n        '                           ',\n        '            ',\n        '                               ',\n        '                              ',\n        '                         ',\n        '                                  '\n    ],\n    'PROFILE': [\n        '         ',\n        '     ',\n        '            ',\n        '             ',\n        '            ',\n        '              '\n    ]\n};\n\n/**\n * Create an animated ASCII block art title with rainbow wave effect (similar to main menu title)\n * Uses multi-line ASCII art constructed from block characters\n * @param {Object} k - Kaplay instance\n * @param {string} text - Title text (will be converted to uppercase and matched to ASCII art)\n * @param {number} x - X position (center)\n * @param {number} y - Y position (center of title)\n * @param {number} fontSize - Font size (default: 8, smaller than main menu's 10)\n * @returns {Array} - Array of title line objects\n */\nexport function createAnimatedTitle(k, text, x, y, fontSize = 8) {\n    // Helper function to convert HSL to RGB (same as main menu)\n    function hslToRgb(h, s, l) {\n        s /= 100;\n        l /= 100;\n        const c = (1 - Math.abs(2 * l - 1)) * s;\n        const x = c * (1 - Math.abs((h / 60) % 2 - 1));\n        const m = l - c / 2;\n        let r = 0, g = 0, b = 0;\n        if (h >= 0 && h < 60) { r = c; g = x; b = 0; }\n        else if (h >= 60 && h < 120) { r = x; g = c; b = 0; }\n        else if (h >= 120 && h < 180) { r = 0; g = c; b = x; }\n        else if (h >= 180 && h < 240) { r = 0; g = x; b = c; }\n        else if (h >= 240 && h < 300) { r = x; g = 0; b = c; }\n        else if (h >= 300 && h < 360) { r = c; g = 0; b = x; }\n        return [\n            Math.round((r + m) * 255),\n            Math.round((g + m) * 255),\n            Math.round((b + m) * 255)\n        ];\n    }\n\n    // Get ASCII art for the title (use uppercase key)\n    const titleKey = formatButtonText(text);\n    const asciiTitle = ASCII_TITLES[titleKey];\n    \n    // Fallback to plain text if ASCII art not found\n    if (!asciiTitle) {\n        console.warn(`ASCII art not found for \"${titleKey}\", using plain text`);\n        const title = k.add([\n            k.text(titleKey, { size: fontSize * 2, font: 'monospace' }),\n            k.pos(x, y),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT),\n            'animatedTitle'\n        ]);\n        \n        // Apply same animation\n        let colorTime = 0;\n        title.onUpdate(() => {\n            colorTime += k.dt();\n            const hue = (colorTime * 50) % 360;\n            const color = hslToRgb(hue, 80, 60);\n            title.color = k.rgb(...color);\n            const offset = Math.sin(colorTime * 2) * 2;\n            title.pos.y = y + offset;\n        });\n        return [title];\n    }\n\n    // Create animated ASCII title (same structure as main menu)\n    const titleLines = [];\n    const lineSpacing = 10; // Slightly tighter than main menu's 12\n    const startY = y - (asciiTitle.length * lineSpacing) / 2;\n\n    asciiTitle.forEach((line, index) => {\n        const titleLine = k.add([\n            k.text(line, { size: fontSize, font: 'monospace' }),\n            k.pos(x, startY + index * lineSpacing),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT),\n            'animatedTitle'\n        ]);\n        titleLines.push(titleLine);\n    });\n\n    // Animated color wave effect (same as main menu)\n    let colorTime = 0;\n    k.onUpdate(() => {\n        colorTime += k.dt();\n        titleLines.forEach((line, index) => {\n            // Rainbow wave effect (same as main menu)\n            const hue = (colorTime * 50 + index * 20) % 360;\n            const color = hslToRgb(hue, 80, 60);\n            line.color = k.rgb(...color);\n\n            // Subtle floating animation (same as main menu)\n            const offset = Math.sin(colorTime * 2 + index * 0.3) * 2;\n            line.pos.y = startY + index * lineSpacing + offset;\n\n            // Glitch effect (random chance, same as main menu)\n            if (Math.random() < 0.001) {\n                line.pos.x = x + (Math.random() - 0.5) * 10;\n                k.wait(0.1, () => {\n                    if (line.exists()) {\n                        line.pos.x = x;\n                    }\n                });\n            }\n        });\n    });\n\n    return titleLines;\n}\n\n/**\n * Create a standardized credit indicator with rotating currency symbols\n * @param {Object} k - Kaplay instance\n * @param {number} currency - Current currency amount\n * @param {string} currencyName - Name of currency (e.g., \"Credits\")\n * @returns {Object} - Object with panel, icon, and text elements for updates\n */\nexport function createCreditIndicator(k, currency, currencyName) {\n    // Currency symbols rotate with random duration between 2-5 seconds\n    const getRandomInterval = () => 2.0 + Math.random() * 3.0; // Random between 2-5 seconds\n    \n    // Create measurement text to calculate panel width (with symbol placeholder, no currency name)\n    const measurementText = k.add([\n        k.text(`${CURRENCY_SYMBOLS[0]}: ${currency}`, { size: UI_TEXT_SIZES.LABEL }),\n        k.pos(0, 0),\n        k.opacity(0),\n        k.fixed()\n    ]);\n    \n    const panelWidth = measurementText.width + 30;\n    const panelHeight = 40;\n    \n    k.destroy(measurementText);\n    \n    // Panel background\n    const panel = k.add([\n        k.rect(panelWidth, panelHeight),\n        k.pos(k.width() - 20, 20),\n        k.anchor('topright'),\n        k.color(...UI_COLORS.BG_MEDIUM),\n        k.outline(2, k.rgb(...UI_COLORS.GOLD)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_BACKGROUND)\n    ]);\n    \n    // Currency text with rotating symbol only (no currency name)\n    const text = k.add([\n        k.text(`${CURRENCY_SYMBOLS[0]}: ${currency}`, { size: UI_TEXT_SIZES.LABEL }),\n        k.pos(k.width() - 20 - panelWidth / 2, 40),\n        k.anchor('center'),\n        k.color(...UI_COLORS.GOLD),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_TEXT)\n    ]);\n    \n    // Store rotation state and current currency on text\n    text.symbolIndex = 0;\n    text.timeSinceLastChange = 0;\n    text.currentCurrency = currency;\n    text.symbolChangeInterval = getRandomInterval(); // Initialize with random interval\n    \n    // Update currency amount\n    const updateCurrency = (newCurrency) => {\n        text.currentCurrency = newCurrency;\n        text.text = `${CURRENCY_SYMBOLS[text.symbolIndex]}: ${newCurrency}`;\n        // Recalculate panel width if needed\n        const newWidth = text.width + 30;\n        if (Math.abs(newWidth - panelWidth) > 10) {\n            panel.width = newWidth;\n            text.pos.x = k.width() - 20 - newWidth / 2;\n        }\n    };\n    \n    // Add update handler for rotating symbols\n    text.onUpdate(() => {\n        text.timeSinceLastChange += k.dt();\n        if (text.timeSinceLastChange >= text.symbolChangeInterval) {\n            text.timeSinceLastChange = 0;\n            text.symbolIndex = (text.symbolIndex + 1) % CURRENCY_SYMBOLS.length;\n            text.text = `${CURRENCY_SYMBOLS[text.symbolIndex]}: ${text.currentCurrency}`;\n            // Get new random interval for next rotation\n            text.symbolChangeInterval = getRandomInterval();\n        }\n    });\n    \n    return {\n        panel,\n        text,\n        updateCurrency\n    };\n}\n\n// =============================================================================\n// STYLED TEXT HELPER\n// =============================================================================\n\n/**\n * Create styled text using the typography scale\n * @param {Object} k - Kaplay instance\n * @param {string} content - Text content\n * @param {Object} options - Configuration options\n * @param {string} options.level - Typography level: 'H1', 'H2', 'BODY', 'SMALL', 'TINY', 'MICRO'\n * @param {number} options.x - X position\n * @param {number} options.y - Y position\n * @param {string} options.anchor - Anchor point (default: 'center')\n * @param {Array} options.color - RGB color array (default: TEXT_PRIMARY)\n * @returns {Object} - The text game object\n */\nexport function createStyledText(k, content, options = {}) {\n    const {\n        level = 'BODY',\n        x = 0,\n        y = 0,\n        anchor = 'center',\n        color = UI_COLORS.TEXT_PRIMARY\n    } = options;\n\n    const size = UI_TEXT_SIZES[level] || UI_TEXT_SIZES.BODY;\n\n    return k.add([\n        k.text(content, { size }),\n        k.pos(x, y),\n        k.anchor(anchor),\n        k.color(...color),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_TEXT)\n    ]);\n}\n\n// =============================================================================\n// PROGRESS BAR HELPER\n// =============================================================================\n\n/**\n * Create a progress bar\n * @param {Object} k - Kaplay instance\n * @param {Object} options - Configuration options\n * @param {number} options.x - X position\n * @param {number} options.y - Y position\n * @param {number} options.width - Bar width (default: 100)\n * @param {number} options.height - Bar height (default: 8)\n * @param {number} options.value - Current value (0-1)\n * @param {Array} options.fillColor - RGB color for filled portion\n * @param {Array} options.bgColor - RGB color for background\n * @returns {Object} - Object with bg, fill elements and update function\n */\nexport function createProgressBar(k, options = {}) {\n    const {\n        x = 0,\n        y = 0,\n        width = UI_SIZES.PROGRESS.STANDARD.width,\n        height = UI_SIZES.PROGRESS.STANDARD.height,\n        value = 0,\n        fillColor = UI_COLORS.PRIMARY,\n        bgColor = UI_COLORS.BG_DARK\n    } = options;\n\n    const clampedValue = Math.max(0, Math.min(1, value));\n\n    // Background\n    const bg = k.add([\n        k.rect(width, height),\n        k.pos(x, y),\n        k.anchor('topleft'),\n        k.color(...bgColor),\n        k.outline(1, k.rgb(60, 60, 80)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n    ]);\n\n    // Fill\n    const fillWidth = Math.max(0, (width - 2) * clampedValue);\n    const fill = k.add([\n        k.rect(fillWidth, height - 2),\n        k.pos(x + 1, y + 1),\n        k.anchor('topleft'),\n        k.color(...fillColor),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\n    ]);\n\n    // Update function\n    const updateValue = (newValue) => {\n        const clamped = Math.max(0, Math.min(1, newValue));\n        fill.width = Math.max(0, (width - 2) * clamped);\n    };\n\n    return {\n        bg,\n        fill,\n        updateValue\n    };\n}","/**\n * Toast Notification System\n * Displays non-blocking notifications in the top-right corner of the screen\n */\n\nimport { UI_Z_LAYERS, UI_COLORS } from '../config/uiConfig.js';\nimport { ACHIEVEMENT_COLORS } from '../data/achievements.js';\n\n// Toast queue and state\nconst toastState = {\n    queue: [],\n    activeToasts: [],\n    k: null,\n    maxActiveToasts: 3,\n    toastWidth: 300,\n    toastHeight: 80,\n    toastMargin: 10,\n    animationDuration: 0.3,\n    displayDuration: 3\n};\n\n/**\n * Initialize the toast system with a Kaplay instance\n * @param {Object} k - Kaplay instance\n */\nexport function initToastSystem(k) {\n    toastState.k = k;\n    toastState.queue = [];\n    toastState.activeToasts = [];\n}\n\n/**\n * Show a toast notification\n * @param {Object} options - Toast options\n * @param {string} options.title - Toast title\n * @param {string} options.message - Toast message\n * @param {string} options.icon - Icon character to display\n * @param {Array} options.iconColor - RGB color array for icon\n * @param {string} options.type - Toast type ('achievement', 'info', 'success', 'error')\n * @param {number} options.duration - Display duration in seconds (default: 3)\n */\nexport function showToast(options) {\n    const k = toastState.k;\n    if (!k) {\n        console.warn('Toast system not initialized');\n        return;\n    }\n\n    const toast = {\n        title: options.title || 'Notification',\n        message: options.message || '',\n        icon: options.icon || '!',\n        iconColor: options.iconColor || UI_COLORS.TEXT_PRIMARY,\n        type: options.type || 'info',\n        duration: options.duration || toastState.displayDuration\n    };\n\n    toastState.queue.push(toast);\n    processQueue();\n}\n\n/**\n * Show an achievement unlock toast\n * @param {Object} achievement - Achievement object\n */\nexport function showAchievementToast(achievement) {\n    const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\n\n    // Determine title based on difficulty\n    let title = ' Achievement Unlocked!';\n    if (achievement.difficulty === 'challenge') {\n        title = ' Challenge Complete!';\n    } else if (achievement.difficulty === 'benchmark') {\n        title = ' Milestone Reached!';\n    }\n\n    showToast({\n        title: title,\n        message: `${achievement.name}\\n${achievement.description}`,\n        icon: achievement.icon,\n        iconColor: difficultyColor,\n        type: 'achievement',\n        duration: 5,\n        difficulty: achievement.difficulty\n    });\n}\n\n/**\n * Show a multiplayer achievement toast (when another player unlocks)\n * @param {string} playerName - Name of the player who unlocked\n * @param {Object} achievement - Achievement object\n */\nexport function showMultiplayerAchievementToast(playerName, achievement) {\n    const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\n\n    showToast({\n        title: `${playerName} unlocked:`,\n        message: achievement.name,\n        icon: achievement.icon,\n        iconColor: difficultyColor,\n        type: 'achievement',\n        duration: 3\n    });\n}\n\n/**\n * Process the toast queue and display toasts\n */\nfunction processQueue() {\n    const k = toastState.k;\n    if (!k) return;\n\n    // Check if we can show more toasts\n    while (toastState.queue.length > 0 && toastState.activeToasts.length < toastState.maxActiveToasts) {\n        const toastData = toastState.queue.shift();\n        createToastUI(toastData);\n    }\n}\n\n/**\n * Create the UI elements for a toast\n * @param {Object} toastData - Toast data\n */\nfunction createToastUI(toastData) {\n    const k = toastState.k;\n    if (!k) return;\n\n    const startX = k.width() + toastState.toastWidth; // Start off-screen right\n    const targetX = k.width() - toastState.toastMargin - toastState.toastWidth / 2;\n    const toastIndex = toastState.activeToasts.length;\n    const y = toastState.toastMargin + toastIndex * (toastState.toastHeight + toastState.toastMargin) + toastState.toastHeight / 2 + 20;\n\n    // Get border color based on type\n    let borderColor = UI_COLORS.BORDER;\n    let bgColor = [...UI_COLORS.BG_MEDIUM];\n    let borderWidth = 2;\n    if (toastData.type === 'achievement') {\n        borderColor = toastData.iconColor;\n        bgColor = [35, 30, 45];\n        borderWidth = 3; // Thicker border for achievements\n    } else if (toastData.type === 'success') {\n        borderColor = UI_COLORS.SUCCESS;\n    } else if (toastData.type === 'error') {\n        borderColor = UI_COLORS.ERROR;\n    }\n\n    // Toast container\n    const container = k.add([\n        k.rect(toastState.toastWidth, toastState.toastHeight),\n        k.pos(startX, y),\n        k.anchor('center'),\n        k.color(...bgColor),\n        k.outline(borderWidth, k.rgb(...borderColor)),\n        k.opacity(0.95),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.TOOLTIP),\n        'toast'\n    ]);\n\n    // Add glow pulse effect for achievement toasts\n    if (toastData.type === 'achievement') {\n        let glowTime = 0;\n        container.onUpdate(() => {\n            glowTime += k.dt();\n            // Subtle pulse on the border brightness\n            const pulse = Math.sin(glowTime * 4) * 0.2 + 0.8;\n            const r = Math.min(255, borderColor[0] * pulse);\n            const g = Math.min(255, borderColor[1] * pulse);\n            const b = Math.min(255, borderColor[2] * pulse);\n            container.outline.color = k.rgb(r, g, b);\n        });\n    }\n\n    // Icon background\n    const iconBg = k.add([\n        k.rect(50, toastState.toastHeight - 10),\n        k.pos(startX - toastState.toastWidth / 2 + 30, y),\n        k.anchor('center'),\n        k.color(...bgColor),\n        k.opacity(0.5),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.TOOLTIP + 1),\n        'toast'\n    ]);\n\n    // Icon (larger for emoji icons)\n    const iconSize = toastData.type === 'achievement' ? 32 : 28;\n    const icon = k.add([\n        k.text(toastData.icon, { size: iconSize }),\n        k.pos(startX - toastState.toastWidth / 2 + 30, y),\n        k.anchor('center'),\n        k.color(...toastData.iconColor),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.TOOLTIP + 2),\n        'toast'\n    ]);\n\n    // Add bounce effect to icon for achievements\n    if (toastData.type === 'achievement') {\n        let iconTime = 0;\n        const baseY = y;\n        icon.onUpdate(() => {\n            iconTime += k.dt();\n            // Gentle bounce effect\n            const bounce = Math.abs(Math.sin(iconTime * 3)) * 3;\n            icon.pos.y = baseY - bounce;\n        });\n    }\n\n    // Title\n    const title = k.add([\n        k.text(toastData.title, { size: 14 }),\n        k.pos(startX - toastState.toastWidth / 2 + 65, y - 20),\n        k.anchor('left'),\n        k.color(...(toastData.type === 'achievement' ? [255, 220, 100] : UI_COLORS.TEXT_PRIMARY)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.TOOLTIP + 2),\n        'toast'\n    ]);\n\n    // Message (support multi-line)\n    const messageLines = toastData.message.split('\\n');\n    const messageElements = [];\n    messageLines.forEach((line, index) => {\n        const msg = k.add([\n            k.text(line, { size: 12, width: toastState.toastWidth - 80 }),\n            k.pos(startX - toastState.toastWidth / 2 + 65, y - 5 + index * 16),\n            k.anchor('left'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.TOOLTIP + 2),\n            'toast'\n        ]);\n        messageElements.push(msg);\n    });\n\n    // Store all elements\n    const toastElements = {\n        container,\n        iconBg,\n        icon,\n        title,\n        messages: messageElements,\n        startX,\n        targetX,\n        y,\n        state: 'entering', // 'entering', 'visible', 'exiting', 'done'\n        timer: 0,\n        data: toastData\n    };\n\n    toastState.activeToasts.push(toastElements);\n\n    // Animation update handler\n    const updateHandler = k.onUpdate(() => {\n        if (toastElements.state === 'done') {\n            updateHandler.cancel();\n            return;\n        }\n\n        toastElements.timer += k.dt();\n\n        if (toastElements.state === 'entering') {\n            // Slide in animation\n            const progress = Math.min(toastElements.timer / toastState.animationDuration, 1);\n            const easedProgress = easeOutCubic(progress);\n            const currentX = lerp(toastElements.startX, toastElements.targetX, easedProgress);\n\n            updateToastPositionX(toastElements, currentX);\n\n            if (progress >= 1) {\n                toastElements.state = 'visible';\n                toastElements.timer = 0;\n            }\n        } else if (toastElements.state === 'visible') {\n            // Display duration\n            if (toastElements.timer >= toastElements.data.duration) {\n                toastElements.state = 'exiting';\n                toastElements.timer = 0;\n            }\n        } else if (toastElements.state === 'exiting') {\n            // Slide out animation\n            const progress = Math.min(toastElements.timer / toastState.animationDuration, 1);\n            const easedProgress = easeInCubic(progress);\n            const exitX = k.width() + toastState.toastWidth;\n            const currentX = lerp(toastElements.targetX, exitX, easedProgress);\n\n            updateToastPositionX(toastElements, currentX);\n\n            // Fade out\n            const opacity = 1 - progress;\n            toastElements.container.opacity = opacity * 0.95;\n            toastElements.iconBg.opacity = opacity * 0.5;\n            toastElements.icon.opacity = opacity;\n            toastElements.title.opacity = opacity;\n            toastElements.messages.forEach(msg => msg.opacity = opacity);\n\n            if (progress >= 1) {\n                toastElements.state = 'done';\n                destroyToast(toastElements);\n            }\n        }\n    });\n\n    toastElements.updateHandler = updateHandler;\n}\n\n/**\n * Update toast position on X axis\n * @param {Object} toastElements - Toast elements object\n * @param {number} x - New X position\n */\nfunction updateToastPositionX(toastElements, x) {\n    const offset = x - toastElements.container.pos.x;\n    toastElements.container.pos.x = x;\n    toastElements.iconBg.pos.x += offset;\n    toastElements.icon.pos.x += offset;\n    toastElements.title.pos.x += offset;\n    toastElements.messages.forEach(msg => msg.pos.x += offset);\n}\n\n/**\n * Destroy a toast and its elements\n * @param {Object} toastElements - Toast elements object\n */\nfunction destroyToast(toastElements) {\n    const k = toastState.k;\n    if (!k) return;\n\n    // Cancel update handler\n    if (toastElements.updateHandler) {\n        toastElements.updateHandler.cancel();\n    }\n\n    // Destroy all elements\n    if (toastElements.container.exists()) k.destroy(toastElements.container);\n    if (toastElements.iconBg.exists()) k.destroy(toastElements.iconBg);\n    if (toastElements.icon.exists()) k.destroy(toastElements.icon);\n    if (toastElements.title.exists()) k.destroy(toastElements.title);\n    toastElements.messages.forEach(msg => {\n        if (msg.exists()) k.destroy(msg);\n    });\n\n    // Remove from active toasts\n    const index = toastState.activeToasts.indexOf(toastElements);\n    if (index > -1) {\n        toastState.activeToasts.splice(index, 1);\n    }\n\n    // Reposition remaining toasts\n    repositionActiveToasts();\n\n    // Process queue\n    processQueue();\n}\n\n/**\n * Reposition active toasts after one is removed\n */\nfunction repositionActiveToasts() {\n    toastState.activeToasts.forEach((toast, index) => {\n        if (toast.state === 'visible' || toast.state === 'entering') {\n            const newY = toastState.toastMargin + index * (toastState.toastHeight + toastState.toastMargin) + toastState.toastHeight / 2 + 20;\n\n            // Animate to new position\n            const oldY = toast.container.pos.y;\n            const offsetY = newY - oldY;\n\n            toast.container.pos.y = newY;\n            toast.iconBg.pos.y += offsetY;\n            toast.icon.pos.y += offsetY;\n            toast.title.pos.y += offsetY;\n            toast.messages.forEach((msg, msgIndex) => {\n                msg.pos.y += offsetY;\n            });\n            toast.y = newY;\n        }\n    });\n}\n\n/**\n * Clear all active toasts\n */\nexport function clearAllToasts() {\n    const k = toastState.k;\n    if (!k) return;\n\n    // Destroy all active toasts\n    [...toastState.activeToasts].forEach(toast => {\n        destroyToast(toast);\n    });\n\n    // Clear queue\n    toastState.queue = [];\n}\n\n/**\n * Clean up toast system (call on scene change)\n */\nexport function cleanupToastSystem() {\n    clearAllToasts();\n    toastState.k = null;\n}\n\n// Easing functions\nfunction easeOutCubic(t) {\n    return 1 - Math.pow(1 - t, 3);\n}\n\nfunction easeInCubic(t) {\n    return t * t * t;\n}\n\nfunction lerp(start, end, t) {\n    return start + (end - start) * t;\n}\n","/**\n * Multiplayer Game System\n * Handles game state synchronization for multiplayer\n */\n\nimport { getParty, getPartySize, getLocalPlayer, clearPartyCallbacks } from './partySystem.js';\nimport { broadcast, sendToHost, sendToPeer, onMessage, offMessage, getNetworkInfo } from './networkSystem.js';\nimport { createEnemy } from '../entities/enemy.js';\nimport { createBoss } from '../entities/boss.js';\nimport { createXPPickup, createCurrencyPickup, getRandomCurrencyIcon } from '../entities/pickup.js';\nimport { SeededRandom, createSeed } from '../utils/seededRandom.js';\nimport { initConnectionQuality } from './connectionQuality.js';\nimport { applyUpgrade, recalculateAllUpgrades } from './upgrades.js';\nimport { createProjectile } from '../entities/projectile.js';\nimport { getPermanentUpgradeLevel, addCurrency } from './metaProgression.js';\nimport { ACHIEVEMENTS } from '../data/achievements.js';\nimport { showMultiplayerAchievementToast, initToastSystem } from './toastNotifications.js';\n\n// Debug flag - set to true to enable verbose multiplayer logging\nconst MP_DEBUG = false;\n\n// Multiplayer game state\nconst mpGame = {\n    isActive: false,\n    players: new Map(), // Map of slotIndex -> player entity\n    localPlayerSlot: 0, // Which slot is the local player\n    lastSyncTime: 0,\n    syncInterval: 1 / 15, // 15 updates per second (reduced from 20 for better performance)\n    lastResyncTime: 0,\n    resyncInterval: 5.0, // Re-sync check every 5 seconds (desync detection)\n    inputBuffer: [], // Store inputs to send to host\n    isHost: false,\n    // Entity tracking (host only)\n    enemies: new Map(), // Map of entityId -> enemy entity\n    projectiles: new Map(), // Map of entityId -> projectile entity\n    pickups: new Map(), // Map of entityId -> pickup entity\n    nextEntityId: 1, // Auto-incrementing ID for entities\n    // Kaplay instance reference\n    k: null,\n    // Seeded RNG for deterministic world generation\n    gameSeed: 0, // Base seed for this game session\n    floorRng: null, // SeededRandom instance for floor generation\n    roomRng: null, // SeededRandom instance for room generation\n    currentFloor: 1, // Track current floor for seed generation\n    currentRoom: { x: 0, y: 0 }, // Track current room for seed generation\n    pendingXP: 0, // XP accumulated while player was in upgrade draft screen\n    onGameSeedCallback: null // Callback for when game_seed is received (clients only)\n};\n\n/**\n * Initialize multiplayer game session\n * @param {boolean} isHost - Whether this client is the host\n * @param {number} localSlot - Local player's slot index\n * @param {Object} kaplayInstance - Kaplay instance for creating entities\n * @param {number} gameSeed - Optional seed for deterministic generation (host generates, broadcasts to clients)\n */\nexport function initMultiplayerGame(isHost, localSlot = 0, kaplayInstance = null, gameSeed = null) {\n    mpGame.isActive = true;\n    mpGame.isHost = isHost;\n    mpGame.localPlayerSlot = localSlot;\n    mpGame.players.clear();\n    mpGame.inputBuffer = [];\n    mpGame.lastSyncTime = 0;\n    mpGame.k = kaplayInstance;\n\n    // Initialize connection quality monitoring (registers ping/pong handlers)\n    initConnectionQuality();\n\n    // Clear entity tracking\n    mpGame.enemies.clear();\n    mpGame.projectiles.clear();\n    mpGame.pickups.clear();\n    mpGame.nextEntityId = 1;\n\n    // Initialize seeded RNG\n    if (gameSeed !== null) {\n        // Client: use seed from host\n        mpGame.gameSeed = gameSeed;\n    } else if (isHost) {\n        // Host: generate new game seed\n        mpGame.gameSeed = Math.floor(Math.random() * 0xFFFFFFFF);\n    }\n\n    // Initialize floor RNG (will be reset when floor changes)\n    mpGame.floorRng = new SeededRandom(mpGame.gameSeed);\n    mpGame.currentFloor = 1;\n    mpGame.currentRoom = { x: 0, y: 0 };\n\n    // Set up message handlers\n    if (isHost) {\n        setupHostHandlers();\n    } else {\n        // Reset handler registration flag to allow re-registration on reconnect\n        multiplayerClientHandlersRegistered = false;\n        setupClientHandlers();\n    }\n}\n\n/**\n * Set up message handlers for host\n */\nfunction setupHostHandlers() {\n    // Prevent duplicate handler registration\n    if (multiplayerHostHandlersRegistered) {\n        return;\n    }\n    multiplayerHostHandlersRegistered = true;\n\n    // Handle player input from clients\n    onMessage('player_input', (payload, fromPeerId) => {\n        // Validate payload structure\n        if (!payload || typeof payload !== 'object') return;\n\n        // Store input to be processed in game loop\n        // Find which player slot this peer belongs to\n        const party = getParty();\n        const slotIndex = party.slots.findIndex(slot => slot.peerId === fromPeerId);\n\n        if (MP_DEBUG) console.log('[Multiplayer] Received input from peer:', fromPeerId, 'slot:', slotIndex);\n\n        if (slotIndex !== -1 && mpGame.players.has(slotIndex)) {\n            const player = mpGame.players.get(slotIndex);\n\n            // Check if player entity still exists (might be destroyed during scene transition)\n            if (!player || !player.exists()) {\n                if (MP_DEBUG) console.warn('[Multiplayer] Player entity destroyed for slot:', slotIndex);\n                return;\n            }\n\n            // Apply input to player with validation\n            if (payload.move && typeof payload.move === 'object') {\n                // Clamp movement values to valid range [-1, 1]\n                const moveX = Math.max(-1, Math.min(1, Number(payload.move.x) || 0));\n                const moveY = Math.max(-1, Math.min(1, Number(payload.move.y) || 0));\n                player.move = { x: moveX, y: moveY };\n            }\n            if (payload.shoot !== undefined) {\n                player.isShooting = Boolean(payload.shoot);\n            }\n            if (payload.aimAngle !== undefined) {\n                // Clamp aimAngle to valid range [-360, 360]\n                const aimAngle = Number(payload.aimAngle) || 0;\n                player.aimAngle = Math.max(-360, Math.min(360, aimAngle));\n            }\n            if (MP_DEBUG) console.log('[Multiplayer] Applied input to player at slot', slotIndex);\n        } else {\n            console.warn('[Multiplayer] Could not find player for peer:', fromPeerId, 'slot:', slotIndex);\n            console.warn('[Multiplayer] Party slots:', party.slots);\n            console.warn('[Multiplayer] Registered players:', Array.from(mpGame.players.keys()));\n        }\n    });\n\n    // Handle pause requests from clients\n    onMessage('pause_request', (payload, fromPeerId) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Pause request from peer:', fromPeerId, 'paused:', payload.paused);\n\n        // Host applies the pause state and broadcasts to all clients\n        if (mpGame.k) {\n            mpGame.k.paused = payload.paused;\n\n            // Update host's pause UI\n            if (mpGame.k.gameData && mpGame.k.gameData.updatePauseUI) {\n                mpGame.k.gameData.updatePauseUI(payload.paused);\n            }\n\n            // Broadcast to all clients (including the requester for confirmation)\n            broadcast('pause_state', { paused: payload.paused });\n\n            if (MP_DEBUG) console.log('[Multiplayer] Host set pause state to:', payload.paused);\n        }\n    });\n\n    // Handle player death notifications from clients\n    onMessage('player_death', (payload, fromPeerId) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received player death from client:', fromPeerId, 'slot:', payload.slotIndex);\n\n        // Mark player as dead on host\n        const player = mpGame.players.get(payload.slotIndex);\n        if (player && player.exists()) {\n            player.isDead = true;\n            player.canMove = false;\n            player.canShoot = false;\n            player.isShooting = false;\n\n            // Visual indication of death\n            player.opacity = 0.5;\n            if (player.outline && player.outline.exists()) {\n                player.outline.opacity = 0.5;\n            }\n\n            if (MP_DEBUG) console.log('[Multiplayer] Host marked player at slot', payload.slotIndex, 'as dead');\n\n            // Broadcast to all other clients\n            broadcast('player_death', { slotIndex: payload.slotIndex }, [fromPeerId]);\n        }\n    });\n\n    // Handle enemy death notifications from clients\n    onMessage('enemy_death', (payload, fromPeerId) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received enemy death from client:', fromPeerId, 'entity:', payload.entityId);\n\n        // Broadcast the death to all clients (including back to the sender for confirmation)\n        broadcast('entity_destroyed', {\n            entityId: payload.entityId,\n            entityType: payload.entityType,\n            x: payload.x,\n            y: payload.y\n        });\n\n    });\n\n    // Handle re-sync requests from clients\n    onMessage('resync_request', (payload, fromPeerId) => {\n        // Send full game state to requesting client immediately\n        sendToPeer(fromPeerId, 'game_state', collectGameState());\n    });\n\n    // Handle level up queued from clients\n    onMessage('level_up_queued', (payload, fromPeerId) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received level up queued from client:', fromPeerId, 'slot:', payload.slotIndex, 'level:', payload.level);\n\n        // Broadcast to ALL clients so everyone knows about the level up\n        broadcast('level_up_queued', {\n            slotIndex: payload.slotIndex,\n            level: payload.level,\n            timestamp: Date.now()\n        });\n\n        if (MP_DEBUG) console.log('[Multiplayer] Host broadcasted level up queued for slot:', payload.slotIndex);\n    });\n\n    // Handle emote from clients - rebroadcast to all\n    onMessage('player_emote', (payload, fromPeerId) => {\n        // Rebroadcast emote to all clients (including sender for consistency)\n        broadcast('player_emote', payload);\n    });\n\n    // Handle upgrade selection from clients\n    onMessage('upgrade_selected', (payload, fromPeerId) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received upgrade selection from client:', fromPeerId, 'slot:', payload.slotIndex, 'upgrade:', payload.upgradeKey);\n\n        // Apply upgrade to the player on host side\n        const player = mpGame.players.get(payload.slotIndex);\n        if (player && player.exists()) {\n            applyUpgrade(player, payload.upgradeKey);\n            // Track the upgrade in upgradeStacks for proper persistence\n            if (!player.upgradeStacks) player.upgradeStacks = {};\n            player.upgradeStacks[payload.upgradeKey] = (player.upgradeStacks[payload.upgradeKey] || 0) + 1;\n            // Track in selectedUpgrades for synergy detection\n            if (!player.selectedUpgrades) player.selectedUpgrades = new Set();\n            player.selectedUpgrades.add(payload.upgradeKey);\n            recalculateAllUpgrades(player);\n        }\n\n        // Broadcast to ALL clients (including back to sender) so everyone can apply the upgrade\n        broadcast('upgrade_selected', {\n            slotIndex: payload.slotIndex,\n            upgradeKey: payload.upgradeKey,\n            timestamp: Date.now()\n        });\n\n        if (MP_DEBUG) console.log('[Multiplayer] Host broadcasted upgrade selection for slot:', payload.slotIndex);\n    });\n\n    // Handle synergy activation from clients\n    onMessage('synergy_activated', (payload, fromPeerId) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received synergy activation from client:', fromPeerId, 'slot:', payload.slotIndex);\n\n        // Broadcast to ALL clients so everyone can apply the synergies\n        broadcast('synergy_activated', {\n            slotIndex: payload.slotIndex,\n            synergies: payload.synergies,\n            timestamp: Date.now()\n        });\n\n        if (MP_DEBUG) console.log('[Multiplayer] Host broadcasted synergy activation for slot:', payload.slotIndex);\n    });\n\n    // Handle achievement unlock from clients (rebroadcast to all)\n    onMessage('achievement_unlocked', (payload, fromPeerId) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received achievement unlock from client:', fromPeerId, 'achievement:', payload.achievementId);\n\n        // Broadcast to ALL clients so everyone can show the toast\n        broadcast('achievement_unlocked', {\n            achievementId: payload.achievementId,\n            playerSlotIndex: payload.playerSlotIndex,\n            playerName: payload.playerName\n        });\n    });\n}\n\n// Flags to prevent duplicate handler registration\nlet multiplayerClientHandlersRegistered = false;\nlet multiplayerHostHandlersRegistered = false;\n\n/**\n * Set up message handlers for client\n */\nfunction setupClientHandlers() {\n    // Prevent duplicate handler registration (memory leak fix)\n    if (multiplayerClientHandlersRegistered) {\n        return;\n    }\n    multiplayerClientHandlersRegistered = true;\n\n    // Receive game state updates from host\n    onMessage('game_state', (payload) => {\n        if (!mpGame.k) return; // Need kaplay instance\n\n        // Update all remote player positions\n        if (payload.players) {\n            payload.players.forEach(playerState => {\n                if (playerState.slotIndex !== mpGame.localPlayerSlot) {\n                    const player = mpGame.players.get(playerState.slotIndex);\n                    if (player && player.exists()) {\n                        // Store target position for smooth interpolation\n                        if (!player.netTarget) {\n                            player.netTarget = { x: playerState.x, y: playerState.y };\n                        } else {\n                            player.netTarget.x = playerState.x;\n                            player.netTarget.y = playerState.y;\n                        }\n                        player.angle = playerState.angle || 0;\n                        // Also rotate the outline\n                        if (player.outline && player.outline.exists()) {\n                            player.outline.angle = player.angle;\n                        }\n\n                        // Update health and maxHealth\n                        if (playerState.maxHealth !== undefined) {\n                            player.maxHealth = playerState.maxHealth;\n                        }\n                        if (playerState.hp !== undefined && player.setHP) {\n                            player.setHP(playerState.hp);\n                        }\n\n                        // Update invulnerability state\n                        if (playerState.invulnerable !== undefined) {\n                            player.invulnerable = playerState.invulnerable;\n                        }\n                        if (playerState.invulnerableTime !== undefined) {\n                            player.invulnerableTime = playerState.invulnerableTime;\n                        }\n\n                        // Update death state\n                        if (playerState.isDead !== undefined) {\n                            player.isDead = playerState.isDead;\n                            // Set state based on alive/dead\n                            if (player.isDead) {\n                                player.canShoot = false;\n                                player.canMove = false;\n                                player.isShooting = false;\n                                // Death visual state\n                                player.opacity = 0.5;\n                                if (player.outline && player.outline.exists()) {\n                                    player.outline.opacity = 0.5;\n                                }\n                            } else {\n                                // Re-enable for alive players\n                                player.canShoot = true;\n                                player.canMove = true;\n                                // Alive visual state\n                                player.opacity = 1;\n                                if (player.outline && player.outline.exists()) {\n                                    player.outline.opacity = 1;\n                                }\n                            }\n                        }\n\n                        // Update weapon/upgrade state\n                        if (playerState.weapons) {\n                            player.weapons = playerState.weapons;\n                        }\n                        if (playerState.passiveUpgrades) {\n                            player.passiveUpgrades = playerState.passiveUpgrades;\n                        }\n                        if (playerState.upgradeStacks) {\n                            player.upgradeStacks = playerState.upgradeStacks;\n                        }\n\n                        // Update stats\n                        if (playerState.speed !== undefined) player.speed = playerState.speed;\n                        if (playerState.damage !== undefined) player.damage = playerState.damage;\n                        if (playerState.pickupRadius !== undefined) player.pickupRadius = playerState.pickupRadius;\n\n                        // Sync per-player run stats for game over screen\n                        if (playerState.runStats) {\n                            if (!player.runStats) {\n                                player.runStats = { kills: 0, creditsPickedUp: 0, bossesKilled: 0 };\n                            }\n                            player.runStats.kills = playerState.runStats.kills;\n                            player.runStats.creditsPickedUp = playerState.runStats.creditsPickedUp;\n                            player.runStats.bossesKilled = playerState.runStats.bossesKilled;\n                        }\n                    }\n                } else {\n                    // Update local player's HP from host (damage is host-authoritative)\n                    const localPlayer = mpGame.players.get(mpGame.localPlayerSlot);\n                    if (localPlayer && localPlayer.exists()) {\n                        // Sync HP (host is authoritative for damage)\n                        if (playerState.hp !== undefined && localPlayer.setHP) {\n                            localPlayer.setHP(playerState.hp);\n                        }\n                        if (playerState.maxHealth !== undefined) {\n                            localPlayer.maxHealth = playerState.maxHealth;\n                        }\n\n                        // Sync invulnerability state\n                        if (playerState.invulnerable !== undefined) {\n                            localPlayer.invulnerable = playerState.invulnerable;\n                        }\n                        if (playerState.invulnerableTime !== undefined) {\n                            localPlayer.invulnerableTime = playerState.invulnerableTime;\n                        }\n\n                        // Sync death state\n                        if (playerState.isDead !== undefined) {\n                            localPlayer.isDead = playerState.isDead;\n                            if (localPlayer.isDead) {\n                                localPlayer.canShoot = false;\n                                localPlayer.canMove = false;\n                                localPlayer.isShooting = false;\n                                // Death visual state\n                                localPlayer.opacity = 0.5;\n                                if (localPlayer.outline && localPlayer.outline.exists()) {\n                                    localPlayer.outline.opacity = 0.5;\n                                }\n                            } else {\n                                localPlayer.canShoot = true;\n                                localPlayer.canMove = true;\n                                // Alive visual state - restore full opacity\n                                localPlayer.opacity = 1;\n                                if (localPlayer.outline && localPlayer.outline.exists()) {\n                                    localPlayer.outline.opacity = 1;\n                                }\n                            }\n                        }\n\n                        // Sync per-player run stats from host (host tracks all kills/credits)\n                        if (playerState.runStats) {\n                            if (!localPlayer.runStats) {\n                                localPlayer.runStats = { kills: 0, creditsPickedUp: 0, bossesKilled: 0 };\n                            }\n                            localPlayer.runStats.kills = playerState.runStats.kills;\n                            localPlayer.runStats.creditsPickedUp = playerState.runStats.creditsPickedUp;\n                            localPlayer.runStats.bossesKilled = playerState.runStats.bossesKilled;\n                        }\n                    }\n                }\n            });\n        }\n\n        // Update enemies\n        if (payload.enemies) {\n            const receivedIds = new Set();\n\n            payload.enemies.forEach(enemyState => {\n                receivedIds.add(enemyState.id);\n\n                const existingEnemy = mpGame.enemies.get(enemyState.id);\n                if (existingEnemy && existingEnemy.exists()) {\n                    // Update existing enemy with interpolation for smooth movement\n                    // Store target position for interpolation\n                    if (!existingEnemy.netTarget) {\n                        existingEnemy.netTarget = { x: enemyState.x, y: enemyState.y };\n                    } else {\n                        existingEnemy.netTarget.x = enemyState.x;\n                        existingEnemy.netTarget.y = enemyState.y;\n                    }\n\n                    // Update health immediately (no interpolation for discrete values)\n                    if (enemyState.maxHealth !== undefined) {\n                        existingEnemy.maxHealth = enemyState.maxHealth;\n                    }\n                    if (existingEnemy.setHP && enemyState.hp !== undefined) {\n                        existingEnemy.setHP(enemyState.hp);\n                    }\n\n                    // Update shield and armor state for visual sync\n                    if (enemyState.shieldHealth !== undefined) {\n                        existingEnemy.shieldHealth = enemyState.shieldHealth;\n                    }\n                    if (enemyState.armorHealth !== undefined) {\n                        existingEnemy.armorHealth = enemyState.armorHealth;\n                    }\n                    // Update visual if shield/armor changed\n                    if (existingEnemy.updateVisual) {\n                        existingEnemy.updateVisual();\n                    }\n                } else {\n                    // TODO: Mid-game join limitation\n                    // Enemy doesn't exist on client yet. To fully recreate it, we'd need:\n                    // - Enemy type, difficulty level, modifiers\n                    // - Full creation parameters from createEnemy()\n                    //\n                    // Current behavior: Entities appear when they move into view or are destroyed\n                    // Future improvement: Send full entity creation data via 'spawn_entity' messages\n                    //\n                    // For now, clients joining mid-game will see entity positions update\n                    // but won't have visual representations until next spawn/despawn cycle\n                }\n            });\n\n            // Remove enemies that no longer exist on host\n            mpGame.enemies.forEach((enemy, id) => {\n                if (!receivedIds.has(id) && enemy.exists()) {\n                    // Clean up health bars before destroying\n                    if (enemy.cleanupHealthBars && typeof enemy.cleanupHealthBars === 'function') {\n                        enemy.cleanupHealthBars();\n                    }\n                    mpGame.k.destroy(enemy); // Use Kaplay's destroy method\n                    mpGame.enemies.delete(id);\n                }\n            });\n        }\n\n        // NOTE: Projectiles are no longer synced via game_state\n        // They are spawned via spawn_projectile messages and move autonomously\n        // This significantly reduces network bandwidth and improves performance\n\n        // Update pickups\n        if (payload.pickups) {\n            const receivedIds = new Set();\n\n            payload.pickups.forEach(pickupState => {\n                receivedIds.add(pickupState.id);\n\n                const existing = mpGame.pickups.get(pickupState.id);\n                if (existing && existing.exists()) {\n                    // Update position\n                    existing.pos.x = pickupState.x;\n                    existing.pos.y = pickupState.y;\n\n                    // Update magnetization state\n                    if (pickupState.magnetizing !== undefined) {\n                        existing.magnetizing = pickupState.magnetizing;\n\n                        // Set target player if specified\n                        if (pickupState.magnetizing && pickupState.targetPlayerSlot !== undefined) {\n                            const targetPlayer = mpGame.players.get(pickupState.targetPlayerSlot);\n                            if (targetPlayer && targetPlayer.exists()) {\n                                existing.targetPlayer = targetPlayer;\n                            } else {\n                                // Target player disconnected or invalid - stop magnetizing\n                                existing.magnetizing = false;\n                                existing.targetPlayer = null;\n                            }\n                        } else if (!pickupState.magnetizing) {\n                            // Stopped magnetizing - clear target\n                            existing.targetPlayer = null;\n                        }\n                    }\n\n                    // Update isFlyingToUI state\n                    if (pickupState.isFlyingToUI !== undefined) {\n                        existing.isFlyingToUI = pickupState.isFlyingToUI;\n                    }\n                }\n            });\n\n            // Remove collected pickups\n            mpGame.pickups.forEach((pickup, id) => {\n                if (!receivedIds.has(id) && pickup.exists()) {\n                    mpGame.k.destroy(pickup); // Use Kaplay's destroy method\n                    mpGame.pickups.delete(id);\n                }\n            });\n        }\n    });\n\n    // Handle entity spawn events\n    onMessage('spawn_entity', (payload) => {\n        if (!mpGame.k) return; // Need kaplay instance\n\n        // Host tells clients to spawn a new entity with full creation parameters\n        if (payload.entityType === 'enemy') {\n            let enemy;\n            if (payload.isBoss) {\n                // Create boss entity\n                enemy = createBoss(\n                    mpGame.k,\n                    payload.x,\n                    payload.y,\n                    payload.type,\n                    payload.floor\n                );\n            } else {\n                // Create regular enemy\n                enemy = createEnemy(\n                    mpGame.k,\n                    payload.x,\n                    payload.y,\n                    payload.type,\n                    payload.floor\n                );\n            }\n            enemy.mpEntityId = payload.id;\n            if (payload.isBossMinion) {\n                enemy.isBossMinion = true;\n            }\n            mpGame.enemies.set(payload.id, enemy);\n            // Removed console.log for performance\n        } else if (payload.entityType === 'xpPickup') {\n            const pickup = createXPPickup(\n                mpGame.k,\n                payload.x,\n                payload.y,\n                payload.value\n            );\n            pickup.mpEntityId = payload.id;\n            pickup.pickupType = 'xp';\n            mpGame.pickups.set(payload.id, pickup);\n            // Removed console.log for performance\n        } else if (payload.entityType === 'currencyPickup') {\n            const pickup = createCurrencyPickup(\n                mpGame.k,\n                payload.x,\n                payload.y,\n                payload.value,\n                payload.icon\n            );\n            pickup.mpEntityId = payload.id;\n            pickup.pickupType = 'currency';\n            mpGame.pickups.set(payload.id, pickup);\n            // Removed console.log for performance\n        }\n    });\n\n    // Handle projectile spawn events\n    onMessage('spawn_projectile', (payload) => {\n        if (!mpGame.k) return; // Need kaplay instance\n\n        // Reconstruct direction vector\n        const direction = mpGame.k.vec2(payload.directionX, payload.directionY);\n\n        // Create the projectile with all parameters\n        const projectile = createProjectile(\n            mpGame.k,\n            payload.x,\n            payload.y,\n            direction,\n            payload.speed,\n            payload.damage,\n            payload.piercing,\n            payload.obstaclePiercing,\n            payload.isCrit,\n            payload.maxRange\n        );\n\n        // Apply visual customization if provided\n        if (payload.char || payload.color) {\n            projectile.text = payload.char;\n            if (payload.color) {\n                projectile.color = mpGame.k.rgb(...payload.color);\n            }\n        }\n\n        // Assign network ID and track\n        projectile.mpEntityId = payload.id;\n        mpGame.projectiles.set(payload.id, projectile);\n    });\n\n    // Handle damage events\n    onMessage('damage_dealt', (payload) => {\n        if (!mpGame.k) return; // Need kaplay instance\n\n        // Show damage number at the hit location\n        const damageText = mpGame.k.add([\n            mpGame.k.text(payload.damage.toString(), {\n                size: payload.isCrit ? 24 : 18\n            }),\n            mpGame.k.pos(payload.x, payload.y),\n            mpGame.k.anchor('center'),\n            mpGame.k.color(payload.isCrit ? 255 : 255, payload.isCrit ? 200 : 255, payload.isCrit ? 0 : 255),\n            mpGame.k.opacity(1), // Required for lifespan component\n            mpGame.k.lifespan(0.8),\n            mpGame.k.z(1000)\n        ]);\n\n        // Animate damage number rising and fading\n        damageText.onUpdate(() => {\n            if (!damageText.exists()) return; // Prevent crash on scene exit\n            damageText.pos.y -= 50 * mpGame.k.dt();\n            damageText.opacity -= 1.25 * mpGame.k.dt();\n        });\n\n        // Flash the target entity if we have it (enemies only - players keyed by slotIndex)\n        const target = mpGame.enemies.get(payload.targetId);\n        if (target && target.exists()) {\n            const originalColor = target.color;\n            target.color = mpGame.k.rgb(255, 255, 255); // White flash\n            mpGame.k.wait(0.1, () => {\n                if (target.exists()) {\n                    target.color = originalColor;\n                }\n            });\n        }\n    });\n\n    // Handle entity death events\n    onMessage('entity_destroyed', (payload) => {\n        if (!mpGame.k) return; // Need kaplay instance\n\n        // Remove the entity from tracking and destroy it\n        // Check enemies and pickups only - players have separate death handling\n        // NOTE: Do NOT check mpGame.players here as it's keyed by slotIndex, not entityId\n        const entity = mpGame.enemies.get(payload.entityId) ||\n                      mpGame.pickups.get(payload.entityId);\n\n        if (entity && entity.exists()) {\n            // Clean up health bars before destroying entity\n            if (entity.cleanupHealthBars && typeof entity.cleanupHealthBars === 'function') {\n                entity.cleanupHealthBars();\n            }\n\n            // Don't trigger onDeath for network-destroyed entities\n            // The host already handled death effects (splitting, explosions, etc.)\n            // and will broadcast any spawned entities separately\n            // This prevents errors from death handlers trying to spawn entities on clients\n\n            // Destroy the entity\n            mpGame.k.destroy(entity);\n\n            // Remove from appropriate tracking map\n            if (payload.entityType === 'pickup' || payload.entityType === 'xpPickup' || payload.entityType === 'currencyPickup') {\n                mpGame.pickups.delete(payload.entityId);\n            }\n        }\n\n        // Clean up from tracking maps\n        mpGame.enemies.delete(payload.entityId);\n        mpGame.projectiles.delete(payload.entityId);\n        mpGame.pickups.delete(payload.entityId);\n\n        // Note: XP/currency drops are handled by spawn_entity events from host\n        // The host will spawn pickups and broadcast them separately\n    });\n\n    // Handle boss enrage events\n    onMessage('boss_enrage', (payload) => {\n        if (!mpGame.k) return;\n        const boss = mpGame.enemies.get(payload.networkId);\n        if (boss && boss.exists() && boss.enrage) {\n            boss.enrage();\n        }\n    });\n\n    // Handle player revival events\n    onMessage('players_revived', (payload) => {\n        if (!mpGame.k) return; // Need kaplay instance\n\n        // Get Second Wind level for revive health bonus\n        const secondWindLevel = getPermanentUpgradeLevel('secondWind');\n        const revivePercent = 0.05 + (secondWindLevel * 0.05);\n\n        // Revive all dead players\n        mpGame.players.forEach((player, slotIndex) => {\n            if (player && player.exists() && (player.hp() <= 0 || player.isDead)) {\n                // Revive player at 5% health + 5% per Second Wind level\n                const reviveHealth = Math.max(1, Math.floor(player.maxHealth * revivePercent));\n                player.setHP(reviveHealth);\n                player.isDead = false;\n\n                // Re-enable movement and shooting only for the local player\n                if (slotIndex === mpGame.localPlayerSlot) {\n                    player.canMove = true;\n                    player.canShoot = true;\n                }\n\n                // Show revival effect with HP percentage\n                const reviveHealthPercent = Math.round(revivePercent * 100);\n                const reviveEffect = mpGame.k.add([\n                    mpGame.k.text(` REVIVED (${reviveHealthPercent}% HP) `, { size: 16 }),\n                    mpGame.k.pos(player.pos.x, player.pos.y - 40),\n                    mpGame.k.anchor('center'),\n                    mpGame.k.color(100, 255, 100),\n                    mpGame.k.opacity(1), // Required for lifespan component\n                    mpGame.k.lifespan(2),\n                    mpGame.k.z(1000)\n                ]);\n\n                // Animate rising and fading\n                reviveEffect.onUpdate(() => {\n                    if (!reviveEffect.exists()) return; // Prevent crash on scene exit\n                    reviveEffect.pos.y -= 30 * mpGame.k.dt();\n                    reviveEffect.opacity -= 0.5 * mpGame.k.dt();\n                });\n\n                // Restore visual state\n                player.opacity = 1;\n                if (player.characterData) {\n                    player.color = mpGame.k.rgb(...player.characterData.color);\n                }\n                if (player.outline && player.outline.exists()) {\n                    player.outline.opacity = 1;\n                }\n            }\n        });\n    });\n\n    // Handle game seed broadcast from host\n    onMessage('game_seed', (payload) => {\n        // Initialize RNG with seed from host\n        mpGame.gameSeed = payload.seed;\n        mpGame.floorRng = new SeededRandom(mpGame.gameSeed);\n\n        // Store first room template key for use when room loads\n        if (payload.roomTemplateKey) {\n            mpGame.firstRoomTemplateKey = payload.roomTemplateKey;\n            console.log('[Multiplayer] Client received first room template:', payload.roomTemplateKey);\n        }\n\n        // Call callback to regenerate floor map with correct seed\n        if (mpGame.onGameSeedCallback) {\n            mpGame.onGameSeedCallback();\n            mpGame.onGameSeedCallback = null;\n        }\n    });\n\n    // Receive pause state updates from host\n    onMessage('pause_state', (payload) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received pause state from host:', payload.paused);\n\n        // Apply pause state locally\n        if (mpGame.k) {\n            mpGame.k.paused = payload.paused;\n\n            // Update pause UI if callback is registered\n            if (mpGame.k.gameData && mpGame.k.gameData.updatePauseUI) {\n                mpGame.k.gameData.updatePauseUI(payload.paused);\n            }\n\n            if (MP_DEBUG) console.log('[Multiplayer] Client set pause state to:', payload.paused);\n        }\n    });\n\n    // Receive XP gain from host\n    onMessage('xp_gain', (payload) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received XP gain from host:', payload.value);\n\n        // Give XP to local player\n        const localPlayer = mpGame.players.get(mpGame.localPlayerSlot);\n        if (localPlayer && localPlayer.exists() && !localPlayer.isDead && localPlayer.addXP) {\n            localPlayer.addXP(payload.value);\n        } else {\n            // Player doesn't exist (in upgrade draft screen) - accumulate pending XP\n            mpGame.pendingXP += payload.value;\n            if (MP_DEBUG) console.log('[Multiplayer] Accumulated pending XP:', mpGame.pendingXP);\n        }\n    });\n\n    // Receive currency gain from host\n    onMessage('currency_gain', (payload) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received currency gain from host:', payload.value);\n        addCurrency(payload.value);\n    });\n\n    // Receive enemy split events from host\n    onMessage('enemy_split', (payload) => {\n\n        // Update split enemy counter\n        if (mpGame.k && mpGame.k.gameData && mpGame.k.gameData.incrementSplitEnemies) {\n            mpGame.k.gameData.incrementSplitEnemies(payload.count);\n        }\n    });\n\n    // Receive player death events from host\n    onMessage('player_death', (payload) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Received player death event for slot:', payload.slotIndex);\n\n        // Mark player as dead immediately\n        const player = mpGame.players.get(payload.slotIndex);\n        if (player && player.exists()) {\n            player.isDead = true;\n            player.canMove = false;\n            player.canShoot = false;\n            player.isShooting = false;\n\n            // Visual indication of death\n            player.opacity = 0.5;\n            if (player.outline && player.outline.exists()) {\n                player.outline.opacity = 0.5;\n            }\n\n            if (MP_DEBUG) console.log('[Multiplayer] Marked player at slot', payload.slotIndex, 'as dead');\n        }\n    });\n\n    // Receive player disconnect events from host\n    onMessage('player_disconnected', (payload) => {\n        // Clean up the disconnected player's entity on this client\n        const player = mpGame.players.get(payload.slotIndex);\n        if (player && player.exists()) {\n            // Clear pending level-ups\n            if (player.pendingLevelUps) {\n                player.pendingLevelUps = [];\n            }\n\n            // Clean up health bars before destroying\n            if (player.cleanupHealthBars && typeof player.cleanupHealthBars === 'function') {\n                player.cleanupHealthBars();\n            }\n\n            // Destroy player entity\n            mpGame.k.destroy(player);\n\n            // Remove from tracking\n            mpGame.players.delete(payload.slotIndex);\n        }\n    });\n\n    // Receive host quit event - return to menu\n    onMessage('host_quit', (payload) => {\n        if (MP_DEBUG) console.log('[Multiplayer] Host quit to menu, returning to menu');\n\n        // Cleanup multiplayer state\n        cleanupMultiplayer();\n\n        // Reset game state and return to menu\n        if (mpGame.k) {\n            mpGame.k.go('menu');\n        }\n    });\n\n    // Receive achievement unlock notification from other players\n    onMessage('achievement_unlocked', (payload) => {\n        // Only show toast if it's not from the local player\n        if (payload.playerSlotIndex !== mpGame.localPlayerSlot) {\n            if (MP_DEBUG) console.log('[Multiplayer] Achievement unlocked by player:', payload.playerName, 'achievement:', payload.achievementId);\n\n            const achievement = ACHIEVEMENTS[payload.achievementId];\n            if (achievement && mpGame.k) {\n                // Make sure toast system is initialized\n                initToastSystem(mpGame.k);\n                showMultiplayerAchievementToast(payload.playerName, achievement);\n            }\n        }\n    });\n}\n\n/**\n * Register a player entity for multiplayer\n * @param {number} slotIndex - Party slot index (0-3)\n * @param {Object} playerEntity - Kaplay player entity\n */\nexport function registerPlayer(slotIndex, playerEntity) {\n    mpGame.players.set(slotIndex, playerEntity);\n    playerEntity.mpSlotIndex = slotIndex; // Store slot index on entity\n}\n\n/**\n * Handle player disconnect (cleanup entity and state)\n * @param {number} slotIndex - Party slot index (0-3)\n */\nexport function handlePlayerDisconnect(slotIndex) {\n    const player = mpGame.players.get(slotIndex);\n    if (player && player.exists()) {\n\n        // Clear pending level-ups\n        if (player.pendingLevelUps) {\n            player.pendingLevelUps = [];\n        }\n\n        // Clean up health bars before destroying\n        if (player.cleanupHealthBars && typeof player.cleanupHealthBars === 'function') {\n            player.cleanupHealthBars();\n        }\n\n        // Destroy player entity\n        if (mpGame.k) {\n            mpGame.k.destroy(player);\n        }\n\n        // Remove from tracking\n        mpGame.players.delete(slotIndex);\n\n        // Broadcast disconnect to other clients (host only)\n        if (mpGame.isHost) {\n            broadcastPlayerDisconnect(slotIndex);\n        }\n    }\n}\n\n/**\n * Broadcast player disconnect event to all clients\n * @param {number} slotIndex - Slot index of disconnected player\n */\nexport function broadcastPlayerDisconnect(slotIndex) {\n    if (!mpGame.isHost) return;\n\n    broadcast('player_disconnected', { slotIndex });\n}\n\n/**\n * Update multiplayer state - call this every frame\n * @param {number} dt - Delta time\n */\nexport function updateMultiplayer(dt) {\n    if (!mpGame.isActive) return;\n\n    mpGame.lastSyncTime += dt;\n    mpGame.lastResyncTime += dt;\n\n    if (mpGame.isHost) {\n        // Host: broadcast game state periodically\n        if (mpGame.lastSyncTime >= mpGame.syncInterval) {\n            broadcastGameState();\n            mpGame.lastSyncTime = 0;\n        }\n\n        // Host: periodic desync check (verify critical state)\n        if (mpGame.lastResyncTime >= mpGame.resyncInterval) {\n            // Check if any players have inconsistent state\n            mpGame.players.forEach((player, slotIndex) => {\n                if (player && player.exists()) {\n                    // Check for critical desyncs (e.g., dead but still has HP)\n                    if (player.isDead && player.hp() > 0) {\n                        console.warn('[Multiplayer] Desync detected: Player', slotIndex, 'is marked dead but has HP. Correcting...');\n                        player.setHP(0);\n                    }\n                    if (!player.isDead && player.hp() <= 0) {\n                        console.warn('[Multiplayer] Desync detected: Player', slotIndex, 'has no HP but not marked dead. Correcting...');\n                        player.isDead = true;\n                        player.canMove = false;\n                        player.canShoot = false;\n                    }\n                }\n            });\n            mpGame.lastResyncTime = 0;\n        }\n    } else {\n        // Client: send input state periodically\n        if (mpGame.lastSyncTime >= mpGame.syncInterval) {\n            sendInputState();\n            mpGame.lastSyncTime = 0;\n        }\n\n        // Client: periodic desync check and auto-resync request\n        if (mpGame.lastResyncTime >= mpGame.resyncInterval) {\n            // Check for desyncs on client\n            let desyncDetected = false;\n\n            mpGame.players.forEach((player, slotIndex) => {\n                if (player && player.exists()) {\n                    // Check for critical desyncs\n                    if (player.isDead && player.hp() > 0) {\n                        console.warn('[Multiplayer] Client desync: Player', slotIndex, 'is dead but has HP');\n                        desyncDetected = true;\n                    }\n                    if (!player.isDead && player.hp() <= 0) {\n                        console.warn('[Multiplayer] Client desync: Player', slotIndex, 'has no HP but not dead');\n                        desyncDetected = true;\n                    }\n                }\n            });\n\n            if (desyncDetected) {\n                requestResync();\n            }\n\n            mpGame.lastResyncTime = 0;\n        }\n\n        // Client: interpolate entity positions for smooth movement\n        const lerpFactor = Math.min(dt * 10, 1); // Lerp 10x per second, cap at 1\n\n        // Interpolate remote players\n        mpGame.players.forEach(player => {\n            if (player.exists() && player.isRemote && player.netTarget) {\n                player.pos.x += (player.netTarget.x - player.pos.x) * lerpFactor;\n                player.pos.y += (player.netTarget.y - player.pos.y) * lerpFactor;\n            }\n        });\n\n        // Interpolate enemies\n        mpGame.enemies.forEach(enemy => {\n            if (enemy.exists() && enemy.netTarget) {\n                enemy.pos.x += (enemy.netTarget.x - enemy.pos.x) * lerpFactor;\n                enemy.pos.y += (enemy.netTarget.y - enemy.pos.y) * lerpFactor;\n            }\n        });\n    }\n}\n\n/**\n * Collect current game state (helper function)\n * @returns {Object} Game state object\n */\nfunction collectGameState() {\n    const playerStates = [];\n    const enemyStates = [];\n    const projectileStates = [];\n    const pickupStates = [];\n\n    // Collect player states\n    mpGame.players.forEach((player, slotIndex) => {\n        if (player.exists()) {\n            // Ensure weapons and upgrades are serializable using JSON round-trip to strip functions\n            let weaponsArray = [];\n            let upgradesArray = [];\n            let stacksObj = {};\n\n            try {\n                // Deep clone to remove functions and non-serializable data\n                if (player.weapons) {\n                    weaponsArray = JSON.parse(JSON.stringify(player.weapons));\n                }\n                if (player.passiveUpgrades) {\n                    upgradesArray = JSON.parse(JSON.stringify(player.passiveUpgrades));\n                }\n                if (player.upgradeStacks) {\n                    stacksObj = JSON.parse(JSON.stringify(player.upgradeStacks));\n                }\n            } catch (e) {\n                console.warn('Failed to serialize player upgrades:', e);\n                // Fallback to empty arrays/objects\n            }\n\n            // Get current HP safely - if player has hp() method, use it, otherwise use maxHealth\n            let currentHP = player.maxHealth;\n            if (player.hp && typeof player.hp === 'function') {\n                currentHP = player.hp();\n            } else if (typeof player.hp === 'number') {\n                currentHP = player.hp;\n            }\n\n            playerStates.push({\n                slotIndex: Number(slotIndex),\n                x: Number(player.pos.x),\n                y: Number(player.pos.y),\n                angle: Number(player.angle || 0),\n                hp: Number(currentHP),\n                maxHealth: Number(player.maxHealth || 100),\n                level: Number(player.level || 1),\n                xp: Number(player.xp || 0),\n                isDead: Boolean(player.isDead || false), // Track death state\n                // Weapon and upgrade state (ensure plain data)\n                weapons: weaponsArray,\n                passiveUpgrades: upgradesArray,\n                upgradeStacks: stacksObj,\n                // Stats that affect gameplay\n                speed: Number(player.speed || 0),\n                damage: Number(player.damage || 0),\n                pickupRadius: Number(player.pickupRadius || 0),\n                // Visual state for color sync\n                invulnerable: Boolean(player.invulnerable || false),\n                invulnerableTime: Number(player.invulnerableTime || 0),\n                // Per-player run stats for game over screen\n                runStats: player.runStats ? {\n                    kills: Number(player.runStats.kills || 0),\n                    creditsPickedUp: Number(player.runStats.creditsPickedUp || 0),\n                    bossesKilled: Number(player.runStats.bossesKilled || 0)\n                } : null\n            });\n        }\n    });\n\n    // Collect enemy states\n    mpGame.enemies.forEach((enemy, entityId) => {\n        if (enemy.exists()) {\n            // Get current HP safely\n            let currentHP = 0;\n            if (enemy.hp && typeof enemy.hp === 'function') {\n                currentHP = enemy.hp();\n            } else if (typeof enemy.hp === 'number') {\n                currentHP = enemy.hp;\n            }\n\n            enemyStates.push({\n                id: Number(entityId),\n                x: Number(enemy.pos.x),\n                y: Number(enemy.pos.y),\n                hp: Number(currentHP),\n                maxHealth: Number(enemy.maxHealth || 0),\n                type: String(enemy.enemyType || 'basic'),\n                // Shield and armor state for visual sync\n                shieldHealth: Number(enemy.shieldHealth || 0),\n                armorHealth: Number(enemy.armorHealth || 0)\n            });\n        } else {\n            // Enemy destroyed - remove from tracking\n            mpGame.enemies.delete(entityId);\n        }\n    });\n\n    // NOTE: Projectiles are NOT synced via game_state anymore\n    // They are spawned via spawn_projectile messages and then move autonomously\n    // This significantly reduces network traffic (projectiles change every frame)\n    // Just clean up destroyed projectiles from tracking\n    mpGame.projectiles.forEach((projectile, entityId) => {\n        if (!projectile.exists()) {\n            mpGame.projectiles.delete(entityId);\n        }\n    });\n\n    // Collect pickup states\n    mpGame.pickups.forEach((pickup, entityId) => {\n        if (pickup.exists()) {\n            const pickupState = {\n                id: Number(entityId),\n                x: Number(pickup.pos.x),\n                y: Number(pickup.pos.y),\n                type: String(pickup.pickupType || 'xp'),\n                magnetizing: Boolean(pickup.magnetizing || false),\n                isFlyingToUI: Boolean(pickup.isFlyingToUI || false)\n            };\n\n            // Include target player slot if magnetizing\n            if (pickup.magnetizing && pickup.targetPlayer && pickup.targetPlayer.slotIndex !== undefined) {\n                pickupState.targetPlayerSlot = Number(pickup.targetPlayer.slotIndex);\n            }\n\n            pickupStates.push(pickupState);\n        } else {\n            // Pickup collected - remove from tracking\n            mpGame.pickups.delete(entityId);\n        }\n    });\n\n    return {\n        players: playerStates,\n        enemies: enemyStates,\n        projectiles: projectileStates,\n        pickups: pickupStates\n    };\n}\n\n/**\n * Broadcast current game state to all clients (host only)\n */\nfunction broadcastGameState() {\n    if (!mpGame.isHost) return;\n    broadcast('game_state', collectGameState());\n}\n\n/**\n * Send initial game state to a specific peer (host only)\n * Called when a new client joins mid-game\n * @param {string} peerId - Peer ID to send state to\n */\nexport function sendInitialGameState(peerId) {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    console.log('Sending initial game state to new joiner:', peerId);\n    sendToPeer(peerId, 'game_state', collectGameState());\n\n    // Also send all existing entities for mid-game join\n    sendAllExistingEntities(peerId);\n}\n\n/**\n * Send all existing entities to a newly joined peer (host only)\n * This ensures mid-game joiners see all enemies and pickups\n * @param {string} peerId - Peer ID to send entities to\n */\nexport function sendAllExistingEntities(peerId) {\n    if (!mpGame.isHost || !mpGame.isActive || !mpGame.k) return;\n\n    const k = mpGame.k;\n    console.log('[Multiplayer] Sending existing entities to new joiner:', peerId);\n\n    // Send all enemies\n    mpGame.enemies.forEach((enemy, entityId) => {\n        if (enemy && enemy.exists()) {\n            const entityData = {\n                entityId: entityId,\n                entityType: 'enemy',\n                x: enemy.pos.x,\n                y: enemy.pos.y,\n                enemyType: enemy.type || 'basic',\n                floor: enemy.floor || 1,\n                isBoss: enemy.is('boss') || false,\n                isMiniboss: enemy.is('miniboss') || false,\n                health: enemy.hp(),\n                maxHealth: enemy.maxHealth,\n                armorHealth: enemy.armorHealth || 0,\n                shieldHealth: enemy.shieldHealth || 0\n            };\n            sendToPeer(peerId, 'spawn_entity', entityData);\n        }\n    });\n\n    // Send all pickups\n    mpGame.pickups.forEach((pickup, entityId) => {\n        if (pickup && pickup.exists()) {\n            const entityData = {\n                entityId: entityId,\n                entityType: 'pickup',\n                x: pickup.pos.x,\n                y: pickup.pos.y,\n                pickupType: pickup.pickupType || (pickup.is('xpPickup') ? 'xp' : pickup.is('currencyPickup') ? 'currency' : 'powerup'),\n                xpValue: pickup.xpValue || 0,\n                currencyValue: pickup.currencyValue || 0\n            };\n            sendToPeer(peerId, 'spawn_entity', entityData);\n        }\n    });\n\n    console.log('[Multiplayer] Sent', mpGame.enemies.size, 'enemies and', mpGame.pickups.size, 'pickups to new joiner');\n}\n\n/**\n * Send local player input to host (client only)\n */\nfunction sendInputState() {\n    if (mpGame.isHost) return;\n\n    const localPlayer = mpGame.players.get(mpGame.localPlayerSlot);\n    if (!localPlayer || !localPlayer.exists()) return;\n\n    // Extract move as plain object (Vec2 has functions that can't be serialized)\n    // Read from moveDir (local keyboard input) not move (remote network input)\n    const move = localPlayer.moveDir\n        ? { x: Number(localPlayer.moveDir.x || 0), y: Number(localPlayer.moveDir.y || 0) }\n        : { x: 0, y: 0 };\n\n    sendToHost('player_input', {\n        slotIndex: Number(mpGame.localPlayerSlot),\n        move: move,\n        shoot: Boolean(localPlayer.isShooting || false),\n        aimAngle: Number(localPlayer.aimAngle || 0)\n    });\n}\n\n/**\n * Get local player entity\n * @returns {Object|null} Local player entity\n */\nexport function getLocalPlayerEntity() {\n    return mpGame.players.get(mpGame.localPlayerSlot);\n}\n\n/**\n * Check if multiplayer is active\n * @returns {boolean}\n */\nexport function isMultiplayerActive() {\n    return mpGame.isActive;\n}\n\n/**\n * Get multiplayer player count\n * @returns {number}\n */\nexport function getPlayerCount() {\n    return mpGame.players.size;\n}\n\n/**\n * Cleanup multiplayer session\n */\nexport function cleanupMultiplayer() {\n    mpGame.isActive = false;\n    mpGame.players.clear();\n    mpGame.inputBuffer = [];\n\n    // Clear entity tracking to prevent memory leaks\n    mpGame.enemies.clear();\n    mpGame.projectiles.clear();\n    mpGame.pickups.clear();\n\n    // Reset entity ID counter\n    mpGame.nextEntityId = 1;\n\n    // Actually remove message handlers to prevent memory leaks\n    // Host handlers\n    offMessage('player_input');\n    offMessage('pause_request');\n    offMessage('player_death');\n    offMessage('enemy_death');\n    offMessage('resync_request');\n    offMessage('level_up_queued');\n    offMessage('player_emote');\n    offMessage('upgrade_selected');\n    offMessage('synergy_activated');\n    offMessage('achievement_unlocked');\n\n    // Client handlers\n    offMessage('game_state');\n    offMessage('spawn_entity');\n    offMessage('spawn_projectile');\n    offMessage('damage_dealt');\n    offMessage('entity_destroyed');\n    offMessage('boss_enrage');\n    offMessage('players_revived');\n    offMessage('game_seed');\n    offMessage('pause_state');\n    offMessage('xp_gain');\n    offMessage('currency_gain');\n    offMessage('enemy_split');\n    offMessage('player_disconnected');\n    offMessage('host_quit');\n\n    // Clear party callbacks to prevent memory leaks\n    clearPartyCallbacks();\n\n    // Reset handler registration flags (allows re-registration on reconnect)\n    multiplayerClientHandlersRegistered = false;\n    multiplayerHostHandlersRegistered = false;\n}\n\n/**\n * Check if this is the local player\n * @param {Object} player - Player entity to check\n * @returns {boolean}\n */\nexport function isLocalPlayer(player) {\n    return player.mpSlotIndex === mpGame.localPlayerSlot;\n}\n\n/**\n * Register an enemy for multiplayer sync (host only)\n * @param {Object} enemy - Enemy entity\n * @param {Object} creationParams - Parameters used to create this enemy { type, floor }\n * @returns {number} Entity ID assigned to this enemy\n */\nexport function registerEnemy(enemy, creationParams = {}) {\n    if (!mpGame.isHost) return null;\n\n    const entityId = mpGame.nextEntityId++;\n    enemy.mpEntityId = entityId;\n    mpGame.enemies.set(entityId, enemy);\n\n    // Broadcast spawn message to all clients with full creation parameters\n    broadcast('spawn_entity', {\n        id: entityId,\n        entityType: 'enemy',\n        x: enemy.pos.x,\n        y: enemy.pos.y,\n        type: creationParams.type || 'basic',\n        floor: creationParams.floor || 1,\n        isBoss: creationParams.isBoss || false,\n        isBossMinion: creationParams.isBossMinion || false\n    });\n\n    return entityId;\n}\n\n/**\n * Register a projectile for multiplayer sync (host only)\n * @param {Object} projectile - Projectile entity\n * @param {Object} creationParams - Parameters used to create this projectile\n * @returns {number} Entity ID assigned to this projectile\n */\nexport function registerProjectile(projectile, creationParams = {}) {\n    if (!mpGame.isHost) return null;\n\n    const entityId = mpGame.nextEntityId++;\n    projectile.mpEntityId = entityId;\n    mpGame.projectiles.set(entityId, projectile);\n\n    // Extract color from projectile entity\n    let colorArray = [255, 255, 100]; // Default yellow\n    if (projectile.color && projectile.color.r !== undefined) {\n        colorArray = [\n            Math.round(projectile.color.r),\n            Math.round(projectile.color.g),\n            Math.round(projectile.color.b)\n        ];\n    }\n\n    // Broadcast projectile spawn to all clients\n    broadcast('spawn_projectile', {\n        id: Number(entityId),\n        x: Number(projectile.pos.x),\n        y: Number(projectile.pos.y),\n        directionX: Number(projectile.direction.x),\n        directionY: Number(projectile.direction.y),\n        speed: Number(projectile.speed),\n        damage: Number(projectile.damage),\n        piercing: Number(projectile.piercing || 0),\n        obstaclePiercing: Number(projectile.obstaclePiercing || 0),\n        isCrit: Boolean(projectile.isCrit),\n        maxRange: Number(projectile.maxRange),\n        angle: Number(projectile.angle || 0),\n        // Visual properties from projectile entity\n        char: projectile.text || creationParams.char || '*',\n        color: colorArray\n    });\n\n    return entityId;\n}\n\n/**\n * Unregister a projectile from multiplayer tracking (client and host)\n * Called when a projectile is destroyed to prevent memory leaks\n * @param {Object} projectile - Projectile entity to unregister\n */\nexport function unregisterProjectile(projectile) {\n    if (!mpGame.isActive) return;\n\n    // Remove from tracking map using the entity's network ID\n    if (projectile.mpEntityId !== undefined) {\n        mpGame.projectiles.delete(projectile.mpEntityId);\n    }\n}\n\n/**\n * Register a pickup for multiplayer sync (host only)\n * @param {Object} pickup - Pickup entity\n * @param {Object} creationParams - Parameters used to create this pickup { type, value, icon }\n * @returns {number} Entity ID assigned to this pickup\n */\nexport function registerPickup(pickup, creationParams = {}) {\n    if (!mpGame.isHost) return null;\n\n    const entityId = mpGame.nextEntityId++;\n    pickup.mpEntityId = entityId;\n    mpGame.pickups.set(entityId, pickup);\n\n    // Broadcast spawn message to all clients with full creation parameters\n    const spawnData = {\n        id: entityId,\n        entityType: creationParams.type || 'xpPickup',\n        x: pickup.pos.x,\n        y: pickup.pos.y,\n        value: creationParams.value || pickup.value || 1\n    };\n\n    // Add icon for currency pickups\n    if (creationParams.type === 'currencyPickup' && creationParams.icon) {\n        spawnData.icon = creationParams.icon;\n    }\n\n    broadcast('spawn_entity', spawnData);\n\n    return entityId;\n}\n\n/**\n * Unregister a pickup from multiplayer tracking (client and host)\n * Called when a pickup is destroyed to prevent memory leaks\n * @param {Object} pickup - Pickup entity to unregister\n */\nexport function unregisterPickup(pickup) {\n    if (!mpGame.isActive) return;\n\n    // Remove from tracking map using the entity's network ID\n    if (pickup.mpEntityId !== undefined) {\n        mpGame.pickups.delete(pickup.mpEntityId);\n    }\n}\n\n/**\n * Check if we're the host\n * @returns {boolean}\n */\nexport function isHost() {\n    return mpGame.isHost;\n}\n\n/**\n * Broadcast a damage event to all clients (host only)\n * @param {Object} params - Damage event parameters\n * @param {string|number} params.targetId - Target entity ID\n * @param {string} params.targetType - Type of target ('enemy', 'player', 'boss', 'miniboss')\n * @param {number} params.damage - Damage amount\n * @param {boolean} params.isCrit - Whether this was a critical hit\n * @param {number} params.attackerId - Attacker player slot index (optional)\n * @param {number} params.x - X position for visual effects\n * @param {number} params.y - Y position for visual effects\n */\nexport function broadcastDamageEvent(params) {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('damage_dealt', {\n        targetId: Number(params.targetId),\n        targetType: String(params.targetType),\n        damage: Number(params.damage),\n        isCrit: Boolean(params.isCrit || false),\n        attackerId: params.attackerId !== undefined ? Number(params.attackerId) : null,\n        x: Number(params.x),\n        y: Number(params.y)\n    });\n}\n\n/**\n * Broadcast a heal event to all clients (host only)\n * @param {Object} params - Heal event parameters\n * @param {number} params.slotIndex - Player slot index\n * @param {number} params.healAmount - Amount healed\n * @param {number} params.newHP - New HP value\n * @param {string} params.source - Source of healing ('lifesteal', 'regen', 'vampiric', 'pickup')\n */\nexport function broadcastHealEvent(params) {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('player_healed', {\n        slotIndex: Number(params.slotIndex),\n        healAmount: Number(params.healAmount),\n        newHP: Number(params.newHP),\n        source: String(params.source || 'unknown')\n    });\n}\n\n/**\n * Broadcast a dodge event to all clients (host only)\n * @param {Object} params - Dodge event parameters\n * @param {number} params.slotIndex - Player slot index\n * @param {number} params.x - X position for visual\n * @param {number} params.y - Y position for visual\n */\nexport function broadcastDodgeEvent(params) {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('player_dodged', {\n        slotIndex: Number(params.slotIndex),\n        x: Number(params.x),\n        y: Number(params.y)\n    });\n}\n\n/**\n * Broadcast an entity death event to all clients (host only)\n * @param {Object} params - Death event parameters\n * @param {string|number} params.entityId - Entity ID that died\n * @param {string} params.entityType - Type of entity ('enemy', 'player', 'boss', 'miniboss')\n * @param {number} params.x - X position\n * @param {number} params.y - Y position\n * @param {number} params.xpDropped - Amount of XP dropped (optional)\n * @param {number} params.currencyDropped - Amount of currency dropped (optional)\n */\nexport function broadcastDeathEvent(params) {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('entity_destroyed', {\n        entityId: Number(params.entityId),\n        entityType: String(params.entityType),\n        x: Number(params.x),\n        y: Number(params.y),\n        xpDropped: params.xpDropped !== undefined ? Number(params.xpDropped) : 0,\n        currencyDropped: params.currencyDropped !== undefined ? Number(params.currencyDropped) : 0\n    });\n}\n\n/**\n * Broadcast a boss enrage event to all clients (host only)\n * @param {string|number} bossNetworkId - The network ID of the boss that is enraged\n */\nexport function broadcastBossEnrage(bossNetworkId) {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('boss_enrage', {\n        networkId: bossNetworkId,\n    });\n}\n\n/**\n * Broadcast a player revival event to all clients (host only)\n * Called when a level up triggers revival of all dead players\n */\nexport function broadcastRevivalEvent() {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('players_revived', {\n        timestamp: Date.now()\n    });\n}\n\n/**\n * Broadcast game over event to all clients (host only)\n * Called when all players are dead\n * @param {Object} runStats - Run statistics\n * @param {number} currencyEarned - Currency earned this run\n * @param {Array} partyStats - Party statistics for game over screen\n */\nexport function broadcastGameOver(runStats, currencyEarned, partyStats = []) {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('game_over', {\n        runStats: runStats,\n        currencyEarned: currencyEarned,\n        partyStats: partyStats,\n        timestamp: Date.now()\n    });\n}\n\n/**\n * Broadcast host quit to menu to all clients (host only)\n * All clients should return to menu when host quits\n */\nexport function broadcastHostQuit() {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('host_quit', {\n        timestamp: Date.now()\n    });\n}\n\n/**\n * Broadcast powerup weapon application to all clients (host only)\n * Called when a powerup weapon is picked up\n * @param {string} powerupKey - Powerup weapon key\n */\nexport function broadcastPowerupWeaponApplied(powerupKey) {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('powerup_weapon_applied', {\n        powerupKey: powerupKey,\n        timestamp: Date.now()\n    });\n}\n\n/**\n * Broadcast upgrade selection (both host and client)\n * Called when a player selects an upgrade\n * @param {number} slotIndex - Player slot index\n * @param {string} upgradeKey - Selected upgrade key\n */\nexport function broadcastUpgradeSelected(slotIndex, upgradeKey) {\n    if (!mpGame.isActive) return;\n\n    if (mpGame.isHost) {\n        broadcast('upgrade_selected', {\n            slotIndex: slotIndex,\n            upgradeKey: upgradeKey,\n            timestamp: Date.now()\n        });\n    } else {\n        sendToHost('upgrade_selected', {\n            slotIndex: slotIndex,\n            upgradeKey: upgradeKey\n        });\n    }\n}\n\n/**\n * Broadcast level up queued event (both host and client)\n * Called when a player levels up during combat\n * @param {number} slotIndex - Player slot index\n * @param {number} level - New level\n */\nexport function broadcastLevelUpQueued(slotIndex, level) {\n    if (!mpGame.isActive) return;\n\n    if (mpGame.isHost) {\n        broadcast('level_up_queued', {\n            slotIndex: slotIndex,\n            level: level,\n            timestamp: Date.now()\n        });\n    } else {\n        sendToHost('level_up_queued', {\n            slotIndex: slotIndex,\n            level: level\n        });\n    }\n}\n\n/**\n * Broadcast synergy activation (both host and client)\n * Called when synergies are activated\n * @param {number} slotIndex - Player slot index\n * @param {Array<string>} synergyKeys - Activated synergy keys\n */\nexport function broadcastSynergyActivated(slotIndex, synergyKeys) {\n    if (!mpGame.isActive) return;\n\n    if (mpGame.isHost) {\n        broadcast('synergy_activated', {\n            slotIndex: slotIndex,\n            synergies: synergyKeys,\n            timestamp: Date.now()\n        });\n    } else {\n        sendToHost('synergy_activated', {\n            slotIndex: slotIndex,\n            synergies: synergyKeys\n        });\n    }\n}\n\n/**\n * Broadcast powerup weapon expiration (host only)\n * Called when powerup weapon expires (ammo or time)\n * @param {number} slotIndex - Player slot index\n * @param {string} powerupKey - Expired powerup key\n */\nexport function broadcastPowerupExpired(slotIndex, powerupKey) {\n    if (!mpGame.isHost || !mpGame.isActive) return;\n\n    broadcast('powerup_expired', {\n        slotIndex: slotIndex,\n        powerupKey: powerupKey,\n        timestamp: Date.now()\n    });\n}\n\n/**\n * Get the game seed (for synchronized random generation)\n * @returns {number} Game seed\n */\nexport function getGameSeed() {\n    return mpGame.gameSeed;\n}\n\n/**\n * Check if game seed has been set (not 0)\n * @returns {boolean} True if seed is set\n */\nexport function hasGameSeed() {\n    return mpGame.gameSeed !== 0;\n}\n\n/**\n * Set callback for when game_seed is received (clients only)\n * @param {Function} callback - Function to call when seed is received\n */\nexport function onGameSeedReceived(callback) {\n    mpGame.onGameSeedCallback = callback;\n}\n\n/**\n * Set current floor for seeded RNG\n * @param {number} floor - Floor number\n */\nexport function setCurrentFloor(floor) {\n    mpGame.currentFloor = floor;\n    // Reset floor RNG with new seed based on floor\n    const floorSeed = createSeed(mpGame.gameSeed, floor);\n    mpGame.floorRng = new SeededRandom(floorSeed);\n}\n\n/**\n * Set current room for seeded RNG\n * @param {number} roomX - Room X coordinate\n * @param {number} roomY - Room Y coordinate\n */\nexport function setCurrentRoom(roomX, roomY) {\n    mpGame.currentRoom = { x: roomX, y: roomY };\n}\n\n/**\n * Get a seeded RNG for the current room\n * Creates a deterministic RNG based on floor and room coordinates\n * @returns {SeededRandom} Seeded random number generator for this room\n */\nexport function getRoomRNG() {\n    const seed = createSeed(mpGame.gameSeed, mpGame.currentFloor, mpGame.currentRoom.x, mpGame.currentRoom.y);\n    return new SeededRandom(seed);\n}\n\n/**\n * Get and clear the first room template key (for clients to use when loading first room)\n * @returns {string|null} Template key or null if not set\n */\nexport function getFirstRoomTemplateKey() {\n    const key = mpGame.firstRoomTemplateKey;\n    mpGame.firstRoomTemplateKey = null; // Clear after use\n    return key;\n}\n\n/**\n * Get the floor RNG (for floor-wide generation like floor maps)\n * @returns {SeededRandom} Seeded random number generator for this floor\n */\nexport function getFloorRNG() {\n    return mpGame.floorRng;\n}\n\n/**\n * Get a seeded RNG for upgrade selection\n * Creates a deterministic RNG based on player index and level\n * @param {number} playerIndex - Player index (0 for host, 1+ for clients)\n * @param {number} playerLevel - Current player level\n * @returns {SeededRandom} Seeded random number generator for this upgrade draft\n */\nexport function getUpgradeRNG(playerIndex, playerLevel) {\n    const seed = createSeed(mpGame.gameSeed, playerIndex, playerLevel);\n    return new SeededRandom(seed);\n}\n\n/**\n * Broadcast game seed to all clients (host only)\n * Called when game starts to sync RNG\n * @param {string} firstRoomTemplateKey - Key of the first room template\n */\nexport function broadcastGameSeed(firstRoomTemplateKey = null) {\n    if (!mpGame.isHost) return;\n\n    broadcast('game_seed', {\n        seed: mpGame.gameSeed,\n        roomTemplateKey: firstRoomTemplateKey\n    });\n}\n\n/**\n * Broadcast pause state to all clients (host only)\n * @param {boolean} paused - Whether the game should be paused\n */\nexport function broadcastPauseState(paused) {\n    if (!mpGame.isHost) return;\n\n    broadcast('pause_state', { paused });\n}\n\n/**\n * Send pause request to host (client only)\n * @param {boolean} paused - Whether the game should be paused\n */\nexport function sendPauseRequest(paused) {\n    if (mpGame.isHost) return; // Host doesn't send requests to itself\n\n    sendToHost('pause_request', { paused });\n}\n\n/**\n * Send enemy death notification to host (client only)\n * Called when a client kills an enemy to notify host and sync state\n * @param {Object} deathData - Enemy death data { entityId, entityType, x, y }\n */\nexport function sendEnemyDeath(deathData) {\n    if (mpGame.isHost) return; // Host doesn't send to itself\n\n    sendToHost('enemy_death', deathData);\n}\n\n/**\n * Broadcast obstacle data to all clients (host only)\n * @param {Array} obstacles - Array of obstacle data objects\n * @param {Object} doorStates - Optional door blocked states { north, south, east, west }\n */\nexport function broadcastObstacles(obstacles, doorStates = null) {\n    if (!mpGame.isHost) return;\n\n    broadcast('obstacle_data', { obstacles, doorStates });\n}\n\n/**\n * Broadcast room completion to all clients (host only)\n * Called when the host detects all enemies are defeated\n */\nexport function broadcastRoomCompletion() {\n    if (!mpGame.isHost) return;\n\n    broadcast('room_completed', {});\n}\n\n/**\n * Broadcast XP gain to all clients (host only)\n * Called when XP is collected so all players gain XP\n */\nexport function broadcastXPGain(xpValue) {\n    if (!mpGame.isHost) return;\n\n    broadcast('xp_gain', { value: xpValue });\n}\n\n/**\n * Broadcast currency gain to all clients (host only)\n * Called when currency is collected so all players gain currency\n */\nexport function broadcastCurrencyGain(currencyValue) {\n    if (!mpGame.isHost) return;\n\n    broadcast('currency_gain', { value: currencyValue });\n}\n\n/**\n * Get and clear any pending XP accumulated while player was in upgrade draft\n * @returns {number} Pending XP amount (0 if none)\n */\nexport function getAndClearPendingXP() {\n    const pending = mpGame.pendingXP;\n    mpGame.pendingXP = 0;\n    return pending;\n}\n\n/**\n * Broadcast emote to all players\n * @param {number} slotIndex - Player slot showing emote\n * @param {string} emoteType - Type of emote ('exclamation' or 'heart')\n */\nexport function broadcastEmote(slotIndex, emoteType) {\n    if (mpGame.isHost) {\n        broadcast('player_emote', { slotIndex, emoteType });\n    } else {\n        sendToHost('player_emote', { slotIndex, emoteType });\n    }\n}\n\n/**\n * Broadcast room transition to all clients (host only)\n * Called when transitioning to a new room to sync spawn positions and player stats\n * @param {string} entryDirection - Direction players will enter from ('north', 'south', 'east', 'west', or null)\n * @param {Array} allPlayerStats - Stats for all players to restore after transition\n * @param {string} gridDirection - Direction moved on floor map\n * @param {number} currentFloor - Current floor number\n * @param {string} roomTemplateKey - Key of the room template for obstacle sync\n */\nexport function broadcastRoomTransition(entryDirection, allPlayerStats = null, gridDirection = null, currentFloor = null, roomTemplateKey = null) {\n    if (!mpGame.isHost) return;\n\n    broadcast('room_transition', {\n        entryDirection: entryDirection,\n        allPlayerStats: allPlayerStats,\n        gridDirection: gridDirection,\n        currentFloor: currentFloor,\n        roomTemplateKey: roomTemplateKey\n    });\n}\n\n// Store pending obstacles for next room (set by host before transition)\nlet pendingObstacles = null;\n\n/**\n * Set pending obstacles to be sent with next scene load\n * @param {Array} obstacles - Array of obstacle data\n */\nexport function setPendingObstacles(obstacles) {\n    pendingObstacles = obstacles;\n}\n\n/**\n * Get and clear pending obstacles\n * @returns {Array|null} Pending obstacles or null\n */\nexport function getPendingObstacles() {\n    const obstacles = pendingObstacles;\n    pendingObstacles = null;\n    return obstacles;\n}\n\n/**\n * Broadcast enemy split event to all clients (host only)\n * Called when an enemy splits (e.g., slimes) to update the total enemy count\n * @param {number} splitCount - Number of enemies created by splitting\n */\nexport function broadcastEnemySplit(splitCount) {\n    if (!mpGame.isHost) return;\n\n    broadcast('enemy_split', { count: splitCount });\n}\n\n/**\n * Broadcast player death event (both host and client)\n * Called immediately when a player dies to ensure all clients are synced\n * @param {number} slotIndex - Player slot that died\n */\nexport function broadcastPlayerDeath(slotIndex) {\n    if (!mpGame.isActive) return;\n\n    if (mpGame.isHost) {\n        // Host broadcasts to all clients\n        broadcast('player_death', { slotIndex });\n    } else {\n        // Client sends to host\n        sendToHost('player_death', { slotIndex });\n    }\n}\n\n/**\n * Request full game state re-sync from host (client only)\n * Called when client detects desynchronization\n */\nexport function requestResync() {\n    if (mpGame.isHost) return; // Host doesn't request resyncs\n\n    sendToHost('resync_request', { timestamp: Date.now() });\n}\n\n/**\n * Get the local player's slot index\n * @returns {number} Local player's slot index\n */\nexport function getLocalPlayerSlot() {\n    return mpGame.localPlayerSlot;\n}\n\n/**\n * Broadcast achievement unlock to all players\n * @param {string} achievementId - ID of the achievement that was unlocked\n * @param {number} playerSlotIndex - Slot index of the player who unlocked it\n */\nexport function broadcastAchievementUnlocked(achievementId, playerSlotIndex) {\n    if (!mpGame.isActive) return;\n\n    const party = getParty();\n    const player = party.slots[playerSlotIndex];\n    const playerName = player?.name || `Player ${playerSlotIndex + 1}`;\n\n    // Broadcast to all players (including ourselves for consistency)\n    broadcast('achievement_unlocked', {\n        achievementId,\n        playerSlotIndex,\n        playerName\n    });\n}\n","/**\n * Object Pooling System\n *\n * Generic object pooling for performance optimization.\n * Reuses game objects instead of creating/destroying them repeatedly.\n *\n * Usage:\n * - Create a pool with a factory function and reset function\n * - Use acquire() to get an object from the pool\n * - Use release(obj) to return an object to the pool\n * - Use clear() to destroy all pooled objects\n */\n\nexport class ObjectPool {\n    /**\n     * Create a new object pool\n     * @param {Object} k - Kaplay instance\n     * @param {Function} createFn - Function to create a new object: (k) => object\n     * @param {Function} resetFn - Function to reset an object for reuse: (obj, ...args) => void\n     * @param {number} initialSize - Number of objects to pre-create\n     */\n    constructor(k, createFn, resetFn, initialSize = 0) {\n        this.k = k;\n        this.createFn = createFn;\n        this.resetFn = resetFn;\n        this.pool = [];\n        this.active = new Set();\n\n        // Pre-warm the pool\n        for (let i = 0; i < initialSize; i++) {\n            const obj = this.createFn(k);\n            obj.hidden = true;\n            if (obj.paused !== undefined) obj.paused = true;\n            this.pool.push(obj);\n        }\n    }\n\n    /**\n     * Acquire an object from the pool (or create a new one if empty)\n     * @param {...any} args - Arguments to pass to the reset function\n     * @returns {Object} - The acquired object\n     */\n    acquire(...args) {\n        let obj;\n\n        if (this.pool.length > 0) {\n            // Reuse from pool\n            obj = this.pool.pop();\n            obj.hidden = false;\n            if (obj.paused !== undefined) obj.paused = false;\n        } else {\n            // Create new object\n            obj = this.createFn(this.k);\n        }\n\n        // Reset/initialize the object with provided arguments\n        if (this.resetFn) {\n            this.resetFn(obj, ...args);\n        }\n\n        // Track as active\n        this.active.add(obj);\n        obj._pooled = true;\n\n        return obj;\n    }\n\n    /**\n     * Release an object back to the pool\n     * @param {Object} obj - The object to release\n     */\n    release(obj) {\n        if (!obj || !obj._pooled) return;\n\n        // Check if object still exists (wasn't destroyed externally)\n        if (!obj.exists || !obj.exists()) {\n            this.active.delete(obj);\n            return;\n        }\n\n        // Hide the object instead of destroying it\n        obj.hidden = true;\n        if (obj.paused !== undefined) obj.paused = true;\n\n        // Move off-screen to prevent accidental collisions\n        if (obj.pos) {\n            obj.pos.x = -9999;\n            obj.pos.y = -9999;\n        }\n\n        // Remove from active tracking\n        this.active.delete(obj);\n\n        // Add back to pool\n        this.pool.push(obj);\n    }\n\n    /**\n     * Clear all objects (both pooled and active)\n     */\n    clear() {\n        // Destroy all pooled objects\n        for (const obj of this.pool) {\n            if (obj.exists && obj.exists()) {\n                this.k.destroy(obj);\n            }\n        }\n        this.pool = [];\n\n        // Destroy all active objects\n        for (const obj of this.active) {\n            if (obj.exists && obj.exists()) {\n                this.k.destroy(obj);\n            }\n        }\n        this.active.clear();\n    }\n\n    /**\n     * Get the current pool size\n     * @returns {number} - Number of objects in the pool\n     */\n    getPoolSize() {\n        return this.pool.length;\n    }\n\n    /**\n     * Get the current number of active objects\n     * @returns {number} - Number of active objects\n     */\n    getActiveCount() {\n        return this.active.size;\n    }\n\n    /**\n     * Prewarm the pool with a specific number of objects\n     * @param {number} count - Number of objects to add to the pool\n     */\n    prewarm(count) {\n        for (let i = 0; i < count; i++) {\n            const obj = this.createFn(this.k);\n            obj.hidden = true;\n            if (obj.paused !== undefined) obj.paused = true;\n            obj._pooled = true;\n            // Move off-screen\n            if (obj.pos) {\n                obj.pos.x = -9999;\n                obj.pos.y = -9999;\n            }\n            this.pool.push(obj);\n        }\n    }\n}\n\n// Pool manager to hold all object pools\nconst pools = {\n    projectiles: null,\n    particles: null\n};\n\n/**\n * Initialize object pools for the game\n * @param {Object} k - Kaplay instance\n */\nexport function initObjectPools(k) {\n    // Projectile pool\n    pools.projectiles = new ObjectPool(\n        k,\n        // Create function\n        (k) => {\n            const proj = k.add([\n                k.text('*', { size: 16 }),\n                k.pos(-9999, -9999),\n                k.anchor('center'),\n                k.color(255, 255, 100),\n                k.rotate(0),\n                k.area(),\n                'projectile'\n            ]);\n            proj.hidden = true;\n            return proj;\n        },\n        // Reset function\n        (proj, x, y, direction, speed, damage, piercing, obstaclePiercing, isCrit, maxRange) => {\n            proj.pos.x = x;\n            proj.pos.y = y;\n            proj.damage = damage;\n            proj.piercing = piercing || 0;\n            proj.obstaclePiercing = obstaclePiercing || 0;\n            proj.piercedEnemies = new Set();\n            proj.piercedObstacles = new Set();\n            proj.isCrit = isCrit || false;\n            proj.maxRange = maxRange || 750;\n            proj.distanceTraveled = 0;\n            proj.direction = direction;\n            proj.speed = speed;\n            proj.isBoomerang = false;\n            proj.isReturning = false;\n            proj.ownerPlayer = null;\n            proj.returnSpeedMultiplier = 1.2;\n            proj.isExplosive = false;\n            proj.isChainLightning = false;\n            proj.isEnemyProjectile = false;\n            proj.isBossProjectile = false;\n            proj.isReflected = false;\n            proj.reflectionCount = 0;\n            proj.chainedEnemies = null;\n            proj.chainJumps = 0;\n            proj.ownerSlotIndex = undefined;\n            proj.burnDamage = null;\n            proj.burnDuration = null;\n\n            // Reset visuals\n            proj.text = '*';\n            proj.color = isCrit ? k.rgb(255, 200, 0) : k.rgb(255, 255, 100);\n            const angle = (Math.atan2(direction.y, direction.x) * (180 / Math.PI)) + 90;\n            proj.angle = angle;\n        },\n        50 // Pre-create 50 projectiles\n    );\n\n    // Particle pool\n    pools.particles = new ObjectPool(\n        k,\n        // Create function\n        (k) => {\n            const particle = k.add([\n                k.text('*', { size: 12 }),\n                k.pos(-9999, -9999),\n                k.anchor('center'),\n                k.color(255, 255, 255),\n                k.z(100),\n                'particle'\n            ]);\n            particle.hidden = true;\n            return particle;\n        },\n        // Reset function\n        (particle, x, y, options = {}) => {\n            const {\n                char = '*',\n                size = 12,\n                color = [255, 255, 255],\n                velocity = { x: 0, y: 0 },\n                gravity = 0,\n                lifetime = 1.0,\n                fadeStart = 0.3,\n                friction = 0.95,\n                zIndex = 100\n            } = options;\n\n            particle.pos.x = x;\n            particle.pos.y = y;\n            particle.text = char;\n            // Note: KAPLAY text size can't be changed dynamically, so we use default\n            particle.color = k.rgb(...color);\n            particle.z = zIndex;\n            particle.opacity = 1;\n\n            // Physics properties\n            particle.velocity = { x: velocity.x, y: velocity.y };\n            particle.gravity = gravity;\n            particle.friction = friction;\n            particle.lifetime = lifetime;\n            particle.fadeStart = fadeStart;\n            particle.age = 0;\n            particle.initialOpacity = 1.0;\n        },\n        100 // Pre-create 100 particles\n    );\n}\n\n/**\n * Get the projectile pool\n * @returns {ObjectPool|null} - The projectile pool\n */\nexport function getProjectilePool() {\n    return pools.projectiles;\n}\n\n/**\n * Get the particle pool\n * @returns {ObjectPool|null} - The particle pool\n */\nexport function getParticlePool() {\n    return pools.particles;\n}\n\n/**\n * Clear all object pools\n */\nexport function clearAllPools() {\n    if (pools.projectiles) {\n        pools.projectiles.clear();\n        pools.projectiles = null;\n    }\n    if (pools.particles) {\n        pools.particles.clear();\n        pools.particles = null;\n    }\n}\n\n/**\n * Get pool statistics for debugging\n * @returns {Object} - Pool statistics\n */\nexport function getPoolStats() {\n    return {\n        projectiles: pools.projectiles ? {\n            pooled: pools.projectiles.getPoolSize(),\n            active: pools.projectiles.getActiveCount()\n        } : null,\n        particles: pools.particles ? {\n            pooled: pools.particles.getPoolSize(),\n            active: pools.particles.getActiveCount()\n        } : null\n    };\n}\n","/**\n * Projectile Entity\n *\n * Creates and manages bullet/projectile entities:\n * - Player and enemy projectiles\n * - Piercing mechanics (enemy and obstacle)\n * - Critical hit visual feedback\n * - Range limiting\n * - Lifetime tracking\n * - Collision detection and cleanup\n * - Object pooling support for performance\n */\n\n// Configuration imports\nimport { WEAPON_CONFIG } from '../config/constants.js';\nimport { registerProjectile, isHost, isMultiplayerActive, unregisterProjectile } from '../systems/multiplayerGame.js';\nimport { getProjectilePool } from '../systems/objectPool.js';\n\n// Track projectiles that use pooling for proper cleanup\nlet pooledProjectileUpdateHandler = null;\n\nexport function createProjectile(k, x, y, direction, speed, damage, piercing = 0, obstaclePiercing = 0, isCrit = false, maxRange = null) {\n    // Calculate rotation angle from direction vector\n    // Add 90 degrees offset since most bullet characters (like ) are vertical by default\n    const angle = (Math.atan2(direction.y, direction.x) * (180 / Math.PI)) + 90;\n\n    const projectile = k.add([\n        k.text('*', { size: 16 }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(isCrit ? 255 : 255, isCrit ? 200 : 255, isCrit ? 0 : 100), // Orange/red for crits\n        k.rotate(angle), // Rotate to face direction of travel\n        k.area(),\n        'projectile'\n    ]);\n\n    projectile.damage = damage;\n    projectile.piercing = piercing; // Number of enemies this can pass through\n    projectile.obstaclePiercing = obstaclePiercing; // Number of obstacles this can pass through (separate from enemy piercing)\n    projectile.piercedEnemies = new Set(); // Track which enemies this has already hit\n    projectile.piercedObstacles = new Set(); // Track which obstacles this has already hit\n    projectile.isCrit = isCrit;\n    // Set max range - use provided range or default\n    projectile.maxRange = maxRange || WEAPON_CONFIG.DEFAULT_WEAPON_RANGE;\n    projectile.distanceTraveled = 0;\n    projectile.direction = direction; // Store direction for manual movement\n    projectile.speed = speed; // Store speed for manual movement\n\n    // Boomerang properties (set by weapon system when creating boomerang projectiles)\n    projectile.isBoomerang = false;\n    projectile.isReturning = false;\n    projectile.ownerPlayer = null; // Reference to player for return targeting\n    projectile.returnSpeedMultiplier = 1.2;\n    \n    // Method to apply weapon visual properties\n    projectile.useWeaponVisual = function(weaponDef) {\n        if (weaponDef && weaponDef.char) {\n            // Update text directly (KAPLAY allows direct text assignment)\n            projectile.text = weaponDef.char;\n        }\n        if (weaponDef && weaponDef.color) {\n            // Keep crit color if it's a crit, otherwise use weapon color\n            if (!projectile.isCrit) {\n                projectile.color = k.rgb(...weaponDef.color);\n            }\n        }\n        if (weaponDef && weaponDef.range) {\n            projectile.maxRange = weaponDef.range;\n        }\n    };\n\n    // Manual movement and range management\n    projectile.onUpdate(() => {\n        if (k.paused) return;\n\n        // Boomerang return logic\n        if (projectile.isBoomerang) {\n            if (!projectile.isReturning) {\n                // Moving outward\n                const moveAmount = projectile.direction.scale(projectile.speed * k.dt());\n                projectile.distanceTraveled += moveAmount.len();\n\n                projectile.pos.x += moveAmount.x;\n                projectile.pos.y += moveAmount.y;\n\n                // Check if should start returning\n                if (projectile.distanceTraveled >= projectile.maxRange) {\n                    projectile.isReturning = true;\n                    projectile.piercedEnemies.clear(); // Reset hit tracking so it can hit enemies on return\n                    projectile.distanceTraveled = 0;\n                }\n            } else {\n                // Returning to player\n                if (projectile.ownerPlayer && projectile.ownerPlayer.exists() && !projectile.ownerPlayer.isDead) {\n                    const toPlayer = k.vec2(\n                        projectile.ownerPlayer.pos.x - projectile.pos.x,\n                        projectile.ownerPlayer.pos.y - projectile.pos.y\n                    );\n                    const distToPlayer = toPlayer.len();\n\n                    // Move toward player\n                    if (distToPlayer > 0) {\n                        const returnDir = toPlayer.unit();\n                        const returnSpeed = projectile.speed * projectile.returnSpeedMultiplier;\n                        const moveAmount = returnDir.scale(returnSpeed * k.dt());\n\n                        projectile.pos.x += moveAmount.x;\n                        projectile.pos.y += moveAmount.y;\n                        projectile.direction = returnDir; // Update direction for rotation\n\n                        // Destroy when close to player\n                        if (distToPlayer < 30) {\n                            k.destroy(projectile);\n                            return;\n                        }\n                    }\n                } else {\n                    // No player to return to - destroy\n                    k.destroy(projectile);\n                    return;\n                }\n            }\n\n            // Update rotation for boomerang visual\n            const angle = (Math.atan2(projectile.direction.y, projectile.direction.x) * (180 / Math.PI)) + 90;\n            projectile.angle = angle;\n            return;\n        }\n\n        // Normal projectile movement\n        const moveAmount = projectile.direction.scale(projectile.speed * k.dt());\n        const distanceThisFrame = moveAmount.len();\n        projectile.distanceTraveled += distanceThisFrame;\n\n        projectile.pos.x += moveAmount.x;\n        projectile.pos.y += moveAmount.y;\n\n        // Remove if exceeded max range\n        if (projectile.distanceTraveled >= projectile.maxRange) {\n            k.destroy(projectile);\n            return;\n        }\n\n        // Remove if out of bounds\n        if (projectile.pos.x < 0 || projectile.pos.x > k.width() ||\n            projectile.pos.y < 0 || projectile.pos.y > k.height()) {\n            k.destroy(projectile);\n        }\n    });\n\n    // Multiplayer: Register projectile for network sync if host\n    if (isMultiplayerActive() && isHost()) {\n        registerProjectile(projectile);\n    }\n\n    // Cleanup: Remove from tracking map when destroyed (prevents memory leak)\n    if (isMultiplayerActive()) {\n        projectile.onDestroy(() => {\n            unregisterProjectile(projectile);\n        });\n    }\n\n    return projectile;\n}\n\n/**\n * Release a projectile back to the pool instead of destroying it\n * Falls back to k.destroy if pooling is not enabled\n * @param {Object} k - Kaplay instance\n * @param {Object} projectile - The projectile to release\n */\nexport function releaseProjectile(k, projectile) {\n    if (!projectile || !projectile.exists()) return;\n\n    // Unregister from multiplayer tracking\n    if (isMultiplayerActive()) {\n        unregisterProjectile(projectile);\n    }\n\n    // Try to release to pool, otherwise destroy\n    const pool = getProjectilePool();\n    if (pool && projectile._pooled) {\n        pool.release(projectile);\n    } else {\n        k.destroy(projectile);\n    }\n}\n\n","/**\n * Enemy Type Definitions\n *\n * All enemy types and their properties.\n * Extracted from enemy.js for better organization and maintainability.\n */\n\nexport const ENEMY_TYPES = {\n    // =================================================================\n    // FLOOR 1 ENEMIES\n    // =================================================================\n    rusher: {\n        name: 'Security Guard',\n        char: '', // Right-pointing triangle\n        color: [255, 150, 100],\n        baseHealth: 25, // 20-30 range\n        baseSpeed: 90, // 80-100 range\n        size: 18,\n        baseXPValue: 2, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 9 // 8-10 range\n    },\n    shooter: {\n        name: 'Camera Operator',\n        char: '', // White diamond containing black small diamond\n        color: [100, 200, 255],\n        baseHealth: 30, // 25-35 range\n        baseSpeed: 70, // 60-80 range\n        size: 18,\n        baseXPValue: 2, // Reduced by 3x for balance\n        behavior: 'shoot',\n        fireRate: 0.53, // Shots per second (reduced by 1/3 from 0.8)\n        projectileSpeed: 200,\n        projectileDamage: 7 // 6-8 range\n    },\n    zombie: {\n        name: 'Audience Member',\n        char: '', // Skull and crossbones\n        color: [150, 150, 150],\n        baseHealth: 45, // 40-50 range\n        baseSpeed: 50, // 40-60 range\n        size: 20,\n        baseXPValue: 3, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 11 // 10-12 range\n    },\n    slime: {\n        name: 'Fan',\n        char: '', // Black circle\n        color: [100, 255, 100],\n        baseHealth: 12, // 10-15 range\n        baseSpeed: 40, // 30-50 range\n        size: 16,\n        baseXPValue: 1, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 5,\n        splits: true // Splits on death\n    },\n    bat: {\n        name: 'Stagehand',\n        char: '', // Black down triangle\n        color: [200, 150, 255],\n        baseHealth: 10, // 8-12 range\n        baseSpeed: 135, // 120-150 range\n        size: 14,\n        baseXPValue: 2, // Reduced by 3x for balance\n        behavior: 'erratic',\n        damage: 6 // 5-7 range\n    },\n\n    // =================================================================\n    // FLOOR 2 ENEMIES\n    // =================================================================\n    charger: {\n        name: 'Head of Security',\n        char: '', // Right arrow\n        color: [255, 200, 100],\n        baseHealth: 20, // 15-25 range\n        baseSpeed: 175, // 150-200 range (charge speed)\n        size: 18,\n        baseXPValue: 3, // Reduced by 3x for balance\n        behavior: 'charge',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 17, // 15-20 range\n        chargeCooldown: 3 // Seconds between charges\n    },\n    turret: {\n        name: 'Camera Director',\n        char: '', // Box drawing cross\n        color: [200, 200, 200],\n        baseHealth: 60, // 50-70 range\n        baseSpeed: 0, // Stationary\n        size: 20,\n        baseXPValue: 3, // Reduced by 3x for balance\n        behavior: 'turret',\n        fireRate: 1.2, // Shots per second\n        projectileSpeed: 250,\n        projectileDamage: 13 // 12-15 range\n    },\n    heavyTank: {\n        name: 'Bouncer',\n        char: '', // Full block\n        color: [150, 150, 255],\n        baseHealth: 125, // 100-150 range\n        baseSpeed: 40, // 30-50 range\n        size: 24,\n        baseXPValue: 5, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 22 // 20-25 range\n    },\n    zippy: {\n        name: 'Runner',\n        char: '', // Circle with left half black\n        color: [255, 255, 150],\n        baseHealth: 7, // 5-10 range\n        baseSpeed: 200, // 180-220 range\n        size: 14,\n        baseXPValue: 2, // Reduced by 3x for balance\n        behavior: 'erratic',\n        damage: 5 // 4-6 range\n    },\n    exploder: {\n        name: 'Pyrotechnics Tech',\n        char: '', // Bullseye\n        color: [255, 100, 50],\n        baseHealth: 25, // 20-30 range\n        baseSpeed: 80, // 70-90 range\n        size: 18,\n        baseXPValue: 3, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart',\n        damage: 8,\n        explodes: true, // Explodes on death\n        explosionDamage: 17, // 15-20 range\n        explosionRadius: 60 // Pixels\n    },\n    orbiter: {\n        name: 'Floor Manager',\n        char: '', // Fisheye\n        color: [255, 150, 0],\n        baseHealth: 35, // Slightly tankier\n        baseSpeed: 60, // Slower, methodical movement\n        size: 20,\n        baseXPValue: 4, // Reduced by 3x for balance\n        behavior: 'perimeter', // Walks around edge of map\n        pathfindingMode: 'perimeter',\n        damage: 10,\n        explodes: true, // Explodes into shrapnel\n        explosionDamage: 20,\n        explosionRadius: 80,\n        shrapnel: true, // Shoots projectiles in all directions on death\n        shrapnelCount: 12 // Number of projectiles\n    },\n    splitter: {\n        name: 'Intern',\n        char: '', // White diamond\n        color: [200, 255, 200],\n        baseHealth: 40, // 35-45 range\n        baseSpeed: 75, // 70-80 range\n        size: 20,\n        baseXPValue: 3,\n        behavior: 'rush',\n        pathfindingMode: 'smart',\n        damage: 8,\n        splits: true, // Splits into 2 smaller copies on death\n        splitCount: 2\n    },\n\n    // =================================================================\n    // FLOOR 3 ENEMIES\n    // =================================================================\n    mage: {\n        name: 'Lighting Director',\n        char: '', // Four-pointed star\n        color: [200, 100, 255],\n        baseHealth: 70, // 60-80 range\n        baseSpeed: 50, // 40-60 range\n        size: 20,\n        baseXPValue: 4, // Reduced by 3x for balance\n        behavior: 'shoot',\n        fireRate: 0.6, // Slower but more powerful\n        projectileSpeed: 180,\n        projectileDamage: 12 // 10-15 range\n    },\n    shieldBearer: {\n        name: 'Stage Manager',\n        char: '', // Dark shade\n        color: [150, 150, 200],\n        baseHealth: 90, // 80-100 range\n        baseSpeed: 40, // 30-50 range\n        size: 22,\n        baseXPValue: 5, // Reduced by 3x for balance\n        behavior: 'shield',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 15,\n        blocksProjectiles: true // Blocks from front (simplified for now)\n    },\n    golem: {\n        name: 'Set Designer',\n        char: '', // Black medium square\n        color: [100, 100, 100],\n        baseHealth: 250, // 200-300 range\n        baseSpeed: 30, // 20-40 range\n        size: 26,\n        baseXPValue: 7, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 30 // 25-35 range\n    },\n    wraith: {\n        name: 'Editor',\n        char: '', // Almost equal (wave)\n        color: [150, 150, 255],\n        baseHealth: 20, // 15-25 range\n        baseSpeed: 225, // 200-250 range\n        size: 16,\n        baseXPValue: 3, // Reduced by 3x for balance\n        behavior: 'teleport',\n        damage: 13, // 12-15 range\n        teleportCooldown: 4, // Seconds between teleports\n        teleportRange: 150 // Teleport distance\n    },\n    spawner: {\n        name: 'Casting Director',\n        char: '', // Circle with upper right quadrant black\n        color: [255, 150, 100],\n        baseHealth: 80, // 70-90 range\n        baseSpeed: 40, // 30-50 range\n        size: 20,\n        baseXPValue: 5, // Reduced by 3x for balance\n        behavior: 'spawner',\n        damage: 8,\n        spawnInterval: 6, // Spawn every 6 seconds\n        spawnType: 'rusher' // Spawns basic rushers\n    },\n    buffer: {\n        name: 'Assistant Director',\n        char: '', // Heavy plus\n        color: [255, 200, 100],\n        baseHealth: 35, // 30-40 range\n        baseSpeed: 50, // 40-60 range\n        size: 18,\n        baseXPValue: 3, // Reduced by 3x for balance\n        behavior: 'buffer',\n        damage: 6,\n        buffRadius: 100, // Buffs enemies within this radius\n        buffAmount: 0.2 // +20% speed and damage\n    },\n    phaser: {\n        name: 'Ghost Writer',\n        char: '', // Dotted circle\n        color: [180, 180, 255],\n        baseHealth: 25, // 20-30 range\n        baseSpeed: 100, // 90-110 range\n        size: 18,\n        baseXPValue: 3,\n        behavior: 'phase',\n        pathfindingMode: 'none', // Phases through obstacles, no pathfinding needed\n        damage: 10,\n        phaseOpacity: 0.5, // Semi-transparent\n        phaseThroughObstacles: true // Can move through obstacles\n    },\n    mimic: {\n        name: 'Stunt Double',\n        char: '@', // Same as player\n        color: [255, 100, 100],\n        baseHealth: 35, // 30-40 range\n        baseSpeed: 150, // Matches player speed\n        size: 18,\n        baseXPValue: 4,\n        behavior: 'mimic',\n        pathfindingMode: 'none',\n        damage: 12,\n        mimicDuration: 2.0, // Seconds to copy player movement\n        mimicCooldown: 4.0 // Seconds between mimic attempts\n    },\n\n    // =================================================================\n    // FLOOR 4 ENEMIES\n    // =================================================================\n    healer: {\n        name: 'Producer',\n        char: '', // Open center cross\n        color: [100, 255, 150],\n        baseHealth: 70, // 60-80 range\n        baseSpeed: 40, // 30-50 range\n        size: 20,\n        baseXPValue: 4, // Reduced by 3x for balance\n        behavior: 'healer',\n        damage: 8,\n        healRadius: 120, // Heals enemies within this radius\n        healAmount: 12, // 10-15 range\n        healInterval: 4 // Heal every 4 seconds\n    },\n    teleporter: {\n        name: 'Executive Producer',\n        char: '', // Left half black circle\n        color: [200, 150, 255],\n        baseHealth: 25, // 20-30 range\n        baseSpeed: 90, // 80-100 range\n        size: 18,\n        baseXPValue: 3, // Reduced by 3x for balance\n        behavior: 'teleportPlayer',\n        damage: 8,\n        teleportRange: 200, // Teleport player this distance\n        teleportCooldown: 5 // Seconds between teleports\n    },\n    freezer: {\n        name: 'Network Executive',\n        char: '', // Snowflake\n        color: [150, 200, 255],\n        baseHealth: 60, // 50-70 range\n        baseSpeed: 50, // 40-60 range\n        size: 20,\n        baseXPValue: 4, // Reduced by 3x for balance\n        behavior: 'freeze',\n        damage: 10,\n        slowRadius: 80, // Slows player within this radius\n        slowAmount: 0.4 // -40% speed\n    },\n    leech: {\n        name: 'Talent Agent',\n        char: '', // Right half black circle\n        color: [255, 100, 150],\n        baseHealth: 30, // 25-35 range\n        baseSpeed: 80, // 70-90 range\n        size: 18,\n        baseXPValue: 3, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 8,\n        lifesteal: 7 // 5-10 range, heals this much on hit\n    },\n    reflector: {\n        name: 'Mirror Master',\n        char: '', // Diamond with dot\n        color: [200, 200, 255],\n        baseHealth: 80, // 70-90 range\n        baseSpeed: 45, // 40-50 range\n        size: 22,\n        baseXPValue: 5,\n        behavior: 'shield',\n        pathfindingMode: 'smart',\n        damage: 12,\n        reflectsProjectiles: true, // Reflects projectiles back at player\n        reflectChance: 0.4 // 40% chance to reflect\n    },\n    bomber: {\n        name: 'Demolitions Expert',\n        char: '', // Black diamond\n        color: [255, 150, 100],\n        baseHealth: 70, // 60-80 range\n        baseSpeed: 0, // Stationary\n        size: 22,\n        baseXPValue: 5,\n        behavior: 'bomber',\n        fireRate: 0.4, // Launches a bomb every 2.5 seconds\n        projectileSpeed: 100, // Slow moving bombs\n        projectileDamage: 20,\n        homingStrength: 0.5, // How strongly bombs home in on player\n        bombExplosionRadius: 50 // Explosion radius when bomb hits\n    },\n\n    // =================================================================\n    // LEGACY TYPES (for backwards compatibility)\n    // =================================================================\n    basic: {\n        name: 'Crew Member',\n        char: 'E',\n        color: [255, 100, 100],\n        baseHealth: 30,\n        baseSpeed: 50,\n        size: 20,\n        baseXPValue: 2, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 8\n    },\n    tank: {\n        name: 'Camera Operator',\n        char: '', // Full block (same as heavyTank)\n        color: [150, 150, 255],\n        baseHealth: 80,\n        baseSpeed: 30,\n        size: 24,\n        baseXPValue: 4, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 20\n    },\n    fast: {\n        name: 'Runner',\n        char: 'F',\n        color: [255, 255, 100],\n        baseHealth: 20,\n        baseSpeed: 90,\n        size: 16,\n        baseXPValue: 2, // Reduced by 3x for balance\n        behavior: 'rush',\n        pathfindingMode: 'smart', // Uses A* pathfinding\n        damage: 6\n    }\n};\n\n/**\n * Get enemy definition by type key\n * @param {string} type - Enemy type key\n * @returns {object} Enemy configuration\n */\nexport function getEnemyDefinition(type) {\n    return ENEMY_TYPES[type] || ENEMY_TYPES.basic;\n}\n\n/**\n * Get all enemy types for a specific floor\n * @param {number} floor - Floor number\n * @returns {Array<string>} Array of enemy type keys for that floor\n */\nexport function getEnemiesForFloor(floor) {\n    const floor1 = ['rusher', 'shooter', 'zombie', 'slime', 'bat'];\n    const floor2 = ['charger', 'turret', 'heavyTank', 'zippy', 'exploder', 'splitter'];\n    const floor3 = ['mage', 'shieldBearer', 'golem', 'wraith', 'spawner', 'buffer', 'phaser', 'mimic'];\n    const floor4 = ['healer', 'teleporter', 'freezer', 'leech', 'reflector', 'bomber'];\n\n    if (floor === 1) return floor1;\n    if (floor === 2) return [...floor1, ...floor2];\n    if (floor === 3) return [...floor2, ...floor3];\n    if (floor >= 4) return [...floor3, ...floor4];\n\n    return floor1; // Default to floor 1\n}\n","/**\n * Pathfinding System\n *\n * Provides intelligent pathfinding for enemies:\n * - A* pathfinding for obstacle avoidance\n * - Different behaviors: direct, smart, perimeter\n * - Grid-based navigation with obstacle detection\n */\n\nconst GRID_SIZE = 32; // Size of each grid cell for pathfinding\nconst MAX_PATH_LENGTH = 100; // Max path nodes to prevent infinite loops\n\n/**\n * Simple priority queue for A* algorithm\n */\nclass PriorityQueue {\n    constructor() {\n        this.elements = [];\n    }\n\n    enqueue(element, priority) {\n        this.elements.push({ element, priority });\n        this.elements.sort((a, b) => a.priority - b.priority);\n    }\n\n    dequeue() {\n        return this.elements.shift()?.element;\n    }\n\n    isEmpty() {\n        return this.elements.length === 0;\n    }\n}\n\n/**\n * Get grid coordinate from world position\n */\nfunction worldToGrid(x, y) {\n    return {\n        gx: Math.floor(x / GRID_SIZE),\n        gy: Math.floor(y / GRID_SIZE)\n    };\n}\n\n/**\n * Get world position from grid coordinate (center of cell)\n */\nfunction gridToWorld(gx, gy) {\n    return {\n        x: gx * GRID_SIZE + GRID_SIZE / 2,\n        y: gy * GRID_SIZE + GRID_SIZE / 2\n    };\n}\n\n/**\n * Check if a grid cell is walkable\n */\nfunction isCellWalkable(k, gx, gy, gridWidth, gridHeight) {\n    // Out of bounds\n    if (gx < 0 || gy < 0 || gx >= gridWidth || gy >= gridHeight) {\n        return false;\n    }\n\n    // Check if there's an obstacle at this grid cell\n    const worldPos = gridToWorld(gx, gy);\n    const obstacles = k.get('obstacle');\n\n    for (const obstacle of obstacles) {\n        if (!obstacle.exists()) continue;\n\n        // Check if cell overlaps with obstacle\n        const halfSize = GRID_SIZE / 2;\n        const cellLeft = worldPos.x - halfSize;\n        const cellRight = worldPos.x + halfSize;\n        const cellTop = worldPos.y - halfSize;\n        const cellBottom = worldPos.y + halfSize;\n\n        const obstacleLeft = obstacle.pos.x - obstacle.width / 2;\n        const obstacleRight = obstacle.pos.x + obstacle.width / 2;\n        const obstacleTop = obstacle.pos.y - obstacle.height / 2;\n        const obstacleBottom = obstacle.pos.y + obstacle.height / 2;\n\n        // Check overlap\n        if (cellRight > obstacleLeft && cellLeft < obstacleRight &&\n            cellBottom > obstacleTop && cellTop < obstacleBottom) {\n            return false; // Cell overlaps obstacle\n        }\n    }\n\n    return true;\n}\n\n/**\n * Manhattan distance heuristic for A*\n */\nfunction heuristic(a, b) {\n    return Math.abs(a.gx - b.gx) + Math.abs(a.gy - b.gy);\n}\n\n/**\n * A* pathfinding algorithm\n * Returns array of waypoints from start to goal\n */\nexport function findPath(k, startX, startY, goalX, goalY) {\n    const roomWidth = k.width();\n    const roomHeight = k.height();\n    const gridWidth = Math.ceil(roomWidth / GRID_SIZE);\n    const gridHeight = Math.ceil(roomHeight / GRID_SIZE);\n\n    const start = worldToGrid(startX, startY);\n    const goal = worldToGrid(goalX, goalY);\n\n    // If start or goal is not walkable, return empty path\n    if (!isCellWalkable(k, start.gx, start.gy, gridWidth, gridHeight) ||\n        !isCellWalkable(k, goal.gx, goal.gy, gridWidth, gridHeight)) {\n        return [];\n    }\n\n    const frontier = new PriorityQueue();\n    frontier.enqueue(start, 0);\n\n    const cameFrom = new Map();\n    const costSoFar = new Map();\n\n    const getKey = (node) => `${node.gx},${node.gy}`;\n\n    cameFrom.set(getKey(start), null);\n    costSoFar.set(getKey(start), 0);\n\n    let iterations = 0;\n    const maxIterations = gridWidth * gridHeight; // Safety limit\n\n    while (!frontier.isEmpty() && iterations < maxIterations) {\n        iterations++;\n        const current = frontier.dequeue();\n\n        // Reached goal\n        if (current.gx === goal.gx && current.gy === goal.gy) {\n            break;\n        }\n\n        // Check neighbors (4-directional: up, down, left, right)\n        const neighbors = [\n            { gx: current.gx + 1, gy: current.gy },\n            { gx: current.gx - 1, gy: current.gy },\n            { gx: current.gx, gy: current.gy + 1 },\n            { gx: current.gx, gy: current.gy - 1 },\n            // Diagonals for smoother paths\n            { gx: current.gx + 1, gy: current.gy + 1 },\n            { gx: current.gx + 1, gy: current.gy - 1 },\n            { gx: current.gx - 1, gy: current.gy + 1 },\n            { gx: current.gx - 1, gy: current.gy - 1 }\n        ];\n\n        for (const next of neighbors) {\n            if (!isCellWalkable(k, next.gx, next.gy, gridWidth, gridHeight)) {\n                continue;\n            }\n\n            // Diagonal movement costs more\n            const isDiagonal = next.gx !== current.gx && next.gy !== current.gy;\n            const moveCost = isDiagonal ? 1.4 : 1.0;\n            const newCost = costSoFar.get(getKey(current)) + moveCost;\n\n            const nextKey = getKey(next);\n            if (!costSoFar.has(nextKey) || newCost < costSoFar.get(nextKey)) {\n                costSoFar.set(nextKey, newCost);\n                const priority = newCost + heuristic(next, goal);\n                frontier.enqueue(next, priority);\n                cameFrom.set(nextKey, current);\n            }\n        }\n    }\n\n    // Reconstruct path\n    const path = [];\n    let current = goal;\n\n    while (current && cameFrom.has(getKey(current))) {\n        const worldPos = gridToWorld(current.gx, current.gy);\n        path.unshift(worldPos);\n        current = cameFrom.get(getKey(current));\n\n        if (path.length > MAX_PATH_LENGTH) {\n            break; // Safety limit\n        }\n    }\n\n    return path;\n}\n\n/**\n * Get next move direction using A* pathfinding\n * Returns a vector for the next move\n */\nexport function getSmartMoveDirection(k, enemy, targetX, targetY) {\n    // Update path periodically or if we don't have one\n    if (!enemy.pathfindingPath || enemy.pathfindingTimer <= 0) {\n        enemy.pathfindingPath = findPath(k, enemy.pos.x, enemy.pos.y, targetX, targetY);\n        enemy.pathfindingTimer = 0.5; // Recalculate path every 0.5 seconds\n        enemy.pathfindingWaypointIndex = 0;\n    }\n\n    enemy.pathfindingTimer -= k.dt();\n\n    // If we have a path, follow it\n    if (enemy.pathfindingPath && enemy.pathfindingPath.length > 0) {\n        const waypoint = enemy.pathfindingPath[enemy.pathfindingWaypointIndex];\n\n        if (waypoint) {\n            const toWaypoint = k.vec2(\n                waypoint.x - enemy.pos.x,\n                waypoint.y - enemy.pos.y\n            );\n            const distanceToWaypoint = toWaypoint.len();\n\n            // Reached waypoint, move to next\n            if (distanceToWaypoint < GRID_SIZE / 2) {\n                enemy.pathfindingWaypointIndex++;\n\n                // Reached end of path, recalculate\n                if (enemy.pathfindingWaypointIndex >= enemy.pathfindingPath.length) {\n                    enemy.pathfindingPath = null;\n                    enemy.pathfindingTimer = 0;\n                }\n            }\n\n            // Move toward waypoint\n            if (distanceToWaypoint > 0) {\n                return toWaypoint.unit();\n            }\n        }\n    }\n\n    // No path available, move directly toward target (fallback)\n    const toTarget = k.vec2(targetX - enemy.pos.x, targetY - enemy.pos.y);\n    const distance = toTarget.len();\n    if (distance > 0) {\n        return toTarget.unit();\n    }\n\n    return k.vec2(0, 0);\n}\n\n/**\n * Get perimeter movement direction\n * Enemy walks around the edge of the map\n */\nexport function getPerimeterMoveDirection(k, enemy) {\n    const roomWidth = k.width();\n    const roomHeight = k.height();\n    const margin = 40; // Distance from edge\n\n    // Initialize perimeter mode if not set\n    if (!enemy.perimeterMode) {\n        enemy.perimeterMode = {\n            side: 'top', // top, right, bottom, left\n            targetX: enemy.pos.x,\n            targetY: margin\n        };\n    }\n\n    const perim = enemy.perimeterMode;\n    const speed = enemy.speed * k.dt();\n    const threshold = 20; // Distance to target before switching sides\n\n    // Calculate distance to current target\n    const toTarget = k.vec2(perim.targetX - enemy.pos.x, perim.targetY - enemy.pos.y);\n    const distanceToTarget = toTarget.len();\n\n    // Reached target, switch to next side\n    if (distanceToTarget < threshold) {\n        switch (perim.side) {\n            case 'top':\n                perim.side = 'right';\n                perim.targetX = roomWidth - margin;\n                perim.targetY = margin;\n                break;\n            case 'right':\n                perim.side = 'bottom';\n                perim.targetX = roomWidth - margin;\n                perim.targetY = roomHeight - margin;\n                break;\n            case 'bottom':\n                perim.side = 'left';\n                perim.targetX = margin;\n                perim.targetY = roomHeight - margin;\n                break;\n            case 'left':\n                perim.side = 'top';\n                perim.targetX = margin;\n                perim.targetY = margin;\n                break;\n        }\n    }\n\n    // Move toward target\n    if (distanceToTarget > 0) {\n        return toTarget.unit();\n    }\n\n    return k.vec2(0, 0);\n}\n","/**\n * Enemy Entity\n *\n * Creates and manages enemy entities with 21 different types:\n * - Basic, Rusher, Sniper, Tank, Healer, etc.\n * - Behavior patterns: rush, shoot, explode, teleport, heal\n * - Health bars for visual feedback\n * - Floor-based stat scaling\n * - Death handling and cleanup\n */\n\n// Entity imports\nimport { createProjectile } from './projectile.js';\n\n// Data imports\nimport { getEnemyDefinition } from '../data/enemies.js';\n\n// System imports\nimport { getSmartMoveDirection, getPerimeterMoveDirection } from '../systems/pathfinding.js';\nimport { registerEnemy, isHost, isMultiplayerActive, broadcastEnemySplit, broadcastDeathEvent } from '../systems/multiplayerGame.js';\n\nexport function createEnemy(k, x, y, type = 'basic', floor = 1, rng = null) {\n    const baseConfig = getEnemyDefinition(type);\n    \n    // Scale stats based on floor\n    const floorMultiplier = 1 + (floor - 1) * 0.3; // 30% increase per floor\n    const config = {\n        char: baseConfig.char,\n        color: baseConfig.color,\n        health: Math.floor(baseConfig.baseHealth * floorMultiplier),\n        speed: Math.floor(baseConfig.baseSpeed * (1 + (floor - 1) * 0.1)), // 10% speed increase per floor\n        size: baseConfig.size,\n        xpValue: Math.floor(baseConfig.baseXPValue * floorMultiplier),\n        behavior: baseConfig.behavior\n    };\n    \n    // Build visual representation (will be updated if armor/shields exist)\n    // Note: Floor-based bonuses calculated later, so initial visual is just base character\n    function getEnemyVisual() {\n        return config.char;\n    }\n    \n    const enemy = k.add([\n        k.text(getEnemyVisual(), { size: config.size }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...config.color),\n        k.area(),\n        k.health(config.health),\n        'enemy'\n    ]);\n    \n    // Store original color for later use\n    enemy.originalColor = config.color;\n\n    enemy.maxHealth = config.health;\n    enemy.speed = config.speed;\n    enemy.xpValue = config.xpValue;\n    enemy.type = type;\n    enemy.behavior = config.behavior;\n    enemy.floor = floor;\n    enemy.pathfindingMode = baseConfig.pathfindingMode || 'none'; // Pathfinding mode: 'none', 'smart', 'perimeter'\n    \n    // Store enemy-specific properties\n    if (baseConfig.damage) enemy.damage = baseConfig.damage;\n    if (baseConfig.fireRate) enemy.fireRate = baseConfig.fireRate;\n    if (baseConfig.projectileSpeed) enemy.projectileSpeed = baseConfig.projectileSpeed;\n    if (baseConfig.projectileDamage) enemy.projectileDamage = baseConfig.projectileDamage;\n    if (baseConfig.chargeCooldown) enemy.chargeCooldown = baseConfig.chargeCooldown;\n    if (baseConfig.splits) {\n        enemy.splits = true;\n        enemy.splitCount = baseConfig.splitCount || 2;\n        enemy.splitType = baseConfig.splitType || type; // Type to spawn on split (default: same type)\n    }\n    if (baseConfig.explodes) {\n        enemy.explodes = true;\n        enemy.explosionDamage = baseConfig.explosionDamage;\n        enemy.explosionRadius = baseConfig.explosionRadius;\n        if (baseConfig.shrapnel) {\n            enemy.shrapnel = true;\n            enemy.shrapnelCount = baseConfig.shrapnelCount || 8;\n        }\n    }\n    \n    // Floor-based armor/shield scaling\n    // Floor 1: No armor/shields\n    // Floor 2: Some enemies get armor\n    // Floor 3: More enemies get armor, some get shields\n    // Floor 4+: Mix of armor and shields, some get both\n    \n    // Calculate floor-based armor/shield bonuses\n    let floorArmorBonus = 0;\n    let floorShieldBonus = 0;\n    let floorShieldRegen = 0;\n    \n    if (floor >= 2) {\n        // Floor 2+: Some enemies get armor (30% chance, or specific types)\n        // Use seeded RNG if provided, fall back to Math.random() for backwards compatibility\n        const armorRoll = rng ? rng.next() : Math.random();\n        if (floor >= 2 && (type === 'zombie' || type === 'turret' || type === 'heavyTank' || armorRoll < 0.3)) {\n            floorArmorBonus = Math.floor(15 + (floor - 2) * 5); // 15 base, +5 per floor\n        }\n    }\n\n    if (floor >= 3) {\n        // Floor 3+: Some enemies get shields (20% chance, or specific types)\n        // Use seeded RNG if provided, fall back to Math.random() for backwards compatibility\n        const shieldRoll = rng ? rng.next() : Math.random();\n        if (type === 'shooter' || type === 'turret' || type === 'wraith' || shieldRoll < 0.2) {\n            floorShieldBonus = Math.floor(10 + (floor - 3) * 5); // 10 base, +5 per floor\n            floorShieldRegen = 1 + (floor - 3) * 0.5; // 1 HP/sec base, +0.5 per floor\n        }\n    }\n\n    if (floor >= 4) {\n        // Floor 4+: Some enemies get both armor and shields (10% chance, or specific types)\n        // Use seeded RNG if provided, fall back to Math.random() for backwards compatibility\n        const bothRoll = rng ? rng.next() : Math.random();\n        if (type === 'heavyTank' || type === 'spawner' || bothRoll < 0.1) {\n            if (floorArmorBonus === 0) floorArmorBonus = Math.floor(20 + (floor - 4) * 5);\n            if (floorShieldBonus === 0) {\n                floorShieldBonus = Math.floor(15 + (floor - 4) * 5);\n                floorShieldRegen = 1.5 + (floor - 4) * 0.5;\n            }\n        }\n    }\n    \n    // Armor properties (base + floor bonus)\n    const totalBaseArmor = (baseConfig.baseArmorHealth || 0) + floorArmorBonus;\n    enemy.armorHealth = Math.floor(totalBaseArmor * floorMultiplier);\n    enemy.maxArmorHealth = Math.floor(totalBaseArmor * floorMultiplier);\n    enemy.damageReduction = baseConfig.damageReduction || (totalBaseArmor > 0 ? 0.2 : 0); // 20% reduction if has armor\n    enemy.armorChar = baseConfig.armorChar || '[]'; // Changed from () to []\n    enemy.armorColor = baseConfig.armorColor || [200, 200, 200];\n    \n    // Shield properties (base + floor bonus)\n    const totalBaseShield = (baseConfig.baseShieldHealth || 0) + floorShieldBonus;\n    enemy.shieldHealth = Math.floor(totalBaseShield * floorMultiplier);\n    enemy.maxShieldHealth = Math.floor(totalBaseShield * floorMultiplier);\n    enemy.shieldRegenRate = ((baseConfig.shieldRegenRate || 0) + floorShieldRegen) * floorMultiplier;\n    enemy.shieldChar = baseConfig.shieldChar || '{}';\n    enemy.shieldColor = baseConfig.shieldColor || [100, 200, 255];\n    enemy.shieldRegenTimer = 0;\n    enemy.shieldRegenCooldown = 0; // Cooldown after taking damage (prevents regen)\n    enemy.lastDamageTime = 0; // Track when last damaged\n    \n    // Store original color for visual updates\n    enemy.originalColor = config.color;\n    enemy.coreChar = config.char;\n    \n    // Function to update visual representation (for armor/shield changes)\n    enemy.updateVisual = function() {\n        // Priority: Shields > Armor > Core\n        let leftShield = '';\n        let rightShield = '';\n        let leftArmor = '';\n        let rightArmor = '';\n        \n        // Shields take priority (outermost layer)\n        // Size scales with health: Full =  , Medium =  , Low =  \n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\n        if (enemy.shieldHealth > 0) {\n            const shieldPercent = enemy.shieldHealth / enemy.maxShieldHealth;\n            \n            if (shieldPercent > 0.66) {\n                // Full shield (66-100%): Double brackets   (mathematical double brackets)\n                leftShield = '';\n                rightShield = '';\n            } else if (shieldPercent > 0.33) {\n                // Medium shield (33-66%): Left/right white parenthesis  \n                leftShield = '';\n                rightShield = '';\n            } else {\n                // Low shield (0-33%): Left/right angle brackets  \n                leftShield = '';\n                rightShield = '';\n            }\n        }\n        \n        // Armor (middle layer, can appear with shields: {[E]})\n        // Size scales with health: Full =  , Medium =  , Low =  \n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\n        if (enemy.armorHealth > 0) {\n            const armorPercent = enemy.armorHealth / enemy.maxArmorHealth;\n            \n            if (armorPercent > 0.66) {\n                // Full armor (66-100%): Double brackets   (mathematical double brackets)\n                leftArmor = '';\n                rightArmor = '';\n            } else if (armorPercent > 0.33) {\n                // Medium armor (33-66%): Left/right angle brackets  \n                leftArmor = '';\n                rightArmor = '';\n            } else {\n                // Low armor (0-33%): Left/right double angle brackets  \n                leftArmor = '';\n                rightArmor = '';\n            }\n        }\n        \n        // Visual format: {[E]} (shields outside, armor inside)\n        const visual = `${leftShield}${leftArmor}${enemy.coreChar}${rightArmor}${rightShield}`;\n        \n        // Update text component\n        enemy.text = visual;\n        \n        // Update color - use shield color if shields exist, otherwise original color\n        if (enemy.shieldHealth > 0) {\n            enemy.color = k.rgb(...enemy.shieldColor);\n        } else {\n            enemy.color = k.rgb(...enemy.originalColor);\n        }\n    };\n    \n    // Function to take damage (handles shields, then armor, then health)\n    enemy.takeDamage = function(damage) {\n        let shieldChanged = false;\n        let armorChanged = false;\n        const previousShieldHealth = enemy.shieldHealth;\n        const previousArmorHealth = enemy.armorHealth;\n        \n        // Track damage time for shield regen cooldown\n        enemy.lastDamageTime = k.time();\n        const shieldRegenCooldownDuration = 3.0; // 3 seconds cooldown after taking damage\n        enemy.shieldRegenCooldown = shieldRegenCooldownDuration;\n        \n        // Priority: Shields > Armor > Health\n        // Shields take normal damage (no reduction)\n        if (enemy.shieldHealth > 0) {\n            const shieldDamage = Math.min(damage, enemy.shieldHealth);\n            enemy.shieldHealth = Math.max(0, enemy.shieldHealth - shieldDamage);\n            shieldChanged = (enemy.shieldHealth !== previousShieldHealth);\n            \n            // Remaining damage goes to armor/health\n            const remainingDamage = damage - shieldDamage;\n            if (remainingDamage > 0) {\n                enemy.takeDamageInternal(remainingDamage);\n            }\n        } else {\n            // No shields - damage goes to armor/health\n            enemy.takeDamageInternal(damage);\n        }\n        \n        armorChanged = (enemy.armorHealth !== previousArmorHealth);\n        \n        // Update visual when shields or armor change\n        if (shieldChanged || armorChanged) {\n            enemy.updateVisual();\n        }\n    };\n    \n    // Internal damage function (handles armor and health)\n    enemy.takeDamageInternal = function(damage) {\n        // If armor exists, armor takes reduced damage first\n        if (enemy.armorHealth > 0) {\n            // Apply damage reduction to armor damage\n            const reducedDamage = Math.floor(damage * (1 - enemy.damageReduction));\n            const armorDamage = Math.min(reducedDamage, enemy.armorHealth);\n            enemy.armorHealth = Math.max(0, enemy.armorHealth - armorDamage);\n            \n            // Remaining damage goes to enemy, but reduced if armor still exists\n            const remainingDamage = damage - reducedDamage;\n            if (remainingDamage > 0) {\n                // If armor still exists, apply damage reduction\n                // If armor is destroyed, remaining damage goes through at full\n                const damageMultiplier = enemy.armorHealth > 0 ? (1 - enemy.damageReduction) : 1;\n                const finalDamage = Math.floor(remainingDamage * damageMultiplier);\n                enemy.hurt(finalDamage);\n            }\n        } else {\n            // No armor - full damage\n            enemy.hurt(damage);\n        }\n    };\n    \n    if (baseConfig.blocksProjectiles) enemy.blocksProjectiles = true;\n    if (baseConfig.teleportCooldown) enemy.teleportCooldown = baseConfig.teleportCooldown;\n    if (baseConfig.teleportRange) enemy.teleportRange = baseConfig.teleportRange;\n    if (baseConfig.spawnInterval) enemy.spawnInterval = baseConfig.spawnInterval;\n    if (baseConfig.spawnType) enemy.spawnType = baseConfig.spawnType;\n    if (baseConfig.buffRadius) enemy.buffRadius = baseConfig.buffRadius;\n    \n    if (baseConfig.buffAmount) enemy.buffAmount = baseConfig.buffAmount;\n    if (baseConfig.healRadius) enemy.healRadius = baseConfig.healRadius;\n    if (baseConfig.healAmount) enemy.healAmount = baseConfig.healAmount;\n    if (baseConfig.healInterval) enemy.healInterval = baseConfig.healInterval;\n    if (baseConfig.slowRadius) enemy.slowRadius = baseConfig.slowRadius;\n    if (baseConfig.slowAmount) enemy.slowAmount = baseConfig.slowAmount;\n    if (baseConfig.lifesteal) enemy.lifesteal = baseConfig.lifesteal;\n\n    // New enemy properties\n    if (baseConfig.phaseOpacity) enemy.phaseOpacity = baseConfig.phaseOpacity;\n    if (baseConfig.phaseThroughObstacles) enemy.phaseThroughObstacles = baseConfig.phaseThroughObstacles;\n    if (baseConfig.mimicDuration) enemy.mimicDuration = baseConfig.mimicDuration;\n    if (baseConfig.mimicCooldown) enemy.mimicCooldown = baseConfig.mimicCooldown;\n    if (baseConfig.reflectsProjectiles) enemy.reflectsProjectiles = baseConfig.reflectsProjectiles;\n    if (baseConfig.reflectChance) enemy.reflectChance = baseConfig.reflectChance;\n    if (baseConfig.homingStrength) enemy.homingStrength = baseConfig.homingStrength;\n    if (baseConfig.bombExplosionRadius) enemy.bombExplosionRadius = baseConfig.bombExplosionRadius;\n    \n    // Initialize visual with armor/shields if they exist (after all properties are set)\n    enemy.updateVisual();\n    \n    // Initialize behavior-specific timers\n    enemy.attackTimer = 0;\n    enemy.chargeTimer = 0;\n    enemy.isCharging = false;\n    enemy.chargeDirection = null;\n    enemy.chargeDuration = 0;\n    enemy.chargePauseTimer = 0;\n    enemy.teleportTimer = 0;\n    enemy.spawnTimer = 0;\n    enemy.healTimer = 0;\n    enemy.buffedEnemies = new Set(); // Track which enemies are buffed by this buffer\n\n    // New behavior timers\n    enemy.mimicTimer = 0;\n    enemy.mimicMovementHistory = []; // Store player movement for mimic\n    enemy.isMimicking = false;\n    enemy.mimicMoveIndex = 0;\n\n    // Set phase opacity for phaser enemies (semi-transparent)\n    if (enemy.phaseOpacity) {\n        enemy.opacity = enemy.phaseOpacity;\n    }\n\n    // Obstacle avoidance state\n    enemy.stuckTimer = 0; // Track how long enemy has been stuck\n    enemy.stuckThreshold = 1.0; // Seconds before considered stuck\n    enemy.lastPosition = { x: x, y: y };\n    enemy.lastPositionUpdateTime = 0; // Track when last position was updated\n    enemy.avoidanceDirection = null; // Current avoidance direction\n    enemy.avoidanceTimer = 0; // How long to continue avoidance\n    \n    // Health bar components (only shown when health is low)\n    const healthBarWidth = 30;\n    const healthBarHeight = 3;\n    const healthBarOffset = -20; // Offset above enemy\n    \n    const healthBarBg = k.add([\n        k.rect(healthBarWidth, healthBarHeight),\n        k.pos(x, y + healthBarOffset),\n        k.anchor('center'),\n        k.color(50, 50, 50),\n        k.z(100),\n        'enemyHealthBar'\n    ]);\n    \n    const healthBar = k.add([\n        k.rect(healthBarWidth, healthBarHeight),\n        k.pos(x, y + healthBarOffset),\n        k.anchor('center'),\n        k.color(200, 200, 200), // Simple gray color\n        k.z(101),\n        'enemyHealthBar'\n    ]);\n    \n    // Link health bars to enemy\n    enemy.healthBarBg = healthBarBg;\n    enemy.healthBar = healthBar;\n    enemy.showHealthThreshold = 0.5; // Show health bar when below 50% health\n    \n    // Initially hide health bars\n    healthBarBg.hidden = true;\n    healthBar.hidden = true;\n\n    // AI based on behavior type\n    enemy.onUpdate(() => {\n        // Update health bar position and visibility\n        if (enemy.exists() && enemy.healthBar && enemy.healthBarBg) {\n            const healthPercent = enemy.hp() / enemy.maxHealth;\n            const shouldShow = healthPercent < enemy.showHealthThreshold && healthPercent > 0;\n            \n            if (shouldShow) {\n                // Show and update health bars\n                enemy.healthBarBg.hidden = false;\n                enemy.healthBar.hidden = false;\n                \n                // Update position\n                enemy.healthBarBg.pos.x = enemy.pos.x;\n                enemy.healthBarBg.pos.y = enemy.pos.y + healthBarOffset;\n                enemy.healthBar.pos.x = enemy.pos.x;\n                enemy.healthBar.pos.y = enemy.pos.y + healthBarOffset;\n                \n                // Update health bar width\n                const barWidth = healthBarWidth * healthPercent;\n                enemy.healthBar.width = Math.max(1, barWidth);\n                enemy.healthBar.pos.x = enemy.pos.x - (healthBarWidth - barWidth) / 2;\n            } else {\n                // Hide health bars\n                enemy.healthBarBg.hidden = true;\n                enemy.healthBar.hidden = true;\n            }\n        }\n    });\n    \n    // Cleanup function for health bars\n    enemy.cleanupHealthBars = function() {\n        if (enemy.healthBarBg && enemy.healthBarBg.exists()) {\n            k.destroy(enemy.healthBarBg);\n        }\n        if (enemy.healthBar && enemy.healthBar.exists()) {\n            k.destroy(enemy.healthBar);\n        }\n    };\n    \n    // Helper function to check if a position is clear of obstacles\n    const isPositionClear = (testX, testY) => {\n        const obstacles = k.get('obstacle');\n        const enemySize = enemy.size || 12;\n        \n        for (const obstacle of obstacles) {\n            if (!obstacle.exists()) continue;\n            \n            const obsLeft = obstacle.pos.x - obstacle.width / 2;\n            const obsRight = obstacle.pos.x + obstacle.width / 2;\n            const obsTop = obstacle.pos.y - obstacle.height / 2;\n            const obsBottom = obstacle.pos.y + obstacle.height / 2;\n            \n            const enemyLeft = testX - enemySize;\n            const enemyRight = testX + enemySize;\n            const enemyTop = testY - enemySize;\n            const enemyBottom = testY + enemySize;\n            \n            if (enemyRight > obsLeft && enemyLeft < obsRight &&\n                enemyBottom > obsTop && enemyTop < obsBottom) {\n                return false; // Collision detected\n            }\n        }\n        return true; // Position is clear\n    };\n    \n    // Obstacle avoidance function - tries to find a path around obstacles\n    const applyObstacleAvoidance = (desiredMove) => {\n        const moveSpeed = desiredMove.len();\n        const desiredDir = moveSpeed > 0 ? desiredMove.unit() : k.vec2(0, 0);\n        \n        // Update stuck detection\n        enemy.lastPositionUpdateTime += k.dt();\n        if (enemy.lastPositionUpdateTime >= 0.1) {\n            // Update last position every 0.1 seconds\n            const movedDistance = Math.sqrt(\n                Math.pow(enemy.pos.x - enemy.lastPosition.x, 2) +\n                Math.pow(enemy.pos.y - enemy.lastPosition.y, 2)\n            );\n            \n            if (movedDistance < 5) {\n                // Enemy hasn't moved much\n                enemy.stuckTimer += enemy.lastPositionUpdateTime;\n            } else {\n                // Enemy is moving, reset stuck timer\n                enemy.stuckTimer = 0;\n            }\n            \n            enemy.lastPosition = { x: enemy.pos.x, y: enemy.pos.y };\n            enemy.lastPositionUpdateTime = 0;\n        }\n        \n        // Check if desired position is clear\n        const newX = enemy.pos.x + desiredMove.x;\n        const newY = enemy.pos.y + desiredMove.y;\n        \n        if (isPositionClear(newX, newY)) {\n            // Desired path is clear - reset avoidance\n            enemy.avoidanceDirection = null;\n            enemy.avoidanceTimer = 0;\n            return desiredMove;\n        }\n        \n        // Movement is blocked - try obstacle avoidance\n        enemy.avoidanceTimer -= k.dt();\n        \n        // If stuck for too long or avoidance timer expired, try new direction\n        if (enemy.stuckTimer >= enemy.stuckThreshold || enemy.avoidanceTimer <= 0) {\n            // Try perpendicular directions to find a way around\n            const perpendicular1 = k.vec2(-desiredDir.y, desiredDir.x); // 90 degrees left\n            const perpendicular2 = k.vec2(desiredDir.y, -desiredDir.x); // 90 degrees right\n            \n            // Try multiple directions: perpendicular, diagonal, and slight variations\n            const testDirections = [\n                perpendicular1.scale(moveSpeed), // Left\n                perpendicular2.scale(moveSpeed), // Right\n                k.vec2(perpendicular1.x * 0.7 + desiredDir.x * 0.3, perpendicular1.y * 0.7 + desiredDir.y * 0.3).unit().scale(moveSpeed), // Diagonal left-forward\n                k.vec2(perpendicular2.x * 0.7 + desiredDir.x * 0.3, perpendicular2.y * 0.7 + desiredDir.y * 0.3).unit().scale(moveSpeed), // Diagonal right-forward\n                k.vec2(perpendicular1.x * 0.5 + desiredDir.x * 0.5, perpendicular1.y * 0.5 + desiredDir.y * 0.5).unit().scale(moveSpeed), // More forward-left\n                k.vec2(perpendicular2.x * 0.5 + desiredDir.x * 0.5, perpendicular2.y * 0.5 + desiredDir.y * 0.5).unit().scale(moveSpeed), // More forward-right\n            ];\n            \n            // Find first clear direction\n            for (const testDir of testDirections) {\n                const testX = enemy.pos.x + testDir.x;\n                const testY = enemy.pos.y + testDir.y;\n                if (isPositionClear(testX, testY)) {\n                    enemy.avoidanceDirection = k.vec2(testDir.x, testDir.y).unit();\n                    enemy.avoidanceTimer = 0.8; // Continue avoidance for 0.8 seconds\n                    return testDir;\n                }\n            }\n            \n            // No clear path found - try moving in avoidance direction if we have one\n            if (enemy.avoidanceDirection) {\n                const avoidMove = enemy.avoidanceDirection.scale(moveSpeed);\n                const avoidX = enemy.pos.x + avoidMove.x;\n                const avoidY = enemy.pos.y + avoidMove.y;\n                if (isPositionClear(avoidX, avoidY)) {\n                    return avoidMove;\n                }\n            }\n            \n            // Still stuck - try partial movement (X or Y only)\n            if (isPositionClear(newX, enemy.pos.y)) {\n                return k.vec2(desiredMove.x, 0);\n            } else if (isPositionClear(enemy.pos.x, newY)) {\n                return k.vec2(0, desiredMove.y);\n            }\n            \n            // Completely blocked\n            return k.vec2(0, 0);\n        } else if (enemy.avoidanceDirection) {\n            // Continue in avoidance direction\n            const avoidMove = enemy.avoidanceDirection.scale(moveSpeed);\n            const avoidX = enemy.pos.x + avoidMove.x;\n            const avoidY = enemy.pos.y + avoidMove.y;\n            if (isPositionClear(avoidX, avoidY)) {\n                return avoidMove;\n            } else {\n                // Avoidance direction blocked, reset\n                enemy.avoidanceDirection = null;\n                enemy.avoidanceTimer = 0;\n            }\n        }\n        \n        // Fallback: try partial movement\n        if (isPositionClear(newX, enemy.pos.y)) {\n            return k.vec2(desiredMove.x, 0);\n        } else if (isPositionClear(enemy.pos.x, newY)) {\n            return k.vec2(0, desiredMove.y);\n        }\n        \n        // Completely blocked\n        return k.vec2(0, 0);\n    };\n    \n    enemy.onUpdate(() => {\n        if (k.paused) return;\n        \n        // Shield regeneration (if shields exist and regen rate > 0)\n        // Only regen if cooldown has expired (not damaged recently) and enemy is alive\n        // Host-authoritative in multiplayer to prevent desync from frame rate differences\n        if (enemy.shieldRegenRate > 0 && enemy.shieldHealth < enemy.maxShieldHealth && enemy.hp() > 0 && !enemy.isDead) {\n            // Only process shield regen on host (or in single player)\n            if (!isMultiplayerActive() || isHost()) {\n                // Update cooldown timer\n                if (enemy.shieldRegenCooldown > 0) {\n                    enemy.shieldRegenCooldown -= k.dt();\n                }\n\n                // Only regenerate if cooldown has expired\n                if (enemy.shieldRegenCooldown <= 0) {\n                    enemy.shieldRegenTimer += k.dt();\n                    const regenInterval = 1.0; // Regenerate every second\n\n                    if (enemy.shieldRegenTimer >= regenInterval) {\n                        const regenAmount = enemy.shieldRegenRate * regenInterval;\n                        enemy.shieldHealth = Math.min(enemy.maxShieldHealth, enemy.shieldHealth + regenAmount);\n                        enemy.shieldRegenTimer = 0;\n                    }\n                }\n            }\n\n            // Update visual on all clients (synced via game_state)\n            if (enemy.shieldHealth > 0 && enemy.updateVisual) {\n                enemy.updateVisual();\n            }\n        }\n\n        // Process burn DoT (Damage over Time) from flamethrower\n        if (enemy.burnDuration > 0 && enemy.hp() > 0 && !enemy.isDead) {\n            enemy.burnTimer = (enemy.burnTimer || 0) + k.dt();\n            const burnTickInterval = 0.5; // Deal burn damage every 0.5 seconds\n\n            if (enemy.burnTimer >= burnTickInterval) {\n                // In multiplayer, only host deals burn damage\n                if (!isMultiplayerActive() || isHost()) {\n                    // Deal burn damage\n                    if (enemy.takeDamage) {\n                        enemy.takeDamage(enemy.burnDamage);\n                    } else {\n                        enemy.hurt(enemy.burnDamage);\n                    }\n                }\n\n                // Visual feedback for burn damage (orange tint) on all clients\n                enemy.color = k.rgb(255, 150, 50);\n                k.wait(0.1, () => {\n                    if (enemy.exists()) {\n                        enemy.color = k.rgb(...enemy.originalColor);\n                    }\n                });\n\n                enemy.burnTimer = 0;\n            }\n\n            // Decrease burn duration\n            enemy.burnDuration -= k.dt();\n            if (enemy.burnDuration <= 0) {\n                enemy.burnDamage = 0;\n                enemy.burnTimer = 0;\n            }\n        }\n\n        // Find nearest alive player (support multiplayer)\n        // Use cached alivePlayers from gameData for performance (updated each frame in game.js)\n        const alivePlayers = k.gameData?.alivePlayers || k.get('player').filter(p => p.exists() && !p.isDead && p.hp() > 0);\n\n        if (alivePlayers.length === 0) return; // No alive players to target\n\n        // Find closest alive player\n        let player = alivePlayers[0];\n        let minDistance = Math.sqrt(\n            Math.pow(player.pos.x - enemy.pos.x, 2) +\n            Math.pow(player.pos.y - enemy.pos.y, 2)\n        );\n\n        for (let i = 1; i < alivePlayers.length; i++) {\n            const p = alivePlayers[i];\n            const d = Math.sqrt(\n                Math.pow(p.pos.x - enemy.pos.x, 2) +\n                Math.pow(p.pos.y - enemy.pos.y, 2)\n            );\n            if (d < minDistance) {\n                minDistance = d;\n                player = p;\n            }\n        }\n\n        const dir = k.vec2(\n            player.pos.x - enemy.pos.x,\n            player.pos.y - enemy.pos.y\n        );\n        const distance = dir.len();\n        \n        // Behavior-specific AI\n        if (enemy.behavior === 'turret') {\n            // Turret: Stationary, just fires projectiles\n            enemy.attackTimer += k.dt();\n            if (distance > 0 && enemy.attackTimer >= 1 / enemy.fireRate) {\n                const direction = dir.unit();\n                const projectile = createProjectile(\n                    k,\n                    enemy.pos.x,\n                    enemy.pos.y,\n                    direction,\n                    enemy.projectileSpeed,\n                    enemy.projectileDamage,\n                    0, // piercing\n                    0, // obstaclePiercing\n                    false // isCrit\n                );\n                projectile.isEnemyProjectile = true;\n                projectile.color = k.rgb(...enemy.originalColor);\n                enemy.attackTimer = 0;\n            }\n            return; // Turrets don't move\n        }\n        \n        if (enemy.behavior === 'shoot') {\n            // Shooter: Maintains distance, fires projectiles\n            enemy.attackTimer += k.dt();\n            \n            // Movement: try to maintain distance\n            const preferredDistance = 150;\n            let moveAmount = k.vec2(0, 0);\n            \n            if (distance > preferredDistance * 1.2) {\n                // Too far, move closer\n                moveAmount = dir.unit().scale(enemy.speed * k.dt());\n            } else if (distance < preferredDistance * 0.8) {\n                // Too close, move away\n                moveAmount = dir.unit().scale(-enemy.speed * k.dt());\n            }\n            \n            // Fire projectiles\n            if (distance > 0 && enemy.attackTimer >= 1 / enemy.fireRate) {\n                const direction = dir.unit();\n                const projectile = createProjectile(\n                    k,\n                    enemy.pos.x,\n                    enemy.pos.y,\n                    direction,\n                    enemy.projectileSpeed,\n                    enemy.projectileDamage,\n                    0,\n                    0,\n                    false\n                );\n                projectile.isEnemyProjectile = true;\n                projectile.color = k.rgb(...enemy.originalColor);\n                enemy.attackTimer = 0;\n            }\n            \n            // Apply movement with obstacle avoidance\n            if (moveAmount.len() > 0) {\n                const finalMove = applyObstacleAvoidance(moveAmount);\n                enemy.pos.x += finalMove.x;\n                enemy.pos.y += finalMove.y;\n\n                // Keep in bounds (prevent backpedaling off screen)\n                const margin = 20;\n                const enemySize = enemy.size || 12;\n                enemy.pos.x = k.clamp(enemy.pos.x, margin + enemySize, k.width() - margin - enemySize);\n                enemy.pos.y = k.clamp(enemy.pos.y, margin + enemySize, k.height() - margin - enemySize);\n            }\n            return;\n        }\n        \n        if (enemy.behavior === 'charge') {\n            // Charger: Charges in straight line, then pauses\n            enemy.chargeTimer += k.dt();\n            \n            if (enemy.isCharging) {\n                // Currently charging\n                enemy.chargeDuration += k.dt();\n                const chargeTime = 0.8; // Charge for 0.8 seconds\n                \n                if (enemy.chargeDuration >= chargeTime) {\n                    // Stop charging, start pause\n                    enemy.isCharging = false;\n                    enemy.chargeDuration = 0;\n                    enemy.chargePauseTimer = 0;\n                } else {\n                    // Continue charging - use obstacle avoidance but prefer straight line\n                    const chargeMove = enemy.chargeDirection.scale(enemy.speed * k.dt());\n                    const finalMove = applyObstacleAvoidance(chargeMove);\n                    // If heavily blocked, stop charging\n                    if (finalMove.len() < chargeMove.len() * 0.3) {\n                        enemy.isCharging = false;\n                        enemy.chargePauseTimer = 0.1;\n                    } else {\n                        enemy.pos.x += finalMove.x;\n                        enemy.pos.y += finalMove.y;\n                    }\n                }\n            } else {\n                // Not charging - normal movement or pause\n                if (enemy.chargePauseTimer > 0) {\n                    // Pausing after charge\n                    enemy.chargePauseTimer += k.dt();\n                    if (enemy.chargePauseTimer >= 1.0) {\n                        enemy.chargePauseTimer = 0;\n                        enemy.chargeTimer = 0; // Reset cooldown\n                    }\n                } else if (enemy.chargeTimer >= enemy.chargeCooldown) {\n                    // Ready to charge - telegraph and charge\n                    enemy.color = k.rgb(255, 255, 0); // Yellow telegraph\n                    k.wait(0.2, () => {\n                        if (enemy.exists()) {\n                            enemy.color = k.rgb(...enemy.originalColor);\n                            if (distance > 0) {\n                                enemy.isCharging = true;\n                                enemy.chargeDirection = dir.unit();\n                                enemy.chargeDuration = 0;\n                            }\n                        }\n                    });\n                    enemy.chargeTimer = 0;\n                } else {\n                    // Normal movement toward player\n                    const normalized = dir.unit();\n                    const desiredMove = normalized.scale(enemy.speed * 0.5 * k.dt()); // Slower when not charging\n                    const finalMove = applyObstacleAvoidance(desiredMove);\n                    \n                    // If movement is blocked, stop charging\n                    if (finalMove.len() < desiredMove.len() * 0.5 && enemy.isCharging) {\n                        enemy.isCharging = false;\n                        enemy.chargePauseTimer = 0.1; // Start pause\n                    }\n                    \n                    enemy.pos.x += finalMove.x;\n                    enemy.pos.y += finalMove.y;\n                }\n            }\n            return;\n        }\n        \n        if (enemy.behavior === 'erratic') {\n            // Erratic: Fast, unpredictable movement (Bat, Zippy)\n            if (distance > 0) {\n                const normalized = dir.unit();\n                // Add jitter for unpredictability\n                const jitter = k.vec2(\n                    (Math.random() - 0.5) * 0.4,\n                    (Math.random() - 0.5) * 0.4\n                );\n                const moveDir = k.vec2(\n                    normalized.x + jitter.x,\n                    normalized.y + jitter.y\n                ).unit();\n                const desiredMove = moveDir.scale(enemy.speed * k.dt());\n                const finalMove = applyObstacleAvoidance(desiredMove);\n                enemy.pos.x += finalMove.x;\n                enemy.pos.y += finalMove.y;\n            }\n            return;\n        }\n        \n        if (enemy.behavior === 'shield') {\n            // Shield Bearer: High health, blocks projectiles from front (simplified - just high health for now)\n            if (distance > 0) {\n                const normalized = dir.unit();\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\n                const finalMove = applyObstacleAvoidance(desiredMove);\n                enemy.pos.x += finalMove.x;\n                enemy.pos.y += finalMove.y;\n            }\n            return;\n        }\n        \n        if (enemy.behavior === 'teleport') {\n            // Wraith: Teleports periodically\n            enemy.teleportTimer += k.dt();\n            \n            if (enemy.teleportTimer >= enemy.teleportCooldown && distance > 0) {\n                // Teleport toward player\n                const teleportDir = dir.unit();\n                const teleportPos = k.vec2(\n                    enemy.pos.x + teleportDir.x * enemy.teleportRange,\n                    enemy.pos.y + teleportDir.y * enemy.teleportRange\n                );\n                \n                // Check if teleport position is clear\n                if (isPositionClear(teleportPos.x, teleportPos.y)) {\n                    enemy.pos.x = teleportPos.x;\n                    enemy.pos.y = teleportPos.y;\n                    enemy.teleportTimer = 0;\n                    \n                    // Visual effect\n                    enemy.color = k.rgb(255, 255, 255);\n                    k.wait(0.1, () => {\n                        if (enemy.exists()) {\n                            enemy.color = k.rgb(...enemy.originalColor);\n                        }\n                    });\n                }\n            } else {\n                // Normal movement\n                if (distance > 0) {\n                    const normalized = dir.unit();\n                    const desiredMove = normalized.scale(enemy.speed * k.dt());\n                    const finalMove = applyObstacleAvoidance(desiredMove);\n                    enemy.pos.x += finalMove.x;\n                    enemy.pos.y += finalMove.y;\n                }\n            }\n            return;\n        }\n        \n        if (enemy.behavior === 'spawner') {\n            // Spawner: Periodically spawns minions\n            enemy.spawnTimer += k.dt();\n            \n            if (enemy.spawnTimer >= enemy.spawnInterval) {\n                // Spawn minion\n                const spawnAngle = Math.random() * Math.PI * 2;\n                const spawnDistance = 30;\n                const spawnX = enemy.pos.x + Math.cos(spawnAngle) * spawnDistance;\n                const spawnY = enemy.pos.y + Math.sin(spawnAngle) * spawnDistance;\n                \n                if (isPositionClear(spawnX, spawnY)) {\n                    const minion = createEnemy(k, spawnX, spawnY, enemy.spawnType || 'rusher', enemy.floor);\n                    minion.isBossMinion = true; // Mark as minion\n                    enemy.spawnTimer = 0;\n                }\n            }\n            \n            // Normal movement (slow)\n            if (distance > 0) {\n                const normalized = dir.unit();\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\n                const finalMove = applyObstacleAvoidance(desiredMove);\n                enemy.pos.x += finalMove.x;\n                enemy.pos.y += finalMove.y;\n            }\n            return;\n        }\n        \n        if (enemy.behavior === 'buffer') {\n            // Buffer: Buffs nearby enemies\n            enemy.attackTimer += k.dt();\n            \n            if (enemy.attackTimer >= 1.0) { // Check every second\n                const nearbyEnemies = k.get('enemy');\n                for (const otherEnemy of nearbyEnemies) {\n                    if (!otherEnemy.exists() || otherEnemy === enemy) continue;\n                    \n                    const buffDir = k.vec2(\n                        otherEnemy.pos.x - enemy.pos.x,\n                        otherEnemy.pos.y - enemy.pos.y\n                    );\n                    const buffDistance = buffDir.len();\n                    \n                    if (buffDistance <= enemy.buffRadius) {\n                        // Buff this enemy\n                        if (!otherEnemy.buffed) {\n                            otherEnemy.buffed = true;\n                            otherEnemy.originalSpeed = otherEnemy.speed;\n                            otherEnemy.originalDamage = otherEnemy.damage || 10;\n                        }\n                        otherEnemy.speed = otherEnemy.originalSpeed * (1 + enemy.buffAmount);\n                        otherEnemy.damage = otherEnemy.originalDamage * (1 + enemy.buffAmount);\n                        enemy.buffedEnemies.add(otherEnemy);\n                    } else if (enemy.buffedEnemies.has(otherEnemy)) {\n                        // Remove buff if out of range\n                        if (otherEnemy.buffed) {\n                            otherEnemy.speed = otherEnemy.originalSpeed;\n                            otherEnemy.damage = otherEnemy.originalDamage;\n                            otherEnemy.buffed = false;\n                        }\n                        enemy.buffedEnemies.delete(otherEnemy);\n                    }\n                }\n                enemy.attackTimer = 0;\n            }\n            \n            // Normal movement\n            if (distance > 0) {\n                const normalized = dir.unit();\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\n                const finalMove = applyObstacleAvoidance(desiredMove);\n                enemy.pos.x += finalMove.x;\n                enemy.pos.y += finalMove.y;\n            }\n            return;\n        }\n        \n        if (enemy.behavior === 'healer') {\n            // Healer: Heals nearby enemies\n            enemy.healTimer += k.dt();\n            \n            if (enemy.healTimer >= enemy.healInterval) {\n                const nearbyEnemies = k.get('enemy');\n                for (const otherEnemy of nearbyEnemies) {\n                    if (!otherEnemy.exists() || otherEnemy === enemy) continue;\n                    \n                    const healDir = k.vec2(\n                        otherEnemy.pos.x - enemy.pos.x,\n                        otherEnemy.pos.y - enemy.pos.y\n                    );\n                    const healDistance = healDir.len();\n                    \n                    if (healDistance <= enemy.healRadius) {\n                        // Heal this enemy\n                        const currentHP = otherEnemy.hp();\n                        const maxHP = otherEnemy.maxHealth;\n                        if (currentHP < maxHP) {\n                            const newHP = Math.min(maxHP, currentHP + enemy.healAmount);\n                            otherEnemy.setHP(newHP);\n                            \n                            // Visual effect\n                            const healText = k.add([\n                                k.text('+', { size: 16 }),\n                                k.pos(otherEnemy.pos.x, otherEnemy.pos.y - 20),\n                                k.anchor('center'),\n                                k.color(100, 255, 100),\n                                k.z(200)\n                            ]);\n                            k.wait(0.5, () => {\n                                if (healText.exists()) k.destroy(healText);\n                            });\n                        }\n                    }\n                }\n                enemy.healTimer = 0;\n            }\n            \n            // Normal movement\n            if (distance > 0) {\n                const normalized = dir.unit();\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\n                const finalMove = applyObstacleAvoidance(desiredMove);\n                enemy.pos.x += finalMove.x;\n                enemy.pos.y += finalMove.y;\n            }\n            return;\n        }\n        \n        if (enemy.behavior === 'teleportPlayer') {\n            // Teleporter: Teleports player when close\n            enemy.teleportTimer += k.dt();\n            \n            if (enemy.teleportTimer >= enemy.teleportCooldown && distance <= 80) {\n                // Teleport player to random location\n                const teleportAngle = Math.random() * Math.PI * 2;\n                const teleportX = player.pos.x + Math.cos(teleportAngle) * enemy.teleportRange;\n                const teleportY = player.pos.y + Math.sin(teleportAngle) * enemy.teleportRange;\n                \n                // Clamp to screen bounds\n                const clampedX = Math.max(50, Math.min(k.width() - 50, teleportX));\n                const clampedY = Math.max(50, Math.min(k.height() - 50, teleportY));\n                \n                player.pos.x = clampedX;\n                player.pos.y = clampedY;\n                enemy.teleportTimer = 0;\n                \n                // Visual effect\n                const teleportText = k.add([\n                    k.text('!', { size: 24 }),\n                    k.pos(player.pos.x, player.pos.y),\n                    k.anchor('center'),\n                    k.color(255, 200, 0),\n                    k.z(200)\n                ]);\n                k.wait(0.3, () => {\n                    if (teleportText.exists()) k.destroy(teleportText);\n                });\n            }\n            \n            // Normal movement\n            if (distance > 0) {\n                const normalized = dir.unit();\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\n                const finalMove = applyObstacleAvoidance(desiredMove);\n                enemy.pos.x += finalMove.x;\n                enemy.pos.y += finalMove.y;\n            }\n            return;\n        }\n        \n        if (enemy.behavior === 'freeze') {\n            // Freezer: Slows player when nearby\n            if (distance <= enemy.slowRadius) {\n                if (!player.slowed) {\n                    player.slowed = true;\n                    player.originalSpeed = player.speed;\n                }\n                player.speed = player.originalSpeed * (1 - enemy.slowAmount);\n            } else {\n                if (player.slowed) {\n                    player.speed = player.originalSpeed;\n                    player.slowed = false;\n                }\n            }\n            \n            // Normal movement\n            if (distance > 0) {\n                const normalized = dir.unit();\n                const desiredMove = normalized.scale(enemy.speed * k.dt());\n                const finalMove = applyObstacleAvoidance(desiredMove);\n                enemy.pos.x += finalMove.x;\n                enemy.pos.y += finalMove.y;\n            }\n            return;\n        }\n\n        if (enemy.behavior === 'phase') {\n            // Phaser: Moves directly toward player, ignoring obstacles (semi-transparent)\n            // But still respect room boundaries to prevent getting stuck outside playable area\n            if (distance > 0) {\n                const normalized = dir.unit();\n                // No obstacle avoidance - phase through everything\n                enemy.pos.x += normalized.x * enemy.speed * k.dt();\n                enemy.pos.y += normalized.y * enemy.speed * k.dt();\n\n                // Keep phaser in bounds (important - phasers can't escape room boundaries)\n                const roomWidth = k.width();\n                const roomHeight = k.height();\n                const margin = 20;\n                const enemySize = enemy.size || 12;\n                enemy.pos.x = k.clamp(enemy.pos.x, margin + enemySize, roomWidth - margin - enemySize);\n                enemy.pos.y = k.clamp(enemy.pos.y, margin + enemySize, roomHeight - margin - enemySize);\n            }\n            return;\n        }\n\n        if (enemy.behavior === 'mimic') {\n            // Mimic: Records player movement, then replays it\n            enemy.mimicTimer += k.dt();\n\n            if (enemy.isMimicking) {\n                // Currently mimicking - replay stored movements\n                if (enemy.mimicMoveIndex < enemy.mimicMovementHistory.length) {\n                    const move = enemy.mimicMovementHistory[enemy.mimicMoveIndex];\n                    const desiredMove = k.vec2(move.x * k.dt() * 60, move.y * k.dt() * 60); // Scale for deltatime\n                    const finalMove = applyObstacleAvoidance(desiredMove);\n                    enemy.pos.x += finalMove.x;\n                    enemy.pos.y += finalMove.y;\n                    enemy.mimicMoveIndex++;\n                } else {\n                    // Finished mimicking\n                    enemy.isMimicking = false;\n                    enemy.mimicTimer = 0;\n                    enemy.mimicMovementHistory = [];\n                    enemy.mimicMoveIndex = 0;\n                }\n            } else {\n                // Not mimicking - record player movement and approach\n                if (enemy.mimicTimer < enemy.mimicDuration) {\n                    // Recording phase - store player movement direction\n                    if (player.move && (player.move.x !== 0 || player.move.y !== 0)) {\n                        enemy.mimicMovementHistory.push({ x: player.move.x, y: player.move.y });\n                    }\n\n                    // Move toward player while recording\n                    if (distance > 0) {\n                        const normalized = dir.unit();\n                        const desiredMove = normalized.scale(enemy.speed * 0.5 * k.dt()); // Slower while recording\n                        const finalMove = applyObstacleAvoidance(desiredMove);\n                        enemy.pos.x += finalMove.x;\n                        enemy.pos.y += finalMove.y;\n                    }\n                } else if (enemy.mimicTimer >= enemy.mimicCooldown) {\n                    // Start mimicking\n                    if (enemy.mimicMovementHistory.length > 0) {\n                        enemy.isMimicking = true;\n                        enemy.mimicMoveIndex = 0;\n                        // Flash to indicate mimic start\n                        enemy.color = k.rgb(255, 255, 255);\n                        k.wait(0.15, () => {\n                            if (enemy.exists()) {\n                                enemy.color = k.rgb(...enemy.originalColor);\n                            }\n                        });\n                    } else {\n                        // No movement recorded - player was standing still\n                        // Rush directly toward player for a short burst instead of doing nothing\n                        if (distance > 0) {\n                            const rushDir = dir.unit();\n                            const rushMove = rushDir.scale(enemy.speed * 1.5 * k.dt()); // Faster rush\n                            const finalMove = applyObstacleAvoidance(rushMove);\n                            enemy.pos.x += finalMove.x;\n                            enemy.pos.y += finalMove.y;\n                        }\n                        // Reset timer to try again\n                        enemy.mimicTimer = 0;\n                    }\n                } else {\n                    // Wait period between recording and mimicking - approach player\n                    if (distance > 0) {\n                        const normalized = dir.unit();\n                        const desiredMove = normalized.scale(enemy.speed * k.dt());\n                        const finalMove = applyObstacleAvoidance(desiredMove);\n                        enemy.pos.x += finalMove.x;\n                        enemy.pos.y += finalMove.y;\n                    }\n                }\n            }\n            return;\n        }\n\n        if (enemy.behavior === 'bomber') {\n            // Bomber: Stationary, launches slow homing bombs\n            enemy.attackTimer += k.dt();\n            if (distance > 0 && enemy.attackTimer >= 1 / enemy.fireRate) {\n                const direction = dir.unit();\n                const bomb = createProjectile(\n                    k,\n                    enemy.pos.x,\n                    enemy.pos.y,\n                    direction,\n                    enemy.projectileSpeed,\n                    enemy.projectileDamage,\n                    0, // piercing\n                    0, // obstaclePiercing\n                    false // isCrit\n                );\n                bomb.isEnemyProjectile = true;\n                bomb.isBomb = true;\n                bomb.homingStrength = enemy.homingStrength;\n                bomb.bombExplosionRadius = enemy.bombExplosionRadius;\n                bomb.targetPlayer = player;\n                bomb.color = k.rgb(255, 100, 0);\n                bomb.text = ''; // Bomb visual\n\n                // Add homing behavior to bomb\n                bomb.onUpdate(() => {\n                    if (bomb.targetPlayer && bomb.targetPlayer.exists() && !bomb.targetPlayer.isDead) {\n                        const toPlayer = k.vec2(\n                            bomb.targetPlayer.pos.x - bomb.pos.x,\n                            bomb.targetPlayer.pos.y - bomb.pos.y\n                        );\n                        const toPlayerNorm = toPlayer.len() > 0 ? toPlayer.unit() : k.vec2(0, 0);\n                        // Gradually adjust direction toward player\n                        bomb.direction = k.vec2(\n                            bomb.direction.x + (toPlayerNorm.x - bomb.direction.x) * bomb.homingStrength * k.dt(),\n                            bomb.direction.y + (toPlayerNorm.y - bomb.direction.y) * bomb.homingStrength * k.dt()\n                        ).unit();\n                    }\n                });\n\n                enemy.attackTimer = 0;\n            }\n            return; // Bombers don't move\n        }\n\n        // Default behavior: rush (direct charge)\n        if (enemy.behavior === 'rush') {\n            if (distance > 0) {\n                let moveDir;\n\n                // Use smart pathfinding if enabled\n                if (enemy.pathfindingMode === 'smart') {\n                    moveDir = getSmartMoveDirection(k, enemy, player.pos.x, player.pos.y);\n                } else {\n                    // Fallback to direct movement with obstacle avoidance\n                    const normalized = dir.unit();\n                    const desiredMove = normalized.scale(enemy.speed * k.dt());\n                    const finalMove = applyObstacleAvoidance(desiredMove);\n                    moveDir = finalMove.unit();\n                }\n\n                enemy.pos.x += moveDir.x * enemy.speed * k.dt();\n                enemy.pos.y += moveDir.y * enemy.speed * k.dt();\n            }\n        }\n\n        // Perimeter behavior: walks around edge of map\n        if (enemy.behavior === 'perimeter') {\n            const moveDir = getPerimeterMoveDirection(k, enemy);\n            enemy.pos.x += moveDir.x * enemy.speed * k.dt();\n            enemy.pos.y += moveDir.y * enemy.speed * k.dt();\n        }\n        \n        // Keep enemy in bounds (room boundaries) - same as player\n        const roomWidth = k.width();\n        const roomHeight = k.height();\n        const margin = 20;\n        const enemySize = enemy.size || 12;\n        \n        enemy.pos.x = k.clamp(enemy.pos.x, margin + enemySize, roomWidth - margin - enemySize);\n        enemy.pos.y = k.clamp(enemy.pos.y, margin + enemySize, roomHeight - margin - enemySize);\n    });\n\n    // Mark as not dead initially\n    enemy.isDead = false;\n    \n    // Cleanup buffs when buffer dies\n    enemy.onDeath(() => {\n        // Remove buffs from enemies when buffer dies\n        if (enemy.behavior === 'buffer' && enemy.buffedEnemies) {\n            for (const buffedEnemy of enemy.buffedEnemies) {\n                if (buffedEnemy.exists() && buffedEnemy.buffed) {\n                    buffedEnemy.speed = buffedEnemy.originalSpeed;\n                    buffedEnemy.damage = buffedEnemy.originalDamage;\n                    buffedEnemy.buffed = false;\n                }\n            }\n        }\n    });\n    \n    // Handle special death mechanics\n    enemy.onDeath(() => {\n        // In multiplayer, broadcast death event from host\n        if (isMultiplayerActive() && isHost() && enemy.mpEntityId) {\n            broadcastDeathEvent({\n                entityId: enemy.mpEntityId,\n                entityType: 'enemy',\n                x: enemy.pos.x,\n                y: enemy.pos.y,\n                xpDropped: enemy.xpValue\n            });\n        }\n\n        // Enemy splitting - only spawn on host in multiplayer to avoid desyncs\n        if (enemy.splits && enemy.hp() <= 0) {\n            // In multiplayer, only host spawns split enemies and broadcasts them\n            if (isMultiplayerActive() && !isHost()) {\n                return; // Clients skip spawning - they'll receive spawn_entity messages\n            }\n\n            const splitCount = enemy.splitCount || 2;\n            const splitType = enemy.splitType || 'slime'; // Fallback to slime for legacy behavior\n            for (let i = 0; i < splitCount; i++) {\n                const angle = (Math.PI * 2 / splitCount) * i;\n                const spawnDistance = 20;\n                const spawnX = enemy.pos.x + Math.cos(angle) * spawnDistance;\n                const spawnY = enemy.pos.y + Math.sin(angle) * spawnDistance;\n\n                // Create smaller enemy (half health, smaller size)\n                // Ensure minimum health of 10 to prevent 0 HP enemies\n                const splitEnemy = createEnemy(k, spawnX, spawnY, splitType, enemy.floor);\n                splitEnemy.maxHealth = Math.max(10, Math.floor(splitEnemy.maxHealth / 2));\n                splitEnemy.setHP(splitEnemy.maxHealth);\n                splitEnemy.size = Math.max(8, Math.floor(splitEnemy.size * 0.8)); // Minimum size of 8\n                splitEnemy.splits = false; // Don't split again\n                splitEnemy.isSplitEnemy = true; // Mark as split enemy for tracking\n\n                // Register split enemy for multiplayer sync (host only)\n                if (isMultiplayerActive() && isHost() && registerEnemy) {\n                    registerEnemy(splitEnemy, {\n                        enemyType: splitType,\n                        maxHealth: splitEnemy.maxHealth,\n                        floor: enemy.floor,\n                        isSplitEnemy: true\n                    });\n                }\n            }\n\n            // Increment split enemy counter\n            if (k.gameData && k.gameData.incrementSplitEnemies) {\n                k.gameData.incrementSplitEnemies(splitCount);\n            }\n\n            // Broadcast split event to clients in multiplayer\n            if (isMultiplayerActive() && isHost()) {\n                broadcastEnemySplit(splitCount);\n            }\n        }\n        \n        // Exploder explosion\n        if (enemy.explodes && enemy.hp() <= 0) {\n            // Damage all players within explosion radius (only host in multiplayer)\n            if (!isMultiplayerActive() || isHost()) {\n                const allPlayers = k.get('player');\n                allPlayers.forEach(player => {\n                    if (player && player.exists() && !player.isDead) {\n                        const explosionDir = k.vec2(\n                            player.pos.x - enemy.pos.x,\n                            player.pos.y - enemy.pos.y\n                        );\n                        const explosionDistance = explosionDir.len();\n\n                        if (explosionDistance <= enemy.explosionRadius) {\n                            // Player is in explosion radius\n                            if (!player.invulnerable) {\n                                const finalDamage = Math.max(1, enemy.explosionDamage - (player.defense || 0));\n                                player.hurt(finalDamage);\n                                player.invulnerable = true;\n                                player.invulnerableTime = player.invulnerableDuration;\n                                player.color = k.rgb(255, 100, 100);\n                            }\n                        }\n                    }\n                });\n            }\n            \n            // Visual explosion effect (could add particles later)\n            const explosionText = k.add([\n                k.text('*', { size: 24 }),\n                k.pos(enemy.pos.x, enemy.pos.y),\n                k.anchor('center'),\n                k.color(255, 200, 0),\n                k.z(200)\n            ]);\n            k.wait(0.2, () => {\n                if (explosionText.exists()) k.destroy(explosionText);\n            });\n        }\n    });\n\n    // Multiplayer: Register enemy for network sync if host\n    if (isMultiplayerActive() && isHost()) {\n        registerEnemy(enemy, { type, floor });\n        enemy.enemyType = type; // Store type for sync\n    }\n\n    return enemy;\n}\n\n","/**\n * Miniboss Type Definitions\n *\n * Scaled-down bosses that appear randomly in rooms.\n * Minibosses have armor/shield systems but lower stats than full bosses.\n */\n\nexport const MINIBOSS_TYPES = {\n    brute: {\n        name: 'Security Chief',\n        coreChar: 'B',\n        armorChar: '[]',\n        shieldChar: '{}',\n        color: [255, 100, 50], // Orange-red\n        armorColor: [200, 200, 200],\n        shieldColor: [100, 200, 255],\n        baseHealth: 200,\n        baseArmorHealth: 50,\n        baseShieldHealth: 0,\n        baseSpeed: 60,\n        size: 24,\n        baseXPValue: 50,\n        damageReduction: 0.25,\n        shieldRegenRate: 0,\n        meleeDamage: 18,\n        behavior: 'charge' // Charges at player periodically\n    },\n    sentinel: {\n        name: 'Technical Director',\n        coreChar: 'S',\n        armorChar: '[]',\n        shieldChar: '{}',\n        color: [100, 200, 255], // Light blue\n        armorColor: [200, 200, 200],\n        shieldColor: [100, 200, 255],\n        baseHealth: 180,\n        baseArmorHealth: 40,\n        baseShieldHealth: 30, // Has shields\n        baseSpeed: 50,\n        size: 24,\n        baseXPValue: 45,\n        damageReduction: 0.2,\n        shieldRegenRate: 2, // 2 HP/sec regen\n        projectileDamage: 12,\n        projectileSpeed: 250,\n        fireRate: 1.2,\n        behavior: 'shoot' // Ranged attacker\n    },\n    berserker: {\n        name: 'Stunt Coordinator',\n        coreChar: 'Z',\n        armorChar: '[]',\n        shieldChar: '{}',\n        color: [255, 50, 50], // Red\n        armorColor: [200, 200, 200],\n        shieldColor: [100, 200, 255],\n        baseHealth: 250,\n        baseArmorHealth: 0,\n        baseShieldHealth: 0,\n        baseSpeed: 80, // Fast\n        size: 24,\n        baseXPValue: 55,\n        damageReduction: 0,\n        shieldRegenRate: 0,\n        meleeDamage: 20,\n        behavior: 'rush' // Fast, aggressive\n    },\n    guardian: {\n        name: 'Studio Manager',\n        coreChar: 'G',\n        armorChar: '[]',\n        shieldChar: '{}',\n        color: [150, 150, 255], // Light purple\n        armorColor: [200, 200, 200],\n        shieldColor: [100, 200, 255],\n        baseHealth: 220,\n        baseArmorHealth: 60, // Heavy armor\n        baseShieldHealth: 0,\n        baseSpeed: 40, // Slow\n        size: 24,\n        baseXPValue: 50,\n        damageReduction: 0.3,\n        shieldRegenRate: 0,\n        meleeDamage: 16,\n        behavior: 'rush' // Tanky, slow\n    },\n    warlock: {\n        name: 'Creative Director',\n        coreChar: 'W',\n        armorChar: '[]',\n        shieldChar: '{}',\n        color: [200, 100, 255], // Purple\n        armorColor: [200, 200, 200],\n        shieldColor: [100, 200, 255],\n        baseHealth: 160,\n        baseArmorHealth: 0,\n        baseShieldHealth: 40, // Has shields\n        baseSpeed: 55,\n        size: 24,\n        baseXPValue: 48,\n        damageReduction: 0,\n        shieldRegenRate: 3, // 3 HP/sec regen\n        projectileDamage: 14,\n        projectileSpeed: 220,\n        fireRate: 1.0,\n        behavior: 'shoot' // Ranged with shields\n    }\n};\n\n/**\n * Get miniboss definition by type key\n * @param {string} type - Miniboss type key\n * @returns {object} Miniboss configuration\n */\nexport function getMinibossDefinition(type) {\n    return MINIBOSS_TYPES[type] || MINIBOSS_TYPES.brute;\n}\n\n/**\n * Get all miniboss types\n * @returns {Array<string>} Array of miniboss type keys\n */\nexport function getAllMinibossTypes() {\n    return Object.keys(MINIBOSS_TYPES);\n}\n","// Miniboss entity definition - scaled-down bosses that appear randomly in rooms\nimport { createProjectile } from './projectile.js';\nimport { getMinibossDefinition } from '../data/minibosses.js';\nimport { isMultiplayerActive, isHost } from '../systems/multiplayerGame.js';\n\nexport function createMiniboss(k, x, y, type = 'brute', floor = 1) {\n    const baseConfig = getMinibossDefinition(type);\n    \n    // Scale stats based on floor\n    const floorMultiplier = 1 + (floor - 1) * 0.2; // 20% increase per floor\n    const config = {\n        coreChar: baseConfig.coreChar,\n        armorChar: baseConfig.armorChar || '[]',\n        shieldChar: baseConfig.shieldChar || '{}',\n        color: baseConfig.color,\n        armorColor: baseConfig.armorColor || [200, 200, 200],\n        shieldColor: baseConfig.shieldColor || [100, 200, 255],\n        health: Math.floor(baseConfig.baseHealth * floorMultiplier),\n        armorHealth: Math.floor((baseConfig.baseArmorHealth || 0) * floorMultiplier),\n        maxArmorHealth: Math.floor((baseConfig.baseArmorHealth || 0) * floorMultiplier),\n        shieldHealth: Math.floor((baseConfig.baseShieldHealth || 0) * floorMultiplier),\n        maxShieldHealth: Math.floor((baseConfig.baseShieldHealth || 0) * floorMultiplier),\n        speed: Math.floor(baseConfig.baseSpeed * (1 + (floor - 1) * 0.05)),\n        size: baseConfig.size,\n        xpValue: Math.floor(baseConfig.baseXPValue * floorMultiplier),\n        damageReduction: baseConfig.damageReduction || 0,\n        shieldRegenRate: (baseConfig.shieldRegenRate || 0) * floorMultiplier\n    };\n    \n    // Create miniboss entity\n    const miniboss = k.add([\n        k.text(config.coreChar, { size: config.size }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...config.color),\n        k.area(),\n        k.health(config.health),\n        'miniboss'\n    ]);\n\n    miniboss.maxHealth = config.health;\n    miniboss.speed = config.speed;\n    miniboss.xpValue = config.xpValue;\n    miniboss.type = type;\n    miniboss.floor = floor;\n    \n    // Store miniboss-specific stats\n    if (baseConfig.meleeDamage) miniboss.meleeDamage = baseConfig.meleeDamage;\n    if (baseConfig.projectileDamage) miniboss.projectileDamage = baseConfig.projectileDamage;\n    if (baseConfig.projectileSpeed) miniboss.projectileSpeed = baseConfig.projectileSpeed;\n    if (baseConfig.fireRate) miniboss.fireRate = baseConfig.fireRate;\n    \n    // Armor properties\n    miniboss.armorHealth = config.armorHealth;\n    miniboss.maxArmorHealth = config.maxArmorHealth;\n    miniboss.damageReduction = config.damageReduction;\n    miniboss.coreChar = config.coreChar;\n    miniboss.armorChar = config.armorChar;\n    miniboss.armorColor = config.armorColor;\n    \n    // Shield properties\n    miniboss.shieldHealth = config.shieldHealth;\n    miniboss.maxShieldHealth = config.maxShieldHealth;\n    miniboss.shieldRegenRate = config.shieldRegenRate;\n    miniboss.shieldChar = config.shieldChar;\n    miniboss.shieldColor = config.shieldColor;\n    miniboss.shieldRegenTimer = 0;\n    miniboss.shieldRegenCooldown = 0;\n    miniboss.lastDamageTime = 0;\n    \n    // Behavior-specific timers\n    miniboss.attackTimer = 0;\n    miniboss.chargeCooldownTimer = 0;\n    miniboss.chargeDurationTimer = 0;\n    miniboss.isCharging = false;\n    miniboss.chargeDirection = null;\n    miniboss.chargeSpeed = 0;\n    \n    // Function to update visual representation\n    miniboss.updateVisual = function() {\n        // Priority: Shields > Armor > Core\n        let leftShield = '';\n        let rightShield = '';\n        let leftArmor = '';\n        let rightArmor = '';\n        \n        // Shields take priority (outermost layer)\n        // Size scales with health: Full =  , Medium =  , Low =  \n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\n        if (miniboss.shieldHealth > 0) {\n            const shieldPercent = miniboss.shieldHealth / miniboss.maxShieldHealth;\n            \n            if (shieldPercent > 0.66) {\n                // Full shield (66-100%): Double brackets   (mathematical double brackets)\n                leftShield = '';\n                rightShield = '';\n            } else if (shieldPercent > 0.33) {\n                // Medium shield (33-66%): Left/right white parenthesis  \n                leftShield = '';\n                rightShield = '';\n            } else {\n                // Low shield (0-33%): Left/right angle brackets  \n                leftShield = '';\n                rightShield = '';\n            }\n        }\n        \n        // Armor (middle layer, can appear with shields: {[B]})\n        // Size scales with health: Full =  , Medium =  , Low =  \n        // Using Unicode characters to avoid KAPLAY styled text tag parsing\n        if (miniboss.armorHealth > 0) {\n            const armorPercent = miniboss.armorHealth / miniboss.maxArmorHealth;\n            \n            if (armorPercent > 0.66) {\n                // Full armor (66-100%): Double brackets   (mathematical double brackets)\n                leftArmor = '';\n                rightArmor = '';\n            } else if (armorPercent > 0.33) {\n                // Medium armor (33-66%): Left/right angle brackets  \n                leftArmor = '';\n                rightArmor = '';\n            } else {\n                // Low armor (0-33%): Left/right double angle brackets  \n                leftArmor = '';\n                rightArmor = '';\n            }\n        }\n        \n        // Visual format: {[B]} (shields outside, armor inside)\n        const visual = `${leftShield}${leftArmor}${miniboss.coreChar}${rightArmor}${rightShield}`;\n        \n        // Update text component\n        miniboss.text = visual;\n        \n        // Update color - use shield color if shields exist, otherwise original color\n        if (miniboss.shieldHealth > 0) {\n            miniboss.color = k.rgb(...config.shieldColor);\n        } else {\n            miniboss.color = k.rgb(...config.color);\n        }\n    };\n    \n    // Function to take damage (handles shields, then armor, then health)\n    miniboss.takeDamage = function(damage) {\n        let shieldChanged = false;\n        let armorChanged = false;\n        const previousShieldHealth = miniboss.shieldHealth;\n        const previousArmorHealth = miniboss.armorHealth;\n        \n        // Track damage time for shield regen cooldown\n        miniboss.lastDamageTime = k.time();\n        const shieldRegenCooldownDuration = 3.0; // 3 seconds cooldown after taking damage\n        miniboss.shieldRegenCooldown = shieldRegenCooldownDuration;\n        \n        // Priority: Shields > Armor > Health\n        // Shields take normal damage (no reduction)\n        if (miniboss.shieldHealth > 0) {\n            const shieldDamage = Math.min(damage, miniboss.shieldHealth);\n            miniboss.shieldHealth = Math.max(0, miniboss.shieldHealth - shieldDamage);\n            shieldChanged = (miniboss.shieldHealth !== previousShieldHealth);\n            \n            // Remaining damage goes to armor/health\n            const remainingDamage = damage - shieldDamage;\n            if (remainingDamage > 0) {\n                miniboss.takeDamageInternal(remainingDamage);\n            }\n        } else {\n            // No shields - damage goes to armor/health\n            miniboss.takeDamageInternal(damage);\n        }\n        \n        armorChanged = (miniboss.armorHealth !== previousArmorHealth);\n        \n        // Update visual when shields or armor change\n        if (shieldChanged || armorChanged) {\n            miniboss.updateVisual();\n        }\n    };\n    \n    // Internal damage function (handles armor and health)\n    miniboss.takeDamageInternal = function(damage) {\n        // If armor exists, armor takes reduced damage first\n        if (miniboss.armorHealth > 0) {\n            // Apply damage reduction to armor damage\n            const reducedDamage = Math.floor(damage * (1 - miniboss.damageReduction));\n            const armorDamage = Math.min(reducedDamage, miniboss.armorHealth);\n            miniboss.armorHealth = Math.max(0, miniboss.armorHealth - armorDamage);\n            \n            // Remaining damage goes to miniboss, but reduced if armor still exists\n            const remainingDamage = damage - reducedDamage;\n            if (remainingDamage > 0) {\n                const damageMultiplier = miniboss.armorHealth > 0 ? (1 - miniboss.damageReduction) : 1;\n                const finalDamage = Math.floor(remainingDamage * damageMultiplier);\n                miniboss.hurt(finalDamage);\n            }\n        } else {\n            // No armor - full damage\n            miniboss.hurt(damage);\n        }\n    };\n    \n    // Charge attack\n    miniboss.startCharge = function(targetPos) {\n        if (!miniboss.exists()) return;\n        \n        miniboss.isCharging = true;\n        const dir = k.vec2(targetPos.x - miniboss.pos.x, targetPos.y - miniboss.pos.y);\n        if (dir.len() > 0) {\n            miniboss.chargeDirection = dir.unit();\n            miniboss.chargeSpeed = miniboss.speed * 2.5; // 2.5x speed for charge\n        }\n    };\n    \n    // AI based on behavior type\n    miniboss.onUpdate(() => {\n        if (k.paused) return;\n        \n        // Shield regeneration (if shields exist and regen rate > 0)\n        // Only regen if cooldown has expired (not damaged recently) and miniboss is alive\n        if (miniboss.shieldRegenRate > 0 && miniboss.shieldHealth < miniboss.maxShieldHealth && miniboss.hp() > 0 && !miniboss.isDead) {\n            // Update cooldown timer\n            if (miniboss.shieldRegenCooldown > 0) {\n                miniboss.shieldRegenCooldown -= k.dt();\n            }\n            \n            // Only regenerate if cooldown has expired\n            if (miniboss.shieldRegenCooldown <= 0) {\n                miniboss.shieldRegenTimer += k.dt();\n                const regenInterval = 1.0; // Regenerate every second\n                \n                if (miniboss.shieldRegenTimer >= regenInterval) {\n                    const regenAmount = miniboss.shieldRegenRate * regenInterval;\n                    miniboss.shieldHealth = Math.min(miniboss.maxShieldHealth, miniboss.shieldHealth + regenAmount);\n                    miniboss.shieldRegenTimer = 0;\n                    \n                    // Update visual if shield regenerated\n                    if (miniboss.shieldHealth > 0) {\n                        miniboss.updateVisual();\n                    }\n                }\n            }\n        }\n\n        // Process burn DoT (Damage over Time) from flamethrower\n        if (miniboss.burnDuration > 0 && miniboss.hp() > 0 && !miniboss.isDead) {\n            miniboss.burnTimer = (miniboss.burnTimer || 0) + k.dt();\n            const burnTickInterval = 0.5; // Deal burn damage every 0.5 seconds\n\n            if (miniboss.burnTimer >= burnTickInterval) {\n                // In multiplayer, only host deals burn damage\n                if (!isMultiplayerActive() || isHost()) {\n                    // Deal burn damage\n                    if (miniboss.takeDamage) {\n                        miniboss.takeDamage(miniboss.burnDamage);\n                    } else {\n                        miniboss.hurt(miniboss.burnDamage);\n                    }\n                }\n\n                // Visual feedback for burn damage (orange tint) on all clients\n                const originalColor = miniboss.color;\n                miniboss.color = k.rgb(255, 150, 50);\n                k.wait(0.1, () => {\n                    if (miniboss.exists()) {\n                        miniboss.updateVisual();\n                    }\n                });\n\n                miniboss.burnTimer = 0;\n            }\n\n            // Decrease burn duration\n            miniboss.burnDuration -= k.dt();\n            if (miniboss.burnDuration <= 0) {\n                miniboss.burnDamage = 0;\n                miniboss.burnTimer = 0;\n            }\n        }\n\n        const player = k.get('player')[0];\n        if (!player || !player.exists()) return;\n        \n        const dir = k.vec2(\n            player.pos.x - miniboss.pos.x,\n            player.pos.y - miniboss.pos.y\n        );\n        const distance = dir.len();\n        \n        // Behavior-specific AI\n        if (baseConfig.behavior === 'charge') {\n            // Brute: Charges at player periodically\n            miniboss.attackTimer += k.dt();\n            miniboss.chargeCooldownTimer += k.dt();\n            \n            const chargeCooldown = 6; // 6 seconds between charges\n            const chargeDistance = 200; // Distance to start charge\n            \n            // Handle charge attack\n            if (miniboss.isCharging) {\n                const chargeMove = miniboss.chargeDirection.scale(miniboss.chargeSpeed * k.dt());\n                miniboss.pos.x += chargeMove.x;\n                miniboss.pos.y += chargeMove.y;\n                \n                miniboss.chargeDurationTimer += k.dt();\n                const chargeDuration = 1.0;\n                if (miniboss.chargeDurationTimer >= chargeDuration) {\n                    miniboss.isCharging = false;\n                    miniboss.chargeDurationTimer = 0;\n                    miniboss.chargeCooldownTimer = 0;\n                }\n            } else {\n                // Normal movement toward player\n                if (distance > 0) {\n                    const normalized = dir.unit();\n                    const moveAmount = normalized.scale(miniboss.speed * k.dt());\n                    miniboss.pos.x += moveAmount.x;\n                    miniboss.pos.y += moveAmount.y;\n                }\n                \n                // Charge attack when close enough\n                if (miniboss.chargeCooldownTimer >= chargeCooldown && distance < chargeDistance) {\n                    miniboss.color = k.rgb(255, 255, 0); // Yellow telegraph\n                    k.wait(0.3, () => {\n                        if (miniboss.exists()) {\n                            miniboss.color = k.rgb(...config.color);\n                            miniboss.startCharge(player.pos);\n                        }\n                    });\n                    miniboss.chargeCooldownTimer = 0;\n                }\n            }\n        } else if (baseConfig.behavior === 'shoot') {\n            // Sentinel/Warlock: Ranged attacker\n            miniboss.attackTimer += k.dt();\n            \n            // Movement: maintain distance from player\n            const preferredDistance = 180;\n            if (distance > 0) {\n                const normalized = dir.unit();\n                let moveSpeed = miniboss.speed;\n                \n                // Move away if too close, move closer if too far\n                if (distance < preferredDistance) {\n                    // Move away from player\n                    const moveAmount = normalized.scale(-moveSpeed * k.dt());\n                    miniboss.pos.x += moveAmount.x;\n                    miniboss.pos.y += moveAmount.y;\n                } else if (distance > preferredDistance * 1.5) {\n                    // Move closer if too far\n                    const moveAmount = normalized.scale(moveSpeed * k.dt());\n                    miniboss.pos.x += moveAmount.x;\n                    miniboss.pos.y += moveAmount.y;\n                }\n            }\n            \n            // Fire projectiles at player\n            const fireInterval = 1 / miniboss.fireRate;\n            if (miniboss.attackTimer >= fireInterval) {\n                if (distance > 0) {\n                    const direction = dir.unit();\n                    const projectile = createProjectile(\n                        k, \n                        miniboss.pos.x, \n                        miniboss.pos.y, \n                        direction, \n                        miniboss.projectileSpeed, \n                        miniboss.projectileDamage, \n                        0, \n                        0, \n                        false\n                    );\n                    projectile.isBossProjectile = true;\n                    projectile.color = k.rgb(...config.color);\n                }\n                miniboss.attackTimer = 0;\n            }\n        } else if (baseConfig.behavior === 'rush') {\n            // Berserker/Guardian: Direct charge at player\n            if (distance > 0) {\n                const normalized = dir.unit();\n                const moveAmount = normalized.scale(miniboss.speed * k.dt());\n                miniboss.pos.x += moveAmount.x;\n                miniboss.pos.y += moveAmount.y;\n            }\n        }\n\n        // Keep miniboss in bounds (room boundaries)\n        const roomWidth = k.width();\n        const roomHeight = k.height();\n        const margin = 20;\n        const minibossSize = miniboss.size || 24;\n\n        miniboss.pos.x = k.clamp(miniboss.pos.x, margin + minibossSize, roomWidth - margin - minibossSize);\n        miniboss.pos.y = k.clamp(miniboss.pos.y, margin + minibossSize, roomHeight - margin - minibossSize);\n    });\n    \n    // Mark as not dead initially\n    miniboss.isDead = false;\n    \n    // Initialize visual\n    miniboss.updateVisual();\n\n    return miniboss;\n}\n\n","// Door entity definition\nexport function createDoor(k, x, y, direction) {\n    // Create a group to hold door parts\n    // Add a rect component so area() has a shape to work with\n    const doorGroup = k.add([\n        k.rect(40, 40),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.area(),\n        k.opacity(0), // Make the rect invisible (only used for collision)\n        k.fixed(),\n        'door'\n    ]);\n\n    doorGroup.direction = direction;\n    doorGroup.open = false;\n    doorGroup.isSpawnDoor = false;\n    doorGroup.blocked = false; // NEW: Blocked state for doors that don't lead anywhere\n    doorGroup.gridDirection = null; // NEW: Which grid direction this door represents\n    doorGroup.parts = []; // Store door visual parts\n\n    // Function to update door appearance based on state\n    doorGroup.updateVisual = () => {\n        // Remove old parts\n        doorGroup.parts.forEach(part => {\n            if (part.exists()) k.destroy(part);\n        });\n        doorGroup.parts = [];\n\n        // Determine color based on state\n        let color;\n        if (doorGroup.blocked) {\n            color = k.rgb(80, 80, 80);  // Gray when blocked\n        } else if (doorGroup.open) {\n            color = k.rgb(100, 255, 100);  // Green when open\n        } else if (doorGroup.isSpawnDoor) {\n            color = k.rgb(200, 50, 50);  // Red for spawn doors\n        } else {\n            color = k.rgb(200, 200, 100);  // Yellow for closed exit doors\n        }\n\n        if (direction === 'north' || direction === 'south') {\n            // Horizontal doors (top and bottom)\n            // Use box drawing characters for a nice doorway look\n            const doorChars = doorGroup.blocked ? '' : (doorGroup.open ? '' : '');\n\n            const doorText = k.add([\n                k.text(doorChars, { size: 24 }),\n                k.pos(x, y),\n                k.anchor('center'),\n                k.color(color),\n                k.fixed(),\n                k.z(100)\n            ]);\n            doorGroup.parts.push(doorText);\n\n            // Add decorative corners\n            const leftCorner = k.add([\n                k.text(doorGroup.open ? '' : '', { size: 20 }),\n                k.pos(x - 35, y),\n                k.anchor('center'),\n                k.color(color),\n                k.fixed(),\n                k.z(100)\n            ]);\n            doorGroup.parts.push(leftCorner);\n\n            const rightCorner = k.add([\n                k.text(doorGroup.open ? '' : '', { size: 20 }),\n                k.pos(x + 35, y),\n                k.anchor('center'),\n                k.color(color),\n                k.fixed(),\n                k.z(100)\n            ]);\n            doorGroup.parts.push(rightCorner);\n\n        } else {\n            // Vertical doors (left and right sides)\n            // Stack characters vertically for proper door appearance\n            const doorChars = doorGroup.blocked ? ['', '', ''] : (doorGroup.open ? ['', '', ''] : ['', '', '']);\n            const spacing = 16; // Vertical spacing between characters\n\n            for (let i = 0; i < doorChars.length; i++) {\n                const offsetY = (i - 1) * spacing; // Center around y position\n                const doorPart = k.add([\n                    k.text(doorChars[i], { size: 24 }),\n                    k.pos(x, y + offsetY),\n                    k.anchor('center'),\n                    k.color(color),\n                    k.fixed(),\n                    k.z(100)\n                ]);\n                doorGroup.parts.push(doorPart);\n            }\n\n            // Add decorative top and bottom\n            const topDecor = k.add([\n                k.text(doorGroup.open ? '' : '', { size: 20 }),\n                k.pos(x, y - spacing * 1.5),\n                k.anchor('center'),\n                k.color(color),\n                k.fixed(),\n                k.z(100)\n            ]);\n            doorGroup.parts.push(topDecor);\n\n            const bottomDecor = k.add([\n                k.text(doorGroup.open ? '' : '', { size: 20 }),\n                k.pos(x, y + spacing * 1.5),\n                k.anchor('center'),\n                k.color(color),\n                k.fixed(),\n                k.z(100)\n            ]);\n            doorGroup.parts.push(bottomDecor);\n        }\n\n        // Add 'X' overlay for blocked doors\n        if (doorGroup.blocked) {\n            const blockedMarker = k.add([\n                k.text('X', { size: 28 }),\n                k.pos(x, y),\n                k.anchor('center'),\n                k.color(255, 100, 100),\n                k.fixed(),\n                k.z(101)\n            ]);\n            doorGroup.parts.push(blockedMarker);\n        }\n    };\n\n    // Override color setter to update all parts\n    Object.defineProperty(doorGroup, 'color', {\n        get: () => doorGroup._color,\n        set: (newColor) => {\n            doorGroup._color = newColor;\n            doorGroup.parts.forEach(part => {\n                if (part.exists()) {\n                    part.color = newColor;\n                }\n            });\n        }\n    });\n\n    // Override text setter to maintain compatibility\n    Object.defineProperty(doorGroup, 'text', {\n        get: () => doorGroup._text || '=',\n        set: (newText) => {\n            doorGroup._text = newText;\n            // Don't actually update visuals - updateVisual() handles this\n        }\n    });\n\n    // Cleanup handler to prevent memory leaks\n    doorGroup.onDestroy(() => {\n        // Destroy all visual parts when door is destroyed\n        doorGroup.parts.forEach(part => {\n            if (part.exists()) {\n                k.destroy(part);\n            }\n        });\n        doorGroup.parts = [];\n    });\n\n    // Initial visual setup\n    doorGroup.updateVisual();\n\n    return doorGroup;\n}\n","// Obstacle entity definition\n// Obstacles can be walls (block everything) or cover (block movement, allow projectiles)\n\nexport function createObstacle(k, x, y, width, height, type = 'wall', char = '#', color = null) {\n    // type: 'wall' (blocks movement and projectiles) or 'cover' (blocks movement, projectiles pass)\n    \n    // Visual distinction: walls are darker/solid, cover is lighter/more transparent\n    // Walls: darker gray (100, 100, 100) - solid, blocks everything\n    // Cover: lighter gray (140, 140, 140) - allows projectiles through\n    const isWall = type === 'wall';\n    const defaultColor = isWall ? k.rgb(100, 100, 100) : k.rgb(140, 140, 140);\n    const defaultOutline = isWall ? k.rgb(80, 80, 80) : k.rgb(120, 120, 120);\n    \n    // Use rect for visual representation\n    const obstacle = k.add([\n        k.rect(width, height),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(color || defaultColor),\n        k.outline(2, color || defaultOutline), // Thicker outline for better visibility\n        k.area({ width: width, height: height }),\n        k.fixed(), // Fixed position (doesn't move)\n        'obstacle',\n        type === 'wall' ? 'wall' : 'cover' // Tag for collision filtering\n    ]);\n    \n    obstacle.type = type; // 'wall' or 'cover'\n    obstacle.width = width;\n    obstacle.height = height;\n    \n    return obstacle;\n}\n\n","/**\n * Explosive Barrel Entity\n *\n * Destructible environmental hazard that:\n * - Has a health bar and takes multiple hits to destroy\n * - Creates AOE explosion damaging players and enemies\n * - Can trigger chain reactions with nearby barrels\n * - Adds tactical depth to combat\n */\n\nimport { isMultiplayerActive, isHost } from '../systems/multiplayerGame.js';\nimport { broadcast } from '../systems/networkSystem.js';\n\n// Barrel configuration\nconst BARREL_CONFIG = {\n    // Visual\n    CHAR: '',\n    SIZE: 20,\n    COLOR: [180, 80, 40], // Orange-red\n    DAMAGED_COLOR: [220, 100, 30], // Brighter when damaged\n    CRITICAL_COLOR: [255, 60, 20], // Red when near death\n\n    // Stats\n    MAX_HEALTH: 3,\n\n    // Explosion\n    EXPLOSION_RADIUS: 80,\n    EXPLOSION_DAMAGE: 25,\n    CHAIN_DELAY: 0.15, // Delay before chain reaction (seconds)\n    KNOCKBACK_FORCE: 200,\n\n    // Visual effects\n    SHAKE_INTENSITY: 0.5,\n    EXPLOSION_DURATION: 0.3\n};\n\n// Track all barrels for chain reactions\nlet allBarrels = [];\n\n/**\n * Create an explosive barrel\n * @param {object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {object} options - Optional configuration overrides\n * @returns {object} - Barrel entity\n */\nexport function createBarrel(k, x, y, options = {}) {\n    const config = { ...BARREL_CONFIG, ...options };\n\n    const barrel = k.add([\n        k.text(config.CHAR, { size: config.SIZE }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.area({ width: config.SIZE, height: config.SIZE }),\n        k.color(...config.COLOR),\n        k.z(50),\n        k.opacity(1),\n        'barrel',\n        'obstacle', // Blocks movement like other obstacles\n        {\n            maxHealth: config.MAX_HEALTH,\n            currentHealth: config.MAX_HEALTH,\n            explosionRadius: config.EXPLOSION_RADIUS,\n            explosionDamage: config.EXPLOSION_DAMAGE,\n            chainDelay: config.CHAIN_DELAY,\n            knockbackForce: config.KNOCKBACK_FORCE,\n            isExploding: false,\n            barrelId: Math.random().toString(36).substr(2, 9)\n        }\n    ]);\n\n    // Create health bar background\n    const healthBarBg = k.add([\n        k.rect(24, 4),\n        k.pos(x, y - 18),\n        k.anchor('center'),\n        k.color(40, 40, 40),\n        k.z(51),\n        'barrelHealthBar'\n    ]);\n\n    // Create health bar fill\n    const healthBarFill = k.add([\n        k.rect(22, 2),\n        k.pos(x - 11, y - 18),\n        k.anchor('left'),\n        k.color(255, 100, 50),\n        k.z(52),\n        'barrelHealthBar'\n    ]);\n\n    // Store references\n    barrel.healthBarBg = healthBarBg;\n    barrel.healthBarFill = healthBarFill;\n\n    // Update health bar position and size\n    barrel.updateHealthBar = () => {\n        if (!barrel.exists()) return;\n\n        const healthPercent = barrel.currentHealth / barrel.maxHealth;\n\n        if (healthBarBg.exists()) {\n            healthBarBg.pos.x = barrel.pos.x;\n            healthBarBg.pos.y = barrel.pos.y - 18;\n        }\n\n        if (healthBarFill.exists()) {\n            healthBarFill.pos.x = barrel.pos.x - 11;\n            healthBarFill.pos.y = barrel.pos.y - 18;\n            healthBarFill.width = 22 * healthPercent;\n\n            // Color based on health\n            if (healthPercent <= 0.33) {\n                healthBarFill.color = k.rgb(255, 50, 50);\n            } else if (healthPercent <= 0.66) {\n                healthBarFill.color = k.rgb(255, 150, 50);\n            }\n        }\n\n        // Update barrel color based on damage\n        if (healthPercent <= 0.33) {\n            barrel.color = k.rgb(...config.CRITICAL_COLOR);\n            // Add shake effect when critical\n            barrel.pos.x += (Math.random() - 0.5) * 2;\n            barrel.pos.y += (Math.random() - 0.5) * 2;\n        } else if (healthPercent <= 0.66) {\n            barrel.color = k.rgb(...config.DAMAGED_COLOR);\n        }\n    };\n\n    // Take damage from any source\n    barrel.takeDamage = (damage = 1, sourceId = null, fromNetwork = false) => {\n        if (barrel.isExploding || !barrel.exists()) return;\n\n        barrel.currentHealth -= damage;\n        barrel.updateHealthBar();\n\n        // Broadcast damage in multiplayer (only host broadcasts, and only if not from network)\n        if (!fromNetwork && isMultiplayerActive() && isHost()) {\n            broadcast('barrel_damage', {\n                x: barrel.pos.x,\n                y: barrel.pos.y,\n                damage: damage,\n                currentHealth: barrel.currentHealth\n            });\n        }\n\n        // Flash effect\n        const originalColor = barrel.color;\n        barrel.color = k.rgb(255, 255, 255);\n        k.wait(0.05, () => {\n            if (barrel.exists()) {\n                barrel.updateHealthBar(); // Restore color based on health\n            }\n        });\n\n        // Check for destruction\n        if (barrel.currentHealth <= 0) {\n            barrel.explode(sourceId);\n        }\n    };\n\n    // Explode the barrel\n    barrel.explode = (sourceId = null) => {\n        if (barrel.isExploding || !barrel.exists()) return;\n        barrel.isExploding = true;\n\n        const explosionX = barrel.pos.x;\n        const explosionY = barrel.pos.y;\n\n        // Broadcast explosion in multiplayer\n        if (isMultiplayerActive() && isHost()) {\n            broadcast('barrel_explode', {\n                barrelId: barrel.barrelId,\n                x: explosionX,\n                y: explosionY,\n                radius: barrel.explosionRadius,\n                damage: barrel.explosionDamage\n            });\n        }\n\n        // Create explosion visual\n        createExplosionEffect(k, explosionX, explosionY, barrel.explosionRadius);\n\n        // Deal damage to entities in range\n        dealExplosionDamage(k, explosionX, explosionY, barrel.explosionRadius, barrel.explosionDamage, barrel.knockbackForce, sourceId);\n\n        // Trigger chain reactions after delay\n        k.wait(barrel.chainDelay, () => {\n            triggerChainReaction(k, explosionX, explosionY, barrel.explosionRadius, barrel.barrelId);\n        });\n\n        // Cleanup\n        if (healthBarBg.exists()) k.destroy(healthBarBg);\n        if (healthBarFill.exists()) k.destroy(healthBarFill);\n\n        // Remove from tracking\n        allBarrels = allBarrels.filter(b => b !== barrel);\n\n        k.destroy(barrel);\n    };\n\n    // Add to tracking array\n    allBarrels.push(barrel);\n\n    return barrel;\n}\n\n/**\n * Create explosion visual effect\n */\nfunction createExplosionEffect(k, x, y, radius) {\n    // Outer explosion ring\n    const outerRing = k.add([\n        k.circle(radius),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(255, 150, 50),\n        k.opacity(0.8),\n        k.scale(1),\n        k.z(100),\n        'explosionEffect'\n    ]);\n\n    // Inner explosion\n    const innerRing = k.add([\n        k.circle(radius * 0.6),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(255, 255, 150),\n        k.opacity(0.9),\n        k.scale(1),\n        k.z(101),\n        'explosionEffect'\n    ]);\n\n    // Core flash\n    const core = k.add([\n        k.text('*', { size: 40 }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(255, 255, 255),\n        k.opacity(1),\n        k.scale(1),\n        k.z(102),\n        'explosionEffect'\n    ]);\n\n    // Animate and fade out\n    k.tween(outerRing.scale, k.vec2(1.5, 1.5), 0.2, (val) => outerRing.scale = val);\n    k.tween(outerRing.opacity, 0, 0.3, (val) => outerRing.opacity = val, k.easings.easeOutQuad).onEnd(() => {\n        if (outerRing.exists()) k.destroy(outerRing);\n    });\n\n    k.tween(innerRing.scale, k.vec2(1.3, 1.3), 0.15, (val) => innerRing.scale = val);\n    k.tween(innerRing.opacity, 0, 0.25, (val) => innerRing.opacity = val, k.easings.easeOutQuad).onEnd(() => {\n        if (innerRing.exists()) k.destroy(innerRing);\n    });\n\n    k.tween(core.scale, k.vec2(2, 2), 0.1, (val) => core.scale = val);\n    k.tween(core.opacity, 0, 0.2, (val) => core.opacity = val).onEnd(() => {\n        if (core.exists()) k.destroy(core);\n    });\n\n    // Spawn debris particles\n    for (let i = 0; i < 8; i++) {\n        const angle = (Math.PI * 2 * i) / 8;\n        const speed = 100 + Math.random() * 100;\n\n        const debris = k.add([\n            k.text(['#', '*', '+', '~'][Math.floor(Math.random() * 4)], { size: 12 }),\n            k.pos(x, y),\n            k.anchor('center'),\n            k.color(255, 150 + Math.random() * 100, 50),\n            k.opacity(1),\n            k.z(99),\n            'explosionDebris'\n        ]);\n\n        const targetX = x + Math.cos(angle) * speed;\n        const targetY = y + Math.sin(angle) * speed;\n\n        k.tween(debris.pos, k.vec2(targetX, targetY), 0.4, (val) => debris.pos = val, k.easings.easeOutQuad);\n        k.tween(debris.opacity, 0, 0.4, (val) => debris.opacity = val).onEnd(() => {\n            if (debris.exists()) k.destroy(debris);\n        });\n    }\n}\n\n/**\n * Deal explosion damage to all entities in range\n */\nfunction dealExplosionDamage(k, x, y, radius, damage, knockbackForce, sourceId) {\n    // Damage enemies\n    k.get('enemy').forEach(enemy => {\n        if (!enemy.exists()) return;\n\n        const dist = k.vec2(enemy.pos.x - x, enemy.pos.y - y).len();\n        if (dist <= radius) {\n            // Damage falls off with distance\n            const falloff = 1 - (dist / radius) * 0.5;\n            const finalDamage = Math.floor(damage * falloff);\n\n            if (enemy.takeDamage) {\n                enemy.takeDamage(finalDamage);\n            } else if (enemy.hp) {\n                enemy.hurt(finalDamage);\n            }\n\n            // Apply knockback\n            if (dist > 0) {\n                const dir = k.vec2(enemy.pos.x - x, enemy.pos.y - y).unit();\n                const knockback = knockbackForce * falloff;\n                enemy.pos.x += dir.x * knockback * 0.1;\n                enemy.pos.y += dir.y * knockback * 0.1;\n            }\n        }\n    });\n\n    // Damage minibosses\n    k.get('miniboss').forEach(miniboss => {\n        if (!miniboss.exists()) return;\n\n        const dist = k.vec2(miniboss.pos.x - x, miniboss.pos.y - y).len();\n        if (dist <= radius) {\n            const falloff = 1 - (dist / radius) * 0.5;\n            const finalDamage = Math.floor(damage * falloff);\n\n            if (miniboss.takeDamage) {\n                miniboss.takeDamage(finalDamage, null);\n            }\n        }\n    });\n\n    // Damage bosses\n    k.get('boss').forEach(boss => {\n        if (!boss.exists()) return;\n\n        const dist = k.vec2(boss.pos.x - x, boss.pos.y - y).len();\n        if (dist <= radius) {\n            const falloff = 1 - (dist / radius) * 0.5;\n            const finalDamage = Math.floor(damage * falloff);\n\n            if (boss.takeDamage) {\n                boss.takeDamage(finalDamage, null);\n            }\n        }\n    });\n\n    // Damage players\n    k.get('player').forEach(player => {\n        if (!player.exists() || player.isDead) return;\n\n        const dist = k.vec2(player.pos.x - x, player.pos.y - y).len();\n        if (dist <= radius) {\n            const falloff = 1 - (dist / radius) * 0.5;\n            const finalDamage = Math.floor(damage * falloff * 0.5); // Players take half damage\n\n            // Check invulnerability\n            if (!player.invulnerable) {\n                player.hurt(finalDamage);\n\n                // Apply knockback\n                if (dist > 0) {\n                    const dir = k.vec2(player.pos.x - x, player.pos.y - y).unit();\n                    const knockback = knockbackForce * falloff;\n                    player.pos.x += dir.x * knockback * 0.05;\n                    player.pos.y += dir.y * knockback * 0.05;\n                }\n            }\n        }\n    });\n}\n\n/**\n * Trigger chain reaction with nearby barrels\n */\nfunction triggerChainReaction(k, x, y, radius, sourceBarrelId) {\n    // Find barrels in range (slightly larger than explosion for chain feel)\n    const chainRadius = radius * 1.2;\n\n    allBarrels.forEach(barrel => {\n        if (!barrel.exists() || barrel.isExploding || barrel.barrelId === sourceBarrelId) return;\n\n        const dist = k.vec2(barrel.pos.x - x, barrel.pos.y - y).len();\n        if (dist <= chainRadius) {\n            // Damage the barrel, potentially causing it to explode\n            barrel.takeDamage(barrel.maxHealth, sourceBarrelId); // Instant kill for chain\n        }\n    });\n}\n\n/**\n * Get all active barrels\n */\nexport function getAllBarrels() {\n    return allBarrels.filter(b => b.exists());\n}\n\n/**\n * Find a barrel by position (for multiplayer sync)\n * Uses position matching since IDs may differ between host/client\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {number} tolerance - Position tolerance (default 5)\n * @returns {object|null} - Barrel entity or null\n */\nexport function findBarrelByPosition(x, y, tolerance = 5) {\n    return allBarrels.find(barrel => {\n        if (!barrel.exists() || barrel.isExploding) return false;\n        const dx = Math.abs(barrel.pos.x - x);\n        const dy = Math.abs(barrel.pos.y - y);\n        return dx <= tolerance && dy <= tolerance;\n    }) || null;\n}\n\n/**\n * Clear all barrels (for room transitions)\n */\nexport function clearAllBarrels() {\n    allBarrels.forEach(barrel => {\n        if (barrel.exists()) {\n            if (barrel.healthBarBg && barrel.healthBarBg.exists()) {\n                barrel.healthBarBg.destroy();\n            }\n            if (barrel.healthBarFill && barrel.healthBarFill.exists()) {\n                barrel.healthBarFill.destroy();\n            }\n            barrel.destroy();\n        }\n    });\n    allBarrels = [];\n}\n\n/**\n * Handle barrel collision with projectiles\n * Call this from the combat system\n */\nexport function handleProjectileBarrelCollision(k, projectile, barrel) {\n    if (!barrel.exists() || barrel.isExploding) return;\n\n    barrel.takeDamage(1);\n\n    // Destroy the projectile unless it pierces\n    if (!projectile.piercing || projectile.piercing <= 0) {\n        if (projectile.exists()) k.destroy(projectile);\n    }\n}\n\nexport { BARREL_CONFIG };\n","/**\n * Spatial Grid System\n *\n * Divides the game world into a grid of cells to efficiently query nearby entities.\n * Instead of checking all entities (O(n)), we only check entities in nearby cells.\n *\n * Performance improvement:\n * - Without grid: Check all N entities = O(n)\n * - With grid: Check only entities in nearby cells = O(1) average case\n *\n * Example:\n * - 100 entities spread across 10x10 grid = ~1 entity per cell\n * - Query nearby entities: Check 9 cells (3x3) = ~9 entities instead of 100\n * - 11x speedup!\n */\n\nexport class SpatialGrid {\n    /**\n     * Create a spatial grid\n     * @param {number} cellSize - Size of each grid cell in pixels (default: 128)\n     */\n    constructor(cellSize = 128) {\n        this.cellSize = cellSize;\n        this.cells = new Map(); // Map of \"x,y\" -> Set of entities\n        this.entityToCell = new Map(); // Map of entity -> \"x,y\" for fast removal\n    }\n\n    /**\n     * Get the cell key for a position\n     * @param {number} x - X coordinate\n     * @param {number} y - Y coordinate\n     * @returns {string} Cell key \"x,y\"\n     */\n    getCellKey(x, y) {\n        const cellX = Math.floor(x / this.cellSize);\n        const cellY = Math.floor(y / this.cellSize);\n        return `${cellX},${cellY}`;\n    }\n\n    /**\n     * Insert an entity into the grid\n     * @param {Object} entity - Entity with pos.x and pos.y\n     */\n    insert(entity) {\n        if (!entity || !entity.pos) return;\n\n        const key = this.getCellKey(entity.pos.x, entity.pos.y);\n\n        // Create cell if it doesn't exist\n        if (!this.cells.has(key)) {\n            this.cells.set(key, new Set());\n        }\n\n        // Add entity to cell\n        this.cells.get(key).add(entity);\n\n        // Track which cell this entity is in\n        this.entityToCell.set(entity, key);\n    }\n\n    /**\n     * Remove an entity from the grid\n     * @param {Object} entity - Entity to remove\n     */\n    remove(entity) {\n        if (!entity) return;\n\n        const key = this.entityToCell.get(entity);\n        if (!key) return;\n\n        // Remove from cell\n        const cell = this.cells.get(key);\n        if (cell) {\n            cell.delete(entity);\n            // Clean up empty cells to save memory\n            if (cell.size === 0) {\n                this.cells.delete(key);\n            }\n        }\n\n        // Remove tracking\n        this.entityToCell.delete(entity);\n    }\n\n    /**\n     * Update an entity's position in the grid\n     * Call this when an entity moves\n     * @param {Object} entity - Entity that moved\n     */\n    update(entity) {\n        if (!entity || !entity.pos) return;\n\n        const oldKey = this.entityToCell.get(entity);\n        const newKey = this.getCellKey(entity.pos.x, entity.pos.y);\n\n        // Only update if entity changed cells\n        if (oldKey !== newKey) {\n            this.remove(entity);\n            this.insert(entity);\n        }\n    }\n\n    /**\n     * Get all entities within a radius of a point\n     * @param {number} x - Center X coordinate\n     * @param {number} y - Center Y coordinate\n     * @param {number} radius - Search radius\n     * @returns {Array} Array of entities within radius\n     */\n    getNearby(x, y, radius) {\n        const results = [];\n\n        // Calculate which cells to check\n        const cellRadius = Math.ceil(radius / this.cellSize);\n        const centerKey = this.getCellKey(x, y);\n        const [cx, cy] = centerKey.split(',').map(Number);\n\n        // Check this cell and all surrounding cells within radius\n        for (let dx = -cellRadius; dx <= cellRadius; dx++) {\n            for (let dy = -cellRadius; dy <= cellRadius; dy++) {\n                const key = `${cx + dx},${cy + dy}`;\n                const cell = this.cells.get(key);\n\n                if (cell) {\n                    // Add all entities from this cell\n                    results.push(...cell);\n                }\n            }\n        }\n\n        return results;\n    }\n\n    /**\n     * Get all entities in a bounding box\n     * @param {number} minX - Minimum X coordinate\n     * @param {number} minY - Minimum Y coordinate\n     * @param {number} maxX - Maximum X coordinate\n     * @param {number} maxY - Maximum Y coordinate\n     * @returns {Array} Array of entities in bounding box\n     */\n    getInBounds(minX, minY, maxX, maxY) {\n        const results = [];\n\n        // Calculate cell range\n        const minCellX = Math.floor(minX / this.cellSize);\n        const minCellY = Math.floor(minY / this.cellSize);\n        const maxCellX = Math.floor(maxX / this.cellSize);\n        const maxCellY = Math.floor(maxY / this.cellSize);\n\n        // Check all cells in range\n        for (let cx = minCellX; cx <= maxCellX; cx++) {\n            for (let cy = minCellY; cy <= maxCellY; cy++) {\n                const key = `${cx},${cy}`;\n                const cell = this.cells.get(key);\n\n                if (cell) {\n                    results.push(...cell);\n                }\n            }\n        }\n\n        return results;\n    }\n\n    /**\n     * Get all entities at a specific position (same cell)\n     * @param {number} x - X coordinate\n     * @param {number} y - Y coordinate\n     * @returns {Array} Array of entities in the same cell\n     */\n    getAt(x, y) {\n        const key = this.getCellKey(x, y);\n        const cell = this.cells.get(key);\n        return cell ? [...cell] : [];\n    }\n\n    /**\n     * Clear all entities from the grid\n     */\n    clear() {\n        this.cells.clear();\n        this.entityToCell.clear();\n    }\n\n    /**\n     * Get statistics about the grid (for debugging)\n     * @returns {Object} Grid statistics\n     */\n    getStats() {\n        let totalEntities = 0;\n        let maxEntitiesInCell = 0;\n        let minEntitiesInCell = Infinity;\n\n        this.cells.forEach(cell => {\n            const count = cell.size;\n            totalEntities += count;\n            maxEntitiesInCell = Math.max(maxEntitiesInCell, count);\n            minEntitiesInCell = Math.min(minEntitiesInCell, count);\n        });\n\n        return {\n            cellCount: this.cells.size,\n            totalEntities,\n            averageEntitiesPerCell: this.cells.size > 0 ? (totalEntities / this.cells.size).toFixed(2) : 0,\n            maxEntitiesInCell,\n            minEntitiesInCell: minEntitiesInCell === Infinity ? 0 : minEntitiesInCell,\n            cellSize: this.cellSize\n        };\n    }\n}\n\n/**\n * Helper function to rebuild a spatial grid from entity array\n * @param {SpatialGrid} grid - Grid to rebuild\n * @param {Array} entities - Array of entities to insert\n */\nexport function rebuildGrid(grid, entities) {\n    grid.clear();\n    entities.forEach(entity => grid.insert(entity));\n}\n","/**\n * Programmatic Bit Sound System\n * Generates retro-style sounds using Web Audio API\n */\n\n// Audio context singleton\nlet audioContext = null;\n\n// Master volume control\nlet masterVolume = 1.0;\n\n// Music volume control (separate from SFX)\nlet musicVolume = 1.0;\n\n// SFX volume control (separate from music)\nlet sfxVolume = 1.0;\n\n// Sound enabled flag\nlet soundEnabled = true;\n\n// UI sounds enabled (menu clicks, notifications)\nlet uiSoundsEnabled = true;\n\n// Combat sounds enabled (hit sounds, abilities)\nlet combatSoundsEnabled = true;\n\n// Music playback state\nlet currentMusic = null;\nlet currentMusicTrack = null;\nlet musicEnabled = true;\n\n// Music file paths (relative to public folder)\nconst MUSIC_TRACKS = {\n    menu: './audio/menu-theme.mp3',\n    combat: './audio/combat-theme.mp3',\n    defeat: './audio/defeat-theme.mp3'\n};\n\n// Preloaded audio buffers\nconst musicCache = {};\n\n/**\n * Initialize audio context (must be called after user interaction)\n */\nexport function initAudio() {\n  if (!audioContext) {\n    audioContext = new (window.AudioContext || window.webkitAudioContext)();\n  }\n  return audioContext;\n}\n\n/**\n * Resume audio context if suspended (required for browser autoplay policy)\n * Call this on first user interaction to enable audio\n */\nexport function resumeAudioContext() {\n  if (audioContext && audioContext.state === 'suspended') {\n    audioContext.resume().then(() => {\n      console.log('[Audio] AudioContext resumed');\n    }).catch(err => {\n      console.warn('[Audio] Failed to resume AudioContext:', err);\n    });\n  }\n}\n\n/**\n * Get or create audio context\n */\nfunction getAudioContext() {\n  if (!audioContext) {\n    initAudio();\n  }\n  // Auto-resume if suspended\n  if (audioContext && audioContext.state === 'suspended') {\n    audioContext.resume();\n  }\n  return audioContext;\n}\n\n/**\n * Set master volume (0.0 to 1.0)\n */\nexport function setMasterVolume(volume) {\n  masterVolume = Math.max(0, Math.min(1, volume));\n  // Update music volume to reflect master change\n  if (currentMusic) {\n    currentMusic.volume = musicVolume * masterVolume;\n  }\n}\n\n/**\n * Get master volume\n */\nexport function getMasterVolume() {\n  return masterVolume;\n}\n\n/**\n * Set SFX volume (0.0 to 1.0)\n */\nexport function setSfxVolume(volume) {\n  sfxVolume = Math.max(0, Math.min(1, volume));\n}\n\n/**\n * Get SFX volume\n */\nexport function getSfxVolume() {\n  return sfxVolume;\n}\n\n/**\n * Enable or disable UI sounds\n */\nexport function setUiSoundsEnabled(enabled) {\n  uiSoundsEnabled = enabled;\n}\n\n/**\n * Enable or disable combat sounds\n */\nexport function setCombatSoundsEnabled(enabled) {\n  combatSoundsEnabled = enabled;\n}\n\n/**\n * Enable or disable sounds\n */\nexport function setSoundEnabled(enabled) {\n  soundEnabled = enabled;\n}\n\n/**\n * Play a simple tone\n * @param {number} frequency - Frequency in Hz\n * @param {number} duration - Duration in seconds\n * @param {string} type - Oscillator type ('sine', 'square', 'sawtooth', 'triangle')\n * @param {number} volume - Volume (0.0 to 1.0)\n * @param {object} options - Additional options (attack, decay, pitchBend, isUI, etc.)\n */\nfunction playTone(frequency, duration, type = 'square', volume = 0.3, options = {}) {\n  if (!soundEnabled) return;\n\n  // Check if this is a UI sound or combat sound and if those are disabled\n  if (options.isUI && !uiSoundsEnabled) return;\n  if (options.isCombat && !combatSoundsEnabled) return;\n\n  const ctx = getAudioContext();\n  const now = ctx.currentTime;\n\n  // Create oscillator\n  const osc = ctx.createOscillator();\n  osc.type = type;\n  osc.frequency.setValueAtTime(frequency, now);\n\n  // Pitch bend if specified\n  if (options.pitchBend) {\n    osc.frequency.exponentialRampToValueAtTime(\n      frequency * options.pitchBend,\n      now + duration\n    );\n  }\n\n  // Create gain node for volume envelope\n  const gainNode = ctx.createGain();\n  // Apply all volume multipliers: base volume * sfx volume * master volume\n  const finalVolume = volume * sfxVolume * masterVolume;\n\n  // Attack\n  const attack = options.attack || 0.01;\n  gainNode.gain.setValueAtTime(0, now);\n  gainNode.gain.linearRampToValueAtTime(finalVolume, now + attack);\n\n  // Decay/Release\n  const decay = options.decay || 0.1;\n  gainNode.gain.setValueAtTime(finalVolume, now + duration - decay);\n  gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);\n\n  // Connect nodes\n  osc.connect(gainNode);\n  gainNode.connect(ctx.destination);\n\n  // Start and stop\n  osc.start(now);\n  osc.stop(now + duration);\n}\n\n/**\n * Play white noise burst\n * @param {number} duration - Duration in seconds\n * @param {number} volume - Volume (0.0 to 1.0)\n * @param {object} options - Additional options\n */\nfunction playNoise(duration, volume = 0.3, options = {}) {\n  if (!soundEnabled) return;\n\n  // Check if this is a combat sound and if those are disabled\n  if (options.isCombat && !combatSoundsEnabled) return;\n\n  const ctx = getAudioContext();\n  const now = ctx.currentTime;\n\n  // Create buffer with white noise\n  const bufferSize = ctx.sampleRate * duration;\n  const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n\n  for (let i = 0; i < bufferSize; i++) {\n    data[i] = Math.random() * 2 - 1;\n  }\n\n  // Create source\n  const source = ctx.createBufferSource();\n  source.buffer = buffer;\n\n  // Create filter for colored noise\n  const filter = ctx.createBiquadFilter();\n  filter.type = options.filterType || 'lowpass';\n  filter.frequency.setValueAtTime(options.filterFreq || 2000, now);\n\n  // Create gain node\n  const gainNode = ctx.createGain();\n  // Apply all volume multipliers: base volume * sfx volume * master volume\n  const finalVolume = volume * sfxVolume * masterVolume;\n\n  const attack = options.attack || 0.01;\n  const decay = options.decay || 0.1;\n\n  gainNode.gain.setValueAtTime(0, now);\n  gainNode.gain.linearRampToValueAtTime(finalVolume, now + attack);\n  gainNode.gain.setValueAtTime(finalVolume, now + duration - decay);\n  gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);\n\n  // Connect nodes\n  source.connect(filter);\n  filter.connect(gainNode);\n  gainNode.connect(ctx.destination);\n\n  source.start(now);\n  source.stop(now + duration);\n}\n\n/**\n * Random variation helper\n */\nfunction vary(value, amount = 0.1) {\n  return value * (1 + (Math.random() - 0.5) * amount);\n}\n\n/**\n * Random choice helper\n */\nfunction choice(array) {\n  return array[Math.floor(Math.random() * array.length)];\n}\n\n// ==================== WEAPON FIRING SOUNDS ====================\n\n/**\n * Pistol fire sound\n */\nexport function playPistolFire() {\n  const variation = Math.random();\n\n  if (variation < 0.33) {\n    // Smooth pop with triangle wave\n    playTone(vary(280, 0.15), 0.08, 'triangle', 0.14, {\n      attack: 0.002,\n      decay: 0.05,\n      pitchBend: 0.65\n    });\n  } else if (variation < 0.66) {\n    // Softer shot with sine wave\n    playTone(vary(320, 0.15), 0.09, 'sine', 0.13, {\n      attack: 0.003,\n      decay: 0.06,\n      pitchBend: 0.7\n    });\n  } else {\n    // Crisp but pleasant with triangle\n    playTone(vary(300, 0.15), 0.07, 'triangle', 0.14, {\n      attack: 0.002,\n      decay: 0.04,\n      pitchBend: 0.6\n    });\n  }\n}\n\n/**\n * SMG fire sound (rapid, lighter)\n */\nexport function playSMGFire() {\n  const variation = Math.random();\n\n  if (variation < 0.33) {\n    playTone(vary(220, 0.3), 0.04, 'triangle', 0.08, {\n      attack: 0.001,\n      decay: 0.025,\n      pitchBend: 0.5\n    });\n  } else if (variation < 0.66) {\n    playTone(vary(240, 0.3), 0.035, 'sine', 0.09, {\n      attack: 0.001,\n      decay: 0.02,\n      pitchBend: 0.6\n    });\n  } else {\n    playTone(vary(200, 0.3), 0.045, 'triangle', 0.08, {\n      attack: 0.001,\n      decay: 0.03,\n      pitchBend: 0.4\n    });\n  }\n}\n\n/**\n * Shotgun fire sound (deep boom with noise)\n */\nexport function playShotgunFire() {\n  // Soft thump - much more pleasant\n  const freq = vary(60, 0.15);\n  playTone(freq, 0.1, 'sine', 0.12, {\n    attack: 0.002,\n    decay: 0.08,\n    pitchBend: 0.4\n  });\n\n  // Gentle noise - reduced volume and filtered lower\n  playNoise(vary(0.04, 0.2), vary(0.12, 0.2), {\n    attack: 0.002,\n    decay: 0.06,\n    filterType: 'lowpass',\n    filterFreq: vary(800, 0.3)\n  });\n}\n\n/**\n * Sniper fire sound (sharp, high-impact)\n */\nexport function playSniperFire() {\n  // Clean crack with triangle wave\n  playTone(vary(350, 0.2), 0.05, 'triangle', 0.12, {\n    attack: 0.001,\n    decay: 0.03,\n    pitchBend: 0.3\n  });\n\n  // Low frequency thump\n  playTone(vary(50, 0.15), 0.1, 'sine', 0.1, {\n    attack: 0.001,\n    decay: 0.07,\n    pitchBend: 0.5\n  });\n}\n\n/**\n * Flamethrower sound (continuous crackle - call repeatedly)\n */\nexport function playFlamethrowerFire() {\n  playNoise(0.08, vary(0.15, 0.4), {\n    attack: 0.005,\n    decay: 0.04,\n    filterType: 'bandpass',\n    filterFreq: vary(800, 0.5)\n  });\n}\n\n/**\n * Explosive launcher sound\n */\nexport function playExplosiveFire() {\n  // Deep thump - softer\n  playTone(vary(55, 0.2), 0.15, 'sine', 0.1, {\n    attack: 0.002,\n    decay: 0.12,\n    pitchBend: 0.4\n  });\n\n  // Mid-range whomp - triangle for smoothness\n  playTone(vary(100, 0.2), 0.12, 'triangle', 0.08, {\n    attack: 0.005,\n    decay: 0.08,\n    pitchBend: 0.5\n  });\n}\n\n/**\n * Chain lightning sound\n */\nexport function playChainLightningFire() {\n  // Electric zap - ascending pitch, softer\n  playTone(vary(250, 0.3), 0.08, 'triangle', 0.1, {\n    attack: 0.001,\n    decay: 0.06,\n    pitchBend: 1.6\n  });\n\n  // Subtle crackle - much quieter\n  playNoise(vary(0.03, 0.3), 0.08, {\n    attack: 0.001,\n    decay: 0.04,\n    filterType: 'bandpass',\n    filterFreq: vary(2000, 0.4)\n  });\n}\n\n/**\n * Orbital weapon sound (whoosh)\n */\nexport function playOrbitalFire() {\n  playTone(vary(180, 0.4), 0.1, 'triangle', 0.14, {\n    attack: 0.02,\n    decay: 0.06,\n    pitchBend: 1.3\n  });\n}\n\n/**\n * Generic weapon fire (fallback)\n */\nexport function playGenericFire() {\n  playPistolFire();\n}\n\n// ==================== IMPACT SOUNDS ====================\n\n/**\n * Enemy hit sound - soft pop/thump\n */\nexport function playEnemyHit() {\n  const variation = Math.random();\n\n  if (variation < 0.25) {\n    // Soft pop 1\n    playTone(vary(280, 0.2), 0.06, 'sine', 0.12, {\n      attack: 0.002,\n      decay: 0.04,\n      pitchBend: 0.2\n    });\n  } else if (variation < 0.5) {\n    // Soft pop 2\n    playTone(vary(320, 0.2), 0.05, 'triangle', 0.12, {\n      attack: 0.002,\n      decay: 0.035,\n      pitchBend: 0.15\n    });\n  } else if (variation < 0.75) {\n    // Soft thump 1\n    playTone(vary(240, 0.2), 0.07, 'sine', 0.14, {\n      attack: 0.003,\n      decay: 0.05,\n      pitchBend: 0.25\n    });\n  } else {\n    // Soft thump 2\n    playTone(vary(360, 0.2), 0.05, 'triangle', 0.10, {\n      attack: 0.002,\n      decay: 0.03,\n      pitchBend: 0.1\n    });\n  }\n}\n\n/**\n * Player damage sound - softer but noticeable\n */\nexport function playPlayerHit() {\n  const variation = Math.random();\n\n  if (variation < 0.33) {\n    // Soft impact 1\n    playTone(vary(180, 0.2), 0.10, 'triangle', 0.18, {\n      attack: 0.003,\n      decay: 0.07,\n      pitchBend: 0.2\n    });\n    playTone(vary(400, 0.2), 0.06, 'sine', 0.10, {\n      attack: 0.005,\n      decay: 0.04,\n      pitchBend: 0.1\n    });\n  } else if (variation < 0.66) {\n    // Soft impact 2\n    playTone(vary(160, 0.2), 0.12, 'triangle', 0.18, {\n      attack: 0.003,\n      decay: 0.08,\n      pitchBend: 0.25\n    });\n    playTone(vary(320, 0.2), 0.07, 'sine', 0.12, {\n      attack: 0.005,\n      decay: 0.05,\n      pitchBend: 0.15\n    });\n  } else {\n    // Soft impact 3\n    playTone(vary(200, 0.2), 0.11, 'triangle', 0.18, {\n      attack: 0.003,\n      decay: 0.08,\n      pitchBend: 0.3\n    });\n    playTone(vary(440, 0.2), 0.05, 'sine', 0.08, {\n      attack: 0.005,\n      decay: 0.03,\n      pitchBend: 0.1\n    });\n  }\n}\n\n/**\n * Enemy death sound\n */\nexport function playEnemyDeath() {\n  const variation = Math.random();\n\n  if (variation < 0.33) {\n    // Descending death 1\n    playTone(vary(200, 0.2), 0.25, 'sawtooth', 0.2, {\n      attack: 0.01,\n      decay: 0.2,\n      pitchBend: 0.2\n    });\n  } else if (variation < 0.66) {\n    // Descending death 2\n    playTone(vary(180, 0.2), 0.3, 'square', 0.2, {\n      attack: 0.01,\n      decay: 0.25,\n      pitchBend: 0.15\n    });\n    playNoise(0.15, 0.12, {\n      attack: 0.05,\n      decay: 0.1,\n      filterFreq: vary(1500, 0.4)\n    });\n  } else {\n    // Descending death 3\n    playTone(vary(220, 0.2), 0.28, 'triangle', 0.2, {\n      attack: 0.01,\n      decay: 0.23,\n      pitchBend: 0.25\n    });\n  }\n}\n\n/**\n * Explosion sound\n */\nexport function playExplosion() {\n  const variation = Math.random();\n\n  // Deep bass boom\n  playTone(vary(50, 0.15), 0.3, 'sawtooth', 0.3, {\n    attack: 0.001,\n    decay: 0.25,\n    pitchBend: 0.3\n  });\n\n  // Mid-range explosion\n  playTone(vary(100, 0.2), 0.25, 'square', 0.25, {\n    attack: 0.005,\n    decay: 0.2,\n    pitchBend: 0.4\n  });\n\n  // Noise burst\n  playNoise(vary(0.3, 0.2), vary(0.25, 0.3), {\n    attack: 0.001,\n    decay: 0.25,\n    filterType: 'lowpass',\n    filterFreq: vary(1200, 0.5)\n  });\n}\n\n// ==================== UI & GAME EVENT SOUNDS ====================\n\n/**\n * XP pickup sound\n */\nexport function playXPPickup() {\n  const variation = Math.random();\n\n  if (variation < 0.33) {\n    playTone(vary(600, 0.2), 0.08, 'sine', 0.15, {\n      attack: 0.01,\n      decay: 0.05,\n      pitchBend: 1.2\n    });\n  } else if (variation < 0.66) {\n    playTone(vary(650, 0.2), 0.09, 'triangle', 0.15, {\n      attack: 0.01,\n      decay: 0.06,\n      pitchBend: 1.3\n    });\n  } else {\n    playTone(vary(550, 0.2), 0.1, 'sine', 0.15, {\n      attack: 0.01,\n      decay: 0.07,\n      pitchBend: 1.15\n    });\n  }\n}\n\n/**\n * Currency/cash pickup sound\n */\nexport function playCurrencyPickup() {\n  const variation = Math.random();\n\n  if (variation < 0.33) {\n    // Bright coin \"ching\" - two quick tones\n    playTone(vary(800, 0.2), 0.06, 'sine', 0.16, {\n      attack: 0.005,\n      decay: 0.04\n    });\n    setTimeout(() => {\n      playTone(vary(1000, 0.2), 0.05, 'triangle', 0.14, {\n        attack: 0.005,\n        decay: 0.03\n      });\n    }, 30);\n  } else if (variation < 0.66) {\n    // Metallic ping\n    playTone(vary(900, 0.2), 0.08, 'triangle', 0.16, {\n      attack: 0.005,\n      decay: 0.05,\n      pitchBend: 0.85\n    });\n    playTone(vary(1200, 0.2), 0.06, 'sine', 0.12, {\n      attack: 0.01,\n      decay: 0.04\n    });\n  } else {\n    // Cash register \"ka-ching\"\n    playTone(vary(750, 0.2), 0.05, 'square', 0.14, {\n      attack: 0.005,\n      decay: 0.03\n    });\n    setTimeout(() => {\n      playTone(vary(1100, 0.2), 0.07, 'sine', 0.16, {\n        attack: 0.005,\n        decay: 0.05\n      });\n    }, 40);\n  }\n}\n\n/**\n * Level up sound\n */\nexport function playLevelUp() {\n  const ctx = getAudioContext();\n  const now = ctx.currentTime;\n\n  // Ascending arpeggio\n  const baseFreq = 400;\n  const notes = [1, 1.25, 1.5, 2];\n\n  notes.forEach((mult, i) => {\n    setTimeout(() => {\n      playTone(baseFreq * mult, 0.15, 'square', 0.2, {\n        attack: 0.01,\n        decay: 0.1\n      });\n    }, i * 80);\n  });\n}\n\n/**\n * Door open/room transition sound\n */\nexport function playDoorOpen() {\n  const variation = Math.random();\n\n  // Ascending sweep\n  playTone(vary(200, 0.2), 0.25, 'sawtooth', 0.18, {\n    attack: 0.02,\n    decay: 0.15,\n    pitchBend: 1.6\n  });\n}\n\n/**\n * Menu select sound\n */\nexport function playMenuSelect() {\n  playTone(vary(500, 0.15), 0.08, 'square', 0.15, {\n    attack: 0.01,\n    decay: 0.05\n  });\n}\n\n/**\n * Menu navigation sound\n */\nexport function playMenuNav() {\n  playTone(vary(400, 0.15), 0.06, 'triangle', 0.12, {\n    attack: 0.01,\n    decay: 0.04\n  });\n}\n\n/**\n * Upgrade select sound\n */\nexport function playUpgradeSelect() {\n  // Two-tone chord\n  playTone(vary(500, 0.1), 0.2, 'square', 0.18, {\n    attack: 0.01,\n    decay: 0.15\n  });\n\n  setTimeout(() => {\n    playTone(vary(750, 0.1), 0.18, 'square', 0.15, {\n      attack: 0.01,\n      decay: 0.13\n    });\n  }, 50);\n}\n\n/**\n * Boss spawn sound\n */\nexport function playBossSpawn() {\n  // Deep ominous tone\n  playTone(vary(50, 0.1), 0.5, 'sawtooth', 0.25, {\n    attack: 0.05,\n    decay: 0.4,\n    pitchBend: 0.8\n  });\n\n  // High warning tone\n  setTimeout(() => {\n    playTone(vary(800, 0.2), 0.3, 'square', 0.2, {\n      attack: 0.01,\n      decay: 0.25\n    });\n  }, 100);\n}\n\n/**\n * Boss death sound\n */\nexport function playBossDeath() {\n  // Epic descending cascade\n  const baseFreq = 400;\n  for (let i = 0; i < 8; i++) {\n    setTimeout(() => {\n      playTone(baseFreq * (1 - i * 0.1), 0.15, 'sawtooth', 0.2, {\n        attack: 0.01,\n        decay: 0.1\n      });\n    }, i * 60);\n  }\n\n  // Final explosion\n  setTimeout(() => {\n    playExplosion();\n  }, 480);\n}\n\n/**\n * Achievement unlocked sound\n */\nexport function playAchievement() {\n  // Triumphant fanfare\n  const notes = [400, 500, 600, 800];\n  notes.forEach((freq, i) => {\n    setTimeout(() => {\n      playTone(freq, 0.2, 'square', 0.18, {\n        attack: 0.01,\n        decay: 0.15\n      });\n    }, i * 100);\n  });\n}\n\n/**\n * Purchase success sound\n */\nexport function playPurchaseSuccess() {\n  // Positive ascending chime\n  playTone(vary(600, 0.1), 0.15, 'sine', 0.2, {\n    attack: 0.01,\n    decay: 0.1\n  });\n\n  setTimeout(() => {\n    playTone(vary(800, 0.1), 0.2, 'sine', 0.18, {\n      attack: 0.01,\n      decay: 0.15\n    });\n  }, 80);\n}\n\n/**\n * Purchase error / insufficient funds sound\n */\nexport function playPurchaseError() {\n  // Negative buzz\n  playTone(vary(150, 0.1), 0.2, 'sawtooth', 0.2, {\n    attack: 0.01,\n    decay: 0.15,\n    pitchBend: 0.7\n  });\n\n  playNoise(0.1, 0.15, {\n    attack: 0.01,\n    decay: 0.08,\n    filterType: 'lowpass',\n    filterFreq: vary(500, 0.3)\n  });\n}\n\n/**\n * Pause sound\n */\nexport function playPause() {\n  playTone(vary(400, 0.1), 0.08, 'square', 0.15, {\n    attack: 0.01,\n    decay: 0.05,\n    pitchBend: 0.8\n  });\n}\n\n/**\n * Unpause sound\n */\nexport function playUnpause() {\n  playTone(vary(400, 0.1), 0.08, 'square', 0.15, {\n    attack: 0.01,\n    decay: 0.05,\n    pitchBend: 1.2\n  });\n}\n\n// ==================== WEAPON TYPE MAPPING ====================\n\n/**\n * Play weapon fire sound based on weapon type\n * @param {string} weaponType - The weapon type identifier\n */\nexport function playWeaponFire(weaponType) {\n  const weaponName = weaponType?.toLowerCase() || '';\n\n  if (weaponName.includes('pistol')) {\n    playPistolFire();\n  } else if (weaponName.includes('smg') || weaponName.includes('submachine')) {\n    playSMGFire();\n  } else if (weaponName.includes('shotgun')) {\n    playShotgunFire();\n  } else if (weaponName.includes('sniper') || weaponName.includes('rifle')) {\n    playSniperFire();\n  } else if (weaponName.includes('flame') || weaponName.includes('thrower')) {\n    playFlamethrowerFire();\n  } else if (weaponName.includes('explosive') || weaponName.includes('launcher') || weaponName.includes('rocket')) {\n    playExplosiveFire();\n  } else if (weaponName.includes('chain') || weaponName.includes('lightning')) {\n    playChainLightningFire();\n  } else if (weaponName.includes('orbital')) {\n    playOrbitalFire();\n  } else {\n    playGenericFire();\n  }\n}\n\n// Auto-initialize on first sound play attempt\nexport function ensureAudioContext() {\n  return getAudioContext();\n}\n\n// ==================== MUSIC PLAYBACK ====================\n\n/**\n * Set music volume (0.0 to 1.0)\n * @param {number} volume - Volume level\n */\nexport function setMusicVolume(volume) {\n    musicVolume = Math.max(0, Math.min(1, volume));\n    if (currentMusic) {\n        currentMusic.volume = musicVolume * masterVolume;\n    }\n}\n\n/**\n * Enable or disable music\n * @param {boolean} enabled\n */\nexport function setMusicEnabled(enabled) {\n    musicEnabled = enabled;\n    if (!enabled && currentMusic) {\n        stopMusic();\n    }\n}\n\n/**\n * Stop currently playing music\n */\nexport function stopMusic() {\n    if (currentMusic) {\n        currentMusic.pause();\n        currentMusic.currentTime = 0;\n        currentMusic = null;\n        currentMusicTrack = null;\n    }\n}\n\n/**\n * Play a music track\n * @param {string} trackName - 'menu' or 'combat'\n * @param {boolean} loop - Whether to loop the track\n */\nfunction playMusicTrack(trackName, loop = true) {\n    if (!musicEnabled) return;\n\n    // Don't restart if same track is already playing\n    if (currentMusicTrack === trackName && currentMusic && !currentMusic.paused) {\n        return;\n    }\n\n    // Stop current music\n    stopMusic();\n\n    const trackPath = MUSIC_TRACKS[trackName];\n    if (!trackPath) {\n        console.warn(`[Music] Unknown track: ${trackName}`);\n        return;\n    }\n\n    try {\n        // Use cached audio element or create new one\n        if (!musicCache[trackName]) {\n            musicCache[trackName] = new Audio(trackPath);\n        }\n\n        currentMusic = musicCache[trackName];\n        currentMusic.loop = loop;\n        currentMusic.volume = musicVolume * masterVolume;\n        currentMusicTrack = trackName;\n\n        // Play with error handling\n        const playPromise = currentMusic.play();\n        if (playPromise !== undefined) {\n            playPromise.catch(error => {\n                console.warn(`[Music] Playback failed for ${trackName}:`, error.message);\n            });\n        }\n    } catch (error) {\n        console.warn(`[Music] Failed to play ${trackName}:`, error.message);\n    }\n}\n\n/**\n * Play menu theme music\n */\nexport function playMenuMusic() {\n    playMusicTrack('menu');\n}\n\n/**\n * Play combat/gameplay theme music\n */\nexport function playCombatMusic() {\n    playMusicTrack('combat');\n}\n\n/**\n * Play defeat/game over theme music\n */\nexport function playDefeatMusic() {\n    playMusicTrack('defeat');\n}\n\n/**\n * Check if music is currently playing\n * @returns {boolean}\n */\nexport function isMusicPlaying() {\n    return currentMusic && !currentMusic.paused;\n}\n\n/**\n * Get current music track name\n * @returns {string|null}\n */\nexport function getCurrentMusicTrack() {\n    return currentMusicTrack;\n}\n","// Settings system - handles game settings and preferences\n\nconst SETTINGS_KEY = 'superSmashTexty_settings';\n\n// Default settings\nconst DEFAULT_SETTINGS = {\n    version: 1,\n    audio: {\n        masterVolume: 1.0, // 0.0 to 1.0\n        sfxVolume: 1.0,\n        musicVolume: 0.35, // 35% default for new players\n        uiSounds: true,\n        combatSounds: true\n    },\n    controls: {\n        // Key bindings (stored as key codes/names)\n        moveUp: 'w',\n        moveDown: 's',\n        moveLeft: 'a',\n        moveRight: 'd',\n        pause: 'escape',\n        interact: 'space'\n    },\n    visual: {\n        showParticles: true,\n        showScreenShake: true,\n        showHitFreeze: true,\n        showDamageNumbers: true,\n        compactHUD: false,\n        showFPS: false,\n        showTimer: true\n    },\n    gameplay: {\n        autoPause: false, // Auto-pause on level up\n        autoPickupCurrency: false,\n        autoPickupXP: false,\n        confirmBeforeQuit: true,\n        skipIntroAnimation: false\n    },\n    accessibility: {\n        colorblindMode: 'off', // 'off', 'deuteranopia', 'protanopia', 'tritanopia'\n        reducedMotion: false,\n        largeText: false,\n        highContrast: false\n    }\n};\n\n// Load settings from localStorage\nexport function loadSettings() {\n    try {\n        const saved = localStorage.getItem(SETTINGS_KEY);\n        if (saved) {\n            const data = JSON.parse(saved);\n            // Merge with defaults to handle missing fields\n            return mergeDeep(DEFAULT_SETTINGS, data);\n        }\n    } catch (e) {\n        console.error('Error loading settings:', e);\n    }\n    return { ...DEFAULT_SETTINGS };\n}\n\n// Deep merge helper\nfunction mergeDeep(target, source) {\n    const output = { ...target };\n    if (isObject(target) && isObject(source)) {\n        Object.keys(source).forEach(key => {\n            if (isObject(source[key])) {\n                if (!(key in target)) {\n                    Object.assign(output, { [key]: source[key] });\n                } else {\n                    output[key] = mergeDeep(target[key], source[key]);\n                }\n            } else {\n                Object.assign(output, { [key]: source[key] });\n            }\n        });\n    }\n    return output;\n}\n\nfunction isObject(item) {\n    return item && typeof item === 'object' && !Array.isArray(item);\n}\n\n// Save settings to localStorage\nexport function saveSettings(settings) {\n    try {\n        localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));\n        return true;\n    } catch (e) {\n        console.error('Error saving settings:', e);\n        return false;\n    }\n}\n\n// Get current settings\nexport function getSettings() {\n    return loadSettings();\n}\n\n// Update a specific setting\nexport function updateSetting(category, key, value) {\n    const settings = loadSettings();\n    if (!settings[category]) {\n        settings[category] = {};\n    }\n    settings[category][key] = value;\n    saveSettings(settings);\n    return settings;\n}\n\n// Get a specific setting value\nexport function getSetting(category, key) {\n    const settings = loadSettings();\n    return settings[category]?.[key] ?? DEFAULT_SETTINGS[category]?.[key];\n}\n\n// Reset settings to defaults\nexport function resetSettings() {\n    saveSettings({ ...DEFAULT_SETTINGS });\n    return { ...DEFAULT_SETTINGS };\n}\n\n\n\n","/**\n * Particle System\n *\n * Handles visual particle effects including:\n * - Blood splatters on damage\n * - Death explosions\n * - Hit impact effects\n * - Generic particle spawning\n * - Object pooling for performance\n */\n\nimport { getParticlePool } from './objectPool.js';\nimport { getSetting } from './settings.js';\n\n/**\n * Create a single particle (with optional pooling)\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {Object} options - Particle options\n * @returns {Object} - Particle game object\n */\nfunction createParticle(k, x, y, options = {}) {\n    // Try to use object pool for better performance\n    const pool = getParticlePool();\n    if (pool) {\n        return pool.acquire(x, y, options);\n    }\n\n    // Fall back to direct creation if pool not available\n    const {\n        char = '*',\n        size = 12,\n        color = [255, 255, 255],\n        velocity = { x: 0, y: 0 },\n        gravity = 0,\n        lifetime = 1.0,\n        fadeStart = 0.3,\n        friction = 0.95,\n        zIndex = 100\n    } = options;\n\n    const particle = k.add([\n        k.text(char, { size }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...color),\n        k.z(zIndex),\n        'particle'\n    ]);\n\n    // Particle physics properties\n    particle.velocity = { x: velocity.x, y: velocity.y };\n    particle.gravity = gravity;\n    particle.friction = friction;\n    particle.lifetime = lifetime;\n    particle.fadeStart = fadeStart;\n    particle.age = 0;\n    particle.initialOpacity = 1.0;\n\n    return particle;\n}\n\n/**\n * Release a particle back to the pool or destroy it\n * @param {Object} k - Kaplay instance\n * @param {Object} particle - The particle to release\n */\nfunction releaseParticle(k, particle) {\n    const pool = getParticlePool();\n    if (pool && particle._pooled) {\n        pool.release(particle);\n    } else {\n        k.destroy(particle);\n    }\n}\n\n/**\n * Update all particles (call this in onUpdate)\n * @param {Object} k - Kaplay instance\n */\nexport function updateParticles(k) {\n    const particles = k.get('particle');\n\n    particles.forEach(particle => {\n        if (!particle.exists()) return;\n        if (particle.hidden) return; // Skip pooled hidden particles\n\n        // Update age\n        particle.age += k.dt();\n\n        // Check if particle should be released/destroyed\n        if (particle.age >= particle.lifetime) {\n            releaseParticle(k, particle);\n            return;\n        }\n\n        // Apply velocity\n        particle.pos.x += particle.velocity.x * k.dt() * 60;\n        particle.pos.y += particle.velocity.y * k.dt() * 60;\n\n        // Apply gravity\n        particle.velocity.y += particle.gravity * k.dt() * 60;\n\n        // Apply friction\n        particle.velocity.x *= particle.friction;\n        particle.velocity.y *= particle.friction;\n\n        // Fade out based on lifetime\n        const lifetimePercent = particle.age / particle.lifetime;\n        if (lifetimePercent >= particle.fadeStart) {\n            const fadePercent = (lifetimePercent - particle.fadeStart) / (1 - particle.fadeStart);\n            particle.opacity = particle.initialOpacity * (1 - fadePercent);\n        }\n    });\n}\n\n/**\n * Check if particles are enabled in settings\n * @returns {boolean} - Whether particles should be shown\n */\nfunction areParticlesEnabled() {\n    // Disable particles if setting is off or reduced motion is enabled\n    if (getSetting('visual', 'showParticles') === false) return false;\n    if (getSetting('accessibility', 'reducedMotion')) return false;\n    return true;\n}\n\n/**\n * Spawn blood splatter particles\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {Object} options - Blood splatter options\n */\nexport function spawnBloodSplatter(k, x, y, options = {}) {\n    if (!areParticlesEnabled()) return;\n\n    const {\n        count = 8,\n        color = [255, 50, 50],\n        speed = 2,\n        isCrit = false\n    } = options;\n\n    const chars = ['.', ',', \"'\", '`', '*'];\n    const actualCount = isCrit ? count * 1.5 : count;\n    const actualSpeed = isCrit ? speed * 1.5 : speed;\n    const actualColor = isCrit ? [255, 200, 0] : color;\n\n    for (let i = 0; i < actualCount; i++) {\n        // Random direction\n        const angle = (Math.PI * 2 * i) / actualCount + (Math.random() - 0.5) * 0.5;\n        const speedMult = 0.5 + Math.random() * 0.5;\n        const velocity = {\n            x: Math.cos(angle) * actualSpeed * speedMult,\n            y: Math.sin(angle) * actualSpeed * speedMult\n        };\n\n        createParticle(k, x, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 8 + Math.random() * 6,\n            color: actualColor,\n            velocity,\n            gravity: 0.15,\n            lifetime: 0.5 + Math.random() * 0.3,\n            fadeStart: 0.4,\n            friction: 0.92\n        });\n    }\n}\n\n/**\n * Spawn death explosion particles\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {Object} options - Death explosion options\n */\nexport function spawnDeathExplosion(k, x, y, options = {}) {\n    if (!areParticlesEnabled()) return;\n\n    const {\n        count = 8,\n        color = [255, 100, 100],\n        speed = 2.5,\n        isBoss = false,\n        isMiniboss = false\n    } = options;\n\n    const chars = ['*', '+', ''];\n    const actualCount = isBoss ? count * 2 : (isMiniboss ? count * 1.5 : count);\n    const actualSpeed = isBoss ? speed * 1.5 : (isMiniboss ? speed * 1.2 : speed);\n\n    // Simple burst of particles\n    for (let i = 0; i < actualCount; i++) {\n        const angle = (Math.PI * 2 * i) / actualCount + (Math.random() - 0.5) * 0.3;\n        const speedMult = 0.6 + Math.random() * 0.4;\n        const velocity = {\n            x: Math.cos(angle) * actualSpeed * speedMult,\n            y: Math.sin(angle) * actualSpeed * speedMult\n        };\n\n        createParticle(k, x, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 10 + Math.random() * 6,\n            color,\n            velocity,\n            gravity: 0.1,\n            lifetime: 0.5 + Math.random() * 0.3,\n            fadeStart: 0.2,\n            friction: 0.92\n        });\n    }\n}\n\n/**\n * Spawn hit impact particles\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {Object} direction - Direction of impact {x, y}\n * @param {Object} options - Hit impact options\n */\nexport function spawnHitImpact(k, x, y, direction, options = {}) {\n    if (!areParticlesEnabled()) return;\n\n    const {\n        count = 5,\n        color = [255, 255, 100],\n        speed = 2.5,\n        isCrit = false\n    } = options;\n\n    const chars = ['', '', '', ''];\n    const actualCount = isCrit ? count * 2 : count;\n    const actualColor = isCrit ? [255, 200, 0] : color;\n\n    // Normalize direction\n    const dirLen = Math.sqrt(direction.x * direction.x + direction.y * direction.y);\n    const dirNorm = dirLen > 0 ? { x: direction.x / dirLen, y: direction.y / dirLen } : { x: 1, y: 0 };\n\n    for (let i = 0; i < actualCount; i++) {\n        // Spread particles in a cone from impact direction\n        const spreadAngle = (Math.random() - 0.5) * Math.PI * 0.6; // 108 degree cone\n        const angle = Math.atan2(dirNorm.y, dirNorm.x) + spreadAngle;\n        const speedMult = 0.6 + Math.random() * 0.8;\n\n        const velocity = {\n            x: Math.cos(angle) * speed * speedMult,\n            y: Math.sin(angle) * speed * speedMult\n        };\n\n        createParticle(k, x, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 10 + Math.random() * 4,\n            color: actualColor,\n            velocity,\n            gravity: 0.05,\n            lifetime: 0.3 + Math.random() * 0.2,\n            fadeStart: 0.3,\n            friction: 0.88,\n            zIndex: 150\n        });\n    }\n}\n\n/**\n * Spawn generic particle burst\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {Object} options - Particle burst options\n */\nexport function spawnParticleBurst(k, x, y, options = {}) {\n    if (!areParticlesEnabled()) return;\n\n    const {\n        count = 10,\n        char = '*',\n        color = [255, 255, 255],\n        speed = 2,\n        size = 12,\n        lifetime = 1.0,\n        gravity = 0.1,\n        friction = 0.95\n    } = options;\n\n    for (let i = 0; i < count; i++) {\n        const angle = (Math.PI * 2 * i) / count + (Math.random() - 0.5) * 0.3;\n        const speedMult = 0.5 + Math.random() * 0.5;\n        const velocity = {\n            x: Math.cos(angle) * speed * speedMult,\n            y: Math.sin(angle) * speed * speedMult\n        };\n\n        createParticle(k, x, y, {\n            char,\n            size: size + Math.random() * 4,\n            color,\n            velocity,\n            gravity,\n            lifetime: lifetime + (Math.random() - 0.5) * 0.2,\n            fadeStart: 0.4,\n            friction\n        });\n    }\n}\n\n/**\n * Spawn XP collection particles (sparkles)\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n */\nexport function spawnXPSparkles(k, x, y) {\n    if (!areParticlesEnabled()) return;\n\n    const chars = ['*', '+', ''];\n    const count = 5;\n\n    for (let i = 0; i < count; i++) {\n        const angle = (Math.PI * 2 * i) / count;\n        const velocity = {\n            x: Math.cos(angle) * 1.5,\n            y: Math.sin(angle) * 1.5 - 1 // Slight upward bias\n        };\n\n        createParticle(k, x, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 8 + Math.random() * 4,\n            color: [100, 255, 100],\n            velocity,\n            gravity: -0.05, // Float upward\n            lifetime: 0.6 + Math.random() * 0.3,\n            fadeStart: 0.3,\n            friction: 0.96,\n            zIndex: 200\n        });\n    }\n}\n\n/**\n * Spawn level up particles\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n */\nexport function spawnLevelUpEffect(k, x, y) {\n    if (!areParticlesEnabled()) return;\n\n    const chars = ['', '', '*', '+'];\n    const count = 20;\n\n    for (let i = 0; i < count; i++) {\n        const angle = (Math.PI * 2 * i) / count;\n        const velocity = {\n            x: Math.cos(angle) * 3,\n            y: Math.sin(angle) * 3 - 1\n        };\n\n        createParticle(k, x, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 14 + Math.random() * 6,\n            color: [255, 255, 100],\n            velocity,\n            gravity: -0.1, // Float upward\n            lifetime: 1.2 + Math.random() * 0.4,\n            fadeStart: 0.5,\n            friction: 0.97,\n            zIndex: 250\n        });\n    }\n}\n\n// ============================================\n// COSMETIC EFFECTS\n// ============================================\n\n/**\n * Spawn a trail particle behind the player\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {string} trailType - Trail type key (trailFire, trailIce, etc.)\n * @param {Array} color - RGB color array or 'rainbow'\n */\nexport function spawnTrailParticle(k, x, y, trailType, color) {\n    if (!areParticlesEnabled()) return;\n\n    const chars = {\n        trailFire: ['', '', '', ''],\n        trailIce: ['*', '', '', ''],\n        trailPoison: ['~', '', '', ''],\n        trailShadow: ['', '', '', ''],\n        trailRainbow: ['', '', '', '']\n    };\n\n    const trailChars = chars[trailType] || ['', '', '*'];\n    const char = trailChars[Math.floor(Math.random() * trailChars.length)];\n\n    // Handle rainbow color\n    let particleColor = color;\n    if (color === 'rainbow') {\n        const hue = (Date.now() * 0.1) % 360;\n        particleColor = hslToRgb(hue, 100, 60);\n    }\n\n    // Random slight offset\n    const offsetX = (Math.random() - 0.5) * 8;\n    const offsetY = (Math.random() - 0.5) * 8;\n\n    createParticle(k, x + offsetX, y + offsetY, {\n        char,\n        size: 10 + Math.random() * 6,\n        color: particleColor,\n        velocity: { x: (Math.random() - 0.5) * 0.3, y: (Math.random() - 0.5) * 0.3 },\n        gravity: trailType === 'trailFire' ? -0.02 : 0.01,\n        lifetime: 0.4 + Math.random() * 0.2,\n        fadeStart: 0.2,\n        friction: 0.98,\n        zIndex: -10\n    });\n}\n\n/**\n * Convert HSL to RGB (for rainbow effects)\n */\nfunction hslToRgb(h, s, l) {\n    s /= 100;\n    l /= 100;\n    const a = s * Math.min(l, 1 - l);\n    const f = n => {\n        const k = (n + h / 30) % 12;\n        return l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);\n    };\n    return [Math.round(f(0) * 255), Math.round(f(8) * 255), Math.round(f(4) * 255)];\n}\n\n/**\n * Create a glow entity around a target\n * @param {Object} k - Kaplay instance\n * @param {Object} target - Entity to glow around\n * @param {string} glowType - Glow type key (glowGold, glowCrimson, etc.)\n * @param {Array} color - RGB color array\n * @returns {Object} - Glow entity\n */\nexport function createGlowEffect(k, target, glowType, color) {\n    const glowEntity = k.add([\n        k.text('', { size: 48 }),\n        k.pos(target.pos.x, target.pos.y),\n        k.anchor('center'),\n        k.color(...color),\n        k.opacity(0.3),\n        k.z(-5),\n        'playerGlow'\n    ]);\n\n    // Store glow properties\n    glowEntity.target = target;\n    glowEntity.glowType = glowType;\n    glowEntity.pulseTime = 0;\n    glowEntity.baseOpacity = 0.25;\n\n    return glowEntity;\n}\n\n/**\n * Update glow effect (call in game loop)\n * @param {Object} k - Kaplay instance\n * @param {Object} glow - Glow entity\n */\nexport function updateGlowEffect(k, glow) {\n    if (!glow || !glow.exists() || !glow.target || !glow.target.exists()) {\n        if (glow && glow.exists()) k.destroy(glow);\n        return;\n    }\n\n    // Follow target\n    glow.pos = glow.target.pos.clone();\n\n    // Pulse effect\n    glow.pulseTime += k.dt() * 3;\n    const pulse = Math.sin(glow.pulseTime) * 0.1;\n    glow.opacity = glow.baseOpacity + pulse;\n\n    // Electric glow has a flicker\n    if (glow.glowType === 'glowElectric' && Math.random() < 0.05) {\n        glow.opacity = glow.baseOpacity + 0.3;\n    }\n}\n\n/**\n * Spawn cosmetic death effect\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {string} deathType - Death effect type\n * @param {Array} enemyColor - Enemy's color\n */\nexport function spawnCosmeticDeath(k, x, y, deathType, enemyColor = [255, 100, 100]) {\n    if (!areParticlesEnabled()) return;\n\n    switch (deathType) {\n        case 'deathExplosion':\n            spawnExplosiveDeath(k, x, y, enemyColor);\n            break;\n        case 'deathDisintegrate':\n            spawnDisintegrateDeath(k, x, y, enemyColor);\n            break;\n        case 'deathVaporize':\n            spawnVaporizeDeath(k, x, y, enemyColor);\n            break;\n        case 'deathPixelate':\n            spawnPixelateDeath(k, x, y, enemyColor);\n            break;\n        case 'deathFireworks':\n            spawnFireworksDeath(k, x, y, enemyColor);\n            break;\n        default:\n            // Standard death - use existing spawnDeathExplosion\n            spawnDeathExplosion(k, x, y, { color: enemyColor });\n    }\n}\n\n/**\n * Explosive death - large burst with bright flash\n */\nfunction spawnExplosiveDeath(k, x, y, color) {\n    const chars = ['*', '#', '@', 'X', '+', ''];\n    const count = 20;\n\n    // Bright flash in center\n    const flash = k.add([\n        k.text('', { size: 40 }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(255, 255, 200),\n        k.opacity(1),\n        k.z(200),\n        'particle'\n    ]);\n    flash.age = 0;\n    flash.lifetime = 0.2;\n    flash.fadeStart = 0;\n    flash.velocity = { x: 0, y: 0 };\n    flash.gravity = 0;\n    flash.friction = 1;\n\n    // Explosion ring\n    for (let i = 0; i < count; i++) {\n        const angle = (Math.PI * 2 * i) / count;\n        const speed = 4 + Math.random() * 2;\n        createParticle(k, x, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 14 + Math.random() * 10,\n            color: [255, 200, 100],\n            velocity: { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed },\n            gravity: 0.05,\n            lifetime: 0.6 + Math.random() * 0.3,\n            fadeStart: 0.2,\n            friction: 0.92\n        });\n    }\n\n    // Secondary debris\n    for (let i = 0; i < count / 2; i++) {\n        const angle = Math.random() * Math.PI * 2;\n        const speed = 2 + Math.random() * 2;\n        createParticle(k, x, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 10 + Math.random() * 6,\n            color,\n            velocity: { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed },\n            gravity: 0.1,\n            lifetime: 0.8 + Math.random() * 0.4,\n            fadeStart: 0.3,\n            friction: 0.94\n        });\n    }\n}\n\n/**\n * Disintegrate death - particles fall and scatter\n */\nfunction spawnDisintegrateDeath(k, x, y, color) {\n    const chars = ['', '', '', '', '', ''];\n    const count = 25;\n\n    for (let i = 0; i < count; i++) {\n        const offsetX = (Math.random() - 0.5) * 20;\n        const offsetY = (Math.random() - 0.5) * 20;\n        const angle = Math.random() * Math.PI * 2;\n        const speed = 0.5 + Math.random() * 1.5;\n\n        createParticle(k, x + offsetX, y + offsetY, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 8 + Math.random() * 8,\n            color: [color[0] * (0.6 + Math.random() * 0.4), color[1] * (0.6 + Math.random() * 0.4), color[2] * (0.6 + Math.random() * 0.4)],\n            velocity: { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed },\n            gravity: 0.2, // Heavy gravity - fall down\n            lifetime: 1.0 + Math.random() * 0.5,\n            fadeStart: 0.5,\n            friction: 0.96\n        });\n    }\n}\n\n/**\n * Vaporize death - particles rise and fade\n */\nfunction spawnVaporizeDeath(k, x, y, color) {\n    const chars = ['~', '', '', '', ''];\n    const count = 20;\n\n    // Smoke puff\n    for (let i = 0; i < count; i++) {\n        const offsetX = (Math.random() - 0.5) * 15;\n        const angle = Math.random() * Math.PI * 2;\n        const speed = 0.3 + Math.random() * 0.5;\n\n        createParticle(k, x + offsetX, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 10 + Math.random() * 10,\n            color: [Math.min(255, color[0] + 100), Math.min(255, color[1] + 100), Math.min(255, color[2] + 100)],\n            velocity: { x: Math.cos(angle) * speed, y: -1.5 - Math.random() * 1.5 }, // Rise upward\n            gravity: -0.05, // Negative gravity - float up\n            lifetime: 1.2 + Math.random() * 0.5,\n            fadeStart: 0.3,\n            friction: 0.98\n        });\n    }\n}\n\n/**\n * Pixelate death - square pixel particles\n */\nfunction spawnPixelateDeath(k, x, y, color) {\n    const chars = ['', '', '', '', '', ''];\n    const gridSize = 5;\n    const spacing = 6;\n\n    // Create a grid of pixels that scatter\n    for (let gx = -gridSize / 2; gx <= gridSize / 2; gx++) {\n        for (let gy = -gridSize / 2; gy <= gridSize / 2; gy++) {\n            const offsetX = gx * spacing;\n            const offsetY = gy * spacing;\n            const dist = Math.sqrt(gx * gx + gy * gy);\n            const angle = Math.atan2(gy, gx);\n            const speed = 1 + dist * 0.3 + Math.random() * 0.5;\n\n            createParticle(k, x + offsetX, y + offsetY, {\n                char: chars[Math.floor(Math.random() * chars.length)],\n                size: 8 + Math.random() * 4,\n                color,\n                velocity: { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed },\n                gravity: 0.08,\n                lifetime: 0.6 + Math.random() * 0.4,\n                fadeStart: 0.4,\n                friction: 0.94\n            });\n        }\n    }\n}\n\n/**\n * Fireworks death - colorful ring burst with bright core\n */\nfunction spawnFireworksDeath(k, x, y, color) {\n    const chars = ['*', '+', 'x', 'X', '#'];\n    const count = 12;\n    const speed = 3;\n\n    // Outer explosion ring\n    for (let i = 0; i < count; i++) {\n        const angle = (Math.PI * 2 * i) / count;\n        const speedMult = 0.7 + Math.random() * 0.6;\n        const velocity = {\n            x: Math.cos(angle) * speed * speedMult,\n            y: Math.sin(angle) * speed * speedMult\n        };\n\n        createParticle(k, x, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 12 + Math.random() * 8,\n            color,\n            velocity,\n            gravity: 0.1,\n            lifetime: 0.8 + Math.random() * 0.4,\n            fadeStart: 0.3,\n            friction: 0.94\n        });\n    }\n\n    // Inner explosion core with bright color\n    const coreCount = Math.floor(count / 2);\n    for (let i = 0; i < coreCount; i++) {\n        const angle = Math.random() * Math.PI * 2;\n        const speedMult = 0.3 + Math.random() * 0.4;\n        const velocity = {\n            x: Math.cos(angle) * speed * speedMult * 0.5,\n            y: Math.sin(angle) * speed * speedMult * 0.5\n        };\n\n        createParticle(k, x, y, {\n            char: chars[Math.floor(Math.random() * chars.length)],\n            size: 16 + Math.random() * 8,\n            color: [255, 200, 100],\n            velocity,\n            gravity: 0.05,\n            lifetime: 0.6 + Math.random() * 0.3,\n            fadeStart: 0.2,\n            friction: 0.9\n        });\n    }\n}\n","// Visual Effects System - screen shake, hit freeze, and other juice effects\nimport { getSetting } from './settings.js';\n\nlet kInstance = null;\nlet originalCamPos = null;\nlet shakeTimer = 0;\nlet shakeIntensity = 0;\nlet inHitFreeze = false;\n\n// Rate limiting for screen shake to prevent performance issues\nlet lastShakeTime = 0;\nconst MIN_SHAKE_INTERVAL = 0.05; // Minimum 50ms between shake calls\n\n// Rate limiting for hit freeze\nlet lastFreezeTime = 0;\nconst MIN_FREEZE_INTERVAL = 100; // Minimum 100ms between freeze calls\n\n/**\n * Initialize the visual effects system\n * @param {object} k - Kaplay instance\n */\nexport function initVisualEffects(k) {\n    kInstance = k;\n}\n\n/**\n * Apply screen shake effect\n * @param {number} intensity - Shake intensity in pixels (default 5)\n * @param {number} duration - Shake duration in seconds (default 0.1)\n */\nexport function screenShake(intensity = 5, duration = 0.1) {\n    if (!kInstance) return;\n\n    // Check if screen shake is enabled in settings (or if reduced motion is enabled)\n    if (!getSetting('visual', 'showScreenShake')) return;\n    if (getSetting('accessibility', 'reducedMotion')) return;\n\n    // Rate limit screen shake to prevent performance issues\n    const currentTime = kInstance.time();\n    if (currentTime - lastShakeTime < MIN_SHAKE_INTERVAL) {\n        // Still allow extending duration/intensity of existing shake\n        if (shakeTimer > 0) {\n            shakeIntensity = Math.max(shakeIntensity, intensity);\n            shakeTimer = Math.max(shakeTimer, duration);\n        }\n        return;\n    }\n    lastShakeTime = currentTime;\n\n    // Store original position if not already shaking\n    if (shakeTimer <= 0) {\n        originalCamPos = kInstance.camPos();\n    }\n\n    // Set shake parameters (use max if already shaking)\n    shakeIntensity = Math.max(shakeIntensity, intensity);\n    shakeTimer = Math.max(shakeTimer, duration);\n}\n\n/**\n * Update screen shake (call this in onUpdate)\n * @param {number} dt - Delta time\n */\nexport function updateScreenShake(dt) {\n    if (!kInstance || shakeTimer <= 0) return;\n\n    shakeTimer -= dt;\n\n    if (shakeTimer > 0) {\n        // Apply random offset based on intensity\n        const offsetX = (Math.random() - 0.5) * 2 * shakeIntensity;\n        const offsetY = (Math.random() - 0.5) * 2 * shakeIntensity;\n\n        if (originalCamPos) {\n            kInstance.camPos(originalCamPos.x + offsetX, originalCamPos.y + offsetY);\n        }\n    } else {\n        // Restore original position\n        if (originalCamPos) {\n            kInstance.camPos(originalCamPos);\n        }\n        shakeIntensity = 0;\n        originalCamPos = null;\n    }\n}\n\n/**\n * Apply hit freeze effect (brief pause for impact)\n * @param {number} duration - Freeze duration in milliseconds (default 50)\n */\nexport function hitFreeze(duration = 50) {\n    if (!kInstance) return;\n\n    // Check if hit freeze is enabled in settings (or if reduced motion is enabled)\n    if (!getSetting('visual', 'showHitFreeze')) return;\n    if (getSetting('accessibility', 'reducedMotion')) return;\n\n    // Don't freeze if already paused or in freeze\n    if (kInstance.paused || inHitFreeze) return;\n\n    // Rate limit hit freeze to prevent performance issues\n    const currentTime = Date.now();\n    if (currentTime - lastFreezeTime < MIN_FREEZE_INTERVAL) {\n        return;\n    }\n    lastFreezeTime = currentTime;\n\n    // Pause the game briefly\n    kInstance.paused = true;\n    inHitFreeze = true;\n\n    // Resume after duration\n    setTimeout(() => {\n        // Only unpause if we were the ones who paused it\n        kInstance.paused = false;\n        inHitFreeze = false;\n    }, duration);\n}\n\n/**\n * Check if currently in hit freeze (for UI to distinguish from user pause)\n */\nexport function isInHitFreeze() {\n    return inHitFreeze;\n}\n\n/**\n * Combined effect for big hits (shake + freeze)\n * @param {object} options - Effect options\n * @param {number} options.shakeIntensity - Shake intensity (default 8)\n * @param {number} options.shakeDuration - Shake duration (default 0.15)\n * @param {number} options.freezeDuration - Freeze duration in ms (default 50)\n */\nexport function bigHitEffect(options = {}) {\n    const {\n        shakeIntensity = 8,\n        shakeDuration = 0.15,\n        freezeDuration = 50\n    } = options;\n\n    screenShake(shakeIntensity, shakeDuration);\n    hitFreeze(freezeDuration);\n}\n\n/**\n * Effect presets for different situations\n */\nexport const EffectPresets = {\n    // Player takes damage\n    playerHit: () => {\n        screenShake(6, 0.1);\n        hitFreeze(30);\n    },\n\n    // Critical hit landed\n    criticalHit: () => {\n        screenShake(4, 0.08);\n        hitFreeze(40);\n    },\n\n    // Boss takes damage\n    bossHit: () => {\n        screenShake(3, 0.05);\n    },\n\n    // Boss dies\n    bossDeath: () => {\n        screenShake(15, 0.3);\n        hitFreeze(100);\n    },\n\n    // Explosion\n    explosion: () => {\n        screenShake(10, 0.2);\n        hitFreeze(60);\n    },\n\n    // Player dies\n    playerDeath: () => {\n        screenShake(12, 0.25);\n        hitFreeze(150);\n    },\n\n    // Level up\n    levelUp: () => {\n        screenShake(5, 0.15);\n    },\n\n    // Small impact (enemy hit)\n    smallImpact: () => {\n        screenShake(2, 0.05);\n    }\n};\n\n/**\n * Reset visual effects state (call on scene change)\n */\nexport function resetVisualEffects() {\n    shakeTimer = 0;\n    shakeIntensity = 0;\n    if (kInstance && originalCamPos) {\n        kInstance.camPos(originalCamPos);\n    }\n    originalCamPos = null;\n    lastShakeTime = 0;\n    lastFreezeTime = 0;\n    inHitFreeze = false;\n}\n","/**\n * Combat System\n *\n * Handles all combat mechanics including:\n * - Autofire system for player weapons\n * - Projectile spawning with spread patterns\n * - Critical hit calculations\n * - Damage calculations with defense\n * - Orbital weapon mechanics\n * - Enemy collision and knockback\n * - Player damage and invulnerability frames\n */\n\n// Entity imports\nimport { createProjectile } from '../entities/projectile.js';\n\n// System imports\nimport { decrementPowerupAmmo } from './powerupWeapons.js';\nimport { broadcastDamageEvent, broadcastHealEvent, broadcastDodgeEvent, isMultiplayerActive, isHost, registerProjectile } from './multiplayerGame.js';\nimport { getAimInput } from './inputSystem.js';\n\n// Configuration imports\nimport {\n    COMBAT_CONFIG,\n    WEAPON_CONFIG,\n    rollCriticalHit,\n    calculateCriticalDamage,\n    calculateDamageAfterDefense\n} from '../config/constants.js';\n\n// Sound system imports\nimport {\n    playWeaponFire,\n    playEnemyHit,\n    playPlayerHit,\n    playExplosion\n} from './sounds.js';\n\n// Particle system imports\nimport {\n    spawnBloodSplatter,\n    spawnHitImpact,\n    spawnDeathExplosion\n} from './particleSystem.js';\n\n// Visual effects imports\nimport { screenShake, hitFreeze, EffectPresets } from './visualEffects.js';\n\n// Settings import\nimport { getSetting } from './settings.js';\n\n/**\n * Spawn a floating damage number\n * @param {Object} k - Kaplay instance\n * @param {number} x - X position\n * @param {number} y - Y position\n * @param {number} damage - Damage amount to display\n * @param {Object} options - Display options\n */\nfunction spawnDamageNumber(k, x, y, damage, options = {}) {\n    // Check if damage numbers are enabled\n    if (getSetting('visual', 'showDamageNumbers') === false) return;\n\n    const {\n        isCrit = false,\n        color = isCrit ? [255, 200, 50] : [255, 255, 255]\n    } = options;\n\n    const size = isCrit ? 18 : 14;\n    const displayText = isCrit ? `${damage}!` : `${damage}`;\n\n    // Random offset to prevent overlap\n    const offsetX = (Math.random() - 0.5) * 20;\n    const offsetY = (Math.random() - 0.5) * 10;\n\n    const dmgText = k.add([\n        k.text(displayText, { size }),\n        k.pos(x + offsetX, y - 20 + offsetY),\n        k.anchor('center'),\n        k.color(...color),\n        k.z(500),\n        'damageNumber'\n    ]);\n\n    // Animate upward and fade out\n    let elapsed = 0;\n    const duration = 0.8;\n\n    dmgText.onUpdate(() => {\n        elapsed += k.dt();\n        dmgText.pos.y -= 40 * k.dt(); // Float upward\n        dmgText.opacity = Math.max(0, 1 - (elapsed / duration));\n\n        if (elapsed >= duration) {\n            k.destroy(dmgText);\n        }\n    });\n}\n\n// Helper function to apply knockback while respecting collisions and room boundaries\nfunction applySafeKnockback(k, entity, knockbackDir, knockbackAmount) {\n    if (!entity || !entity.exists()) return;\n\n    const roomMargin = 20; // Keep entities away from room edges\n    const maxX = k.width() - roomMargin;\n    const maxY = k.height() - roomMargin;\n    const minX = roomMargin;\n    const minY = roomMargin;\n\n    // Calculate new position\n    const newX = entity.pos.x + knockbackDir.x * knockbackAmount;\n    const newY = entity.pos.y + knockbackDir.y * knockbackAmount;\n\n    // Constrain to room boundaries first\n    const boundedX = Math.max(minX, Math.min(maxX, newX));\n    const boundedY = Math.max(minY, Math.min(maxY, newY));\n\n    // Store original position\n    const originalX = entity.pos.x;\n    const originalY = entity.pos.y;\n\n    // Try to move to new position\n    entity.pos.x = boundedX;\n    entity.pos.y = boundedY;\n\n    // Check for collision with walls or obstacles\n    const walls = k.get('wall');\n    const obstacles = k.get('obstacle');\n    const allObstacles = [...walls, ...obstacles];\n\n    let colliding = false;\n    for (const obstacle of allObstacles) {\n        if (!obstacle.exists()) continue;\n\n        // Check if entity area overlaps with obstacle\n        if (entity.isColliding && entity.isColliding(obstacle)) {\n            colliding = true;\n            break;\n        }\n    }\n\n    // If colliding, revert to original position\n    if (colliding) {\n        entity.pos.x = originalX;\n        entity.pos.y = originalY;\n    }\n}\n\nexport function setupCombatSystem(k, player) {\n    let lastFireTime = 0;\n\n    // Initialize orbital weapons if applicable\n    if (player.weaponKey === 'orbital') {\n        initializeOrbitalWeapons(k, player);\n    }\n\n    // Autofire system\n    k.onUpdate(() => {\n        if (k.paused) return;\n\n        // Update player rotation based on gamepad/touch/mouse aim (always, even when not shooting)\n        if (!player.isRemote) {\n            const aimInput = getAimInput();\n            let toTarget;\n            let distance;\n\n            if (aimInput.active && (aimInput.x !== 0 || aimInput.y !== 0)) {\n                // Use gamepad/touch aim direction\n                toTarget = k.vec2(aimInput.x, aimInput.y);\n                distance = 1;\n            } else {\n                // Fall back to mouse position\n                const mousePos = k.mousePos();\n                toTarget = k.vec2(\n                    mousePos.x - player.pos.x,\n                    mousePos.y - player.pos.y\n                );\n                distance = toTarget.len();\n            }\n\n            if (distance > 0) {\n                // Convert to degrees for Kaplay's rotate component\n                const aimAngleDeg = Math.atan2(toTarget.y, toTarget.x) * (180 / Math.PI);\n                player.angle = aimAngleDeg;\n                if (player.outline && player.outline.exists()) {\n                    player.outline.angle = aimAngleDeg;\n                }\n            }\n        } else if (player.aimAngle !== undefined) {\n            // Remote player rotation from network (already in degrees)\n            player.angle = player.aimAngle;\n            if (player.outline && player.outline.exists()) {\n                player.outline.angle = player.aimAngle;\n            }\n        }\n\n        // Don't allow shooting if canShoot is false (e.g., player is dead)\n        if (player.canShoot === false) {\n            player.isShooting = false; // Track shooting state for multiplayer\n            return;\n        }\n\n        // Check if there are any enemies in the room (enemies, bosses, minibosses)\n        const enemies = k.get('enemy');\n        const bosses = k.get('boss');\n        const minibosses = k.get('miniboss');\n        const hasTargets = enemies.length > 0 || bosses.length > 0 || minibosses.length > 0;\n\n        // Don't shoot if there are no targets (except orbital weapons which are passive)\n        if (!hasTargets && player.weaponKey !== 'orbital') {\n            player.isShooting = false; // Track shooting state for multiplayer\n            return;\n        }\n\n        // Handle orbital weapons (passive, no firing needed)\n        if (player.weaponKey === 'orbital') {\n            updateOrbitalWeapons(k, player);\n            player.isShooting = false; // Orbital weapons don't shoot\n            return; // Orbital weapons don't fire projectiles\n        }\n\n        const time = k.time();\n\n        let baseDirection;\n        let shouldFire = false;\n\n        // For remote players, use their aimAngle from network\n        // For local players, use mouse position\n        if (player.isRemote) {\n            // Remote player: in multiplayer, projectiles are spawned on the host only\n            // Remote players don't spawn projectiles on clients to avoid duplicates\n            if (isMultiplayerActive() && !isHost()) {\n                player.isShooting = false;\n                return; // Projectiles for remote players are handled by host\n            }\n\n            // Host: use aimAngle from network input for remote players\n            if (player.aimAngle !== undefined && player.isShooting) {\n                const angleRad = player.aimAngle * (Math.PI / 180);\n                baseDirection = k.vec2(Math.cos(angleRad), Math.sin(angleRad));\n                shouldFire = true;\n            } else {\n                player.isShooting = false;\n                return; // No aim angle or not shooting\n            }\n        } else {\n            // Local player: check for gamepad/touch aim first, then fall back to mouse\n            const aimInput = getAimInput();\n\n            let toTarget;\n            let distance;\n\n            if (aimInput.active && (aimInput.x !== 0 || aimInput.y !== 0)) {\n                // Use gamepad/touch aim direction (already normalized by input system)\n                toTarget = k.vec2(aimInput.x, aimInput.y);\n                distance = 1; // Always has distance when active\n            } else {\n                // Fall back to mouse position\n                const mousePos = k.mousePos();\n                toTarget = k.vec2(\n                    mousePos.x - player.pos.x,\n                    mousePos.y - player.pos.y\n                );\n                distance = toTarget.len();\n            }\n\n            // Track aim angle for multiplayer (angle in degrees from player to target)\n            if (distance > 0) {\n                player.aimAngle = Math.atan2(toTarget.y, toTarget.x) * (180 / Math.PI);\n                baseDirection = toTarget.unit();\n\n                // In multiplayer as client, don't spawn projectiles locally\n                // Only the host spawns projectiles for all players\n                if (isMultiplayerActive() && !isHost()) {\n                    player.isShooting = distance > 0 && player.canShoot;\n                    return; // Host will spawn projectiles based on our input\n                }\n\n                shouldFire = true;\n            } else {\n                player.aimAngle = 0;\n                player.isShooting = false;\n                return; // No aim input\n            }\n\n            // Track shooting state for multiplayer\n            player.isShooting = distance > 0 && player.canShoot;\n        }\n\n        if (shouldFire && baseDirection) {\n            \n            // Calculate effective fire rate (with bulletTime bonus if moving)\n            let effectiveFireRate = player.fireRate;\n            if (player.bulletTimeEnabled && player.bulletTimeBonus && player.move) {\n                const isMoving = player.move.x !== 0 || player.move.y !== 0;\n                if (isMoving) {\n                    effectiveFireRate = player.fireRate * (1 + player.bulletTimeBonus);\n                }\n            }\n\n            // Speed Demon synergy: +fire rate per speed stack\n            if (player.speedDemonEnabled && player.speedDemonFireRatePerStack) {\n                const speedStacks = player.upgradeStacks?.speed || 0;\n                if (speedStacks > 0) {\n                    effectiveFireRate = effectiveFireRate * (1 + speedStacks * player.speedDemonFireRatePerStack);\n                }\n            }\n\n            // Fire if enough time has passed\n            if (time - lastFireTime >= 1 / effectiveFireRate) {\n                const projectileCount = player.projectileCount || 1;\n                const spreadAngle = player.spreadAngle || 0;\n                \n                // Calculate spread directions\n                const directions = [];\n                if (projectileCount === 1) {\n                    directions.push(baseDirection);\n                } else if (spreadAngle > 0) {\n                    // Spread pattern (shotgun)\n                    const angleStep = projectileCount > 1 ? spreadAngle / (projectileCount - 1) : 0;\n                    const startAngle = -spreadAngle / 2;\n                    for (let i = 0; i < projectileCount; i++) {\n                        const angle = startAngle + (angleStep * i);\n                        const rad = angle * (Math.PI / 180);\n                        const cos = Math.cos(rad);\n                        const sin = Math.sin(rad);\n                        const dir = k.vec2(\n                            baseDirection.x * cos - baseDirection.y * sin,\n                            baseDirection.x * sin + baseDirection.y * cos\n                        );\n                        directions.push(dir.unit());\n                    }\n                } else {\n                    // Multi-shot without spread (all same direction)\n                    for (let i = 0; i < projectileCount; i++) {\n                        directions.push(baseDirection);\n                    }\n                }\n                \n                // Fire all projectiles\n                directions.forEach((direction, index) => {\n                    // Small delay for multi-shot without spread (staggered)\n                    const delay = spreadAngle === 0 && projectileCount > 1\n                        ? index * COMBAT_CONFIG.MULTISHOT_STAGGER_DELAY\n                        : 0;\n\n                    k.wait(delay, () => {\n                        // Check for critical hit\n                        const isCrit = rollCriticalHit(player.critChance || 0);\n                        let finalDamage = isCrit\n                            ? calculateCriticalDamage(player.projectileDamage, player.critDamage || 2.0)\n                            : player.projectileDamage;\n\n                        // Apply synergy bonuses (e.g., armor piercing)\n                        if (player.piercingDamageBonus && (player.piercing || 0) > 0) {\n                            finalDamage = Math.floor(finalDamage * player.piercingDamageBonus);\n                        }\n\n                        // Use weapon's character and color for projectiles\n                        let weaponRange = player.weaponRange || WEAPON_CONFIG.DEFAULT_WEAPON_RANGE;\n\n                        // Deadeye synergy: crits have +50% range\n                        if (isCrit && player.deadeyeEnabled && player.deadeyeRangeBonus) {\n                            weaponRange = weaponRange * (1 + player.deadeyeRangeBonus);\n                        }\n\n                        // Play weapon firing sound\n                        playWeaponFire(player.weaponKey);\n\n                        // Handle special weapon types\n                        if (player.weaponKey === 'flamethrower') {\n                            // Flamethrower - create projectile with burn DoT effect\n                            const projectile = createProjectile(k, player.pos.x, player.pos.y, direction,\n                                player.projectileSpeed, finalDamage,\n                                player.piercing || 0, player.obstaclePiercing || 0, isCrit, weaponRange);\n\n                            // Apply weapon visual properties\n                            if (player.weaponDef) {\n                                projectile.useWeaponVisual(player.weaponDef);\n                            }\n\n                            // Track projectile owner for kill attribution\n                            projectile.ownerSlotIndex = player.slotIndex;\n\n                            // Add burn DoT effect\n                            const burnDamagePerTick = Math.floor(finalDamage * 0.3); // 30% of hit damage per tick\n                            const burnDuration = 2.0; // 2 seconds of burn\n                            const dotMultiplier = player.fireDotMultiplier || 1.0;\n\n                            projectile.burnDamage = Math.floor(burnDamagePerTick * dotMultiplier);\n                            projectile.burnDuration = burnDuration;\n\n                            // Register projectile for multiplayer sync\n                            if (isMultiplayerActive() && isHost()) {\n                                registerProjectile(projectile, {\n                                    weaponKey: player.weaponKey,\n                                    burnDamage: projectile.burnDamage,\n                                    burnDuration: projectile.burnDuration\n                                });\n                            }\n                        } else if (player.weaponKey === 'explosive') {\n                            // Explosive launcher - create explosive projectile\n                            const projectile = createExplosiveProjectile(k, player.pos.x, player.pos.y, direction,\n                                player.projectileSpeed, finalDamage,\n                                player.explosionRadius, player.explosionDamage, weaponRange, isCrit);\n                            if (player.weaponDef) {\n                                projectile.useWeaponVisual(player.weaponDef);\n                            }\n\n                            // Track projectile owner for kill attribution\n                            projectile.ownerSlotIndex = player.slotIndex;\n\n                            // Register projectile for multiplayer sync\n                            if (isMultiplayerActive() && isHost()) {\n                                registerProjectile(projectile, {\n                                    weaponKey: player.weaponKey,\n                                    explosionRadius: projectile.explosionRadius,\n                                    explosionDamage: projectile.explosionDamage\n                                });\n                            }\n                        } else if (player.weaponKey === 'chainLightning') {\n                            // Chain lightning - create chaining projectile\n                            const projectile = createChainProjectile(k, player.pos.x, player.pos.y, direction,\n                                player.projectileSpeed, finalDamage,\n                                player.chainRange, player.maxJumps, player.chainDamageReduction, weaponRange, isCrit);\n                            if (player.weaponDef) {\n                                projectile.useWeaponVisual(player.weaponDef);\n                            }\n\n                            // Track projectile owner for kill attribution\n                            projectile.ownerSlotIndex = player.slotIndex;\n\n                            // Register projectile for multiplayer sync\n                            if (isMultiplayerActive() && isHost()) {\n                                registerProjectile(projectile, {\n                                    weaponKey: player.weaponKey,\n                                    chainRange: projectile.chainRange,\n                                    maxJumps: projectile.maxJumps,\n                                    chainDamageReduction: projectile.chainDamageReduction\n                                });\n                            }\n                        } else if (player.weaponKey === 'boomerang') {\n                            // Boomerang - create returning projectile\n                            const projectile = createProjectile(k, player.pos.x, player.pos.y, direction,\n                                player.projectileSpeed, finalDamage,\n                                player.piercing || 0, player.obstaclePiercing || 0, isCrit, weaponRange);\n\n                            // Set boomerang properties\n                            projectile.isBoomerang = true;\n                            projectile.ownerPlayer = player;\n                            projectile.returnSpeedMultiplier = player.weaponDef?.returnSpeedMultiplier || 1.2;\n\n                            if (player.weaponDef) {\n                                projectile.useWeaponVisual(player.weaponDef);\n                            }\n\n                            // Track projectile owner for kill attribution\n                            projectile.ownerSlotIndex = player.slotIndex;\n\n                            // Register projectile for multiplayer sync\n                            if (isMultiplayerActive() && isHost()) {\n                                registerProjectile(projectile, {\n                                    weaponKey: player.weaponKey,\n                                    isBoomerang: true\n                                });\n                            }\n                        } else {\n                            // Standard projectile\n                            const projectile = createProjectile(k, player.pos.x, player.pos.y, direction,\n                                player.projectileSpeed, finalDamage,\n                                player.piercing || 0, player.obstaclePiercing || 0, isCrit, weaponRange);\n\n                            // Apply weapon visual properties\n                            if (player.weaponDef) {\n                                projectile.useWeaponVisual(player.weaponDef);\n                            }\n\n                            // Track projectile owner for kill attribution\n                            projectile.ownerSlotIndex = player.slotIndex;\n\n                            // Register projectile for multiplayer sync\n                            if (isMultiplayerActive() && isHost()) {\n                                registerProjectile(projectile, {\n                                    weaponKey: player.weaponKey || 'pistol'\n                                });\n                            }\n                        }\n                    });\n                });\n\n                lastFireTime = time;\n\n                // Decrement powerup weapon ammo if applicable\n                decrementPowerupAmmo(player);\n            }\n        }\n    });\n\n    // Collision: Projectile hits Wall (consolidated handler)\n    k.onCollide('projectile', 'wall', (projectile, wall) => {\n        if (k.paused) return;\n\n        // Handle explosive projectiles\n        if (projectile.isExplosive) {\n            explodeProjectile(k, projectile, projectile.pos.x, projectile.pos.y);\n            return;\n        }\n\n        // Check if projectile has already hit this obstacle (for obstacle piercing)\n        if (projectile.piercedObstacles && projectile.piercedObstacles.has(wall)) {\n            return; // Already hit this obstacle\n        }\n\n        // Check if projectile can pierce obstacles\n        if (projectile.obstaclePiercing > 0) {\n            // Track this obstacle for piercing\n            if (projectile.piercedObstacles) {\n                projectile.piercedObstacles.add(wall);\n            }\n\n            // Destroy projectile if it can't pierce anymore obstacles\n            // If obstaclePiercing = n, projectile can hit n+1 obstacles total\n            if (projectile.piercedObstacles.size > (projectile.obstaclePiercing || 0)) {\n                k.destroy(projectile);\n            }\n        } else {\n            // No obstacle piercing - destroy projectile\n            k.destroy(projectile);\n        }\n    });\n    \n    // Collision: Projectile hits Cover (check obstacle piercing)\n    k.onCollide('projectile', 'cover', (projectile, cover) => {\n        if (k.paused) return;\n        \n        // Cover allows projectiles through by default, but we can still track for piercing\n        // Only destroy if projectile has hit max obstacles\n        if (projectile.obstaclePiercing > 0 && projectile.piercedObstacles) {\n            if (projectile.piercedObstacles.has(cover)) {\n                return; // Already hit this obstacle\n            }\n            \n            projectile.piercedObstacles.add(cover);\n            \n            // Destroy projectile if it can't pierce anymore obstacles\n            if (projectile.piercedObstacles.size > (projectile.obstaclePiercing || 0)) {\n                k.destroy(projectile);\n            }\n        }\n        // If no obstacle piercing, projectile passes through cover (cover behavior)\n    });\n\n    // Collision: Projectile hits Obstacle (check obstacle piercing)\n    k.onCollide('projectile', 'obstacle', (projectile, obstacle) => {\n        if (k.paused) return;\n\n        // Explosive projectiles are handled separately\n        if (projectile.isExplosive) {\n            return;\n        }\n\n        // Check if projectile has already hit this obstacle (for obstacle piercing)\n        if (projectile.piercedObstacles && projectile.piercedObstacles.has(obstacle)) {\n            return; // Already hit this obstacle\n        }\n\n        // Check if projectile can pierce obstacles\n        if (projectile.obstaclePiercing > 0) {\n            // Track this obstacle for piercing\n            if (projectile.piercedObstacles) {\n                projectile.piercedObstacles.add(obstacle);\n            }\n\n            // Destroy projectile if it can't pierce anymore obstacles\n            if (projectile.piercedObstacles.size > (projectile.obstaclePiercing || 0)) {\n                k.destroy(projectile);\n            }\n        } else {\n            // No obstacle piercing - destroy projectile\n            k.destroy(projectile);\n        }\n    });\n\n    // Collision: Projectile hits Barrel (damages barrel, can cause explosion)\n    k.onCollide('projectile', 'barrel', (projectile, barrel) => {\n        if (k.paused) return;\n        if (!barrel.exists() || barrel.isExploding) return;\n\n        // Only player projectiles damage barrels\n        if (projectile.isEnemyProjectile || projectile.isBossProjectile) {\n            return;\n        }\n\n        // Damage the barrel\n        if (barrel.takeDamage) {\n            barrel.takeDamage(1);\n        }\n\n        // Handle projectile destruction based on piercing\n        if (projectile.piercing > 0 || projectile.obstaclePiercing > 0) {\n            // Piercing projectiles continue through\n            if (projectile.piercedObstacles) {\n                projectile.piercedObstacles.add(barrel);\n            }\n        } else if (!projectile.isExplosive) {\n            // Non-piercing, non-explosive projectiles are destroyed\n            if (projectile.exists()) k.destroy(projectile);\n        }\n    });\n\n    // Collision: Projectile hits Enemy (consolidated handler for all projectile types)\n    k.onCollide('projectile', 'enemy', (projectile, enemy) => {\n        if (k.paused) return;\n\n        // Only player projectiles can hit enemies (enemy/boss projectiles pass through)\n        if (projectile.isEnemyProjectile || projectile.isBossProjectile) {\n            return;\n        }\n\n        // Check if enemy reflects projectiles (reflector enemy type)\n        // Max 2 bounces to prevent infinite loops, damage reduced by 30% per bounce\n        const maxReflections = 2;\n        const reflectionCount = projectile.reflectionCount || 0;\n        if (enemy.reflectsProjectiles && !projectile.isReflected && reflectionCount < maxReflections) {\n            const reflectRoll = Math.random();\n            if (reflectRoll < (enemy.reflectChance || 0.4)) {\n                // Reflect the projectile back at the player\n                projectile.isReflected = true;\n                projectile.reflectionCount = reflectionCount + 1;\n                projectile.isEnemyProjectile = true; // Now damages player instead\n                projectile.direction = k.vec2(-projectile.direction.x, -projectile.direction.y); // Reverse direction\n                projectile.color = k.rgb(255, 100, 100); // Change color to indicate reflected\n                // Reduce damage by 30% per reflection to prevent reflected projectiles being too strong\n                projectile.damage = Math.floor(projectile.damage * 0.7);\n\n                // Visual feedback for reflection\n                const reflectEffect = k.add([\n                    k.text('*', { size: 20 }),\n                    k.pos(enemy.pos.x, enemy.pos.y),\n                    k.anchor('center'),\n                    k.color(200, 200, 255),\n                    k.opacity(1),\n                    k.lifespan(0.3),\n                    k.z(500)\n                ]);\n                return; // Don't damage the enemy\n            }\n        }\n\n        // Handle explosive projectiles\n        if (projectile.isExplosive) {\n            explodeProjectile(k, projectile, enemy.pos.x, enemy.pos.y);\n            return;\n        }\n\n        // Handle chain lightning projectiles\n        if (projectile.isChainLightning) {\n            // Check if already hit this enemy\n            if (projectile.chainedEnemies && projectile.chainedEnemies.has(enemy)) {\n                return;\n            }\n\n            // Only host deals damage in multiplayer\n            if (!isMultiplayerActive() || isHost()) {\n                // Calculate damage (reduces per jump)\n                const jumpCount = projectile.chainJumps || 0;\n                const damageReduction = 1 - (projectile.chainDamageReduction || 0.15) * jumpCount;\n                const finalDamage = Math.floor(projectile.damage * Math.max(0.1, damageReduction));\n\n                // Deal damage\n                if (enemy.takeDamage) {\n                    enemy.takeDamage(finalDamage);\n                } else {\n                    enemy.hurt(finalDamage);\n                }\n            }\n\n            // Track this enemy (visual tracking on all clients)\n            if (projectile.chainedEnemies) {\n                projectile.chainedEnemies.add(enemy);\n            }\n\n            // Chain to next enemy if jumps remaining (visual chaining on all clients)\n            if (projectile.chainJumps < projectile.maxJumps) {\n                chainToNextEnemy(k, projectile, enemy);\n            } else {\n                // No more jumps, destroy projectile\n                k.destroy(projectile);\n            }\n            return;\n        }\n\n        // Check if this projectile has already hit this enemy (for piercing)\n        if (projectile.piercedEnemies && projectile.piercedEnemies.has(enemy)) {\n            return; // Already hit this enemy\n        }\n\n        // In multiplayer, only host deals damage\n        // Clients just show visual effects\n        if (isMultiplayerActive() && !isHost()) {\n            // Client: show visual feedback only\n            playEnemyHit();\n            spawnBloodSplatter(k, enemy.pos.x, enemy.pos.y, { isCrit: projectile.isCrit });\n\n            // Track for piercing and destroy projectile as needed\n            if (projectile.piercedEnemies) {\n                projectile.piercedEnemies.add(enemy);\n            }\n            if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\n                k.destroy(projectile);\n            }\n            return; // Skip damage dealing on client\n        }\n\n        // Host or singleplayer: deal damage\n        playEnemyHit();\n\n        // Calculate final damage with synergy bonuses\n        let finalDamage = projectile.damage;\n\n        // Executioner synergy: +100% damage to enemies below 25% HP\n        if (projectile.ownerSlotIndex !== undefined) {\n            const allPlayers = k.get('player');\n            const ownerPlayer = allPlayers.find(p => p.slotIndex === projectile.ownerSlotIndex);\n            if (ownerPlayer && ownerPlayer.executionerEnabled && ownerPlayer.executionerThreshold) {\n                const enemyHPPercent = enemy.hp() / (enemy.maxHealth || enemy.hp());\n                if (enemyHPPercent < ownerPlayer.executionerThreshold) {\n                    finalDamage = Math.floor(finalDamage * (1 + (ownerPlayer.executionerDamageBonus || 1.0)));\n                }\n            }\n        }\n\n        // Use takeDamage if available (handles armor/shields), otherwise use hurt\n        if (enemy.takeDamage) {\n            enemy.takeDamage(finalDamage);\n        } else {\n            enemy.hurt(finalDamage);\n        }\n\n        // Spawn damage number\n        spawnDamageNumber(k, enemy.pos.x, enemy.pos.y, finalDamage, { isCrit: projectile.isCrit });\n\n        // Vampiric Rounds synergy: heal player on crit damage\n        if (projectile.isCrit && projectile.ownerSlotIndex !== undefined) {\n            // Find the player who owns this projectile\n            const allPlayers = k.get('player');\n            const ownerPlayer = allPlayers.find(p => p.slotIndex === projectile.ownerSlotIndex);\n            if (ownerPlayer && ownerPlayer.vampiricCrits && ownerPlayer.vampiricHealPercent) {\n                const healAmount = Math.floor(finalDamage * ownerPlayer.vampiricHealPercent);\n                if (healAmount > 0 && ownerPlayer.hp() < ownerPlayer.maxHealth) {\n                    const newHP = Math.min(ownerPlayer.maxHealth, ownerPlayer.hp() + healAmount);\n                    ownerPlayer.setHP(newHP);\n                }\n            }\n        }\n\n        // Lifesteal upgrade: heal player on damage dealt\n        if (projectile.ownerSlotIndex !== undefined) {\n            const allPlayers = k.get('player');\n            const ownerPlayer = allPlayers.find(p => p.slotIndex === projectile.ownerSlotIndex);\n            if (ownerPlayer && ownerPlayer.lifestealPercent && ownerPlayer.lifestealPercent > 0) {\n                // Calculate lifesteal (Vampire Lord synergy multiplies on crits)\n                let lifestealMultiplier = ownerPlayer.lifestealPercent;\n                if (projectile.isCrit && ownerPlayer.vampireLordEnabled && ownerPlayer.vampireLordMultiplier) {\n                    lifestealMultiplier *= ownerPlayer.vampireLordMultiplier;\n                }\n                const healAmount = Math.floor(finalDamage * lifestealMultiplier);\n                if (healAmount > 0 && ownerPlayer.hp() < ownerPlayer.maxHealth) {\n                    const newHP = Math.min(ownerPlayer.maxHealth, ownerPlayer.hp() + healAmount);\n                    ownerPlayer.setHP(newHP);\n\n                    // Broadcast heal event for multiplayer\n                    if (isMultiplayerActive() && isHost()) {\n                        broadcastHealEvent({\n                            slotIndex: ownerPlayer.slotIndex,\n                            healAmount: healAmount,\n                            newHP: newHP,\n                            source: 'lifesteal'\n                        });\n                    }\n                }\n            }\n        }\n\n        // Track who last hit this enemy for kill attribution\n        if (projectile.ownerSlotIndex !== undefined) {\n            enemy.lastHitBySlot = projectile.ownerSlotIndex;\n\n            // Update survivalist combat time when dealing damage (not just taking damage)\n            const allPlayers = k.get('player');\n            const ownerPlayer = allPlayers.find(p => p.slotIndex === projectile.ownerSlotIndex);\n            if (ownerPlayer && ownerPlayer.survivalistEnabled) {\n                ownerPlayer.survivalistLastCombatTime = k.time();\n            }\n        }\n\n        // Broadcast damage event for multiplayer\n        if (isMultiplayerActive() && isHost()) {\n            broadcastDamageEvent({\n                targetId: enemy.mpEntityId,\n                targetType: 'enemy',\n                damage: finalDamage,\n                isCrit: projectile.isCrit || false,\n                x: enemy.pos.x,\n                y: enemy.pos.y\n            });\n        }\n\n        // Apply fire DoT if projectile has burn effect\n        if (projectile.burnDamage && projectile.burnDuration) {\n            enemy.burnDamage = projectile.burnDamage;\n            enemy.burnDuration = projectile.burnDuration;\n            enemy.burnTimer = 0;\n        }\n\n        // Spawn blood splatter particle effect\n        spawnBloodSplatter(k, enemy.pos.x, enemy.pos.y, { isCrit: projectile.isCrit });\n\n        // Track this enemy for piercing\n        if (projectile.piercedEnemies) {\n            projectile.piercedEnemies.add(enemy);\n        }\n\n        // Destroy projectile if it can't pierce anymore\n        // If piercing = n, projectile can hit n+1 enemies total\n        // piercing = 0: hit 1 enemy, piercing = 1: hit 2 enemies, etc.\n        if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\n            k.destroy(projectile);\n        }\n\n        // Knockback enemy away from projectile direction\n        const knockbackDir = k.vec2(\n            enemy.pos.x - projectile.pos.x,\n            enemy.pos.y - projectile.pos.y\n        );\n        const knockbackDist = knockbackDir.len();\n        if (knockbackDist > 0) {\n            const normalized = knockbackDir.unit();\n            const knockbackAmount = COMBAT_CONFIG.KNOCKBACK_ENEMY_FROM_PROJECTILE;\n            applySafeKnockback(k, enemy, normalized, knockbackAmount);\n        }\n\n        // Spawn hit impact particle effect\n        spawnHitImpact(k, enemy.pos.x, enemy.pos.y, knockbackDir, { isCrit: projectile.isCrit });\n\n        // Screen effects for crits\n        if (projectile.isCrit) {\n            EffectPresets.criticalHit();\n        }\n\n        // Visual feedback (different color for crits)\n        enemy.color = projectile.isCrit\n            ? k.rgb(...COMBAT_CONFIG.CRIT_COLOR)\n            : k.rgb(...COMBAT_CONFIG.HIT_COLOR);\n        k.wait(COMBAT_CONFIG.HIT_FLASH_DURATION, () => {\n            if (enemy.exists()) {\n                enemy.color = k.rgb(255, 100, 100);\n            }\n        });\n    });\n    \n    // Collision: Projectile hits Boss (consolidated handler for all projectile types)\n    k.onCollide('projectile', 'boss', (projectile, boss) => {\n        if (k.paused) return;\n\n        // Handle explosive projectiles\n        if (projectile.isExplosive) {\n            explodeProjectile(k, projectile, boss.pos.x, boss.pos.y);\n            return;\n        }\n\n        // Handle chain lightning projectiles\n        if (projectile.isChainLightning) {\n            // Check if already hit this boss\n            if (projectile.chainedEnemies && projectile.chainedEnemies.has(boss)) {\n                return;\n            }\n\n            // Only host deals damage in multiplayer\n            if (!isMultiplayerActive() || isHost()) {\n                // Calculate damage (reduces per jump)\n                const jumpCount = projectile.chainJumps || 0;\n                const damageReduction = 1 - (projectile.chainDamageReduction || 0.15) * jumpCount;\n                const finalDamage = Math.floor(projectile.damage * Math.max(0.1, damageReduction));\n\n                // Deal damage\n                if (boss.takeDamage) {\n                    boss.takeDamage(finalDamage);\n                } else {\n                    boss.hurt(finalDamage);\n                }\n            }\n\n            // Track this boss (visual tracking on all clients)\n            if (projectile.chainedEnemies) {\n                projectile.chainedEnemies.add(boss);\n            }\n\n            // Chain to next enemy if jumps remaining\n            k.wait(0.01, () => {\n                if (!projectile.exists()) return;\n                if (projectile.chainJumps < projectile.maxJumps) {\n                    chainToNextEnemy(k, projectile, boss);\n                } else {\n                    k.destroy(projectile);\n                }\n            });\n            return;\n        }\n\n        // Handle regular projectiles\n        // Check if this projectile has already hit this boss (for piercing)\n        if (projectile.piercedEnemies && projectile.piercedEnemies.has(boss)) {\n            return;\n        }\n\n        // In multiplayer, only host deals damage\n        if (isMultiplayerActive() && !isHost()) {\n            spawnBloodSplatter(k, boss.pos.x, boss.pos.y, { isCrit: projectile.isCrit });\n            const knockbackDir = k.vec2(boss.pos.x - projectile.pos.x, boss.pos.y - projectile.pos.y);\n            spawnHitImpact(k, boss.pos.x, boss.pos.y, knockbackDir, { isCrit: projectile.isCrit });\n\n            if (projectile.piercedEnemies) {\n                projectile.piercedEnemies.add(boss);\n            }\n            if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\n                k.destroy(projectile);\n            }\n            return;\n        }\n\n        // Host or singleplayer: deal damage\n        if (boss.takeDamage) {\n            boss.takeDamage(projectile.damage);\n        } else {\n            boss.hurt(projectile.damage);\n        }\n\n        // Spawn damage number\n        spawnDamageNumber(k, boss.pos.x, boss.pos.y, projectile.damage, { isCrit: projectile.isCrit });\n\n        // Track who last hit this boss for kill attribution\n        if (projectile.ownerSlotIndex !== undefined) {\n            boss.lastHitBySlot = projectile.ownerSlotIndex;\n        }\n\n        // Apply fire DoT\n        if (projectile.burnDamage && projectile.burnDuration) {\n            boss.burnDamage = projectile.burnDamage;\n            boss.burnDuration = projectile.burnDuration;\n            boss.burnTimer = 0;\n        }\n\n        spawnBloodSplatter(k, boss.pos.x, boss.pos.y, { isCrit: projectile.isCrit });\n\n        if (projectile.piercedEnemies) {\n            projectile.piercedEnemies.add(boss);\n        }\n\n        if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\n            k.destroy(projectile);\n        }\n\n        // Knockback\n        const knockbackDir = k.vec2(boss.pos.x - projectile.pos.x, boss.pos.y - projectile.pos.y);\n        if (knockbackDir.len() > 0) {\n            applySafeKnockback(k, boss, knockbackDir.unit(), COMBAT_CONFIG.KNOCKBACK_BOSS_FROM_PROJECTILE);\n        }\n\n        spawnHitImpact(k, boss.pos.x, boss.pos.y, knockbackDir, { isCrit: projectile.isCrit });\n\n        // Screen effects for boss hits and crits\n        if (projectile.isCrit) {\n            EffectPresets.criticalHit();\n        } else {\n            EffectPresets.bossHit();\n        }\n\n        boss.color = projectile.isCrit ? k.rgb(255, 200, 0) : k.rgb(255, 255, 255);\n        k.wait(0.1, () => {\n            if (boss.exists()) boss.updateVisual();\n        });\n    });\n\n    // Collision: Projectile hits Miniboss\n    k.onCollide('projectile', 'miniboss', (projectile, miniboss) => {\n        if (k.paused) return;\n\n        // Only player projectiles can hit minibosses\n        if (projectile.isEnemyProjectile || projectile.isBossProjectile) {\n            return;\n        }\n\n        // Check if this projectile has already hit this miniboss (for piercing)\n        if (projectile.piercedEnemies && projectile.piercedEnemies.has(miniboss)) {\n            return; // Already hit this miniboss\n        }\n\n        // In multiplayer, only host deals damage\n        // Clients just show visual effects\n        if (isMultiplayerActive() && !isHost()) {\n            // Client: show visual feedback only\n            spawnBloodSplatter(k, miniboss.pos.x, miniboss.pos.y, { isCrit: projectile.isCrit });\n            const impactDir = k.vec2(miniboss.pos.x - projectile.pos.x, miniboss.pos.y - projectile.pos.y);\n            spawnHitImpact(k, miniboss.pos.x, miniboss.pos.y, impactDir, { isCrit: projectile.isCrit });\n\n            // Track for piercing and destroy projectile as needed\n            if (projectile.piercedEnemies) {\n                projectile.piercedEnemies.add(miniboss);\n            }\n            if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\n                k.destroy(projectile);\n            }\n            return; // Skip damage dealing on client\n        }\n\n        // Host or singleplayer: deal damage\n        // Calculate final damage (with crit)\n        let finalDamage = projectile.damage;\n        if (projectile.isCrit) {\n            finalDamage = Math.floor(finalDamage * 1.5); // 50% crit bonus\n        }\n\n        // Use takeDamage to handle armor/shields\n        if (miniboss.takeDamage) {\n            miniboss.takeDamage(finalDamage);\n        } else {\n            miniboss.hurt(finalDamage);\n        }\n\n        // Spawn damage number\n        spawnDamageNumber(k, miniboss.pos.x, miniboss.pos.y, finalDamage, { isCrit: projectile.isCrit });\n\n        // Track who last hit this miniboss for kill attribution\n        if (projectile.ownerSlotIndex !== undefined) {\n            miniboss.lastHitBySlot = projectile.ownerSlotIndex;\n        }\n\n        // Apply fire DoT if projectile has burn effect\n        if (projectile.burnDamage && projectile.burnDuration) {\n            miniboss.burnDamage = projectile.burnDamage;\n            miniboss.burnDuration = projectile.burnDuration;\n            miniboss.burnTimer = 0;\n        }\n\n        // Spawn blood splatter particle effect\n        spawnBloodSplatter(k, miniboss.pos.x, miniboss.pos.y, { isCrit: projectile.isCrit });\n\n        // Spawn hit impact particle effect\n        const impactDir = k.vec2(miniboss.pos.x - projectile.pos.x, miniboss.pos.y - projectile.pos.y);\n        spawnHitImpact(k, miniboss.pos.x, miniboss.pos.y, impactDir, { isCrit: projectile.isCrit });\n\n        // Screen effects for crits\n        if (projectile.isCrit) {\n            EffectPresets.criticalHit();\n        }\n\n        // Track this miniboss for piercing\n        if (projectile.piercedEnemies) {\n            projectile.piercedEnemies.add(miniboss);\n        }\n        \n        // Destroy projectile if it can't pierce anymore\n        if (projectile.piercedEnemies.size > (projectile.piercing || 0)) {\n            k.destroy(projectile);\n        }\n        \n        // Visual feedback (different color for crits)\n        miniboss.color = projectile.isCrit ? k.rgb(255, 200, 0) : k.rgb(255, 255, 255);\n        k.wait(0.1, () => {\n            if (miniboss.exists()) {\n                // Restore miniboss color (will be updated by updateVisual if armor/shield changed)\n                miniboss.updateVisual();\n            }\n        });\n    });\n\n    // Collision: Enemy hits Player\n    k.onCollide('enemy', 'player', (enemy, player) => {\n        if (k.paused) return;\n\n        // Don't damage dead players\n        if (player.isDead || player.hp() <= 0) return;\n\n        // Check if player is invulnerable (immunity frames)\n        if (player.invulnerable) return;\n\n        // In multiplayer, only host processes damage\n        if (isMultiplayerActive() && !isHost()) {\n            // Client: show visual feedback only\n            playPlayerHit();\n            spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\n            player.color = k.rgb(...COMBAT_CONFIG.HIT_COLOR);\n            return;\n        }\n\n        // Host or singleplayer: process damage\n        // Check for dodge chance (The Scout ability)\n        if (player.dodgeChance && Math.random() < player.dodgeChance) {\n            // Dodged! No damage taken\n            // Broadcast dodge event for multiplayer\n            if (isMultiplayerActive() && isHost()) {\n                broadcastDodgeEvent({\n                    slotIndex: player.slotIndex,\n                    x: player.pos.x,\n                    y: player.pos.y\n                });\n            }\n            return;\n        }\n\n        // Play player hit sound and effects\n        playPlayerHit();\n        EffectPresets.playerHit();\n\n        // Apply damage with defense reduction (use enemy's damage if available)\n        const baseDamage = enemy.damage || COMBAT_CONFIG.BASE_ENEMY_DAMAGE;\n        const finalDamage = calculateDamageAfterDefense(baseDamage, player.defense || 0, player.damageReduction || 0);\n        player.hurt(finalDamage);\n\n        // Update survivalist combat time (for out-of-combat regen)\n        if (player.survivalistEnabled) {\n            player.survivalistLastCombatTime = k.time();\n        }\n\n        // Set invulnerability frames (don't reset timer if already invulnerable)\n        if (!player.invulnerable) {\n            player.invulnerable = true;\n            player.invulnerableTime = player.invulnerableDuration;\n        }\n\n        // Spawn blood splatter particle effect for player\n        spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\n\n        // Leech lifesteal: heal enemy when it hits player\n        if (enemy.lifesteal && enemy.exists()) {\n            const currentHP = enemy.hp();\n            const maxHP = enemy.maxHealth;\n            if (currentHP < maxHP) {\n                const newHP = Math.min(maxHP, currentHP + enemy.lifesteal);\n                enemy.setHP(newHP);\n            }\n        }\n\n        // Vampiric elite: heal enemy when it hits player\n        if (enemy.isVampiric && enemy.vampiricHealAmount && enemy.exists()) {\n            const currentHP = enemy.hp();\n            const maxHP = enemy.maxHealth;\n            if (currentHP < maxHP) {\n                const newHP = Math.min(maxHP, currentHP + enemy.vampiricHealAmount);\n                enemy.setHP(newHP);\n            }\n        }\n\n        // Thorns: reflect damage back to attacker\n        if (player.thornsPercent && player.thornsPercent > 0 && enemy.exists()) {\n            const thornsDamage = Math.floor(baseDamage * player.thornsPercent);\n            if (thornsDamage > 0) {\n                // If thorns ignores armor (from Retribution synergy), deal raw damage\n                if (player.thornsIgnoreArmor) {\n                    enemy.hurt(thornsDamage);\n                } else {\n                    // Normal thorns applies enemy's defense\n                    const reducedThornsDamage = Math.max(1, thornsDamage - (enemy.defense || 0));\n                    enemy.hurt(reducedThornsDamage);\n                }\n            }\n        }\n\n        // Knockback enemy away from player (player doesn't move)\n        const knockbackDir = k.vec2(\n            enemy.pos.x - player.pos.x,\n            enemy.pos.y - player.pos.y\n        );\n        const knockbackDist = knockbackDir.len();\n        if (knockbackDist > 0) {\n            const normalized = knockbackDir.unit();\n            const knockbackAmount = COMBAT_CONFIG.KNOCKBACK_ENEMY;\n            applySafeKnockback(k, enemy, normalized, knockbackAmount);\n        }\n\n        // Initial hit flash (will be overridden by immunity flash)\n        player.color = k.rgb(...COMBAT_CONFIG.HIT_COLOR);\n    });\n    \n    // Collision: Miniboss hits Player\n    k.onCollide('miniboss', 'player', (miniboss, player) => {\n        if (k.paused) return;\n\n        // Don't damage dead players\n        if (player.isDead || player.hp() <= 0) return;\n\n        // Check if player is invulnerable (immunity frames)\n        if (player.invulnerable) return;\n\n        // In multiplayer, only host processes damage\n        if (isMultiplayerActive() && !isHost()) {\n            // Client: show visual feedback only\n            playPlayerHit();\n            spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\n            player.color = k.rgb(255, 100, 100);\n            return;\n        }\n\n        // Host or singleplayer: process damage\n        // Check for dodge chance (The Scout ability)\n        if (player.dodgeChance && Math.random() < player.dodgeChance) {\n            // Dodged! No damage taken\n            // Broadcast dodge event for multiplayer\n            if (isMultiplayerActive() && isHost()) {\n                broadcastDodgeEvent({\n                    slotIndex: player.slotIndex,\n                    x: player.pos.x,\n                    y: player.pos.y\n                });\n            }\n            return;\n        }\n\n        // Play player hit sound and effects\n        playPlayerHit();\n        EffectPresets.playerHit();\n\n        // Minibosses deal more damage than regular enemies but less than bosses\n        // Melee miniboss deals melee damage, others use base damage\n        let baseDamage = COMBAT_CONFIG.BASE_MINIBOSS_DAMAGE;\n        if (miniboss.type === 'brute' || miniboss.type === 'berserker' || miniboss.type === 'guardian') {\n            if (miniboss.meleeDamage) {\n                baseDamage = miniboss.meleeDamage;\n            }\n        }\n        const finalDamage = calculateDamageAfterDefense(baseDamage, player.defense || 0, player.damageReduction || 0);\n        player.hurt(finalDamage);\n\n        // Update survivalist combat time (for out-of-combat regen)\n        if (player.survivalistEnabled) {\n            player.survivalistLastCombatTime = k.time();\n        }\n\n        // Set invulnerability frames (don't reset timer if already invulnerable)\n        if (!player.invulnerable) {\n            player.invulnerable = true;\n            player.invulnerableTime = player.invulnerableDuration;\n        }\n\n        // Spawn blood splatter particle effect for player\n        spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\n\n        // Thorns: reflect damage back to miniboss\n        if (player.thornsPercent && player.thornsPercent > 0 && miniboss.exists()) {\n            const thornsDamage = Math.floor(baseDamage * player.thornsPercent);\n            if (thornsDamage > 0) {\n                // If thorns ignores armor (from Retribution synergy), deal raw damage\n                if (player.thornsIgnoreArmor) {\n                    if (miniboss.takeDamage) {\n                        miniboss.takeDamage(thornsDamage);\n                    } else {\n                        miniboss.hurt(thornsDamage);\n                    }\n                } else {\n                    // Normal thorns applies miniboss's defense\n                    const reducedThornsDamage = Math.max(1, thornsDamage - (miniboss.defense || 0));\n                    if (miniboss.takeDamage) {\n                        miniboss.takeDamage(reducedThornsDamage);\n                    } else {\n                        miniboss.hurt(reducedThornsDamage);\n                    }\n                }\n            }\n        }\n\n        // Knockback miniboss away from player (player doesn't move)\n        const knockbackDir = k.vec2(\n            miniboss.pos.x - player.pos.x,\n            miniboss.pos.y - player.pos.y\n        );\n        const knockbackDist = knockbackDir.len();\n        if (knockbackDist > 0) {\n            const normalized = knockbackDir.unit();\n            const knockbackAmount = COMBAT_CONFIG.KNOCKBACK_MINIBOSS;\n            applySafeKnockback(k, miniboss, normalized, knockbackAmount);\n        }\n\n        // Visual feedback\n        player.color = k.rgb(255, 100, 100);\n    });\n\n    // Collision: Boss hits Player\n    k.onCollide('boss', 'player', (boss, player) => {\n        if (k.paused) return;\n\n        // Don't damage dead players\n        if (player.isDead || player.hp() <= 0) return;\n\n        // Check if player is invulnerable (immunity frames)\n        if (player.invulnerable) return;\n\n        // In multiplayer, only host processes damage\n        if (isMultiplayerActive() && !isHost()) {\n            // Client: show visual feedback only\n            playPlayerHit();\n            spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\n            player.color = k.rgb(255, 100, 100);\n            return;\n        }\n\n        // Host or singleplayer: process damage\n        // Check for dodge chance (The Scout ability)\n        if (player.dodgeChance && Math.random() < player.dodgeChance) {\n            // Dodged! No damage taken\n            // Broadcast dodge event for multiplayer\n            if (isMultiplayerActive() && isHost()) {\n                broadcastDodgeEvent({\n                    slotIndex: player.slotIndex,\n                    x: player.pos.x,\n                    y: player.pos.y\n                });\n            }\n            return;\n        }\n\n        // Play player hit sound and effects\n        playPlayerHit();\n        EffectPresets.playerHit();\n\n        // Bosses deal more damage\n        // Melee guardian deals melee damage, others use base damage\n        let baseDamage = COMBAT_CONFIG.BASE_BOSS_DAMAGE;\n        if (boss.type === 'twinGuardianMelee' && boss.meleeDamage) {\n            const enrageMultiplier = boss.enraged ? COMBAT_CONFIG.BOSS_ENRAGE_DAMAGE_MULTIPLIER : 1.0;\n            baseDamage = boss.meleeDamage * enrageMultiplier;\n        }\n\n        const finalDamage = calculateDamageAfterDefense(baseDamage, player.defense || 0, player.damageReduction || 0);\n        player.hurt(finalDamage);\n\n        // Update survivalist combat time (for out-of-combat regen)\n        if (player.survivalistEnabled) {\n            player.survivalistLastCombatTime = k.time();\n        }\n\n        // Set invulnerability frames (don't reset timer if already invulnerable)\n        if (!player.invulnerable) {\n            player.invulnerable = true;\n            player.invulnerableTime = player.invulnerableDuration;\n        }\n\n        // Spawn blood splatter particle effect for player\n        spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\n\n        // Thorns: reflect damage back to boss\n        if (player.thornsPercent && player.thornsPercent > 0 && boss.exists()) {\n            const thornsDamage = Math.floor(baseDamage * player.thornsPercent);\n            if (thornsDamage > 0) {\n                // If thorns ignores armor (from Retribution synergy), deal raw damage\n                if (player.thornsIgnoreArmor) {\n                    if (boss.takeDamage) {\n                        boss.takeDamage(thornsDamage);\n                    } else {\n                        boss.hurt(thornsDamage);\n                    }\n                } else {\n                    // Normal thorns applies boss's defense\n                    const reducedThornsDamage = Math.max(1, thornsDamage - (boss.defense || 0));\n                    if (boss.takeDamage) {\n                        boss.takeDamage(reducedThornsDamage);\n                    } else {\n                        boss.hurt(reducedThornsDamage);\n                    }\n                }\n            }\n        }\n\n        // Knockback boss away from player (player doesn't move)\n        const knockbackDir = k.vec2(\n            boss.pos.x - player.pos.x,\n            boss.pos.y - player.pos.y\n        );\n        const knockbackDist = knockbackDir.len();\n        if (knockbackDist > 0) {\n            const normalized = knockbackDir.unit();\n            const knockbackAmount = COMBAT_CONFIG.KNOCKBACK_BOSS;\n            applySafeKnockback(k, boss, normalized, knockbackAmount);\n        }\n\n        // Initial hit flash (will be overridden by immunity flash)\n        player.color = k.rgb(255, 100, 100);\n    });\n\n    // Collision: Enemy/Boss Projectile hits Player\n    k.onCollide('projectile', 'player', (projectile, player) => {\n        if (k.paused) return;\n\n        // Only enemy/boss projectiles can hit player (player projectiles are handled separately)\n        if (!projectile.isBossProjectile && !projectile.isEnemyProjectile) return;\n\n        // Don't damage dead players\n        if (player.isDead || player.hp() <= 0) return;\n\n        // Check if player is invulnerable (immunity frames)\n        if (player.invulnerable) return;\n\n        // In multiplayer, only host processes damage\n        if (isMultiplayerActive() && !isHost()) {\n            // Client: show visual feedback only\n            playPlayerHit();\n            spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\n            player.color = k.rgb(255, 100, 100);\n            k.destroy(projectile);\n            return;\n        }\n\n        // Host or singleplayer: process damage\n        // Check for dodge chance (The Scout ability)\n        if (player.dodgeChance && Math.random() < player.dodgeChance) {\n            // Dodged! No damage taken\n            k.destroy(projectile);\n            return;\n        }\n\n        // Play player hit sound and effects\n        playPlayerHit();\n        EffectPresets.playerHit();\n\n        // Apply damage with damage reduction (The Tank ability)\n        const damageAfterReduction = projectile.damage * (1 - (player.damageReduction || 0));\n        const finalDamage = Math.max(1, damageAfterReduction - (player.defense || 0));\n        player.hurt(finalDamage);\n\n        // Set invulnerability frames (don't reset timer if already invulnerable)\n        if (!player.invulnerable) {\n            player.invulnerable = true;\n            player.invulnerableTime = player.invulnerableDuration;\n        }\n\n        // Spawn blood splatter particle effect for player\n        spawnBloodSplatter(k, player.pos.x, player.pos.y, { color: [255, 100, 100] });\n\n        // Destroy projectile\n        k.destroy(projectile);\n        \n        // Initial hit flash (will be overridden by immunity flash)\n        player.color = k.rgb(255, 100, 100);\n    });\n    \n    // Collision: Orbital hits Enemy\n    k.onCollide('orbital', 'enemy', (orb, enemy) => {\n        if (k.paused) return;\n        if (!enemy.exists()) return;\n\n        // Check contact cooldown\n        if (orb.contactCooldown > 0) return;\n\n        // In multiplayer, only host deals damage\n        if (isMultiplayerActive() && !isHost()) {\n            // Client: visual feedback only, skip damage\n            orb.contactCooldown = orb.contactCooldownDuration || 0.2;\n            return;\n        }\n\n        // Host or singleplayer: deal damage\n        enemy.hurt(orb.damage);\n\n        // Set contact cooldown\n        orb.contactCooldown = orb.contactCooldownDuration || 0.2;\n    });\n    \n    // Collision: Orbital hits Boss\n    k.onCollide('orbital', 'boss', (orb, boss) => {\n        if (k.paused) return;\n        if (!boss.exists()) return;\n\n        // Check contact cooldown\n        if (orb.contactCooldown > 0) return;\n\n        // In multiplayer, only host deals damage\n        if (isMultiplayerActive() && !isHost()) {\n            // Client: visual feedback only, skip damage\n            orb.contactCooldown = orb.contactCooldownDuration || 0.2;\n            return;\n        }\n\n        // Host or singleplayer: deal damage\n        // Deal damage using boss's takeDamage method\n        if (boss.takeDamage) {\n            boss.takeDamage(orb.damage);\n        } else {\n            boss.hurt(orb.damage);\n        }\n\n        // Set contact cooldown\n        orb.contactCooldown = orb.contactCooldownDuration || 0.2;\n    });\n}\n\n// Initialize orbital weapons\nfunction initializeOrbitalWeapons(k, player) {\n    // Clean up any existing orbs first to prevent accumulation\n    if (player.orbitalOrbs && player.orbitalOrbs.length > 0) {\n        player.orbitalOrbs.forEach(orb => {\n            if (orb && orb.exists()) k.destroy(orb);\n        });\n    }\n\n    // Reset arrays\n    player.orbitalOrbs = [];\n    player.orbitalAngles = [];\n\n    const orbCount = player.projectileCount || 1;\n    const orbitRadius = player.orbitRadius || WEAPON_CONFIG.BASE_ORBIT_RADIUS;\n\n    // Create initial orbs\n    for (let i = 0; i < orbCount; i++) {\n        const angle = (360 / orbCount) * i; // Evenly space orbs\n        const rad = (angle * Math.PI) / 180;\n        const x = player.pos.x + Math.cos(rad) * orbitRadius;\n        const y = player.pos.y + Math.sin(rad) * orbitRadius;\n        \n        const orb = k.add([\n            k.text(player.weaponDef?.char || '', { size: 16 }),\n            k.pos(x, y),\n            k.anchor('center'),\n            k.color(...(player.weaponDef?.color || [100, 200, 255])),\n            k.area(),\n            'orbital',\n            'playerProjectile' // So it can damage enemies\n        ]);\n        \n        orb.damage = player.projectileDamage || 12;\n        orb.contactCooldown = 0; // Cooldown to prevent multiple hits per frame\n        orb.contactCooldownDuration = WEAPON_CONFIG.ORBITAL_CONTACT_COOLDOWN;\n        \n        player.orbitalOrbs.push(orb);\n        player.orbitalAngles.push(angle);\n    }\n}\n\n// Update orbital weapons rotation\nfunction updateOrbitalWeapons(k, player) {\n    // Reinitialize if needed (e.g., after upgrade)\n    if (player.orbitalNeedsReinit) {\n        // Clean up old orbs\n        if (player.orbitalOrbs) {\n            player.orbitalOrbs.forEach(orb => {\n                if (orb.exists()) orb.destroy();\n            });\n        }\n        player.orbitalOrbs = [];\n        player.orbitalAngles = [];\n        initializeOrbitalWeapons(k, player);\n        player.orbitalNeedsReinit = false;\n    }\n    \n    // Reinitialize if orbs are missing or count changed\n    const expectedOrbCount = player.projectileCount || 1;\n    if (!player.orbitalOrbs || player.orbitalOrbs.length !== expectedOrbCount) {\n        initializeOrbitalWeapons(k, player);\n    }\n    \n    if (!player.orbitalOrbs || !player.orbitalAngles) return;\n\n    const rotationSpeed = player.rotationSpeed || WEAPON_CONFIG.BASE_ROTATION_SPEED;\n    const orbitRadius = player.orbitRadius || WEAPON_CONFIG.BASE_ORBIT_RADIUS;\n    \n    // Update each orb\n    player.orbitalOrbs.forEach((orb, index) => {\n        if (!orb.exists()) return;\n        \n        // Update angle\n        player.orbitalAngles[index] = (player.orbitalAngles[index] + rotationSpeed * k.dt()) % 360;\n        const rad = (player.orbitalAngles[index] * Math.PI) / 180;\n        \n        // Update position\n        orb.pos.x = player.pos.x + Math.cos(rad) * orbitRadius;\n        orb.pos.y = player.pos.y + Math.sin(rad) * orbitRadius;\n        \n        // Update contact cooldown\n        if (orb.contactCooldown > 0) {\n            orb.contactCooldown -= k.dt();\n        }\n    });\n    \n    // Clean up destroyed orbs\n    player.orbitalOrbs = player.orbitalOrbs.filter(orb => orb.exists());\n    // Re-sync angles array if orbs were removed\n    if (player.orbitalOrbs.length !== player.orbitalAngles.length) {\n        player.orbitalAngles = player.orbitalAngles.slice(0, player.orbitalOrbs.length);\n    }\n}\n\n// Create explosive projectile\nfunction createExplosiveProjectile(k, x, y, direction, speed, damage, explosionRadius, explosionDamage, maxRange, isCrit = false) {\n    const projectile = createProjectile(k, x, y, direction, speed, damage, 0, 0, isCrit, maxRange);\n    projectile.isExplosive = true;\n    projectile.explosionRadius = explosionRadius || 50;\n    projectile.explosionDamage = explosionDamage || 15;\n\n    return projectile;\n}\n\n// Create chain lightning projectile\nfunction createChainProjectile(k, x, y, direction, speed, damage, chainRange, maxJumps, damageReduction, maxRange, isCrit = false) {\n    const projectile = createProjectile(k, x, y, direction, speed, damage, 0, 0, isCrit, maxRange);\n    projectile.isChainLightning = true;\n    projectile.chainRange = chainRange || 70;\n    projectile.maxJumps = maxJumps || 3;\n    projectile.chainDamageReduction = damageReduction || 0.15;\n    projectile.chainJumps = 0;\n    projectile.chainedEnemies = new Set(); // Track which enemies have been hit\n\n    return projectile;\n}\n\n// Explode projectile and deal area damage\nfunction explodeProjectile(k, projectile, x, y) {\n    if (!projectile.exists()) return;\n\n    // Play explosion sound and effects\n    playExplosion();\n    EffectPresets.explosion();\n\n    const explosionRadius = projectile.explosionRadius || 50;\n    const explosionDamage = projectile.explosionDamage || 15;\n\n    // Only host deals damage in multiplayer\n    if (!isMultiplayerActive() || isHost()) {\n        // Damage all enemies in radius\n        const enemies = k.get('enemy');\n        const bosses = k.get('boss');\n        const allTargets = [...enemies, ...bosses];\n\n        for (const target of allTargets) {\n            if (!target.exists()) continue;\n\n            const dist = k.vec2(\n                target.pos.x - x,\n                target.pos.y - y\n            ).len();\n\n            if (dist <= explosionRadius) {\n                if (target.takeDamage) {\n                    // Boss with armor system\n                    target.takeDamage(explosionDamage);\n                } else {\n                    // Regular enemy\n                    target.hurt(explosionDamage);\n                }\n            }\n        }\n    }\n    \n    // Visual explosion effect\n    const explosionText = k.add([\n        k.text('*', { size: 24 }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(255, 200, 0),\n        k.z(200)\n    ]);\n    k.wait(0.2, () => {\n        if (explosionText.exists()) k.destroy(explosionText);\n    });\n    \n    // Destroy projectile\n    k.destroy(projectile);\n}\n\n// Chain lightning to next enemy\nfunction chainToNextEnemy(k, projectile, currentEnemy) {\n    if (!projectile.exists()) return;\n    \n    const chainRange = projectile.chainRange || 70;\n    const enemies = k.get('enemy');\n    const bosses = k.get('boss');\n    const allTargets = [...enemies, ...bosses];\n    \n    // Find nearest enemy within chain range that hasn't been hit\n    let nearestEnemy = null;\n    let nearestDist = chainRange;\n    \n    for (const target of allTargets) {\n        if (!target.exists() || target === currentEnemy) continue;\n        if (projectile.chainedEnemies && projectile.chainedEnemies.has(target)) continue;\n        \n        const dist = k.vec2(\n            target.pos.x - currentEnemy.pos.x,\n            target.pos.y - currentEnemy.pos.y\n        ).len();\n        \n        if (dist <= chainRange && dist < nearestDist) {\n            nearestEnemy = target;\n            nearestDist = dist;\n        }\n    }\n    \n    if (nearestEnemy) {\n        // Chain to next enemy\n        projectile.chainJumps = (projectile.chainJumps || 0) + 1;\n        \n        // Visual chain effect - use a thin rotated rectangle as a line\n        const startPos = currentEnemy.pos;\n        const endPos = nearestEnemy.pos;\n        const distance = k.vec2(endPos.x - startPos.x, endPos.y - startPos.y).len();\n        const angle = Math.atan2(endPos.y - startPos.y, endPos.x - startPos.x);\n        const midX = (startPos.x + endPos.x) / 2;\n        const midY = (startPos.y + endPos.y) / 2;\n        \n        const chainLine = k.add([\n            k.rect(distance, 2), // Thin rectangle as line\n            k.pos(midX, midY),\n            k.anchor('center'),\n            k.rotate(angle),\n            k.color(255, 255, 100),\n            k.z(150)\n        ]);\n        k.wait(0.1, () => {\n            if (chainLine.exists()) k.destroy(chainLine);\n        });\n        \n        // Teleport projectile to next enemy position to trigger collision\n        projectile.pos.x = nearestEnemy.pos.x;\n        projectile.pos.y = nearestEnemy.pos.y;\n        \n        // The collision handler will be triggered automatically\n    } else {\n        // No more enemies in range, destroy projectile\n        k.destroy(projectile);\n    }\n}\n\n","/**\n * Tutorial System\n *\n * Shows helpful hints to new players on first occurrence.\n * Hints are stored in localStorage and only shown once.\n */\n\n// Tutorial hint definitions\nconst TUTORIAL_HINTS = {\n    movement: {\n        id: 'movement',\n        message: 'Use WASD to move',\n        duration: 3,\n        trigger: 'firstMove' // Triggered on game start\n    },\n    shooting: {\n        id: 'shooting',\n        message: 'Aim with mouse - autofire!',\n        duration: 3,\n        trigger: 'firstShoot' // Triggered when player starts shooting\n    },\n    levelUp: {\n        id: 'levelUp',\n        message: 'Choose upgrade with 1-3 or click',\n        duration: 4,\n        trigger: 'firstLevelUp' // Triggered on first level up\n    },\n    synergy: {\n        id: 'synergy',\n        message: 'Combine upgrades for bonuses!',\n        duration: 4,\n        trigger: 'firstSynergy' // Triggered when synergy is first activated\n    },\n    shop: {\n        id: 'shop',\n        message: 'Spend credits on permanent upgrades',\n        duration: 4,\n        trigger: 'firstShopVisit' // Triggered when visiting shop\n    }\n};\n\n// Storage key for tutorial progress\nconst TUTORIAL_STORAGE_KEY = 'superSmashTexty_tutorialProgress';\n\n// Currently displayed hint (to prevent duplicates)\nlet currentHint = null;\n\n/**\n * Load tutorial progress from localStorage\n * @returns {Object} Tutorial progress with hintsShown array\n */\nexport function loadTutorialProgress() {\n    try {\n        const stored = localStorage.getItem(TUTORIAL_STORAGE_KEY);\n        if (stored) {\n            return JSON.parse(stored);\n        }\n    } catch (e) {\n        console.warn('Failed to load tutorial progress:', e);\n    }\n\n    return { hintsShown: [] };\n}\n\n/**\n * Save tutorial progress to localStorage\n * @param {Object} progress - Tutorial progress to save\n */\nfunction saveTutorialProgress(progress) {\n    try {\n        localStorage.setItem(TUTORIAL_STORAGE_KEY, JSON.stringify(progress));\n    } catch (e) {\n        console.warn('Failed to save tutorial progress:', e);\n    }\n}\n\n/**\n * Check if a hint has been shown before\n * @param {string} hintId - Hint identifier\n * @returns {boolean} Whether the hint has been shown\n */\nexport function hasHintBeenShown(hintId) {\n    const progress = loadTutorialProgress();\n    return progress.hintsShown.includes(hintId);\n}\n\n/**\n * Mark a hint as shown\n * @param {string} hintId - Hint identifier\n */\nfunction markHintShown(hintId) {\n    const progress = loadTutorialProgress();\n    if (!progress.hintsShown.includes(hintId)) {\n        progress.hintsShown.push(hintId);\n        saveTutorialProgress(progress);\n    }\n}\n\n/**\n * Show a tutorial hint if it hasn't been shown before\n * @param {object} k - KAPLAY instance\n * @param {string} hintId - Hint identifier\n * @returns {boolean} Whether the hint was shown\n */\nexport function showHint(k, hintId) {\n    // Don't show if already showing a hint\n    if (currentHint) return false;\n\n    // Don't show if already shown before\n    if (hasHintBeenShown(hintId)) return false;\n\n    const hint = TUTORIAL_HINTS[hintId];\n    if (!hint) return false;\n\n    // Mark as shown\n    markHintShown(hintId);\n\n    // Create hint display\n    const hintBg = k.add([\n        k.rect(300, 40),\n        k.pos(k.width() / 2, 50),\n        k.anchor('center'),\n        k.color(0, 0, 0),\n        k.opacity(0.8),\n        k.fixed(),\n        k.z(700),\n        'tutorialHint'\n    ]);\n\n    const hintText = k.add([\n        k.text(hint.message, { size: 16 }),\n        k.pos(k.width() / 2, 50),\n        k.anchor('center'),\n        k.color(255, 255, 200),\n        k.fixed(),\n        k.z(701),\n        'tutorialHint'\n    ]);\n\n    currentHint = { bg: hintBg, text: hintText };\n\n    // Fade out after duration\n    k.wait(hint.duration, () => {\n        if (hintBg.exists()) k.destroy(hintBg);\n        if (hintText.exists()) k.destroy(hintText);\n        currentHint = null;\n    });\n\n    return true;\n}\n\n/**\n * Show movement hint (called at game start)\n * @param {object} k - KAPLAY instance\n */\nexport function showMovementHint(k) {\n    showHint(k, 'movement');\n}\n\n/**\n * Show shooting hint (called when player first shoots)\n * @param {object} k - KAPLAY instance\n */\nexport function showShootingHint(k) {\n    showHint(k, 'shooting');\n}\n\n/**\n * Show level up hint (called on first level up)\n * @param {object} k - KAPLAY instance\n */\nexport function showLevelUpHint(k) {\n    showHint(k, 'levelUp');\n}\n\n/**\n * Show synergy hint (called when synergy activates)\n * @param {object} k - KAPLAY instance\n */\nexport function showSynergyHint(k) {\n    showHint(k, 'synergy');\n}\n\n/**\n * Show shop hint (called when visiting shop)\n * @param {object} k - KAPLAY instance\n */\nexport function showShopHint(k) {\n    showHint(k, 'shop');\n}\n\n/**\n * Reset tutorial progress (for testing)\n */\nexport function resetTutorialProgress() {\n    saveTutorialProgress({ hintsShown: [] });\n}\n\n/**\n * Clear any currently displayed hint\n * @param {object} k - KAPLAY instance\n */\nexport function clearCurrentHint(k) {\n    if (currentHint) {\n        if (currentHint.bg && currentHint.bg.exists()) k.destroy(currentHint.bg);\n        if (currentHint.text && currentHint.text.exists()) k.destroy(currentHint.text);\n        currentHint = null;\n    }\n}\n","// Synergy system - handles upgrade combinations and special effects\nimport { showSynergyHint } from './tutorial.js';\n\n// Synergy definitions\n// Each synergy requires specific upgrades and applies a special effect\nexport const SYNERGIES = {\n    // Multi-shot + Spread Shot = Wider spread pattern\n    shotgun: {\n        name: 'Shotgun Blast',\n        description: 'Multi-Shot + Spread Shot: Wider spread angle',\n        required: ['multiShot', 'spreadShot'],\n        apply: (player) => {\n            // Increase spread angle when both upgrades are present\n            if (player.spreadAngle > 0 && player.projectileCount > 1) {\n                player.spreadAngle = (player.spreadAngle || 0) * 1.5; // 50% wider spread\n            }\n        }\n    },\n    \n    // Piercing + Multi-shot = Multiple piercing projectiles\n    volley: {\n        name: 'Piercing Volley',\n        description: 'Piercing + Multi-Shot: All projectiles pierce',\n        required: ['piercing', 'multiShot'],\n        apply: (player) => {\n            // Ensure all projectiles from multi-shot have piercing\n            // This is already handled by the combat system, but we can add bonus\n            if (player.piercing > 0 && player.projectileCount > 1) {\n                player.piercing = (player.piercing || 0) + 1; // Bonus piercing\n            }\n        }\n    },\n    \n    // Crit Chance + Crit Damage = Enhanced critical system\n    criticalMaster: {\n        name: 'Critical Master',\n        description: 'Critical Strike + Critical Power: +25% crit chance, +100% crit damage',\n        required: ['critChance', 'critDamage'],\n        apply: (player) => {\n            if (player.critChance > 0 && player.critDamage > 2.0) {\n                player.critChance = (player.critChance || 0) + 0.25; // Bonus crit chance\n                player.critDamage = (player.critDamage || 2.0) + 1.0; // Bonus crit damage\n            }\n        }\n    },\n    \n    // Multi-shot + Fire Rate = Rapid multi-fire\n    barrage: {\n        name: 'Barrage',\n        description: 'Multi-Shot + Fire Rate: Faster multi-projectile firing',\n        required: ['multiShot', 'fireRate'],\n        apply: (player) => {\n            if (player.projectileCount > 1) {\n                player.fireRate = (player.fireRate || 1.5) * 1.3; // 30% faster fire rate\n            }\n        }\n    },\n    \n    // Piercing + Damage = Armor-piercing rounds\n    armorPiercing: {\n        name: 'Armor Piercing',\n        description: 'Piercing + Damage Boost: Piercing projectiles deal +50% damage',\n        required: ['piercing', 'damage'],\n        apply: (player) => {\n            if (player.piercing > 0) {\n                // Store bonus damage for piercing projectiles\n                player.piercingDamageBonus = 1.5; // 50% bonus\n            }\n        }\n    },\n    \n    // Defense + Health = Tank build\n    tank: {\n        name: 'Tank',\n        description: 'Armor + Max Health: +50% max health, +5 defense',\n        required: ['defense', 'health'],\n        apply: (player) => {\n            player.maxHealth = Math.floor(player.maxHealth * 1.5); // 50% more health\n            player.setHP(Math.floor(player.hp() * 1.5)); // Scale current HP too\n            player.defense = (player.defense || 0) + 5; // Bonus defense\n        }\n    },\n    \n    // Speed + Pickup Radius = Loot vacuum\n    vacuum: {\n        name: 'Loot Vacuum',\n        description: 'Movement Speed + Pickup Radius: +100% pickup radius',\n        required: ['speed', 'pickupRadius'],\n        apply: (player) => {\n            if (player.pickupRadius > 0) {\n                player.pickupRadius = Math.floor(player.pickupRadius * 2.0); // Double radius\n            }\n        }\n    },\n    \n    // XP Gain + Pickup Radius = XP magnet\n    xpMagnet: {\n        name: 'XP Magnet',\n        description: 'XP Gain + Pickup Radius: +50% XP multiplier',\n        required: ['xpGain', 'pickupRadius'],\n        apply: (player) => {\n            if (player.xpMultiplier) {\n                player.xpMultiplier = (player.xpMultiplier || 1) + 0.5; // 50% more XP\n            }\n        }\n    },\n\n    // NEW SYNERGIES\n\n    // Glass Canon: Trade health for massive damage\n    glassCannon: {\n        name: 'Glass Cannon',\n        description: 'Damage x3 + Health: -25% max HP, +100% damage',\n        required: ['damage', 'damage', 'damage', 'health'], // Requires 3x damage upgrades\n        requiredCounts: { damage: 3, health: 1 }, // Alternative counting method\n        apply: (player) => {\n            // Only apply if player has at least 3 damage upgrades\n            const damageStacks = player.upgradeStacks?.damage || 0;\n            if (damageStacks >= 3) {\n                // Reduce max HP by 25%\n                const newMaxHealth = Math.floor(player.maxHealth * 0.75);\n                player.maxHealth = newMaxHealth;\n\n                // Ensure player HP doesn't drop below 25% of new max (safety threshold)\n                // This prevents the synergy from leaving the player in a near-death state\n                const minSafeHP = Math.max(1, Math.floor(newMaxHealth * 0.25));\n                const newHP = Math.max(minSafeHP, Math.min(player.hp(), newMaxHealth));\n                player.setHP(newHP);\n\n                // Double damage (+100%)\n                player.projectileDamage = Math.floor(player.projectileDamage * 2);\n            }\n        }\n    },\n\n    // Vampiric Rounds: Heal on critical hits\n    vampiricRounds: {\n        name: 'Vampiric Rounds',\n        description: 'Crit Chance + Crit Damage + Health: Heal 5% of crit damage',\n        required: ['critChance', 'critDamage', 'health'],\n        apply: (player) => {\n            // Enable vampiric healing on crits\n            player.vampiricCrits = true;\n            player.vampiricHealPercent = 0.05; // 5% of crit damage healed\n        }\n    },\n\n    // Bullet Time: Faster fire rate while moving\n    bulletTime: {\n        name: 'Bullet Time',\n        description: 'Speed + Fire Rate: +20% fire rate while moving',\n        required: ['speed', 'fireRate'],\n        apply: (player) => {\n            // Enable bullet time effect\n            player.bulletTimeEnabled = true;\n            player.bulletTimeBonus = 0.2; // +20% fire rate while moving\n        }\n    },\n\n    // ========================================\n    // NEW SYNERGIES\n    // ========================================\n\n    // Berserker: Power boost at low health\n    berserker: {\n        name: 'Berserker',\n        description: 'Damage x3 + Speed x2: +50% damage/speed below 30% HP',\n        requiredCounts: { damage: 3, speed: 2 },\n        apply: (player) => {\n            player.berserkerEnabled = true;\n            player.berserkerThreshold = 0.3; // Below 30% HP\n            player.berserkerDamageBonus = 0.5; // +50% damage\n            player.berserkerSpeedBonus = 0.5; // +50% speed\n        }\n    },\n\n    // Deadeye: Extended crit range\n    deadeye: {\n        name: 'Deadeye',\n        description: 'Crit x2 + Range x2: Crits have +50% range',\n        requiredCounts: { critChance: 2, range: 2 },\n        apply: (player) => {\n            player.deadeyeEnabled = true;\n            player.deadeyeRangeBonus = 0.5; // +50% range on crits\n        }\n    },\n\n    // Survivalist: Out of combat regen\n    survivor: {\n        name: 'Survivalist',\n        description: 'Health x2 + Defense x2: Regen 1% HP/sec out of combat',\n        requiredCounts: { health: 2, defense: 2 },\n        apply: (player) => {\n            player.survivalistEnabled = true;\n            player.survivalistRegenPercent = 0.01; // 1% HP per second\n            player.survivalistCombatCooldown = 3.0; // 3 seconds out of combat\n            player.survivalistLastCombatTime = 0;\n        }\n    },\n\n    // Retribution: Thorns ignore armor\n    thornMaster: {\n        name: 'Retribution',\n        description: 'Thorns x3 + Defense x2: Thorns ignore enemy armor',\n        requiredCounts: { thorns: 3, defense: 2 },\n        apply: (player) => {\n            player.thornsIgnoreArmor = true;\n            // Also boost thorns damage by 50%\n            player.thornsPercent = (player.thornsPercent || 0) * 1.5;\n        }\n    },\n\n    // Vampire Lord: Enhanced lifesteal on crits\n    vampireLord: {\n        name: 'Vampire Lord',\n        description: 'Lifesteal x3 + Crit Dmg x2: Crits heal 3x lifesteal',\n        requiredCounts: { lifesteal: 3, critDamage: 2 },\n        apply: (player) => {\n            player.vampireLordEnabled = true;\n            player.vampireLordMultiplier = 3; // 3x lifesteal on crits\n        }\n    },\n\n    // Executioner: Execute low health enemies\n    executioner: {\n        name: 'Executioner',\n        description: 'Damage x2 + Piercing x2: +100% damage to enemies <25% HP',\n        requiredCounts: { damage: 2, piercing: 2 },\n        apply: (player) => {\n            player.executionerEnabled = true;\n            player.executionerThreshold = 0.25; // Below 25% HP\n            player.executionerDamageBonus = 1.0; // +100% damage\n        }\n    },\n\n    // Speed Demon: Fire rate scales with speed\n    speedDemon: {\n        name: 'Speed Demon',\n        description: 'Speed x3 + Fire Rate x2: +1% fire rate per speed stack',\n        requiredCounts: { speed: 3, fireRate: 2 },\n        apply: (player) => {\n            player.speedDemonEnabled = true;\n            player.speedDemonFireRatePerStack = 0.01; // +1% fire rate per speed stack\n        }\n    },\n\n    // Fortress: Complete immunity during invulnerability\n    fortress: {\n        name: 'Fortress',\n        description: 'Health x3 + Invuln x2: Immunity blocks all damage sources',\n        requiredCounts: { health: 3, invulnTime: 2 },\n        apply: (player) => {\n            player.fortressEnabled = true;\n            // Also extend invulnerability duration by 50%\n            player.invulnerableDuration = (player.invulnerableDuration || 1.0) * 1.5;\n        }\n    }\n};\n\n// Track player's selected upgrades\nexport function trackUpgrade(player, upgradeKey) {\n    if (!player.selectedUpgrades) {\n        player.selectedUpgrades = new Set();\n    }\n    player.selectedUpgrades.add(upgradeKey);\n}\n\n// Check and apply synergies\nexport function checkAndApplySynergies(k, player) {\n    if (!player.selectedUpgrades || player.selectedUpgrades.size < 2) {\n        return; // Need at least 2 upgrades for synergies\n    }\n\n    const activeSynergies = [];\n\n    // Check each synergy\n    for (const [synergyKey, synergy] of Object.entries(SYNERGIES)) {\n        let hasAllRequired = false;\n\n        // Check if synergy uses requiredCounts (for synergies needing multiple stacks of same upgrade)\n        if (synergy.requiredCounts) {\n            hasAllRequired = true;\n            for (const [upgradeKey, count] of Object.entries(synergy.requiredCounts)) {\n                const stacks = player.upgradeStacks?.[upgradeKey] || 0;\n                if (stacks < count) {\n                    hasAllRequired = false;\n                    break;\n                }\n            }\n        } else {\n            // Standard check - player has all required upgrades (any count)\n            hasAllRequired = synergy.required.every(upgradeKey =>\n                player.selectedUpgrades.has(upgradeKey)\n            );\n        }\n\n        if (hasAllRequired) {\n            // Check if synergy is already active (prevent double application)\n            if (!player.activeSynergies) {\n                player.activeSynergies = new Set();\n            }\n\n            if (!player.activeSynergies.has(synergyKey)) {\n                // Apply synergy effect\n                synergy.apply(player);\n                player.activeSynergies.add(synergyKey);\n                activeSynergies.push(synergy);\n\n                // Show tutorial hint for synergies\n                showSynergyHint(k);\n\n                // Show synergy notification\n                showSynergyNotification(k, synergy);\n            }\n        }\n    }\n\n    return activeSynergies;\n}\n\n// Show synergy notification\nfunction showSynergyNotification(k, synergy) {\n    const notification = k.add([\n        k.text(`SYNERGY: ${synergy.name}`, { size: 20 }),\n        k.pos(k.width() / 2, 150),\n        k.anchor('center'),\n        k.color(255, 200, 0), // Gold color for synergies\n        k.fixed(),\n        k.z(600)\n    ]);\n    \n    const desc = k.add([\n        k.text(synergy.description, { size: 14 }),\n        k.pos(k.width() / 2, 175),\n        k.anchor('center'),\n        k.color(200, 200, 100),\n        k.fixed(),\n        k.z(600)\n    ]);\n    \n    // Fade out after 3 seconds\n    k.wait(3, () => {\n        if (notification.exists()) {\n            k.destroy(notification);\n            k.destroy(desc);\n        }\n    });\n}\n\n// Get active synergies for a player\nexport function getActiveSynergies(player) {\n    if (!player.activeSynergies) {\n        return [];\n    }\n\n    return Array.from(player.activeSynergies).map(key => ({\n        key,\n        ...SYNERGIES[key]\n    }));\n}\n\n/**\n * Reapply all active synergies silently (for room transitions)\n * This should be called AFTER recalculateAllUpgrades() to restore synergy bonuses\n * that were overwritten by the upgrade recalculation.\n * @param {Object} player - The player entity\n */\nexport function reapplySynergies(player) {\n    if (!player.activeSynergies || player.activeSynergies.size === 0) {\n        return;\n    }\n\n    // Reapply each active synergy\n    for (const synergyKey of player.activeSynergies) {\n        const synergy = SYNERGIES[synergyKey];\n        if (synergy && synergy.apply) {\n            synergy.apply(player);\n        }\n    }\n}\n\n\n","// Upgrade draft UI scene\nimport { getRandomUpgrades, applyUpgrade, getUpgradeDescription } from '../systems/upgrades.js';\nimport { trackUpgrade, checkAndApplySynergies } from '../systems/synergies.js';\nimport { playUpgradeSelect } from '../systems/sounds.js';\nimport { isMultiplayerActive, getUpgradeRNG, broadcastUpgradeSelected, broadcastSynergyActivated } from '../systems/multiplayerGame.js';\nimport { getPermanentUpgradeLevel } from '../systems/metaProgression.js';\nimport {\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS\n} from '../config/uiConfig.js';\n\n// Track if upgrade draft is currently showing\nlet upgradeDraftActive = false;\n\nexport function showUpgradeDraft(k, player, onSelect, playerName = null, levelOverride = null, rerollsAvailable = null) {\n    // Don't show if already showing\n    if (upgradeDraftActive) return;\n\n    // Mark upgrade draft as active\n    upgradeDraftActive = true;\n\n    // Pause the game (but not in multiplayer mode)\n    const inMultiplayer = isMultiplayerActive();\n    if (!inMultiplayer) {\n        k.paused = true;\n    }\n\n    // Save tooltip state and hide it (accessed from k.gameData if available)\n    if (k.gameData && k.gameData.saveTooltipState && k.gameData.hideTooltip) {\n        k.gameData.tooltipSavedState = k.gameData.saveTooltipState();\n        k.gameData.hideTooltip();\n    }\n\n    // Save current minimap mode (accessed from k.gameData if available)\n    // Note: We just save the mode here - actual update happens AFTER overlay is created\n    // to hide any visual artifacts from the minimap redrawing\n    let minimapNeedsUpdate = false;\n    if (k.gameData && k.gameData.minimap) {\n        k.gameData.minimapSavedMode = k.gameData.minimap.mode;\n        // Mark that we need to update minimap after overlay is created\n        if (k.gameData.minimap.mode !== 'maximized') {\n            minimapNeedsUpdate = true;\n        }\n    }\n\n    // Get permanent upgrade levels for Tough Choices and Mulligan\n    const toughChoicesLevel = getPermanentUpgradeLevel('toughChoices');\n    const mulliganLevel = getPermanentUpgradeLevel('mulligan');\n\n    // Calculate number of upgrade options (base 3 + toughChoices level)\n    const numUpgradeOptions = 3 + toughChoicesLevel;\n\n    // Track rerolls remaining for this draft\n    // Use passed rerollsAvailable if provided (per-run persistence), otherwise fallback to mulliganLevel\n    let rerollsRemaining = rerollsAvailable !== null ? rerollsAvailable : mulliganLevel;\n    let rerollSeed = 0; // Increment each reroll for different results\n\n    // Get random upgrades (weapon-aware)\n    // In multiplayer, use seeded RNG for deterministic upgrade generation\n    // Use levelOverride if provided to ensure different upgrades for sequential level ups\n    function generateUpgrades() {\n        let upgradeRng = null;\n        if (isMultiplayerActive()) {\n            const playerIndex = player.playerIndex !== undefined ? player.playerIndex : 0;\n            const playerLevel = levelOverride || player.level || 1;\n            upgradeRng = getUpgradeRNG(playerIndex, playerLevel + rerollSeed * 100);\n        }\n        return getRandomUpgrades(numUpgradeOptions, player, upgradeRng);\n    }\n\n    let upgrades = generateUpgrades();\n\n    // Create overlay background FIRST with full opacity to immediately cover everything\n    // This prevents visual artifacts from minimap updates or other UI changes showing through\n    const overlay = k.add([\n        k.rect(k.width(), k.height()),\n        k.pos(0, 0),\n        k.anchor('topleft'),\n        k.color(...UI_COLORS.BG_DARK),\n        k.opacity(1.0), // Start fully opaque to hide any visual artifacts\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL),\n        'upgradeOverlay'\n    ]);\n\n    // Now update the minimap (after overlay is created to hide visual artifacts)\n    if (minimapNeedsUpdate && k.gameData && k.gameData.minimap) {\n        k.gameData.minimap.mode = 'maximized';\n        k.gameData.minimap.update();\n    }\n\n    // Fade overlay to target opacity after a brief moment (allows clean UI creation)\n    k.wait(0.05, () => {\n        if (overlay.exists()) {\n            overlay.opacity = 0.9;\n        }\n    });\n\n    // Title - show player name in multiplayer\n    const titleText = inMultiplayer && playerName\n        ? `${playerName} - Level Up! Choose an Upgrade`\n        : 'Level Up! Choose an Upgrade';\n    const title = k.add([\n        k.text(titleText, { size: UI_TEXT_SIZES.TITLE }),\n        k.pos(k.width() / 2, 80),\n        k.anchor('center'),\n        k.color(...UI_COLORS.WARNING),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 1),\n        'upgradeUI'\n    ]);\n\n    // Function to create upgrade cards (called on initial and reroll)\n    function createUpgradeCards() {\n        // Clear existing cards\n        k.get('upgradeCard').forEach(obj => k.destroy(obj));\n\n        // Dynamic card sizing based on number of options\n        const baseCardWidth = 200;\n        const baseCardHeight = 150;\n        const maxTotalWidth = k.width() - 40; // Leave margins\n\n        // Calculate card size and spacing based on number of upgrades\n        let cardWidth, cardHeight, spacing;\n        if (upgrades.length <= 3) {\n            cardWidth = baseCardWidth;\n            cardHeight = baseCardHeight;\n            spacing = 250;\n        } else if (upgrades.length <= 5) {\n            cardWidth = 160;\n            cardHeight = 130;\n            spacing = 180;\n        } else {\n            // For 6+ cards, scale down further\n            const availableWidth = maxTotalWidth / upgrades.length;\n            cardWidth = Math.min(140, availableWidth - 10);\n            cardHeight = 120;\n            spacing = cardWidth + 10;\n        }\n\n        const startX = k.width() / 2 - (spacing * (upgrades.length - 1)) / 2;\n        const cardY = k.height() / 2;\n\n        const cards = [];\n\n        upgrades.forEach((upgrade, index) => {\n            const cardX = startX + (index * spacing);\n\n            // Card background\n            const cardBg = k.add([\n                k.rect(cardWidth, cardHeight),\n                k.pos(cardX, cardY),\n                k.anchor('center'),\n                k.color(...UI_COLORS.BG_MEDIUM),\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 1),\n                k.area(),\n                'upgradeUI',\n                'upgradeCard'\n            ]);\n\n            // Upgrade icon (scale based on card size)\n            const iconSize = cardWidth <= 140 ? 32 : 48;\n            if (upgrade.icon) {\n                const iconColor = upgrade.category === 'passive'\n                    ? UI_COLORS.SUCCESS\n                    : (upgrade.weaponKey ? UI_COLORS.WARNING : UI_COLORS.INFO);\n\n                k.add([\n                    k.text(upgrade.icon, { size: iconSize }),\n                    k.pos(cardX, cardY - cardHeight/3),\n                    k.anchor('center'),\n                    k.color(...iconColor),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.MODAL + 2),\n                    'upgradeUI',\n                    'upgradeCard'\n                ]);\n            }\n\n            // Upgrade name (scale text size based on card width)\n            const nameSize = cardWidth <= 140 ? 12 : UI_TEXT_SIZES.BUTTON;\n            k.add([\n                k.text(upgrade.name, { size: nameSize, width: cardWidth - 10 }),\n                k.pos(cardX, cardY - 5),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_PRIMARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 2),\n                'upgradeUI',\n                'upgradeCard'\n            ]);\n\n            // Upgrade description (scale text size based on card width)\n            const descSize = cardWidth <= 140 ? 10 : UI_TEXT_SIZES.BODY;\n            const description = getUpgradeDescription(upgrade, player);\n            k.add([\n                k.text(description, { size: descSize, width: cardWidth - 10 }),\n                k.pos(cardX, cardY + 25),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 2),\n                'upgradeUI',\n                'upgradeCard'\n            ]);\n\n            // Selection number (top-right corner of card)\n            const numSize = cardWidth <= 140 ? 14 : UI_TEXT_SIZES.HEADER;\n            k.add([\n                k.text(`${index + 1}`, { size: numSize }),\n                k.pos(cardX + cardWidth / 2 - 15, cardY - cardHeight / 2 + 12),\n                k.anchor('center'),\n                k.color(...UI_COLORS.WARNING),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 2),\n                'upgradeUI',\n                'upgradeCard'\n            ]);\n\n            cards.push({\n                card: cardBg,\n                upgrade: upgrade,\n                index: index\n            });\n\n            // Make card clickable\n            cardBg.onClick(() => {\n                if (!upgradeDraftActive) return;\n                selectUpgrade(index);\n            });\n        });\n\n        return cards;\n    }\n\n    // Create initial cards\n    let cards = createUpgradeCards();\n\n    // Create reroll button if player has rerolls\n    let rerollText = null;\n    if (mulliganLevel > 0) {\n        const rerollButton = k.add([\n            k.rect(120, 35),\n            k.pos(k.width() / 2, k.height() - 60),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_MEDIUM),\n            k.outline(2, k.rgb(...UI_COLORS.WARNING)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1),\n            k.area(),\n            'upgradeUI'\n        ]);\n\n        // Using parentheses instead of square brackets to avoid KAPLAY styled text tag parsing\n        rerollText = k.add([\n            k.text(`(R) Reroll (${rerollsRemaining})`, { size: 14 }),\n            k.pos(k.width() / 2, k.height() - 60),\n            k.anchor('center'),\n            k.color(...UI_COLORS.WARNING),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 2),\n            'upgradeUI'\n        ]);\n\n        rerollButton.onClick(() => {\n            if (upgradeDraftActive && rerollsRemaining > 0) {\n                performReroll();\n            }\n        });\n    }\n\n    // Reroll function\n    function performReroll() {\n        if (rerollsRemaining <= 0) return;\n\n        rerollsRemaining--;\n        rerollSeed++;\n        upgrades = generateUpgrades();\n        cards = createUpgradeCards();\n\n        // Update reroll button text\n        if (rerollText && rerollText.exists()) {\n            rerollText.text = `(R) Reroll (${rerollsRemaining})`;\n            if (rerollsRemaining === 0) {\n                rerollText.color = k.rgb(...UI_COLORS.TEXT_SECONDARY);\n            }\n        }\n    }\n    \n    // Selection function\n    function selectUpgrade(index) {\n        if (!upgradeDraftActive) return; // Prevent double-selection\n\n        const selected = upgrades[index];\n\n        // Play upgrade selection sound\n        playUpgradeSelect();\n\n        // Mark upgrade draft as inactive first to prevent re-entry\n        upgradeDraftActive = false;\n\n        // Note: Key handlers don't need to be removed - they check upgradeDraftActive flag\n        // and will return early if the draft is not active\n\n        // Apply upgrade\n        applyUpgrade(player, selected.key);\n\n        // Track upgrade for synergies\n        trackUpgrade(player, selected.key);\n\n        // Check and apply synergies\n        const activatedSynergies = checkAndApplySynergies(k, player);\n\n        // Broadcast upgrade selection in multiplayer\n        if (isMultiplayerActive() && player.slotIndex !== undefined) {\n            broadcastUpgradeSelected(player.slotIndex, selected.key);\n\n            // Broadcast synergy activation if any synergies were activated\n            if (activatedSynergies && activatedSynergies.length > 0) {\n                const synergyNames = activatedSynergies.map(s => s.name);\n                broadcastSynergyActivated(player.slotIndex, synergyNames);\n            }\n        }\n\n        // Remove UI\n        k.get('upgradeUI').forEach(obj => k.destroy(obj));\n        k.get('upgradeOverlay').forEach(obj => k.destroy(obj));\n\n        // Restore minimap mode\n        if (k.gameData && k.gameData.minimap && k.gameData.minimapSavedMode !== undefined) {\n            k.gameData.minimap.mode = k.gameData.minimapSavedMode;\n            k.gameData.minimap.update();\n            k.gameData.minimapSavedMode = undefined;\n        }\n\n        // Unpause game (unless in multiplayer - game should stay unpaused)\n        if (!inMultiplayer) {\n            k.paused = false;\n        }\n\n        // Restore tooltip state after unpausing\n        if (k.gameData && k.gameData.restoreTooltipState && k.gameData.tooltipSavedState) {\n            k.gameData.restoreTooltipState(k.gameData.tooltipSavedState);\n            k.gameData.tooltipSavedState = undefined;\n        }\n        \n        // Callback (call after unpausing)\n        // Pass remaining rerolls so game state can be updated for per-run persistence\n        k.wait(0.1, () => {\n            if (onSelect) {\n                onSelect(selected, rerollsRemaining);\n            }\n        });\n    }\n    \n    // Keyboard selection (1-9, 0 for 10)\n    k.onKeyPress('1', () => {\n        if (upgradeDraftActive && upgrades.length >= 1) selectUpgrade(0);\n    });\n    k.onKeyPress('2', () => {\n        if (upgradeDraftActive && upgrades.length >= 2) selectUpgrade(1);\n    });\n    k.onKeyPress('3', () => {\n        if (upgradeDraftActive && upgrades.length >= 3) selectUpgrade(2);\n    });\n    k.onKeyPress('4', () => {\n        if (upgradeDraftActive && upgrades.length >= 4) selectUpgrade(3);\n    });\n    k.onKeyPress('5', () => {\n        if (upgradeDraftActive && upgrades.length >= 5) selectUpgrade(4);\n    });\n    k.onKeyPress('6', () => {\n        if (upgradeDraftActive && upgrades.length >= 6) selectUpgrade(5);\n    });\n    k.onKeyPress('7', () => {\n        if (upgradeDraftActive && upgrades.length >= 7) selectUpgrade(6);\n    });\n    k.onKeyPress('8', () => {\n        if (upgradeDraftActive && upgrades.length >= 8) selectUpgrade(7);\n    });\n    k.onKeyPress('9', () => {\n        if (upgradeDraftActive && upgrades.length >= 9) selectUpgrade(8);\n    });\n    k.onKeyPress('0', () => {\n        if (upgradeDraftActive && upgrades.length >= 10) selectUpgrade(9);\n    });\n\n    // Reroll key handler\n    k.onKeyPress('r', () => {\n        if (upgradeDraftActive && rerollsRemaining > 0) {\n            performReroll();\n        }\n    });\n}\n\n// Export function to check if upgrade draft is active (for pause menu)\nexport function isUpgradeDraftActive() {\n    return upgradeDraftActive;\n}\n\n","/**\n * Progression System\n *\n * Handles player progression mechanics:\n * - XP gain and multipliers\n * - Level up calculations and scaling\n * - Upgrade draft triggering on level up\n * - Visual feedback for level ups\n * - XP scaling per level\n */\n\n// Scene imports\nimport { showUpgradeDraft } from '../scenes/upgradeDraft.js';\n\n// Configuration imports\nimport { PROGRESSION_CONFIG } from '../config/constants.js';\n\n// Sound system imports\nimport { playLevelUp } from './sounds.js';\n\n// Multiplayer imports\nimport { broadcastLevelUpQueued, isHost } from './multiplayerGame.js';\n\n// Settings import\nimport { getSetting } from './settings.js';\n\nexport function setupProgressionSystem(k, player, reviveAllPlayersCallback = null, isMultiplayer = false) {\n    let levelUpInProgress = false;\n\n    // Track pending level ups for multiplayer (queue them for after room clear)\n    player.pendingLevelUps = player.pendingLevelUps || [];\n\n    // Add XP to player\n    player.addXP = function(amount) {\n        if (k.paused || levelUpInProgress) return; // Don't add XP while paused or leveling up\n\n        // Apply XP multiplier if it exists\n        const multiplier = player.xpMultiplier || 1;\n        const adjustedAmount = Math.floor(amount * multiplier);\n\n        player.xp += adjustedAmount;\n\n        // Check for level up (with safety bounds to prevent infinite loops)\n        while (player.xp >= player.xpToNext && !levelUpInProgress && player.xpToNext > 0) {\n            levelUpInProgress = true;\n            player.xp -= player.xpToNext;\n            player.level++;\n            const newLevel = player.level;\n            // Safety clamp: ensure xpToNext is always at least 1\n            player.xpToNext = Math.max(1, Math.floor(player.xpToNext * PROGRESSION_CONFIG.XP_SCALING_FACTOR));\n\n            // Show level up notification and draft directly\n            handleLevelUp(k, player, newLevel);\n        }\n    };\n\n    // Handle level up\n    function handleLevelUp(k, player, level) {\n        // Don't process if already paused (prevents issues)\n        if (k.paused && !isMultiplayer) {\n            levelUpInProgress = false;\n            return;\n        }\n\n        // Play level up sound\n        playLevelUp();\n\n        // Note: Revives now only happen on room completion, not on level up\n\n        // Show level up notification\n        const notification = k.add([\n            k.text(`Level ${level}!`, { size: 24 }),\n            k.pos(k.width() / 2, PROGRESSION_CONFIG.LEVEL_UP_NOTIFICATION_Y),\n            k.anchor('center'),\n            k.color(255, 255, 100),\n            k.fixed(),\n            k.z(1000) // High z-index to show above other UI\n        ]);\n\n        // In multiplayer: queue locally and broadcast to sync with others\n        if (isMultiplayer && player.slotIndex !== undefined) {\n            // Broadcast to notify everyone\n            broadcastLevelUpQueued(player.slotIndex, level);\n\n            // Both host and client queue locally for their own player\n            player.pendingLevelUps.push(level);\n        } else {\n            // Single player: queue locally\n            player.pendingLevelUps.push(level);\n\n            // Auto-pause on level up if setting is enabled (single player only)\n            const autoPause = getSetting('gameplay', 'autoPause');\n            if (autoPause && !k.paused) {\n                // Mark that auto-pause is handling this level up\n                // This prevents the notification timeout from clearing levelUpInProgress\n                const autoPauseHandlingThis = true;\n\n                // Short delay to let the notification show, then pause and show upgrade draft\n                k.wait(0.3, () => {\n                    // Only proceed if still not paused and we have pending level ups\n                    if (!k.paused && player.pendingLevelUps.length > 0) {\n                        k.paused = true;\n                        levelUpInProgress = true; // Ensure flag is set for upgrade draft\n                        // Immediately show upgrade draft\n                        const pendingLevel = player.pendingLevelUps.shift();\n                        showUpgradeDraft(k, player, () => {\n                            levelUpInProgress = false;\n                            k.paused = false;\n                        }, null, pendingLevel);\n                    }\n                });\n\n                // Clean up notification but don't touch levelUpInProgress (auto-pause handles it)\n                k.wait(PROGRESSION_CONFIG.LEVEL_UP_NOTIFICATION_DURATION, () => {\n                    if (notification.exists()) k.destroy(notification);\n                    // Don't set levelUpInProgress = false here - auto-pause callback handles it\n                });\n                return; // Skip the normal notification timeout below\n            }\n        }\n\n        k.wait(PROGRESSION_CONFIG.LEVEL_UP_NOTIFICATION_DURATION, () => {\n            if (notification.exists()) k.destroy(notification);\n            levelUpInProgress = false;\n        });\n    }\n\n    // Return function to manually trigger upgrade selection\n    return {\n        processPendingLevelUp: () => {\n            if (player.pendingLevelUps.length > 0 && !levelUpInProgress) {\n                levelUpInProgress = true;\n                const level = player.pendingLevelUps.shift(); // Take first pending level\n                const playerName = player.playerName || (player.isRemote ? `Player ${player.slotIndex + 1}` : 'You');\n                showUpgradeDraft(k, player, () => {\n                    levelUpInProgress = false;\n                }, isMultiplayer ? playerName : null, level);\n            }\n        }\n    };\n}\n\n","/**\n * Enemy Spawn System\n *\n * Handles enemy selection and spawning logic:\n * - Weighted random selection based on floor\n * - Floor-specific enemy pools (5 per floor)\n * - Progressive difficulty (enemies get harder each floor)\n * - Balanced variety within each floor\n * - Mix of different enemy types and behaviors\n */\n\n// Enemy spawn weights by floor\n// Each floor has 5 enemy types with different weights\nconst ENEMY_SPAWN_WEIGHTS = {\n    1: {\n        rusher: 25,    // Basic Rusher \n        shooter: 20,   // Basic Shooter \n        zombie: 20,    // Zombie \n        slime: 15,     // Slime \n        bat: 20        // Bat \n    },\n    2: {\n        charger: 18,   // Charger \n        turret: 12,    // Turret \n        heavyTank: 18, // Heavy Tank \n        zippy: 18,     // Zippy \n        exploder: 20,  // Exploder \n        splitter: 14   // Intern  - Splits into 2 smaller copies on death\n    },\n    3: {\n        mage: 15,        // Mage \n        shieldBearer: 12, // Shield Bearer \n        golem: 12,       // Golem \n        wraith: 12,      // Wraith \n        spawner: 12,     // Spawner \n        buffer: 15,      // Buffer \n        orbiter: 7,      // Orbiter  - Walks perimeter, explodes into shrapnel\n        phaser: 8,       // Ghost Writer  - Phases through obstacles\n        mimic: 7         // Stunt Double @ - Copies player movement\n    },\n    4: {\n        healer: 18,     // Healer \n        teleporter: 15, // Teleporter \n        freezer: 18,    // Freezer \n        leech: 20,      // Leech \n        reflector: 14,  // Mirror Master  - Reflects projectiles\n        bomber: 15      // Demolitions Expert  - Launches homing bombs\n    }\n};\n\n// Get default weights for floors beyond defined\nfunction getDefaultWeights() {\n    return {\n        basic: 15,\n        rusher: 25,\n        tank: 30,\n        fast: 30\n    };\n}\n\n// Weighted random selection\nfunction weightedRandom(weights, rng = null) {\n    const total = Object.values(weights).reduce((sum, weight) => sum + weight, 0);\n    // Use seeded RNG if provided (for multiplayer sync), otherwise Math.random\n    let random = (rng ? rng.next() : Math.random()) * total;\n\n    for (const [type, weight] of Object.entries(weights)) {\n        random -= weight;\n        if (random <= 0) {\n            return type;\n        }\n    }\n\n    // Fallback (shouldn't happen)\n    return Object.keys(weights)[0];\n}\n\n// Get random enemy type for a given floor\n// Pass rng parameter for multiplayer to ensure consistent spawns across clients\nexport function getRandomEnemyType(floor = 1, rng = null) {\n    const weights = ENEMY_SPAWN_WEIGHTS[floor] || getDefaultWeights();\n    return weightedRandom(weights, rng);\n}\n\n\n","/**\n * Elite Enemy System\n *\n * Handles elite enemy modifiers:\n * - Swift: Yellow tint, +50% speed\n * - Armored: Blue tint, +100% HP, 25% damage reduction\n * - Vampiric: Red tint, heals 10 HP on hitting player\n *\n * Elite spawn chance: 10-15% on floor 2+\n */\n\n// Elite modifier definitions\nexport const ELITE_MODIFIERS = {\n    swift: {\n        name: 'Swift',\n        prefix: '',\n        color: [255, 255, 100], // Yellow tint\n        apply: (enemy) => {\n            enemy.speed = Math.floor(enemy.speed * 1.5); // +50% speed\n        }\n    },\n    armored: {\n        name: 'Armored',\n        prefix: '',\n        color: [100, 150, 255], // Blue tint\n        apply: (enemy) => {\n            // +100% HP\n            enemy.maxHealth = Math.floor(enemy.maxHealth * 2);\n            enemy.setHP(enemy.maxHealth);\n            // +25% damage reduction\n            enemy.damageReduction = (enemy.damageReduction || 0) + 0.25;\n        }\n    },\n    vampiric: {\n        name: 'Vampiric',\n        prefix: '',\n        color: [255, 100, 100], // Red tint\n        apply: (enemy) => {\n            // Mark as vampiric - heals on hit\n            enemy.isVampiric = true;\n            enemy.vampiricHealAmount = 10;\n        }\n    }\n};\n\n// Elite spawn configuration by floor\nconst ELITE_CONFIG = {\n    2: { spawnChance: 0.10 }, // 10% chance on floor 2\n    3: { spawnChance: 0.12 }, // 12% chance on floor 3\n    4: { spawnChance: 0.15 }  // 15% chance on floor 4+\n};\n\n/**\n * Check if an enemy should be elite based on floor\n * @param {number} floor - Current floor number\n * @param {object} rng - Optional seeded RNG for multiplayer sync\n * @returns {boolean} Whether the enemy should be elite\n */\nexport function shouldSpawnElite(floor, rng = null) {\n    if (floor < 2) return false; // No elites on floor 1\n\n    const config = ELITE_CONFIG[floor] || ELITE_CONFIG[4]; // Default to floor 4+ config\n    const roll = rng ? rng.next() : Math.random();\n\n    return roll < config.spawnChance;\n}\n\n/**\n * Get a random elite modifier\n * @param {object} rng - Optional seeded RNG for multiplayer sync\n * @returns {string} Elite modifier key\n */\nexport function getRandomEliteModifier(rng = null) {\n    const modifiers = Object.keys(ELITE_MODIFIERS);\n    const roll = rng ? rng.next() : Math.random();\n    const index = Math.floor(roll * modifiers.length);\n\n    return modifiers[index];\n}\n\n/**\n * Apply elite modifier to an enemy\n * @param {object} k - KAPLAY instance\n * @param {object} enemy - Enemy entity\n * @param {string} modifierKey - Elite modifier key\n */\nexport function applyEliteModifier(k, enemy, modifierKey) {\n    const modifier = ELITE_MODIFIERS[modifierKey];\n    if (!modifier) return;\n\n    // Mark as elite\n    enemy.isElite = true;\n    enemy.eliteModifier = modifierKey;\n\n    // Apply stat changes\n    modifier.apply(enemy);\n\n    // Update visual - add prefix and change color\n    const newChar = `${modifier.prefix}${enemy.coreChar}`;\n    enemy.coreChar = newChar;\n    enemy.text = newChar;\n\n    // Update color\n    enemy.originalColor = modifier.color;\n    enemy.color = k.rgb(...modifier.color);\n\n    // Increase XP value for elites (+50%)\n    enemy.xpValue = Math.floor(enemy.xpValue * 1.5);\n\n    // Update visual\n    if (enemy.updateVisual) {\n        enemy.updateVisual();\n    }\n}\n\n/**\n * Create an elite enemy (combines shouldSpawnElite check and application)\n * @param {object} k - KAPLAY instance\n * @param {object} enemy - Enemy entity\n * @param {number} floor - Current floor number\n * @param {object} rng - Optional seeded RNG for multiplayer sync\n * @returns {boolean} Whether the enemy became elite\n */\nexport function tryMakeElite(k, enemy, floor, rng = null) {\n    // Never make bosses elite - they're already powerful enough\n    if (enemy.isBoss || enemy.isBossEnemy) {\n        return false;\n    }\n\n    if (!shouldSpawnElite(floor, rng)) {\n        return false;\n    }\n\n    const modifierKey = getRandomEliteModifier(rng);\n    applyEliteModifier(k, enemy, modifierKey);\n\n    return true;\n}\n","/**\n * Room Generation System\n *\n * Handles procedural room generation and layout:\n * - Room templates with obstacle layouts\n * - Weighted random template selection by floor\n * - Two obstacle types: walls (block all) and cover (block movement only)\n * - Explosive barrel placement for tactical gameplay\n * - Floor-based color theming\n * - Safe spawn zone enforcement\n * - Progressive complexity (more obstacles on higher floors)\n * - Obstacle boundary constraints\n * - Room-to-room variation\n */\n\n// Room configuration\nconst ROOM_WIDTH = 800;\nconst ROOM_HEIGHT = 600;\nconst ROOM_MARGIN = 20;\n\n// Track last used template to avoid repetition\nlet lastRoomTemplate = null;\n\n/**\n * Room template definitions\n * Each template defines:\n * - obstacles: Array of {x, y, width, height, type, char}\n *   - type: 'wall' (blocks everything) or 'cover' (blocks movement, projectiles pass)\n * - barrels: Array of {x, y} positions for explosive barrels\n * - spawnDoors: Optional door position overrides\n * - name: Template identifier\n * - floorAffinity: Array of floor numbers this template favors (optional)\n */\n\nexport const ROOM_TEMPLATES = {\n    // === FLOOR 1: Urban Streets - Simple layouts, learning experience ===\n    empty: {\n        name: 'Empty Room',\n        obstacles: [],\n        barrels: [],\n        spawnDoors: null,\n        floorAffinity: [1]\n    },\n    streetCorners: {\n        name: 'Street Corners',\n        obstacles: [\n            { x: 150, y: 150, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 650, y: 150, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 150, y: 450, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 650, y: 450, width: 50, height: 50, type: 'cover', char: '' }\n        ],\n        barrels: [\n            { x: 300, y: 200 },\n            { x: 500, y: 400 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [1]\n    },\n    alleyway: {\n        name: 'Alleyway',\n        obstacles: [\n            { x: 200, y: 200, width: 30, height: 200, type: 'wall', char: '' },\n            { x: 600, y: 200, width: 30, height: 200, type: 'wall', char: '' }\n        ],\n        barrels: [\n            { x: 250, y: 250 },\n            { x: 550, y: 350 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [1]\n    },\n\n    // === FLOOR 2: Industrial Complex - More cover, hazards ===\n    factoryFloor: {\n        name: 'Factory Floor',\n        obstacles: [\n            { x: 200, y: 180, width: 80, height: 40, type: 'wall', char: '' },\n            { x: 600, y: 180, width: 80, height: 40, type: 'wall', char: '' },\n            { x: 200, y: 420, width: 80, height: 40, type: 'wall', char: '' },\n            { x: 600, y: 420, width: 80, height: 40, type: 'wall', char: '' },\n            { x: 400, y: 300, width: 60, height: 60, type: 'wall', char: '' }\n        ],\n        barrels: [\n            { x: 150, y: 300 },\n            { x: 650, y: 300 },\n            { x: 400, y: 200 },\n            { x: 400, y: 400 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [2]\n    },\n    assemblyLine: {\n        name: 'Assembly Line',\n        obstacles: [\n            { x: 250, y: 250, width: 300, height: 25, type: 'wall', char: '' },\n            { x: 250, y: 350, width: 300, height: 25, type: 'wall', char: '' }\n        ],\n        barrels: [\n            { x: 150, y: 300 },\n            { x: 650, y: 300 },\n            { x: 400, y: 150 },\n            { x: 400, y: 450 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [2]\n    },\n    storageYard: {\n        name: 'Storage Yard',\n        obstacles: [\n            { x: 180, y: 180, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 620, y: 180, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 180, y: 420, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 620, y: 420, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 320, y: 300, width: 40, height: 40, type: 'cover', char: '' },\n            { x: 480, y: 300, width: 40, height: 40, type: 'cover', char: '' }\n        ],\n        barrels: [\n            { x: 250, y: 250 },\n            { x: 550, y: 250 },\n            { x: 250, y: 350 },\n            { x: 550, y: 350 },\n            { x: 400, y: 200 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [2]\n    },\n\n    // === FLOOR 3: Cyber Station - Tech layouts, precision required ===\n    serverRoom: {\n        name: 'Server Room',\n        obstacles: [\n            { x: 200, y: 150, width: 30, height: 300, type: 'wall', char: '' },\n            { x: 350, y: 150, width: 30, height: 300, type: 'wall', char: '' },\n            { x: 500, y: 150, width: 30, height: 300, type: 'wall', char: '' },\n            { x: 650, y: 150, width: 30, height: 300, type: 'wall', char: '' }\n        ],\n        barrels: [\n            { x: 275, y: 200 },\n            { x: 425, y: 400 },\n            { x: 575, y: 250 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [3]\n    },\n    controlCenter: {\n        name: 'Control Center',\n        obstacles: [\n            { x: 400, y: 200, width: 120, height: 80, type: 'wall', char: '' },\n            { x: 200, y: 350, width: 60, height: 60, type: 'cover', char: '' },\n            { x: 600, y: 350, width: 60, height: 60, type: 'cover', char: '' }\n        ],\n        barrels: [\n            { x: 300, y: 200 },\n            { x: 500, y: 200 },\n            { x: 400, y: 450 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [3]\n    },\n    dataVault: {\n        name: 'Data Vault',\n        obstacles: [\n            { x: 250, y: 200, width: 40, height: 40, type: 'wall', char: '' },\n            { x: 550, y: 200, width: 40, height: 40, type: 'wall', char: '' },\n            { x: 250, y: 400, width: 40, height: 40, type: 'wall', char: '' },\n            { x: 550, y: 400, width: 40, height: 40, type: 'wall', char: '' },\n            { x: 400, y: 300, width: 100, height: 100, type: 'wall', char: '' }\n        ],\n        barrels: [\n            { x: 180, y: 300 },\n            { x: 620, y: 300 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [3]\n    },\n\n    // === FLOOR 4: Alien Vessel - Organic, unpredictable ===\n    hiveCluster: {\n        name: 'Hive Cluster',\n        obstacles: [\n            { x: 300, y: 180, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 500, y: 180, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 200, y: 300, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 600, y: 300, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 300, y: 420, width: 50, height: 50, type: 'cover', char: '' },\n            { x: 500, y: 420, width: 50, height: 50, type: 'cover', char: '' }\n        ],\n        barrels: [\n            { x: 400, y: 180 },\n            { x: 400, y: 420 },\n            { x: 250, y: 300 },\n            { x: 550, y: 300 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [4]\n    },\n    bioLab: {\n        name: 'Bio Lab',\n        obstacles: [\n            { x: 300, y: 250, width: 200, height: 30, type: 'wall', char: '' },\n            { x: 300, y: 350, width: 200, height: 30, type: 'wall', char: '' },\n            { x: 400, y: 300, width: 30, height: 130, type: 'wall', char: '' }\n        ],\n        barrels: [\n            { x: 200, y: 200 },\n            { x: 600, y: 200 },\n            { x: 200, y: 400 },\n            { x: 600, y: 400 },\n            { x: 400, y: 150 },\n            { x: 400, y: 450 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [4]\n    },\n    xenoNest: {\n        name: 'Xeno Nest',\n        obstacles: [\n            { x: 400, y: 300, width: 80, height: 80, type: 'wall', char: '' },\n            { x: 250, y: 200, width: 35, height: 35, type: 'cover', char: '' },\n            { x: 550, y: 200, width: 35, height: 35, type: 'cover', char: '' },\n            { x: 250, y: 400, width: 35, height: 35, type: 'cover', char: '' },\n            { x: 550, y: 400, width: 35, height: 35, type: 'cover', char: '' }\n        ],\n        barrels: [\n            { x: 180, y: 150 },\n            { x: 620, y: 150 },\n            { x: 180, y: 450 },\n            { x: 620, y: 450 }\n        ],\n        spawnDoors: null,\n        floorAffinity: [4]\n    },\n\n    // === Universal templates (work on any floor) ===\n    centerPillar: {\n        name: 'Center Pillar',\n        obstacles: [\n            { x: 400, y: 200, width: 60, height: 60, type: 'wall', char: '#' },\n            { x: 400, y: 400, width: 60, height: 60, type: 'wall', char: '#' }\n        ],\n        barrels: [\n            { x: 250, y: 300 },\n            { x: 550, y: 300 }\n        ],\n        spawnDoors: null,\n        floorAffinity: null // Works on all floors\n    },\n    corners: {\n        name: 'Corner Cover',\n        obstacles: [\n            { x: 150, y: 150, width: 40, height: 40, type: 'cover', char: '' },\n            { x: 650, y: 150, width: 40, height: 40, type: 'cover', char: '' },\n            { x: 150, y: 450, width: 40, height: 40, type: 'cover', char: '' },\n            { x: 650, y: 450, width: 40, height: 40, type: 'cover', char: '' }\n        ],\n        barrels: [\n            { x: 400, y: 200 },\n            { x: 400, y: 400 }\n        ],\n        spawnDoors: null,\n        floorAffinity: null\n    },\n    hallway: {\n        name: 'Hallway',\n        obstacles: [\n            { x: 200, y: 250, width: 400, height: 20, type: 'wall', char: '#' },\n            { x: 200, y: 330, width: 400, height: 20, type: 'wall', char: '#' }\n        ],\n        barrels: [\n            { x: 150, y: 290 },\n            { x: 650, y: 290 }\n        ],\n        spawnDoors: null,\n        floorAffinity: null\n    },\n    cross: {\n        name: 'Cross Pattern',\n        obstacles: [\n            { x: 350, y: 200, width: 100, height: 20, type: 'wall', char: '#' },\n            { x: 390, y: 200, width: 20, height: 200, type: 'wall', char: '#' }\n        ],\n        barrels: [\n            { x: 250, y: 200 },\n            { x: 550, y: 200 },\n            { x: 250, y: 400 },\n            { x: 550, y: 400 }\n        ],\n        spawnDoors: null,\n        floorAffinity: null\n    },\n    barrelRoom: {\n        name: 'Barrel Room',\n        obstacles: [\n            { x: 400, y: 300, width: 50, height: 50, type: 'cover', char: '' }\n        ],\n        barrels: [\n            // Strategic barrel cluster - chain reaction opportunity!\n            { x: 250, y: 200 },\n            { x: 300, y: 200 },\n            { x: 275, y: 250 },\n            { x: 500, y: 400 },\n            { x: 550, y: 400 },\n            { x: 525, y: 350 },\n            // Corner barrels\n            { x: 150, y: 150 },\n            { x: 650, y: 450 }\n        ],\n        spawnDoors: null,\n        floorAffinity: null\n    },\n    scattered: {\n        name: 'Scattered Obstacles',\n        obstacles: [\n            { x: 250, y: 200, width: 30, height: 30, type: 'cover', char: '' },\n            { x: 550, y: 250, width: 30, height: 30, type: 'cover', char: '' },\n            { x: 350, y: 400, width: 50, height: 30, type: 'wall', char: '#' },\n            { x: 150, y: 350, width: 30, height: 50, type: 'wall', char: '#' }\n        ],\n        barrels: [\n            { x: 450, y: 200 },\n            { x: 250, y: 400 },\n            { x: 600, y: 350 }\n        ],\n        spawnDoors: null,\n        floorAffinity: null\n    }\n};\n\n/**\n * Constrain obstacle position to stay within room boundaries\n * @param {number} x - Obstacle center x position\n * @param {number} y - Obstacle center y position\n * @param {number} width - Obstacle width\n * @param {number} height - Obstacle height\n * @returns {object} - Clamped {x, y} position\n */\nexport function constrainObstacleToRoom(x, y, width, height) {\n    const halfWidth = width / 2;\n    const halfHeight = height / 2;\n\n    // Calculate boundaries (accounting for obstacle size)\n    const minX = ROOM_MARGIN + halfWidth;\n    const maxX = ROOM_WIDTH - ROOM_MARGIN - halfWidth;\n    const minY = ROOM_MARGIN + halfHeight;\n    const maxY = ROOM_HEIGHT - ROOM_MARGIN - halfHeight;\n\n    // Clamp position\n    const clampedX = Math.max(minX, Math.min(maxX, x));\n    const clampedY = Math.max(minY, Math.min(maxY, y));\n\n    return { x: clampedX, y: clampedY };\n}\n\n// Get color scheme for floor (visual progression)\n// Each floor has a distinct color palette matching its theme\nexport function getFloorColors(k, floor) {\n    // Floor-specific color palettes matching floorTheming.js\n    const floorPalettes = {\n        1: { // Urban Streets - cool gray asphalt tones\n            wall: [55, 55, 65],\n            obstacle: [70, 70, 80],\n            cover: [85, 85, 95]\n        },\n        2: { // Industrial Complex - rusty brown-orange tones\n            wall: [75, 60, 50],\n            obstacle: [90, 70, 55],\n            cover: [100, 80, 65]\n        },\n        3: { // Cyber Station - cool blue steel tones\n            wall: [45, 55, 75],\n            obstacle: [55, 70, 95],\n            cover: [65, 85, 115]\n        },\n        4: { // Alien Vessel - deep purple organic tones\n            wall: [60, 45, 70],\n            obstacle: [75, 55, 85],\n            cover: [90, 65, 100]\n        },\n        5: { // The Void - eldritch purple-black tones\n            wall: [35, 30, 45],\n            obstacle: [45, 38, 55],\n            cover: [55, 45, 65]\n        }\n    };\n\n    // Get palette for current floor (default to void for floor 5+)\n    const palette = floorPalettes[Math.min(floor, 5)] || floorPalettes[5];\n\n    return {\n        wallColor: k.rgb(...palette.wall),\n        obstacleColor: k.rgb(...palette.obstacle),\n        coverColor: k.rgb(...palette.cover)\n    };\n}\n\n// Get random room template\nexport function getRandomRoomTemplate(rng = null) {\n    const templates = Object.keys(ROOM_TEMPLATES);\n    const randomIndex = rng\n        ? rng.range(0, templates.length)\n        : Math.floor(Math.random() * templates.length);\n    const randomKey = templates[randomIndex];\n    return {\n        key: randomKey,\n        ...ROOM_TEMPLATES[randomKey]\n    };\n}\n\n// Get weighted random room template (favors floor-specific templates)\n// Avoids repeating the same template consecutively\n// @param {number} floor - Floor number (for difficulty scaling and template selection)\n// @param {SeededRandom} rng - Optional seeded RNG for multiplayer synchronization\nexport function getWeightedRoomTemplate(floor, rng = null) {\n    const allTemplates = Object.keys(ROOM_TEMPLATES);\n\n    // Filter out the last template to avoid repetition\n    const availableTemplates = lastRoomTemplate\n        ? allTemplates.filter(key => key !== lastRoomTemplate)\n        : allTemplates;\n\n    // Separate floor-specific and universal templates\n    const floorSpecific = [];\n    const universal = [];\n\n    availableTemplates.forEach(key => {\n        const template = ROOM_TEMPLATES[key];\n        if (template.floorAffinity === null) {\n            universal.push(key);\n        } else if (template.floorAffinity.includes(floor)) {\n            floorSpecific.push(key);\n        }\n    });\n\n    // 70% chance to use floor-specific template if available\n    const useFloorSpecific = floorSpecific.length > 0 &&\n        ((rng ? rng.next() : Math.random()) < 0.7);\n\n    const templatePool = useFloorSpecific ? floorSpecific :\n        (universal.length > 0 ? universal : availableTemplates);\n\n    // If somehow we filtered everything (shouldn't happen), use all templates\n    const finalPool = templatePool.length > 0 ? templatePool : allTemplates;\n\n    // Select random template from pool\n    const randomIndex = rng\n        ? rng.range(0, finalPool.length)\n        : Math.floor(Math.random() * finalPool.length);\n    const randomKey = finalPool[randomIndex];\n\n    // Update last template tracker\n    lastRoomTemplate = randomKey;\n\n    return {\n        key: randomKey,\n        ...ROOM_TEMPLATES[randomKey]\n    };\n}\n\n/**\n * Get barrel spawn positions for a room template\n * @param {string} templateKey - Template key\n * @param {SeededRandom} rng - Optional seeded RNG\n * @param {number} floor - Floor number (affects barrel count)\n * @returns {Array} - Array of {x, y} barrel positions\n */\nexport function getBarrelPositions(templateKey, rng = null, floor = 1) {\n    const template = ROOM_TEMPLATES[templateKey];\n    if (!template || !template.barrels || template.barrels.length === 0) {\n        return [];\n    }\n\n    // Base barrel positions from template\n    let positions = [...template.barrels];\n\n    // On higher floors, potentially add extra barrels\n    if (floor >= 2) {\n        const extraChance = rng ? rng.next() : Math.random();\n        if (extraChance < 0.3 + (floor * 0.1)) {\n            // Add a random extra barrel\n            const extraX = 100 + (rng ? rng.next() : Math.random()) * 600;\n            const extraY = 100 + (rng ? rng.next() : Math.random()) * 400;\n            positions.push({ x: extraX, y: extraY });\n        }\n    }\n\n    // On floor 1, reduce barrels to help new players\n    if (floor === 1) {\n        const reduceChance = rng ? rng.next() : Math.random();\n        if (reduceChance < 0.5 && positions.length > 1) {\n            positions = positions.slice(0, Math.ceil(positions.length / 2));\n        }\n    }\n\n    return positions;\n}\n\n// Reset room template history (call when starting new run)\nexport function resetRoomTemplateHistory() {\n    lastRoomTemplate = null;\n}\n\n// Get room template by specific key (for multiplayer sync)\nexport function getRoomTemplateByKey(key) {\n    if (!ROOM_TEMPLATES[key]) {\n        console.warn(`Unknown room template key: ${key}, falling back to empty`);\n        return {\n            key: 'empty',\n            ...ROOM_TEMPLATES.empty\n        };\n    }\n\n    // Update last template tracker for consistency\n    lastRoomTemplate = key;\n\n    return {\n        key: key,\n        ...ROOM_TEMPLATES[key]\n    };\n}\n\n","// Achievement checking system - checks and unlocks achievements based on stats\n\nimport { getSaveStats, unlockAchievement, isAchievementUnlocked, getUnlockedAchievements, getSaveData } from './metaProgression.js';\nimport { ACHIEVEMENTS } from '../data/achievements.js';\nimport { playAchievement } from './sounds.js';\nimport { showAchievementToast, initToastSystem } from './toastNotifications.js';\nimport { CHARACTER_UNLOCKS, PERMANENT_UPGRADE_UNLOCKS } from '../data/unlocks.js';\nimport { isMultiplayerActive, getLocalPlayerSlot, broadcastAchievementUnlocked } from './multiplayerGame.js';\n\n// Track achievements unlocked during the current run\nlet runUnlockedAchievements = [];\n\n// Track run-specific data for challenge achievements\nlet runChallengeData = {\n    floorDamageTaken: {},    // Tracks damage taken per floor\n    runStartTime: 0,         // When the run started\n    bossesKilledThisRun: 0,  // Bosses killed in current run\n    currentBossNoDamage: true, // Did we take damage during current boss fight\n    bossStartHP: 0           // HP at start of boss fight\n};\n\n// Store kaplay instance for showing toasts from event functions\nlet kInstance = null;\n\n/**\n * Helper function to unlock an achievement and show toast immediately\n * @param {string} achievementId - Achievement ID to unlock\n * @returns {boolean} True if newly unlocked\n */\nfunction unlockAndNotify(achievementId) {\n    if (isAchievementUnlocked(achievementId)) return false;\n\n    if (unlockAchievement(achievementId)) {\n        runUnlockedAchievements.push(achievementId);\n\n        // Show toast immediately if we have a kaplay instance\n        if (kInstance) {\n            const achievement = ACHIEVEMENTS[achievementId];\n            if (achievement) {\n                playAchievement();\n                showAchievementToast(achievement);\n\n                // Broadcast in multiplayer\n                if (isMultiplayerActive()) {\n                    broadcastAchievementUnlocked(achievementId, getLocalPlayerSlot());\n                }\n            }\n        }\n        return true;\n    }\n    return false;\n}\n\n/**\n * Initialize achievement checker for a new run\n * @param {Object} k - Kaplay instance for toast notifications\n */\nexport function initAchievementChecker(k) {\n    runUnlockedAchievements = [];\n    runChallengeData = {\n        floorDamageTaken: {},\n        runStartTime: Date.now(),\n        bossesKilledThisRun: 0,\n        currentBossNoDamage: true,\n        bossStartHP: 0\n    };\n\n    // Store kaplay instance for showing toasts from event functions\n    kInstance = k;\n\n    // Initialize toast system\n    if (k) {\n        initToastSystem(k);\n    }\n}\n\n/**\n * Get achievements unlocked during the current run\n * @returns {Array} Array of achievement IDs unlocked this run\n */\nexport function getRunUnlockedAchievements() {\n    return [...runUnlockedAchievements];\n}\n\n/**\n * Clear run-unlocked achievements (call when starting new run)\n */\nexport function clearRunUnlockedAchievements() {\n    runUnlockedAchievements = [];\n}\n\n/**\n * Track damage taken on a floor (for perfectFloor achievement)\n * @param {number} floor - Current floor number\n * @param {number} damage - Damage taken\n */\nexport function trackFloorDamage(floor, damage) {\n    if (!runChallengeData.floorDamageTaken[floor]) {\n        runChallengeData.floorDamageTaken[floor] = 0;\n    }\n    runChallengeData.floorDamageTaken[floor] += damage;\n}\n\n/**\n * Check if a floor was completed without taking damage\n * @param {number} floor - Floor number that was completed\n * @returns {boolean} True if no damage was taken\n */\nexport function wasFloorPerfect(floor) {\n    return !runChallengeData.floorDamageTaken[floor] || runChallengeData.floorDamageTaken[floor] === 0;\n}\n\n/**\n * Start tracking a boss fight (for noHitBoss achievement)\n * @param {number} playerHP - Player's HP at boss fight start\n */\nexport function startBossFight(playerHP) {\n    runChallengeData.currentBossNoDamage = true;\n    runChallengeData.bossStartHP = playerHP;\n}\n\n/**\n * Track damage during boss fight\n */\nexport function trackBossDamage() {\n    runChallengeData.currentBossNoDamage = false;\n}\n\n/**\n * Called when a boss is defeated\n * @param {number} playerCurrentHP - Player's current HP when boss died\n * @param {number} playerMaxHP - Player's max HP\n */\nexport function onBossDefeated(playerCurrentHP, playerMaxHP) {\n    runChallengeData.bossesKilledThisRun++;\n\n    // Check noHitBoss achievement\n    if (runChallengeData.currentBossNoDamage) {\n        unlockAndNotify('noHitBoss');\n    }\n\n    // Check glassCannonWin achievement (below 25% HP)\n    const hpPercent = playerCurrentHP / playerMaxHP;\n    if (hpPercent < 0.25) {\n        unlockAndNotify('glassCannonWin');\n    }\n\n    // Check bossRush achievement (3 bosses in one run)\n    if (runChallengeData.bossesKilledThisRun >= 3) {\n        unlockAndNotify('bossRush');\n    }\n\n    // Reset boss tracking for next boss\n    runChallengeData.currentBossNoDamage = true;\n    runChallengeData.bossStartHP = playerCurrentHP;\n}\n\n/**\n * Called when a floor is completed\n * @param {number} floor - Floor that was completed\n */\nexport function onFloorCompleted(floor) {\n    // Check perfectFloor achievement\n    if (wasFloorPerfect(floor)) {\n        unlockAndNotify('perfectFloor');\n    }\n\n    // Check speedRunner achievement (Floor 3 in under 5 minutes)\n    if (floor >= 3) {\n        const runDuration = (Date.now() - runChallengeData.runStartTime) / 1000;\n        if (runDuration < 300) { // 5 minutes = 300 seconds\n            unlockAndNotify('speedRunner');\n        }\n    }\n\n    // Initialize damage tracking for next floor\n    runChallengeData.floorDamageTaken[floor + 1] = 0;\n}\n\n/**\n * Called when a synergy is activated (for firstSynergy achievement)\n */\nexport function onSynergyActivated() {\n    unlockAndNotify('firstSynergy');\n}\n\n/**\n * Check if all characters are unlocked (for allCharacters achievement)\n */\nexport function checkAllCharactersUnlocked() {\n    const saveData = getSaveData();\n    const unlockedCharacters = saveData.unlocks?.characters || ['survivor'];\n    const totalCharacters = Object.keys(CHARACTER_UNLOCKS).length;\n\n    if (unlockedCharacters.length >= totalCharacters) {\n        unlockAndNotify('allCharacters');\n    }\n}\n\n/**\n * Check if any permanent upgrade is maxed (for maxUpgrade achievement)\n */\nexport function checkMaxUpgrade() {\n    const saveData = getSaveData();\n    const upgradeLevels = saveData.permanentUpgradeLevels || {};\n\n    for (const [key, upgrade] of Object.entries(PERMANENT_UPGRADE_UNLOCKS)) {\n        const currentLevel = upgradeLevels[key] || 0;\n        const maxLevel = upgrade.maxLevel || 1;\n\n        if (currentLevel >= maxLevel) {\n            unlockAndNotify('maxUpgrade');\n            break;\n        }\n    }\n}\n\n// Check all achievements based on current stats\n// Can be called during gameplay or at game over\n// @param {Object} k - Kaplay instance (optional, uses stored instance if not provided)\n// @param {Object} currentRunStats - Optional current run stats to augment saved stats\n//   { floor, enemiesKilled, bossesKilled, level, currencyEarned }\nexport function checkAchievements(k, currentRunStats = null) {\n    // Update kInstance if provided (for showing toasts)\n    if (k) {\n        kInstance = k;\n        initToastSystem(k);\n    }\n\n    const savedStats = getSaveStats();\n\n    // Merge saved stats with current run stats if provided\n    const stats = {\n        bestFloor: Math.max(savedStats.bestFloor || 0, currentRunStats?.floor || 0),\n        totalEnemiesKilled: (savedStats.totalEnemiesKilled || 0) + (currentRunStats?.enemiesKilled || 0),\n        totalBossesKilled: (savedStats.totalBossesKilled || 0) + (currentRunStats?.bossesKilled || 0),\n        totalRuns: savedStats.totalRuns || 0,\n        bestLevel: Math.max(savedStats.bestLevel || 0, currentRunStats?.level || 0),\n        totalCurrencyEarned: (savedStats.totalCurrencyEarned || 0) + (currentRunStats?.currencyEarned || 0)\n    };\n\n    const newlyUnlocked = [];\n\n    // Helper to check and unlock with notification\n    const check = (condition, achievementId) => {\n        if (condition && unlockAndNotify(achievementId)) {\n            newlyUnlocked.push(achievementId);\n        }\n    };\n\n    // Floor progression achievements\n    check(stats.bestFloor >= 2, 'floor2');\n    check(stats.bestFloor >= 3, 'floor3');\n    check(stats.bestFloor >= 5, 'floor5');\n    check(stats.bestFloor >= 10, 'floor10');\n    check(stats.bestFloor >= 15, 'floor15');\n    check(stats.bestFloor >= 20, 'floor20');\n\n    // Combat achievements\n    check(stats.totalEnemiesKilled >= 1, 'firstKill');\n    check(stats.totalEnemiesKilled >= 100, 'kill100');\n    check(stats.totalEnemiesKilled >= 500, 'kill500');\n    check(stats.totalEnemiesKilled >= 1000, 'kill1000');\n    check(stats.totalEnemiesKilled >= 5000, 'kill5000');\n    check(stats.totalEnemiesKilled >= 10000, 'kill10000');\n\n    // Boss achievements\n    check(stats.totalBossesKilled >= 1, 'firstBoss');\n    check(stats.totalBossesKilled >= 5, 'boss5');\n    check(stats.totalBossesKilled >= 10, 'boss10');\n    check(stats.totalBossesKilled >= 25, 'boss25');\n    check(stats.totalBossesKilled >= 50, 'boss50');\n\n    // Run achievements\n    check(stats.totalRuns >= 1, 'firstRun');\n    check(stats.totalRuns >= 10, 'run10');\n    check(stats.totalRuns >= 50, 'run50');\n    check(stats.totalRuns >= 100, 'run100');\n\n    // Upgrade achievements (best level in a run)\n    check(stats.bestLevel >= 10, 'level10');\n    check(stats.bestLevel >= 20, 'level20');\n    check(stats.bestLevel >= 30, 'level30');\n    check(stats.bestLevel >= 50, 'level50');\n\n    // Currency achievements\n    check(stats.totalCurrencyEarned >= 100, 'earn100');\n    check(stats.totalCurrencyEarned >= 500, 'earn500');\n    check(stats.totalCurrencyEarned >= 1000, 'earn1000');\n    check(stats.totalCurrencyEarned >= 5000, 'earn5000');\n    check(stats.totalCurrencyEarned >= 10000, 'earn10000');\n\n    return newlyUnlocked;\n}\n\n/**\n * Get all achievement info with unlock status for display\n * @returns {Array} Array of achievement objects with unlocked status\n */\nexport function getAllAchievementsWithStatus() {\n    const unlockedIds = getUnlockedAchievements();\n\n    return Object.values(ACHIEVEMENTS).map(achievement => ({\n        ...achievement,\n        isUnlocked: unlockedIds.includes(achievement.id)\n    }));\n}\n","/**\n * Floor Map System - Smash TV Style Room Grid\n *\n * Generates a grid-based floor layout with:\n * - Start room on the left\n * - Boss room on the right\n * - Procedurally connected rooms in between\n * - Guaranteed path from start to boss\n * - No backtracking (can only go right, up, down)\n */\n\nimport { getWeightedRoomTemplate } from './roomGeneration.js';\nimport { getRandomEnemyType } from './enemySpawn.js';\n\n/**\n * Room node in the grid\n */\nclass RoomNode {\n    constructor(x, y, type = 'combat') {\n        this.position = { x, y };\n        this.type = type; // 'start', 'combat', 'boss'\n        this.template = null; // Room template (assigned later)\n        this.connections = {\n            up: false,\n            down: false,\n            right: false\n            // Note: No 'left' - backtracking not allowed\n        };\n        this.visited = false;\n        this.cleared = false;\n        this.enemyTypes = [];\n        this.isBossRoom = type === 'boss';\n    }\n\n    /**\n     * Get position key for this room\n     */\n    getKey() {\n        return `${this.position.x},${this.position.y}`;\n    }\n\n    /**\n     * Get adjacent position for a given direction\n     */\n    getAdjacentPosition(direction) {\n        const { x, y } = this.position;\n        switch (direction) {\n            case 'up': return { x, y: y - 1 };\n            case 'down': return { x, y: y + 1 };\n            case 'right': return { x: x + 1, y };\n            default: return null;\n        }\n    }\n}\n\n/**\n * Floor Map - manages the entire grid of rooms for a floor\n */\nexport class FloorMap {\n    constructor(floor, width = 6, height = 3, rng = null) {\n        this.floor = floor;\n        this.width = width;\n        this.height = height;\n        this.grid = []; // 2D array of RoomNodes (or null)\n        this.rooms = new Map(); // Map of \"x,y\" -> RoomNode\n        this.startPosition = null;\n        this.bossPosition = null;\n        this.currentPosition = null;\n        this.visitedRooms = new Set();\n        this.rng = rng; // Seeded RNG for multiplayer synchronization\n\n        this.generate();\n    }\n\n    /**\n     * Get a random number (0-1) using seeded RNG if available, otherwise Math.random\n     * @returns {number} Random number between 0 and 1\n     */\n    random() {\n        return this.rng ? this.rng.next() : Math.random();\n    }\n\n    /**\n     * Get a random integer in range [min, max)\n     * @param {number} min - Minimum value (inclusive)\n     * @param {number} max - Maximum value (exclusive)\n     * @returns {number} Random integer\n     */\n    randomRange(min, max) {\n        return this.rng ? this.rng.range(min, max) : Math.floor(Math.random() * (max - min)) + min;\n    }\n\n    /**\n     * Generate the floor map\n     */\n    generate() {\n        // Initialize empty grid\n        this.grid = Array(this.height).fill(null).map(() => Array(this.width).fill(null));\n\n        // Step 1: Place start and boss rooms\n        const midRow = Math.floor(this.height / 2);\n        this.startPosition = { x: 0, y: midRow };\n\n        // Boss can be in any row on the rightmost column\n        const bossRow = this.height === 1 ? 0 : this.randomRange(0, this.height);\n        this.bossPosition = { x: this.width - 1, y: bossRow };\n\n        // Create start room\n        const startRoom = new RoomNode(0, midRow, 'start');\n        this.setRoom(0, midRow, startRoom);\n\n        // Create boss room\n        const bossRoom = new RoomNode(this.width - 1, bossRow, 'boss');\n        this.setRoom(this.width - 1, bossRow, bossRoom);\n\n        // Step 2: Generate guaranteed main path from start to boss\n        this.generateMainPath();\n\n        // Step 3: Add branch rooms for choices (20-40% additional rooms)\n        this.addBranchRooms();\n\n        // Step 4: Establish connections between adjacent rooms\n        this.establishConnections();\n\n        // Step 5: Assign room templates and enemy types\n        this.assignRoomProperties();\n\n        // Step 6: Validate the map\n        this.validate();\n\n        // Set current position to start\n        this.currentPosition = { ...this.startPosition };\n        this.markRoomVisited(this.startPosition.x, this.startPosition.y);\n    }\n\n    /**\n     * Generate the main guaranteed path from start to boss\n     */\n    generateMainPath() {\n        const path = this.findPath(this.startPosition, this.bossPosition);\n\n        // Create rooms along the path\n        for (const pos of path) {\n            if (!this.getRoom(pos.x, pos.y)) {\n                const room = new RoomNode(pos.x, pos.y, 'combat');\n                this.setRoom(pos.x, pos.y, room);\n            }\n        }\n    }\n\n    /**\n     * Find a path from start to end using simple pathfinding\n     * Only moves RIGHT, UP, or DOWN\n     */\n    findPath(start, end) {\n        const path = [];\n        let current = { ...start };\n\n        while (current.x < end.x || current.y !== end.y) {\n            path.push({ ...current });\n\n            // Prefer moving right\n            if (current.x < end.x) {\n                // Occasionally move up/down to reach target row\n                if (current.y !== end.y && this.random() < 0.3) {\n                    current.y += current.y < end.y ? 1 : -1;\n                } else {\n                    current.x += 1;\n                }\n            } else {\n                // Move vertically to reach target row\n                current.y += current.y < end.y ? 1 : -1;\n            }\n        }\n\n        path.push({ ...end });\n        return path;\n    }\n\n    /**\n     * Add branch rooms to create choices for the player\n     */\n    addBranchRooms() {\n        const maxBranches = Math.floor((this.width * this.height) * 0.3); // 30% of grid\n        let branchesAdded = 0;\n\n        // Try to add branches adjacent to existing rooms\n        for (let x = 1; x < this.width - 1; x++) {\n            for (let y = 0; y < this.height; y++) {\n                if (branchesAdded >= maxBranches) break;\n\n                // Skip if room already exists\n                if (this.getRoom(x, y)) continue;\n\n                // Check if adjacent to an existing room (to the left)\n                const hasLeftNeighbor = x > 0 && this.getRoom(x - 1, y);\n                if (hasLeftNeighbor && this.random() < 0.5) {\n                    const room = new RoomNode(x, y, 'combat');\n                    this.setRoom(x, y, room);\n                    branchesAdded++;\n                }\n            }\n        }\n    }\n\n    /**\n     * Establish connections between adjacent rooms\n     */\n    establishConnections() {\n        for (let x = 0; x < this.width; x++) {\n            for (let y = 0; y < this.height; y++) {\n                const room = this.getRoom(x, y);\n                if (!room) continue;\n\n                // Check right\n                if (x < this.width - 1 && this.getRoom(x + 1, y)) {\n                    room.connections.right = true;\n                }\n\n                // Check up\n                if (y > 0 && this.getRoom(x, y - 1)) {\n                    room.connections.up = true;\n                }\n\n                // Check down\n                if (y < this.height - 1 && this.getRoom(x, y + 1)) {\n                    room.connections.down = true;\n                }\n            }\n        }\n    }\n\n    /**\n     * Assign room templates and enemy types based on floor\n     */\n    assignRoomProperties() {\n        for (let x = 0; x < this.width; x++) {\n            for (let y = 0; y < this.height; y++) {\n                const room = this.getRoom(x, y);\n                if (!room) continue;\n\n                // Assign template (except boss room which uses special template)\n                if (room.type !== 'boss') {\n                    room.template = getWeightedRoomTemplate(this.floor, this.rng);\n                }\n\n                // Assign enemy types for combat rooms\n                if (room.type === 'combat') {\n                    const enemyCount = this.randomRange(3, 6); // 3-5 enemy types\n                    room.enemyTypes = [];\n                    for (let i = 0; i < enemyCount; i++) {\n                        // Use seeded RNG for multiplayer consistency\n                        room.enemyTypes.push(getRandomEnemyType(this.floor, this.rng));\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Validate the map (ensure boss is reachable)\n     */\n    validate() {\n        // BFS to check if boss is reachable from start\n        const visited = new Set();\n        const queue = [this.startPosition];\n        visited.add(`${this.startPosition.x},${this.startPosition.y}`);\n\n        while (queue.length > 0) {\n            const pos = queue.shift();\n            const room = this.getRoom(pos.x, pos.y);\n\n            if (!room) continue;\n\n            // Check if we reached the boss\n            if (room.type === 'boss') {\n                console.log('[FloorMap] Validation passed: Boss is reachable');\n                return true;\n            }\n\n            // Add connected rooms to queue\n            const directions = ['up', 'down', 'right'];\n            for (const dir of directions) {\n                if (room.connections[dir]) {\n                    const nextPos = room.getAdjacentPosition(dir);\n                    const key = `${nextPos.x},${nextPos.y}`;\n                    if (!visited.has(key)) {\n                        visited.add(key);\n                        queue.push(nextPos);\n                    }\n                }\n            }\n        }\n\n        console.error('[FloorMap] Validation failed: Boss is not reachable!');\n        return false;\n    }\n\n    /**\n     * Get room at position\n     */\n    getRoom(x, y) {\n        if (x < 0 || x >= this.width || y < 0 || y >= this.height) {\n            return null;\n        }\n        return this.grid[y][x];\n    }\n\n    /**\n     * Set room at position\n     */\n    setRoom(x, y, room) {\n        if (x < 0 || x >= this.width || y < 0 || y >= this.height) {\n            return;\n        }\n        this.grid[y][x] = room;\n        this.rooms.set(room.getKey(), room);\n    }\n\n    /**\n     * Get current room\n     */\n    getCurrentRoom() {\n        return this.getRoom(this.currentPosition.x, this.currentPosition.y);\n    }\n\n    /**\n     * Get available exits from current room (unvisited only)\n     */\n    getAvailableExits() {\n        const room = this.getCurrentRoom();\n        if (!room) return [];\n\n        const exits = [];\n        const directions = ['up', 'down', 'right'];\n\n        for (const dir of directions) {\n            if (room.connections[dir]) {\n                const nextPos = room.getAdjacentPosition(dir);\n                const nextRoom = this.getRoom(nextPos.x, nextPos.y);\n\n                // Only include if room exists and hasn't been visited\n                if (nextRoom && !nextRoom.visited) {\n                    exits.push({\n                        direction: dir,\n                        position: nextPos,\n                        room: nextRoom\n                    });\n                }\n            }\n        }\n\n        return exits;\n    }\n\n    /**\n     * Mark room as visited\n     */\n    markRoomVisited(x, y) {\n        const room = this.getRoom(x, y);\n        if (room) {\n            room.visited = true;\n            this.visitedRooms.add(room.getKey());\n        }\n    }\n\n    /**\n     * Mark room as cleared\n     */\n    markRoomCleared(x, y) {\n        const room = this.getRoom(x, y);\n        if (room) {\n            room.cleared = true;\n        }\n    }\n\n    /**\n     * Move to adjacent room\n     */\n    moveToRoom(direction) {\n        const currentRoom = this.getCurrentRoom();\n        if (!currentRoom || !currentRoom.connections[direction]) {\n            console.warn(`[FloorMap] Cannot move ${direction} from current position`);\n            return false;\n        }\n\n        const nextPos = currentRoom.getAdjacentPosition(direction);\n        const nextRoom = this.getRoom(nextPos.x, nextPos.y);\n\n        if (!nextRoom) {\n            console.warn(`[FloorMap] No room found at ${nextPos.x}, ${nextPos.y}`);\n            return false;\n        }\n\n        // Update current position\n        this.currentPosition = nextPos;\n        this.markRoomVisited(nextPos.x, nextPos.y);\n\n        console.log(`[FloorMap] Moved to room (${nextPos.x}, ${nextPos.y})`);\n        return true;\n    }\n\n    /**\n     * Get total number of rooms\n     */\n    getTotalRooms() {\n        return this.rooms.size;\n    }\n\n    /**\n     * Get number of visited rooms\n     */\n    getVisitedCount() {\n        return this.visitedRooms.size;\n    }\n\n    /**\n     * Get grid for minimap display\n     */\n    getGridForMinimap() {\n        const minimapGrid = [];\n\n        for (let y = 0; y < this.height; y++) {\n            const row = [];\n            for (let x = 0; x < this.width; x++) {\n                const room = this.getRoom(x, y);\n\n                if (!room) {\n                    row.push({ type: 'empty' });\n                } else if (x === this.currentPosition.x && y === this.currentPosition.y) {\n                    row.push({ type: 'current', room });\n                } else if (room.visited) {\n                    row.push({ type: 'visited', room });\n                } else if (this.isRoomRevealed(x, y)) {\n                    row.push({ type: 'revealed', room });\n                } else {\n                    row.push({ type: 'hidden' });\n                }\n            }\n            minimapGrid.push(row);\n        }\n\n        return minimapGrid;\n    }\n\n    /**\n     * Check if a room should be revealed on minimap\n     * (adjacent to visited rooms)\n     */\n    isRoomRevealed(x, y) {\n        const room = this.getRoom(x, y);\n        if (!room) return false;\n\n        // Check if any adjacent room is visited\n        const directions = [\n            { dx: -1, dy: 0 }, // left (shows rooms behind)\n            { dx: 1, dy: 0 },  // right\n            { dx: 0, dy: -1 }, // up\n            { dx: 0, dy: 1 }   // down\n        ];\n\n        for (const { dx, dy } of directions) {\n            const adjRoom = this.getRoom(x + dx, y + dy);\n            if (adjRoom && adjRoom.visited) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Debug: Print grid to console\n     */\n    debugPrint() {\n        console.log(`\\n[FloorMap] Floor ${this.floor} - ${this.width}x${this.height}`);\n        console.log(`Start: (${this.startPosition.x}, ${this.startPosition.y})`);\n        console.log(`Boss: (${this.bossPosition.x}, ${this.bossPosition.y})`);\n        console.log(`Current: (${this.currentPosition.x}, ${this.currentPosition.y})`);\n        console.log(`Rooms: ${this.getTotalRooms()}, Visited: ${this.getVisitedCount()}\\n`);\n\n        for (let y = 0; y < this.height; y++) {\n            let row = '';\n            for (let x = 0; x < this.width; x++) {\n                const room = this.getRoom(x, y);\n                if (!room) {\n                    row += '[ ]';\n                } else if (room.type === 'start') {\n                    row += '[S]';\n                } else if (room.type === 'boss') {\n                    row += '[B]';\n                } else if (x === this.currentPosition.x && y === this.currentPosition.y) {\n                    row += '[]';\n                } else if (room.visited) {\n                    row += '[]';\n                } else {\n                    row += '[R]';\n                }\n                row += ' ';\n            }\n            console.log(row);\n        }\n\n        // Show connections\n        console.log('\\nConnections:');\n        for (const [key, room] of this.rooms) {\n            const connections = [];\n            if (room.connections.up) connections.push('');\n            if (room.connections.down) connections.push('');\n            if (room.connections.right) connections.push('');\n            console.log(`  (${room.position.x}, ${room.position.y}): ${connections.join(', ') || 'none'}`);\n        }\n    }\n}\n\n/**\n * Helper function to create a floor map for a given floor number\n * @param {number} floor - Floor number\n * @param {SeededRandom} rng - Optional seeded RNG for multiplayer synchronization\n * @returns {FloorMap} Generated floor map\n */\nexport function generateFloorMap(floor, rng = null) {\n    // Adjust grid size based on floor for more complex layouts per floor\n    // Floor 1: 4x3 (small), Floor 2: 5x3, Floor 3: 6x4, etc.\n    const width = Math.min(3 + floor, 10); // 4-10 columns\n    const height = Math.min(2 + Math.floor(floor / 2), 6); // 3-6 rows\n\n    const floorMap = new FloorMap(floor, width, height, rng);\n    floorMap.debugPrint();\n\n    return floorMap;\n}\n","/**\n * Minimap UI Component\n *\n * Displays a compact or expanded view of the floor grid\n * Shows player position, visited rooms, and available paths\n *\n * Design: All states anchor to top-right with consistent margins\n */\n\nimport { playMenuNav } from './sounds.js';\n\n/**\n * Minimap display modes\n */\nconst MINIMAP_MODE = {\n    MINIMIZED: 'minimized',  // Just a map button\n    OPEN: 'open',            // Small minimap (no legend)\n    MAXIMIZED: 'maximized'   // Large minimap with legend\n};\n\n/**\n * UI Layout Constants\n */\nconst LAYOUT = {\n    MARGIN_RIGHT: 12,      // Distance from right edge\n    MARGIN_TOP: 32,        // Below credits counter (at y: 6)\n    BUTTON_SIZE: 38,       // Minimized button size\n    OPEN_WIDTH: 130,       // Open state width\n    OPEN_HEIGHT: 85,       // Open state height\n    MAX_MIN_WIDTH: 200,    // Maximized minimum width\n    MAX_MIN_HEIGHT: 160,   // Maximized minimum height\n    CELL_SIZE_SMALL: 11,   // Grid cell size for open state\n    CELL_SIZE_LARGE: 16,   // Grid cell size for maximized state\n    CORNER_RADIUS: 4,      // Rounded corner visual (simulated)\n    Z_BASE: 900,           // Base z-index\n    Z_TEXT: 901,           // Text z-index\n    Z_ICON: 902,           // Icon/badge z-index\n};\n\n/**\n * Color Palette\n */\nconst COLORS = {\n    BG_DARK: [18, 18, 28],\n    BG_PANEL: [25, 25, 40],\n    BG_HEADER: [35, 35, 55],\n    BORDER: [80, 120, 180],\n    BORDER_HOVER: [120, 160, 220],\n    TEXT_TITLE: [200, 210, 255],\n    TEXT_MUTED: [140, 140, 160],\n    ICON_MAP: [130, 160, 220],\n    BADGE_FLOOR: [255, 220, 80],\n    CURRENT: [255, 255, 100],\n    VISITED: [80, 220, 100],\n    AVAILABLE: [120, 120, 140],\n    BOSS: [255, 90, 90],\n    HIDDEN: [50, 50, 70],\n    CELL_BG: [30, 30, 45],\n    CELL_BORDER: [45, 45, 60],\n};\n\n/**\n * Minimap UI Manager\n */\nexport class Minimap {\n    constructor(k, floorMap) {\n        this.k = k;\n        this.floorMap = floorMap;\n        this.mode = MINIMAP_MODE.MINIMIZED;\n        this.elements = [];\n        this.isHovered = false;\n        this.destroyed = false;\n\n        // Only render if floorMap is valid\n        if (this.floorMap && typeof this.floorMap.getGridForMinimap === 'function') {\n            this.render();\n        }\n    }\n\n    /**\n     * Get the right anchor X position (consistent for all states)\n     */\n    getRightX() {\n        return this.k.width() - LAYOUT.MARGIN_RIGHT;\n    }\n\n    /**\n     * Get the top Y position (consistent for all states)\n     */\n    getTopY() {\n        return LAYOUT.MARGIN_TOP;\n    }\n\n    /**\n     * Cycle through minimap modes: minimized  open  maximized  minimized\n     */\n    toggle() {\n        if (this.destroyed) return;\n\n        try {\n            playMenuNav();\n        } catch (e) {\n            console.warn('[Minimap] Sound playback failed:', e);\n        }\n\n        if (this.mode === MINIMAP_MODE.MINIMIZED) {\n            this.mode = MINIMAP_MODE.OPEN;\n        } else if (this.mode === MINIMAP_MODE.OPEN) {\n            this.mode = MINIMAP_MODE.MAXIMIZED;\n        } else {\n            this.mode = MINIMAP_MODE.MINIMIZED;\n        }\n\n        this.update();\n    }\n\n    /**\n     * Update minimap display\n     */\n    update() {\n        if (this.destroyed) return;\n        this.clear();\n        this.render();\n    }\n\n    /**\n     * Clear all minimap elements\n     */\n    clear() {\n        this.elements.forEach(el => {\n            try {\n                if (el && el.exists()) {\n                    this.k.destroy(el);\n                }\n            } catch (e) {\n                // Element may have been destroyed by scene transition\n            }\n        });\n        this.elements = [];\n    }\n\n    /**\n     * Render minimap based on current mode\n     */\n    render() {\n        if (this.destroyed) return;\n\n        if (this.mode === MINIMAP_MODE.MINIMIZED) {\n            this.renderMinimized();\n        } else if (this.mode === MINIMAP_MODE.OPEN) {\n            this.renderOpen();\n        } else {\n            this.renderMaximized();\n        }\n    }\n\n    /**\n     * Create a clickable background panel with hover effect\n     */\n    createPanel(width, height, x, y) {\n        const bg = this.k.add([\n            this.k.rect(width, height),\n            this.k.pos(x, y),\n            this.k.anchor('topright'),\n            this.k.color(...COLORS.BG_PANEL),\n            this.k.outline(2, this.k.rgb(...COLORS.BORDER)),\n            this.k.fixed(),\n            this.k.z(LAYOUT.Z_BASE),\n            this.k.area(),\n            this.k.opacity(0.95),\n            'minimap'\n        ]);\n\n        bg.onHover(() => {\n            bg.outline.color = this.k.rgb(...COLORS.BORDER_HOVER);\n            bg.outline.width = 3;\n        });\n\n        bg.onHoverEnd(() => {\n            bg.outline.color = this.k.rgb(...COLORS.BORDER);\n            bg.outline.width = 2;\n        });\n\n        bg.onClick(() => this.toggle());\n        this.elements.push(bg);\n        return bg;\n    }\n\n    /**\n     * Render minimized state - compact map button\n     */\n    renderMinimized() {\n        const x = this.getRightX();\n        const y = this.getTopY();\n        const size = LAYOUT.BUTTON_SIZE;\n\n        // Button background\n        this.createPanel(size, size, x, y);\n\n        // Calculate center of button (panel anchored topright, so center is left and down from anchor)\n        const centerX = x - size / 2;\n        const centerY = y + size / 2;\n\n        // Map icon\n        const icon = this.k.add([\n            this.k.text('', { size: 22 }),\n            this.k.pos(centerX, centerY),\n            this.k.anchor('center'),\n            this.k.color(...COLORS.ICON_MAP),\n            this.k.fixed(),\n            this.k.z(LAYOUT.Z_TEXT),\n            'minimap'\n        ]);\n        this.elements.push(icon);\n\n        // Floor number badge (top-left corner of button)\n        const badge = this.k.add([\n            this.k.text(`F${this.floorMap.floor}`, { size: 9 }),\n            this.k.pos(x - size + 4, y + 4),\n            this.k.anchor('topleft'),\n            this.k.color(...COLORS.BADGE_FLOOR),\n            this.k.fixed(),\n            this.k.z(LAYOUT.Z_ICON),\n            'minimap'\n        ]);\n        this.elements.push(badge);\n    }\n\n    /**\n     * Render open state - compact minimap without legend\n     */\n    renderOpen() {\n        const x = this.getRightX();\n        const y = this.getTopY();\n        const width = LAYOUT.OPEN_WIDTH;\n        const height = LAYOUT.OPEN_HEIGHT;\n        const cellSize = LAYOUT.CELL_SIZE_SMALL;\n        const grid = this.floorMap.getGridForMinimap();\n\n        // Safety check for empty grid\n        if (!grid || grid.length === 0 || !grid[0]) {\n            this.renderMinimized();\n            return;\n        }\n\n        // Background panel\n        this.createPanel(width, height, x, y);\n\n        // Header bar\n        const headerHeight = 18;\n        const header = this.k.add([\n            this.k.rect(width - 4, headerHeight),\n            this.k.pos(x - 2, y + 2),\n            this.k.anchor('topright'),\n            this.k.color(...COLORS.BG_HEADER),\n            this.k.fixed(),\n            this.k.z(LAYOUT.Z_TEXT),\n            'minimap'\n        ]);\n        this.elements.push(header);\n\n        // Title\n        const title = this.k.add([\n            this.k.text(`Floor ${this.floorMap.floor}`, { size: 10 }),\n            this.k.pos(x - width / 2, y + 2 + headerHeight / 2),\n            this.k.anchor('center'),\n            this.k.color(...COLORS.TEXT_TITLE),\n            this.k.fixed(),\n            this.k.z(LAYOUT.Z_ICON),\n            'minimap'\n        ]);\n        this.elements.push(title);\n\n        // Grid area\n        const gridWidth = grid[0].length * cellSize;\n        const gridHeight = grid.length * cellSize;\n        const gridStartX = x - width / 2 - gridWidth / 2;\n        const gridStartY = y + headerHeight + 8;\n\n        this.renderGrid(grid, gridStartX, gridStartY, cellSize, false);\n\n        // Room counter at bottom\n        const counter = this.k.add([\n            this.k.text(`${this.floorMap.getVisitedCount()}/${this.floorMap.getTotalRooms()} rooms`, { size: 8 }),\n            this.k.pos(x - width / 2, y + height - 8),\n            this.k.anchor('center'),\n            this.k.color(...COLORS.TEXT_MUTED),\n            this.k.fixed(),\n            this.k.z(LAYOUT.Z_TEXT),\n            'minimap'\n        ]);\n        this.elements.push(counter);\n    }\n\n    /**\n     * Render maximized state - full minimap with legend\n     */\n    renderMaximized() {\n        const x = this.getRightX();\n        const y = this.getTopY();\n        const cellSize = LAYOUT.CELL_SIZE_LARGE;\n        const grid = this.floorMap.getGridForMinimap();\n\n        // Safety check for empty grid\n        if (!grid || grid.length === 0 || !grid[0]) {\n            this.renderMinimized();\n            return;\n        }\n\n        // Calculate dimensions based on grid\n        const gridWidth = grid[0].length * cellSize;\n        const gridHeight = grid.length * cellSize;\n        const legendHeight = 70;\n        const headerHeight = 26;\n        const padding = 16;\n\n        const width = Math.max(LAYOUT.MAX_MIN_WIDTH, gridWidth + padding * 2);\n        const height = Math.max(LAYOUT.MAX_MIN_HEIGHT, gridHeight + headerHeight + legendHeight + padding);\n\n        // Ensure it stays on screen (left edge)\n        const safeWidth = Math.min(width, this.k.width() - LAYOUT.MARGIN_RIGHT - 10);\n\n        // Background panel\n        this.createPanel(safeWidth, height, x, y);\n\n        // Header bar\n        const header = this.k.add([\n            this.k.rect(safeWidth - 4, headerHeight),\n            this.k.pos(x - 2, y + 2),\n            this.k.anchor('topright'),\n            this.k.color(...COLORS.BG_HEADER),\n            this.k.fixed(),\n            this.k.z(LAYOUT.Z_TEXT),\n            'minimap'\n        ]);\n        this.elements.push(header);\n\n        // Title with room count\n        const title = this.k.add([\n            this.k.text(`FLOOR ${this.floorMap.floor}    ${this.floorMap.getVisitedCount()}/${this.floorMap.getTotalRooms()}`, { size: 11 }),\n            this.k.pos(x - safeWidth / 2, y + 2 + headerHeight / 2),\n            this.k.anchor('center'),\n            this.k.color(...COLORS.TEXT_TITLE),\n            this.k.fixed(),\n            this.k.z(LAYOUT.Z_ICON),\n            'minimap'\n        ]);\n        this.elements.push(title);\n\n        // Grid area (centered)\n        const actualGridWidth = Math.min(gridWidth, safeWidth - padding * 2);\n        const gridStartX = x - safeWidth / 2 - actualGridWidth / 2;\n        const gridStartY = y + headerHeight + 12;\n\n        this.renderGrid(grid, gridStartX, gridStartY, cellSize, true);\n\n        // Legend section\n        const legendY = gridStartY + gridHeight + 12;\n        this.renderLegend(x - safeWidth + padding, legendY);\n    }\n\n    /**\n     * Render the room grid\n     */\n    renderGrid(grid, startX, startY, cellSize, showBackground) {\n        for (let row = 0; row < grid.length; row++) {\n            for (let col = 0; col < grid[row].length; col++) {\n                const cell = grid[row][col];\n                const cellX = startX + col * cellSize;\n                const cellY = startY + row * cellSize;\n\n                if (cell.type === 'empty') continue;\n\n                // Cell background (only in maximized)\n                if (showBackground) {\n                    const cellBg = this.k.add([\n                        this.k.rect(cellSize - 2, cellSize - 2),\n                        this.k.pos(cellX, cellY),\n                        this.k.anchor('topleft'),\n                        this.k.color(...COLORS.CELL_BG),\n                        this.k.outline(1, this.k.rgb(...COLORS.CELL_BORDER)),\n                        this.k.fixed(),\n                        this.k.z(LAYOUT.Z_TEXT),\n                        'minimap'\n                    ]);\n                    this.elements.push(cellBg);\n                }\n\n                // Cell icon\n                const { char, color } = this.getCellDisplay(cell);\n                if (char) {\n                    const fontSize = showBackground ? 12 : 9;\n                    const cellText = this.k.add([\n                        this.k.text(char, { size: fontSize }),\n                        this.k.pos(cellX + cellSize / 2 - 1, cellY + cellSize / 2 - 1),\n                        this.k.anchor('center'),\n                        this.k.color(...color),\n                        this.k.fixed(),\n                        this.k.z(LAYOUT.Z_ICON),\n                        'minimap'\n                    ]);\n                    this.elements.push(cellText);\n                }\n            }\n        }\n    }\n\n    /**\n     * Get display character and color for a cell\n     */\n    getCellDisplay(cell) {\n        switch (cell.type) {\n            case 'current':\n                return { char: '', color: COLORS.CURRENT };\n            case 'visited':\n                return cell.room.isBossRoom\n                    ? { char: 'B', color: COLORS.BOSS }\n                    : { char: '', color: COLORS.VISITED };\n            case 'revealed':\n                return cell.room.isBossRoom\n                    ? { char: 'B', color: [...COLORS.BOSS.map(c => Math.min(255, c + 50))] }\n                    : { char: '', color: COLORS.AVAILABLE };\n            case 'hidden':\n                return { char: '', color: COLORS.HIDDEN };\n            default:\n                return { char: '', color: [100, 100, 100] };\n        }\n    }\n\n    /**\n     * Render the legend section\n     */\n    renderLegend(startX, startY) {\n        const legends = [\n            { char: '', label: 'Current', color: COLORS.CURRENT },\n            { char: '', label: 'Cleared', color: COLORS.VISITED },\n            { char: '', label: 'Available', color: COLORS.AVAILABLE },\n            { char: 'B', label: 'Boss', color: COLORS.BOSS }\n        ];\n\n        // Arrange in 2x2 grid for compact layout\n        const colWidth = 80;\n        const rowHeight = 14;\n\n        legends.forEach((legend, i) => {\n            const col = i % 2;\n            const row = Math.floor(i / 2);\n            const itemX = startX + col * colWidth;\n            const itemY = startY + row * rowHeight;\n\n            const symbol = this.k.add([\n                this.k.text(legend.char, { size: 10 }),\n                this.k.pos(itemX, itemY),\n                this.k.anchor('topleft'),\n                this.k.color(...legend.color),\n                this.k.fixed(),\n                this.k.z(LAYOUT.Z_ICON),\n                'minimap'\n            ]);\n            this.elements.push(symbol);\n\n            const label = this.k.add([\n                this.k.text(legend.label, { size: 8 }),\n                this.k.pos(itemX + 14, itemY + 1),\n                this.k.anchor('topleft'),\n                this.k.color(...COLORS.TEXT_MUTED),\n                this.k.fixed(),\n                this.k.z(LAYOUT.Z_ICON),\n                'minimap'\n            ]);\n            this.elements.push(label);\n        });\n    }\n\n    /**\n     * Cleanup - destroy all minimap elements\n     */\n    destroy() {\n        this.destroyed = true;\n        this.clear();\n    }\n}\n\n/**\n * Create and initialize minimap\n */\nexport function createMinimap(k, floorMap) {\n    return new Minimap(k, floorMap);\n}\n","/**\n * Floor Theming System\n *\n * Adds cosmetic floor decorations that vary by floor theme.\n * Each floor has a distinct personality with unique:\n * - Visual decorations and patterns\n * - Color schemes\n * - Environmental storytelling\n * Decorations are purely visual and don't impact gameplay clarity.\n */\n\n// Floor theme definitions - Each floor tells a story\nconst FLOOR_THEMES = {\n    city: {\n        name: 'Urban Streets',\n        description: 'Abandoned city blocks overrun by chaos',\n        floors: [1],\n        decorations: [\n            // Road markings - faded crosswalks and lanes\n            { char: '', pattern: 'horizontal_lines', density: 'medium', opacity: 0.18 },\n            { char: '', pattern: 'vertical_lines', density: 'low', opacity: 0.15 },\n            // Manholes and storm drains\n            { char: '', pattern: 'scattered', count: 4, opacity: 0.22 },\n            { char: '', pattern: 'scattered', count: 3, opacity: 0.18 },\n            // Debris and cracks in pavement\n            { char: '', pattern: 'random', count: 12, opacity: 0.12 },\n            { char: '', pattern: 'random', count: 12, opacity: 0.12 },\n            // Trash and litter\n            { char: '', pattern: 'random', count: 6, opacity: 0.1 },\n            // Broken glass reflections\n            { char: '', pattern: 'scattered', count: 15, opacity: 0.08 }\n        ],\n        baseColor: [55, 55, 65], // Cool gray asphalt\n        ambientColor: [70, 70, 80] // Dim streetlight glow\n    },\n    mechanical: {\n        name: 'Industrial Complex',\n        description: 'Rusted factories and hazardous machinery',\n        floors: [2],\n        decorations: [\n            // Heavy metal plating - factory floor\n            { char: '', pattern: 'horizontal_lines', density: 'high', opacity: 0.15 },\n            { char: '', pattern: 'grid', spacing: 70, opacity: 0.18 },\n            // Grates and ventilation\n            { char: '', pattern: 'scattered', count: 5, opacity: 0.22 },\n            { char: '', pattern: 'scattered', count: 4, opacity: 0.2 },\n            // Rivets and bolts\n            { char: '', pattern: 'edges', count: 16, opacity: 0.16 },\n            { char: '', pattern: 'corners', opacity: 0.24 },\n            // Oil stains and rust\n            { char: '', pattern: 'random', count: 10, opacity: 0.1 },\n            // Caution markings\n            { char: '', pattern: 'scattered', count: 2, opacity: 0.15 },\n            // Pipes running along floor\n            { char: '', pattern: 'horizontal_lines', density: 'low', opacity: 0.12 }\n        ],\n        baseColor: [75, 60, 50], // Rusty brown-orange\n        ambientColor: [90, 75, 60] // Warm industrial lighting\n    },\n    futuristic: {\n        name: 'Cyber Station',\n        description: 'High-tech facility with malfunctioning systems',\n        floors: [3],\n        decorations: [\n            // Clean panel seams - futuristic flooring\n            { char: '', pattern: 'vertical_lines', density: 'medium', opacity: 0.16 },\n            { char: '', pattern: 'horizontal_lines', density: 'medium', opacity: 0.16 },\n            // Holographic floor panels\n            { char: '', pattern: 'grid', spacing: 90, opacity: 0.14 },\n            { char: '', pattern: 'scattered', count: 6, opacity: 0.18 },\n            // Data nodes and access points\n            { char: '', pattern: 'corners', opacity: 0.22 },\n            { char: '', pattern: 'scattered', count: 8, opacity: 0.16 },\n            // Circuit traces\n            { char: '', pattern: 'grid', spacing: 150, opacity: 0.1 },\n            // Flickering indicators\n            { char: '', pattern: 'random', count: 5, opacity: 0.12 },\n            // Light strips\n            { char: '', pattern: 'edges', count: 20, opacity: 0.15 }\n        ],\n        baseColor: [45, 55, 75], // Cool blue steel\n        ambientColor: [60, 80, 120] // Neon blue glow\n    },\n    alien: {\n        name: 'Alien Vessel',\n        description: 'Otherworldly organic ship interior',\n        floors: [4],\n        decorations: [\n            // Organic pulsing patterns\n            { char: '', pattern: 'wavy_lines', density: 'medium', opacity: 0.15 },\n            { char: '~', pattern: 'random', count: 20, opacity: 0.12 },\n            // Bio-luminescent nodes\n            { char: '', pattern: 'scattered', count: 5, opacity: 0.2 },\n            { char: '', pattern: 'grid', spacing: 110, opacity: 0.16 },\n            // Alien symbols and markings\n            { char: '', pattern: 'corners', opacity: 0.2 },\n            { char: '', pattern: 'scattered', count: 6, opacity: 0.16 },\n            // Membrane textures\n            { char: '', pattern: 'random', count: 12, opacity: 0.1 },\n            // Spore-like particles\n            { char: '', pattern: 'scattered', count: 15, opacity: 0.08 },\n            // Veins/tendrils pattern\n            { char: '', pattern: 'random', count: 8, opacity: 0.12 },\n            { char: '', pattern: 'random', count: 8, opacity: 0.12 }\n        ],\n        baseColor: [60, 45, 70], // Deep purple organic\n        ambientColor: [80, 60, 100] // Bioluminescent purple glow\n    },\n    // Future floors (5+) - extend the theming\n    void: {\n        name: 'The Void',\n        description: 'Reality breaks down at the edge of existence',\n        floors: [5, 6, 7, 8],\n        decorations: [\n            // Static and glitches\n            { char: '', pattern: 'random', count: 25, opacity: 0.15 },\n            { char: '', pattern: 'random', count: 15, opacity: 0.12 },\n            // Fragmented reality\n            { char: '', pattern: 'scattered', count: 8, opacity: 0.18 },\n            { char: '', pattern: 'grid', spacing: 120, opacity: 0.14 },\n            // Dimensional tears\n            { char: '', pattern: 'corners', opacity: 0.2 },\n            { char: '', pattern: 'scattered', count: 10, opacity: 0.16 },\n            // Entropy patterns\n            { char: '', pattern: 'random', count: 20, opacity: 0.1 },\n            { char: '', pattern: 'random', count: 20, opacity: 0.1 }\n        ],\n        baseColor: [35, 30, 45], // Deep void purple-black\n        ambientColor: [50, 40, 70] // Eldritch glow\n    }\n};\n\n/**\n * Get theme for current floor\n * @param {number} floor - Current floor number\n * @returns {object} - Floor theme configuration\n */\nexport function getFloorTheme(floor) {\n    for (const [key, theme] of Object.entries(FLOOR_THEMES)) {\n        if (theme.floors.includes(floor)) {\n            return { key, ...theme };\n        }\n    }\n    // Default to first available theme or city theme\n    return { key: 'city', ...FLOOR_THEMES.city };\n}\n\n/**\n * Generate floor decorations for the current room\n * @param {object} k - Kaplay instance\n * @param {number} floor - Current floor\n * @param {number} roomWidth - Room width\n * @param {number} roomHeight - Room height\n * @returns {Array} - Array of decoration objects to add to scene\n */\nexport function generateFloorDecorations(k, floor, roomWidth = 800, roomHeight = 600) {\n    const theme = getFloorTheme(floor);\n    const decorations = [];\n    const margin = 30; // Keep decorations away from edges\n\n    theme.decorations.forEach(deco => {\n        const baseColor = theme.baseColor;\n        const color = k.rgb(\n            baseColor[0] + (Math.random() - 0.5) * 20,\n            baseColor[1] + (Math.random() - 0.5) * 20,\n            baseColor[2] + (Math.random() - 0.5) * 20\n        );\n\n        switch (deco.pattern) {\n            case 'horizontal_lines': {\n                const spacing = deco.density === 'high' ? 40 : deco.density === 'medium' ? 80 : 120;\n                for (let y = margin; y < roomHeight - margin; y += spacing) {\n                    decorations.push({\n                        char: deco.char,\n                        x: roomWidth / 2,\n                        y: y + (Math.random() - 0.5) * 20,\n                        color: color,\n                        opacity: deco.opacity,\n                        size: 12\n                    });\n                }\n                break;\n            }\n            case 'vertical_lines': {\n                const spacing = deco.density === 'high' ? 40 : deco.density === 'medium' ? 80 : 120;\n                for (let x = margin; x < roomWidth - margin; x += spacing) {\n                    decorations.push({\n                        char: deco.char,\n                        x: x + (Math.random() - 0.5) * 20,\n                        y: roomHeight / 2,\n                        color: color,\n                        opacity: deco.opacity,\n                        size: 12\n                    });\n                }\n                break;\n            }\n            case 'wavy_lines': {\n                const spacing = 60;\n                for (let y = margin; y < roomHeight - margin; y += spacing) {\n                    for (let x = margin; x < roomWidth - margin; x += 40) {\n                        decorations.push({\n                            char: deco.char,\n                            x: x + Math.sin(y * 0.05) * 15,\n                            y: y,\n                            color: color,\n                            opacity: deco.opacity,\n                            size: 10\n                        });\n                    }\n                }\n                break;\n            }\n            case 'grid': {\n                const spacing = deco.spacing || 80;\n                for (let y = margin; y < roomHeight - margin; y += spacing) {\n                    for (let x = margin; x < roomWidth - margin; x += spacing) {\n                        decorations.push({\n                            char: deco.char,\n                            x: x + (Math.random() - 0.5) * 10,\n                            y: y + (Math.random() - 0.5) * 10,\n                            color: color,\n                            opacity: deco.opacity,\n                            size: 14\n                        });\n                    }\n                }\n                break;\n            }\n            case 'scattered': {\n                const count = deco.count || 5;\n                for (let i = 0; i < count; i++) {\n                    decorations.push({\n                        char: deco.char,\n                        x: margin + Math.random() * (roomWidth - margin * 2),\n                        y: margin + Math.random() * (roomHeight - margin * 2),\n                        color: color,\n                        opacity: deco.opacity,\n                        size: 16\n                    });\n                }\n                break;\n            }\n            case 'random': {\n                const count = deco.count || 10;\n                for (let i = 0; i < count; i++) {\n                    decorations.push({\n                        char: deco.char,\n                        x: margin + Math.random() * (roomWidth - margin * 2),\n                        y: margin + Math.random() * (roomHeight - margin * 2),\n                        color: color,\n                        opacity: deco.opacity,\n                        size: 10 + Math.random() * 6\n                    });\n                }\n                break;\n            }\n            case 'corners': {\n                const positions = [\n                    { x: margin + 40, y: margin + 40 },\n                    { x: roomWidth - margin - 40, y: margin + 40 },\n                    { x: margin + 40, y: roomHeight - margin - 40 },\n                    { x: roomWidth - margin - 40, y: roomHeight - margin - 40 }\n                ];\n                positions.forEach(pos => {\n                    decorations.push({\n                        char: deco.char,\n                        x: pos.x,\n                        y: pos.y,\n                        color: color,\n                        opacity: deco.opacity,\n                        size: 18\n                    });\n                });\n                break;\n            }\n            case 'edges': {\n                const count = deco.count || 8;\n                const perSide = Math.floor(count / 4);\n                // Top edge\n                for (let i = 0; i < perSide; i++) {\n                    decorations.push({\n                        char: deco.char,\n                        x: (roomWidth / perSide) * i + roomWidth / (perSide * 2),\n                        y: margin + 20,\n                        color: color,\n                        opacity: deco.opacity,\n                        size: 12\n                    });\n                }\n                // Bottom edge\n                for (let i = 0; i < perSide; i++) {\n                    decorations.push({\n                        char: deco.char,\n                        x: (roomWidth / perSide) * i + roomWidth / (perSide * 2),\n                        y: roomHeight - margin - 20,\n                        color: color,\n                        opacity: deco.opacity,\n                        size: 12\n                    });\n                }\n                // Left edge\n                for (let i = 0; i < perSide; i++) {\n                    decorations.push({\n                        char: deco.char,\n                        x: margin + 20,\n                        y: (roomHeight / perSide) * i + roomHeight / (perSide * 2),\n                        color: color,\n                        opacity: deco.opacity,\n                        size: 12\n                    });\n                }\n                // Right edge\n                for (let i = 0; i < perSide; i++) {\n                    decorations.push({\n                        char: deco.char,\n                        x: roomWidth - margin - 20,\n                        y: (roomHeight / perSide) * i + roomHeight / (perSide * 2),\n                        color: color,\n                        opacity: deco.opacity,\n                        size: 12\n                    });\n                }\n                break;\n            }\n        }\n    });\n\n    return decorations;\n}\n\n/**\n * Render floor decorations in the game scene\n * @param {object} k - Kaplay instance\n * @param {number} floor - Current floor\n * @param {number} roomWidth - Room width\n * @param {number} roomHeight - Room height\n */\nexport function renderFloorDecorations(k, floor, roomWidth = 800, roomHeight = 600) {\n    const decorations = generateFloorDecorations(k, floor, roomWidth, roomHeight);\n\n    decorations.forEach(deco => {\n        k.add([\n            k.text(deco.char, { size: deco.size }),\n            k.pos(deco.x, deco.y),\n            k.color(deco.color),\n            k.opacity(deco.opacity),\n            k.z(0), // Behind everything else\n            'floorDecoration'\n        ]);\n    });\n}\n","/**\n * Game State Manager\n *\n * Centralized, serializable game state for single and multiplayer support.\n * All game state is stored here and can be synchronized across clients.\n *\n * Design Philosophy:\n * - Single source of truth\n * - Fully serializable (JSON.stringify-able)\n * - No KAPLAY objects in state (pure data only)\n * - Support for multiple players\n * - Deterministic updates\n */\n\nimport { PROGRESSION_CONFIG } from '../config/constants.js';\n\n/**\n * Player state for a single player\n */\nexport class PlayerState {\n    constructor(playerId, characterKey) {\n        this.playerId = playerId; // Unique player ID\n        this.characterKey = characterKey; // Character type key\n\n        // Position & movement\n        this.x = 400;\n        this.y = 300;\n        this.velocityX = 0;\n        this.velocityY = 0;\n\n        // Stats (will be initialized from character data)\n        this.health = 100;\n        this.maxHealth = 100;\n        this.speed = 150;\n\n        // Progression\n        this.level = PROGRESSION_CONFIG.STARTING_LEVEL;\n        this.xp = PROGRESSION_CONFIG.STARTING_XP;\n        this.xpToNext = PROGRESSION_CONFIG.BASE_XP_TO_NEXT_LEVEL;\n        this.xpMultiplier = 1.0;\n\n        // Weapon & Combat\n        this.weaponKey = 'pistol';\n        this.fireRate = 1.5;\n        this.projectileSpeed = 300;\n        this.projectileDamage = 10;\n        this.projectileCount = 1;\n        this.piercing = 0;\n        this.obstaclePiercing = 0;\n        this.critChance = 0.05;\n        this.critDamage = 2.0;\n        this.spreadAngle = 0;\n        this.weaponRange = 600;\n\n        // Passive stats\n        this.pickupRadius = 30;\n        this.defense = 0;\n        this.damageReduction = 0;\n        this.dodgeChance = 0;\n\n        // State flags\n        this.invulnerable = false;\n        this.invulnerableTime = 0;\n        this.slowed = false;\n        this.isDead = false;\n\n        // Upgrades\n        this.weapons = []; // Array of equipped weapon keys\n        this.passiveUpgrades = []; // Array of passive upgrade keys\n        this.upgradeStacks = {}; // { upgradeKey: count }\n\n        // Input state (for this player)\n        this.input = {\n            moveX: 0, // -1, 0, 1\n            moveY: 0, // -1, 0, 1\n            aimX: 0, // Mouse position X\n            aimY: 0, // Mouse position Y\n            firing: false\n        };\n    }\n\n    /**\n     * Serialize player state to JSON\n     */\n    toJSON() {\n        return {\n            playerId: this.playerId,\n            characterKey: this.characterKey,\n            x: this.x,\n            y: this.y,\n            velocityX: this.velocityX,\n            velocityY: this.velocityY,\n            health: this.health,\n            maxHealth: this.maxHealth,\n            speed: this.speed,\n            level: this.level,\n            xp: this.xp,\n            xpToNext: this.xpToNext,\n            xpMultiplier: this.xpMultiplier,\n            weaponKey: this.weaponKey,\n            fireRate: this.fireRate,\n            projectileSpeed: this.projectileSpeed,\n            projectileDamage: this.projectileDamage,\n            projectileCount: this.projectileCount,\n            piercing: this.piercing,\n            obstaclePiercing: this.obstaclePiercing,\n            critChance: this.critChance,\n            critDamage: this.critDamage,\n            spreadAngle: this.spreadAngle,\n            weaponRange: this.weaponRange,\n            pickupRadius: this.pickupRadius,\n            defense: this.defense,\n            damageReduction: this.damageReduction,\n            dodgeChance: this.dodgeChance,\n            invulnerable: this.invulnerable,\n            invulnerableTime: this.invulnerableTime,\n            slowed: this.slowed,\n            isDead: this.isDead,\n            weapons: this.weapons,\n            passiveUpgrades: this.passiveUpgrades,\n            upgradeStacks: this.upgradeStacks\n        };\n    }\n\n    /**\n     * Create PlayerState from JSON\n     */\n    static fromJSON(json) {\n        const player = new PlayerState(json.playerId, json.characterKey);\n        Object.assign(player, json);\n        return player;\n    }\n}\n\n/**\n * Entity state (enemies, projectiles, pickups)\n */\nexport class EntityState {\n    constructor(id, type, x, y, data = {}) {\n        this.id = id; // Unique entity ID\n        this.type = type; // 'enemy', 'boss', 'miniboss', 'projectile', 'pickup', 'door', 'obstacle'\n        this.x = x;\n        this.y = y;\n        this.data = data; // Type-specific data\n        this.removed = false; // Mark for removal\n    }\n\n    toJSON() {\n        return {\n            id: this.id,\n            type: this.type,\n            x: this.x,\n            y: this.y,\n            data: this.data,\n            removed: this.removed\n        };\n    }\n\n    static fromJSON(json) {\n        return new EntityState(json.id, json.type, json.x, json.y, json.data);\n    }\n}\n\n/**\n * Main Game State\n * Contains all game state for single or multiplayer\n */\nexport class GameState {\n    constructor() {\n        // Game session info\n        this.sessionId = this.generateId();\n        this.gameMode = 'singleplayer'; // 'singleplayer' | 'coop'\n        this.isPaused = false;\n\n        // World state\n        this.currentFloor = 1;\n        this.currentRoom = 1;\n        this.roomCleared = false;\n        this.floorComplete = false;\n\n        // Players (supports 1-4 players)\n        this.players = new Map(); // playerId -> PlayerState\n        this.localPlayerId = null; // Which player is controlled locally\n\n        // Entities\n        this.entities = new Map(); // entityId -> EntityState\n        this.nextEntityId = 1;\n\n        // Room state\n        this.doors = []; // Door positions and states\n        this.obstacles = []; // Obstacle positions\n\n        // Meta progression (persistent across runs)\n        this.credits = 0;\n        this.totalCreditsEarned = 0;\n\n        // Game time\n        this.gameTime = 0; // Total game time in seconds\n        this.deltaTime = 0; // Time since last frame\n    }\n\n    /**\n     * Add a player to the game\n     */\n    addPlayer(playerId, characterKey) {\n        const player = new PlayerState(playerId, characterKey);\n        this.players.set(playerId, player);\n\n        // Set as local player if first player\n        if (this.localPlayerId === null) {\n            this.localPlayerId = playerId;\n        }\n\n        return player;\n    }\n\n    /**\n     * Get player by ID\n     */\n    getPlayer(playerId) {\n        return this.players.get(playerId);\n    }\n\n    /**\n     * Get local player (the player controlled by this client)\n     */\n    getLocalPlayer() {\n        return this.players.get(this.localPlayerId);\n    }\n\n    /**\n     * Get all players\n     */\n    getAllPlayers() {\n        return Array.from(this.players.values());\n    }\n\n    /**\n     * Add an entity to the game\n     */\n    addEntity(type, x, y, data = {}) {\n        const id = this.generateEntityId();\n        const entity = new EntityState(id, type, x, y, data);\n        this.entities.set(id, entity);\n        return entity;\n    }\n\n    /**\n     * Get entity by ID\n     */\n    getEntity(id) {\n        return this.entities.get(id);\n    }\n\n    /**\n     * Get all entities of a specific type\n     */\n    getEntitiesByType(type) {\n        return Array.from(this.entities.values()).filter(e => e.type === type && !e.removed);\n    }\n\n    /**\n     * Remove entity\n     */\n    removeEntity(id) {\n        const entity = this.entities.get(id);\n        if (entity) {\n            entity.removed = true;\n        }\n    }\n\n    /**\n     * Clean up removed entities\n     */\n    cleanupRemovedEntities() {\n        for (const [id, entity] of this.entities.entries()) {\n            if (entity.removed) {\n                this.entities.delete(id);\n            }\n        }\n    }\n\n    /**\n     * Update game time\n     */\n    updateTime(dt) {\n        this.deltaTime = dt;\n        this.gameTime += dt;\n    }\n\n    /**\n     * Progress to next room\n     */\n    nextRoom() {\n        this.currentRoom++;\n        this.roomCleared = false;\n    }\n\n    /**\n     * Progress to next floor\n     */\n    nextFloor() {\n        this.currentFloor++;\n        this.currentRoom = 1;\n        this.floorComplete = false;\n        this.roomCleared = false;\n    }\n\n    /**\n     * Mark current room as cleared\n     */\n    clearRoom() {\n        this.roomCleared = true;\n    }\n\n    /**\n     * Generate unique ID\n     */\n    generateId() {\n        return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    }\n\n    /**\n     * Generate unique entity ID\n     */\n    generateEntityId() {\n        return this.nextEntityId++;\n    }\n\n    /**\n     * Serialize entire game state to JSON\n     * This can be sent over network or saved to disk\n     */\n    toJSON() {\n        return {\n            sessionId: this.sessionId,\n            gameMode: this.gameMode,\n            isPaused: this.isPaused,\n            currentFloor: this.currentFloor,\n            currentRoom: this.currentRoom,\n            roomCleared: this.roomCleared,\n            players: Array.from(this.players.entries()).map(([id, player]) => [id, player.toJSON()]),\n            entities: Array.from(this.entities.entries()).map(([id, entity]) => [id, entity.toJSON()]),\n            doors: this.doors,\n            obstacles: this.obstacles,\n            gameTime: this.gameTime,\n            localPlayerId: this.localPlayerId,\n            nextEntityId: this.nextEntityId\n        };\n    }\n\n    /**\n     * Create GameState from JSON\n     * Used for loading saves or receiving state from server\n     */\n    static fromJSON(json) {\n        const state = new GameState();\n        state.sessionId = json.sessionId;\n        state.gameMode = json.gameMode;\n        state.isPaused = json.isPaused;\n        state.currentFloor = json.currentFloor;\n        state.currentRoom = json.currentRoom;\n        state.roomCleared = json.roomCleared;\n        state.gameTime = json.gameTime;\n        state.localPlayerId = json.localPlayerId;\n        state.nextEntityId = json.nextEntityId;\n\n        // Restore players\n        state.players = new Map(json.players.map(([id, playerJson]) =>\n            [id, PlayerState.fromJSON(playerJson)]\n        ));\n\n        // Restore entities\n        state.entities = new Map(json.entities.map(([id, entityJson]) =>\n            [id, EntityState.fromJSON(entityJson)]\n        ));\n\n        state.doors = json.doors;\n        state.obstacles = json.obstacles;\n\n        return state;\n    }\n\n    /**\n     * Create a snapshot of current state (for rollback/replay)\n     */\n    snapshot() {\n        return JSON.parse(JSON.stringify(this.toJSON()));\n    }\n\n    /**\n     * Reset state for new game\n     */\n    reset() {\n        this.currentFloor = 1;\n        this.currentRoom = 1;\n        this.roomCleared = false;\n        this.floorComplete = false;\n        this.players.clear();\n        this.entities.clear();\n        this.doors = [];\n        this.obstacles = [];\n        this.gameTime = 0;\n        this.nextEntityId = 1;\n    }\n}\n\n/**\n * Singleton State Manager\n * Provides global access to game state\n */\nclass StateManager {\n    constructor() {\n        this.gameState = null;\n    }\n\n    /**\n     * Initialize new game state\n     */\n    init(gameMode = 'singleplayer') {\n        this.gameState = new GameState();\n        this.gameState.gameMode = gameMode;\n        return this.gameState;\n    }\n\n    /**\n     * Get current game state\n     */\n    getState() {\n        if (!this.gameState) {\n            throw new Error('GameState not initialized! Call StateManager.init() first.');\n        }\n        return this.gameState;\n    }\n\n    /**\n     * Load state from JSON\n     */\n    loadState(json) {\n        this.gameState = GameState.fromJSON(json);\n        return this.gameState;\n    }\n\n    /**\n     * Clear state\n     */\n    clear() {\n        this.gameState = null;\n    }\n}\n\n// Export singleton instance\nexport const stateManager = new StateManager();\n","/**\n * Input Manager\n *\n * Handles input from local and remote players.\n * Decouples input collection from game logic for:\n * - Deterministic gameplay\n * - Multiplayer support\n * - Input recording/replay\n * - Client prediction\n *\n * Input Flow:\n * 1. Collect inputs from keyboard/mouse (local player)\n * 2. Queue inputs with timestamps\n * 3. Game logic processes inputs each frame\n * 4. (Future) Send local inputs to server, receive remote inputs\n */\n\n/**\n * Input state for a single player in a single frame\n */\nexport class PlayerInput {\n    constructor(playerId, frameNumber, timestamp) {\n        this.playerId = playerId;\n        this.frameNumber = frameNumber;\n        this.timestamp = timestamp;\n\n        // Movement input (-1, 0, 1 for each axis)\n        this.moveX = 0;\n        this.moveY = 0;\n\n        // Aim input (world coordinates)\n        this.aimX = 0;\n        this.aimY = 0;\n\n        // Action flags\n        this.firing = false;\n        this.pause = false;\n        this.interact = false; // For doors, chests, etc.\n    }\n\n    /**\n     * Serialize input to JSON\n     */\n    toJSON() {\n        return {\n            playerId: this.playerId,\n            frameNumber: this.frameNumber,\n            timestamp: this.timestamp,\n            moveX: this.moveX,\n            moveY: this.moveY,\n            aimX: this.aimX,\n            aimY: this.aimY,\n            firing: this.firing,\n            pause: this.pause,\n            interact: this.interact\n        };\n    }\n\n    /**\n     * Create PlayerInput from JSON\n     */\n    static fromJSON(json) {\n        const input = new PlayerInput(json.playerId, json.frameNumber, json.timestamp);\n        Object.assign(input, json);\n        return input;\n    }\n}\n\n/**\n * Input Manager\n * Collects and manages inputs from all players\n */\nexport class InputManager {\n    constructor() {\n        // Current frame number\n        this.frameNumber = 0;\n\n        // Input queues per player\n        this.inputQueues = new Map(); // playerId -> PlayerInput[]\n\n        // Current inputs for this frame (one per player)\n        this.currentInputs = new Map(); // playerId -> PlayerInput\n\n        // Input history for rollback (keep last N frames)\n        this.inputHistory = []; // Array of Map<playerId, PlayerInput>\n        this.maxHistoryFrames = 120; // Keep 2 seconds at 60fps\n\n        // Keyboard state tracking\n        this.keysPressed = new Set();\n\n        // Mouse state\n        this.mouseX = 0;\n        this.mouseY = 0;\n        this.mousePressed = false;\n\n        // Event handler references for cleanup (memory leak fix)\n        this.eventHandlers = [];\n    }\n\n    /**\n     * Initialize input manager with KAPLAY context\n     */\n    init(k) {\n        this.k = k;\n        this.setupKeyboardListeners();\n        this.setupMouseListeners();\n    }\n\n    /**\n     * Setup keyboard event listeners\n     */\n    setupKeyboardListeners() {\n        const k = this.k;\n\n        // Movement keys\n        const movementKeys = ['w', 'a', 's', 'd', 'up', 'down', 'left', 'right'];\n\n        movementKeys.forEach(key => {\n            this.eventHandlers.push(k.onKeyPress(key, () => {\n                this.keysPressed.add(key);\n            }));\n\n            this.eventHandlers.push(k.onKeyRelease(key, () => {\n                this.keysPressed.delete(key);\n            }));\n        });\n\n        // Pause\n        this.eventHandlers.push(k.onKeyPress('escape', () => {\n            this.onPausePressed();\n        }));\n\n        // Interact (for doors, etc.)\n        this.eventHandlers.push(k.onKeyPress('space', () => {\n            this.onInteractPressed();\n        }));\n        this.eventHandlers.push(k.onKeyPress('e', () => {\n            this.onInteractPressed();\n        }));\n    }\n\n    /**\n     * Setup mouse event listeners\n     */\n    setupMouseListeners() {\n        const k = this.k;\n\n        this.eventHandlers.push(k.onMouseMove((pos) => {\n            this.mouseX = pos.x;\n            this.mouseY = pos.y;\n        }));\n\n        this.eventHandlers.push(k.onMousePress(() => {\n            this.mousePressed = true;\n        }));\n\n        this.eventHandlers.push(k.onMouseRelease(() => {\n            this.mousePressed = false;\n        }));\n    }\n\n    /**\n     * Collect input for local player\n     */\n    collectLocalInput(playerId) {\n        const input = new PlayerInput(playerId, this.frameNumber, Date.now());\n\n        // Movement input\n        input.moveX = this.getMoveX();\n        input.moveY = this.getMoveY();\n\n        // Aim input\n        input.aimX = this.mouseX;\n        input.aimY = this.mouseY;\n\n        // Firing (for now, always fire if autofire)\n        // In the future, this could be mouse button\n        input.firing = true;\n\n        return input;\n    }\n\n    /**\n     * Get horizontal movement input (-1, 0, 1)\n     */\n    getMoveX() {\n        let moveX = 0;\n        if (this.keysPressed.has('a') || this.keysPressed.has('left')) {\n            moveX -= 1;\n        }\n        if (this.keysPressed.has('d') || this.keysPressed.has('right')) {\n            moveX += 1;\n        }\n        return moveX;\n    }\n\n    /**\n     * Get vertical movement input (-1, 0, 1)\n     */\n    getMoveY() {\n        let moveY = 0;\n        if (this.keysPressed.has('w') || this.keysPressed.has('up')) {\n            moveY -= 1;\n        }\n        if (this.keysPressed.has('s') || this.keysPressed.has('down')) {\n            moveY += 1;\n        }\n        return moveY;\n    }\n\n    /**\n     * Called when pause key is pressed\n     */\n    onPausePressed() {\n        // Handle pause in game logic\n        // For now, just set a flag\n        this.pauseRequested = true;\n    }\n\n    /**\n     * Called when interact key is pressed\n     */\n    onInteractPressed() {\n        this.interactRequested = true;\n    }\n\n    /**\n     * Queue input for a player\n     * Used for remote player inputs received from network\n     */\n    queueInput(input) {\n        if (!this.inputQueues.has(input.playerId)) {\n            this.inputQueues.set(input.playerId, []);\n        }\n        this.inputQueues.get(input.playerId).push(input);\n    }\n\n    /**\n     * Get inputs for all players for current frame\n     * This is called each game tick\n     */\n    getInputsForFrame(playerIds) {\n        const inputs = new Map();\n\n        for (const playerId of playerIds) {\n            // Check if we have queued input for this player\n            const queue = this.inputQueues.get(playerId);\n            let input;\n\n            if (queue && queue.length > 0) {\n                // Get next input from queue (for remote players)\n                input = queue.shift();\n            } else {\n                // Collect local input (for local player)\n                input = this.collectLocalInput(playerId);\n            }\n\n            inputs.set(playerId, input);\n        }\n\n        // Save current inputs\n        this.currentInputs = inputs;\n\n        // Add to history\n        this.inputHistory.push(new Map(inputs));\n        if (this.inputHistory.length > this.maxHistoryFrames) {\n            this.inputHistory.shift();\n        }\n\n        this.frameNumber++;\n\n        return inputs;\n    }\n\n    /**\n     * Get input for specific player in current frame\n     */\n    getPlayerInput(playerId) {\n        return this.currentInputs.get(playerId);\n    }\n\n    /**\n     * Get input history for rollback/replay\n     */\n    getInputHistory() {\n        return this.inputHistory;\n    }\n\n    /**\n     * Clear input state\n     */\n    clear() {\n        // Cancel all event handlers (memory leak fix)\n        this.eventHandlers.forEach(handler => {\n            if (handler && handler.cancel) {\n                handler.cancel();\n            }\n        });\n        this.eventHandlers = [];\n\n        this.frameNumber = 0;\n        this.inputQueues.clear();\n        this.currentInputs.clear();\n        this.inputHistory = [];\n        this.keysPressed.clear();\n        this.pauseRequested = false;\n        this.interactRequested = false;\n    }\n\n    /**\n     * Reset frame-specific flags\n     */\n    resetFrameFlags() {\n        this.pauseRequested = false;\n        this.interactRequested = false;\n    }\n}\n\n/**\n * Singleton Input Manager\n */\nclass InputManagerSingleton {\n    constructor() {\n        this.inputManager = null;\n    }\n\n    /**\n     * Initialize input manager\n     */\n    init(k) {\n        this.inputManager = new InputManager();\n        this.inputManager.init(k);\n        return this.inputManager;\n    }\n\n    /**\n     * Get current input manager\n     */\n    getManager() {\n        if (!this.inputManager) {\n            throw new Error('InputManager not initialized! Call InputManager.init() first.');\n        }\n        return this.inputManager;\n    }\n\n    /**\n     * Clear input manager\n     */\n    clear() {\n        if (this.inputManager) {\n            this.inputManager.clear();\n        }\n        this.inputManager = null;\n    }\n}\n\n// Export singleton instance\nexport const inputManager = new InputManagerSingleton();\n","/**\n * Network Manager\n *\n * Abstraction layer for multiplayer networking.\n * Currently a placeholder/interface for future implementation.\n *\n * Future implementations could use:\n * - WebRTC (peer-to-peer)\n * - WebSocket (client-server)\n * - Photon, Colyseus, or other game networking libraries\n *\n * For now, this provides the interface and defaults to local-only mode.\n */\n\n/**\n * Network message types\n */\nexport const MessageType = {\n    // Connection\n    CONNECT: 'connect',\n    DISCONNECT: 'disconnect',\n\n    // Game state\n    STATE_SYNC: 'state_sync',\n    STATE_UPDATE: 'state_update',\n\n    // Player input\n    INPUT: 'input',\n    INPUT_ACK: 'input_ack',\n\n    // Game events\n    PLAYER_JOINED: 'player_joined',\n    PLAYER_LEFT: 'player_left',\n    GAME_START: 'game_start',\n    GAME_END: 'game_end',\n\n    // Chat (future)\n    CHAT_MESSAGE: 'chat_message'\n};\n\n/**\n * Network message\n */\nexport class NetworkMessage {\n    constructor(type, data, senderId = null) {\n        this.type = type;\n        this.data = data;\n        this.senderId = senderId;\n        this.timestamp = Date.now();\n    }\n\n    toJSON() {\n        return {\n            type: this.type,\n            data: this.data,\n            senderId: this.senderId,\n            timestamp: this.timestamp\n        };\n    }\n\n    static fromJSON(json) {\n        const msg = new NetworkMessage(json.type, json.data, json.senderId);\n        msg.timestamp = json.timestamp;\n        return msg;\n    }\n}\n\n/**\n * Network Manager\n * Handles all network communication for multiplayer\n */\nexport class NetworkManager {\n    constructor() {\n        // Connection state\n        this.isConnected = false;\n        this.isHost = false;\n        this.localPlayerId = null;\n        this.sessionId = null;\n\n        // Connected players\n        this.players = new Map(); // playerId -> playerInfo\n\n        // Message queue\n        this.messageQueue = [];\n\n        // Event handlers\n        this.eventHandlers = new Map();\n\n        // Network mode\n        this.mode = 'local'; // 'local' | 'client' | 'host'\n    }\n\n    /**\n     * Initialize network manager\n     */\n    init(mode = 'local') {\n        this.mode = mode;\n        this.localPlayerId = this.generatePlayerId();\n\n        // For local mode, immediately \"connect\"\n        if (mode === 'local') {\n            this.isConnected = true;\n            this.isHost = true;\n            this.sessionId = this.generateSessionId();\n            this.addPlayer(this.localPlayerId, { name: 'Player 1', isLocal: true });\n        }\n\n        return this.localPlayerId;\n    }\n\n    /**\n     * Connect to a game session\n     * Future: Implement actual WebRTC/WebSocket connection\n     */\n    async connect(sessionId = null) {\n        if (this.mode === 'local') {\n            // Already connected in local mode\n            return true;\n        }\n\n        // TODO: Implement actual network connection\n        // For now, just simulate connection\n        this.isConnected = true;\n        this.sessionId = sessionId || this.generateSessionId();\n\n        this.emit('connected', { sessionId: this.sessionId });\n        return true;\n    }\n\n    /**\n     * Disconnect from game session\n     */\n    disconnect() {\n        if (this.isConnected) {\n            this.emit('disconnected');\n\n            // TODO: Close actual network connection\n\n            this.isConnected = false;\n            this.players.clear();\n            this.messageQueue = [];\n        }\n    }\n\n    /**\n     * Send message to remote players\n     * Future: Implement actual network send\n     */\n    send(type, data) {\n        const message = new NetworkMessage(type, data, this.localPlayerId);\n\n        if (this.mode === 'local') {\n            // In local mode, no need to send anywhere\n            return;\n        }\n\n        // TODO: Implement actual network send\n        // For now, just log\n        console.log('[Network] Send:', message);\n\n        // Simulate message send\n        this.messageQueue.push(message);\n    }\n\n    /**\n     * Broadcast message to all players\n     */\n    broadcast(type, data) {\n        this.send(type, data);\n    }\n\n    /**\n     * Send message to specific player\n     */\n    sendTo(playerId, type, data) {\n        const message = new NetworkMessage(type, data, this.localPlayerId);\n        // TODO: Implement targeted send\n        console.log(`[Network] SendTo ${playerId}:`, message);\n    }\n\n    /**\n     * Receive and process messages\n     * Called each frame to process incoming messages\n     */\n    receive() {\n        const messages = [...this.messageQueue];\n        this.messageQueue = [];\n\n        for (const message of messages) {\n            this.handleMessage(message);\n        }\n\n        return messages;\n    }\n\n    /**\n     * Handle incoming message\n     */\n    handleMessage(message) {\n        // Emit event for message type\n        this.emit(message.type, message.data, message.senderId);\n\n        // Handle specific message types\n        switch (message.type) {\n            case MessageType.PLAYER_JOINED:\n                this.addPlayer(message.senderId, message.data);\n                break;\n            case MessageType.PLAYER_LEFT:\n                this.removePlayer(message.senderId);\n                break;\n            // Add more handlers as needed\n        }\n    }\n\n    /**\n     * Add player to session\n     */\n    addPlayer(playerId, playerInfo) {\n        this.players.set(playerId, {\n            id: playerId,\n            ...playerInfo,\n            joinedAt: Date.now()\n        });\n\n        this.emit('playerJoined', { playerId, playerInfo });\n    }\n\n    /**\n     * Remove player from session\n     */\n    removePlayer(playerId) {\n        const playerInfo = this.players.get(playerId);\n        this.players.delete(playerId);\n\n        this.emit('playerLeft', { playerId, playerInfo });\n    }\n\n    /**\n     * Get all connected players\n     */\n    getPlayers() {\n        return Array.from(this.players.values());\n    }\n\n    /**\n     * Check if player is connected\n     */\n    isPlayerConnected(playerId) {\n        return this.players.has(playerId);\n    }\n\n    /**\n     * Register event handler\n     */\n    on(eventType, handler) {\n        if (!this.eventHandlers.has(eventType)) {\n            this.eventHandlers.set(eventType, []);\n        }\n        this.eventHandlers.get(eventType).push(handler);\n    }\n\n    /**\n     * Unregister event handler\n     */\n    off(eventType, handler) {\n        if (this.eventHandlers.has(eventType)) {\n            const handlers = this.eventHandlers.get(eventType);\n            const index = handlers.indexOf(handler);\n            if (index > -1) {\n                handlers.splice(index, 1);\n            }\n        }\n    }\n\n    /**\n     * Emit event\n     */\n    emit(eventType, data, senderId = null) {\n        if (this.eventHandlers.has(eventType)) {\n            const handlers = this.eventHandlers.get(eventType);\n            for (const handler of handlers) {\n                handler(data, senderId);\n            }\n        }\n    }\n\n    /**\n     * Generate unique player ID\n     */\n    generatePlayerId() {\n        return `player-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    }\n\n    /**\n     * Generate unique session ID\n     */\n    generateSessionId() {\n        return `session-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    }\n\n    /**\n     * Get latency/ping (future)\n     */\n    getPing() {\n        return 0; // Local mode has no latency\n    }\n\n    /**\n     * Check if this client is the host\n     */\n    isHostClient() {\n        return this.isHost;\n    }\n\n    /**\n     * Get local player ID\n     */\n    getLocalPlayerId() {\n        return this.localPlayerId;\n    }\n\n    /**\n     * Clear network state\n     */\n    clear() {\n        this.disconnect();\n        this.eventHandlers.clear();\n    }\n}\n\n/**\n * Singleton Network Manager\n */\nclass NetworkManagerSingleton {\n    constructor() {\n        this.networkManager = null;\n    }\n\n    /**\n     * Initialize network manager\n     */\n    init(mode = 'local') {\n        this.networkManager = new NetworkManager();\n        return this.networkManager.init(mode);\n    }\n\n    /**\n     * Get current network manager\n     */\n    getManager() {\n        if (!this.networkManager) {\n            throw new Error('NetworkManager not initialized! Call NetworkManager.init() first.');\n        }\n        return this.networkManager;\n    }\n\n    /**\n     * Clear network manager\n     */\n    clear() {\n        if (this.networkManager) {\n            this.networkManager.clear();\n        }\n        this.networkManager = null;\n    }\n}\n\n// Export singleton instance\nexport const networkManager = new NetworkManagerSingleton();\n","/**\n * Main Game Scene\n *\n * Handles the core gameplay loop including:\n * - Room generation and progression\n * - Enemy spawning and combat\n * - Boss encounters\n * - Player state management\n * - HUD and UI rendering\n *\n * Architecture:\n * - NEW: Integrates with centralized GameState for multiplayer support\n * - LEGACY: Maintains backward compatibility with existing systems\n */\n\n// Entity imports\nimport { createPlayer } from '../entities/player.js';\nimport { createEnemy } from '../entities/enemy.js';\nimport { createBoss, createTwinGuardians } from '../entities/boss.js';\nimport { createMiniboss } from '../entities/miniboss.js';\nimport { createXPPickup, createCurrencyPickup, getRandomCurrencyIcon, createPowerupWeaponPickup } from '../entities/pickup.js';\nimport { createDoor } from '../entities/door.js';\nimport { createObstacle } from '../entities/obstacle.js';\nimport { createProjectile } from '../entities/projectile.js';\nimport { createBarrel, clearAllBarrels, handleProjectileBarrelCollision, findBarrelByPosition, getAllBarrels } from '../entities/barrel.js';\n\n// System imports\nimport { SpatialGrid } from '../systems/spatialGrid.js';\nimport { initObjectPools, clearAllPools } from '../systems/objectPool.js';\nimport { setupCombatSystem } from '../systems/combat.js';\nimport { setupProgressionSystem } from '../systems/progression.js';\nimport { getRandomEnemyType } from '../systems/enemySpawn.js';\nimport { tryMakeElite } from '../systems/eliteSystem.js';\nimport { showMovementHint, showLevelUpHint } from '../systems/tutorial.js';\nimport { SeededRandom } from '../utils/seededRandom.js';\nimport { getWeightedRoomTemplate, getFloorColors, constrainObstacleToRoom, resetRoomTemplateHistory, getRoomTemplateByKey, getBarrelPositions } from '../systems/roomGeneration.js';\nimport { checkAndApplySynergies, trackUpgrade, reapplySynergies } from '../systems/synergies.js';\nimport { UPGRADES, recalculateAllUpgrades, applyUpgrade } from '../systems/upgrades.js';\nimport { updateRunStats, calculateCurrencyEarned, addCurrency, getCurrency, getPermanentUpgradeLevel, checkFloorUnlocks, recordRun, consumeBoosters, getEquippedCosmetics, getSelectedCharacter } from '../systems/metaProgression.js';\nimport { RUN_BOOSTER_UNLOCKS, COSMETIC_UNLOCKS } from '../data/unlocks.js';\nimport { checkAchievements, initAchievementChecker } from '../systems/achievementChecker.js';\nimport { isUpgradeDraftActive, showUpgradeDraft } from './upgradeDraft.js';\nimport { updateParticles, spawnBloodSplatter, spawnHitImpact, spawnDeathExplosion, spawnTrailParticle, createGlowEffect, updateGlowEffect, spawnCosmeticDeath } from '../systems/particleSystem.js';\nimport { playXPPickup, playCurrencyPickup, playDoorOpen, playBossSpawn, playBossDeath, playEnemyDeath, playPause, playUnpause, initAudio, playCombatMusic } from '../systems/sounds.js';\nimport { initVisualEffects, updateScreenShake, resetVisualEffects, EffectPresets, isInHitFreeze } from '../systems/visualEffects.js';\nimport { getSetting } from '../systems/settings.js';\nimport { generateFloorMap } from '../systems/floorMap.js';\nimport { createMinimap } from '../systems/minimap.js';\nimport { renderFloorDecorations, getFloorTheme } from '../systems/floorTheming.js';\nimport { POWERUP_WEAPONS, rollPowerupDrop, applyPowerupWeapon, getPowerupDisplay, updatePowerupWeapon, restoreOriginalWeapon } from '../systems/powerupWeapons.js';\nimport { getParty, getPartySize } from '../systems/partySystem.js';\nimport { initMultiplayerGame, registerPlayer, registerEnemy, updateMultiplayer, isMultiplayerActive, cleanupMultiplayer, getPlayerCount, getRoomRNG, getFloorRNG, setCurrentFloor, setCurrentRoom, broadcastGameSeed, isHost, broadcastPauseState, sendPauseRequest, broadcastDeathEvent, broadcastRoomCompletion, broadcastGameOver, broadcastXPGain, broadcastCurrencyGain, broadcastPlayerDeath, broadcastRoomTransition, sendEnemyDeath, broadcastPowerupWeaponApplied, broadcastLevelUpQueued, broadcastHostQuit, getAndClearPendingXP, broadcastEmote, getFirstRoomTemplateKey, hasGameSeed, onGameSeedReceived, broadcastObstacles, broadcastHealEvent, broadcastRevivalEvent } from '../systems/multiplayerGame.js';\nimport { onMessage, offMessage, getNetworkInfo, broadcast } from '../systems/networkSystem.js';\nimport { initInputSystem, initTouchControls } from '../systems/inputSystem.js';\n\n// Data imports\nimport { BOSS_TYPES, getBossDefinition } from '../data/bosses.js';\nimport { MINIBOSS_TYPES, getMinibossDefinition } from '../data/minibosses.js';\n\n// Config imports\nimport { PICKUP_CONFIG } from '../config/constants.js';\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS,\n    UI_TERMS,\n    formatHealth,\n    formatXP,\n    formatFloorRoom\n} from '../config/uiConfig.js';\n\n// NEW ARCHITECTURE: Core systems for multiplayer support\nimport { stateManager } from '../core/GameState.js';\nimport { inputManager } from '../core/InputManager.js';\nimport { networkManager } from '../core/NetworkManager.js';\n\n// Game state (persists across scene reloads)\nlet gameState = {\n    currentFloor: 1,\n    currentRoom: 1,\n    playerStats: null, // Store player stats between rooms\n    entryDirection: null, // Direction player entered from (opposite of exit direction)\n    floorMap: null, // NEW: Floor map grid system\n    minimap: null, // NEW: Minimap UI instance\n    rerollsRemaining: 0, // Per-run rerolls from Mulligan upgrade\n    playersRevivedThisRun: new Set(), // Track which players have been revived (one revival per player per run)\n    // Daily run state\n    isDailyRun: false,\n    dailyCharacter: null,\n    dailySeed: null,\n    dailyRNG: null // Seeded RNG for daily run\n};\n\n// Run statistics (reset on new game)\nlet runStats = {\n    floorsReached: 1,\n    roomsCleared: 0,\n    enemiesKilled: 0,\n    bossesKilled: 0\n};\n\n// Flag to prevent duplicate client message handler registration (memory leak fix)\nlet gameSceneMessageHandlersRegistered = false;\n\n// Apply permanent upgrades to player\n// If upgradeLevels is provided, use those; otherwise use local storage (for local player)\nfunction applyPermanentUpgrades(k, player, upgradeLevels = null) {\n    // For remote players (upgradeLevels provided), use 0 as fallback to avoid using wrong player's data\n    // For local player (upgradeLevels null), read from local storage\n    const useLocalStorage = upgradeLevels === null;\n\n    // Apply starting health upgrades\n    const healthLevel = useLocalStorage\n        ? getPermanentUpgradeLevel('startingHealth')\n        : (upgradeLevels?.startingHealth || 0);\n    if (healthLevel > 0) {\n        player.maxHealth += healthLevel * 10;\n        player.setHP(player.maxHealth); // Full health\n    }\n\n    // Apply starting damage upgrades\n    const damageLevel = useLocalStorage\n        ? getPermanentUpgradeLevel('startingDamage')\n        : (upgradeLevels?.startingDamage || 0);\n    if (damageLevel > 0) {\n        player.projectileDamage += damageLevel;\n    }\n\n    // Apply starting speed upgrades\n    const speedLevel = useLocalStorage\n        ? getPermanentUpgradeLevel('startingSpeed')\n        : (upgradeLevels?.startingSpeed || 0);\n    if (speedLevel > 0) {\n        player.speed += speedLevel * 10;\n    }\n}\n\n/**\n * Apply purchased run boosters to player at game start\n * Boosters are consumed when the run starts\n * @param {Object} k - Kaplay instance\n * @param {Object} player - Player entity\n * @param {Object} gameState - Game state to track active booster effects\n */\nfunction applyRunBoosters(k, player, gameState) {\n    // Consume all purchased boosters\n    const boosters = consumeBoosters();\n    if (boosters.length === 0) return;\n\n    // Initialize booster tracking\n    gameState.activeBoosters = [];\n    gameState.creditMultiplier = 1.0;\n\n    boosters.forEach(booster => {\n        const boosterDef = RUN_BOOSTER_UNLOCKS[booster.key];\n        if (!boosterDef || !boosterDef.effect) return;\n\n        const effect = boosterDef.effect;\n\n        switch (effect.type) {\n            case 'startingHealth':\n                // Health Pack: Add bonus HP\n                player.maxHealth += effect.value;\n                player.setHP(player.hp() + effect.value);\n                break;\n\n            case 'tempDamage':\n                // Damage Amp: +X% damage for first floor\n                player.projectileDamage = Math.floor(player.projectileDamage * (1 + effect.value));\n                gameState.activeBoosters.push({ type: 'tempDamage', value: effect.value, duration: effect.duration });\n                break;\n\n            case 'tempSpeed':\n                // Speed Serum: +X% speed for first floor\n                player.speed = Math.floor(player.speed * (1 + effect.value));\n                player.originalSpeed = player.speed;\n                gameState.activeBoosters.push({ type: 'tempSpeed', value: effect.value, duration: effect.duration });\n                break;\n\n            case 'creditMultiplier':\n                // Wealth Charm: +X% credits for run\n                gameState.creditMultiplier = (gameState.creditMultiplier || 1) + effect.value;\n                break;\n\n            case 'tempCrit':\n                // Lucky Coin: +X% crit chance for first floor\n                player.critChance = (player.critChance || 0) + effect.value;\n                gameState.activeBoosters.push({ type: 'tempCrit', value: effect.value, duration: effect.duration });\n                break;\n\n            case 'tempDefense':\n                // Armor Plating: +X% damage reduction for first floor\n                player.damageReduction = (player.damageReduction || 0) + effect.value;\n                gameState.activeBoosters.push({ type: 'tempDefense', value: effect.value, duration: effect.duration });\n                break;\n\n            case 'tempXP':\n                // XP Booster: +X% XP for first floor\n                player.xpMultiplier = (player.xpMultiplier || 1) * (1 + effect.value);\n                gameState.activeBoosters.push({ type: 'tempXP', value: effect.value, duration: effect.duration });\n                break;\n\n            case 'autoRevive':\n                // Emergency Revive: Auto-revive once at X% HP\n                player.autoRevive = { health: effect.value, uses: effect.uses };\n                break;\n        }\n    });\n\n    // Show notification if boosters were applied\n    if (boosters.length > 0) {\n        const boosterText = k.add([\n            k.text(`${boosters.length} Booster${boosters.length > 1 ? 's' : ''} Active!`, { size: 18 }),\n            k.pos(k.width() / 2, 100),\n            k.anchor('center'),\n            k.color(100, 255, 150),\n            k.fixed(),\n            k.z(2000),\n            k.opacity(1)\n        ]);\n\n        // Fade out after 2 seconds\n        k.wait(2, () => {\n            if (boosterText.exists()) {\n                k.tween(boosterText.opacity, 0, 0.5, (val) => boosterText.opacity = val, k.easings.easeOutQuad).onEnd(() => {\n                    if (boosterText.exists()) k.destroy(boosterText);\n                });\n            }\n        });\n    }\n}\n\nexport function setupGameScene(k) {\n    k.scene('game', (args) => {\n        // Start combat music\n        playCombatMusic();\n\n        // ==========================================\n        // NEW ARCHITECTURE INITIALIZATION\n        // ==========================================\n\n        // Initialize new systems on first run or reset\n        if (args?.resetState) {\n            // Initialize network manager (local mode by default)\n            const playerId = networkManager.init('local');\n\n            // Initialize input manager\n            inputManager.init(k);\n\n            // Initialize game state\n            const state = stateManager.init('singleplayer');\n\n            // Add local player to state\n            // TODO: Get selected character from menu\n            const characterKey = 'survivor'; // Default for now\n            state.addPlayer(playerId, characterKey);\n        }\n\n        // Get current game state (for both new and continuing games)\n        const state = stateManager.getState();\n\n        // ==========================================\n        // GAMEPAD & TOUCH CONTROLS\n        // ==========================================\n        // Initialize gamepad polling and touch controls for mobile/controller support\n        initInputSystem(k);\n        initTouchControls(k);\n\n        // ==========================================\n        // LEGACY STATE (keeping for now)\n        // ==========================================\n\n        // Clear barrels from previous room/run\n        clearAllBarrels();\n\n        // Always ensure game starts unpaused (fixes freeze when quitting from pause menu)\n        k.paused = false;\n\n        // Reset game state on new game (when coming from menu)\n        if (args?.resetState) {\n            gameState.currentFloor = 1;\n            gameState.currentRoom = 1;\n            gameState.playerStats = null;\n            gameState.allPlayerStats = null; // Clear multiplayer stats\n            gameState.entryDirection = null;\n            gameState.floorMap = null; // Clear old floor map\n            gameState.playersRevivedThisRun = new Set(); // Reset revival tracking\n            resetRoomTemplateHistory(); // Reset room template variation\n\n            // Handle daily run state\n            gameState.isDailyRun = args?.isDailyRun || false;\n            gameState.dailyCharacter = args?.dailyCharacter || null;\n            gameState.dailySeed = args?.dailySeed || null;\n            gameState.dailyRNG = gameState.isDailyRun && gameState.dailySeed\n                ? new SeededRandom(gameState.dailySeed)\n                : null;\n\n            if (gameState.isDailyRun) {\n                console.log('[DailyRun] Starting daily run with character:', gameState.dailyCharacter, 'seed:', gameState.dailySeed);\n            }\n\n            // Reset run statistics\n            runStats = {\n                floorsReached: 1,\n                roomsCleared: 0,\n                enemiesKilled: 0,\n                bossesKilled: 0,\n                killsByType: {},\n                startTime: Date.now() // Track run start time\n            };\n\n            // Initialize achievement checker for new run (clears previous run's achievements)\n            initAchievementChecker(k);\n\n            // Initialize per-run rerolls from Mulligan permanent upgrade\n            const mulliganLevel = getPermanentUpgradeLevel('mulligan');\n            gameState.rerollsRemaining = mulliganLevel;\n            // Reset client message handler registration flag (allows re-registration on new game)\n            gameSceneMessageHandlersRegistered = false;\n\n            // Show tutorial movement hint for new players\n            k.wait(1.0, () => showMovementHint(k));\n            // Reset weapon detail saved state\n            if (k.gameData) {\n                k.gameData.weaponDetailSavedState = undefined;\n            }\n        }\n\n        // Use persistent game state\n        let currentFloor = gameState.currentFloor;\n        let currentRoom = gameState.currentRoom;\n\n        // Track event handlers for cleanup (memory leak fix)\n        const eventHandlers = {\n            updates: [],\n            keyPresses: []\n        };\n\n        // Flag to prevent duplicate door transitions (used in message handler and update loop)\n        let doorEntered = false;\n\n        // Room state variables (declared early for use in onMessage callbacks)\n        let roomCompleted = false;\n        const spawnDoors = [];\n        let reviveAllPlayers = null; // Function defined later, but declared early for callbacks\n\n        // Initialize spatial grids for performance optimization (see src/systems/spatialGrid.js)\n        const spatialGrids = {\n            enemies: new SpatialGrid(128),    // Grid for enemies, bosses, minibosses\n            obstacles: new SpatialGrid(128),  // Grid for obstacles (walls, decorations)\n            pickups: new SpatialGrid(128)     // Grid for pickups (XP, currency, powerups)\n        };\n\n        // Initialize visual effects system\n        initVisualEffects(k);\n        resetVisualEffects();\n\n        // Get party size early for multiplayer checks throughout the scene\n        const partySize = getPartySize();\n\n        // Helper function to get seeded RNG for the current room\n        // Priority: daily run > multiplayer > random (for single player consistency)\n        function getSeededRoomRNG() {\n            if (gameState.isDailyRun && gameState.dailySeed) {\n                // Create room-specific seed for daily runs\n                const roomSeed = gameState.dailySeed + currentFloor * 10000 + currentRoom * 100;\n                return new SeededRandom(roomSeed);\n            } else if (partySize > 1) {\n                return getRoomRNG();\n            }\n            return null; // Single player non-daily: use Math.random()\n        }\n\n        // Helper function to generate floor map and minimap\n        const generateFloorMapAndMinimap = () => {\n            // Set current floor for seeded RNG in multiplayer\n            if (partySize > 1) {\n                setCurrentFloor(currentFloor);\n                console.log('[Multiplayer] Generating floor map with seed:', hasGameSeed() ? 'valid' : 'invalid (0)');\n            }\n\n            // Use seeded RNG for multiplayer to ensure same floor layout on all clients\n            const floorRng = partySize > 1 ? getFloorRNG() : null;\n            gameState.floorMap = generateFloorMap(currentFloor, floorRng);\n\n            // Destroy old minimap if it exists\n            if (gameState.minimap) {\n                gameState.minimap.destroy();\n            }\n\n            // Create new minimap\n            gameState.minimap = createMinimap(k, gameState.floorMap);\n            // Update k.gameData reference\n            if (k.gameData) {\n                k.gameData.minimap = gameState.minimap;\n            }\n        };\n\n        // Generate floor map if starting new floor or no map exists\n        // For multiplayer clients, this will be regenerated when game_seed arrives\n        if (!gameState.floorMap || gameState.floorMap.floor !== currentFloor) {\n            // For single player or if we're host, generate immediately\n            // For clients, generate with placeholder (will be regenerated when seed arrives)\n            generateFloorMapAndMinimap();\n        } else {\n            // Update minimap if it exists\n            if (gameState.minimap) {\n                gameState.minimap.update();\n            }\n        }\n        \n        // Update run stats for floors reached\n        if (currentFloor > runStats.floorsReached) {\n            runStats.floorsReached = currentFloor;\n        }\n\n        // Floor names (TV station tiers)\n        const floorNames = {\n            1: 'Public Access',\n            2: 'Local Affiliate',\n            3: 'Cable Network',\n            4: 'Premium Channel',\n            5: 'Streaming Giant',\n            6: 'Global Broadcast',\n            7: 'Galactic Signal'\n        };\n        const getFloorName = (floor) => floorNames[floor] || `Network ${floor}`;\n\n        // Show floor title when entering a new floor (room 1)\n        // Skip if setting is enabled\n        const skipIntroAnimation = getSetting('gameplay', 'skipIntroAnimation');\n        if (currentRoom === 1 && !skipIntroAnimation) {\n            const floorTitle = k.add([\n                k.text(`Floor ${currentFloor}`, { size: 32 }),\n                k.pos(k.width() / 2, k.height() / 3),\n                k.anchor('center'),\n                k.color(255, 255, 255),\n                k.opacity(1),\n                k.fixed(),\n                k.z(3000)\n            ]);\n\n            const floorSubtitle = k.add([\n                k.text(getFloorName(currentFloor), { size: 20 }),\n                k.pos(k.width() / 2, k.height() / 3 + 40),\n                k.anchor('center'),\n                k.color(200, 200, 255),\n                k.opacity(1),\n                k.fixed(),\n                k.z(3000)\n            ]);\n\n            // Fade out after delay\n            k.wait(2, () => {\n                if (floorTitle.exists()) {\n                    floorTitle.onUpdate(() => {\n                        floorTitle.opacity -= 0.02;\n                        if (floorTitle.opacity <= 0) k.destroy(floorTitle);\n                    });\n                }\n                if (floorSubtitle.exists()) {\n                    floorSubtitle.onUpdate(() => {\n                        floorSubtitle.opacity -= 0.02;\n                        if (floorSubtitle.opacity <= 0) k.destroy(floorSubtitle);\n                    });\n                }\n            });\n        }\n\n        // Calculate player spawn position based on entry direction\n        // If entering from a door, spawn at that door position\n        // Otherwise (new game), spawn at center\n        const doorMargin = 30;\n        let playerSpawnX = k.width() / 2;\n        let playerSpawnY = k.height() / 2;\n        \n        if (gameState.entryDirection) {\n            // Spawn player at the door they entered from\n            switch (gameState.entryDirection) {\n                case 'north':\n                    playerSpawnX = k.width() / 2;\n                    playerSpawnY = doorMargin;\n                    break;\n                case 'south':\n                    playerSpawnX = k.width() / 2;\n                    playerSpawnY = k.height() - doorMargin;\n                    break;\n                case 'west':\n                    playerSpawnX = doorMargin;\n                    playerSpawnY = k.height() / 2;\n                    break;\n                case 'east':\n                    playerSpawnX = k.width() - doorMargin;\n                    playerSpawnY = k.height() / 2;\n                    break;\n            }\n        }\n        \n        // Create player\n        let player;\n        // For daily runs, always use the daily character (even on room transitions)\n        const characterOverride = gameState.isDailyRun ? gameState.dailyCharacter : null;\n        if (gameState.playerStats) {\n            // Restore player with previous stats\n            player = createPlayer(k, playerSpawnX, playerSpawnY, characterOverride);\n            // Restore stats\n            Object.assign(player, gameState.playerStats);\n            // CRITICAL: Local player is NEVER remote - host's saved stats may have isRemote: true\n            const wasRemote = player.isRemote;\n            player.isRemote = false;\n            if (wasRemote) {\n                console.log('[Room Transition] Fixed isRemote flag - local player was incorrectly marked as remote');\n            }\n            // Restore health to current HP (not max)\n            player.setHP(gameState.playerStats.currentHP || player.maxHealth);\n            // Restore synergy tracking\n            if (gameState.playerStats.selectedUpgrades) {\n                player.selectedUpgrades = new Set(gameState.playerStats.selectedUpgrades);\n            }\n            if (gameState.playerStats.activeSynergies) {\n                player.activeSynergies = new Set(gameState.playerStats.activeSynergies);\n            }\n            // Restore pending level ups\n            if (gameState.playerStats.pendingLevelUps) {\n                player.pendingLevelUps = [...gameState.playerStats.pendingLevelUps];\n            }\n            // CRITICAL: Recalculate all upgrades to ensure they're properly applied\n            if (player.upgradeStacks && Object.keys(player.upgradeStacks).length > 0) {\n                recalculateAllUpgrades(player);\n            }\n\n            // CRITICAL: Reapply synergies after upgrade recalculation\n            // Synergy bonuses are multiplicative and get overwritten by recalculateAllUpgrades\n            if (player.activeSynergies && player.activeSynergies.size > 0) {\n                reapplySynergies(player);\n                // CRITICAL: Restore HP after synergy reapplication\n                // Some synergies (Tank, Glass Cannon) modify HP when applied, but we want\n                // to preserve the player's saved HP, not re-apply the HP modification\n                const savedHP = gameState.playerStats.currentHP || player.maxHealth;\n                player.setHP(Math.min(savedHP, player.maxHealth));\n            }\n\n            // CRITICAL: Reinitialize orbital weapons if player has them\n            // Orbital orbs are entities that get destroyed on room transition\n            if (player.powerupWeapon === 'orbital' || player.weaponKey === 'orbital') {\n                player.orbitalOrbs = [];\n                player.orbitalAngles = [];\n                player.orbitalNeedsReinit = true;\n            }\n\n            // Reset slow debuff state (enemies don't persist across rooms)\n            player.slowed = false;\n\n            // CRITICAL: Reset control flags after room transition\n            // If player is alive, ensure they can move and shoot\n            if (!player.isDead) {\n                player.canMove = true;\n                player.canShoot = true;\n                player.opacity = 1;\n                if (player.outline && player.outline.exists()) {\n                    player.outline.opacity = 1;\n                }\n            } else {\n                // Player is dead - set death visual state\n                player.canMove = false;\n                player.canShoot = false;\n                player.opacity = 0.5;\n                if (player.outline && player.outline.exists()) {\n                    player.outline.opacity = 0.5;\n                }\n            }\n\n            // Recreate cosmetic effects on room transition (glow entity was destroyed)\n            if (gameState.equippedCosmetics) {\n                // Recreate glow effect\n                if (gameState.equippedCosmetics.glow && gameState.equippedCosmetics.glow !== 'glowNone' && !player.isDead) {\n                    const glowDef = COSMETIC_UNLOCKS[gameState.equippedCosmetics.glow];\n                    if (glowDef && glowDef.color) {\n                        player.glowEffect = createGlowEffect(k, player, gameState.equippedCosmetics.glow, glowDef.color);\n                    }\n                }\n                // Restore trail info (properties persist on player object)\n                if (gameState.equippedCosmetics.trail && gameState.equippedCosmetics.trail !== 'trailNone') {\n                    const trailDef = COSMETIC_UNLOCKS[gameState.equippedCosmetics.trail];\n                    if (trailDef) {\n                        player.trailType = gameState.equippedCosmetics.trail;\n                        player.trailColor = trailDef.color;\n                        player.trailTimer = 0;\n                        player.lastTrailPos = { x: player.pos.x, y: player.pos.y };\n                    }\n                }\n            }\n        } else {\n            // New game - create fresh player\n            // For daily runs, use the locked daily character\n            const characterOverride = gameState.isDailyRun ? gameState.dailyCharacter : null;\n            player = createPlayer(k, playerSpawnX, playerSpawnY, characterOverride);\n\n            // Apply permanent upgrades\n            applyPermanentUpgrades(k, player);\n\n            // Apply run boosters (consumables purchased in shop)\n            applyRunBoosters(k, player, gameState);\n\n            // Setup cosmetic effects (trails, glows, death effects)\n            const equippedCosmetics = getEquippedCosmetics();\n            gameState.equippedCosmetics = equippedCosmetics;\n\n            // Create glow effect if one is equipped\n            if (equippedCosmetics.glow && equippedCosmetics.glow !== 'glowNone') {\n                const glowDef = COSMETIC_UNLOCKS[equippedCosmetics.glow];\n                if (glowDef && glowDef.color) {\n                    player.glowEffect = createGlowEffect(k, player, equippedCosmetics.glow, glowDef.color);\n                }\n            }\n\n            // Store trail info on player for update loop\n            if (equippedCosmetics.trail && equippedCosmetics.trail !== 'trailNone') {\n                const trailDef = COSMETIC_UNLOCKS[equippedCosmetics.trail];\n                if (trailDef) {\n                    player.trailType = equippedCosmetics.trail;\n                    player.trailColor = trailDef.color;\n                    player.trailTimer = 0;\n                    player.lastTrailPos = { x: player.pos.x, y: player.pos.y };\n                }\n            }\n\n            // Initialize per-player run stats\n            player.runStats = {\n                kills: 0,\n                deaths: 0,\n                revives: 0,\n                damageTaken: 0,\n                damageDealt: 0,\n                creditsPickedUp: 0,\n                xpPickedUp: 0,\n                bossesKilled: 0\n            };\n        }\n        \n        // ==========================================\n        // MULTIPLAYER: Initialize multiplayer game if party has multiple players\n        // ==========================================\n        const party = getParty();\n        const networkInfo = getNetworkInfo();\n        // Initialize players array indexed by slot (not by push order)\n        let players = new Array(party.maxSlots || 4).fill(null);\n\n        if (partySize > 1 && networkInfo.isInitialized) {\n            // Find local player slot\n            const localSlot = party.slots.findIndex(slot => slot.isLocal);\n\n            // Initialize multiplayer system with kaplay instance\n            initMultiplayerGame(party.isHost, localSlot, k);\n\n            // Broadcast game seed to clients (host only) to ensure synchronized RNG\n            if (party.isHost) {\n                // Select first room template and include it with game seed\n                const roomRng = getRoomRNG();\n                const firstRoomTemplate = getWeightedRoomTemplate(currentFloor, roomRng);\n                gameState.roomTemplateKey = firstRoomTemplate.key;\n                console.log('[Multiplayer] Host selected first room template:', firstRoomTemplate.key);\n                broadcastGameSeed(firstRoomTemplate.key);\n            }\n\n            // Regenerate floor map with correct seed for multiplayer\n            if (party.isHost) {\n                // Host: regenerate with the newly created seed\n                generateFloorMapAndMinimap();\n            } else {\n                // Client: regenerate when game_seed arrives\n                // For now, generate with current seed (will be 0)\n                // Then regenerate when we receive the actual seed\n                onGameSeedReceived(() => {\n                    console.log('[Multiplayer] Client received seed, regenerating floor map');\n                    generateFloorMapAndMinimap();\n                });\n            }\n\n            // Set slot index and name on local player\n            player.slotIndex = localSlot;\n            player.playerName = party.slots[localSlot].playerName;\n\n            // Adjust local player position to match slot index (for consistent multiplayer positioning)\n            const localOffsetX = localSlot * 30;\n            player.pos.x = playerSpawnX + localOffsetX;\n\n            // Register local player at their slot index\n            registerPlayer(localSlot, player);\n            players[localSlot] = player;\n\n            // Spawn additional players for other party members\n            party.slots.forEach((slot, index) => {\n                if (index !== localSlot && slot.playerId !== null) {\n                    // Spawn remote player with their selected character\n                    // Use absolute slot index for consistent positioning across all clients\n                    const offsetX = index * 30; // Absolute offset based on slot index\n                    const remotePlayer = createPlayer(k, playerSpawnX + offsetX, playerSpawnY, slot.selectedCharacter);\n\n                    // Mark as remote player (disable local input)\n                    remotePlayer.isRemote = true;\n                    remotePlayer.slotIndex = index;\n                    remotePlayer.playerName = slot.playerName;\n\n                    // Restore remote player stats if available\n                    if (gameState.allPlayerStats && gameState.allPlayerStats.length > 0) {\n                        const savedStats = gameState.allPlayerStats.find(stats => stats.slotIndex === index);\n                        if (savedStats) {\n                            Object.assign(remotePlayer, savedStats);\n                            \n                            // IMPORTANT: Re-affirm isRemote after restoring stats, as host's isRemote status (false)\n                            // can overwrite the client's setting for the remote player object.\n                            remotePlayer.isRemote = true; \n                            \n                            remotePlayer.setHP(savedStats.currentHP || remotePlayer.maxHealth);\n\n                            // Restore synergy tracking\n                            if (savedStats.selectedUpgrades) {\n                                remotePlayer.selectedUpgrades = new Set(savedStats.selectedUpgrades);\n                            }\n                            if (savedStats.activeSynergies) {\n                                remotePlayer.activeSynergies = new Set(savedStats.activeSynergies);\n                            }\n                            // Restore pending level ups\n                            if (savedStats.pendingLevelUps) {\n                                remotePlayer.pendingLevelUps = [...savedStats.pendingLevelUps];\n                            }\n\n                            // Recalculate upgrades\n                            if (remotePlayer.upgradeStacks && Object.keys(remotePlayer.upgradeStacks).length > 0) {\n                                recalculateAllUpgrades(remotePlayer);\n                            }\n\n                            // Reapply synergies after upgrade recalculation\n                            if (remotePlayer.activeSynergies && remotePlayer.activeSynergies.size > 0) {\n                                reapplySynergies(remotePlayer);\n                                // Restore HP after synergy reapplication\n                                const savedHP = savedStats.currentHP || remotePlayer.maxHealth;\n                                remotePlayer.setHP(Math.min(savedHP, remotePlayer.maxHealth));\n                            }\n\n                            // Reinitialize orbital weapons if player has them\n                            if (remotePlayer.powerupWeapon === 'orbital' || remotePlayer.weaponKey === 'orbital') {\n                                remotePlayer.orbitalOrbs = [];\n                                remotePlayer.orbitalAngles = [];\n                                remotePlayer.orbitalNeedsReinit = true;\n                            }\n\n                            // Reset slow debuff state\n                            remotePlayer.slowed = false;\n\n                            // CRITICAL: Reset control flags after room transition\n                            // If player is alive, ensure they can move and shoot\n                            if (!remotePlayer.isDead) {\n                                remotePlayer.canMove = true;\n                                remotePlayer.canShoot = true;\n                                remotePlayer.opacity = 1;\n                                if (remotePlayer.outline && remotePlayer.outline.exists()) {\n                                    remotePlayer.outline.opacity = 1;\n                                }\n                            } else {\n                                // Player is dead - set death visual state\n                                remotePlayer.canMove = false;\n                                remotePlayer.canShoot = false;\n                                remotePlayer.opacity = 0.5;\n                                if (remotePlayer.outline && remotePlayer.outline.exists()) {\n                                    remotePlayer.outline.opacity = 0.5;\n                                }\n                            }\n                        }\n                    } else {\n                        // No saved stats - apply permanent upgrades to new remote player\n                        // Use the slot's permanent upgrade levels (from their save data)\n                        applyPermanentUpgrades(k, remotePlayer, slot.permanentUpgradeLevels);\n                    }\n\n                    // Setup combat system for remote player (uses network input)\n                    setupCombatSystem(k, remotePlayer);\n\n                    // Setup progression system for remote player (for XP/level ups)\n                    // Note: reviveAllPlayers callback is passed as null here, will be handled globally\n                    setupProgressionSystem(k, remotePlayer, null, true);\n\n                    // Register remote player at their slot index\n                    registerPlayer(index, remotePlayer);\n                    players[index] = remotePlayer;\n\n                    // Add onDeath callback for remote players (host only) to check game over\n                    if (party.isHost) {\n                        remotePlayer.onDeath(() => {\n                            // Set death state\n                            remotePlayer.isDead = true;\n                            remotePlayer.canMove = false;\n                            remotePlayer.canShoot = false;\n                            remotePlayer.opacity = 0.5;\n                            if (remotePlayer.outline && remotePlayer.outline.exists()) {\n                                remotePlayer.outline.opacity = 0.5;\n                            }\n\n                            // Check if all players are dead\n                            const anyPlayerAlive = players.some(p =>\n                                p && p.exists() && p.hp() > 0 && !p.isDead\n                            );\n\n                            if (!anyPlayerAlive) {\n                                // All players dead - trigger game over\n                                const currencyEarned = calculateCurrencyEarned(runStats);\n                                const fullRunStats = {\n                                    ...runStats,\n                                    level: player.level,\n                                    currencyEarned: currencyEarned\n                                };\n                                updateRunStats(fullRunStats);\n                                addCurrency(currencyEarned);\n                                checkAchievements(k);\n\n                                // Gather party stats for game over screen\n                                const partyStats = players.filter(p => p && p.exists()).map(p => ({\n                                    name: p.playerName || 'Player',\n                                    level: p.level || 1,\n                                    characterData: p.characterData,\n                                    kills: p.runStats?.kills || 0,\n                                    deaths: p.runStats?.deaths || 0,\n                                    revives: p.runStats?.revives || 0,\n                                    damageTaken: p.runStats?.damageTaken || 0,\n                                    damageDealt: p.runStats?.damageDealt || 0,\n                                    xpCollected: p.runStats?.xpPickedUp || 0,\n                                    creditsPickedUp: p.runStats?.creditsPickedUp || 0,\n                                    bossesKilled: p.runStats?.bossesKilled || 0\n                                }));\n\n                                if (isMultiplayerActive()) {\n                                    broadcastGameOver(runStats, currencyEarned, partyStats);\n                                    cleanupMultiplayer();\n                                }\n\n                                k.go('gameOver', {\n                                    runStats: { ...runStats },\n                                    currencyEarned: currencyEarned,\n                                    partyStats: partyStats,\n                                    isDailyRun: gameState.isDailyRun,\n                                    dailyCharacter: gameState.dailyCharacter\n                                });\n                            }\n                        });\n                    }\n\n                    // Add name tag above remote player\n                    const nameTag = k.add([\n                        k.text(slot.playerName, { size: 10 }),\n                        k.pos(0, -30),\n                        k.color(150, 150, 255),\n                        k.z(100)\n                    ]);\n\n                    // Health bar components (shown when player is hurt)\n                    const healthBarWidth = 40;\n                    const healthBarHeight = 4;\n                    const healthBarOffset = -40; // Below name tag\n\n                    const healthBarBg = k.add([\n                        k.rect(healthBarWidth, healthBarHeight),\n                        k.pos(remotePlayer.pos.x, remotePlayer.pos.y + healthBarOffset),\n                        k.anchor('center'),\n                        k.color(50, 50, 50),\n                        k.z(100),\n                        'playerHealthBar'\n                    ]);\n\n                    const healthBar = k.add([\n                        k.rect(healthBarWidth, healthBarHeight),\n                        k.pos(remotePlayer.pos.x, remotePlayer.pos.y + healthBarOffset),\n                        k.anchor('center'),\n                        k.color(100, 255, 100), // Green for friendly players\n                        k.z(101),\n                        'playerHealthBar'\n                    ]);\n\n                    // Link health bars to player\n                    remotePlayer.healthBarBg = healthBarBg;\n                    remotePlayer.healthBar = healthBar;\n\n                    // Initially hide health bars\n                    healthBarBg.hidden = true;\n                    healthBar.hidden = true;\n\n                    // Make name tag and health bars follow player\n                    nameTag.onUpdate(() => {\n                        if (remotePlayer.exists()) {\n                            nameTag.pos = k.vec2(remotePlayer.pos.x, remotePlayer.pos.y - 30);\n\n                            // Update health bar position and visibility\n                            const healthPercent = remotePlayer.hp() / remotePlayer.maxHealth;\n                            const isHurt = healthPercent < 1.0 && healthPercent > 0;\n\n                            if (isHurt) {\n                                // Show and update health bars\n                                healthBarBg.hidden = false;\n                                healthBar.hidden = false;\n\n                                // Update position\n                                healthBarBg.pos.x = remotePlayer.pos.x;\n                                healthBarBg.pos.y = remotePlayer.pos.y + healthBarOffset;\n                                healthBar.pos.x = remotePlayer.pos.x;\n                                healthBar.pos.y = remotePlayer.pos.y + healthBarOffset;\n\n                                // Update health bar width - use k.use() to replace the rect component\n                                const barWidth = Math.max(1, healthBarWidth * healthPercent);\n                                healthBar.use(k.rect(barWidth, healthBarHeight));\n                                healthBar.pos.x = remotePlayer.pos.x - (healthBarWidth - barWidth) / 2;\n                            } else {\n                                // Hide health bars when at full health\n                                healthBarBg.hidden = true;\n                                healthBar.hidden = true;\n                            }\n                        } else {\n                            nameTag.destroy();\n                            if (healthBarBg.exists()) healthBarBg.destroy();\n                            if (healthBar.exists()) healthBar.destroy();\n                        }\n                    });\n                }\n            });\n\n            // Listen for room transition from host (client only)\n            if (!isHost()) {\n                // Prevent duplicate handler registration (memory leak fix)\n                if (!gameSceneMessageHandlersRegistered) {\n                    gameSceneMessageHandlersRegistered = true;\n\n                onMessage('room_transition', (data) => {\n\n                    // Update gameState to match host's entry direction for consistent spawn positions\n                    gameState.entryDirection = data.entryDirection;\n\n                    // Save player stats to gameState so they persist across scene reload\n                    if (data.allPlayerStats) {\n                        gameState.allPlayerStats = data.allPlayerStats;\n                        // Find local player stats by matching slot index (not by isRemote flag!)\n                        // Recalculate localSlot from party to ensure it's current\n                        const currentParty = getParty();\n                        const currentLocalSlot = currentParty.slots.findIndex(slot => slot.isLocal);\n                        // Filter out null entries first to avoid errors\n                        const localPlayerStats = data.allPlayerStats.find(stats => stats && stats.slotIndex === currentLocalSlot);\n                        if (localPlayerStats) {\n                            gameState.playerStats = localPlayerStats;\n                            console.log('[Multiplayer] Client restored stats for slot', currentLocalSlot, 'level:', localPlayerStats.level);\n                        } else {\n                            console.warn('[Multiplayer] Client could not find stats for local slot', currentLocalSlot, 'in', data.allPlayerStats);\n                        }\n                    }\n\n                    // Sync room template key from host\n                    if (data.roomTemplateKey) {\n                        gameState.roomTemplateKey = data.roomTemplateKey;\n                        console.log('[Multiplayer] Client received room template:', data.roomTemplateKey);\n                    }\n\n                    // Sync floor number - check if we're advancing to a new floor\n                    if (data.currentFloor && data.currentFloor !== gameState.currentFloor) {\n                        console.log(`[Multiplayer] Floor advancement: ${gameState.currentFloor} -> ${data.currentFloor}`);\n                        gameState.currentFloor = data.currentFloor;\n                        // Clear floor map so it regenerates for the new floor\n                        gameState.floorMap = null;\n                        gameState.entryDirection = null; // Start from center on new floor\n                    } else if (data.gridDirection && gameState.floorMap) {\n                        // Sync floor map position with host (normal room transition)\n                        gameState.floorMap.moveToRoom(data.gridDirection);\n                    }\n\n                    // Prevent duplicate transitions\n                    if (doorEntered) return;\n                    doorEntered = true;\n\n                    // Play door sound for client\n                    playDoorOpen();\n\n                    // Transition to next room (same as handleDoorEntry but without broadcasting)\n                    // Note: We DON'T call handleDoorEntry because that would save stats again\n                    // and broadcast another room_transition. Just transition the scene.\n                    k.go('game');\n                });\n\n                onMessage('room_completed', () => {\n                    roomCompleted = true;\n\n                    // Revive all dead players (same as host)\n                    reviveAllPlayers();\n\n                    // Update doors to show they're open\n                    spawnDoors.forEach(door => {\n                        if (door.exists() && !door.blocked) {\n                            door.open = true;\n                            door.isSpawnDoor = false;\n                            door.updateVisual();\n                        }\n                    });\n\n                    // Special handling for boss rooms: unblock the north door\n                    if (isBossRoom) {\n                        const northDoor = spawnDoors.find(d => d.direction === 'north');\n                        if (northDoor && northDoor.exists()) {\n                            northDoor.blocked = false;\n                            northDoor.open = true;\n                            northDoor.isSpawnDoor = false;\n                            northDoor.isFloorExit = true;\n                            northDoor.updateVisual();\n                        }\n                    }\n\n                    // Update minimap to reflect room clear\n                    if (gameState.minimap) {\n                        gameState.minimap.update();\n                    }\n\n                    // Show completion message (same as host)\n                    const completionText = isBossRoom\n                        ? `BOSS DEFEATED! Floor ${currentFloor} Complete! Enter a door to continue`\n                        : 'Room Cleared! Enter a door to continue';\n                    const completionMsg = k.add([\n                        k.text(completionText, { size: 20 }),\n                        k.pos(k.width() / 2, k.height() - 40),\n                        k.anchor('center'),\n                        k.color(100, 255, 100),\n                        k.fixed(),\n                        k.z(500)\n                    ]);\n\n                    k.wait(5, () => {\n                        if (completionMsg.exists()) {\n                            k.destroy(completionMsg);\n                        }\n                    });\n\n                    // Note: Level ups are now manually triggered via button, not auto-shown\n                    // processPendingLevelUps();\n                });\n\n                // Listen for obstacle data from host\n                onMessage('obstacle_data', (data) => {\n                    console.log('[Multiplayer] Client received obstacle data:', data.obstacles.length, 'obstacles');\n\n                    // Clear any existing obstacles (in case of resync)\n                    k.get('obstacle').forEach(obj => k.destroy(obj));\n\n                    // Create obstacles from host data\n                    data.obstacles.forEach(obsData => {\n                        // Color comes as array, convert to k.rgb()\n                        const color = Array.isArray(obsData.color)\n                            ? k.rgb(obsData.color[0], obsData.color[1], obsData.color[2])\n                            : obsData.color;\n                        createObstacle(\n                            k,\n                            obsData.x,\n                            obsData.y,\n                            obsData.width,\n                            obsData.height,\n                            obsData.type,\n                            obsData.char,\n                            color\n                        );\n                    });\n                });\n\n                // Listen for door states from host\n                onMessage('door_states', (doorStates) => {\n                    console.log('[Multiplayer] Client received door states:', doorStates);\n\n                    // Update door blocked states (spawnDoors is defined later in scene)\n                    if (typeof spawnDoors !== 'undefined' && spawnDoors.length > 0) {\n                        spawnDoors.forEach(door => {\n                            if (doorStates.hasOwnProperty(door.direction)) {\n                                door.blocked = doorStates[door.direction];\n                                door.updateVisual();\n                            }\n                        });\n                    }\n                });\n\n                // Listen for game over event from host\n                onMessage('game_over', (data) => {\n                    // Calculate currency earned (use host's value if provided)\n                    const currencyEarned = data.currencyEarned || calculateCurrencyEarned(data.runStats || runStats);\n\n                    // Update persistent stats and add currency\n                    // Use runStats from host (data.runStats) instead of local runStats (which is empty for clients)\n                    const fullRunStats = {\n                        ...(data.runStats || runStats),\n                        level: player.level,\n                        currencyEarned: currencyEarned\n                    };\n                    updateRunStats(fullRunStats);\n                    addCurrency(currencyEarned);\n\n                    // Check for achievements\n                    checkAchievements(k);\n\n                    // Cleanup multiplayer\n                    cleanupMultiplayer();\n\n                    // Go to game over scene\n                    k.go('gameOver', {\n                        runStats: { ...(data.runStats || runStats) },\n                        currencyEarned: currencyEarned,\n                        partyStats: data.partyStats || [],\n                        isDailyRun: gameState.isDailyRun,\n                        dailyCharacter: gameState.dailyCharacter\n                    });\n                });\n\n                // Listen for powerup weapon application from host\n                onMessage('powerup_weapon_applied', (data) => {\n                    // Apply powerup to all players (client-side visual update)\n                    // The actual weapon stats will be synced via game_state\n                    players.forEach(p => {\n                        if (!p || !p.exists()) return;\n                        applyPowerupWeapon(p, data.powerupKey);\n                    });\n                });\n\n                // Listen for upgrade selection from host/clients\n                onMessage('upgrade_selected', (data) => {\n                    // Skip if this is our own upgrade - we already applied it locally in upgradeDraft\n                    if (data.slotIndex === localSlot) {\n                        return;\n                    }\n                    // Find the player who selected the upgrade (remote player)\n                    const upgradingPlayer = players.find(p => p.slotIndex === data.slotIndex);\n                    if (upgradingPlayer && upgradingPlayer.exists()) {\n                        // Apply upgrade locally (stats will sync via game_state but this is immediate)\n                        applyUpgrade(upgradingPlayer, data.upgradeKey);\n                        trackUpgrade(upgradingPlayer, data.upgradeKey);\n                        checkAndApplySynergies(k, upgradingPlayer);\n                    }\n                });\n\n                // Listen for level up queued events\n                onMessage('level_up_queued', (data) => {\n                    // Skip if this is our own level up - we already queued it locally\n                    if (data.slotIndex === localSlot) {\n                        return;\n                    }\n                    // Find the player who leveled up (remote player)\n                    const leveledPlayer = players.find(p => p.slotIndex === data.slotIndex);\n                    if (leveledPlayer && leveledPlayer.exists()) {\n                        // Update the player's level to match (critical for saving stats)\n                        leveledPlayer.level = data.level;\n\n                        // Initialize pendingLevelUps if needed\n                        if (!leveledPlayer.pendingLevelUps) {\n                            leveledPlayer.pendingLevelUps = [];\n                        }\n                        // Queue the level up\n                        if (!leveledPlayer.pendingLevelUps.includes(data.level)) {\n                            leveledPlayer.pendingLevelUps.push(data.level);\n                        }\n                    }\n                });\n\n                // Listen for synergy activation\n                onMessage('synergy_activated', (data) => {\n                    // Skip if this is our own synergy - we already applied it locally\n                    if (data.slotIndex === localSlot) {\n                        return;\n                    }\n                    // Find the player who activated synergies (remote player)\n                    const synergyPlayer = players.find(p => p.slotIndex === data.slotIndex);\n                    if (synergyPlayer && synergyPlayer.exists()) {\n                        // Apply synergies immediately\n                        checkAndApplySynergies(k, synergyPlayer);\n                    }\n                });\n\n                // Listen for powerup weapon expiration\n                onMessage('powerup_expired', (data) => {\n                    // Find the player whose powerup expired\n                    const expiringPlayer = players.find(p => p.slotIndex === data.slotIndex);\n                    if (expiringPlayer && expiringPlayer.exists()) {\n                        // Restore original weapon\n                        restoreOriginalWeapon(expiringPlayer);\n                    }\n                });\n\n                // Handle player heal events from host (lifesteal, regen, etc.)\n                onMessage('player_healed', (data) => {\n                    const healedPlayer = players.find(p => p.slotIndex === data.slotIndex);\n                    if (healedPlayer && healedPlayer.exists()) {\n                        healedPlayer.setHP(data.newHP);\n                    }\n                });\n\n                // Handle player dodge events from host\n                onMessage('player_dodged', (data) => {\n                    const dodgingPlayer = players.find(p => p.slotIndex === data.slotIndex);\n                    if (dodgingPlayer && dodgingPlayer.exists()) {\n                        // Show dodge visual feedback\n                        const dodgeText = k.add([\n                            k.text('DODGE!', { size: 14 }),\n                            k.pos(data.x, data.y - 30),\n                            k.anchor('center'),\n                            k.color(100, 200, 255),\n                            k.opacity(1),\n                            k.z(500)\n                        ]);\n\n                        // Fade out and destroy\n                        let elapsed = 0;\n                        dodgeText.onUpdate(() => {\n                            elapsed += k.dt();\n                            dodgeText.pos.y -= 30 * k.dt();\n                            dodgeText.opacity = Math.max(0, 1 - elapsed / 0.8);\n                            if (elapsed >= 0.8) {\n                                k.destroy(dodgeText);\n                            }\n                        });\n                    }\n                });\n                } // End of handler registration guard\n            }\n        } else {\n            // Single player mode - add player at slot 0\n            player.slotIndex = 0;\n            players[0] = player;\n        }\n\n        // Filter out null entries from players array for iteration\n        // But keep the array slot-indexed for direct access\n        const activePlayers = players.filter(p => p !== null);\n\n        // ==========================================\n        // EMOTES: Display emotes above player heads\n        // ==========================================\n\n        // Function to show emote above a player\n        function showEmote(targetPlayer, emoteType) {\n            if (!targetPlayer || !targetPlayer.exists()) return;\n\n            const emoteChar = emoteType === 'exclamation' ? '!' : '';\n            const emoteColor = emoteType === 'exclamation' ? [255, 255, 0] : [255, 100, 150];\n\n            // Create emote text\n            const emote = k.add([\n                k.text(emoteChar, { size: 24 }),\n                k.pos(targetPlayer.pos.x, targetPlayer.pos.y - 50),\n                k.anchor('center'),\n                k.color(...emoteColor),\n                k.opacity(1),\n                k.scale(1),\n                k.z(1000),\n                'emote'\n            ]);\n\n            // Animate: float up and fade out\n            let elapsed = 0;\n            const duration = 1.5;\n\n            emote.onUpdate(() => {\n                elapsed += k.dt();\n\n                // Follow player horizontally, float up\n                emote.pos.x = targetPlayer.pos.x;\n                emote.pos.y = targetPlayer.pos.y - 50 - (elapsed * 30);\n\n                // Scale animation (pop in, then shrink)\n                if (elapsed < 0.2) {\n                    emote.scale = k.vec2(1 + elapsed * 2);\n                } else {\n                    emote.scale = k.vec2(1.4 - (elapsed - 0.2) * 0.3);\n                }\n\n                // Fade out in last portion\n                if (elapsed > duration * 0.6) {\n                    emote.opacity = 1 - ((elapsed - duration * 0.6) / (duration * 0.4));\n                }\n\n                // Remove when done\n                if (elapsed >= duration) {\n                    k.destroy(emote);\n                }\n            });\n        }\n\n        // Key handlers for emotes (local player only)\n        let lastEmoteTime = 0;\n        const EMOTE_COOLDOWN = 0.1; // seconds\n\n        k.onKeyPress('q', () => {\n            if (player.isDead) return;\n\n            // Check cooldown\n            const now = k.time();\n            if (now - lastEmoteTime < EMOTE_COOLDOWN) return;\n            lastEmoteTime = now;\n\n            // Show locally\n            showEmote(player, 'exclamation');\n\n            // Broadcast to others in multiplayer\n            if (isMultiplayerActive()) {\n                broadcastEmote(player.slotIndex, 'exclamation');\n            }\n        });\n\n        k.onKeyPress('e', () => {\n            if (player.isDead) return;\n\n            // Check cooldown\n            const now = k.time();\n            if (now - lastEmoteTime < EMOTE_COOLDOWN) return;\n            lastEmoteTime = now;\n\n            // Show locally\n            showEmote(player, 'heart');\n\n            // Broadcast to others in multiplayer\n            if (isMultiplayerActive()) {\n                broadcastEmote(player.slotIndex, 'heart');\n            }\n        });\n\n        // Handle emotes from other players in multiplayer\n        if (partySize > 1) {\n            onMessage('player_emote', (data) => {\n                // Find the player who sent the emote\n                const emotingPlayer = players[data.slotIndex];\n                if (emotingPlayer && emotingPlayer.exists()) {\n                    showEmote(emotingPlayer, data.emoteType);\n                }\n            });\n        }\n\n        // ==========================================\n        // NEW ARCHITECTURE: Sync player entity with PlayerState\n        // ==========================================\n\n        // Get the local player state\n        const localPlayerId = state.localPlayerId;\n        const playerState = state.getPlayer(localPlayerId);\n\n        // Sync player entity properties to PlayerState\n        if (playerState) {\n            // Position\n            playerState.x = player.pos.x;\n            playerState.y = player.pos.y;\n\n            // Stats\n            playerState.health = player.hp();\n            playerState.maxHealth = player.maxHealth;\n            playerState.speed = player.speed;\n\n            // Progression\n            playerState.level = player.level;\n            playerState.xp = player.xp;\n            playerState.xpToNext = player.xpToNext;\n            playerState.xpMultiplier = player.xpMultiplier || 1.0;\n\n            // Weapon & Combat\n            playerState.weaponKey = 'pistol'; // TODO: sync actual weapon\n            playerState.fireRate = player.fireRate;\n            playerState.projectileSpeed = player.projectileSpeed;\n            playerState.projectileDamage = player.projectileDamage;\n            playerState.projectileCount = player.projectileCount || 1;\n            playerState.piercing = player.piercing || 0;\n            playerState.obstaclePiercing = player.obstaclePiercing || 0;\n            playerState.critChance = player.critChance || 0.05;\n            playerState.critDamage = player.critDamage || 2.0;\n            playerState.spreadAngle = player.spreadAngle || 0;\n            playerState.weaponRange = player.weaponRange || 600;\n\n            // Passive stats\n            playerState.pickupRadius = player.pickupRadius;\n            playerState.defense = player.defense || 0;\n            playerState.damageReduction = player.damageReduction || 0;\n            playerState.dodgeChance = player.dodgeChance || 0;\n        }\n\n        // ==========================================\n        // MULTIPLAYER: Revival system - revive all dead players on level up\n        // ==========================================\n        reviveAllPlayers = () => {\n            // Only in multiplayer with multiple players\n            if (partySize <= 1) return;\n\n            // Check if Second Wind is purchased (required for revivals)\n            const secondWindLevel = getPermanentUpgradeLevel('secondWind');\n            if (secondWindLevel <= 0) return; // No Second Wind = no revivals\n\n            let revivedCount = 0;\n            players.forEach((p, index) => {\n                if (!p) return; // Skip null entries\n\n                // Check if player is dead (hp <= 0 or destroyed)\n                if ((p.exists() && p.hp() <= 0) || (p.exists() && p.isDead)) {\n                    // One revival per player per run - check if already revived\n                    const playerKey = `player_${index}`;\n                    if (gameState.playersRevivedThisRun.has(playerKey)) {\n                        return; // Already revived this run, skip\n                    }\n\n                    // Mark as revived for this run\n                    gameState.playersRevivedThisRun.add(playerKey);\n\n                    // Revive player at 5% health + 5% per Second Wind level\n                    const revivePercent = 0.05 + (secondWindLevel * 0.05);\n                    const reviveHealth = Math.max(1, Math.floor(p.maxHealth * revivePercent));\n                    p.setHP(reviveHealth);\n                    p.isDead = false;\n\n                    // Re-enable movement and shooting (for all players, including remote ones on host)\n                    p.canMove = true;\n                    p.canShoot = true;\n\n                    // Show revival effect with HP percentage\n                    const reviveHealthPercent = Math.round(revivePercent * 100);\n                    const reviveEffect = k.add([\n                        k.text(` REVIVED (${reviveHealthPercent}% HP) `, { size: 16 }),\n                        k.pos(p.pos.x, p.pos.y - 40),\n                        k.anchor('center'),\n                        k.color(100, 255, 100),\n                        k.opacity(1), // Required for lifespan component\n                        k.lifespan(2),\n                        k.z(1000)\n                    ]);\n\n                    // Animate rising and fading\n                    reviveEffect.onUpdate(() => {\n                        reviveEffect.pos.y -= 30 * k.dt();\n                        reviveEffect.opacity -= 0.5 * k.dt();\n                    });\n\n                    // Restore visual state\n                    p.opacity = 1; // Restore full opacity\n                    if (p.characterData && p.characterData.color) {\n                        p.color = k.rgb(...p.characterData.color);\n                    }\n                    if (p.outline && p.outline.exists()) {\n                        p.outline.opacity = 1;\n                    }\n\n                    revivedCount++;\n                }\n            });\n\n            // Clear all enemy projectiles when revival happens to prevent instant re-death\n            if (revivedCount > 0) {\n                k.get('projectile').forEach(proj => {\n                    if (proj.isEnemyProjectile || proj.isBossProjectile) {\n                        k.destroy(proj);\n                    }\n                });\n            }\n\n            // Broadcast revival event in multiplayer\n            if (revivedCount > 0 && isMultiplayerActive() && isHost()) {\n                broadcastRevivalEvent();\n            }\n        };\n\n        // Setup systems\n        setupCombatSystem(k, player);\n        const progressionSystem = setupProgressionSystem(k, player, reviveAllPlayers, partySize > 1);\n\n        // CRITICAL: Final safety check - ensure local player has controls enabled if alive\n        // This runs after all initialization to guarantee player can move and shoot\n        if (!player.isDead) {\n            player.canMove = true;\n            player.canShoot = true;\n        }\n\n        // Apply any pending XP accumulated while in upgrade draft screen (multiplayer)\n        if (partySize > 1) {\n            const pendingXP = getAndClearPendingXP();\n            if (pendingXP > 0 && player.addXP) {\n                console.log('[Multiplayer] Applying pending XP:', pendingXP);\n                player.addXP(pendingXP);\n            }\n        }\n\n        // Re-apply synergies if loading from saved state\n        if (gameState.playerStats && gameState.playerStats.selectedUpgrades) {\n            // Wait a frame to ensure player is fully initialized\n            k.wait(0.1, () => {\n                checkAndApplySynergies(k, player);\n            });\n        }\n        \n        // Get room template from floor map (or fallback to weighted generation)\n        const currentRoomNode = gameState.floorMap.getCurrentRoom();\n        const isBossRoom = currentRoomNode ? currentRoomNode.isBossRoom : (currentRoom === 3);\n        let roomTemplate;\n\n        if (partySize > 1 && gameState.roomTemplateKey) {\n            // Multiplayer: use the stored template key (synced from host transition)\n            // This takes priority over floor map template for subsequent rooms\n            roomTemplate = getRoomTemplateByKey(gameState.roomTemplateKey);\n            console.log('[Multiplayer] Using synced template:', gameState.roomTemplateKey);\n            // Clear the key after use so next room gets a fresh selection\n            gameState.roomTemplateKey = null;\n        } else if (partySize > 1 && !hasGameSeed()) {\n            // Multiplayer client before seed arrived: use firstRoomTemplateKey or fallback\n            const firstRoomKey = getFirstRoomTemplateKey();\n            if (firstRoomKey) {\n                roomTemplate = getRoomTemplateByKey(firstRoomKey);\n                console.log('[Multiplayer] Client using first room template:', firstRoomKey);\n            } else {\n                // Fallback - shouldn't normally happen since scene reloads when seed arrives\n                console.warn('[Multiplayer] No seed or template key available, using fallback');\n                const roomRng = getRoomRNG();\n                roomTemplate = getWeightedRoomTemplate(currentFloor, roomRng);\n            }\n        } else if (currentRoomNode && currentRoomNode.template) {\n            // Use floor map template (for single player or multiplayer with correct seed)\n            roomTemplate = currentRoomNode.template;\n        } else {\n            // Fallback to weighted generation\n            roomTemplate = getWeightedRoomTemplate(currentFloor, getSeededRoomRNG());\n        }\n        const floorColors = getFloorColors(k, currentFloor);\n        const margin = 20;\n\n        // Floor decorations (cosmetic theming based on floor)\n        renderFloorDecorations(k, currentFloor, k.width(), k.height());\n\n        // Room boundaries (visual) - use floor-based colors\n        k.add([\n            k.rect(k.width() - margin * 2, 2),\n            k.pos(k.width() / 2, margin),\n            k.anchor('center'),\n            k.color(floorColors.wallColor),\n            k.fixed()\n        ]);\n        k.add([\n            k.rect(k.width() - margin * 2, 2),\n            k.pos(k.width() / 2, k.height() - margin),\n            k.anchor('center'),\n            k.color(floorColors.wallColor),\n            k.fixed()\n        ]);\n        k.add([\n            k.rect(2, k.height() - margin * 2),\n            k.pos(margin, k.height() / 2),\n            k.anchor('center'),\n            k.color(floorColors.wallColor),\n            k.fixed()\n        ]);\n        k.add([\n            k.rect(2, k.height() - margin * 2),\n            k.pos(k.width() - margin, k.height() / 2),\n            k.anchor('center'),\n            k.color(floorColors.wallColor),\n            k.fixed()\n        ]);\n        \n        // Create obstacles from room template\n        // Skip obstacles in first room of first floor for better new player experience\n        const isFirstRoom = currentRoom === 1 && currentFloor === 1;\n        \n        // Safe zone around player spawn and entrance door\n        const safeZoneRadius = 80; // Minimum distance from spawn\n        \n        // Calculate entrance door position (where player entered from)\n        let entranceDoorX = k.width() / 2;\n        let entranceDoorY = k.height() / 2;\n        if (gameState.entryDirection) {\n            switch (gameState.entryDirection) {\n                case 'north':\n                    entranceDoorX = k.width() / 2;\n                    entranceDoorY = doorMargin;\n                    break;\n                case 'south':\n                    entranceDoorX = k.width() / 2;\n                    entranceDoorY = k.height() - doorMargin;\n                    break;\n                case 'west':\n                    entranceDoorX = doorMargin;\n                    entranceDoorY = k.height() / 2;\n                    break;\n                case 'east':\n                    entranceDoorX = k.width() - doorMargin;\n                    entranceDoorY = k.height() / 2;\n                    break;\n            }\n        }\n        \n        const obstacles = [];\n        const obstacleDataForBroadcast = [];\n\n        // Only create obstacles on host (or single player) - clients receive from host\n        const shouldCreateObstacles = partySize <= 1 || isHost();\n\n        if (!isFirstRoom && shouldCreateObstacles) {\n            roomTemplate.obstacles.forEach(obs => {\n            // Check if obstacle would overlap with player spawn safe zone\n            const distanceToSpawn = Math.sqrt(\n                Math.pow(obs.x - playerSpawnX, 2) +\n                Math.pow(obs.y - playerSpawnY, 2)\n            );\n\n            // Check if obstacle would block entrance door\n            const distanceToEntrance = Math.sqrt(\n                Math.pow(obs.x - entranceDoorX, 2) +\n                Math.pow(obs.y - entranceDoorY, 2)\n            );\n\n            const obstacleRadius = Math.max(obs.width, obs.height) / 2;\n\n            // Skip obstacle if it's too close to spawn or entrance door\n            if (distanceToSpawn < safeZoneRadius + obstacleRadius ||\n                distanceToEntrance < safeZoneRadius + obstacleRadius) {\n                return; // Skip this obstacle\n            }\n\n            // Constrain obstacle position to room boundaries\n            const constrainedPos = constrainObstacleToRoom(obs.x, obs.y, obs.width, obs.height);\n\n            const obstacleColor = obs.type === 'wall'\n                ? floorColors.obstacleColor\n                : floorColors.coverColor;\n            const obstacle = createObstacle(\n                k,\n                constrainedPos.x,\n                constrainedPos.y,\n                obs.width,\n                obs.height,\n                obs.type,\n                obs.char || '#',\n                obstacleColor\n            );\n            obstacles.push(obstacle);\n\n            // Collect data for broadcast to clients\n            if (partySize > 1 && isHost()) {\n                // Convert color to array for network serialization\n                let colorArray = null;\n                if (obstacleColor) {\n                    if (Array.isArray(obstacleColor)) {\n                        colorArray = obstacleColor;\n                    } else if (obstacleColor.r !== undefined) {\n                        colorArray = [obstacleColor.r, obstacleColor.g, obstacleColor.b];\n                    }\n                }\n                obstacleDataForBroadcast.push({\n                    x: constrainedPos.x,\n                    y: constrainedPos.y,\n                    width: obs.width,\n                    height: obs.height,\n                    type: obs.type,\n                    char: obs.char || '#',\n                    color: colorArray\n                });\n            }\n            });\n\n            // Broadcast obstacles to clients (with small delay to ensure client has loaded)\n            if (partySize > 1 && isHost()) {\n                k.wait(0.1, () => {\n                    broadcastObstacles(obstacleDataForBroadcast);\n                });\n            }\n        }\n\n        // Spawn explosive barrels (not in first room or boss rooms)\n        if (!isFirstRoom && !isBossRoom && shouldCreateObstacles) {\n            const barrelPositions = getBarrelPositions(roomTemplate.key, getSeededRoomRNG(), currentFloor);\n\n            barrelPositions.forEach(pos => {\n                // Check if barrel would overlap with player spawn or entrance\n                const distToSpawn = Math.sqrt(\n                    Math.pow(pos.x - playerSpawnX, 2) +\n                    Math.pow(pos.y - playerSpawnY, 2)\n                );\n                const distToEntrance = Math.sqrt(\n                    Math.pow(pos.x - entranceDoorX, 2) +\n                    Math.pow(pos.y - entranceDoorY, 2)\n                );\n\n                // Skip if too close to spawn or entrance\n                if (distToSpawn < safeZoneRadius + 25 || distToEntrance < safeZoneRadius + 25) {\n                    return;\n                }\n\n                // Check for overlap with obstacles\n                let overlapsObstacle = false;\n                obstacles.forEach(obs => {\n                    if (!obs.exists()) return;\n                    const dist = Math.sqrt(\n                        Math.pow(pos.x - obs.pos.x, 2) +\n                        Math.pow(pos.y - obs.pos.y, 2)\n                    );\n                    if (dist < 50) overlapsObstacle = true;\n                });\n\n                if (!overlapsObstacle) {\n                    createBarrel(k, pos.x, pos.y);\n                }\n            });\n        }\n\n        // HUD\n        // Top-left panel background (outside room boundary)\n        const topLeftPanelBg = k.add([\n            k.rect(82, 22),\n            k.pos(8, 2),\n            k.color(0, 0, 0),\n            k.opacity(0.6),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BG)\n        ]);\n\n        // Enemy counter with skull icon (top left - outside room)\n        const enemyIcon = k.add([\n            k.text('', { size: UI_TEXT_SIZES.HUD }),\n            k.pos(20, 6),\n            k.color(...UI_COLORS.WARNING),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        const enemiesCounter = k.add([\n            k.text('0/0', { size: UI_TEXT_SIZES.HUD }),\n            k.pos(40, 6),\n            k.color(...UI_COLORS.WARNING),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Top-right panel background (outside room boundary)\n        const topRightPanelBg = k.add([\n            k.rect(85, 22),\n            k.pos(k.width() - 10, 2),\n            k.anchor('topright'),\n            k.color(0, 0, 0),\n            k.opacity(0.6),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BG - 1)\n        ]);\n\n        // Credit counter (top right - outside room) - z-layer 950 to appear above minimap\n        const creditIcon = k.add([\n            k.text('$', { size: UI_TEXT_SIZES.LABEL }),\n            k.pos(k.width() - 20, 6),\n            k.anchor('topright'),\n            k.color(255, 215, 0), // Gold color\n            k.fixed(),\n            k.z(950)\n        ]);\n\n        const creditText = k.add([\n            k.text('0', { size: UI_TEXT_SIZES.HUD }),\n            k.pos(k.width() - 40, 6),\n            k.anchor('topright'),\n            k.color(255, 215, 0), // Gold color to match icon\n            k.fixed(),\n            k.z(950)\n        ]);\n\n        // ==========================================\n        // RUN TIMER (Below credits, if enabled)\n        // ==========================================\n        let runTimer = null;\n        let runTimerText = null;\n        let runElapsedTime = 0;\n\n        if (getSetting('visual', 'showTimer') !== false) {\n            runTimer = k.add([\n                k.rect(60, 18),\n                k.pos(k.width() - 10, 28),\n                k.anchor('topright'),\n                k.color(0, 0, 0),\n                k.opacity(0.6),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_BG)\n            ]);\n\n            runTimerText = k.add([\n                k.text('0:00', { size: UI_TEXT_SIZES.SMALL - 2 }),\n                k.pos(k.width() - 15, 30),\n                k.anchor('topright'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n        }\n\n        // ==========================================\n        // FPS COUNTER (Top center, if enabled)\n        // ==========================================\n        let fpsCounter = null;\n        let fpsUpdateInterval = 0;\n        let frameCount = 0;\n        let lastFps = 60;\n\n        if (getSetting('visual', 'showFPS')) {\n            fpsCounter = k.add([\n                k.text('60 FPS', { size: UI_TEXT_SIZES.SMALL - 2 }),\n                k.pos(k.width() / 2, 6),\n                k.anchor('top'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n        }\n\n        // Multiplayer Connection Indicator (only show if multiplayer is active)\n        let connectionIndicator = null;\n        let connectionText = null;\n        if (isMultiplayerActive()) {\n            const playerCount = getPlayerCount();\n            const statusColor = networkInfo.isHost ? [100, 255, 100] : [100, 200, 255];\n            const statusText = networkInfo.isHost ? 'HOST' : 'CLIENT';\n\n            connectionIndicator = k.add([\n                k.circle(4),\n                k.pos(20, 70),\n                k.color(...statusColor),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            connectionText = k.add([\n                k.text(`${statusText} (${playerCount}P)`, { size: UI_TEXT_SIZES.SMALL - 2 }),\n                k.pos(30, 70),\n                k.anchor('left'),\n                k.color(...statusColor),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n        }\n\n        // XP Bar (bottom of screen, below room boundary)\n        const xpBarWidth = k.width() - 40;\n        const xpBarHeight = 15; // Reduced by 25% from 20\n        const xpBarY = k.height() - 18;\n\n        const xpBarBg = k.add([\n            k.rect(xpBarWidth, xpBarHeight),\n            k.pos(20, xpBarY),\n            k.color(...UI_COLORS.BG_DARK),\n            k.outline(2, k.rgb(...UI_COLORS.TEXT_DISABLED)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BG)\n        ]);\n\n        // Initialize XP bar with player's current progress\n        const initialXpProgress = player.xpToNext > 0 ? player.xp / player.xpToNext : 0;\n        const initialXpWidth = Math.max(0, (xpBarWidth - 34) * initialXpProgress);\n\n        const xpBarFill = k.add([\n            k.rect(initialXpWidth, xpBarHeight - 4),\n            k.pos(58, xpBarY + 2), // Start after level badge (adjusted for larger badge)\n            k.color(100, 200, 255), // Light blue XP color (matches pickup)\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BG + 1)\n        ]);\n\n        const xpBarText = k.add([\n            k.text(formatXP(player.xp || 0, player.xpToNext || 10), { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(k.width() / 2, xpBarY + xpBarHeight / 2),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Level badge (circular frame on left end of XP bar)\n        const levelBadgeSize = 36; // 30% bigger (was 28)\n        const levelBadgeX = 20 + levelBadgeSize / 2;\n        const levelBadgeY = xpBarY + xpBarHeight / 2;\n\n        const levelBadgeBg = k.add([\n            k.circle(levelBadgeSize / 2),\n            k.pos(levelBadgeX, levelBadgeY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_MEDIUM),\n            k.outline(2, k.rgb(100, 200, 255)), // Light blue outline to match XP\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BG + 2)\n        ]);\n\n        const levelText = k.add([\n            k.text(`${player.level || 1}`, { size: UI_TEXT_SIZES.BODY }), // 30% bigger (was SMALL)\n            k.pos(levelBadgeX, levelBadgeY),\n            k.anchor('center'),\n            k.color(255, 255, 255), // White text for better visibility\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BG + 3) // Above the badge background\n        ]);\n\n        // Player Health Bar (follows player when damaged, shown below player)\n        const playerHealthBarWidth = 40; // Reduced from 60 to 40\n        const playerHealthBarHeight = 8;\n        const playerHealthBarOffsetY = 25; // Below player\n\n        const playerHealthBarBg = k.add([\n            k.rect(playerHealthBarWidth, playerHealthBarHeight),\n            k.pos(0, 0),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.outline(1, k.rgb(...UI_COLORS.TEXT_DISABLED)),\n            k.z(UI_Z_LAYERS.OVERLAY)\n        ]);\n\n        const playerHealthBarFill = k.add([\n            k.rect(playerHealthBarWidth - 2, playerHealthBarHeight - 2),\n            k.pos(0, 0),\n            k.anchor('center'), // Use center anchor for proper width updates\n            k.color(100, 255, 100), // Green health color\n            k.z(UI_Z_LAYERS.OVERLAY + 1)\n        ]);\n\n        // Initially hide player health bar (only show when damaged)\n        playerHealthBarBg.hidden = true;\n        playerHealthBarFill.hidden = true;\n\n        // ==========================================\n        // WEAPON INDICATOR (Bottom Left - Icon Only)\n        // ==========================================\n        const weaponIconSize = 48;\n        const weaponIconX = 25;\n        const weaponIconY = k.height() - 85; // Above XP bar (moved up to avoid overlap)\n\n        const weaponIconBg = k.add([\n            k.rect(weaponIconSize, weaponIconSize),\n            k.pos(weaponIconX, weaponIconY),\n            k.color(0, 0, 0),\n            k.opacity(0.8),\n            k.outline(2, k.rgb(150, 150, 150)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BG)\n        ]);\n\n        const weaponIconText = k.add([\n            k.text('', { size: 32 }),\n            k.pos(weaponIconX + weaponIconSize / 2, weaponIconY + weaponIconSize / 2),\n            k.anchor('center'),\n            k.color(255, 255, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Weapon detail popup (shown on click or when paused)\n        const weaponDetailWidth = 220;\n        const weaponDetailHeight = 90;\n\n        const weaponDetailBg = k.add([\n            k.rect(weaponDetailWidth, weaponDetailHeight),\n            k.pos(weaponIconX, weaponIconY - weaponDetailHeight - 10),\n            k.color(0, 0, 0),\n            k.opacity(0.9),\n            k.outline(2, k.rgb(200, 200, 200)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 5)\n        ]);\n\n        const weaponDetailIcon = k.add([\n            k.text('', { size: 24 }),\n            k.pos(weaponIconX + 15, weaponIconY - weaponDetailHeight - 10 + 15),\n            k.color(255, 255, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\n        ]);\n\n        const weaponDetailName = k.add([\n            k.text('Basic Pistol', { size: UI_TEXT_SIZES.SMALL, width: 160 }), // Width constraint to prevent overflow\n            k.pos(weaponIconX + 50, weaponIconY - weaponDetailHeight - 10 + 10),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\n        ]);\n\n        const weaponDetailDamage = k.add([\n            k.text('DMG: 10', { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(weaponIconX + 50, weaponIconY - weaponDetailHeight - 10 + 30),\n            k.color(255, 150, 150),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\n        ]);\n\n        const weaponDetailFireRate = k.add([\n            k.text('RATE: 3.75/s', { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(weaponIconX + 50, weaponIconY - weaponDetailHeight - 10 + 47),\n            k.color(150, 200, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\n        ]);\n\n        const weaponDetailDPS = k.add([\n            k.text('DPS: 37.5', { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(weaponIconX + 50, weaponIconY - weaponDetailHeight - 10 + 64),\n            k.color(255, 255, 150),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\n        ]);\n\n        // Initially hide weapon detail popup\n        weaponDetailBg.hidden = true;\n        weaponDetailIcon.hidden = true;\n        weaponDetailName.hidden = true;\n        weaponDetailDamage.hidden = true;\n        weaponDetailFireRate.hidden = true;\n        weaponDetailDPS.hidden = true;\n\n        // Track weapon detail state (reset to minimized on new game)\n        let weaponDetailState = false; // false = minimized, true = maximized\n        // Reset state on new game\n        if (args?.resetState) {\n            weaponDetailState = false;\n        }\n        \n        // Click handler for weapon icon\n        weaponIconBg.onClick(() => {\n            weaponDetailState = !weaponDetailState;\n            weaponDetailBg.hidden = !weaponDetailBg.hidden;\n            weaponDetailIcon.hidden = !weaponDetailIcon.hidden;\n            weaponDetailName.hidden = !weaponDetailName.hidden;\n            weaponDetailDamage.hidden = !weaponDetailDamage.hidden;\n            weaponDetailFireRate.hidden = !weaponDetailFireRate.hidden;\n            weaponDetailDPS.hidden = !weaponDetailDPS.hidden;\n        });\n\n        // ==========================================\n        // POWERUP WEAPON INDICATOR (Above Main Weapon - Bottom Left)\n        // ==========================================\n        const powerupIconSize = 40;\n        const powerupIconX = weaponIconX;\n        const powerupIconY = weaponIconY - powerupIconSize - 10; // Above weapon icon\n\n        const powerupIconBg = k.add([\n            k.rect(powerupIconSize, powerupIconSize),\n            k.pos(powerupIconX, powerupIconY),\n            k.color(0, 0, 0),\n            k.opacity(0.8),\n            k.outline(2, k.rgb(200, 200, 50)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BG)\n        ]);\n\n        const powerupIconText = k.add([\n            k.text('', { size: 28 }),\n            k.pos(powerupIconX + powerupIconSize / 2, powerupIconY + powerupIconSize / 2),\n            k.anchor('center'),\n            k.color(255, 255, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        const powerupAmmoText = k.add([\n            k.text('20', { size: 14 }),\n            k.pos(powerupIconX + powerupIconSize + 5, powerupIconY + powerupIconSize / 2),\n            k.anchor('left'),\n            k.color(255, 255, 150),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Initially hide powerup indicator (only show when player has powerup)\n        powerupIconBg.hidden = true;\n        powerupIconText.hidden = true;\n        powerupAmmoText.hidden = true;\n\n        // ==========================================\n        // ACTIVE BUFFS/UPGRADES DISPLAY (Near Weapon - Bottom Left)\n        // ==========================================\n        const buffsDisplayX = weaponIconX + weaponIconSize + 10; // Right of weapon icon\n        const buffsDisplayY = weaponIconY;\n        const buffIconSize = 32;\n        const buffIconSpacing = 40;\n\n        // Container for buff icons (will be populated dynamically)\n        const activeBuffIcons = [];\n\n        // Function to update buff display\n        function updateBuffDisplay() {\n            // Clear existing buff icons\n            activeBuffIcons.forEach(icon => {\n                if (icon.exists()) k.destroy(icon);\n            });\n            activeBuffIcons.length = 0;\n\n            if (!player.exists()) return;\n\n            // Collect all upgrades with their stacks\n            const upgradesWithStacks = [];\n\n            // Add weapon upgrades\n            if (player.upgradeStacks) {\n                Object.entries(player.upgradeStacks).forEach(([key, stacks]) => {\n                    if (stacks > 0) {\n                        upgradesWithStacks.push({ key, stacks });\n                    }\n                });\n            }\n\n            // Position buffs horizontally from weapon icon\n            // Create buff icons\n            upgradesWithStacks.forEach((upgrade, index) => {\n                const xPos = buffsDisplayX + index * buffIconSpacing;\n\n                // Get upgrade definition for icon\n                const upgradeDef = UPGRADES[upgrade.key];\n                if (!upgradeDef) return;\n\n                // Background\n                const bg = k.add([\n                    k.rect(buffIconSize, buffIconSize),\n                    k.pos(xPos, buffsDisplayY),\n                    k.color(0, 0, 0),\n                    k.opacity(0.7),\n                    k.outline(1, k.rgb(150, 150, 150)),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_BG)\n                ]);\n\n                // Icon\n                const icon = k.add([\n                    k.text(upgradeDef.icon, { size: 20 }),\n                    k.pos(xPos + buffIconSize / 2, buffsDisplayY + buffIconSize / 2),\n                    k.anchor('center'),\n                    k.color(255, 255, 255),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n\n                // Stack count\n                const stackText = k.add([\n                    k.text(upgrade.stacks.toString(), { size: 10 }),\n                    k.pos(xPos + buffIconSize - 4, buffsDisplayY + buffIconSize - 4),\n                    k.anchor('botright'),\n                    k.color(255, 255, 100),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT + 1)\n                ]);\n\n                activeBuffIcons.push(bg, icon, stackText);\n            });\n        }\n\n        // ==========================================\n        // LEVEL UP BUTTON (Bottom Right)\n        // ==========================================\n        const levelUpButtonSize = 50;\n        const levelUpButtonX = k.width() - levelUpButtonSize - 25;\n        const levelUpButtonY = k.height() - levelUpButtonSize - 25;\n\n        const levelUpButtonBg = k.add([\n            k.rect(levelUpButtonSize, levelUpButtonSize),\n            k.pos(levelUpButtonX, levelUpButtonY),\n            k.color(100, 200, 255), // Light blue background\n            k.opacity(0.9),\n            k.outline(3, k.rgb(255, 255, 255)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 5)\n        ]);\n\n        const levelUpButtonText = k.add([\n            k.text('+', { size: 36 }),\n            k.pos(levelUpButtonX + levelUpButtonSize / 2, levelUpButtonY + levelUpButtonSize / 2),\n            k.anchor('center'),\n            k.color(255, 255, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 6)\n        ]);\n\n        // Badge for showing count > 1 (top-right corner of button)\n        const levelUpCountBadgeSize = 20;\n        const levelUpCountBadgeX = levelUpButtonX + levelUpButtonSize - levelUpCountBadgeSize / 2;\n        const levelUpCountBadgeY = levelUpButtonY - levelUpCountBadgeSize / 2;\n\n        const levelUpCountBadge = k.add([\n            k.circle(levelUpCountBadgeSize / 2),\n            k.pos(levelUpCountBadgeX, levelUpCountBadgeY),\n            k.anchor('center'),\n            k.color(255, 50, 50), // Red badge\n            k.outline(2, k.rgb(255, 255, 255)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 7)\n        ]);\n\n        const levelUpCountText = k.add([\n            k.text('2', { size: 12 }),\n            k.pos(levelUpCountBadgeX, levelUpCountBadgeY),\n            k.anchor('center'),\n            k.color(255, 255, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 8)\n        ]);\n\n        // Initially hide level up button (only show when player has pending level ups)\n        levelUpButtonBg.hidden = true;\n        levelUpButtonText.hidden = true;\n        levelUpCountBadge.hidden = true;\n        levelUpCountText.hidden = true;\n\n        // Click handler for level up button\n        levelUpButtonBg.onClick(() => {\n            if (progressionSystem && player.pendingLevelUps && player.pendingLevelUps.length > 0) {\n                progressionSystem.processPendingLevelUp();\n            }\n        });\n\n        // Pulsing glow effect for level up button\n        let levelUpGlowTime = 0;\n        levelUpButtonBg.onUpdate(() => {\n            if (levelUpButtonBg.hidden) return;\n\n            levelUpGlowTime += k.dt() * 4; // Speed of pulse\n            const pulse = (Math.sin(levelUpGlowTime) + 1) / 2; // 0 to 1\n\n            // Pulse the outline thickness and brightness\n            const outlineSize = 3 + pulse * 3; // 3 to 6\n            const brightness = 200 + pulse * 55; // 200 to 255\n            levelUpButtonBg.outline.width = outlineSize;\n            levelUpButtonBg.outline.color = k.rgb(brightness, brightness, 100 + pulse * 155);\n\n            // Subtle scale pulse\n            const scale = 1 + pulse * 0.05;\n            levelUpButtonBg.scale = k.vec2(scale, scale);\n            levelUpButtonText.scale = k.vec2(scale, scale);\n        });\n\n        // ==========================================\n        // TOOLTIP SYSTEM\n        // ==========================================\n        const tooltip = k.add([\n            k.rect(200, 60),\n            k.pos(0, 0),\n            k.color(0, 0, 0),\n            k.opacity(0.9),\n            k.outline(2, k.rgb(200, 200, 200)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 10)\n        ]);\n\n        const tooltipText = k.add([\n            k.text('', { size: UI_TEXT_SIZES.SMALL, width: 190 }),\n            k.pos(5, 5),\n            k.color(255, 255, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 11)\n        ]);\n\n        tooltip.hidden = true;\n        tooltipText.hidden = true;\n\n        // Tooltip data for HUD elements\n        const tooltipData = {\n            level: () => `Level ${player.level}\\nXP: ${player.xp}/${player.xpToNext}\\nProgress: ${Math.floor((player.xp / player.xpToNext) * 100)}%`,\n            enemies: () => {\n                const remaining = k.get('enemy').length + k.get('miniboss').length;\n                return `Enemies Remaining\\nClear all to progress\\nKills this run: ${runStats.enemiesKilled}`;\n            },\n            currency: () => `Total Credits: ${getCurrency()}\\nUse in shop between floors\\nEarn by killing enemies`,\n            weapon: () => {\n                const weaponDef = player.weaponDef;\n                if (!weaponDef) return 'No weapon equipped';\n                return `${weaponDef.name}\\nDamage: ${player.projectileDamage}\\nFire Rate: ${player.fireRate.toFixed(2)}/s\\nDPS: ${(player.projectileDamage * player.fireRate).toFixed(1)}`;\n            },\n            health: () => `Health: ${Math.floor(player.hp())}/${player.maxHealth}\\nDamage Reduction: ${Math.floor(player.damageReduction * 100)}%`\n        };\n\n        // Show tooltip on hover\n        function showTooltip(key, x, y) {\n            const data = tooltipData[key];\n            if (!data) return;\n\n            const text = data();\n            tooltipText.text = text;\n\n            // Position tooltip near mouse but keep on screen\n            tooltip.pos.x = Math.min(x + 10, k.width() - 210);\n            tooltip.pos.y = Math.min(y + 10, k.height() - 70);\n            tooltipText.pos.x = tooltip.pos.x + 5;\n            tooltipText.pos.y = tooltip.pos.y + 5;\n\n            tooltip.hidden = false;\n            tooltipText.hidden = false;\n        }\n\n        function hideTooltip() {\n            tooltip.hidden = true;\n            tooltipText.hidden = true;\n        }\n\n        function saveTooltipState() {\n            return {\n                hidden: tooltip.hidden,\n                text: tooltipText.text,\n                tooltipX: tooltip.pos.x,\n                tooltipY: tooltip.pos.y,\n                textX: tooltipText.pos.x,\n                textY: tooltipText.pos.y\n            };\n        }\n\n        function restoreTooltipState(state) {\n            if (!state) return;\n            tooltip.hidden = state.hidden;\n            tooltipText.hidden = state.hidden;\n            tooltipText.text = state.text;\n            tooltip.pos.x = state.tooltipX;\n            tooltip.pos.y = state.tooltipY;\n            tooltipText.pos.x = state.textX;\n            tooltipText.pos.y = state.textY;\n        }\n\n        // Export tooltip functions so they can be called from other modules\n        k.gameData = k.gameData || {};\n        k.gameData.hideTooltip = hideTooltip;\n        k.gameData.saveTooltipState = saveTooltipState;\n        k.gameData.restoreTooltipState = restoreTooltipState;\n        k.gameData.minimap = gameState.minimap;\n\n        // Initialize object pools for performance optimization\n        initObjectPools(k);\n\n        // Export spatial grids for global access (used by combat.js for optimized queries)\n        k.gameData.spatialGrids = spatialGrids;\n\n        // Cache alive players for optimized enemy targeting (updated each frame)\n        k.gameData.alivePlayers = [];\n\n        // Track split enemies for accurate counter\n        k.gameData.additionalEnemiesFromSplits = 0;\n        k.gameData.incrementSplitEnemies = (count) => {\n            additionalEnemiesFromSplits += count;\n            k.gameData.additionalEnemiesFromSplits = additionalEnemiesFromSplits;\n        };\n        k.gameData.minimapSavedMode = undefined;\n        k.gameData.tooltipSavedState = undefined;\n\n        // Rebuild spatial grids each frame for fast spatial queries\n        // Note: Rebuilding is O(n), but enables O(1) queries instead of O(n) per query\n        // With multiple queries per frame (collision, explosions, pickups), this is a net win\n        eventHandlers.updates.push(k.onUpdate(() => {\n            // Cache alive players for optimized enemy targeting\n            k.gameData.alivePlayers = k.get('player').filter(p => !p.isDead && p.exists());\n\n            // Rebuild enemy grid (includes enemies, bosses, minibosses)\n            spatialGrids.enemies.clear();\n            k.get('enemy').forEach(e => spatialGrids.enemies.insert(e));\n            k.get('boss').forEach(b => spatialGrids.enemies.insert(b));\n            k.get('miniboss').forEach(m => spatialGrids.enemies.insert(m));\n\n            // Rebuild pickup grid (includes XP, currency, powerup weapons)\n            spatialGrids.pickups.clear();\n            k.get('xpPickup').forEach(p => spatialGrids.pickups.insert(p));\n            k.get('currencyPickup').forEach(p => spatialGrids.pickups.insert(p));\n            k.get('powerupWeaponPickup').forEach(p => spatialGrids.pickups.insert(p));\n\n            // Obstacles are static, so we only rebuild when entering a new room\n            // (We'll add obstacle insertion in room generation code later)\n        }));\n\n        // Update screen shake effect\n        eventHandlers.updates.push(k.onUpdate(() => {\n            updateScreenShake(k.dt());\n        }));\n\n        // Update run timer and FPS counter\n        eventHandlers.updates.push(k.onUpdate(() => {\n            const dt = k.dt();\n\n            // Update run timer (only when not paused)\n            if (runTimerText && runTimerText.exists() && !k.paused) {\n                runElapsedTime += dt;\n                const minutes = Math.floor(runElapsedTime / 60);\n                const seconds = Math.floor(runElapsedTime % 60);\n                runTimerText.text = `${minutes}:${seconds.toString().padStart(2, '0')}`;\n            }\n\n            // Update FPS counter (update every 0.5 seconds)\n            if (fpsCounter && fpsCounter.exists()) {\n                frameCount++;\n                fpsUpdateInterval += dt;\n                if (fpsUpdateInterval >= 0.5) {\n                    lastFps = Math.round(frameCount / fpsUpdateInterval);\n                    fpsCounter.text = `${lastFps} FPS`;\n                    // Color based on FPS (green > 50, yellow 30-50, red < 30)\n                    if (lastFps >= 50) {\n                        fpsCounter.color = k.rgb(100, 255, 100);\n                    } else if (lastFps >= 30) {\n                        fpsCounter.color = k.rgb(255, 255, 100);\n                    } else {\n                        fpsCounter.color = k.rgb(255, 100, 100);\n                    }\n                    frameCount = 0;\n                    fpsUpdateInterval = 0;\n                }\n            }\n        }));\n\n        // Update synergy effects (berserker, survivalist)\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (k.paused || !player.exists() || player.isDead) return;\n\n            const dt = k.dt();\n\n            // Berserker synergy: +50% damage/speed below 30% HP\n            // Uses multiplier approach to avoid issues with upgrades changing base stats\n            if (player.berserkerEnabled) {\n                const hpPercent = player.hp() / player.maxHealth;\n                const isBelowThreshold = hpPercent < (player.berserkerThreshold || 0.3);\n                const speedMultiplier = 1 + (player.berserkerSpeedBonus || 0.5);\n                const damageMultiplier = 1 + (player.berserkerDamageBonus || 0.5);\n\n                if (isBelowThreshold && !player.berserkerActive) {\n                    // Activate berserker mode - apply multiplier to current stats\n                    player.berserkerActive = true;\n                    player.speed = Math.floor(player.speed * speedMultiplier);\n                    player.projectileDamage = Math.floor(player.projectileDamage * damageMultiplier);\n                } else if (!isBelowThreshold && player.berserkerActive) {\n                    // Deactivate berserker mode - remove multiplier from current stats\n                    player.berserkerActive = false;\n                    player.speed = Math.floor(player.speed / speedMultiplier);\n                    player.projectileDamage = Math.floor(player.projectileDamage / damageMultiplier);\n                }\n            }\n\n            // Survivalist synergy: regen 1% HP/sec when out of combat\n            if (player.survivalistEnabled) {\n                // Update last combat time when player takes damage or deals damage\n                // (This is set in combat.js when player takes damage)\n\n                const timeSinceCombat = k.time() - (player.survivalistLastCombatTime || 0);\n                const cooldown = player.survivalistCombatCooldown || 3.0;\n\n                if (timeSinceCombat >= cooldown && player.hp() < player.maxHealth) {\n                    // Out of combat long enough - regenerate\n                    const regenPercent = player.survivalistRegenPercent || 0.01;\n                    const regenAmount = player.maxHealth * regenPercent * dt;\n\n                    // Accumulate fractional regen\n                    player.survivalistRegenAccum = (player.survivalistRegenAccum || 0) + regenAmount;\n\n                    if (player.survivalistRegenAccum >= 1) {\n                        const healAmount = Math.floor(player.survivalistRegenAccum);\n                        player.survivalistRegenAccum -= healAmount;\n                        const newHP = Math.min(player.maxHealth, player.hp() + healAmount);\n                        player.setHP(newHP);\n\n                        // Broadcast heal for multiplayer sync\n                        if (isMultiplayerActive() && isHost()) {\n                            broadcastHealEvent({\n                                slotIndex: player.slotIndex,\n                                healAmount: healAmount,\n                                newHP: newHP,\n                                source: 'survivalist'\n                            });\n                        }\n                    }\n                }\n            }\n        }));\n\n        // Update cosmetic effects (trails, glows)\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (k.paused || !player.exists() || player.isDead) return;\n\n            const dt = k.dt();\n\n            // Update glow effect\n            if (player.glowEffect) {\n                updateGlowEffect(k, player.glowEffect);\n            }\n\n            // Spawn trail particles when player moves\n            if (player.trailType && player.trailColor) {\n                player.trailTimer = (player.trailTimer || 0) + dt;\n                const trailInterval = 0.05; // Spawn trail every 50ms\n\n                // Check if player has moved\n                const dx = player.pos.x - (player.lastTrailPos?.x || player.pos.x);\n                const dy = player.pos.y - (player.lastTrailPos?.y || player.pos.y);\n                const distMoved = Math.sqrt(dx * dx + dy * dy);\n\n                if (player.trailTimer >= trailInterval && distMoved > 2) {\n                    spawnTrailParticle(k, player.pos.x, player.pos.y, player.trailType, player.trailColor);\n                    player.trailTimer = 0;\n                    player.lastTrailPos = { x: player.pos.x, y: player.pos.y };\n                }\n            }\n        }));\n\n        // Hover detection for tooltips\n        eventHandlers.updates.push(k.onUpdate(() => {\n            // Don't show tooltips when paused or during upgrade draft\n            if (k.paused || isUpgradeDraftActive()) {\n                return;\n            }\n\n            const mousePos = k.mousePos();\n            let hovering = false;\n\n            // Check level text\n            if (mousePos.x >= 20 && mousePos.x <= 180 && mousePos.y >= 20 && mousePos.y <= 35) {\n                showTooltip('level', mousePos.x, mousePos.y);\n                hovering = true;\n            }\n            // Check enemy counter\n            else if (mousePos.x >= 20 && mousePos.x <= 180 && mousePos.y >= 40 && mousePos.y <= 55 && !enemiesCounter.hidden) {\n                showTooltip('enemies', mousePos.x, mousePos.y);\n                hovering = true;\n            }\n            // Check credit counter\n            else if (mousePos.x >= k.width() - 130 && mousePos.x <= k.width() - 10 && mousePos.y >= 10 && mousePos.y <= 50) {\n                showTooltip('currency', mousePos.x, mousePos.y);\n                hovering = true;\n            }\n            // Check weapon panel\n            else if (mousePos.x >= weaponIconX && mousePos.x <= weaponIconX + weaponIconSize &&\n                     mousePos.y >= weaponIconY && mousePos.y <= weaponIconY + weaponIconSize) {\n                showTooltip('weapon', mousePos.x, mousePos.y);\n                hovering = true;\n            }\n            // Health bar tooltip removed - health bar moves with player\n\n            if (!hovering) {\n                hideTooltip();\n            }\n        }));\n\n        // Boss HUD elements (only shown when boss exists)\n        const bossNameText = k.add([\n            k.text('', { size: UI_TEXT_SIZES.LABEL }),\n            k.pos(k.width() / 2, 20),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BOSS_NAME),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY)\n        ]);\n\n        const bossHealthBarBg = k.add([\n            k.rect(300, 20),\n            k.pos(k.width() / 2, 45),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.outline(2, k.rgb(...UI_COLORS.TEXT_DISABLED)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY)\n        ]);\n\n        const bossHealthBar = k.add([\n            k.rect(296, 16),\n            k.pos(k.width() / 2, 45),\n            k.anchor('center'),\n            k.color(...UI_COLORS.HEALTH_LOW),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 1)\n        ]);\n\n        const bossArmorBarBg = k.add([\n            k.rect(300, 12),\n            k.pos(k.width() / 2, 65),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.outline(2, k.rgb(...UI_COLORS.TEXT_DISABLED)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY)\n        ]);\n\n        const bossArmorBar = k.add([\n            k.rect(296, 8),\n            k.pos(k.width() / 2, 65),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 1)\n        ]);\n\n        const bossHealthText = k.add([\n            k.text('', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2, 45),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 2)\n        ]);\n\n        const bossArmorText = k.add([\n            k.text('', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2, 65),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 2)\n        ]);\n\n        // Shield bar (above armor bar)\n        const bossShieldBarBg = k.add([\n            k.rect(300, 12),\n            k.pos(k.width() / 2, 85),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.outline(2, k.rgb(...UI_COLORS.TEXT_DISABLED)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY)\n        ]);\n\n        const bossShieldBar = k.add([\n            k.rect(296, 8),\n            k.pos(k.width() / 2, 85),\n            k.anchor('center'),\n            k.color(...UI_COLORS.XP_BAR),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 1)\n        ]);\n\n        const bossShieldText = k.add([\n            k.text('', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2, 85),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY + 2)\n        ]);\n        \n        // Initially hide boss HUD\n        bossNameText.hidden = true;\n        bossHealthBarBg.hidden = true;\n        bossHealthBar.hidden = true;\n        bossArmorBarBg.hidden = true;\n        bossArmorBar.hidden = true;\n        bossHealthText.hidden = true;\n        bossArmorText.hidden = true;\n        bossShieldBarBg.hidden = true;\n        bossShieldBar.hidden = true;\n        bossShieldText.hidden = true;\n        \n        // Update particle system\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (k.paused) return;\n            updateParticles(k);\n        }));\n\n        // Update multiplayer system\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (k.paused) return;\n            if (isMultiplayerActive()) {\n                updateMultiplayer(k.dt());\n            }\n        }));\n\n        // Update HUD\n        eventHandlers.updates.push(k.onUpdate(() => {\n            const currentHP = player.exists() ? player.hp() : 0;\n            const healthPercent = player.maxHealth > 0 ? currentHP / player.maxHealth : 1;\n\n            // Update level text (just show the number)\n            levelText.text = `${player.level || 1}`;\n\n            // Update XP bar\n            const xpProgress = player.xpToNext > 0 ? player.xp / player.xpToNext : 0;\n            xpBarFill.width = Math.max(0, (xpBarWidth - 34) * xpProgress); // Account for level badge space\n            xpBarText.text = formatXP(player.xp, player.xpToNext);\n\n            // Update credit counter\n            creditText.text = getCurrency().toString();\n\n            // Update player health bar (follows player, only show when damaged)\n            if (healthPercent < 1 && player.exists()) {\n                playerHealthBarBg.hidden = false;\n                playerHealthBarFill.hidden = false;\n\n                // Position below player\n                const healthBarX = player.pos.x;\n                const healthBarY = player.pos.y + playerHealthBarOffsetY;\n                playerHealthBarBg.pos = k.vec2(healthBarX, healthBarY);\n\n                // Update health bar width - use k.use() to replace the rect component\n                const fillWidth = Math.max(1, (playerHealthBarWidth - 2) * healthPercent);\n                playerHealthBarFill.use(k.rect(fillWidth, playerHealthBarHeight - 2));\n\n                // Position fill aligned to left edge of background\n                const fillBarX = healthBarX - (playerHealthBarWidth / 2) + 1 + (fillWidth / 2);\n                playerHealthBarFill.pos = k.vec2(fillBarX, healthBarY);\n\n                // Color based on health percentage\n                if (healthPercent > 0.6) {\n                    playerHealthBarFill.color = k.rgb(100, 255, 100); // Green\n                } else if (healthPercent > 0.3) {\n                    playerHealthBarFill.color = k.rgb(255, 200, 0); // Yellow/Orange\n                } else {\n                    playerHealthBarFill.color = k.rgb(255, 50, 50); // Red\n                }\n            } else {\n                playerHealthBarBg.hidden = true;\n                playerHealthBarFill.hidden = true;\n            }\n\n            // Update enemies counter (only show in regular rooms, not boss rooms)\n            if (!isBossRoom && !roomCompleted) {\n                const currentEnemies = k.get('enemy').length;\n                // Include split enemies in total count\n                const totalEnemies = enemiesToSpawn + additionalEnemiesFromSplits + (isMinibossRoom ? 1 : 0); // Include miniboss and split enemies\n                const currentMinibosses = k.get('miniboss').length;\n                // Calculate remaining: current alive + not yet spawned\n                const remainingEnemies = currentEnemies + currentMinibosses + Math.max(0, totalEnemies - enemiesSpawned - additionalEnemiesFromSplits - (isMinibossRoom && minibossSpawned ? 1 : 0));\n                enemiesCounter.text = `${remainingEnemies}/${totalEnemies}`;\n                enemiesCounter.hidden = false;\n                enemyIcon.hidden = false;\n            } else {\n                enemiesCounter.hidden = true;\n                enemyIcon.hidden = true;\n            }\n\n            // Update weapon indicator\n            if (player.exists() && player.weaponDef) {\n                const weaponDef = player.weaponDef;\n                const dps = (player.projectileDamage * player.fireRate).toFixed(1);\n\n                // Update weapon icon\n                weaponIconText.text = weaponDef.icon || '';\n                weaponIconText.color = k.rgb(...weaponDef.color);\n\n                // Update weapon detail popup info (always update, even when hidden)\n                weaponDetailIcon.text = weaponDef.icon || '';\n                weaponDetailIcon.color = k.rgb(...weaponDef.color);\n                weaponDetailName.text = weaponDef.name;\n                // Ensure name color is always white/primary (explicitly set to prevent color issues)\n                weaponDetailName.color = k.rgb(...UI_COLORS.TEXT_PRIMARY);\n                weaponDetailDamage.text = `DMG: ${player.projectileDamage}`;\n                weaponDetailFireRate.text = `RATE: ${player.fireRate.toFixed(2)}/s`;\n                weaponDetailDPS.text = `DPS: ${dps}`;\n\n                // Show weapon details when paused (save state before showing)\n                // But NOT during hit freeze - only show on actual user pause\n                if (k.paused && !isInHitFreeze()) {\n                    // Save current state before forcing it visible\n                    if (k.gameData.weaponDetailSavedState === undefined) {\n                        k.gameData.weaponDetailSavedState = weaponDetailState;\n                    }\n                    // Force visible when paused (regardless of saved state)\n                    weaponDetailBg.hidden = false;\n                    weaponDetailIcon.hidden = false;\n                    weaponDetailName.hidden = false;\n                    weaponDetailDamage.hidden = false;\n                    weaponDetailFireRate.hidden = false;\n                    weaponDetailDPS.hidden = false;\n                } else {\n                    // When not paused, respect the weaponDetailState\n                    weaponDetailBg.hidden = !weaponDetailState;\n                    weaponDetailIcon.hidden = !weaponDetailState;\n                    weaponDetailName.hidden = !weaponDetailState;\n                    weaponDetailDamage.hidden = !weaponDetailState;\n                    weaponDetailFireRate.hidden = !weaponDetailState;\n                    weaponDetailDPS.hidden = !weaponDetailState;\n                }\n            }\n\n            // Update powerup weapon indicator and countdown\n            if (player.exists()) {\n                // Update time-based powerups\n                updatePowerupWeapon(player, k.dt());\n\n                // Update powerup HUD display\n                const powerupDisplay = getPowerupDisplay(player);\n                if (powerupDisplay) {\n                    // Show powerup indicator\n                    powerupIconBg.hidden = false;\n                    powerupIconText.hidden = false;\n                    powerupAmmoText.hidden = false;\n\n                    // Update icon and color\n                    powerupIconText.text = powerupDisplay.icon;\n                    powerupIconText.color = k.rgb(...powerupDisplay.color);\n                    powerupIconBg.outline.color = k.rgb(...powerupDisplay.color);\n\n                    // Update ammo/duration text\n                    if (powerupDisplay.isAmmoBased) {\n                        powerupAmmoText.text = `${powerupDisplay.ammo}`;\n                    } else if (powerupDisplay.isTimeBased) {\n                        powerupAmmoText.text = `${Math.ceil(powerupDisplay.duration)}s`;\n                    }\n                } else {\n                    // Hide powerup indicator\n                    powerupIconBg.hidden = true;\n                    powerupIconText.hidden = true;\n                    powerupAmmoText.hidden = true;\n                }\n            }\n\n            // Update buff display (call periodically, not every frame for performance)\n            if (k.time() % 0.5 < k.dt()) {\n                updateBuffDisplay();\n            }\n\n            // Update level up button visibility and count\n            if (player.exists() && player.pendingLevelUps && player.pendingLevelUps.length > 0) {\n                // Show button\n                levelUpButtonBg.hidden = false;\n                levelUpButtonText.hidden = false;\n\n                // Show/hide count badge based on pending level ups\n                const pendingCount = player.pendingLevelUps.length;\n                if (pendingCount > 1) {\n                    levelUpCountBadge.hidden = false;\n                    levelUpCountText.hidden = false;\n                    levelUpCountText.text = pendingCount.toString();\n                } else {\n                    levelUpCountBadge.hidden = true;\n                    levelUpCountText.hidden = true;\n                }\n            } else {\n                // Hide button when no pending level ups\n                levelUpButtonBg.hidden = true;\n                levelUpButtonText.hidden = true;\n                levelUpCountBadge.hidden = true;\n                levelUpCountText.hidden = true;\n            }\n\n            // Update boss HUD\n            const bosses = k.get('boss');\n            const twinGuardians = bosses.filter(b => b.type === 'twinGuardianMelee' || b.type === 'twinGuardianRanged');\n            \n            if (twinGuardians.length > 0) {\n                // Special handling for Twin Guardians - show combined health\n                const meleeGuardian = twinGuardians.find(b => b.type === 'twinGuardianMelee');\n                const rangedGuardian = twinGuardians.find(b => b.type === 'twinGuardianRanged');\n                \n                if (meleeGuardian && rangedGuardian && (meleeGuardian.exists() || rangedGuardian.exists())) {\n                    // Show boss HUD\n                    bossNameText.hidden = false;\n                    bossNameText.text = 'THE CO-HOSTS';\n                    \n                    // Calculate combined health\n                    const meleeHP = meleeGuardian.exists() ? meleeGuardian.hp() : 0;\n                    const rangedHP = rangedGuardian.exists() ? rangedGuardian.hp() : 0;\n                    const totalHP = meleeHP + rangedHP;\n                    const totalMaxHP = (meleeGuardian.maxHealth || 0) + (rangedGuardian.maxHealth || 0);\n                    \n                    // Show combined health bar\n                    const healthPercent = totalMaxHP > 0 ? Math.max(0, Math.min(1, totalHP / totalMaxHP)) : 0;\n                    bossHealthBar.width = 296 * healthPercent;\n                    bossHealthBar.pos.x = k.width() / 2 - (296 * (1 - healthPercent)) / 2;\n                    bossHealthText.text = `${Math.max(0, Math.floor(totalHP))}/${totalMaxHP}`;\n                    bossHealthBarBg.hidden = false;\n                    bossHealthBar.hidden = false;\n                    bossHealthText.hidden = false;\n                    \n                    // Show shields if either has shields\n                    const meleeShield = meleeGuardian.exists() ? (meleeGuardian.shieldHealth || 0) : 0;\n                    const rangedShield = rangedGuardian.exists() ? (rangedGuardian.shieldHealth || 0) : 0;\n                    const totalShield = meleeShield + rangedShield;\n                    const totalMaxShield = (meleeGuardian.maxShieldHealth || 0) + (rangedGuardian.maxShieldHealth || 0);\n                    \n                    if (totalMaxShield > 0) {\n                        const shieldPercent = Math.max(0, Math.min(1, totalShield / totalMaxShield));\n                        bossShieldBar.width = 296 * shieldPercent;\n                        bossShieldBar.pos.x = k.width() / 2 - (296 * (1 - shieldPercent)) / 2;\n                        bossShieldText.text = `Shield: ${Math.max(0, Math.floor(totalShield))}/${totalMaxShield}`;\n                        bossShieldBarBg.hidden = false;\n                        bossShieldBar.hidden = false;\n                        bossShieldText.hidden = false;\n                    } else {\n                        bossShieldBarBg.hidden = true;\n                        bossShieldBar.hidden = true;\n                        bossShieldText.hidden = true;\n                    }\n                    \n                    // Show armor if either has armor\n                    const meleeArmor = meleeGuardian.exists() ? (meleeGuardian.armorHealth || 0) : 0;\n                    const rangedArmor = rangedGuardian.exists() ? (rangedGuardian.armorHealth || 0) : 0;\n                    const totalArmor = meleeArmor + rangedArmor;\n                    const totalMaxArmor = (meleeGuardian.maxArmorHealth || 0) + (rangedGuardian.maxArmorHealth || 0);\n                    \n                    if (totalMaxArmor > 0) {\n                        const armorPercent = Math.max(0, Math.min(1, totalArmor / totalMaxArmor));\n                        bossArmorBar.width = 296 * armorPercent;\n                        bossArmorBar.pos.x = k.width() / 2 - (296 * (1 - armorPercent)) / 2;\n                        bossArmorText.text = `Armor: ${Math.max(0, Math.floor(totalArmor))}/${totalMaxArmor}`;\n                        bossArmorBarBg.hidden = false;\n                        bossArmorBar.hidden = false;\n                        bossArmorText.hidden = false;\n                    } else {\n                        bossArmorBarBg.hidden = true;\n                        bossArmorBar.hidden = true;\n                        bossArmorText.hidden = true;\n                    }\n                    \n                    // Change health bar color based on health percentage\n                    if (healthPercent > 0.6) {\n                        bossHealthBar.color = k.rgb(255, 50, 50); // Red\n                    } else if (healthPercent > 0.3) {\n                        bossHealthBar.color = k.rgb(255, 150, 50); // Orange\n                    } else {\n                        bossHealthBar.color = k.rgb(255, 200, 0); // Yellow (critical)\n                    }\n                } else {\n                    // One guardian dead, show remaining one\n                    const remainingBoss = meleeGuardian?.exists() ? meleeGuardian : rangedGuardian;\n                    if (remainingBoss) {\n                        const bossHP = remainingBoss.hp();\n                        const bossMaxHP = remainingBoss.maxHealth;\n                        const bossShieldHP = remainingBoss.shieldHealth || 0;\n                        const bossMaxShieldHP = remainingBoss.maxShieldHealth || 0;\n                        const bossArmorHP = remainingBoss.armorHealth || 0;\n                        const bossMaxArmorHP = remainingBoss.maxArmorHealth || 0;\n                        \n                        bossNameText.hidden = false;\n                        bossNameText.text = remainingBoss.enraged ? 'THE CO-HOSTS (ENRAGED)' : 'THE CO-HOSTS';\n                        \n                        const healthPercent = Math.max(0, Math.min(1, bossHP / bossMaxHP));\n                        bossHealthBar.width = 296 * healthPercent;\n                        bossHealthBar.pos.x = k.width() / 2 - (296 * (1 - healthPercent)) / 2;\n                        bossHealthText.text = `${Math.max(0, Math.floor(bossHP))}/${bossMaxHP}`;\n                        bossHealthBarBg.hidden = false;\n                        bossHealthBar.hidden = false;\n                        bossHealthText.hidden = false;\n                        \n                        // Show shields\n                        if (bossMaxShieldHP > 0) {\n                            const shieldPercent = Math.max(0, Math.min(1, bossShieldHP / bossMaxShieldHP));\n                            bossShieldBar.width = 296 * shieldPercent;\n                            bossShieldBar.pos.x = k.width() / 2 - (296 * (1 - shieldPercent)) / 2;\n                            bossShieldText.text = `Shield: ${Math.max(0, Math.floor(bossShieldHP))}/${bossMaxShieldHP}`;\n                            bossShieldBarBg.hidden = false;\n                            bossShieldBar.hidden = false;\n                            bossShieldText.hidden = false;\n                        } else {\n                            bossShieldBarBg.hidden = true;\n                            bossShieldBar.hidden = true;\n                            bossShieldText.hidden = true;\n                        }\n                        \n                        if (bossMaxArmorHP > 0) {\n                            const armorPercent = Math.max(0, Math.min(1, bossArmorHP / bossMaxArmorHP));\n                            bossArmorBar.width = 296 * armorPercent;\n                            bossArmorBar.pos.x = k.width() / 2 - (296 * (1 - armorPercent)) / 2;\n                            bossArmorText.text = `Armor: ${Math.max(0, Math.floor(bossArmorHP))}/${bossMaxArmorHP}`;\n                            bossArmorBarBg.hidden = false;\n                            bossArmorBar.hidden = false;\n                            bossArmorText.hidden = false;\n                        } else {\n                            bossArmorBarBg.hidden = true;\n                            bossArmorBar.hidden = true;\n                            bossArmorText.hidden = true;\n                        }\n                        \n                        if (healthPercent > 0.6) {\n                            bossHealthBar.color = k.rgb(255, 50, 50);\n                        } else if (healthPercent > 0.3) {\n                            bossHealthBar.color = k.rgb(255, 150, 50);\n                        } else {\n                            bossHealthBar.color = k.rgb(255, 200, 0);\n                        }\n                    } else {\n                        // Both dead, hide HUD\n                        bossNameText.hidden = true;\n                        bossHealthBarBg.hidden = true;\n                        bossHealthBar.hidden = true;\n                        bossArmorBarBg.hidden = true;\n                        bossArmorBar.hidden = true;\n                        bossHealthText.hidden = true;\n                        bossArmorText.hidden = true;\n                    }\n                }\n            } else if (bosses.length > 0 && bosses[0].exists()) {\n                // Regular single boss\n                const boss = bosses[0];\n                const bossHP = boss.hp();\n                const bossMaxHP = boss.maxHealth;\n                const bossShieldHP = boss.shieldHealth || 0;\n                const bossMaxShieldHP = boss.maxShieldHealth || 0;\n                const bossArmorHP = boss.armorHealth || 0;\n                const bossMaxArmorHP = boss.maxArmorHealth || 0;\n                \n                // Get boss name from data files\n                let bossName = 'BOSS';\n                if (boss.type === 'twinGuardianMelee' || boss.type === 'twinGuardianRanged') {\n                    bossName = 'THE CO-HOSTS';\n                } else if (BOSS_TYPES[boss.type]?.name) {\n                    bossName = `THE ${BOSS_TYPES[boss.type].name.toUpperCase()}`;\n                }\n                \n                // Show boss HUD\n                bossNameText.hidden = false;\n                bossHealthBarBg.hidden = false;\n                bossHealthBar.hidden = false;\n                bossArmorBarBg.hidden = false;\n                bossArmorBar.hidden = false;\n                bossHealthText.hidden = false;\n                bossArmorText.hidden = false;\n                \n                // Update boss name\n                bossNameText.text = bossName;\n                \n                // Update health bar\n                const healthPercent = Math.max(0, Math.min(1, bossHP / bossMaxHP));\n                bossHealthBar.width = 296 * healthPercent;\n                bossHealthBar.pos.x = k.width() / 2 - (296 * (1 - healthPercent)) / 2;\n                bossHealthText.text = `${Math.max(0, Math.floor(bossHP))}/${bossMaxHP}`;\n                \n                // Update shield bar (only show if shields exist)\n                if (bossMaxShieldHP > 0) {\n                    const shieldPercent = Math.max(0, Math.min(1, bossShieldHP / bossMaxShieldHP));\n                    bossShieldBar.width = 296 * shieldPercent;\n                    bossShieldBar.pos.x = k.width() / 2 - (296 * (1 - shieldPercent)) / 2;\n                    bossShieldText.text = `Shield: ${Math.max(0, Math.floor(bossShieldHP))}/${bossMaxShieldHP}`;\n                    bossShieldBarBg.hidden = false;\n                    bossShieldBar.hidden = false;\n                    bossShieldText.hidden = false;\n                } else {\n                    bossShieldBarBg.hidden = true;\n                    bossShieldBar.hidden = true;\n                    bossShieldText.hidden = true;\n                }\n                \n                // Update armor bar (only show if armor exists)\n                if (bossMaxArmorHP > 0) {\n                    const armorPercent = Math.max(0, Math.min(1, bossArmorHP / bossMaxArmorHP));\n                    bossArmorBar.width = 296 * armorPercent;\n                    bossArmorBar.pos.x = k.width() / 2 - (296 * (1 - armorPercent)) / 2;\n                    bossArmorText.text = `Armor: ${Math.max(0, Math.floor(bossArmorHP))}/${bossMaxArmorHP}`;\n                    bossArmorBarBg.hidden = false;\n                    bossArmorBar.hidden = false;\n                    bossArmorText.hidden = false;\n                } else {\n                    bossArmorBarBg.hidden = true;\n                    bossArmorBar.hidden = true;\n                    bossArmorText.hidden = true;\n                }\n                \n                // Change health bar color based on health percentage\n                if (healthPercent > 0.6) {\n                    bossHealthBar.color = k.rgb(255, 50, 50); // Red\n                } else if (healthPercent > 0.3) {\n                    bossHealthBar.color = k.rgb(255, 150, 50); // Orange\n                } else {\n                    bossHealthBar.color = k.rgb(255, 200, 0); // Yellow (critical)\n                }\n            } else {\n                // Hide boss HUD when no boss\n                bossNameText.hidden = true;\n                bossHealthBarBg.hidden = true;\n                bossHealthBar.hidden = true;\n                bossArmorBarBg.hidden = true;\n                bossArmorBar.hidden = true;\n                bossHealthText.hidden = true;\n                bossArmorText.hidden = true;\n                bossShieldBarBg.hidden = true;\n                bossShieldBar.hidden = true;\n                bossShieldText.hidden = true;\n            }\n        }));\n\n        // ==========================================\n        // NEW ARCHITECTURE: Continuous sync of player entity to PlayerState\n        // ==========================================\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (!player.exists() || k.paused) return;\n\n            const playerState = state.getPlayer(localPlayerId);\n            if (!playerState) return;\n\n            // Update position\n            playerState.x = player.pos.x;\n            playerState.y = player.pos.y;\n            playerState.velocityX = 0; // TODO: track actual velocity\n            playerState.velocityY = 0;\n\n            // Update health\n            playerState.health = player.hp();\n            playerState.maxHealth = player.maxHealth;\n\n            // Update progression (in case of level up or XP gain)\n            playerState.level = player.level;\n            playerState.xp = player.xp;\n            playerState.xpToNext = player.xpToNext;\n\n            // Update combat stats (in case of upgrades)\n            playerState.projectileDamage = player.projectileDamage;\n            playerState.fireRate = player.fireRate;\n            playerState.projectileSpeed = player.projectileSpeed;\n            playerState.projectileCount = player.projectileCount || 1;\n            playerState.piercing = player.piercing || 0;\n            playerState.critChance = player.critChance || 0.05;\n            playerState.critDamage = player.critDamage || 2.0;\n\n            // Update passive stats\n            playerState.pickupRadius = player.pickupRadius;\n            playerState.defense = player.defense || 0;\n\n            // Update state flags\n            // Use player.isDead flag if set, otherwise fall back to HP check\n            playerState.isDead = player.isDead || !player.exists() || player.hp() <= 0;\n            playerState.invulnerable = player.invulnerable || false;\n\n            // Update state time\n            state.updateTime(k.dt());\n        }));\n\n        // ==========================================\n        // NEW ARCHITECTURE: Sync room/floor state\n        // ==========================================\n        // Sync legacy gameState to new state system\n        state.currentFloor = currentFloor;\n        state.currentRoom = currentRoom;\n        state.roomCleared = false;\n\n        // ==========================================\n        // NEW ARCHITECTURE: InputManager integration\n        // ==========================================\n        // Start collecting inputs for the local player each frame\n        // (Running in parallel with legacy input for now)\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (k.paused) return;\n\n            // Get input manager\n            const inputMgr = inputManager.getManager();\n\n            // Collect inputs for this frame\n            const inputs = inputMgr.getInputsForFrame([localPlayerId]);\n\n            // Get input for local player\n            const playerInput = inputs.get(localPlayerId);\n        }));\n\n        // ==========================================\n        // LEGACY STATE (keeping for now)\n        // ==========================================\n\n        // Room state (roomCompleted declared early for onMessage callbacks)\n        let enemiesToSpawn = isBossRoom ? 0 : (24 + (currentFloor - 1) * 6); // No regular enemies in boss rooms (3x multiplier)\n        let enemiesSpawned = 0;\n        let initialSpawnDelay = 2; // Wait before first spawn\n        let bossSpawned = false;\n        let minibossSpawned = false;\n        let isMinibossRoom = false; // Track if this room has a miniboss\n        let entranceDoorExclusionTime = 4; // Seconds to exclude entrance door from enemy spawning (3-5 seconds)\n        let roomStartTime = 0; // Track when room started\n        let additionalEnemiesFromSplits = 0; // Track extra enemies created by splitting (e.g., slimes)\n        \n        // Determine if this room should have a miniboss (random chance, not in boss rooms)\n        // 15% chance for miniboss room, increases with floor\n        // Use seeded RNG for multiplayer consistency, daily runs, or single player\n        const roomRng = getSeededRoomRNG() || new SeededRandom(Date.now());\n        if (!isBossRoom && currentRoom !== 1) { // Don't spawn miniboss in first room or boss room\n            const minibossChance = 0.15 + (currentFloor - 1) * 0.05; // 15% base, +5% per floor\n            isMinibossRoom = roomRng.next() < minibossChance;\n        }\n\n        // If miniboss room, reduce normal enemy count\n        if (isMinibossRoom) {\n            enemiesToSpawn = Math.floor(enemiesToSpawn * 0.5); // Half normal enemies\n        }\n\n        // Get random miniboss type for floor\n        // Use seeded RNG for multiplayer consistency\n        function getRandomMinibossType(floor, rng) {\n            const minibossTypes = ['brute', 'sentinel', 'berserker', 'guardian', 'warlock'];\n            // Weight certain types by floor\n            if (floor >= 3) {\n                // Higher floors get more variety\n                return minibossTypes[rng.range(0, minibossTypes.length)];\n            } else {\n                // Lower floors get simpler types\n                const simpleTypes = ['brute', 'berserker', 'guardian'];\n                return simpleTypes[rng.range(0, simpleTypes.length)];\n            }\n        }\n        \n        // Determine boss type based on floor\n        function getBossTypeForFloor(floor) {\n            const bossMap = {\n                1: 'gatekeeper',\n                2: 'swarmQueen',\n                3: 'twinGuardian',\n                // Default to gatekeeper for floors beyond 3 (can expand later)\n            };\n            return bossMap[floor] || 'gatekeeper';\n        }\n        \n        // Spawn doors - create at room start for enemy spawning (spawnDoors declared early for onMessage callbacks)\n        // doorMargin already declared above for player spawn calculation\n\n        // Map grid directions to door directions (grid uses up/down/right, doors use north/south/east/west)\n        const gridToDoorDirection = {\n            'up': 'north',\n            'down': 'south',\n            'right': 'east'\n        };\n\n        // Get all door positions (we'll determine which are open/blocked based on floor map)\n        const allDoorPositions = [\n            { x: k.width() / 2, y: doorMargin, direction: 'north', gridDir: 'up' },\n            { x: k.width() / 2, y: k.height() - doorMargin, direction: 'south', gridDir: 'down' },\n            { x: doorMargin, y: k.height() / 2, direction: 'west', gridDir: null }, // West is always blocked (no backtracking)\n            { x: k.width() - doorMargin, y: k.height() / 2, direction: 'east', gridDir: 'right' }\n        ];\n\n        // Get available exits from floor map (only shows unvisited connected rooms)\n        const availableExits = gameState.floorMap ? gameState.floorMap.getAvailableExits() : [];\n        const availableGridDirs = new Set(availableExits.map(exit => exit.direction));\n\n        // Create all doors and determine which are blocked\n        allDoorPositions.forEach(pos => {\n            const spawnDoor = createDoor(k, pos.x, pos.y, pos.direction);\n            spawnDoor.open = false;\n            spawnDoor.isSpawnDoor = true; // Mark as spawn door\n            spawnDoor.gridDirection = pos.gridDir; // Store grid direction for later reference\n\n            // Block doors that don't lead to available rooms\n            // West door is always blocked (no backtracking)\n            // Other doors are blocked if not in available exits\n            if (pos.gridDir === null || !availableGridDirs.has(pos.gridDir)) {\n                spawnDoor.blocked = true;\n            }\n\n            spawnDoor.updateVisual(); // Update appearance based on state\n            spawnDoors.push(spawnDoor);\n        });\n\n        // Broadcast door states to clients (with small delay to ensure client has loaded)\n        if (partySize > 1 && isHost()) {\n            k.wait(0.1, () => {\n                const doorStates = {};\n                spawnDoors.forEach(door => {\n                    doorStates[door.direction] = door.blocked;\n                });\n                broadcast('door_states', doorStates);\n            });\n        }\n\n        // Spawn enemies periodically\n        let enemySpawnTimer = 0;\n        const enemySpawnInterval = 0.33; // seconds between spawns (3x faster spawn rate)\n        \n        // Track room start time for entrance door exclusion (after first frame)\n        let roomStartTimeSet = false;\n\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (k.paused || roomCompleted) return;\n\n            // Set room start time on first update\n            if (!roomStartTimeSet) {\n                roomStartTime = k.time();\n                roomStartTimeSet = true;\n            }\n            \n            // Boss room logic\n            if (isBossRoom) {\n                // Spawn boss if not already spawned (only host spawns in multiplayer)\n                if (!bossSpawned && (!isMultiplayerActive() || isHost())) {\n                    bossSpawned = true;\n                    const bossType = getBossTypeForFloor(currentFloor);\n\n                    // Use seeded RNG for boss spawn position in multiplayer\n                    const bossRng = getSeededRoomRNG();\n\n                    // Special handling for Twin Guardians - spawn from opposite doors\n                    if (bossType === 'twinGuardian') {\n                        // Strategy: Spawn guardians from opposite sides for dramatic entrance\n                        // Exclude the door player entered from to avoid spawning on top of player\n                        const availableDoors = spawnDoors.filter(d => d.direction !== gameState.entryDirection);\n                        let door1, door2;\n\n                        if (availableDoors.length >= 2) {\n                            // Step 1: Randomize available doors\n                            // Use Fisher-Yates shuffle with seeded RNG if in multiplayer\n                            const shuffled = [...availableDoors];\n                            for (let i = shuffled.length - 1; i > 0; i--) {\n                                const j = bossRng ? bossRng.range(0, i + 1) : Math.floor(Math.random() * (i + 1));\n                                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n                            }\n                            door1 = shuffled[0];\n\n                            // Step 2: Find the door directly opposite to door1 for maximum dramatic effect\n                            const oppositeMap = {\n                                'north': 'south',\n                                'south': 'north',\n                                'east': 'west',\n                                'west': 'east'\n                            };\n\n                            // Try to find exact opposite door, fallback to second random door if not found\n                            door2 = availableDoors.find(d => d.direction === oppositeMap[door1.direction]) || shuffled[1];\n                        } else {\n                            // Fallback: Not enough doors available (shouldn't happen normally)\n                            // Just use any two available doors\n                            door1 = spawnDoors[0];\n                            door2 = spawnDoors[spawnDoors.length > 1 ? 1 : 0];\n                        }\n\n                        const twinGuardians = createTwinGuardians(k, door1, door2, currentFloor, bossRng);\n\n                        // Register bosses for multiplayer\n                        if (isMultiplayerActive() && isHost()) {\n                            // Twin Guardians returns an array of both guardians\n                            if (Array.isArray(twinGuardians)) {\n                                twinGuardians.forEach(guardian => {\n                                    registerEnemy(guardian, { type: 'twinGuardian', floor: currentFloor });\n                                });\n                            } else if (twinGuardians) {\n                                // Fallback if it returns a single entity\n                                registerEnemy(twinGuardians, { type: 'twinGuardian', floor: currentFloor });\n                            }\n                        }\n\n                        // Play boss spawn sound\n                        playBossSpawn();\n\n                        // Show boss announcement\n                        const announcement = k.add([\n                            k.text('THE CO-HOSTS', { size: 32 }),\n                            k.pos(k.width() / 2, k.height() / 2 - 100),\n                            k.anchor('center'),\n                            k.color(255, 100, 100),\n                            k.fixed()\n                        ]);\n                        k.wait(2, () => {\n                            if (announcement.exists()) k.destroy(announcement);\n                        });\n                    } else {\n                        // Regular boss spawning\n                        // Spawn boss at a door (prefer top door, or random door)\n                        // Avoid spawning at entrance door if player entered from one\n                        let bossSpawnDoor = spawnDoors.find(d => d.direction === 'north');\n                        if (!bossSpawnDoor || (gameState.entryDirection === 'north' && spawnDoors.length > 1)) {\n                            // If top door is entrance or doesn't exist, pick random non-entrance door\n                            const availableDoors = spawnDoors.filter(d => d.direction !== gameState.entryDirection);\n                            if (availableDoors.length > 0) {\n                                const doorIndex = bossRng\n                                    ? bossRng.range(0, availableDoors.length)\n                                    : Math.floor(Math.random() * availableDoors.length);\n                                bossSpawnDoor = availableDoors[doorIndex];\n                            } else {\n                                // Fallback to any door\n                                const doorIndex = bossRng\n                                    ? bossRng.range(0, spawnDoors.length)\n                                    : Math.floor(Math.random() * spawnDoors.length);\n                                bossSpawnDoor = spawnDoors[doorIndex];\n                            }\n                        }\n\n                        const bossX = bossSpawnDoor ? bossSpawnDoor.pos.x : k.width() / 2;\n                        const bossY = bossSpawnDoor ? bossSpawnDoor.pos.y : k.height() / 2;\n                        const boss = createBoss(k, bossX, bossY, bossType, currentFloor, bossRng);\n\n                        // Register boss for multiplayer\n                        if (isMultiplayerActive() && isHost()) {\n                            registerEnemy(boss, { type: bossType, floor: currentFloor, isBoss: true });\n                        }\n\n                        // Play boss spawn sound\n                        playBossSpawn();\n\n                        // Show boss announcement\n                        let bossName = 'BOSS';\n                        if (bossType === 'twinGuardian') {\n                            bossName = 'THE CO-HOSTS';\n                        } else if (BOSS_TYPES[bossType]?.name) {\n                            bossName = `THE ${BOSS_TYPES[bossType].name.toUpperCase()}`;\n                        }\n                        const announcement = k.add([\n                            k.text(bossName, { size: 32 }),\n                            k.pos(k.width() / 2, k.height() / 2 - 100),\n                            k.anchor('center'),\n                            k.color(255, 100, 100),\n                            k.fixed()\n                        ]);\n                        k.wait(2, () => {\n                            if (announcement.exists()) k.destroy(announcement);\n                        });\n                    }\n                }\n                \n                // Check if boss is defeated (only host checks in multiplayer)\n                if (!isMultiplayerActive() || isHost()) {\n                    const bosses = k.get('boss');\n                    const bossMinions = k.get('enemy').filter(e => e.isBossMinion); // Check for boss minions\n                    // Room completes when boss and all boss minions are defeated\n                    if (bosses.length === 0 && bossMinions.length === 0 && !roomCompleted) {\n                        roomCompleted = true;\n                        handleRoomCompletion();\n                    }\n                }\n                return; // Skip regular enemy spawning in boss rooms\n            }\n            \n            // Miniboss room logic\n            // Only host spawns miniboss (clients receive via spawn_entity messages)\n            if (isMinibossRoom && !minibossSpawned && (!isMultiplayerActive() || isHost())) {\n                // Spawn miniboss after a short delay\n                if (k.time() - roomStartTime >= 1.0) {\n                    minibossSpawned = true;\n                    const minibossType = getRandomMinibossType(currentFloor, roomRng);\n\n                    // Use seeded RNG for miniboss spawn position in multiplayer\n                    const minibossRng = getSeededRoomRNG();\n\n                    // Spawn miniboss at a random door (avoid entrance door)\n                    const availableDoors = spawnDoors.filter(d => d.direction !== gameState.entryDirection);\n                    const doorsToUse = availableDoors.length > 0 ? availableDoors : spawnDoors;\n                    const doorIndex = minibossRng\n                        ? minibossRng.range(0, doorsToUse.length)\n                        : Math.floor(Math.random() * doorsToUse.length);\n                    const randomDoor = doorsToUse[doorIndex];\n\n                    const minibossX = randomDoor.pos.x;\n                    const minibossY = randomDoor.pos.y;\n                    const miniboss = createMiniboss(k, minibossX, minibossY, minibossType, currentFloor);\n\n                    // Register miniboss for multiplayer sync (only if host)\n                    if (isMultiplayerActive() && isHost()) {\n                        registerEnemy(miniboss, { type: minibossType, floor: currentFloor });\n                    }\n\n                    // Show miniboss announcement\n                    const minibossName = MINIBOSS_TYPES[minibossType]?.name || 'MINIBOSS';\n                    const announcement = k.add([\n                        k.text(`MINIBOSS: ${minibossName.toUpperCase()}`, { size: 24 }),\n                        k.pos(k.width() / 2, k.height() / 2 - 100),\n                        k.anchor('center'),\n                        k.color(255, 200, 100),\n                        k.fixed()\n                    ]);\n                    k.wait(1.5, () => {\n                        if (announcement.exists()) k.destroy(announcement);\n                    });\n                }\n            }\n            \n            // Regular room logic\n            // Check if all enemies and minibosses are defeated\n            const currentEnemies = k.get('enemy').length;\n            const currentMinibosses = k.get('miniboss').length;\n            const allEnemiesSpawned = enemiesSpawned >= enemiesToSpawn;\n            const allDefeated = allEnemiesSpawned && currentEnemies === 0 && currentMinibosses === 0;\n\n            // Only host checks for room completion in multiplayer\n            if (allDefeated && !roomCompleted && (!isMultiplayerActive() || isHost())) {\n                roomCompleted = true;\n                handleRoomCompletion();\n            }\n            \n            // Spawn enemies if we haven't reached the limit\n            // Only host spawns enemies (clients receive via spawn_entity messages)\n            if (enemiesSpawned < enemiesToSpawn && (!isMultiplayerActive() || isHost())) {\n                enemySpawnTimer += k.dt();\n                \n                // Initial delay before first spawn\n                if (enemiesSpawned === 0 && enemySpawnTimer < initialSpawnDelay) {\n                    return;\n                }\n                \n                if (enemySpawnTimer >= enemySpawnInterval) {\n                    enemySpawnTimer = 0;\n                    enemiesSpawned++;\n\n                    // Get spawn RNG (seeded by room + spawn wave number for multiplayer sync)\n                    const spawnRng = getSeededRoomRNG();\n\n                    // Use consistent seed for this specific spawn\n                    if (spawnRng) {\n                        // Advance RNG state based on spawn number for unique but deterministic spawns\n                        for (let i = 0; i < enemiesSpawned - 1; i++) {\n                            spawnRng.next(); // Consume RNG state to make each spawn unique\n                        }\n                    }\n\n                    // Spawn enemy from random spawn door\n                    // Strategy: Give player breathing room at start by not spawning at entrance\n                    if (spawnDoors.length > 0) {\n                        const timeSinceRoomStart = k.time() - roomStartTime;\n\n                        // Exclude entrance door for first few seconds to avoid overwhelming player\n                        // This gives them time to assess the room and prepare\n                        const excludeEntranceDoor = gameState.entryDirection &&\n                                                   timeSinceRoomStart < entranceDoorExclusionTime;\n\n                        // Filter out entrance door if we're in the exclusion period\n                        const availableDoors = excludeEntranceDoor\n                            ? spawnDoors.filter(door => door.direction !== gameState.entryDirection)\n                            : spawnDoors;\n\n                        // Safety check: If all doors are excluded (shouldn't happen), use all doors\n                        const doorsToUse = availableDoors.length > 0 ? availableDoors : spawnDoors;\n\n                        // Use seeded RNG for door selection in multiplayer\n                        const doorIndex = spawnRng\n                            ? spawnRng.range(0, doorsToUse.length)\n                            : Math.floor(Math.random() * doorsToUse.length);\n                        const randomDoor = doorsToUse[doorIndex];\n                        const spawnX = randomDoor.pos.x;\n                        const spawnY = randomDoor.pos.y;\n\n                        // Add slight random offset to avoid stacking (seeded in multiplayer)\n                        const offset = 15;\n                        const offsetX = spawnX + (spawnRng ? (spawnRng.next() - 0.5) : (Math.random() - 0.5)) * offset;\n                        const offsetY = spawnY + (spawnRng ? (spawnRng.next() - 0.5) : (Math.random() - 0.5)) * offset;\n\n                        // Spawn random enemy type based on floor (host will broadcast this)\n                        // Use seeded RNG in multiplayer to ensure consistent enemy types\n                        const enemyType = getRandomEnemyType(currentFloor, spawnRng);\n                        const enemy = createEnemy(k, offsetX, offsetY, enemyType, currentFloor, spawnRng);\n\n                        // Try to make elite (10-15% chance on floor 2+)\n                        tryMakeElite(k, enemy, currentFloor, spawnRng);\n\n                        // Register enemy for multiplayer sync (only if host)\n                        if (isMultiplayerActive() && isHost()) {\n                            registerEnemy(enemy, { type: enemyType, floor: currentFloor, isElite: enemy.isElite, eliteModifier: enemy.eliteModifier });\n                        }\n                    } else {\n                        // Fallback to edge spawning if no doors (shouldn't happen)\n                        // Use seeded RNG in multiplayer\n                        const side = spawnRng ? spawnRng.range(0, 4) : Math.floor(k.rand(0, 4));\n                        let x, y;\n\n                        switch (side) {\n                            case 0: // Top\n                                x = spawnRng ? spawnRng.rangeFloat(margin, k.width() - margin) : k.rand(margin, k.width() - margin);\n                                y = margin;\n                                break;\n                            case 1: // Right\n                                x = k.width() - margin;\n                                y = spawnRng ? spawnRng.rangeFloat(margin, k.height() - margin) : k.rand(margin, k.height() - margin);\n                                break;\n                            case 2: // Bottom\n                                x = spawnRng ? spawnRng.rangeFloat(margin, k.width() - margin) : k.rand(margin, k.width() - margin);\n                                y = k.height() - margin;\n                                break;\n                            case 3: // Left\n                                x = margin;\n                                y = spawnRng ? spawnRng.rangeFloat(margin, k.height() - margin) : k.rand(margin, k.height() - margin);\n                                break;\n                        }\n\n                        // Use seeded RNG in multiplayer to ensure consistent enemy types\n                        const enemyType = getRandomEnemyType(currentFloor, spawnRng);\n                        const enemy = createEnemy(k, x, y, enemyType, currentFloor, spawnRng);\n\n                        // Try to make elite (10-15% chance on floor 2+)\n                        tryMakeElite(k, enemy, currentFloor, spawnRng);\n\n                        // Register enemy for multiplayer sync (only if host)\n                        if (isMultiplayerActive() && isHost()) {\n                            registerEnemy(enemy, { type: enemyType, floor: currentFloor, isElite: enemy.isElite, eliteModifier: enemy.eliteModifier });\n                        }\n                    }\n                }\n            }\n        }));\n\n        // Update enemy death handling\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (k.paused) return;\n            \n            k.get('enemy').forEach(enemy => {\n                if (enemy.hp() <= 0 && !enemy.isDead) {\n                    enemy.isDead = true;\n                    const xpValue = enemy.xpValue;\n                    const posX = enemy.pos.x;\n                    const posY = enemy.pos.y;\n\n                    // Clean up health bars before destroying enemy\n                    if (enemy.cleanupHealthBars) {\n                        enemy.cleanupHealthBars();\n                    }\n\n                    // Handle explosion (damage nearby entities)\n                    if (enemy.explodes && enemy.explosionRadius) {\n                        const explosionRadius = enemy.explosionRadius;\n                        const explosionDamage = enemy.explosionDamage || 15;\n\n                        // Damage player if in range\n                        if (player.exists()) {\n                            const distToPlayer = Math.sqrt(\n                                Math.pow(player.pos.x - posX, 2) +\n                                Math.pow(player.pos.y - posY, 2)\n                            );\n                            if (distToPlayer <= explosionRadius) {\n                                player.takeDamage(explosionDamage);\n                            }\n                        }\n\n                        // Damage other enemies in range (optimized with spatial grid)\n                        // OLD: k.get('enemy').forEach() - checks ALL enemies (O(n))\n                        // NEW: getNearby() - only checks enemies in nearby grid cells (O(1))\n                        const nearbyEnemies = spatialGrids.enemies.getNearby(posX, posY, explosionRadius);\n                        nearbyEnemies.forEach(other => {\n                            if (other === enemy || !other.exists()) return;\n                            // Use squared distance to avoid expensive sqrt\n                            const dx = other.pos.x - posX;\n                            const dy = other.pos.y - posY;\n                            const distSq = dx * dx + dy * dy;\n                            if (distSq <= explosionRadius * explosionRadius) {\n                                other.hurt(explosionDamage);\n                            }\n                        });\n\n                        // Spawn larger explosion particle for exploding enemies\n                        spawnDeathExplosion(k, posX, posY, {\n                            color: [255, 150, 50],\n                            scale: 1.5\n                        });\n                    } else {\n                        // Use cosmetic death effect if equipped, otherwise default\n                        const deathEffect = gameState.equippedCosmetics?.death;\n                        const enemyColor = enemy.originalColor || [255, 100, 100];\n                        if (deathEffect && deathEffect !== 'deathNone') {\n                            spawnCosmeticDeath(k, posX, posY, deathEffect, enemyColor);\n                        } else {\n                            spawnDeathExplosion(k, posX, posY, { color: enemyColor });\n                        }\n                    }\n\n                    // Handle shrapnel (projectiles in all directions)\n                    if (enemy.shrapnel && enemy.shrapnelCount) {\n                        const shrapnelCount = enemy.shrapnelCount;\n                        const angleStep = (Math.PI * 2) / shrapnelCount;\n                        const shrapnelSpeed = 250;\n                        const shrapnelDamage = Math.floor((enemy.explosionDamage || 15) * 0.6);\n\n                        for (let i = 0; i < shrapnelCount; i++) {\n                            const angle = angleStep * i;\n                            const direction = k.vec2(Math.cos(angle), Math.sin(angle));\n                            const projectile = createProjectile(\n                                k,\n                                posX,\n                                posY,\n                                direction,\n                                shrapnelSpeed,\n                                shrapnelDamage,\n                                0, // piercing\n                                0, // obstaclePiercing\n                                false // isCrit\n                            );\n                            projectile.isEnemyProjectile = true;\n                            projectile.color = k.rgb(...enemy.originalColor);\n                        }\n                    }\n\n                    // Clean up health bars before destroying enemy\n                    if (enemy.cleanupHealthBars && typeof enemy.cleanupHealthBars === 'function') {\n                        enemy.cleanupHealthBars();\n                    }\n\n                    // Broadcast enemy death to all players (host broadcasts to clients, client sends to host)\n                    if (isMultiplayerActive() && enemy.mpEntityId) {\n                        if (isHost()) {\n                            // Host broadcasts death to all clients\n                            broadcastDeathEvent({\n                                entityId: enemy.mpEntityId,\n                                entityType: 'enemy',\n                                x: posX,\n                                y: posY\n                            });\n                        } else {\n                            // Client sends death notification to host\n                            // The host will then broadcast to all clients\n                            sendEnemyDeath({\n                                entityId: enemy.mpEntityId,\n                                entityType: 'enemy',\n                                x: posX,\n                                y: posY\n                            });\n                        }\n                    }\n\n                    k.destroy(enemy);\n\n                    // Play enemy death sound\n                    playEnemyDeath();\n\n                    // Track enemy kill by type\n                    runStats.enemiesKilled++;\n                    const enemyType = enemy.type || enemy.enemyType || 'basic';\n                    runStats.killsByType[enemyType] = (runStats.killsByType[enemyType] || 0) + 1;\n\n                    // Track kill for the player who last hit this enemy\n                    const killerSlot = enemy.lastHitBySlot;\n                    if (killerSlot !== undefined && players[killerSlot] && players[killerSlot].runStats) {\n                        players[killerSlot].runStats.kills++;\n                    } else if (player.runStats) {\n                        // Fallback to local player if no killer tracked\n                        player.runStats.kills++;\n                    }\n\n                    // Only spawn pickups if we're the host (or not in multiplayer)\n                    // Pickups will be broadcast to clients via registerPickup()\n                    if (!isMultiplayerActive() || isHost()) {\n                        // Get loot RNG (seeded for multiplayer to ensure consistent drops)\n                        const lootRng = getSeededRoomRNG();\n\n                        // Spawn XP pickup at enemy position\n                        // Note: createXPPickup handles multiplayer registration internally\n                        const xpPickup = createXPPickup(k, posX, posY, xpValue);\n\n                        // Spawn currency drops (1-3 coins with random currency icons)\n                        const currencyDropCount = lootRng ? lootRng.range(1, 4) : Math.floor(Math.random() * 3) + 1;\n                        const currencyValue = 1; // Each coin is worth 1 currency\n                        for (let i = 0; i < currencyDropCount; i++) {\n                            // Spread drops slightly\n                            const offsetX = lootRng ? (lootRng.next() - 0.5) * 20 : (Math.random() - 0.5) * 20;\n                            const offsetY = lootRng ? (lootRng.next() - 0.5) * 20 : (Math.random() - 0.5) * 20;\n                            const icon = getRandomCurrencyIcon();\n                            // Note: createCurrencyPickup handles multiplayer registration internally\n                            const currencyPickup = createCurrencyPickup(k, posX + offsetX, posY + offsetY, currencyValue, icon);\n                        }\n\n                        // Check for powerup weapon drop\n                        const powerupDrop = rollPowerupDrop(enemy.type, currentFloor);\n                        if (powerupDrop) {\n                            // Offset slightly to avoid overlap with other pickups\n                            const offsetX = lootRng ? (lootRng.next() - 0.5) * 30 : (Math.random() - 0.5) * 30;\n                            const offsetY = lootRng ? (lootRng.next() - 0.5) * 30 : (Math.random() - 0.5) * 30;\n                            // Note: createPowerupWeaponPickup handles multiplayer registration internally\n                            const powerupPickup = createPowerupWeaponPickup(k, posX + offsetX, posY + offsetY, powerupDrop);\n                        }\n                    }\n                }\n            });\n            \n            // Update miniboss death handling\n            k.get('miniboss').forEach(miniboss => {\n                if (miniboss.hp() <= 0 && !miniboss.isDead) {\n                    miniboss.isDead = true;\n                    const xpValue = miniboss.xpValue;\n                    const posX = miniboss.pos.x;\n                    const posY = miniboss.pos.y;\n\n                    // Spawn death explosion particle effect for miniboss\n                    spawnDeathExplosion(k, posX, posY, { color: [255, 150, 100], isMiniboss: true });\n\n                    k.destroy(miniboss);\n\n                    // Play enemy death sound (louder for miniboss)\n                    playEnemyDeath();\n\n                    // Track miniboss kill by type (counts as enemy too)\n                    runStats.enemiesKilled++;\n                    const minibossType = miniboss.type || 'miniboss';\n                    runStats.killsByType[minibossType] = (runStats.killsByType[minibossType] || 0) + 1;\n\n                    // Track kill for the player who last hit this miniboss\n                    const minibossKillerSlot = miniboss.lastHitBySlot;\n                    if (minibossKillerSlot !== undefined && players[minibossKillerSlot] && players[minibossKillerSlot].runStats) {\n                        players[minibossKillerSlot].runStats.kills++;\n                    } else if (player.runStats) {\n                        // Fallback to local player if no killer tracked\n                        player.runStats.kills++;\n                    }\n\n                    // Only spawn pickups if we're the host (or not in multiplayer)\n                    if (!isMultiplayerActive() || isHost()) {\n                        // Get loot RNG (seeded for multiplayer)\n                        const lootRng = getSeededRoomRNG();\n\n                        // Spawn XP pickup at miniboss position (minibosses give more XP than regular enemies)\n                        // Note: createXPPickup handles multiplayer registration internally\n                        const xpPickup = createXPPickup(k, posX, posY, xpValue);\n\n                        // Spawn currency drops (10-15 coins with random currency icons)\n                        const minibossCurrencyCount = lootRng ? lootRng.range(10, 16) : Math.floor(Math.random() * 6) + 10;\n                        const minibossCurrencyValue = 1; // Each coin is worth 1 currency\n                        for (let i = 0; i < minibossCurrencyCount; i++) {\n                            // Spread drops in a circle\n                            const angle = (Math.PI * 2 / minibossCurrencyCount) * i;\n                            const radius = lootRng ? (30 + lootRng.next() * 20) : (30 + Math.random() * 20);\n                            const offsetX = Math.cos(angle) * radius;\n                            const offsetY = Math.sin(angle) * radius;\n                            // Note: createCurrencyPickup handles multiplayer registration internally\n                            const currencyPickup = createCurrencyPickup(k, posX + offsetX, posY + offsetY, minibossCurrencyValue);\n                        }\n                    }\n\n                    // Miniboss death effects (visual feedback)\n                    const deathText = k.add([\n                        k.text('MINIBOSS DEFEATED!', { size: 20 }),\n                        k.pos(posX, posY - 30),\n                        k.anchor('center'),\n                        k.color(255, 200, 100),\n                        k.fixed()\n                    ]);\n                    k.wait(1.0, () => {\n                        if (deathText.exists()) k.destroy(deathText);\n                    });\n                }\n            });\n            \n            // Update boss death handling\n            k.get('boss').forEach(boss => {\n                if (boss.hp() <= 0 && !boss.isDead) {\n                    boss.isDead = true;\n                    const xpValue = boss.xpValue;\n                    const posX = boss.pos.x;\n                    const posY = boss.pos.y;\n\n                    // Spawn death explosion particle effect for boss\n                    spawnDeathExplosion(k, posX, posY, { color: [255, 200, 100], isBoss: true });\n\n                    k.destroy(boss);\n\n                    // Play boss death sound\n                    playBossDeath();\n\n                    // Track boss kill by type (counts as enemy too)\n                    runStats.enemiesKilled++;\n                    runStats.bossesKilled++;\n                    const bossType = boss.type || 'boss';\n                    runStats.killsByType[bossType] = (runStats.killsByType[bossType] || 0) + 1;\n\n                    // Track kill for the player who last hit this boss\n                    const bossKillerSlot = boss.lastHitBySlot;\n                    if (bossKillerSlot !== undefined && players[bossKillerSlot] && players[bossKillerSlot].runStats) {\n                        players[bossKillerSlot].runStats.kills++;\n                        players[bossKillerSlot].runStats.bossesKilled++;\n                    } else if (player.runStats) {\n                        // Fallback to local player if no killer tracked\n                        player.runStats.kills++;\n                        player.runStats.bossesKilled++;\n                    }\n\n                    // Only spawn pickups if we're the host (or not in multiplayer)\n                    if (!isMultiplayerActive() || isHost()) {\n                        // Get loot RNG (seeded for multiplayer)\n                        const lootRng = getSeededRoomRNG();\n\n                        // Spawn XP pickup at boss position (bosses give more XP)\n                        // Note: createXPPickup handles multiplayer registration internally\n                        const xpPickup = createXPPickup(k, posX, posY, xpValue);\n\n                        // Spawn currency drops (20-30 coins with SAME currency icon)\n                        const bossCurrencyCount = lootRng ? lootRng.range(20, 31) : Math.floor(Math.random() * 11) + 20;\n                        const bossCurrencyValue = 1; // Each coin is worth 1 currency\n                        const bossCurrencyIcon = getRandomCurrencyIcon(); // Pick ONE icon for all boss drops\n                        for (let i = 0; i < bossCurrencyCount; i++) {\n                            // Spread drops in a large circle\n                            const angle = (Math.PI * 2 / bossCurrencyCount) * i;\n                            const radius = lootRng ? (40 + lootRng.next() * 30) : (40 + Math.random() * 30);\n                            const offsetX = Math.cos(angle) * radius;\n                            const offsetY = Math.sin(angle) * radius;\n                            // Use the same icon for all boss drops\n                            // Note: createCurrencyPickup handles multiplayer registration internally\n                            const currencyPickup = createCurrencyPickup(k, posX + offsetX, posY + offsetY, bossCurrencyValue, bossCurrencyIcon);\n                        }\n                    }\n\n                    // Boss death effects (visual feedback)\n                    const deathText = k.add([\n                        k.text('BOSS DEFEATED!', { size: 24 }),\n                        k.pos(posX, posY - 30),\n                        k.anchor('center'),\n                        k.color(255, 255, 100),\n                        k.fixed()\n                    ]);\n                    k.wait(1.5, () => {\n                        if (deathText.exists()) k.destroy(deathText);\n                    });\n                }\n            });\n        }));\n\n        // Handle XP pickup magnetization and collection\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (!player.exists() || k.paused) return;\n\n            // Auto-pickup XP: use screen-wide radius if enabled\n            const autoPickupXP = getSetting('gameplay', 'autoPickupXP');\n            const effectiveXPRadius = autoPickupXP ? 2000 : player.pickupRadius;\n\n            // OPTIMIZATION: Instead of checking ALL pickups, only check pickups near players\n            // Get nearby pickups using spatial grid (much faster than k.get('xpPickup'))\n            const pickupCheckRadius = effectiveXPRadius * 1.5; // Add buffer for safety\n            const nearbyPickups = new Set(); // Use Set to avoid duplicates in multiplayer\n\n            // In single player, only check near the player\n            if (partySize === 1) {\n                spatialGrids.pickups.getNearby(player.pos.x, player.pos.y, pickupCheckRadius).forEach(p => {\n                    if (p.is && p.is('xpPickup')) nearbyPickups.add(p);\n                });\n            } else {\n                // In multiplayer, check near ALL players\n                players.forEach(p => {\n                    if (!p || !p.exists() || p.isDead) return;\n                    spatialGrids.pickups.getNearby(p.pos.x, p.pos.y, pickupCheckRadius).forEach(pickup => {\n                        if (pickup.is && pickup.is('xpPickup')) nearbyPickups.add(pickup);\n                    });\n                });\n            }\n\n            nearbyPickups.forEach(pickup => {\n                if (pickup.collected) return;\n\n                // In multiplayer, check distance to ALL players\n                // In single player, only check local player\n                let closestPlayer = player;\n                let closestDistance = k.vec2(\n                    player.pos.x - pickup.pos.x,\n                    player.pos.y - pickup.pos.y\n                ).len();\n\n                if (partySize > 1) {\n                    // Check all players to find the closest one\n                    players.forEach(p => {\n                        if (!p || !p.exists() || p.isDead) return;\n                        const dist = k.vec2(\n                            p.pos.x - pickup.pos.x,\n                            p.pos.y - pickup.pos.y\n                        ).len();\n                        if (dist < closestDistance) {\n                            closestDistance = dist;\n                            closestPlayer = p;\n                        }\n                    });\n                }\n\n                // Start magnetizing if within pickup radius (once started, never stops)\n                // Use effective radius for auto-pickup setting\n                const magnetRadius = autoPickupXP ? effectiveXPRadius : closestPlayer.pickupRadius;\n                if (!pickup.magnetizing && closestDistance <= magnetRadius) {\n                    pickup.magnetizing = true;\n                    pickup.targetPlayer = closestPlayer;\n                }\n\n                // Auto-collect if very close (collection radius is smaller than pickup radius)\n                // In multiplayer, only the host handles pickup collection to ensure all players get rewards\n                if (closestDistance <= PICKUP_CONFIG.COLLECTION_RADIUS && !pickup.collected) {\n                    // In multiplayer, only host collects pickups\n                    if (isMultiplayerActive() && !isHost()) {\n                        return; // Skip on clients - host will handle collection\n                    }\n\n                    pickup.collected = true; // Set flag FIRST to prevent race conditions\n                    playXPPickup();\n\n                    // In multiplayer, give XP to all players (shared XP)\n                    if (partySize > 1) {\n                        // HOST: Give XP to local host player and broadcast to clients\n                        if (isHost()) {\n                            // Give XP to local player\n                            if (player.exists() && !player.isDead && player.addXP) {\n                                player.addXP(pickup.value);\n                            }\n                            // Broadcast XP gain to clients\n                            broadcastXPGain(pickup.value);\n                        } else {\n                            // CLIENT: Give XP to local client player (handled by xp_gain broadcast)\n                            // Don't add XP here - will be added when receiving broadcast\n                        }\n                    } else {\n                        // Single player: just give to local player\n                        player.addXP(pickup.value);\n                    }\n\n                    pickup.isFlyingToUI = true;\n                }\n            });\n        }));\n\n        // Handle currency pickup magnetization and collection\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (!player.exists() || k.paused) return;\n\n            // Auto-pickup currency: use screen-wide radius if enabled\n            const autoPickupCurrency = getSetting('gameplay', 'autoPickupCurrency');\n            const effectiveCurrencyRadius = autoPickupCurrency ? 2000 : player.pickupRadius;\n\n            // OPTIMIZATION: Only check pickups near players (using spatial grid)\n            const pickupCheckRadius = effectiveCurrencyRadius * 1.5;\n            const nearbyPickups = new Set();\n\n            if (partySize === 1) {\n                spatialGrids.pickups.getNearby(player.pos.x, player.pos.y, pickupCheckRadius).forEach(p => {\n                    if (p.is && p.is('currencyPickup')) nearbyPickups.add(p);\n                });\n            } else {\n                players.forEach(p => {\n                    if (!p || !p.exists() || p.isDead) return;\n                    spatialGrids.pickups.getNearby(p.pos.x, p.pos.y, pickupCheckRadius).forEach(pickup => {\n                        if (pickup.is && pickup.is('currencyPickup')) nearbyPickups.add(pickup);\n                    });\n                });\n            }\n\n            nearbyPickups.forEach(pickup => {\n                if (pickup.collected) return;\n\n                // In multiplayer, check distance to ALL players\n                // In single player, only check local player\n                let closestPlayer = player;\n                let closestDistance = k.vec2(\n                    player.pos.x - pickup.pos.x,\n                    player.pos.y - pickup.pos.y\n                ).len();\n\n                if (partySize > 1) {\n                    // Check all players to find the closest one\n                    players.forEach(p => {\n                        if (!p || !p.exists() || p.isDead) return;\n                        const dist = k.vec2(\n                            p.pos.x - pickup.pos.x,\n                            p.pos.y - pickup.pos.y\n                        ).len();\n                        if (dist < closestDistance) {\n                            closestDistance = dist;\n                            closestPlayer = p;\n                        }\n                    });\n                }\n\n                // Start magnetizing if within pickup radius (once started, never stops)\n                // Use effective radius for auto-pickup setting\n                const magnetRadius = autoPickupCurrency ? effectiveCurrencyRadius : closestPlayer.pickupRadius;\n                if (!pickup.magnetizing && closestDistance <= magnetRadius) {\n                    pickup.magnetizing = true;\n                    pickup.targetPlayer = closestPlayer;\n                }\n\n                // Auto-collect if very close (collection radius is smaller than pickup radius)\n                // In multiplayer, only the host handles pickup collection\n                if (closestDistance <= PICKUP_CONFIG.COLLECTION_RADIUS && !pickup.collected) {\n                    // In multiplayer, only host collects pickups\n                    if (isMultiplayerActive() && !isHost()) {\n                        return; // Skip on clients - host will handle collection\n                    }\n\n                    pickup.collected = true; // Set flag FIRST to prevent race conditions\n                    playCurrencyPickup(); // Coin/cash pickup sound\n\n                    // In multiplayer, currency is shared (everyone gets it)\n                    // Currency is persistent across the run, so just add once\n                    addCurrency(pickup.value); // Add currency to persistent storage\n\n                    // Track credits picked up for the player who collected it\n                    if (closestPlayer && closestPlayer.runStats) {\n                        closestPlayer.runStats.creditsPickedUp += pickup.value;\n                    }\n\n                    // Broadcast currency gain to clients\n                    if (isMultiplayerActive()) {\n                        broadcastCurrencyGain(pickup.value);\n                    }\n\n                    pickup.isFlyingToUI = true;\n                }\n            });\n\n            // Handle powerup weapon pickup collection (optimized with spatial grid)\n            const nearbyPowerups = spatialGrids.pickups.getNearby(player.pos.x, player.pos.y, player.pickupRadius * 1.5);\n            nearbyPowerups.forEach(pickup => {\n                if (!pickup.is || !pickup.is('powerupWeaponPickup')) return;\n                if (pickup.collected) return;\n\n                const distance = k.vec2(\n                    player.pos.x - pickup.pos.x,\n                    player.pos.y - pickup.pos.y\n                ).len();\n\n                // Start magnetizing if within pickup radius (once started, never stops)\n                if (!pickup.magnetizing && distance <= player.pickupRadius) {\n                    pickup.magnetizing = true;\n                    pickup.targetPlayer = player;\n                }\n\n                // Auto-collect if very close (collection radius is smaller than pickup radius)\n                if (distance <= PICKUP_CONFIG.COLLECTION_RADIUS && !pickup.collected) {\n                    // In multiplayer, only host collects pickups\n                    if (isMultiplayerActive() && !isHost()) {\n                        return; // Skip on clients - host will handle collection\n                    }\n\n                    pickup.collected = true; // Set flag FIRST to prevent race conditions\n                    playCurrencyPickup(); // Use currency pickup sound for now\n\n                    // Apply powerup weapon to player (in multiplayer, applies to all players)\n                    if (isMultiplayerActive() && isHost()) {\n                        // Apply powerup to all players in party\n                        const allPlayers = k.get('player');\n                        allPlayers.forEach(p => {\n                            applyPowerupWeapon(p, pickup.powerupKey);\n                        });\n                        // Broadcast powerup application to all clients\n                        broadcastPowerupWeaponApplied(pickup.powerupKey);\n                    } else {\n                        // Singleplayer: apply to local player only\n                        applyPowerupWeapon(player, pickup.powerupKey);\n                    }\n\n                    // Visual feedback - flash effect\n                    const powerup = POWERUP_WEAPONS[pickup.powerupKey];\n                    const flash = k.add([\n                        k.text(powerup.icon, { size: 32 }),\n                        k.pos(player.pos.x, player.pos.y - 30),\n                        k.color(...powerup.color),\n                        k.anchor('center'),\n                        k.z(UI_Z_LAYERS.UI_TEXT + 1),\n                        k.opacity(1)\n                    ]);\n\n                    // Animate flash fading and rising\n                    let flashAge = 0;\n                    flash.onUpdate(() => {\n                        flashAge += k.dt();\n                        flash.pos.y -= 50 * k.dt();\n                        flash.opacity = Math.max(0, 1 - flashAge / 0.8);\n                        if (flashAge >= 0.8) {\n                            k.destroy(flash);\n                        }\n                    });\n\n                    k.destroy(pickup);\n                }\n            });\n        }));\n\n        // Track door progress circle for multiplayer\n        let doorProgressCircle = null;\n        let doorProgressBg = null;\n        let doorProgressTime = 0;\n        let doorProgressDoor = null;\n        let doorProgressIsForced = false;\n        const DOOR_PROGRESS_DURATION = 0.5; // seconds when all players present\n        const DOOR_FORCE_DURATION = 10; // seconds when only host (force advance)\n\n        // Client-side: listen for door progress updates from host\n        if (isMultiplayerActive() && !isHost()) {\n            onMessage('door_progress', (data) => {\n                if (data.clear) {\n                    // Clear progress UI\n                    if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\n                    if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\n                    doorProgressBg = null;\n                    doorProgressCircle = null;\n                    return;\n                }\n\n                // Create UI if it doesn't exist\n                if (!doorProgressBg || !doorProgressBg.exists()) {\n                    doorProgressBg = k.add([\n                        k.circle(20),\n                        k.pos(data.doorX, data.doorY),\n                        k.anchor('center'),\n                        k.color(80, 80, 80),\n                        k.opacity(0.8),\n                        k.z(200),\n                        'doorProgress'\n                    ]);\n\n                    doorProgressCircle = k.add([\n                        k.circle(18),\n                        k.pos(data.doorX, data.doorY),\n                        k.anchor('center'),\n                        k.color(data.isForced ? 255 : 100, data.isForced ? 200 : 255, data.isForced ? 0 : 100),\n                        k.opacity(0),\n                        k.z(201),\n                        'doorProgress'\n                    ]);\n                }\n\n                // Update progress visual\n                if (doorProgressCircle && doorProgressCircle.exists()) {\n                    doorProgressCircle.opacity = data.progress;\n                    doorProgressCircle.scale = k.vec2(data.progress, data.progress);\n                    // Update color if mode changed\n                    doorProgressCircle.color = k.rgb(\n                        data.isForced ? 255 : 100,\n                        data.isForced ? 200 : 255,\n                        data.isForced ? 0 : 100\n                    );\n                }\n            });\n\n            // Client-side: listen for barrel damage from host\n            onMessage('barrel_damage', (data) => {\n                const barrel = findBarrelByPosition(data.x, data.y);\n                if (barrel && barrel.exists() && !barrel.isExploding) {\n                    // Sync health directly (more reliable than applying damage)\n                    barrel.currentHealth = data.currentHealth;\n                    barrel.updateHealthBar();\n                }\n            });\n\n            // Client-side: listen for barrel explosions from host\n            onMessage('barrel_explode', (data) => {\n                const barrel = findBarrelByPosition(data.x, data.y);\n                if (barrel && barrel.exists() && !barrel.isExploding) {\n                    // Trigger local explosion (won't broadcast since we're not host)\n                    barrel.explode();\n                }\n            });\n        }\n\n        // Handle door interaction (proximity-based)\n        eventHandlers.updates.push(k.onUpdate(() => {\n            if (!player.exists() || k.paused || doorEntered || isUpgradeDraftActive()) return;\n\n            // In multiplayer, only HOST checks for door transitions\n            // Clients wait for room_transition broadcast from host\n            if (isMultiplayerActive() && !isHost()) {\n                return; // Clients don't check doors - wait for host signal\n            }\n\n            k.get('door').forEach(door => {\n                // Only interact with exit doors (not spawn doors, not blocked doors)\n                if (!door.open || doorEntered || door.isSpawnDoor || door.blocked) return;\n\n                // In multiplayer, check player positions\n                if (partySize > 1) {\n                    let hostInRange = false;\n                    let allPlayersInRange = true;\n\n                    players.forEach((p, index) => {\n                        if (!p || !p.exists()) return;\n                        if (p.isDead || p.hp() <= 0) return;\n\n                        const distance = k.vec2(\n                            p.pos.x - door.pos.x,\n                            p.pos.y - door.pos.y\n                        ).len();\n\n                        const inRange = distance <= 40;\n                        if (index === 0) hostInRange = inRange;\n                        if (!inRange) allPlayersInRange = false;\n                    });\n\n                    const shouldShowProgress = allPlayersInRange || hostInRange;\n                    const isForced = hostInRange && !allPlayersInRange;\n                    const duration = isForced ? DOOR_FORCE_DURATION : DOOR_PROGRESS_DURATION;\n\n                    if (shouldShowProgress) {\n                        // Reset if new door or mode changed\n                        if (doorProgressDoor !== door || doorProgressIsForced !== isForced) {\n                            doorProgressTime = 0;\n                            doorProgressDoor = door;\n                            doorProgressIsForced = isForced;\n\n                            if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\n                            if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\n\n                            doorProgressBg = k.add([\n                                k.circle(20),\n                                k.pos(door.pos.x, door.pos.y),\n                                k.anchor('center'),\n                                k.color(80, 80, 80),\n                                k.opacity(0.8),\n                                k.z(200),\n                                'doorProgress'\n                            ]);\n\n                            doorProgressCircle = k.add([\n                                k.circle(18),\n                                k.pos(door.pos.x, door.pos.y),\n                                k.anchor('center'),\n                                k.color(isForced ? 255 : 100, isForced ? 200 : 255, isForced ? 0 : 100),\n                                k.opacity(0),\n                                k.z(201),\n                                'doorProgress'\n                            ]);\n                        }\n\n                        doorProgressTime += k.dt();\n                        const progress = Math.min(doorProgressTime / duration, 1);\n\n                        if (doorProgressCircle && doorProgressCircle.exists()) {\n                            doorProgressCircle.opacity = progress;\n                            doorProgressCircle.scale = k.vec2(progress, progress);\n                        }\n\n                        // Broadcast to clients\n                        if (isMultiplayerActive()) {\n                            broadcast('door_progress', {\n                                doorX: door.pos.x,\n                                doorY: door.pos.y,\n                                progress: progress,\n                                isForced: isForced\n                            });\n                        }\n\n                        if (progress >= 1) {\n                            doorEntered = true;\n                            playDoorOpen();\n                            if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\n                            if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\n                            doorProgressDoor = null;\n                            if (isMultiplayerActive()) {\n                                broadcast('door_progress', { progress: 0, clear: true });\n                            }\n                            handleDoorEntry(door.direction);\n                        }\n                    } else if (doorProgressDoor === door) {\n                        doorProgressTime = 0;\n                        doorProgressDoor = null;\n                        doorProgressIsForced = false;\n                        if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\n                        if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\n                        if (isMultiplayerActive()) {\n                            broadcast('door_progress', { progress: 0, clear: true });\n                        }\n                    }\n                } else {\n                    // Single player: use progress bar like multiplayer\n                    // Skip if player is dead (prevent race condition with game over)\n                    if (player.isDead || player.hp() <= 0) return;\n\n                    const distance = k.vec2(\n                        player.pos.x - door.pos.x,\n                        player.pos.y - door.pos.y\n                    ).len();\n\n                    const inRange = distance <= 40;\n\n                    if (inRange) {\n                        // Initialize progress bar if new door\n                        if (doorProgressDoor !== door) {\n                            doorProgressTime = 0;\n                            doorProgressDoor = door;\n                            doorProgressIsForced = false;\n\n                            if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\n                            if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\n\n                            doorProgressBg = k.add([\n                                k.circle(20),\n                                k.pos(door.pos.x, door.pos.y),\n                                k.anchor('center'),\n                                k.color(80, 80, 80),\n                                k.opacity(0.8),\n                                k.z(200),\n                                'doorProgress'\n                            ]);\n\n                            doorProgressCircle = k.add([\n                                k.circle(18),\n                                k.pos(door.pos.x, door.pos.y),\n                                k.anchor('center'),\n                                k.color(100, 255, 100), // Green for single player\n                                k.opacity(0),\n                                k.z(201),\n                                'doorProgress'\n                            ]);\n                        }\n\n                        doorProgressTime += k.dt();\n                        const progress = Math.min(doorProgressTime / DOOR_PROGRESS_DURATION, 1);\n\n                        if (doorProgressCircle && doorProgressCircle.exists()) {\n                            doorProgressCircle.opacity = progress;\n                            doorProgressCircle.scale = k.vec2(progress, progress);\n                        }\n\n                        if (progress >= 1) {\n                            doorEntered = true;\n                            playDoorOpen();\n                            if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\n                            if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\n                            doorProgressDoor = null;\n                            handleDoorEntry(door.direction);\n                        }\n                    } else if (doorProgressDoor === door) {\n                        // Player left door range - reset progress\n                        doorProgressTime = 0;\n                        doorProgressDoor = null;\n                        doorProgressIsForced = false;\n                        if (doorProgressBg && doorProgressBg.exists()) k.destroy(doorProgressBg);\n                        if (doorProgressCircle && doorProgressCircle.exists()) k.destroy(doorProgressCircle);\n                    }\n                }\n            });\n\n            if (!doorProgressDoor && doorProgressBg && doorProgressBg.exists()) {\n                k.destroy(doorProgressBg);\n                k.destroy(doorProgressCircle);\n            }\n        }));\n\n        // Spawn reward pickups when room is cleared\n        function spawnRoomClearRewards() {\n            if (!player.exists()) return;\n\n            // Determine spawn position (center of room)\n            const centerX = k.width() / 2;\n            const centerY = k.height() / 2;\n\n            // Calculate rewards based on floor and whether it's a boss room\n            const baseXP = 5;\n            const baseCurrency = 3;\n\n            // Boss rooms give more rewards\n            const xpMultiplier = isBossRoom ? 3 : 1;\n            const currencyMultiplier = isBossRoom ? 4 : 1;\n\n            // Floor scaling\n            const floorBonus = currentFloor * 0.5;\n\n            const numXPPickups = Math.floor((baseXP + floorBonus) * xpMultiplier);\n            const numCurrencyPickups = Math.floor((baseCurrency + floorBonus) * currencyMultiplier);\n\n            // Use seeded RNG for multiplayer consistency\n            const rewardRng = getSeededRoomRNG();\n\n            // Spawn XP pickups in a spread pattern\n            for (let i = 0; i < numXPPickups; i++) {\n                const angle = (Math.PI * 2 * i) / numXPPickups + (rewardRng ? rewardRng.next() : Math.random()) * 0.3;\n                const distance = 40 + (rewardRng ? rewardRng.next() : Math.random()) * 60;\n                const x = centerX + Math.cos(angle) * distance;\n                const y = centerY + Math.sin(angle) * distance;\n\n                // Each XP pickup is worth more on higher floors\n                const xpValue = Math.floor(1 + currentFloor * 0.5);\n                // Note: createXPPickup handles multiplayer registration internally\n                const xpPickup = createXPPickup(k, x, y, xpValue);\n            }\n\n            // Spawn currency pickups in a spread pattern\n            for (let i = 0; i < numCurrencyPickups; i++) {\n                const angle = (Math.PI * 2 * i) / numCurrencyPickups + (rewardRng ? rewardRng.next() : Math.random()) * 0.3 + 0.5;\n                const distance = 50 + (rewardRng ? rewardRng.next() : Math.random()) * 70;\n                const x = centerX + Math.cos(angle) * distance;\n                const y = centerY + Math.sin(angle) * distance;\n\n                // Each currency pickup is worth more on higher floors\n                const currencyValue = Math.floor(1 + currentFloor * 0.3);\n                const icon = getRandomCurrencyIcon();\n                // Note: createCurrencyPickup handles multiplayer registration internally\n                const currencyPickup = createCurrencyPickup(k, x, y, currencyValue, icon);\n            }\n\n            // Extra bonus for boss rooms - spawn a few powerup weapons\n            if (isBossRoom) {\n                const powerupKeys = Object.keys(POWERUP_WEAPONS);\n                const numPowerups = 1 + Math.floor((rewardRng ? rewardRng.next() : Math.random()) * 2); // 1-2 powerups\n\n                for (let i = 0; i < numPowerups; i++) {\n                    const angle = (rewardRng ? rewardRng.next() : Math.random()) * Math.PI * 2;\n                    const distance = 80 + (rewardRng ? rewardRng.next() : Math.random()) * 40;\n                    const x = centerX + Math.cos(angle) * distance;\n                    const y = centerY + Math.sin(angle) * distance;\n\n                    const randomPowerup = powerupKeys[Math.floor((rewardRng ? rewardRng.next() : Math.random()) * powerupKeys.length)];\n                    // Note: createPowerupWeaponPickup handles multiplayer registration internally\n                    const powerupPickup = createPowerupWeaponPickup(k, x, y, randomPowerup);\n                }\n            }\n        }\n\n        // Process pending level ups for all players sequentially\n        function processPendingLevelUps() {\n            // Build a queue of all pending level ups from all players\n            const levelUpQueue = [];\n\n            players.forEach((p) => {\n                if (!p) return; // Skip null entries\n                if (p.exists() && p.pendingLevelUps && p.pendingLevelUps.length > 0) {\n                    p.pendingLevelUps.forEach(level => {\n                        levelUpQueue.push({ player: p, level: level });\n                    });\n                    // Clear the pending level ups now that we've queued them\n                    p.pendingLevelUps = [];\n                }\n            });\n\n            // If no pending level ups, return early\n            if (levelUpQueue.length === 0) {\n                return;\n            }\n\n            // Process level ups sequentially\n            let currentIndex = 0;\n\n            function showNextLevelUp() {\n                if (currentIndex >= levelUpQueue.length) {\n                    return;\n                }\n\n                const { player: levelUpPlayer, level } = levelUpQueue[currentIndex];\n                currentIndex++;\n\n                // Determine player name for display\n                const playerName = levelUpPlayer.playerName || (levelUpPlayer.isRemote ? `Player ${levelUpPlayer.slotIndex + 1}` : 'You');\n\n                // Show tutorial hint for level up\n                showLevelUpHint(k);\n\n                // Show upgrade draft for this player (pass level for proper RNG seeding)\n                // Pass per-run rerolls remaining from gameState\n                showUpgradeDraft(k, levelUpPlayer, (selected, remainingRerolls) => {\n                    // Update gameState with remaining rerolls for per-run persistence\n                    if (remainingRerolls !== undefined) {\n                        gameState.rerollsRemaining = remainingRerolls;\n                    }\n                    // Callback when upgrade is selected - show next level up\n                    showNextLevelUp();\n                }, playerName, level, gameState.rerollsRemaining);\n            }\n\n            // Start showing level ups\n            showNextLevelUp();\n        }\n\n        // Handle room completion\n        function handleRoomCompletion() {\n            // ==========================================\n            // NEW ARCHITECTURE: Update state on room completion\n            // ==========================================\n            state.roomCleared = true;\n            state.clearRoom();\n\n            // Broadcast room completion to clients in multiplayer\n            if (isMultiplayerActive() && isHost()) {\n                broadcastRoomCompletion();\n            }\n\n            // Revive all dead players in multiplayer\n            if (partySize > 1) {\n                reviveAllPlayers();\n            }\n\n            // Note: Level ups are now manually triggered via button, not auto-shown\n            // if (partySize > 1) {\n            //     processPendingLevelUps();\n            // }\n\n            // ==========================================\n            // LEGACY STATE\n            // ==========================================\n            // Track room cleared\n            runStats.roomsCleared++;\n\n            // Check achievements with current run stats (for in-game toasts)\n            const playerLevel = player.exists() ? player.level : 1;\n            checkAchievements(k, {\n                floor: gameState.currentFloor,\n                enemiesKilled: runStats.enemiesKilled,\n                bossesKilled: runStats.bossesKilled,\n                level: playerLevel,\n                currencyEarned: 0 // Currency is calculated at game over\n            });\n\n            // Mark room as cleared in floor map\n            if (gameState.floorMap && currentRoomNode) {\n                gameState.floorMap.markRoomCleared(currentRoomNode.position.x, currentRoomNode.position.y);\n            }\n\n            // Convert spawn doors to exit doors (but keep blocked doors blocked)\n            spawnDoors.forEach(door => {\n                if (door.exists() && !door.blocked) {\n                    door.open = true;\n                    door.isSpawnDoor = false; // No longer a spawn door\n                    door.updateVisual(); // Refresh door appearance\n                }\n            });\n\n            // Special handling for boss rooms: unblock the north door for floor advancement\n            // Boss rooms have all doors blocked initially since there are no unvisited rooms\n            if (isBossRoom) {\n                const northDoor = spawnDoors.find(d => d.direction === 'north');\n                if (northDoor && northDoor.exists()) {\n                    northDoor.blocked = false;\n                    northDoor.open = true;\n                    northDoor.isSpawnDoor = false;\n                    northDoor.isFloorExit = true; // Mark as floor exit for visual distinction\n                    northDoor.updateVisual();\n                }\n            }\n\n            // Update minimap to reflect room clear\n            if (gameState.minimap) {\n                gameState.minimap.update();\n            }\n\n            // Spawn reward pickups (only host spawns in multiplayer)!\n            if (!isMultiplayerActive() || isHost()) {\n                spawnRoomClearRewards();\n            }\n\n            // Show completion message (different for boss rooms)\n            const completionText = isBossRoom \n                ? `BOSS DEFEATED! Floor ${currentFloor} Complete! Enter a door to continue`\n                : 'Room Cleared! Enter a door to continue';\n            const completionMsg = k.add([\n                k.text(completionText, { size: 20 }),\n                k.pos(k.width() / 2, k.height() - 40),\n                k.anchor('center'),\n                k.color(100, 255, 100),\n                k.fixed(),\n                k.z(500)\n            ]);\n            \n            // Remove message after 5 seconds\n            k.wait(5, () => {\n                if (completionMsg.exists()) {\n                    k.destroy(completionMsg);\n                }\n            });\n        }\n        \n        // Handle door entry\n        function handleDoorEntry(direction) {\n            // Save ALL players' stats before transitioning (critical for multiplayer)\n            gameState.allPlayerStats = players.map((p, index) => {\n                if (!p || !p.exists()) return null;\n\n                return {\n                    slotIndex: p.slotIndex !== undefined ? p.slotIndex : index, // Use player's actual slot\n                    playerName: p.playerName,\n                    isRemote: p.isRemote || false,\n                    isDead: p.isDead || false,\n                    level: p.level,\n                    xp: p.xp,\n                    xpToNext: p.xpToNext,\n                    maxHealth: p.maxHealth,\n                    currentHP: p.hp(),\n                    speed: p.slowed ? p.originalSpeed : p.speed, // Save unslowed speed\n                    originalSpeed: p.originalSpeed || p.speed,\n                    slowed: false, // Always reset slow state on room transition\n                    fireRate: p.fireRate,\n                    projectileSpeed: p.projectileSpeed,\n                    projectileDamage: p.projectileDamage,\n                    pickupRadius: p.pickupRadius,\n                    xpMultiplier: p.xpMultiplier || 1,\n                    // Character key (needed for daily runs and character-specific logic)\n                    characterKey: p.characterKey,\n                    // Character abilities\n                    dodgeChance: p.dodgeChance || 0,\n                    damageReduction: p.damageReduction || 0,\n                    fireDotMultiplier: p.fireDotMultiplier || 1,\n                    invulnerableDuration: p.invulnerableDuration || 1.0,\n                    // Advanced weapon stats\n                    projectileCount: p.projectileCount || 1,\n                    piercing: p.piercing || 0,\n                    obstaclePiercing: p.obstaclePiercing || 0,\n                    critChance: p.critChance || 0,\n                    critDamage: p.critDamage || 2.0,\n                    spreadAngle: p.spreadAngle || 0,\n                    defense: p.defense || 0,\n                    weaponRange: p.weaponRange || 600,\n                    // Upgrades (CRITICAL: preserve between rooms)\n                    weapons: p.weapons || [],\n                    passiveUpgrades: p.passiveUpgrades || [],\n                    upgradeStacks: p.upgradeStacks || {},\n                    // Synergy tracking\n                    selectedUpgrades: p.selectedUpgrades ? Array.from(p.selectedUpgrades) : [],\n                    activeSynergies: p.activeSynergies ? Array.from(p.activeSynergies) : [],\n                    piercingDamageBonus: p.piercingDamageBonus || 1.0,\n                    // Character data (needed for recalculating upgrades)\n                    characterData: p.characterData,\n                    weaponDef: p.weaponDef,\n                    baseProjectileDamage: p.baseProjectileDamage,\n                    baseFireRate: p.baseFireRate,\n                    baseProjectileSpeed: p.baseProjectileSpeed,\n                    // Pending level ups (preserve across room transitions)\n                    pendingLevelUps: p.pendingLevelUps || [],\n                    // Powerup weapon state\n                    powerupWeapon: p.powerupWeapon || null,\n                    powerupAmmo: p.powerupAmmo !== undefined ? p.powerupAmmo : null,\n                    powerupDuration: p.powerupDuration !== undefined ? p.powerupDuration : null,\n                    originalWeapon: p.originalWeapon || null,\n                    weaponKey: p.weaponKey,\n                    weaponCategory: p.weaponCategory,\n                    // Weapon-specific properties (for orbital, explosive, chain weapons)\n                    orbitRadius: p.orbitRadius,\n                    rotationSpeed: p.rotationSpeed,\n                    explosionRadius: p.explosionRadius,\n                    explosionDamage: p.explosionDamage,\n                    chainRange: p.chainRange,\n                    maxJumps: p.maxJumps,\n                    chainDamageReduction: p.chainDamageReduction,\n                    // Synergy-specific properties\n                    thornsPercent: p.thornsPercent || 0,\n                    thornsIgnoreArmor: p.thornsIgnoreArmor || false,\n                    // Per-player run stats for game over screen\n                    runStats: p.runStats || {\n                        kills: 0,\n                        deaths: 0,\n                        revives: 0,\n                        damageTaken: 0,\n                        damageDealt: 0,\n                        creditsPickedUp: 0,\n                        xpPickedUp: 0,\n                        bossesKilled: 0\n                    }\n                };\n            }).filter(stats => stats !== null);\n\n            // Also save local player stats for backward compatibility\n            const localPlayerStats = gameState.allPlayerStats.find(stats => !stats.isRemote);\n            if (localPlayerStats) {\n                gameState.playerStats = localPlayerStats;\n            }\n\n            // Calculate entry direction for next room (opposite of exit direction)\n            // If player exits north, they enter from south in next room\n            const entryDirectionMap = {\n                'north': 'south',\n                'south': 'north',\n                'west': 'east',\n                'east': 'west'\n            };\n            gameState.entryDirection = entryDirectionMap[direction] || null;\n\n            // ==========================================\n            // FLOOR MAP NAVIGATION\n            // ==========================================\n            // Map door direction to grid direction (needed for broadcast)\n            const doorToGridDirection = {\n                'north': 'up',\n                'south': 'down',\n                'east': 'right'\n            };\n            const gridDirection = doorToGridDirection[direction];\n\n            if (gameState.floorMap) {\n                // Check if we need to advance to next floor (boss defeated)\n                // This must be checked BEFORE trying to move, since boss room north door\n                // is used for floor advancement and doesn't have a floor map connection\n                const isFloorAdvancement = currentRoomNode && currentRoomNode.isBossRoom && currentRoomNode.cleared;\n\n                if (isFloorAdvancement) {\n                    // Floor advancement - going through north door after defeating boss\n                    currentFloor++;\n\n                    // Check for character unlocks based on floor completion\n                    const unlocked = checkFloorUnlocks(currentFloor - 1);\n                    if (unlocked) {\n                        // Show unlock notification (could be enhanced later)\n                        const unlockText = k.add([\n                            k.text('NEW CHARACTER UNLOCKED!', { size: 24 }),\n                            k.pos(k.width() / 2, k.height() / 2 - 50),\n                            k.anchor('center'),\n                            k.color(100, 255, 100),\n                            k.z(300)\n                        ]);\n                        k.wait(3, () => {\n                            if (unlockText.exists()) k.destroy(unlockText);\n                        });\n                    }\n\n                    // Reset floor map and room counter for new floor\n                    gameState.floorMap = null;\n                    gameState.entryDirection = null; // Start from center on new floor\n                    currentRoom = 1; // Reset room counter for new floor\n\n                    // Update new state system for floor transition\n                    state.nextFloor();\n                } else {\n                    // Normal room movement within the floor\n                    if (gridDirection) {\n                        // Try to move in the floor map\n                        const moved = gameState.floorMap.moveToRoom(gridDirection);\n                        if (!moved) {\n                            console.error('[Game] Failed to move in floor map - should not happen!');\n                            // Fallback to old room increment\n                            currentRoom++;\n                        } else {\n                            // Successfully moved\n                            currentRoom = gameState.floorMap.getVisitedCount();\n                        }\n                    } else {\n                        console.warn('[Game] Invalid door direction:', direction);\n                        currentRoom++;\n                    }\n\n                    // Update new state system for room transition\n                    state.nextRoom();\n                }\n            } else {\n                // ==========================================\n                // LEGACY ROOM PROGRESSION (fallback if no floor map)\n                // ==========================================\n                currentRoom++;\n\n                // Every 3 rooms, advance to next floor\n                if (currentRoom > 3) {\n                    currentFloor++;\n\n                    // Check for character unlocks based on floor completion\n                    const unlocked = checkFloorUnlocks(currentFloor - 1);\n                    if (unlocked) {\n                        // Show unlock notification (could be enhanced later)\n                        const unlockText = k.add([\n                            k.text('NEW CHARACTER UNLOCKED!', { size: 24 }),\n                            k.pos(k.width() / 2, k.height() / 2 - 50),\n                            k.anchor('center'),\n                            k.color(100, 255, 100),\n                            k.z(300)\n                        ]);\n                        k.wait(3, () => {\n                            if (unlockText.exists()) k.destroy(unlockText);\n                        });\n                    }\n                    currentRoom = 1;\n                    // Reset entry direction when starting new floor (player enters from center on floor start)\n                    gameState.entryDirection = null;\n\n                    // Update new state system for floor transition\n                    state.nextFloor();\n                } else {\n                    // Just advancing to next room\n                    state.nextRoom();\n                }\n            }\n\n            // ==========================================\n            // LEGACY STATE (keeping for now)\n            // ==========================================\n            // Update persistent state\n            gameState.currentFloor = currentFloor;\n            gameState.currentRoom = currentRoom;\n\n            // In multiplayer, broadcast room transition to sync spawn positions and player stats\n            if (isMultiplayerActive() && isHost()) {\n                // Preselect next room template so we can send it to clients\n                const roomRng = getRoomRNG();\n                const nextTemplate = getWeightedRoomTemplate(currentFloor, roomRng);\n                gameState.roomTemplateKey = nextTemplate.key;\n                console.log('[Multiplayer] Host selected next room template:', nextTemplate.key);\n\n                broadcastRoomTransition(gameState.entryDirection, gameState.allPlayerStats, gridDirection, currentFloor, gameState.roomTemplateKey);\n            }\n\n            // Restart game scene with new room/floor\n            k.go('game');\n        }\n        \n        // Game over on player death\n        player.onDeath(() => {\n            // Cleanup orbital weapons if they exist\n            if (player.orbitalOrbs) {\n                player.orbitalOrbs.forEach(orb => {\n                    if (orb.exists()) k.destroy(orb);\n                });\n                player.orbitalOrbs = [];\n            }\n\n            // Cleanup glow effect\n            if (player.glowEffect && player.glowEffect.exists()) {\n                k.destroy(player.glowEffect);\n                player.glowEffect = null;\n            }\n\n            // In multiplayer, don't end the game immediately - only host checks if all players are dead\n            if (partySize > 1) {\n                // Broadcast player death FIRST to prevent race conditions\n                if (isMultiplayerActive() && player.slotIndex !== undefined) {\n                    broadcastPlayerDeath(player.slotIndex);\n                }\n\n                // Then set death state locally\n                player.isDead = true;\n                player.canMove = false;\n                player.canShoot = false;\n\n                // Visual indication of death (semi-transparent)\n                player.opacity = 0.5;\n                if (player.outline && player.outline.exists()) {\n                    player.outline.opacity = 0.5;\n                }\n\n                // Only host checks if all players are dead\n                if (!isHost()) {\n                    return; // Clients don't trigger game over, wait for host event\n                }\n\n                // Check if any other players are still alive (host only)\n                const anyPlayerAlive = players.some(p =>\n                    p && p.exists() && p.hp() > 0 && !p.isDead\n                );\n\n                if (anyPlayerAlive) {\n                    return; // Don't go to game over - other players are still alive\n                }\n                // Host continues to trigger game over and broadcast to clients\n            }\n\n            // Single player or host: game over as normal\n            // Calculate currency earned\n            const currencyEarned = calculateCurrencyEarned(runStats);\n\n            // Add level and currency to run stats for achievement checking\n            const fullRunStats = {\n                ...runStats,\n                level: player.level,\n                currencyEarned: currencyEarned\n            };\n\n            // Update persistent stats and add currency\n            updateRunStats(fullRunStats);\n            addCurrency(currencyEarned);\n\n            // Record run to history\n            const runDuration = runStats.startTime ? Math.floor((Date.now() - runStats.startTime) / 1000) : 0;\n            recordRun({\n                character: player.characterData?.key || 'survivor',\n                weapon: player.weaponKey || 'pistol',\n                floorsReached: runStats.floorsReached,\n                roomsCleared: runStats.roomsCleared,\n                enemiesKilled: runStats.enemiesKilled,\n                bossesKilled: runStats.bossesKilled,\n                level: player.level || 1,\n                currencyEarned: currencyEarned,\n                duration: runDuration,\n                deathCause: 'Enemy',\n                upgrades: player.selectedUpgrades ? Array.from(player.selectedUpgrades) : [],\n                synergies: player.activeSynergies ? Array.from(player.activeSynergies) : []\n            });\n\n            // Check for achievements\n            checkAchievements(k);\n\n            // Gather party stats for game over screen\n            const partyStats = players.filter(p => p && p.exists()).map(p => ({\n                name: p.playerName || 'Player',\n                level: p.level || 1,\n                characterData: p.characterData,\n                kills: p.runStats?.kills || 0,\n                deaths: p.runStats?.deaths || 0,\n                revives: p.runStats?.revives || 0,\n                damageTaken: p.runStats?.damageTaken || 0,\n                damageDealt: p.runStats?.damageDealt || 0,\n                xpCollected: p.runStats?.xpPickedUp || 0,\n                creditsPickedUp: p.runStats?.creditsPickedUp || 0,\n                bossesKilled: p.runStats?.bossesKilled || 0\n            }));\n\n            // Broadcast game over to clients (if host in multiplayer)\n            if (isMultiplayerActive() && isHost()) {\n                broadcastGameOver(runStats, currencyEarned, partyStats);\n            }\n\n            // Cleanup multiplayer\n            if (isMultiplayerActive()) {\n                cleanupMultiplayer();\n            }\n\n            // Pass run stats to game over scene\n            k.go('gameOver', {\n                runStats: { ...runStats },\n                currencyEarned: currencyEarned,\n                partyStats: partyStats,\n                isDailyRun: gameState.isDailyRun,\n                dailyCharacter: gameState.dailyCharacter\n            });\n        });\n        \n        // Pause overlay - styled modal backdrop\n        const pauseOverlay = k.add([\n            k.rect(300, 260),\n            k.pos(k.width() / 2, k.height() / 2),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.opacity(0.95),\n            k.outline(3, k.rgb(...UI_COLORS.BORDER)),\n            k.fixed(),\n            k.z(2000),\n            'pauseOverlay'\n        ]);\n\n        // Paused title with H1 styling\n        const pauseText = k.add([\n            k.text('PAUSED', { size: UI_TEXT_SIZES.H1 * 2 }),\n            k.pos(k.width() / 2, k.height() / 2 - 95),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(2001),\n            'pauseText'\n        ]);\n\n        // Pause menu buttons using standardized sizes\n        const pauseCenterY = k.height() / 2;\n        const pauseButtonSpacing = 55;\n        const { LG, SM } = UI_SIZES.BUTTON;\n\n        // Resume button (LG size - primary CTA)\n        const resumeButton = k.add([\n            k.rect(LG.width, LG.height),\n            k.pos(k.width() / 2, pauseCenterY - 20),\n            k.anchor('center'),\n            k.color(...UI_COLORS.SUCCESS),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(2001),\n            'pauseButton'\n        ]);\n\n        const resumeText = k.add([\n            k.text('RESUME', { size: UI_TEXT_SIZES.H2 }),\n            k.pos(k.width() / 2, pauseCenterY - 20),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(2002),\n            'pauseButton'\n        ]);\n\n        // Quit to Menu button (SM size - danger action)\n        const quitButton = k.add([\n            k.rect(SM.width, SM.height),\n            k.pos(k.width() / 2, pauseCenterY + 45),\n            k.anchor('center'),\n            k.color(...UI_COLORS.DANGER),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(2001),\n            'pauseButton'\n        ]);\n\n        const quitText = k.add([\n            k.text('QUIT', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2, pauseCenterY + 45),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(2002),\n            'pauseButton'\n        ]);\n        \n        // Initially hide pause overlay\n        pauseOverlay.hidden = true;\n        pauseText.hidden = true;\n        k.get('pauseButton').forEach(btn => btn.hidden = true);\n\n        // Helper function to update pause UI (used by both local and network pause)\n        const updatePauseUI = (paused) => {\n            if (paused) {\n                playPause();\n                // Save tooltip state and hide it\n                if (k.gameData && k.gameData.saveTooltipState && k.gameData.hideTooltip) {\n                    k.gameData.tooltipSavedState = k.gameData.saveTooltipState();\n                    k.gameData.hideTooltip();\n                }\n                // Save current minimap mode and expand it\n                if (k.gameData && k.gameData.minimap) {\n                    k.gameData.minimapSavedMode = k.gameData.minimap.mode;\n                    if (k.gameData.minimap.mode !== 'maximized') {\n                        k.gameData.minimap.mode = 'maximized';\n                        k.gameData.minimap.update();\n                    }\n                }\n                // Save weapon detail state before showing it\n                if (k.gameData.weaponDetailSavedState === undefined) {\n                    k.gameData.weaponDetailSavedState = weaponDetailState;\n                }\n            } else {\n                playUnpause();\n                // Restore minimap mode\n                if (k.gameData && k.gameData.minimap && k.gameData.minimapSavedMode !== undefined) {\n                    k.gameData.minimap.mode = k.gameData.minimapSavedMode;\n                    k.gameData.minimap.update();\n                    k.gameData.minimapSavedMode = undefined;\n                }\n                // Restore tooltip state\n                if (k.gameData && k.gameData.restoreTooltipState && k.gameData.tooltipSavedState) {\n                    k.gameData.restoreTooltipState(k.gameData.tooltipSavedState);\n                    k.gameData.tooltipSavedState = undefined;\n                }\n                // Restore weapon detail state\n                if (k.gameData && k.gameData.weaponDetailSavedState !== undefined) {\n                    weaponDetailState = k.gameData.weaponDetailSavedState;\n                    weaponDetailBg.hidden = !weaponDetailState;\n                    weaponDetailIcon.hidden = !weaponDetailState;\n                    weaponDetailName.hidden = !weaponDetailState;\n                    weaponDetailDamage.hidden = !weaponDetailState;\n                    weaponDetailFireRate.hidden = !weaponDetailState;\n                    weaponDetailDPS.hidden = !weaponDetailState;\n                    k.gameData.weaponDetailSavedState = undefined;\n                }\n            }\n\n            // Update UI visibility\n            pauseOverlay.hidden = !paused;\n            pauseText.hidden = !paused;\n            k.get('pauseButton').forEach(btn => btn.hidden = !paused);\n        };\n\n        // Register pause UI update callback for network synchronization\n        k.gameData.updatePauseUI = updatePauseUI;\n        \n        // Button handlers\n        resumeButton.onClick(() => {\n            // Only allow clicking when pause menu is visible\n            if (!k.paused || resumeButton.hidden) return;\n\n            k.paused = false;\n            // Restore minimap mode\n            if (k.gameData && k.gameData.minimap && k.gameData.minimapSavedMode !== undefined) {\n                k.gameData.minimap.mode = k.gameData.minimapSavedMode;\n                k.gameData.minimap.update();\n                k.gameData.minimapSavedMode = undefined;\n            }\n            // Restore tooltip state\n            if (k.gameData && k.gameData.restoreTooltipState && k.gameData.tooltipSavedState) {\n                k.gameData.restoreTooltipState(k.gameData.tooltipSavedState);\n                k.gameData.tooltipSavedState = undefined;\n            }\n            // Restore weapon detail state\n            if (k.gameData && k.gameData.weaponDetailSavedState !== undefined) {\n                weaponDetailState = k.gameData.weaponDetailSavedState;\n                weaponDetailBg.hidden = !weaponDetailState;\n                weaponDetailIcon.hidden = !weaponDetailState;\n                weaponDetailName.hidden = !weaponDetailState;\n                weaponDetailDamage.hidden = !weaponDetailState;\n                weaponDetailFireRate.hidden = !weaponDetailState;\n                weaponDetailDPS.hidden = !weaponDetailState;\n                k.gameData.weaponDetailSavedState = undefined;\n            }\n            playUnpause();\n            pauseOverlay.hidden = true;\n            pauseText.hidden = true;\n            k.get('pauseButton').forEach(btn => btn.hidden = true);\n        });\n\n        quitButton.onClick(() => {\n            // Only allow clicking when pause menu is visible\n            if (!k.paused || quitButton.hidden) return;\n\n            // Handle multiplayer quit logic\n            if (isMultiplayerActive()) {\n                if (isHost()) {\n                    // Host: broadcast quit to all clients, then quit\n                    broadcastHostQuit();\n                    cleanupMultiplayer();\n                    gameState.currentFloor = 1;\n                    gameState.currentRoom = 1;\n                    gameState.playerStats = null;\n                    k.go('menu');\n                } else {\n                    // Client: show confirmation dialog\n                    const confirmOverlay = k.add([\n                        k.rect(k.width(), k.height()),\n                        k.pos(0, 0),\n                        k.color(0, 0, 0),\n                        k.opacity(0.8),\n                        k.fixed(),\n                        k.z(3000),\n                        'confirmDialog'\n                    ]);\n\n                    const confirmText = k.add([\n                        k.text('Leave party and return to menu?', { size: 20 }),\n                        k.pos(k.width() / 2, k.height() / 2 - 50),\n                        k.anchor('center'),\n                        k.color(255, 255, 255),\n                        k.fixed(),\n                        k.z(3001),\n                        'confirmDialog'\n                    ]);\n\n                    const yesButton = k.add([\n                        k.rect(100, 40),\n                        k.pos(k.width() / 2 - 60, k.height() / 2 + 10),\n                        k.anchor('center'),\n                        k.color(50, 150, 50),\n                        k.outline(2, k.rgb(100, 200, 100)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(3001),\n                        'confirmDialog'\n                    ]);\n\n                    k.add([\n                        k.text('Yes', { size: 16 }),\n                        k.pos(k.width() / 2 - 60, k.height() / 2 + 10),\n                        k.anchor('center'),\n                        k.color(255, 255, 255),\n                        k.fixed(),\n                        k.z(3002),\n                        'confirmDialog'\n                    ]);\n\n                    const noButton = k.add([\n                        k.rect(100, 40),\n                        k.pos(k.width() / 2 + 60, k.height() / 2 + 10),\n                        k.anchor('center'),\n                        k.color(150, 50, 50),\n                        k.outline(2, k.rgb(200, 100, 100)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(3001),\n                        'confirmDialog'\n                    ]);\n\n                    k.add([\n                        k.text('No', { size: 16 }),\n                        k.pos(k.width() / 2 + 60, k.height() / 2 + 10),\n                        k.anchor('center'),\n                        k.color(255, 255, 255),\n                        k.fixed(),\n                        k.z(3002),\n                        'confirmDialog'\n                    ]);\n\n                    // Keyboard handler cleanup list\n                    const dialogKeyHandlers = [];\n\n                    const confirmYes = () => {\n                        dialogKeyHandlers.forEach(h => h.cancel());\n                        k.get('confirmDialog').forEach(e => k.destroy(e));\n                        cleanupMultiplayer();\n                        gameState.currentFloor = 1;\n                        gameState.currentRoom = 1;\n                        gameState.playerStats = null;\n                        k.go('menu');\n                    };\n\n                    const confirmNo = () => {\n                        dialogKeyHandlers.forEach(h => h.cancel());\n                        k.get('confirmDialog').forEach(e => k.destroy(e));\n                    };\n\n                    yesButton.onClick(confirmYes);\n                    noButton.onClick(confirmNo);\n\n                    // Keyboard support: Y/Enter to confirm, N/Escape to cancel\n                    dialogKeyHandlers.push(k.onKeyPress('y', confirmYes));\n                    dialogKeyHandlers.push(k.onKeyPress('enter', confirmYes));\n                    dialogKeyHandlers.push(k.onKeyPress('n', confirmNo));\n                    dialogKeyHandlers.push(k.onKeyPress('escape', confirmNo));\n                }\n            } else {\n                // Single player: check if confirmation is required\n                const confirmBeforeQuit = getSetting('gameplay', 'confirmBeforeQuit') !== false;\n\n                if (confirmBeforeQuit) {\n                    // Show confirmation dialog\n                    const confirmOverlay = k.add([\n                        k.rect(k.width(), k.height()),\n                        k.pos(0, 0),\n                        k.color(0, 0, 0),\n                        k.opacity(0.8),\n                        k.fixed(),\n                        k.z(3000),\n                        'confirmDialog'\n                    ]);\n\n                    const confirmText = k.add([\n                        k.text('Abandon run and return to menu?', { size: 20 }),\n                        k.pos(k.width() / 2, k.height() / 2 - 50),\n                        k.anchor('center'),\n                        k.color(255, 255, 255),\n                        k.fixed(),\n                        k.z(3001),\n                        'confirmDialog'\n                    ]);\n\n                    const yesButton = k.add([\n                        k.rect(100, 40),\n                        k.pos(k.width() / 2 - 60, k.height() / 2 + 10),\n                        k.anchor('center'),\n                        k.color(150, 50, 50),\n                        k.outline(2, k.rgb(200, 100, 100)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(3001),\n                        'confirmDialog'\n                    ]);\n\n                    k.add([\n                        k.text('Yes', { size: 16 }),\n                        k.pos(k.width() / 2 - 60, k.height() / 2 + 10),\n                        k.anchor('center'),\n                        k.color(255, 255, 255),\n                        k.fixed(),\n                        k.z(3002),\n                        'confirmDialog'\n                    ]);\n\n                    const noButton = k.add([\n                        k.rect(100, 40),\n                        k.pos(k.width() / 2 + 60, k.height() / 2 + 10),\n                        k.anchor('center'),\n                        k.color(50, 100, 50),\n                        k.outline(2, k.rgb(100, 150, 100)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(3001),\n                        'confirmDialog'\n                    ]);\n\n                    k.add([\n                        k.text('No', { size: 16 }),\n                        k.pos(k.width() / 2 + 60, k.height() / 2 + 10),\n                        k.anchor('center'),\n                        k.color(255, 255, 255),\n                        k.fixed(),\n                        k.z(3002),\n                        'confirmDialog'\n                    ]);\n\n                    // Keyboard handler cleanup list\n                    const dialogKeyHandlers = [];\n\n                    const confirmYes = () => {\n                        dialogKeyHandlers.forEach(h => h.cancel());\n                        k.get('confirmDialog').forEach(e => k.destroy(e));\n                        gameState.currentFloor = 1;\n                        gameState.currentRoom = 1;\n                        gameState.playerStats = null;\n                        k.go('menu');\n                    };\n\n                    const confirmNo = () => {\n                        dialogKeyHandlers.forEach(h => h.cancel());\n                        k.get('confirmDialog').forEach(e => k.destroy(e));\n                    };\n\n                    yesButton.onClick(confirmYes);\n                    noButton.onClick(confirmNo);\n\n                    // Keyboard support: Y/Enter to confirm, N/Escape to cancel\n                    dialogKeyHandlers.push(k.onKeyPress('y', confirmYes));\n                    dialogKeyHandlers.push(k.onKeyPress('enter', confirmYes));\n                    dialogKeyHandlers.push(k.onKeyPress('n', confirmNo));\n                    dialogKeyHandlers.push(k.onKeyPress('escape', confirmNo));\n                } else {\n                    // No confirmation required, just quit\n                    gameState.currentFloor = 1;\n                    gameState.currentRoom = 1;\n                    gameState.playerStats = null;\n                    k.go('menu');\n                }\n            }\n        });\n        \n        // Toggle minimap with 'M' key\n        eventHandlers.keyPresses.push(k.onKeyPress('m', () => {\n            if (gameState.minimap && !k.paused) {\n                gameState.minimap.toggle();\n            }\n        }));\n\n        // Pause\n        eventHandlers.keyPresses.push(k.onKeyPress('escape', () => {\n            // Don't allow pause menu if upgrade draft is showing\n            if (isUpgradeDraftActive()) {\n                return; // Prevent escape key from interfering with upgrade selection\n            }\n\n            // In multiplayer, only host changes pause state locally\n            // Clients send request and wait for host response\n            if (isMultiplayerActive()) {\n                if (isHost()) {\n                    // Host: change pause state and broadcast to all clients\n                    k.paused = !k.paused;\n                    broadcastPauseState(k.paused);\n                    updatePauseUI(k.paused);\n                } else {\n                    // Client: send pause request to host (don't change local state yet)\n                    // The pause_state message from host will update our state\n                    sendPauseRequest(!k.paused);\n                }\n            } else {\n                // Single-player: change pause state directly\n                k.paused = !k.paused;\n                updatePauseUI(k.paused);\n            }\n        }));\n\n        // Auto-pause on window blur (solo mode only)\n        const handleGameBlur = () => {\n            // Only auto-pause in solo mode\n            if (isMultiplayerActive()) return;\n            // Don't pause if already paused or upgrade draft is showing\n            if (k.paused || isUpgradeDraftActive()) return;\n\n            k.paused = true;\n            updatePauseUI(true);\n        };\n        window.addEventListener('blur', handleGameBlur);\n\n        // Clean up blur listener on scene leave\n        k.onSceneLeave(() => {\n            window.removeEventListener('blur', handleGameBlur);\n        });\n\n        // Cleanup event handlers on scene leave (memory leak fix)\n        k.onSceneLeave(() => {\n            // Cancel all update handlers with error protection\n            eventHandlers.updates.forEach(handler => {\n                try {\n                    if (handler && handler.cancel) handler.cancel();\n                } catch (err) {\n                    console.warn('[Game] Error canceling update handler:', err);\n                }\n            });\n\n            // Cancel all keypress handlers with error protection\n            eventHandlers.keyPresses.forEach(handler => {\n                try {\n                    if (handler && handler.cancel) handler.cancel();\n                } catch (err) {\n                    console.warn('[Game] Error canceling keypress handler:', err);\n                }\n            });\n\n            // Unregister network message handlers (if client)\n            if (!isHost() && isMultiplayerActive()) {\n                try {\n                    offMessage('room_transition');\n                    offMessage('room_completed');\n                    offMessage('game_over');\n                } catch (err) {\n                    console.warn('[Game] Error unregistering message handlers:', err);\n                }\n                // Reset the flag to allow re-registration\n                gameSceneMessageHandlersRegistered = false;\n            }\n\n            // Destroy minimap on scene leave to prevent lingering elements\n            if (gameState.minimap) {\n                gameState.minimap.destroy();\n                gameState.minimap = null;\n            }\n\n            // Clear object pools on scene leave\n            clearAllPools();\n        });\n    });\n}\n\n","// Portrait definitions and unlock conditions\n// Portraits are cosmetic profile images unlocked through gameplay\n\n/**\n * Portrait categories for organization\n */\nexport const PORTRAIT_CATEGORIES = {\n    LEVEL: 'level',      // Unlocked by reaching player levels\n    CHARACTER: 'character', // Unlocked by unlocking characters\n    ACHIEVEMENT: 'achievement', // Unlocked by achievements\n    SPECIAL: 'special'   // Unlocked by special conditions\n};\n\n/**\n * Portrait definitions\n * Each portrait has:\n * - id: Unique identifier\n * - name: Display name\n * - icon: ASCII character or emoji to display\n * - category: Category for organization\n * - unlockCondition: How to unlock this portrait\n * - description: Flavor text\n */\nexport const PORTRAITS = {\n    // ============ DEFAULT ============\n    default: {\n        id: 'default',\n        name: 'Rookie',\n        icon: '',\n        color: [200, 200, 200],\n        category: PORTRAIT_CATEGORIES.LEVEL,\n        unlockCondition: { type: 'default' },\n        description: 'Everyone starts somewhere.'\n    },\n\n    // ============ LEVEL-BASED ============\n    veteran: {\n        id: 'veteran',\n        name: 'Veteran',\n        icon: '',\n        color: [100, 200, 255],\n        category: PORTRAIT_CATEGORIES.LEVEL,\n        unlockCondition: { type: 'level', value: 10 },\n        description: 'A seasoned competitor with many battles under their belt.'\n    },\n    elite: {\n        id: 'elite',\n        name: 'Elite',\n        icon: '',\n        color: [255, 200, 100],\n        category: PORTRAIT_CATEGORIES.LEVEL,\n        unlockCondition: { type: 'level', value: 25 },\n        description: 'Among the top performers in the arena.'\n    },\n    legend: {\n        id: 'legend',\n        name: 'Legend',\n        icon: '',\n        color: [255, 100, 255],\n        category: PORTRAIT_CATEGORIES.LEVEL,\n        unlockCondition: { type: 'level', value: 50 },\n        description: 'A living legend whose name echoes through the halls.'\n    },\n    champion: {\n        id: 'champion',\n        name: 'Champion',\n        icon: '',\n        color: [255, 215, 0],\n        category: PORTRAIT_CATEGORIES.LEVEL,\n        unlockCondition: { type: 'level', value: 75 },\n        description: 'A true champion who has conquered all challenges.'\n    },\n    immortal: {\n        id: 'immortal',\n        name: 'Immortal',\n        icon: '',\n        color: [200, 255, 255],\n        category: PORTRAIT_CATEGORIES.LEVEL,\n        unlockCondition: { type: 'level', value: 100 },\n        description: 'Transcended mortality. A god among players.'\n    },\n\n    // ============ CHARACTER-BASED ============\n    survivor: {\n        id: 'survivor',\n        name: 'Survivor',\n        icon: '',\n        color: [100, 200, 100],\n        category: PORTRAIT_CATEGORIES.CHARACTER,\n        unlockCondition: { type: 'character', value: 'survivor' },\n        description: 'The default hero. Never gives up.'\n    },\n    berserker: {\n        id: 'berserker',\n        name: 'Berserker',\n        icon: '',\n        color: [255, 100, 100],\n        category: PORTRAIT_CATEGORIES.CHARACTER,\n        unlockCondition: { type: 'character', value: 'berserker' },\n        description: 'Rage incarnate. Pain is just fuel.'\n    },\n    ranger: {\n        id: 'ranger',\n        name: 'Ranger',\n        icon: '',\n        color: [100, 255, 150],\n        category: PORTRAIT_CATEGORIES.CHARACTER,\n        unlockCondition: { type: 'character', value: 'ranger' },\n        description: 'Swift and precise. Death from a distance.'\n    },\n    mage: {\n        id: 'mage',\n        name: 'Mage',\n        icon: '',\n        color: [200, 100, 255],\n        category: PORTRAIT_CATEGORIES.CHARACTER,\n        unlockCondition: { type: 'character', value: 'mage' },\n        description: 'Master of the arcane arts.'\n    },\n    tank: {\n        id: 'tank',\n        name: 'Tank',\n        icon: '',\n        color: [150, 150, 200],\n        category: PORTRAIT_CATEGORIES.CHARACTER,\n        unlockCondition: { type: 'character', value: 'tank' },\n        description: 'An immovable wall. Nothing gets through.'\n    },\n    assassin: {\n        id: 'assassin',\n        name: 'Assassin',\n        icon: '',\n        color: [150, 100, 150],\n        category: PORTRAIT_CATEGORIES.CHARACTER,\n        unlockCondition: { type: 'character', value: 'assassin' },\n        description: 'Silent. Deadly. Gone before you know it.'\n    },\n\n    // ============ ACHIEVEMENT-BASED ============\n    boss_slayer: {\n        id: 'boss_slayer',\n        name: 'Boss Slayer',\n        icon: '',\n        color: [255, 180, 50],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'totalBossesKilled', value: 100 },\n        description: 'Has ended the reign of 100 bosses.'\n    },\n    speedrunner: {\n        id: 'speedrunner',\n        name: 'Speedrunner',\n        icon: '',\n        color: [255, 255, 100],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'fastestRunTime', value: 600, comparison: 'lessThan' },\n        description: 'Completed a run in under 10 minutes.'\n    },\n    perfectionist: {\n        id: 'perfectionist',\n        name: 'Perfectionist',\n        icon: '',\n        color: [255, 255, 255],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'achievement', value: 'flawless_run' },\n        description: 'Completed a run without taking damage.'\n    },\n    grinder: {\n        id: 'grinder',\n        name: 'Grinder',\n        icon: '',\n        color: [200, 150, 100],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'totalRuns', value: 100 },\n        description: 'Has completed 100 runs. Dedication personified.'\n    },\n    collector: {\n        id: 'collector',\n        name: 'Collector',\n        icon: '',\n        color: [255, 215, 0],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'totalCurrencyEarned', value: 10000 },\n        description: 'Has earned 10,000 credits total.'\n    },\n    exterminator: {\n        id: 'exterminator',\n        name: 'Exterminator',\n        icon: '',\n        color: [200, 50, 50],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'totalEnemiesKilled', value: 10000 },\n        description: 'Has eliminated 10,000 enemies.'\n    },\n    explorer: {\n        id: 'explorer',\n        name: 'Explorer',\n        icon: '',\n        color: [100, 180, 100],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'bestFloor', value: 5 },\n        description: 'Reached floor 5. The journey begins.'\n    },\n    delver: {\n        id: 'delver',\n        name: 'Delver',\n        icon: '',\n        color: [180, 140, 100],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'bestFloor', value: 10 },\n        description: 'Reached floor 10. Deep into the unknown.'\n    },\n    abyssal: {\n        id: 'abyssal',\n        name: 'Abyssal',\n        icon: '',\n        color: [80, 50, 150],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'bestFloor', value: 20 },\n        description: 'Reached floor 20. Touched the abyss.'\n    },\n    slayer: {\n        id: 'slayer',\n        name: 'Slayer',\n        icon: '',\n        color: [200, 80, 80],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'totalBossesKilled', value: 25 },\n        description: 'Has slain 25 bosses.'\n    },\n    warrior: {\n        id: 'warrior',\n        name: 'Warrior',\n        icon: '',\n        color: [150, 150, 200],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'totalEnemiesKilled', value: 1000 },\n        description: 'Has defeated 1,000 enemies.'\n    },\n    rich: {\n        id: 'rich',\n        name: 'Wealthy',\n        icon: '',\n        color: [100, 200, 255],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'totalCurrencyEarned', value: 50000 },\n        description: 'Has earned 50,000 credits. Living large.'\n    },\n    dedicated: {\n        id: 'dedicated',\n        name: 'Dedicated',\n        icon: '',\n        color: [150, 100, 200],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'totalRuns', value: 50 },\n        description: 'Has completed 50 runs. Committed to the grind.'\n    },\n    marathoner: {\n        id: 'marathoner',\n        name: 'Marathoner',\n        icon: '',\n        color: [100, 200, 150],\n        category: PORTRAIT_CATEGORIES.ACHIEVEMENT,\n        unlockCondition: { type: 'stat', stat: 'totalRoomsCleared', value: 500 },\n        description: 'Has cleared 500 rooms. Endurance personified.'\n    }\n};\n\n/**\n * Get portrait by ID\n * @param {string} id - Portrait ID\n * @returns {Object|null} Portrait data or null\n */\nexport function getPortraitById(id) {\n    return PORTRAITS[id] || null;\n}\n\n/**\n * Get all portraits\n * @returns {Array} Array of all portrait objects\n */\nexport function getAllPortraits() {\n    return Object.values(PORTRAITS);\n}\n\n/**\n * Get portraits by category\n * @param {string} category - Category to filter by\n * @returns {Array} Array of portrait objects in that category\n */\nexport function getPortraitsByCategory(category) {\n    return Object.values(PORTRAITS).filter(p => p.category === category);\n}\n\n/**\n * Check if a portrait's unlock condition is met\n * @param {string} portraitId - Portrait ID\n * @param {Object} saveData - Player save data\n * @returns {boolean} True if unlocked\n */\nexport function checkPortraitUnlockCondition(portraitId, saveData) {\n    const portrait = PORTRAITS[portraitId];\n    if (!portrait) return false;\n\n    const condition = portrait.unlockCondition;\n\n    switch (condition.type) {\n        case 'default':\n            return true;\n\n        case 'level':\n            // Calculate level from XP\n            const level = Math.floor(Math.sqrt((saveData.totalXP || 0) / 100)) + 1;\n            return level >= condition.value;\n\n        case 'character':\n            return saveData.unlocks?.characters?.includes(condition.value) || false;\n\n        case 'achievement':\n            return saveData.achievements?.includes(condition.value) || false;\n\n        case 'stat':\n            const statValue = saveData.stats?.[condition.stat] || 0;\n            if (condition.comparison === 'lessThan') {\n                // For speedrunner: needs to have a valid time AND be under the threshold\n                return statValue > 0 && statValue < condition.value;\n            }\n            return statValue >= condition.value;\n\n        default:\n            return false;\n    }\n}\n\n/**\n * Get unlock progress for a portrait\n * @param {string} portraitId - Portrait ID\n * @param {Object} saveData - Player save data\n * @returns {Object} Progress info with current, required, and percentage\n */\nexport function getPortraitUnlockProgress(portraitId, saveData) {\n    const portrait = PORTRAITS[portraitId];\n    if (!portrait) return { current: 0, required: 1, percentage: 0 };\n\n    const condition = portrait.unlockCondition;\n\n    switch (condition.type) {\n        case 'default':\n            return { current: 1, required: 1, percentage: 1 };\n\n        case 'level':\n            const level = Math.floor(Math.sqrt((saveData.totalXP || 0) / 100)) + 1;\n            return {\n                current: level,\n                required: condition.value,\n                percentage: Math.min(1, level / condition.value)\n            };\n\n        case 'character':\n            const hasChar = saveData.unlocks?.characters?.includes(condition.value) || false;\n            return {\n                current: hasChar ? 1 : 0,\n                required: 1,\n                percentage: hasChar ? 1 : 0\n            };\n\n        case 'achievement':\n            const hasAch = saveData.achievements?.includes(condition.value) || false;\n            return {\n                current: hasAch ? 1 : 0,\n                required: 1,\n                percentage: hasAch ? 1 : 0\n            };\n\n        case 'stat':\n            const statValue = saveData.stats?.[condition.stat] || 0;\n            if (condition.comparison === 'lessThan') {\n                // Can't really show progress for \"less than\" conditions\n                return {\n                    current: statValue || 'N/A',\n                    required: `< ${condition.value}`,\n                    percentage: statValue > 0 && statValue < condition.value ? 1 : 0\n                };\n            }\n            return {\n                current: statValue,\n                required: condition.value,\n                percentage: Math.min(1, statValue / condition.value)\n            };\n\n        default:\n            return { current: 0, required: 1, percentage: 0 };\n    }\n}\n\n/**\n * Get description of unlock condition\n * @param {string} portraitId - Portrait ID\n * @returns {string} Human-readable unlock condition\n */\nexport function getPortraitUnlockDescription(portraitId) {\n    const portrait = PORTRAITS[portraitId];\n    if (!portrait) return 'Unknown';\n\n    const condition = portrait.unlockCondition;\n\n    switch (condition.type) {\n        case 'default':\n            return 'Unlocked by default';\n        case 'level':\n            return `Reach Level ${condition.value}`;\n        case 'character':\n            return `Unlock the ${condition.value.charAt(0).toUpperCase() + condition.value.slice(1)} character`;\n        case 'achievement':\n            return `Complete the \"${condition.value}\" achievement`;\n        case 'stat':\n            const statNames = {\n                totalBossesKilled: 'bosses killed',\n                totalRuns: 'runs completed',\n                totalCurrencyEarned: 'credits earned',\n                totalEnemiesKilled: 'enemies killed',\n                fastestRunTime: 'second run'\n            };\n            const statName = statNames[condition.stat] || condition.stat;\n            if (condition.comparison === 'lessThan') {\n                return `Complete a run in under ${Math.floor(condition.value / 60)} minutes`;\n            }\n            return `${condition.value.toLocaleString()} ${statName}`;\n        default:\n            return 'Unknown condition';\n    }\n}\n","/**\n * Daily Runs System\n *\n * Provides daily seeded challenges where:\n * - Same date = same seed = same character + room layout\n * - Character is locked (can't change)\n * - Score saves to daily leaderboard\n * - One attempt per day (can view leaderboard after completion)\n */\n\nimport { SeededRandom, seedFromString } from '../utils/seededRandom.js';\n\n// Storage key for daily run data\nconst DAILY_RUN_STORAGE_KEY = 'superSmashTextyDailyRuns';\n\n// Available characters for daily runs (includes ALL characters, even locked ones)\nconst DAILY_CHARACTERS = ['survivor', 'scout', 'tank', 'sniper', 'pyro', 'bomber', 'engineer', 'vampire', 'berserker', 'ghost'];\n\n/**\n * Get today's date string in ISO format (YYYY-MM-DD)\n * @returns {string} - Today's date\n */\nexport function getTodayDateString() {\n    return new Date().toISOString().split('T')[0];\n}\n\n/**\n * Get the seed for a specific date's daily run\n * @param {string} date - Date string (YYYY-MM-DD), defaults to today\n * @returns {number} - Deterministic seed for the date\n */\nexport function getDailySeed(date = null) {\n    const dateStr = date || getTodayDateString();\n    return seedFromString(dateStr + 'SuperSmashTexty');\n}\n\n/**\n * Get today's daily seed\n * @returns {number} - Today's daily seed\n */\nexport function getTodayDailySeed() {\n    return getDailySeed(getTodayDateString());\n}\n\n/**\n * Get the character for a specific date's daily run\n * @param {string} date - Date string (YYYY-MM-DD), defaults to today\n * @returns {string} - Character key for the daily run\n */\nexport function getDailyCharacter(date = null) {\n    const seed = getDailySeed(date);\n    const rng = new SeededRandom(seed);\n    return rng.choose(DAILY_CHARACTERS);\n}\n\n/**\n * Get today's daily character\n * @returns {string} - Today's daily character\n */\nexport function getTodayDailyCharacter() {\n    return getDailyCharacter(getTodayDateString());\n}\n\n/**\n * Get stored daily run data\n * @returns {Object} - Daily run data\n */\nfunction getDailyRunData() {\n    try {\n        const data = localStorage.getItem(DAILY_RUN_STORAGE_KEY);\n        return data ? JSON.parse(data) : { completedDays: {}, attempts: {} };\n    } catch (e) {\n        console.warn('[DailyRuns] Failed to parse daily run data:', e);\n        return { completedDays: {}, attempts: {} };\n    }\n}\n\n/**\n * Save daily run data\n * @param {Object} data - Data to save\n */\nfunction saveDailyRunData(data) {\n    try {\n        localStorage.setItem(DAILY_RUN_STORAGE_KEY, JSON.stringify(data));\n    } catch (e) {\n        console.warn('[DailyRuns] Failed to save daily run data:', e);\n    }\n}\n\n/**\n * Check if today's daily run has been completed\n * @returns {boolean} - True if already completed today\n */\nexport function hasCompletedDailyToday() {\n    const data = getDailyRunData();\n    const today = getTodayDateString();\n    return !!data.completedDays[today];\n}\n\n/**\n * Check if a specific date's daily run has been completed\n * @param {string} date - Date string (YYYY-MM-DD)\n * @returns {boolean} - True if completed\n */\nexport function hasCompletedDaily(date) {\n    const data = getDailyRunData();\n    return !!data.completedDays[date];\n}\n\n/**\n * Get completion data for a specific date\n * @param {string} date - Date string (YYYY-MM-DD)\n * @returns {Object|null} - Completion data or null\n */\nexport function getDailyCompletion(date) {\n    const data = getDailyRunData();\n    return data.completedDays[date] || null;\n}\n\n/**\n * Get today's completion data\n * @returns {Object|null} - Completion data or null\n */\nexport function getTodayCompletion() {\n    return getDailyCompletion(getTodayDateString());\n}\n\n/**\n * Mark a daily run as completed\n * @param {Object} runStats - Stats from the completed run\n * @param {number} runStats.score - Final score\n * @param {number} runStats.floor - Floor reached\n * @param {string} runStats.character - Character used\n * @param {number} runStats.duration - Run duration in seconds\n * @returns {Object} - Completion result with rank\n */\nexport function markDailyCompleted(runStats) {\n    const data = getDailyRunData();\n    const today = getTodayDateString();\n\n    // Store completion data\n    const completion = {\n        date: today,\n        score: runStats.score || 0,\n        floor: runStats.floor || 1,\n        character: runStats.character || getTodayDailyCharacter(),\n        duration: runStats.duration || 0,\n        completedAt: Date.now()\n    };\n\n    data.completedDays[today] = completion;\n    saveDailyRunData(data);\n\n    console.log('[DailyRuns] Marked daily completed:', completion);\n\n    return completion;\n}\n\n/**\n * Get attempt count for today\n * @returns {number} - Number of attempts today\n */\nexport function getTodayAttemptCount() {\n    const data = getDailyRunData();\n    const today = getTodayDateString();\n    return data.attempts[today] || 0;\n}\n\n/**\n * Increment attempt count for today\n */\nexport function incrementAttemptCount() {\n    const data = getDailyRunData();\n    const today = getTodayDateString();\n    data.attempts[today] = (data.attempts[today] || 0) + 1;\n    saveDailyRunData(data);\n}\n\n/**\n * Get daily run info for display\n * @returns {Object} - Daily run info\n */\nexport function getDailyRunInfo() {\n    const today = getTodayDateString();\n    const seed = getDailySeed(today);\n    const character = getDailyCharacter(today);\n    const completed = hasCompletedDailyToday();\n    const completion = getTodayCompletion();\n    const attempts = getTodayAttemptCount();\n\n    return {\n        date: today,\n        seed: seed,\n        character: character,\n        completed: completed,\n        completion: completion,\n        attempts: attempts\n    };\n}\n\n/**\n * Create a seeded RNG for the daily run\n * @param {string} date - Date string, defaults to today\n * @returns {SeededRandom} - Seeded RNG instance\n */\nexport function createDailyRNG(date = null) {\n    const seed = getDailySeed(date);\n    return new SeededRandom(seed);\n}\n\n/**\n * Get historical daily runs (last N days)\n * @param {number} days - Number of days to look back\n * @returns {Array} - Array of daily run completions\n */\nexport function getDailyHistory(days = 7) {\n    const data = getDailyRunData();\n    const history = [];\n    const today = new Date();\n\n    for (let i = 0; i < days; i++) {\n        const date = new Date(today);\n        date.setDate(date.getDate() - i);\n        const dateStr = date.toISOString().split('T')[0];\n\n        if (data.completedDays[dateStr]) {\n            history.push({\n                date: dateStr,\n                ...data.completedDays[dateStr]\n            });\n        }\n    }\n\n    return history;\n}\n\n/**\n * Clean up old daily run data (keep last 30 days)\n */\nexport function cleanupOldDailyData() {\n    const data = getDailyRunData();\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - 30);\n    const cutoffStr = cutoffDate.toISOString().split('T')[0];\n\n    let cleaned = false;\n\n    // Clean old completions\n    for (const date of Object.keys(data.completedDays)) {\n        if (date < cutoffStr) {\n            delete data.completedDays[date];\n            cleaned = true;\n        }\n    }\n\n    // Clean old attempts\n    for (const date of Object.keys(data.attempts)) {\n        if (date < cutoffStr) {\n            delete data.attempts[date];\n            cleaned = true;\n        }\n    }\n\n    if (cleaned) {\n        saveDailyRunData(data);\n        console.log('[DailyRuns] Cleaned up old daily run data');\n    }\n}\n","// Main menu scene\nimport { getCurrency, getCurrencyName, getPlayerName, getSelectedCharacter, isUnlocked, addCurrency, getPlayerLevel, getXPProgress, getTotalXP, getXPForNextLevel, getSelectedPortrait } from '../systems/metaProgression.js';\nimport { PORTRAITS, getPortraitById } from '../data/portraits.js';\nimport { initParty, getPartyDisplayInfo, isMultiplayerAvailable, broadcastGameStart, getPartySize, getDisplayInviteCode, getParty, toggleReady, isLocalPlayerReady, getCountdownState, areAllPlayersReady, broadcastPartyEmote, onPartyEmote, offPartyEmote, getActiveEmote, requestPlayerProfile } from '../systems/partySystem.js';\nimport { startMatchmaking, stopMatchmaking, isMatchmaking, isFirebaseConfigured, setupGlobalMatchHandler } from '../systems/matchmakingSystem.js';\nimport { initAudio, resumeAudioContext, playMenuSelect, playMenuNav, playMenuMusic, setMusicVolume, setMasterVolume, setSfxVolume, setUiSoundsEnabled, setCombatSoundsEnabled } from '../systems/sounds.js';\nimport { getSettings } from '../systems/settings.js';\nimport { CHARACTER_UNLOCKS } from '../data/unlocks.js';\nimport { getDailyRunInfo, hasCompletedDailyToday, getTodayDailyCharacter } from '../systems/dailyRuns.js';\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_SPACING,\n    UI_BUTTON,\n    UI_Z_LAYERS,\n    formatButtonText,\n    createCreditIndicator\n} from '../config/uiConfig.js';\n\n// Layout constants for three-column grid\nconst LAYOUT = {\n    LEFT_COLUMN_X: 20,\n    LEFT_COLUMN_WIDTH: 200,\n    RIGHT_COLUMN_WIDTH: 200,\n    PANEL_PADDING: 10,\n    TOP_MARGIN: 20\n};\n\n/**\n * Create an interactive menu button\n */\nfunction createMenuButton(k, text, x, y, width = UI_BUTTON.WIDTH, height = UI_BUTTON.HEIGHT, fontSize = UI_TEXT_SIZES.BUTTON) {\n    const primaryColor = UI_COLORS.SECONDARY;\n    const hoverColor = UI_COLORS.SECONDARY_HOVER;\n    const textColor = UI_COLORS.TEXT_PRIMARY;\n    const borderColor = UI_COLORS.BORDER;\n\n    const bg = k.add([\n        k.rect(width, height),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...primaryColor),\n        k.outline(2, k.rgb(...borderColor)),\n        k.area(),\n        k.fixed(),\n        k.scale(1),\n        k.z(UI_Z_LAYERS.UI_ELEMENTS),\n        'menuButton'\n    ]);\n\n    const formattedText = formatButtonText(text);\n    const label = k.add([\n        k.text(formattedText, { size: fontSize }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...textColor),\n        k.fixed(),\n        k.scale(1),\n        k.z(UI_Z_LAYERS.UI_TEXT),\n        'menuButtonText'\n    ]);\n\n    bg.originalColor = [...primaryColor];\n    bg.hoverColor = [...hoverColor];\n    bg.borderColor = [...borderColor];\n    bg.isHovered = false;\n    bg.disabled = false;\n    bg.label = label;\n    bg.labels = [label];\n\n    bg.onHoverUpdate(() => {\n        if (bg.disabled) return;\n        if (!bg.isHovered) {\n            bg.isHovered = true;\n            playMenuNav();\n        }\n        bg.color = k.rgb(...bg.hoverColor);\n        bg.outline.color = k.rgb(...UI_COLORS.BORDER_HOVER);\n        bg.scale = k.vec2(UI_BUTTON.HOVER_SCALE, UI_BUTTON.HOVER_SCALE);\n        label.scale = k.vec2(UI_BUTTON.HOVER_SCALE, UI_BUTTON.HOVER_SCALE);\n    });\n\n    bg.onHoverEnd(() => {\n        if (bg.disabled) return;\n        bg.isHovered = false;\n        bg.color = k.rgb(...bg.originalColor);\n        bg.outline.color = k.rgb(...bg.borderColor);\n        bg.scale = k.vec2(1, 1);\n        label.scale = k.vec2(1, 1);\n    });\n\n    bg.setDisabled = (isDisabled) => {\n        bg.disabled = isDisabled;\n        if (isDisabled) {\n            bg.color = k.rgb(...UI_COLORS.BG_DISABLED);\n            label.color = k.rgb(...UI_COLORS.TEXT_DISABLED);\n        } else {\n            bg.color = k.rgb(...bg.originalColor);\n            label.color = k.rgb(...textColor);\n        }\n    };\n\n    return bg;\n}\n\n// Helper function to convert HSL to RGB\nfunction hslToRgb(h, s, l) {\n    s /= 100;\n    l /= 100;\n    const c = (1 - Math.abs(2 * l - 1)) * s;\n    const x = c * (1 - Math.abs((h / 60) % 2 - 1));\n    const m = l - c / 2;\n    let r = 0, g = 0, b = 0;\n    if (h >= 0 && h < 60) { r = c; g = x; b = 0; }\n    else if (h >= 60 && h < 120) { r = x; g = c; b = 0; }\n    else if (h >= 120 && h < 180) { r = 0; g = c; b = x; }\n    else if (h >= 180 && h < 240) { r = 0; g = x; b = c; }\n    else if (h >= 240 && h < 300) { r = x; g = 0; b = c; }\n    else if (h >= 300 && h < 360) { r = c; g = 0; b = x; }\n    return [\n        Math.round((r + m) * 255),\n        Math.round((g + m) * 255),\n        Math.round((b + m) * 255)\n    ];\n}\n\n// Get contrasting text color for a given hue (dark version of same hue)\nfunction getContrastingTextColor(hue) {\n    // Use same hue but much darker (lightness 15%) and high saturation\n    return hslToRgb(hue, 80, 15);\n}\n\nexport function setupMenuScene(k) {\n    k.scene('menu', () => {\n        initAudio();\n\n        // Apply saved audio settings\n        const settings = getSettings();\n        setMasterVolume(settings.audio.masterVolume);\n        setMusicVolume(settings.audio.musicVolume);\n        setSfxVolume(settings.audio.sfxVolume);\n\n        // Apply UI/Combat sound toggles if they exist in settings\n        if (settings.audio.uiSounds !== undefined) {\n            setUiSoundsEnabled(settings.audio.uiSounds);\n        }\n        if (settings.audio.combatSounds !== undefined) {\n            setCombatSoundsEnabled(settings.audio.combatSounds);\n        }\n\n        // Resume audio context on first user interaction (browser autoplay policy)\n        let audioResumed = false;\n        const resumeAudio = () => {\n            if (!audioResumed) {\n                audioResumed = true;\n                resumeAudioContext();\n                // Try playing music again after context resumes\n                playMenuMusic();\n            }\n        };\n        k.onClick(resumeAudio);\n        k.onKeyPress(resumeAudio);\n\n        // Start menu music\n        playMenuMusic();\n\n        const currency = getCurrency();\n        const currencyName = getCurrencyName();\n\n        // Calculate layout dimensions\n        const rightColumnX = k.width() - LAYOUT.RIGHT_COLUMN_WIDTH - LAYOUT.LEFT_COLUMN_X;\n        const centerX = k.width() / 2;\n\n        // Background\n        k.add([\n            k.rect(k.width(), k.height()),\n            k.pos(0, 0),\n            k.color(...UI_COLORS.BG_DARK),\n            k.z(UI_Z_LAYERS.BACKGROUND)\n        ]);\n\n        // Decorative borders\n        k.add([\n            k.rect(k.width(), 4),\n            k.pos(0, 0),\n            k.color(...UI_COLORS.BORDER),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\n        ]);\n        k.add([\n            k.rect(k.width(), 4),\n            k.pos(0, k.height() - 4),\n            k.color(...UI_COLORS.BORDER),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\n        ]);\n\n        // ==========================================\n        // PROFILE CARD (Top-left, aligned with Daily Run on right)\n        // ==========================================\n        const profileCardX = LAYOUT.LEFT_COLUMN_X;\n        const profileCardY = LAYOUT.TOP_MARGIN + 50; // Align with daily run panel\n        const profileCardWidth = LAYOUT.LEFT_COLUMN_WIDTH;\n        const profileCardHeight = 75; // Compact height - just portrait, name, level, XP bar\n\n        // Profile card background (clickable)\n        const profileCardBg = k.add([\n            k.rect(profileCardWidth, profileCardHeight),\n            k.pos(profileCardX, profileCardY),\n            k.color(...UI_COLORS.BG_MEDIUM),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND),\n            'profileCard'\n        ]);\n\n        // Portrait\n        const portrait = getPortraitById(getSelectedPortrait()) || PORTRAITS.default;\n        const portraitSize = 45;\n        const portraitX = profileCardX + 32;\n        const portraitY = profileCardY + profileCardHeight / 2;\n\n        k.add([\n            k.rect(portraitSize, portraitSize),\n            k.pos(portraitX, portraitY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_LIGHT),\n            k.outline(2, k.rgb(...(portrait.color || [200, 200, 200]))),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\n        ]);\n\n        k.add([\n            k.text(portrait.icon, { size: 24 }),\n            k.pos(portraitX, portraitY),\n            k.anchor('center'),\n            k.color(...(portrait.color || [200, 200, 200])),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Player name (with fallback for null/undefined)\n        const playerName = getPlayerName() || 'Player';\n        const displayName = playerName.length > 16 ? playerName.substring(0, 16) + '..' : playerName;\n        const infoX = portraitX + portraitSize / 2 + 10;\n        k.add([\n            k.text(displayName, { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(infoX, profileCardY + 15),\n            k.anchor('left'),\n            k.color(...UI_COLORS.GOLD),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Level\n        const playerLevel = getPlayerLevel();\n        k.add([\n            k.text(`Lv.${playerLevel}`, { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(infoX, profileCardY + 32),\n            k.anchor('left'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // XP progress bar\n        const xpProgress = getXPProgress();\n        const xpBarWidth = profileCardWidth - 75;\n        const xpBarHeight = 8;\n        const xpBarX = infoX;\n        const xpBarY = profileCardY + 50;\n\n        // Bar background\n        k.add([\n            k.rect(xpBarWidth, xpBarHeight),\n            k.pos(xpBarX, xpBarY),\n            k.anchor('left'),\n            k.color(40, 40, 60),\n            k.outline(1, k.rgb(60, 60, 80)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\n        ]);\n\n        // Bar fill (ensure minimum width of 2 to avoid rendering issues)\n        const xpFillWidth = Math.max(2, xpBarWidth * xpProgress);\n        k.add([\n            k.rect(xpFillWidth, xpBarHeight - 2),\n            k.pos(xpBarX + 1, xpBarY),\n            k.anchor('left'),\n            k.color(100, 180, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n\n        // XP percentage (centered on top of the bar)\n        k.add([\n            k.text(`${Math.round(xpProgress * 100)}%`, { size: 9 }),\n            k.pos(xpBarX + xpBarWidth / 2, xpBarY),\n            k.anchor('center'),\n            k.color(255, 255, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Profile card click handler\n        profileCardBg.onClick(() => {\n            playMenuSelect();\n            k.go('profile');\n        });\n\n        profileCardBg.onHoverUpdate(() => {\n            profileCardBg.color = k.rgb(...UI_COLORS.BG_LIGHT);\n        });\n        profileCardBg.onHoverEnd(() => {\n            profileCardBg.color = k.rgb(...UI_COLORS.BG_MEDIUM);\n        });\n\n        // ==========================================\n        // LEFT COLUMN: Party Panel (Below Profile)\n        // ==========================================\n        initParty(k);\n\n        const partyPanelX = LAYOUT.LEFT_COLUMN_X;\n        const partyPanelY = profileCardY + profileCardHeight + 10;\n        const partyPanelWidth = LAYOUT.LEFT_COLUMN_WIDTH;\n        const slotHeight = 24;\n        const slotSpacing = 3;\n        const titlePadding = 8;\n        const partyPanelHeight = titlePadding + (slotHeight * 4) + (slotSpacing * 3) + 87;\n\n        // Party panel background\n        k.add([\n            k.rect(partyPanelWidth, partyPanelHeight),\n            k.pos(partyPanelX, partyPanelY),\n            k.color(...UI_COLORS.BG_MEDIUM),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\n        ]);\n\n        const slotsStartY = partyPanelY + titlePadding;\n        const slotElements = [];\n\n        function updatePartySlots() {\n            slotElements.forEach(elements => {\n                elements.forEach(el => {\n                    if (el.exists()) k.destroy(el);\n                });\n            });\n            slotElements.length = 0;\n\n            const partySlots = getPartyDisplayInfo();\n\n            partySlots.forEach((slot, index) => {\n                const slotY = slotsStartY + (index * (slotHeight + slotSpacing));\n                const elementsForThisSlot = [];\n\n                // Make non-empty, non-local slots clickable to view profile\n                const isClickable = !slot.isEmpty && !slot.isLocal;\n\n                const slotBg = k.add([\n                    k.rect(partyPanelWidth - 16, slotHeight),\n                    k.pos(partyPanelX + 8, slotY),\n                    k.color(slot.isEmpty ? UI_COLORS.BG_DARK : UI_COLORS.BG_LIGHT),\n                    k.outline(1, k.rgb(...UI_COLORS.TEXT_DISABLED)),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_BACKGROUND + 1),\n                    isClickable ? k.area() : null,\n                    'partySlotUI'\n                ].filter(Boolean));\n                elementsForThisSlot.push(slotBg);\n\n                // Click handler to view other player's profile\n                if (isClickable) {\n                    slotBg.onClick(() => {\n                        playMenuSelect();\n                        // Request profile data and navigate to profile scene\n                        requestPlayerProfile(index, (profileData) => {\n                            if (profileData) {\n                                k.go('profile', { externalProfile: profileData });\n                            } else {\n                                console.warn('Failed to load profile for slot', index);\n                            }\n                        });\n                    });\n\n                    slotBg.onHoverUpdate(() => {\n                        slotBg.color = k.rgb(80, 90, 110);\n                    });\n                    slotBg.onHoverEnd(() => {\n                        slotBg.color = k.rgb(...UI_COLORS.BG_LIGHT);\n                    });\n                }\n\n                // Show portrait emoji for players, slot number for empty slots\n                let slotIcon = `${slot.slotNumber}`;\n                if (!slot.isEmpty) {\n                    // Use the synced portrait from party data\n                    const portrait = getPortraitById(slot.selectedPortrait) || PORTRAITS.default;\n                    slotIcon = portrait.icon;\n                }\n                const slotIconEl = k.add([\n                    k.text(slotIcon, { size: slot.isEmpty ? UI_TEXT_SIZES.SMALL : UI_TEXT_SIZES.SMALL + 2 }),\n                    k.pos(partyPanelX + 18, slotY + slotHeight / 2),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT),\n                    'partySlotUI'\n                ]);\n                elementsForThisSlot.push(slotIconEl);\n\n                // Level badge on portrait (bottom-left of icon area)\n                if (!slot.isEmpty) {\n                    const levelBadge = k.add([\n                        k.text(`${slot.playerLevel}`, { size: 8 }),\n                        k.pos(partyPanelX + 9, slotY + slotHeight / 2 + 6),\n                        k.anchor('botleft'),\n                        k.color(...UI_COLORS.GOLD),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT + 1),\n                        'partySlotUI'\n                    ]);\n                    elementsForThisSlot.push(levelBadge);\n                }\n\n                if (!slot.isEmpty) {\n                    const charData = CHARACTER_UNLOCKS[slot.selectedCharacter] || CHARACTER_UNLOCKS['survivor'];\n                    const charIcon = k.add([\n                        k.text(charData.char, { size: UI_TEXT_SIZES.SMALL }),\n                        k.pos(partyPanelX + 38, slotY + slotHeight / 2),\n                        k.anchor('left'),\n                        k.color(...charData.color),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT),\n                        'partySlotUI'\n                    ]);\n                    elementsForThisSlot.push(charIcon);\n                }\n\n                const nameText = k.add([\n                    k.text(slot.playerName.substring(0, 16), { size: UI_TEXT_SIZES.SMALL - 2 }),\n                    k.pos(partyPanelX + (slot.isEmpty ? 32 : 55), slotY + slotHeight / 2),\n                    k.anchor('left'),\n                    k.color(slot.isEmpty ? UI_COLORS.TEXT_DISABLED : (slot.isLocal ? UI_COLORS.GOLD : UI_COLORS.TEXT_PRIMARY)),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT),\n                    'partySlotUI'\n                ]);\n                elementsForThisSlot.push(nameText);\n\n                if (!slot.isEmpty) {\n                    const readyIcon = slot.isReady ? '' : '';\n                    const readyColor = slot.isReady ? UI_COLORS.SUCCESS : UI_COLORS.TEXT_DISABLED;\n                    const readyText = k.add([\n                        k.text(readyIcon, { size: UI_TEXT_SIZES.SMALL - 2 }),\n                        k.pos(partyPanelX + partyPanelWidth - 14, slotY + slotHeight / 2),\n                        k.anchor('center'),\n                        k.color(...readyColor),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT),\n                        'partySlotUI'\n                    ]);\n                    elementsForThisSlot.push(readyText);\n\n                    // Show active emote if any\n                    const activeEmote = getActiveEmote(index);\n                    if (activeEmote) {\n                        const emoteChar = activeEmote === 'exclamation' ? '!' : '';\n                        const emoteColor = activeEmote === 'exclamation' ? [255, 255, 0] : [255, 100, 150];\n                        const emoteText = k.add([\n                            k.text(emoteChar, { size: UI_TEXT_SIZES.SMALL + 2 }),\n                            k.pos(partyPanelX + partyPanelWidth - 28, slotY + slotHeight / 2),\n                            k.anchor('center'),\n                            k.color(...emoteColor),\n                            k.fixed(),\n                            k.z(UI_Z_LAYERS.UI_TEXT + 1),\n                            'partySlotUI'\n                        ]);\n                        elementsForThisSlot.push(emoteText);\n                    }\n                }\n\n                if (slot.isDisconnected) {\n                    const dcText = k.add([\n                        k.text('', { size: UI_TEXT_SIZES.SMALL - 2 }),\n                        k.pos(partyPanelX + partyPanelWidth - 28, slotY + slotHeight / 2),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.WARNING),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT),\n                        'partySlotUI'\n                    ]);\n                    elementsForThisSlot.push(dcText);\n                }\n\n                slotElements.push(elementsForThisSlot);\n            });\n        }\n\n        updatePartySlots();\n\n        let lastPartyCheck = 0;\n        k.onUpdate(() => {\n            lastPartyCheck += k.dt();\n            if (lastPartyCheck >= 1.0) {\n                lastPartyCheck = 0;\n                updatePartySlots();\n                if (typeof updateStartButtonState === 'function') {\n                    updateStartButtonState();\n                }\n            }\n        });\n\n        // Invite code section\n        const inviteCodeY = slotsStartY + (4 * (slotHeight + slotSpacing)) + 6;\n\n        k.add([\n            k.text('Code:', { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(partyPanelX + 8, inviteCodeY),\n            k.anchor('left'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        const inviteCode = getDisplayInviteCode();\n        const inviteCodeDisplay = k.add([\n            k.text(inviteCode, { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(partyPanelX + partyPanelWidth - 8, inviteCodeY),\n            k.anchor('right'),\n            k.color(inviteCode === 'OFFLINE' ? [...UI_COLORS.TEXT_DISABLED] : [...UI_COLORS.GOLD]),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        let hasValidCode = inviteCode !== 'OFFLINE';\n        inviteCodeDisplay.onUpdate(() => {\n            if (!hasValidCode) {\n                const currentCode = getDisplayInviteCode();\n                if (currentCode && currentCode !== 'OFFLINE') {\n                    inviteCodeDisplay.text = currentCode;\n                    inviteCodeDisplay.color = k.rgb(...UI_COLORS.GOLD);\n                    hasValidCode = true;\n                }\n            }\n        });\n\n        // Join Party button\n        const joinButtonY = inviteCodeY + 22;\n        const joinButton = createMenuButton(\n            k, 'JOIN PARTY', partyPanelX + partyPanelWidth / 2, joinButtonY,\n            partyPanelWidth - 20, 28, UI_TEXT_SIZES.SMALL\n        );\n        joinButton.onClick(() => {\n            playMenuSelect();\n            k.go('joinParty');\n        });\n\n        // Find Match button\n        const findMatchY = joinButtonY + 32;\n        let findMatchButton = null;\n        let findMatchLabel = null;\n        let isSearchingForMatch = false;\n\n        // Set up global match handler for scene navigation\n        setupGlobalMatchHandler(k);\n\n        function updateFindMatchButton() {\n            // Clean up existing button\n            if (findMatchButton && findMatchButton.exists()) k.destroy(findMatchButton);\n            if (findMatchLabel && findMatchLabel.exists()) k.destroy(findMatchLabel);\n\n            const searching = isMatchmaking();\n            const buttonText = searching ? 'SEARCHING...' : 'FIND MATCH';\n            const buttonColor = searching ? [150, 120, 50] : [60, 80, 120];\n            const outlineColor = searching ? [200, 180, 80] : [80, 120, 180];\n\n            findMatchButton = k.add([\n                k.rect(partyPanelWidth - 20, 28),\n                k.pos(partyPanelX + partyPanelWidth / 2, findMatchY),\n                k.anchor('center'),\n                k.color(...buttonColor),\n                k.outline(2, k.rgb(...outlineColor)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS),\n                'findMatchButton'\n            ]);\n\n            findMatchLabel = k.add([\n                k.text(buttonText, { size: UI_TEXT_SIZES.SMALL }),\n                k.pos(partyPanelX + partyPanelWidth / 2, findMatchY),\n                k.anchor('center'),\n                k.color(...(searching ? UI_COLORS.GOLD : UI_COLORS.WHITE)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT),\n                'findMatchButton'\n            ]);\n\n            findMatchButton.onClick(() => {\n                playMenuSelect();\n                if (isMatchmaking()) {\n                    stopMatchmaking();\n                    updateFindMatchButton();\n                } else {\n                    startMatchmaking({\n                        onSearchStart: () => {\n                            updateFindMatchButton();\n                        },\n                        onMatchFound: (hostCode) => {\n                            console.log('[Menu] Match found!', hostCode ? `Joined ${hostCode}` : 'We are host');\n                            updateFindMatchButton();\n                            updatePartySlots();\n                        },\n                        onError: (err) => {\n                            console.error('[Menu] Matchmaking error:', err);\n                            updateFindMatchButton();\n                        },\n                        onSearchEnd: () => {\n                            updateFindMatchButton();\n                        }\n                    });\n                }\n            });\n        }\n\n        // Only show Find Match if Firebase is configured\n        if (isFirebaseConfigured()) {\n            updateFindMatchButton();\n        }\n\n        // Ready button (only visible in party)\n        const readyButtonY = findMatchY + 32;\n        let readyButtonElements = [];\n        let countdownDisplay = null;\n        // Track state to avoid unnecessary UI rebuilds\n        let lastReadyState = { partySize: 0, isReady: false, countdownActive: false, countdownSeconds: 0 };\n\n        function updateReadyButton(forceUpdate = false) {\n            const partySize = getPartySize();\n            const countdown = getCountdownState();\n            const isReady = isLocalPlayerReady();\n            const countdownSeconds = countdown.active ? Math.ceil(countdown.timeRemaining / 1000) : 0;\n\n            // Only rebuild UI if state actually changed (performance optimization)\n            if (!forceUpdate &&\n                lastReadyState.partySize === partySize &&\n                lastReadyState.isReady === isReady &&\n                lastReadyState.countdownActive === countdown.active &&\n                lastReadyState.countdownSeconds === countdownSeconds) {\n                return; // No change, skip UI rebuild\n            }\n\n            // Update tracked state\n            lastReadyState = { partySize, isReady, countdownActive: countdown.active, countdownSeconds };\n\n            // Clean up existing elements\n            readyButtonElements.forEach(el => {\n                if (el.exists()) k.destroy(el);\n            });\n            readyButtonElements = [];\n            if (countdownDisplay && countdownDisplay.exists()) {\n                k.destroy(countdownDisplay);\n                countdownDisplay = null;\n            }\n\n            if (partySize >= 2) {\n                const readyBg = k.add([\n                    k.rect(partyPanelWidth - 20, 24),\n                    k.pos(partyPanelX + partyPanelWidth / 2, readyButtonY),\n                    k.anchor('center'),\n                    k.color(isReady ? 100 : 60, isReady ? 150 : 80, isReady ? 100 : 120),\n                    k.outline(2, k.rgb(isReady ? 100 : 80, isReady ? 200 : 120, isReady ? 100 : 180)),\n                    k.area(),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS),\n                    'readyButtonUI'\n                ]);\n                readyButtonElements.push(readyBg);\n\n                const readyLabel = k.add([\n                    k.text(isReady ? ' READY' : 'READY UP', { size: UI_TEXT_SIZES.SMALL - 2 }),\n                    k.pos(partyPanelX + partyPanelWidth / 2, readyButtonY),\n                    k.anchor('center'),\n                    k.color(isReady ? 150 : 100, isReady ? 255 : 150, isReady ? 150 : 200),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT),\n                    'readyButtonUI'\n                ]);\n                readyButtonElements.push(readyLabel);\n\n                readyBg.onClick(() => {\n                    playMenuSelect();\n                    toggleReady();\n                    updateReadyButton(true); // Force update after click\n                    updatePartySlots();\n                });\n\n                if (countdown.active) {\n                    countdownDisplay = k.add([\n                        k.text(`Starting in ${countdownSeconds}...`, { size: UI_TEXT_SIZES.SMALL - 2 }),\n                        k.pos(partyPanelX + partyPanelWidth / 2, readyButtonY + 20),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.SUCCESS),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT),\n                        'countdownUI'\n                    ]);\n                }\n            }\n        }\n\n        updateReadyButton(true); // Initial render\n\n        let lastCountdownCheck = 0;\n        k.onUpdate(() => {\n            lastCountdownCheck += k.dt();\n            if (lastCountdownCheck < 0.1) return;\n            lastCountdownCheck = 0;\n\n            const countdown = getCountdownState();\n            const partySize = getPartySize();\n\n            // Only call updateReadyButton when in party - it will check if rebuild is needed\n            if (partySize >= 2) {\n                updateReadyButton();\n            }\n\n            if (countdown.active && countdown.timeRemaining <= 0) {\n                const party = getParty();\n                if (party.isHost) {\n                    playMenuSelect();\n                    broadcastGameStart();\n                    k.go('game', { resetState: true });\n                }\n            }\n        });\n\n        // ==========================================\n        // DAILY RUN PANEL (Top-right, below credits)\n        // ==========================================\n        const dailyPanelWidth = LAYOUT.RIGHT_COLUMN_WIDTH;\n        const dailyPanelHeight = 120;\n        const dailyPanelX = rightColumnX;\n        const dailyRunY = LAYOUT.TOP_MARGIN + 50; // Move down to avoid overlap with credits\n        const dailyInfo = getDailyRunInfo();\n        const dailyChar = CHARACTER_UNLOCKS[dailyInfo.character] || CHARACTER_UNLOCKS.survivor;\n\n        k.add([\n            k.rect(dailyPanelWidth, dailyPanelHeight),\n            k.pos(dailyPanelX, dailyRunY),\n            k.color(...UI_COLORS.BG_MEDIUM),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\n        ]);\n\n        k.add([\n            k.text('DAILY RUN', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 12),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        k.add([\n            k.text(dailyChar.char, { size: 28 }),\n            k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 45),\n            k.anchor('center'),\n            k.color(...dailyChar.color),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        k.add([\n            k.text(dailyChar.name, { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 68),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        const initialPartySize = getPartySize();\n        const dailyDisabledInMultiplayer = initialPartySize > 1;\n\n        if (dailyInfo.completed) {\n            k.add([\n                k.text('COMPLETED', { size: UI_TEXT_SIZES.SMALL - 2 }),\n                k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 95),\n                k.anchor('center'),\n                k.color(...UI_COLORS.SUCCESS),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n        } else if (dailyDisabledInMultiplayer) {\n            k.add([\n                k.text('SOLO ONLY', { size: UI_TEXT_SIZES.SMALL - 2 }),\n                k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 95),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_DISABLED),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n        } else {\n            const dailyPlayButton = k.add([\n                k.rect(dailyPanelWidth - 40, 28),\n                k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 95),\n                k.anchor('center'),\n                k.color(...UI_COLORS.SECONDARY),\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n\n            k.add([\n                k.text('PLAY', { size: UI_TEXT_SIZES.SMALL }),\n                k.pos(dailyPanelX + dailyPanelWidth / 2, dailyRunY + 95),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_PRIMARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            dailyPlayButton.onClick(() => {\n                if (getPartySize() > 1) return;\n                playMenuSelect();\n                k.go('game', {\n                    resetState: true,\n                    isDailyRun: true,\n                    dailyCharacter: dailyInfo.character,\n                    dailySeed: dailyInfo.seed,\n                    dailyDate: dailyInfo.date\n                });\n            });\n\n            dailyPlayButton.onHoverUpdate(() => {\n                dailyPlayButton.color = k.rgb(...UI_COLORS.SECONDARY_HOVER);\n            });\n            dailyPlayButton.onHoverEnd(() => {\n                dailyPlayButton.color = k.rgb(...UI_COLORS.SECONDARY);\n            });\n        }\n\n        // ==========================================\n        // RIGHT COLUMN: Credits + Leaderboards\n        // ==========================================\n\n        // Credits display (top right of center area)\n        const creditIndicator = createCreditIndicator(k, currency, currencyName);\n\n        // Leaderboards panel (below daily run panel on right)\n        const leaderboardsY = dailyRunY + dailyPanelHeight + 15;\n        const leaderboardsPanelHeight = 100;\n\n        k.add([\n            k.rect(LAYOUT.RIGHT_COLUMN_WIDTH, leaderboardsPanelHeight),\n            k.pos(rightColumnX, leaderboardsY),\n            k.color(...UI_COLORS.BG_MEDIUM),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND),\n            'leaderboardsPanel'\n        ]);\n\n        k.add([\n            k.text('LEADERBOARDS', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(rightColumnX + LAYOUT.RIGHT_COLUMN_WIDTH / 2, leaderboardsY + 15),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        k.add([\n            k.text('', { size: 32 }),\n            k.pos(rightColumnX + LAYOUT.RIGHT_COLUMN_WIDTH / 2, leaderboardsY + 50),\n            k.anchor('center'),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        k.add([\n            k.text('VIEW', { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(rightColumnX + LAYOUT.RIGHT_COLUMN_WIDTH / 2, leaderboardsY + 80),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        const leaderboardsPanel = k.get('leaderboardsPanel')[0];\n        if (leaderboardsPanel) {\n            leaderboardsPanel.onClick(() => {\n                playMenuSelect();\n                k.go('leaderboards');\n            });\n            leaderboardsPanel.onHoverUpdate(() => {\n                leaderboardsPanel.color = k.rgb(...UI_COLORS.BG_LIGHT);\n            });\n            leaderboardsPanel.onHoverEnd(() => {\n                leaderboardsPanel.color = k.rgb(...UI_COLORS.BG_MEDIUM);\n            });\n        }\n\n        // ==========================================\n        // CENTER: Title + Main Buttons\n        // ==========================================\n\n        // ASCII Art Title with Animation\n        const titleY = 160;\n        const asciiTitle = [\n            '     ',\n            '   ',\n            '     ',\n            '      ',\n            '       ',\n            '         ',\n            '',\n            '       ',\n            '   ',\n            '',\n            '',\n            '      ',\n            '         ',\n            '',\n            '     ',\n            ' ',\n            '                  ',\n            '                    ',\n            '                   ',\n            '                    '\n        ];\n\n        const titleLines = [];\n        const lineSpacing = 12;\n        const startY = titleY - (asciiTitle.length * lineSpacing) / 2;\n\n        asciiTitle.forEach((line, index) => {\n            const titleLine = k.add([\n                k.text(line, { size: 10, font: 'monospace' }),\n                k.pos(centerX, startY + index * lineSpacing),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_PRIMARY),\n                k.z(UI_Z_LAYERS.UI_TEXT),\n                'titleLine'\n            ]);\n            titleLines.push(titleLine);\n        });\n\n        // Animated color wave effect for title\n        let colorTime = 0;\n        k.onUpdate(() => {\n            colorTime += k.dt();\n            titleLines.forEach((line, index) => {\n                const hue = (colorTime * 50 + index * 20) % 360;\n                const color = hslToRgb(hue, 80, 60);\n                line.color = k.rgb(...color);\n\n                const offset = Math.sin(colorTime * 2 + index * 0.3) * 2;\n                line.pos.y = startY + index * lineSpacing + offset;\n\n                // Glitch effect (random chance)\n                if (Math.random() < 0.001) {\n                    line.pos.x = centerX + (Math.random() - 0.5) * 10;\n                    k.wait(0.1, () => {\n                        if (line.exists()) {\n                            line.pos.x = centerX;\n                        }\n                    });\n                }\n            });\n        });\n\n        // Main buttons - centered column using standardized sizes\n        const buttonStartY = 310;\n        const buttonSpacing = 55;\n        const { XL, LG } = UI_SIZES.BUTTON;\n\n        const playButton = createMenuButton(\n            k, 'ACTION!', centerX, buttonStartY,\n            XL.width, XL.height, UI_TEXT_SIZES.H1\n        );\n        playButton.onClick(() => {\n            if (playButton.disabled) return;\n            playMenuSelect();\n            const partySize = getPartySize();\n            if (partySize > 1) {\n                broadcastGameStart();\n            }\n            k.go('game', { resetState: true });\n        });\n\n        function updateStartButtonState() {\n            const party = getParty();\n            const partySize = getPartySize();\n            const shouldDisable = partySize > 1 && !party.isHost;\n            playButton.setDisabled(shouldDisable);\n        }\n        updateStartButtonState();\n\n        const characterButton = createMenuButton(\n            k, 'CONTESTANTS', centerX, buttonStartY + buttonSpacing,\n            LG.width, LG.height, UI_TEXT_SIZES.H2\n        );\n        characterButton.onClick(() => {\n            playMenuSelect();\n            k.go('characterSelect');\n        });\n\n        // Selected character icon next to button\n        const selectedCharKey = getSelectedCharacter();\n        const selectedCharData = CHARACTER_UNLOCKS[selectedCharKey];\n        if (selectedCharData) {\n            const isCharUnlocked = isUnlocked('characters', selectedCharKey) || selectedCharData.unlockedByDefault;\n            const charDisplayX = centerX + LG.width / 2 + 35;\n            const charDisplayY = buttonStartY + buttonSpacing;\n            const charDisplaySize = 45;\n\n            const charDisplayBg = k.add([\n                k.rect(charDisplaySize, charDisplaySize),\n                k.pos(charDisplayX, charDisplayY),\n                k.anchor('center'),\n                k.color(...UI_COLORS.BG_MEDIUM),\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_BACKGROUND)\n            ]);\n\n            const charDisplayIcon = k.add([\n                k.text(selectedCharData.char, { size: 28 }),\n                k.pos(charDisplayX, charDisplayY),\n                k.anchor('center'),\n                k.color(...(isCharUnlocked ? selectedCharData.color : UI_COLORS.BG_DISABLED)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            charDisplayBg.onClick(() => {\n                playMenuSelect();\n                k.go('characterSelect');\n            });\n\n            charDisplayBg.onHoverUpdate(() => {\n                charDisplayBg.color = k.rgb(...UI_COLORS.BG_LIGHT);\n                charDisplayIcon.scale = k.vec2(1.1);\n            });\n            charDisplayBg.onHoverEnd(() => {\n                charDisplayBg.color = k.rgb(...UI_COLORS.BG_MEDIUM);\n                charDisplayIcon.scale = k.vec2(1);\n            });\n        }\n\n        const shopButton = createMenuButton(\n            k, 'MERCH', centerX, buttonStartY + buttonSpacing * 2,\n            LG.width, LG.height, UI_TEXT_SIZES.H2\n        );\n        shopButton.onClick(() => {\n            playMenuSelect();\n            k.go('shop');\n        });\n\n        const statisticsButton = createMenuButton(\n            k, 'RATINGS', centerX, buttonStartY + buttonSpacing * 3,\n            LG.width, LG.height, UI_TEXT_SIZES.H2\n        );\n        statisticsButton.onClick(() => {\n            playMenuSelect();\n            k.go('statistics');\n        });\n\n        const settingsButton = createMenuButton(\n            k, 'OPTIONS', centerX, buttonStartY + buttonSpacing * 4,\n            LG.width, LG.height, UI_TEXT_SIZES.H2\n        );\n        settingsButton.onClick(() => {\n            playMenuSelect();\n            k.go('settings');\n        });\n\n        // Animate button colors\n        const menuButtons = [playButton, characterButton, shopButton, statisticsButton, settingsButton];\n        let buttonColorTime = 0;\n        k.onUpdate(() => {\n            buttonColorTime += k.dt();\n            menuButtons.forEach((button, index) => {\n                if (!button.exists() || button.isHovered) return;\n                const hue = (buttonColorTime * 60 + index * 50) % 360;\n                const color = hslToRgb(hue, 70, 50);\n                const textColor = getContrastingTextColor(hue);\n                try {\n                    button.color = k.rgb(color[0], color[1], color[2]);\n                    button.originalColor = color;\n                    // Update label text color for contrast\n                    if (button.label && button.label.exists()) {\n                        button.label.color = k.rgb(textColor[0], textColor[1], textColor[2]);\n                    }\n                } catch (e) {}\n            });\n        });\n\n        // Keyboard shortcuts\n        const spaceHandler = k.onKeyPress('space', () => {\n            if (!playButton.disabled) {\n                playMenuSelect();\n                k.go('game', { resetState: true });\n            }\n        });\n        const cHandler = k.onKeyPress('c', () => { playMenuNav(); k.go('characterSelect'); });\n        const sHandler = k.onKeyPress('s', () => { playMenuNav(); k.go('shop'); });\n        const oHandler = k.onKeyPress('o', () => { playMenuNav(); k.go('settings'); });\n        const tHandler = k.onKeyPress('t', () => { playMenuNav(); k.go('statistics'); });\n\n        // Emote key handlers (Q and E)\n        let lastEmoteTime = 0;\n        const EMOTE_COOLDOWN = 0.5; // seconds (longer cooldown for menu)\n\n        const qHandler = k.onKeyPress('q', () => {\n            const now = k.time();\n            if (now - lastEmoteTime < EMOTE_COOLDOWN) return;\n            lastEmoteTime = now;\n            broadcastPartyEmote('exclamation');\n            updatePartySlots();\n        });\n\n        const eHandler = k.onKeyPress('e', () => {\n            const now = k.time();\n            if (now - lastEmoteTime < EMOTE_COOLDOWN) return;\n            lastEmoteTime = now;\n            broadcastPartyEmote('heart');\n            updatePartySlots();\n        });\n\n        // Listen for emotes from other players and update display\n        const emoteCallback = (slotIndex, emoteType) => {\n            updatePartySlots();\n        };\n        onPartyEmote(emoteCallback);\n\n        k.onSceneLeave(() => {\n            spaceHandler.cancel();\n            cHandler.cancel();\n            sHandler.cancel();\n            oHandler.cancel();\n            tHandler.cancel();\n            qHandler.cancel();\n            eHandler.cancel();\n            offPartyEmote(emoteCallback);\n        });\n\n        // ==========================================\n        // Background decorations (reduced)\n        // ==========================================\n\n        // Falling particles\n        for (let i = 0; i < 12; i++) {\n            const particle = k.add([\n                k.text(['*', '+', ''][Math.floor(Math.random() * 3)], { size: 12 }),\n                k.pos(Math.random() * k.width(), Math.random() * k.height()),\n                k.color(...UI_COLORS.BG_LIGHT),\n                k.opacity(0.2 + Math.random() * 0.2),\n                k.z(UI_Z_LAYERS.PARTICLES)\n            ]);\n\n            particle.speed = 15 + Math.random() * 25;\n            particle.onUpdate(() => {\n                particle.pos.y += particle.speed * k.dt();\n                if (particle.pos.y > k.height()) {\n                    particle.pos.y = 0;\n                    particle.pos.x = Math.random() * k.width();\n                }\n            });\n        }\n\n        // Pulsing patterns\n        const patterns = ['', '', '', ''];\n        for (let i = 0; i < 8; i++) {\n            const pattern = k.add([\n                k.text(patterns[Math.floor(Math.random() * patterns.length)], { size: 16 }),\n                k.pos(Math.random() * k.width(), Math.random() * k.height()),\n                k.color(...UI_COLORS.BG_LIGHT),\n                k.opacity(0.1),\n                k.scale(1),\n                k.z(UI_Z_LAYERS.PARTICLES)\n            ]);\n\n            pattern.pulseTime = Math.random() * Math.PI * 2;\n            pattern.pulseSpeed = 1 + Math.random() * 1.5;\n\n            pattern.onUpdate(() => {\n                pattern.pulseTime += k.dt() * pattern.pulseSpeed;\n                const scale = 0.8 + Math.sin(pattern.pulseTime) * 0.2;\n                pattern.scale = k.vec2(scale, scale);\n                pattern.opacity = 0.08 + Math.abs(Math.sin(pattern.pulseTime)) * 0.1;\n            });\n        }\n\n        // ==========================================\n        // Version number (Micro text, bottom-right)\n        // DO NOT REMOVE: Auto-version from vite.config.js\n        // See GIT_WORKFLOW.md \"Automatic Version Numbering\"\n        // ==========================================\n        k.add([\n            k.text(__APP_VERSION__, { size: UI_TEXT_SIZES.MICRO }),\n            k.pos(k.width() - 10, k.height() - 10),\n            k.anchor('botright'),\n            k.color(...UI_COLORS.TEXT_DISABLED),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // ==========================================\n        // EASTER EGG: Golden enemy flyby\n        // ==========================================\n        k.loop(12, () => {\n            if (Math.random() < 0.12) {\n                const startY = 100 + Math.random() * (k.height() - 200);\n                const direction = Math.random() < 0.5 ? 1 : -1;\n                const startX = direction > 0 ? -50 : k.width() + 50;\n\n                const goldenEnemy = k.add([\n                    k.text('$', { size: 24 }),\n                    k.pos(startX, startY),\n                    k.color(...UI_COLORS.GOLD),\n                    k.area({ scale: 2.5 }),\n                    k.anchor('center'),\n                    k.scale(1),\n                    k.z(UI_Z_LAYERS.PARTICLES + 1),\n                    'goldenEnemy'\n                ]);\n\n                goldenEnemy.speed = 150 + Math.random() * 100;\n                goldenEnemy.direction = direction;\n                goldenEnemy.pulseTime = 0;\n\n                goldenEnemy.onClick(() => {\n                    if (!goldenEnemy.exists()) return;\n                    addCurrency(1);\n\n                    for (let i = 0; i < 8; i++) {\n                        const angle = (Math.PI * 2 * i) / 8;\n                        const particle = k.add([\n                            k.text(['$', ''][Math.floor(Math.random() * 2)], { size: 12 }),\n                            k.pos(goldenEnemy.pos.x, goldenEnemy.pos.y),\n                            k.color(...UI_COLORS.GOLD),\n                            k.opacity(1),\n                            k.z(UI_Z_LAYERS.PARTICLES + 2)\n                        ]);\n\n                        const speed = 80 + Math.random() * 60;\n                        particle.velocity = k.vec2(Math.cos(angle) * speed, Math.sin(angle) * speed);\n                        particle.life = 0.8;\n\n                        particle.onUpdate(() => {\n                            particle.pos = particle.pos.add(particle.velocity.scale(k.dt()));\n                            particle.life -= k.dt();\n                            particle.opacity = particle.life / 0.8;\n                            if (particle.life <= 0) k.destroy(particle);\n                        });\n                    }\n\n                    const rewardText = k.add([\n                        k.text('+$1', { size: 18 }),\n                        k.pos(goldenEnemy.pos.x, goldenEnemy.pos.y),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.SUCCESS),\n                        k.opacity(1),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n\n                    rewardText.life = 1.2;\n                    rewardText.onUpdate(() => {\n                        rewardText.pos.y -= 40 * k.dt();\n                        rewardText.life -= k.dt();\n                        rewardText.opacity = rewardText.life / 1.2;\n                        if (rewardText.life <= 0) k.destroy(rewardText);\n                    });\n\n                    k.destroy(goldenEnemy);\n                    k.wait(0.1, () => k.go('menu'));\n                });\n\n                goldenEnemy.onUpdate(() => {\n                    goldenEnemy.pos.x += goldenEnemy.speed * goldenEnemy.direction * k.dt();\n                    goldenEnemy.pulseTime += k.dt();\n                    const pulse = Math.sin(goldenEnemy.pulseTime * 8) * 0.15;\n                    goldenEnemy.scale = k.vec2(1 + pulse, 1 + pulse);\n\n                    if ((goldenEnemy.direction > 0 && goldenEnemy.pos.x > k.width() + 100) ||\n                        (goldenEnemy.direction < 0 && goldenEnemy.pos.x < -100)) {\n                        k.destroy(goldenEnemy);\n                    }\n                });\n            }\n        });\n    });\n}\n","/**\n * Achievement Detail Modal Component\n * Displays detailed achievement information with progress tracking\n */\n\nimport { UI_Z_LAYERS, UI_COLORS, UI_TEXT_SIZES } from '../config/uiConfig.js';\nimport { ACHIEVEMENT_COLORS, getAchievementProgress, getAchievementReward } from '../data/achievements.js';\nimport { CHARACTER_UNLOCKS, WEAPON_UNLOCKS, COSMETIC_UNLOCKS } from '../data/unlocks.js';\nimport { getSaveStats, isAchievementUnlocked, getCurrencyName } from '../systems/metaProgression.js';\nimport { playMenuNav } from '../systems/sounds.js';\n\n/**\n * Get characters unlocked by a specific achievement\n * @param {string} achievementId - The achievement ID to check\n * @returns {Array} Array of character objects that this achievement unlocks\n */\nfunction getCharactersUnlockedByAchievement(achievementId) {\n    const characters = [];\n    for (const [key, char] of Object.entries(CHARACTER_UNLOCKS)) {\n        if (char.unlockRequirement?.type === 'achievement' && char.unlockRequirement?.value === achievementId) {\n            characters.push({ key, ...char });\n        }\n    }\n    return characters;\n}\n\n// Modal state\nlet modalState = {\n    isOpen: false,\n    elements: [],\n    k: null,\n    onClose: null\n};\n\n/**\n * Show the achievement detail modal\n * @param {Object} k - Kaplay instance\n * @param {Object} achievement - Achievement data object\n * @param {Function} onClose - Optional callback when modal is closed\n */\nexport function showAchievementModal(k, achievement, onClose = null) {\n    if (modalState.isOpen) {\n        closeAchievementModal();\n    }\n\n    modalState.k = k;\n    modalState.isOpen = true;\n    modalState.onClose = onClose;\n    modalState.elements = [];\n\n    const stats = getSaveStats();\n    const isUnlocked = isAchievementUnlocked(achievement.id);\n    const progress = getAchievementProgress(achievement.id, stats);\n    const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\n\n    // Modal dimensions - taller to fit unlocks and progress info\n    const modalWidth = 420;\n    const modalHeight = 400;\n    const centerX = k.width() / 2;\n    const centerY = k.height() / 2;\n\n    // Overlay background (darkens the screen)\n    const overlay = k.add([\n        k.rect(k.width(), k.height()),\n        k.pos(0, 0),\n        k.color(0, 0, 0),\n        k.opacity(0.7),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL - 1),\n        k.area(),\n        'achievementModalOverlay'\n    ]);\n    modalState.elements.push(overlay);\n\n    // Close modal on overlay click\n    overlay.onClick(() => {\n        closeAchievementModal();\n    });\n\n    // Modal background\n    const modalBg = k.add([\n        k.rect(modalWidth, modalHeight),\n        k.pos(centerX, centerY),\n        k.anchor('center'),\n        k.color(...UI_COLORS.BG_MEDIUM),\n        k.outline(3, k.rgb(...difficultyColor)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL),\n        'achievementModal'\n    ]);\n    modalState.elements.push(modalBg);\n\n    // Achievement name\n    const nameText = k.add([\n        k.text(achievement.name, { size: UI_TEXT_SIZES.HEADER }),\n        k.pos(centerX, centerY - 130),\n        k.anchor('center'),\n        k.color(...(isUnlocked ? difficultyColor : UI_COLORS.TEXT_DISABLED)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 1),\n        'achievementModal'\n    ]);\n    modalState.elements.push(nameText);\n\n    // Icon (large)\n    const iconBg = k.add([\n        k.rect(64, 64),\n        k.pos(centerX, centerY - 70),\n        k.anchor('center'),\n        k.color(isUnlocked ? 50 : 30, isUnlocked ? 50 : 30, isUnlocked ? 60 : 30),\n        k.outline(2, k.rgb(...(isUnlocked ? difficultyColor : UI_COLORS.TEXT_DISABLED))),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 1),\n        'achievementModal'\n    ]);\n    modalState.elements.push(iconBg);\n\n    const iconText = k.add([\n        k.text(achievement.icon, { size: 36 }),\n        k.pos(centerX, centerY - 70),\n        k.anchor('center'),\n        k.color(...(isUnlocked ? [255, 255, 255] : [80, 80, 80])),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 2),\n        'achievementModal'\n    ]);\n    modalState.elements.push(iconText);\n\n    // Description\n    const descText = k.add([\n        k.text(achievement.description, { size: UI_TEXT_SIZES.BODY, width: modalWidth - 40 }),\n        k.pos(centerX, centerY - 25),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_SECONDARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 1),\n        'achievementModal'\n    ]);\n    modalState.elements.push(descText);\n\n    // Build unlocks summary for display\n    const characterUnlocks = getCharactersUnlockedByAchievement(achievement.id);\n    const hasShopUnlocks = achievement.unlocks && achievement.unlocks.length > 0;\n    const hasCharacterUnlocks = characterUnlocks.length > 0;\n\n    // Show what this achievement unlocks (repurposed from hint)\n    if (hasCharacterUnlocks || hasShopUnlocks) {\n        const unlockParts = [];\n\n        // Add character names\n        characterUnlocks.forEach(char => {\n            unlockParts.push(`${char.char} ${char.name}`);\n        });\n\n        // Add shop item names\n        if (hasShopUnlocks) {\n            achievement.unlocks.forEach(unlockKey => {\n                const weapon = WEAPON_UNLOCKS[unlockKey];\n                const cosmetic = COSMETIC_UNLOCKS[unlockKey];\n                if (weapon) {\n                    unlockParts.push(weapon.name);\n                } else if (cosmetic) {\n                    unlockParts.push(cosmetic.name);\n                }\n            });\n        }\n\n        if (unlockParts.length > 0) {\n            const unlocksText = k.add([\n                k.text(`Unlocks: ${unlockParts.join(', ')}`, { size: UI_TEXT_SIZES.SMALL, width: modalWidth - 40 }),\n                k.pos(centerX, centerY + 5),\n                k.anchor('center'),\n                k.color(...(isUnlocked ? UI_COLORS.SUCCESS : UI_COLORS.GOLD)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 1),\n                'achievementModal'\n            ]);\n            modalState.elements.push(unlocksText);\n        }\n    }\n\n    // Progress bar (if applicable)\n    const hasUnlocks = hasCharacterUnlocks || hasShopUnlocks;\n    const progressBaseY = hasUnlocks ? centerY + 35 : centerY + 25;\n\n    if (progress && !isUnlocked) {\n        const progressBarWidth = 280;\n        const progressBarHeight = 20;\n        const progressY = progressBaseY;\n\n        // Progress bar background\n        const progressBg = k.add([\n            k.rect(progressBarWidth, progressBarHeight),\n            k.pos(centerX, progressY),\n            k.anchor('center'),\n            k.color(30, 30, 40),\n            k.outline(2, k.rgb(80, 80, 100)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1),\n            'achievementModal'\n        ]);\n        modalState.elements.push(progressBg);\n\n        // Progress bar fill\n        const fillWidth = Math.max(4, progressBarWidth * progress.progress);\n        const progressFill = k.add([\n            k.rect(fillWidth, progressBarHeight - 4),\n            k.pos(centerX - progressBarWidth / 2 + fillWidth / 2, progressY),\n            k.anchor('center'),\n            k.color(...difficultyColor),\n            k.opacity(0.8),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 2),\n            'achievementModal'\n        ]);\n        modalState.elements.push(progressFill);\n\n        // Progress text\n        const progressText = k.add([\n            k.text(`${progress.current}/${progress.target} (${progress.percentage}%)`, { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(centerX, progressY + 25),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_TERTIARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1),\n            'achievementModal'\n        ]);\n        modalState.elements.push(progressText);\n    } else if (isUnlocked) {\n        // Show \"UNLOCKED\" status\n        const unlockedText = k.add([\n            k.text('UNLOCKED', { size: UI_TEXT_SIZES.LABEL }),\n            k.pos(centerX, progressBaseY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.SUCCESS),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1),\n            'achievementModal'\n        ]);\n        modalState.elements.push(unlockedText);\n    }\n\n    // Credit reward section (simplified - unlocks now shown above)\n    const creditReward = getAchievementReward(achievement);\n\n    if (creditReward > 0) {\n        const rewardY = progressBaseY + (isUnlocked ? 35 : (progress ? 55 : 35));\n\n        const rewardLabel = k.add([\n            k.text('-- REWARD --', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(centerX, rewardY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.GOLD),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1),\n            'achievementModal'\n        ]);\n        modalState.elements.push(rewardLabel);\n\n        const currencyName = getCurrencyName();\n        const rewardText = k.add([\n            k.text(`${currencyName}${creditReward}`, { size: UI_TEXT_SIZES.H2 }),\n            k.pos(centerX, rewardY + 25),\n            k.anchor('center'),\n            k.color(...(isUnlocked ? UI_COLORS.SUCCESS : UI_COLORS.GOLD)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1),\n            'achievementModal'\n        ]);\n        modalState.elements.push(rewardText);\n    }\n\n    // Difficulty badge - positioned near bottom of modal\n    // Using lenticular brackets instead of square brackets to avoid KAPLAY styled text tag parsing\n    const difficultyName = achievement.difficulty.charAt(0).toUpperCase() + achievement.difficulty.slice(1);\n    const difficultyBadge = k.add([\n        k.text(`${difficultyName}`, { size: UI_TEXT_SIZES.SMALL }),\n        k.pos(centerX, centerY + modalHeight / 2 - 60),\n        k.anchor('center'),\n        k.color(...difficultyColor),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 1),\n        'achievementModal'\n    ]);\n    modalState.elements.push(difficultyBadge);\n\n    // Close button\n    const closeButton = k.add([\n        k.rect(80, 30),\n        k.pos(centerX, centerY + modalHeight / 2 - 30),\n        k.anchor('center'),\n        k.color(...UI_COLORS.NEUTRAL),\n        k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n        k.area(),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 1),\n        'achievementModal'\n    ]);\n    modalState.elements.push(closeButton);\n\n    const closeText = k.add([\n        k.text('CLOSE', { size: UI_TEXT_SIZES.SMALL }),\n        k.pos(centerX, centerY + modalHeight / 2 - 30),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_SECONDARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 2),\n        'achievementModal'\n    ]);\n    modalState.elements.push(closeText);\n\n    closeButton.onClick(() => {\n        playMenuNav();\n        closeAchievementModal();\n    });\n\n    // Close on escape key\n    const escHandler = k.onKeyPress('escape', () => {\n        closeAchievementModal();\n    });\n    modalState.escHandler = escHandler;\n}\n\n/**\n * Close the achievement modal\n */\nexport function closeAchievementModal() {\n    if (!modalState.isOpen) return;\n\n    const k = modalState.k;\n    if (!k) return;\n\n    // Destroy all modal elements\n    modalState.elements.forEach(element => {\n        if (element && element.exists && element.exists()) {\n            k.destroy(element);\n        }\n    });\n    modalState.elements = [];\n\n    // Cancel escape handler\n    if (modalState.escHandler) {\n        modalState.escHandler.cancel();\n        modalState.escHandler = null;\n    }\n\n    modalState.isOpen = false;\n\n    // Call onClose callback\n    if (modalState.onClose) {\n        modalState.onClose();\n        modalState.onClose = null;\n    }\n}\n\n/**\n * Check if modal is currently open\n * @returns {boolean}\n */\nexport function isAchievementModalOpen() {\n    return modalState.isOpen;\n}\n","/**\n * Online Leaderboards System\n *\n * Integrates with Dreamlo API for global leaderboards.\n * Provides async submission and retrieval with caching.\n *\n * SECURITY LIMITATIONS (Accepted for casual browser game):\n * - Private API key is exposed in client-side code (anyone can view source)\n * - No server-side validation (scores can be spoofed via direct API calls)\n * - Client-side validation only (basic sanity checks, easily bypassed)\n *\n * For a competitive game, these would need:\n * - Server-side proxy to hide API keys\n * - Server-side score validation\n * - Anti-cheat measures\n */\n\n// Dreamlo API configuration - Two leaderboards\nconst LEADERBOARDS = {\n    allTime: {\n        publicKey: '696eba6f8f40bb1184b6c60f',\n        privateKey: 'YRU5IdY0w0uJvRF8cb9S1A21WwOAek3kyr3RcOYHbdYA'\n    },\n    daily: {\n        publicKey: '696ff2ee8f40bb1184b8cc92',\n        privateKey: 'SgdqIaI_fkWUlRVwoWLQlA1yEXBc-33UKZYWPWJcOX6Q'\n    }\n};\n\n// IMPORTANT: Dreamlo free tier only supports HTTP, not HTTPS.\n// Since the game is deployed on HTTPS (GitHub Pages), we need a CORS proxy.\n// The proxy routes: HTTPS (our game) -> Proxy -> HTTP (Dreamlo)\n//\n// Current proxy: corsproxy.io (free, public, browser-only)\n// For production, consider: Cloudflare Workers, Vercel Edge Functions, or Dreamlo paid tier\nconst CORS_PROXY = 'https://corsproxy.io/?';\nconst DREAMLO_RAW_URL = 'http://dreamlo.com/lb';\n\n/**\n * Build a proxied URL for Dreamlo API calls\n * @param {string} path - Path to append (e.g., \"/publicKey/json\")\n * @returns {string} - Full proxied URL\n */\nfunction buildProxiedUrl(path) {\n    return `${CORS_PROXY}${encodeURIComponent(DREAMLO_RAW_URL + path)}`;\n}\n\n// Cache configuration - separate cache for each board type\nconst CACHE_DURATION_MS = 60000; // 1 minute cache\nconst leaderboardCaches = {\n    allTime: { data: null, timestamp: 0 },\n    daily: { data: null, timestamp: 0 }\n};\n\n// Request timeout\nconst REQUEST_TIMEOUT_MS = 5000;\n\n/**\n * Sanitize player name for API submission\n * - Alphanumeric, underscores, and hyphens only\n * - Max 20 characters\n * @param {string} name - Raw player name\n * @returns {string} - Sanitized name\n */\nfunction sanitizeName(name) {\n    if (!name) return 'Anonymous';\n    // Remove special characters, keep alphanumeric, underscore, hyphen\n    const sanitized = name.replace(/[^a-zA-Z0-9_-]/g, '').substring(0, 20);\n    return sanitized || 'Anonymous';\n}\n\n/**\n * Validate score is reasonable (basic sanity check)\n * @param {number} score - Score to validate\n * @returns {boolean} - Whether score seems valid\n */\nfunction isValidScore(score) {\n    // Score should be a positive number, not absurdly high\n    // Max realistic score: ~100 floors * 1000 + 1000 kills * 10 + 100 bosses * 500 + 30000 time bonus\n    const MAX_REASONABLE_SCORE = 200000;\n    return typeof score === 'number' && score > 0 && score <= MAX_REASONABLE_SCORE;\n}\n\n/**\n * Fetch with timeout\n * @param {string} url - URL to fetch\n * @param {number} timeout - Timeout in ms\n * @returns {Promise<Response>}\n */\nasync function fetchWithTimeout(url, timeout = REQUEST_TIMEOUT_MS) {\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n    try {\n        const response = await fetch(url, { signal: controller.signal });\n        clearTimeout(timeoutId);\n        return response;\n    } catch (error) {\n        clearTimeout(timeoutId);\n        throw error;\n    }\n}\n\n/**\n * Submit score to online leaderboard (non-blocking)\n * @param {Object} entry - Score entry\n * @param {string} entry.name - Player name\n * @param {number} entry.score - Score value\n * @param {number} entry.floor - Floor reached\n * @param {string} entry.character - Character used\n * @param {number} entry.time - Duration in seconds\n * @param {string} entry.date - Date string (YYYY-MM-DD)\n * @param {string} boardType - Which board to submit to ('allTime' or 'daily')\n * @returns {Promise<boolean>} - Whether submission succeeded\n */\nexport async function submitOnlineScore(entry, boardType = 'allTime') {\n    try {\n        // Validate score\n        if (!isValidScore(entry.score)) {\n            console.warn('[OnlineLeaderboards] Invalid score, skipping submission:', entry.score);\n            return false;\n        }\n\n        const board = LEADERBOARDS[boardType];\n        if (!board) {\n            console.warn('[OnlineLeaderboards] Unknown board type:', boardType);\n            return false;\n        }\n\n        const name = sanitizeName(entry.name);\n        const score = Math.floor(entry.score);\n        const seconds = Math.floor(entry.time || 0);\n\n        // Extra data: floor|character|date (pipe-delimited)\n        const text = `${entry.floor || 1}|${entry.character || 'unknown'}|${entry.date || ''}`;\n\n        // Dreamlo add URL format: /lb/{privateKey}/add/{name}/{score}/{seconds}/{text}\n        const path = `/${board.privateKey}/add/${encodeURIComponent(name)}/${score}/${seconds}/${encodeURIComponent(text)}`;\n        const url = buildProxiedUrl(path);\n\n        console.log(`[OnlineLeaderboards] Submitting score to ${boardType}:`, { name, score, floor: entry.floor });\n\n        const response = await fetchWithTimeout(url);\n\n        if (response.ok) {\n            console.log(`[OnlineLeaderboards] Score submitted to ${boardType} successfully`);\n            // Invalidate cache for this board on successful submission\n            leaderboardCaches[boardType].data = null;\n            leaderboardCaches[boardType].timestamp = 0;\n            return true;\n        } else {\n            console.warn('[OnlineLeaderboards] Submission failed with status:', response.status);\n            return false;\n        }\n    } catch (error) {\n        if (error.name === 'AbortError') {\n            console.warn('[OnlineLeaderboards] Submission timed out');\n        } else {\n            console.warn('[OnlineLeaderboards] Submission error:', error.message);\n        }\n        return false;\n    }\n}\n\n/**\n * Submit score to daily leaderboard (convenience wrapper)\n * @param {Object} entry - Score entry (same format as submitOnlineScore)\n * @returns {Promise<boolean>} - Whether submission succeeded\n */\nexport async function submitDailyScore(entry) {\n    return submitOnlineScore(entry, 'daily');\n}\n\n/**\n * Parse Dreamlo entry into standard format\n * @param {Object} entry - Raw Dreamlo entry\n * @returns {Object} - Parsed entry\n */\nfunction parseEntry(entry) {\n    // Parse text field: \"floor|character|date\"\n    const textParts = (entry.text || '').split('|');\n\n    return {\n        name: entry.name || 'Anonymous',\n        score: parseInt(entry.score, 10) || 0,\n        time: parseInt(entry.seconds, 10) || 0,\n        floor: parseInt(textParts[0], 10) || 1,\n        character: textParts[1] || 'survivor',\n        date: textParts[2] || ''\n    };\n}\n\n/**\n * Get online leaderboard\n * @param {number} limit - Max entries to return\n * @param {string} boardType - Which board to fetch ('allTime' or 'daily')\n * @returns {Promise<Object>} - { entries: [], totalCount: number, error: string|null }\n */\nexport async function getOnlineLeaderboard(limit = 10, boardType = 'allTime') {\n    try {\n        const board = LEADERBOARDS[boardType];\n        if (!board) {\n            console.warn('[OnlineLeaderboards] Unknown board type:', boardType);\n            return { entries: [], totalCount: 0, error: 'Unknown board type' };\n        }\n\n        const cache = leaderboardCaches[boardType];\n\n        // Check cache first\n        const now = Date.now();\n        if (cache.data && (now - cache.timestamp) < CACHE_DURATION_MS) {\n            console.log(`[OnlineLeaderboards] Using cached ${boardType} leaderboard`);\n            return {\n                entries: cache.data.slice(0, limit),\n                totalCount: cache.data.length,\n                error: null\n            };\n        }\n\n        // Dreamlo JSON URL: /lb/{publicKey}/json\n        const url = buildProxiedUrl(`/${board.publicKey}/json`);\n\n        console.log(`[OnlineLeaderboards] Fetching ${boardType} leaderboard...`);\n\n        const response = await fetchWithTimeout(url);\n\n        if (!response.ok) {\n            throw new Error(`HTTP ${response.status}`);\n        }\n\n        const data = await response.json();\n\n        // Parse Dreamlo response format\n        // Format: { dreamlo: { leaderboard: { entry: [...] or entry: {} for single } } }\n        let entries = [];\n\n        if (data?.dreamlo?.leaderboard?.entry) {\n            const rawEntries = data.dreamlo.leaderboard.entry;\n            // Handle single entry (object) vs multiple (array)\n            if (Array.isArray(rawEntries)) {\n                entries = rawEntries.map(parseEntry);\n            } else {\n                entries = [parseEntry(rawEntries)];\n            }\n        }\n\n        // Update cache\n        cache.data = entries;\n        cache.timestamp = now;\n\n        console.log(`[OnlineLeaderboards] Fetched ${entries.length} entries from ${boardType}`);\n\n        return {\n            entries: entries.slice(0, limit),\n            totalCount: entries.length,\n            error: null\n        };\n    } catch (error) {\n        if (error.name === 'AbortError') {\n            console.warn('[OnlineLeaderboards] Fetch timed out');\n            return { entries: [], totalCount: 0, error: 'Connection timed out' };\n        }\n        console.warn('[OnlineLeaderboards] Fetch error:', error.message);\n        return { entries: [], totalCount: 0, error: 'Could not connect to server' };\n    }\n}\n\n/**\n * Get daily online leaderboard filtered by today's date\n * @param {number} limit - Max entries to return\n * @param {string} todayDate - Today's date string (YYYY-MM-DD) for filtering\n * @returns {Promise<Object>} - { entries: [], totalCount: number, error: string|null }\n */\nexport async function getDailyOnlineLeaderboard(limit = 10, todayDate) {\n    // Fetch all entries from daily board\n    const result = await getOnlineLeaderboard(1000, 'daily');\n\n    if (result.error) {\n        return result;\n    }\n\n    // Filter entries to only show today's date\n    const todayEntries = result.entries.filter(entry => entry.date === todayDate);\n\n    return {\n        entries: todayEntries.slice(0, limit),\n        totalCount: todayEntries.length,\n        error: null\n    };\n}\n\n/**\n * Get player's global rank and total players\n * @param {string} playerName - Player name to find\n * @param {number} playerScore - Player's score (for comparison if not in top entries)\n * @returns {Promise<Object>} - { rank: number|null, total: number, error: string|null }\n */\nexport async function getGlobalRank(playerName, playerScore) {\n    try {\n        const result = await getOnlineLeaderboard(1000); // Get more entries for accurate rank\n\n        if (result.error) {\n            return { rank: null, total: 0, error: result.error };\n        }\n\n        const sanitizedName = sanitizeName(playerName);\n\n        // Find player in entries\n        const playerIndex = result.entries.findIndex(e =>\n            e.name.toLowerCase() === sanitizedName.toLowerCase()\n        );\n\n        if (playerIndex >= 0) {\n            return {\n                rank: playerIndex + 1,\n                total: result.totalCount,\n                error: null\n            };\n        }\n\n        // Player not found in leaderboard - estimate rank based on score\n        // Count how many scores are higher than player's score\n        const higherScores = result.entries.filter(e => e.score > playerScore).length;\n\n        return {\n            rank: higherScores + 1,\n            total: result.totalCount + 1, // +1 to include the player\n            error: null\n        };\n    } catch (error) {\n        console.warn('[OnlineLeaderboards] Error getting rank:', error.message);\n        return { rank: null, total: 0, error: 'Could not determine rank' };\n    }\n}\n\n/**\n * Clear the leaderboard cache (useful after submission)\n * @param {string} boardType - Optional board type to clear ('allTime' or 'daily'), clears all if not specified\n */\nexport function clearCache(boardType = null) {\n    if (boardType && leaderboardCaches[boardType]) {\n        leaderboardCaches[boardType].data = null;\n        leaderboardCaches[boardType].timestamp = 0;\n    } else {\n        // Clear all caches\n        Object.keys(leaderboardCaches).forEach(key => {\n            leaderboardCaches[key].data = null;\n            leaderboardCaches[key].timestamp = 0;\n        });\n    }\n}\n\n/**\n * Check if online leaderboards are available (basic connectivity check)\n * @returns {Promise<boolean>}\n */\nexport async function checkOnlineAvailability() {\n    try {\n        const result = await getOnlineLeaderboard(1);\n        return result.error === null;\n    } catch {\n        return false;\n    }\n}\n","/**\n * Leaderboard System\n *\n * Manages local leaderboards for:\n * - Daily runs (per date)\n * - All-time high scores\n * - Personal bests (per character)\n *\n * All data persisted to localStorage.\n */\n\nimport { getTodayDateString } from './dailyRuns.js';\nimport { getPlayerName } from './metaProgression.js';\nimport { submitOnlineScore } from './onlineLeaderboards.js';\n\nconst STORAGE_KEY = 'superSmashTextyLeaderboards';\nconst MAX_DAILY_ENTRIES = 100;\nconst MAX_ALLTIME_ENTRIES = 100;\n\n/**\n * Get all leaderboard data\n * @returns {Object} - Leaderboard data structure\n */\nexport function getLeaderboards() {\n    try {\n        const data = localStorage.getItem(STORAGE_KEY);\n        const parsed = data ? JSON.parse(data) : null;\n\n        // Ensure proper structure\n        return {\n            daily: parsed?.daily || {},      // { \"2026-01-18\": [{ name, score, floor, character, time }] }\n            allTime: parsed?.allTime || [],  // [{ name, score, floor, character, date }]\n            personal: parsed?.personal || {} // { character: { bestFloor, bestScore, bestTime } }\n        };\n    } catch (e) {\n        console.warn('[Leaderboards] Failed to load leaderboards:', e);\n        return { daily: {}, allTime: [], personal: {} };\n    }\n}\n\n/**\n * Save leaderboard data\n * @param {Object} data - Data to save\n */\nfunction saveLeaderboards(data) {\n    try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n    } catch (e) {\n        console.warn('[Leaderboards] Failed to save leaderboards:', e);\n    }\n}\n\n/**\n * Calculate score from run stats\n * @param {Object} stats - Run statistics\n * @param {number} stats.floorsReached - Number of floors cleared\n * @param {number} stats.enemiesKilled - Total enemies killed\n * @param {number} stats.bossesKilled - Total bosses killed\n * @param {number} stats.duration - Run duration in seconds\n * @returns {number} - Calculated score\n */\nexport function calculateScore(stats) {\n    const floorScore = (stats.floorsReached || 1) * 1000;\n    const enemyScore = (stats.enemiesKilled || 0) * 10;\n    const bossScore = (stats.bossesKilled || 0) * 500;\n\n    // Time bonus: Max 30000 points, decreases by 50 per second\n    const duration = stats.duration || 0;\n    const timeBonus = Math.max(0, 30000 - Math.floor(duration * 50));\n\n    return floorScore + enemyScore + bossScore + timeBonus;\n}\n\n/**\n * Submit a score to leaderboards\n * @param {Object} runData - Run data to submit\n * @param {number} runData.score - Final score\n * @param {number} runData.floor - Floor reached\n * @param {string} runData.character - Character used\n * @param {number} runData.time - Run duration in seconds\n * @param {boolean} runData.isDaily - Whether this is a daily run\n * @param {string} runData.date - Date of the run (YYYY-MM-DD)\n * @returns {Object} - Result { rank, isNewBest, dailyRank }\n */\nexport function submitScore(runData) {\n    const data = getLeaderboards();\n    const playerName = getPlayerName() || 'Anonymous';\n    const date = runData.date || getTodayDateString();\n\n    const entry = {\n        name: playerName,\n        score: runData.score || 0,\n        floor: runData.floor || 1,\n        character: runData.character || 'survivor',\n        time: runData.time || 0,\n        date: date,\n        timestamp: Date.now()\n    };\n\n    let result = {\n        rank: null,\n        isNewBest: false,\n        dailyRank: null,\n        isNewPersonalBest: false\n    };\n\n    // Add to daily leaderboard if it's a daily run\n    if (runData.isDaily) {\n        if (!data.daily[date]) {\n            data.daily[date] = [];\n        }\n\n        data.daily[date].push(entry);\n        data.daily[date].sort((a, b) => b.score - a.score);\n\n        // Trim to max entries\n        if (data.daily[date].length > MAX_DAILY_ENTRIES) {\n            data.daily[date] = data.daily[date].slice(0, MAX_DAILY_ENTRIES);\n        }\n\n        // Find rank (1-indexed)\n        result.dailyRank = data.daily[date].findIndex(e =>\n            e.timestamp === entry.timestamp && e.name === entry.name\n        ) + 1;\n\n        if (result.dailyRank === 0 || result.dailyRank > MAX_DAILY_ENTRIES) {\n            result.dailyRank = null;\n        }\n    }\n\n    // Add to all-time leaderboard\n    data.allTime.push(entry);\n    data.allTime.sort((a, b) => b.score - a.score);\n\n    // Trim to max entries\n    if (data.allTime.length > MAX_ALLTIME_ENTRIES) {\n        data.allTime = data.allTime.slice(0, MAX_ALLTIME_ENTRIES);\n    }\n\n    // Find all-time rank (1-indexed)\n    result.rank = data.allTime.findIndex(e =>\n        e.timestamp === entry.timestamp && e.name === entry.name\n    ) + 1;\n\n    if (result.rank === 0 || result.rank > MAX_ALLTIME_ENTRIES) {\n        result.rank = null;\n    }\n\n    // Update personal bests\n    const char = entry.character;\n    if (!data.personal[char]) {\n        data.personal[char] = {\n            bestScore: 0,\n            bestFloor: 0,\n            bestTime: Infinity\n        };\n    }\n\n    const personal = data.personal[char];\n\n    if (entry.score > personal.bestScore) {\n        personal.bestScore = entry.score;\n        result.isNewBest = true;\n        result.isNewPersonalBest = true;\n    }\n\n    if (entry.floor > personal.bestFloor) {\n        personal.bestFloor = entry.floor;\n        result.isNewPersonalBest = true;\n    }\n\n    // Best time only counts if they reached a minimum floor\n    if (entry.floor >= 3 && entry.time < personal.bestTime) {\n        personal.bestTime = entry.time;\n        result.isNewPersonalBest = true;\n    }\n\n    saveLeaderboards(data);\n\n    console.log('[Leaderboards] Score submitted:', entry, 'Result:', result);\n\n    // Submit to online leaderboard (non-blocking, fire and forget)\n    submitOnlineScore(entry).catch(err => {\n        console.warn('[Leaderboards] Online submission failed:', err);\n    });\n\n    return result;\n}\n\n/**\n * Get daily leaderboard for a specific date\n * @param {string} date - Date string (YYYY-MM-DD)\n * @param {number} limit - Max entries to return\n * @returns {Array} - Sorted leaderboard entries\n */\nexport function getDailyLeaderboard(date = null, limit = 10) {\n    const data = getLeaderboards();\n    const targetDate = date || getTodayDateString();\n    const entries = data.daily[targetDate] || [];\n\n    return entries.slice(0, limit);\n}\n\n/**\n * Get all-time leaderboard\n * @param {number} limit - Max entries to return\n * @returns {Array} - Sorted leaderboard entries\n */\nexport function getAllTimeLeaderboard(limit = 10) {\n    const data = getLeaderboards();\n    return data.allTime.slice(0, limit);\n}\n\n/**\n * Get personal bests\n * @returns {Object} - Personal bests by character\n */\nexport function getPersonalBests() {\n    const data = getLeaderboards();\n    return data.personal;\n}\n\n/**\n * Get personal best for a specific character\n * @param {string} character - Character key\n * @returns {Object|null} - Personal best data or null\n */\nexport function getCharacterPersonalBest(character) {\n    const data = getLeaderboards();\n    return data.personal[character] || null;\n}\n\n/**\n * Get player's rank in a daily leaderboard\n * @param {string} date - Date string\n * @returns {number|null} - Player's rank or null if not found\n */\nexport function getPlayerDailyRank(date = null) {\n    const targetDate = date || getTodayDateString();\n    const playerName = getPlayerName() || 'Anonymous';\n    const leaderboard = getDailyLeaderboard(targetDate, 100);\n\n    const index = leaderboard.findIndex(e => e.name === playerName);\n    return index >= 0 ? index + 1 : null;\n}\n\n/**\n * Get player's all-time rank\n * @returns {number|null} - Player's rank or null if not found\n */\nexport function getPlayerAllTimeRank() {\n    const playerName = getPlayerName() || 'Anonymous';\n    const leaderboard = getAllTimeLeaderboard(100);\n\n    const index = leaderboard.findIndex(e => e.name === playerName);\n    return index >= 0 ? index + 1 : null;\n}\n\n/**\n * Get player's best score entry in all-time leaderboard\n * @returns {Object|null} - Best entry or null\n */\nexport function getPlayerBestEntry() {\n    const playerName = getPlayerName() || 'Anonymous';\n    const leaderboard = getAllTimeLeaderboard(100);\n\n    return leaderboard.find(e => e.name === playerName) || null;\n}\n\n/**\n * Format time for display\n * @param {number} seconds - Duration in seconds\n * @returns {string} - Formatted time (MM:SS)\n */\nexport function formatTime(seconds) {\n    if (seconds === Infinity || seconds === undefined || seconds === null) {\n        return '--:--';\n    }\n\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n}\n\n/**\n * Format score for display\n * @param {number} score - Score value\n * @returns {string} - Formatted score with commas\n */\nexport function formatScore(score) {\n    return (score || 0).toLocaleString();\n}\n\n/**\n * Clean up old daily leaderboards (keep last 30 days)\n */\nexport function cleanupOldLeaderboards() {\n    const data = getLeaderboards();\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - 30);\n    const cutoffStr = cutoffDate.toISOString().split('T')[0];\n\n    let cleaned = false;\n\n    for (const date of Object.keys(data.daily)) {\n        if (date < cutoffStr) {\n            delete data.daily[date];\n            cleaned = true;\n        }\n    }\n\n    if (cleaned) {\n        saveLeaderboards(data);\n        console.log('[Leaderboards] Cleaned up old daily leaderboards');\n    }\n}\n\n/**\n * Get recent high scores (last 7 days)\n * @param {number} limit - Max entries per day\n * @returns {Array} - Array of { date, entries }\n */\nexport function getRecentHighScores(limit = 3) {\n    const data = getLeaderboards();\n    const today = new Date();\n    const results = [];\n\n    for (let i = 0; i < 7; i++) {\n        const date = new Date(today);\n        date.setDate(date.getDate() - i);\n        const dateStr = date.toISOString().split('T')[0];\n\n        if (data.daily[dateStr] && data.daily[dateStr].length > 0) {\n            results.push({\n                date: dateStr,\n                entries: data.daily[dateStr].slice(0, limit)\n            });\n        }\n    }\n\n    return results;\n}\n","/**\n * Reusable UI Component Factories\n *\n * Centralized component creation for consistent UI across all game scenes\n */\n\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_SPACING,\n    UI_Z_LAYERS,\n    formatButtonText\n} from './uiConfig.js';\nimport { playMenuNav, playMenuSelect } from '../systems/sounds.js';\n\n// =============================================================================\n// BUTTON COMPONENT\n// =============================================================================\n\n/**\n * Create a standardized button with hover states\n * @param {Object} k - Kaplay instance\n * @param {Object} options - Configuration options\n * @param {string} options.text - Button text\n * @param {string} options.size - Button size: 'XS', 'SM', 'MD', 'LG', 'XL'\n * @param {string} options.variant - Color variant: 'primary', 'secondary', 'danger', 'neutral', 'gold'\n * @param {number} options.x - X position\n * @param {number} options.y - Y position\n * @param {Function} options.onClick - Click handler\n * @param {boolean} options.disabled - Whether button is disabled\n * @returns {Object} - Button object with bg, label, and control methods\n */\nexport function createButton(k, options = {}) {\n    const {\n        text = 'Button',\n        size = 'MD',\n        variant = 'secondary',\n        x = 0,\n        y = 0,\n        onClick = null,\n        disabled = false\n    } = options;\n\n    // Get dimensions from size\n    const dimensions = UI_SIZES.BUTTON[size] || UI_SIZES.BUTTON.MD;\n    const { width, height } = dimensions;\n\n    // Get colors from variant\n    const variantColors = {\n        primary: { bg: UI_COLORS.PRIMARY, hover: UI_COLORS.PRIMARY_HOVER },\n        secondary: { bg: UI_COLORS.SECONDARY, hover: UI_COLORS.SECONDARY_HOVER },\n        danger: { bg: UI_COLORS.DANGER, hover: UI_COLORS.DANGER_HOVER },\n        neutral: { bg: UI_COLORS.NEUTRAL, hover: UI_COLORS.NEUTRAL_HOVER },\n        gold: { bg: UI_COLORS.GOLD, hover: UI_COLORS.GOLD_HOVER },\n        tertiary: { bg: UI_COLORS.TERTIARY, hover: UI_COLORS.TERTIARY_HOVER }\n    };\n\n    const colors = variantColors[variant] || variantColors.secondary;\n\n    // Text size based on button size\n    const textSizes = {\n        XS: UI_TEXT_SIZES.TINY,\n        SM: UI_TEXT_SIZES.SMALL,\n        MD: UI_TEXT_SIZES.BODY,\n        LG: UI_TEXT_SIZES.H2,\n        XL: UI_TEXT_SIZES.H1\n    };\n    const textSize = textSizes[size] || UI_TEXT_SIZES.BODY;\n\n    // Create button background\n    const bg = k.add([\n        k.rect(width, height),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...(disabled ? UI_COLORS.BG_DISABLED : colors.bg)),\n        k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n        k.area(),\n        k.fixed(),\n        k.scale(1),\n        k.z(UI_Z_LAYERS.UI_ELEMENTS),\n        'uiButton'\n    ]);\n\n    // Create button label\n    const label = k.add([\n        k.text(formatButtonText(text), { size: textSize }),\n        k.pos(x, y),\n        k.anchor('center'),\n        k.color(...(disabled ? UI_COLORS.TEXT_DISABLED : UI_COLORS.TEXT_PRIMARY)),\n        k.fixed(),\n        k.scale(1),\n        k.z(UI_Z_LAYERS.UI_TEXT),\n        'uiButtonText'\n    ]);\n\n    // Store state on bg\n    bg.isHovered = false;\n    bg.isDisabled = disabled;\n    bg.originalColor = [...colors.bg];\n    bg.hoverColor = [...colors.hover];\n    bg.label = label;\n\n    // Hover effects\n    bg.onHoverUpdate(() => {\n        if (bg.isDisabled) return;\n        if (!bg.isHovered) {\n            bg.isHovered = true;\n            playMenuNav();\n        }\n        bg.color = k.rgb(...bg.hoverColor);\n        bg.outline.color = k.rgb(...UI_COLORS.BORDER_HOVER);\n        bg.scale = k.vec2(1.02, 1.02);\n        label.scale = k.vec2(1.02, 1.02);\n    });\n\n    bg.onHoverEnd(() => {\n        if (bg.isDisabled) return;\n        bg.isHovered = false;\n        bg.color = k.rgb(...bg.originalColor);\n        bg.outline.color = k.rgb(...UI_COLORS.BORDER);\n        bg.scale = k.vec2(1, 1);\n        label.scale = k.vec2(1, 1);\n    });\n\n    // Click handler\n    if (onClick) {\n        bg.onClick(() => {\n            if (bg.isDisabled) return;\n            playMenuSelect();\n            onClick();\n        });\n    }\n\n    // Methods\n    const setDisabled = (isDisabled) => {\n        bg.isDisabled = isDisabled;\n        if (isDisabled) {\n            bg.color = k.rgb(...UI_COLORS.BG_DISABLED);\n            label.color = k.rgb(...UI_COLORS.TEXT_DISABLED);\n        } else {\n            bg.color = k.rgb(...bg.originalColor);\n            label.color = k.rgb(...UI_COLORS.TEXT_PRIMARY);\n        }\n    };\n\n    const setText = (newText) => {\n        label.text = formatButtonText(newText);\n    };\n\n    const destroy = () => {\n        if (bg.exists()) k.destroy(bg);\n        if (label.exists()) k.destroy(label);\n    };\n\n    return {\n        bg,\n        label,\n        setDisabled,\n        setText,\n        destroy\n    };\n}\n\n// =============================================================================\n// CARD COMPONENT\n// =============================================================================\n\n/**\n * Create a styled card container\n * @param {Object} k - Kaplay instance\n * @param {Object} options - Configuration options\n * @param {string} options.size - Card size: 'FULL', 'HALF', 'ICON'\n * @param {number} options.x - X position\n * @param {number} options.y - Y position\n * @param {string} options.title - Optional card title\n * @param {string} options.status - Optional status: 'default', 'success', 'warning', 'error', 'selected'\n * @returns {Object} - Card object with elements and content area info\n */\nexport function createCard(k, options = {}) {\n    const {\n        size = 'FULL',\n        x = 0,\n        y = 0,\n        title = null,\n        status = 'default'\n    } = options;\n\n    // Get dimensions from size\n    const dimensions = UI_SIZES.CARD[size] || UI_SIZES.CARD.FULL;\n    const { width, height } = dimensions;\n\n    // Get border color from status\n    const statusColors = {\n        default: UI_COLORS.BORDER,\n        success: UI_COLORS.SUCCESS,\n        warning: UI_COLORS.WARNING,\n        error: UI_COLORS.ERROR,\n        selected: UI_COLORS.BORDER_ACTIVE\n    };\n    const borderColor = statusColors[status] || statusColors.default;\n\n    // Background color\n    const bgColor = status === 'selected' ? UI_COLORS.BG_LIGHT : UI_COLORS.BG_MEDIUM;\n\n    const elements = [];\n\n    // Card background\n    const bg = k.add([\n        k.rect(width, height),\n        k.pos(x, y),\n        k.anchor('topleft'),\n        k.color(...bgColor),\n        k.outline(2, k.rgb(...borderColor)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n    ]);\n    elements.push(bg);\n\n    // Title if provided\n    let titleElement = null;\n    let contentStartY = y + UI_SPACING.SM;\n\n    if (title) {\n        titleElement = k.add([\n            k.text(title, { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(x + UI_SPACING.SM, y + UI_SPACING.SM),\n            k.anchor('topleft'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n        elements.push(titleElement);\n        contentStartY = y + UI_SPACING.SM + UI_TEXT_SIZES.SMALL + UI_SPACING.XS;\n    }\n\n    // Methods\n    const setStatus = (newStatus) => {\n        const newBorderColor = statusColors[newStatus] || statusColors.default;\n        const newBgColor = newStatus === 'selected' ? UI_COLORS.BG_LIGHT : UI_COLORS.BG_MEDIUM;\n        bg.color = k.rgb(...newBgColor);\n        bg.outline.color = k.rgb(...newBorderColor);\n    };\n\n    const destroy = () => {\n        elements.forEach(el => {\n            if (el.exists()) k.destroy(el);\n        });\n    };\n\n    return {\n        bg,\n        title: titleElement,\n        elements,\n        contentArea: {\n            x: x + UI_SPACING.SM,\n            y: contentStartY,\n            width: width - UI_SPACING.SM * 2,\n            height: height - (contentStartY - y) - UI_SPACING.SM\n        },\n        setStatus,\n        destroy\n    };\n}\n\n// =============================================================================\n// TAB SYSTEM COMPONENT\n// =============================================================================\n\n/**\n * Create a tab navigation system\n * @param {Object} k - Kaplay instance\n * @param {Object} options - Configuration options\n * @param {Array} options.tabs - Array of { key, label } objects\n * @param {string} options.activeTab - Currently active tab key\n * @param {number} options.y - Y position\n * @param {Function} options.onSelect - Callback when tab is selected\n * @returns {Object} - Tab system object with elements and control methods\n */\nexport function createTabs(k, options = {}) {\n    const {\n        tabs = [],\n        activeTab = tabs[0]?.key,\n        y = 80,\n        onSelect = null\n    } = options;\n\n    const tabWidth = 85;\n    const tabHeight = 30;\n    const tabSpacing = 95;\n\n    // Calculate centered positions\n    const totalWidth = (tabs.length - 1) * tabSpacing;\n    const firstTabX = k.width() / 2 - totalWidth / 2;\n\n    const elements = [];\n    const tabElements = [];\n\n    tabs.forEach((tab, index) => {\n        const tabX = firstTabX + index * tabSpacing;\n        const isActive = activeTab === tab.key;\n\n        const tabBg = k.add([\n            k.rect(tabWidth, tabHeight),\n            k.pos(tabX, y),\n            k.anchor('center'),\n            k.color(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM)),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n\n        const tabLabel = k.add([\n            k.text(tab.label, { size: UI_TEXT_SIZES.BODY }),\n            k.pos(tabX, y),\n            k.anchor('center'),\n            k.color(...(isActive ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_TERTIARY)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        tabBg.onClick(() => {\n            playMenuNav();\n            if (onSelect) {\n                onSelect(tab.key);\n            }\n        });\n\n        elements.push(tabBg, tabLabel);\n        tabElements.push({ bg: tabBg, label: tabLabel, key: tab.key });\n    });\n\n    // Update active tab visually\n    const setActiveTab = (newActiveKey) => {\n        tabElements.forEach(tab => {\n            const isActive = tab.key === newActiveKey;\n            tab.bg.color = k.rgb(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM));\n            tab.label.color = k.rgb(...(isActive ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_TERTIARY));\n        });\n    };\n\n    const destroy = () => {\n        elements.forEach(el => {\n            if (el.exists()) k.destroy(el);\n        });\n    };\n\n    return {\n        elements,\n        tabElements,\n        setActiveTab,\n        destroy\n    };\n}\n\n// =============================================================================\n// MODAL COMPONENT\n// =============================================================================\n\n/**\n * Create a modal dialog\n * @param {Object} k - Kaplay instance\n * @param {Object} options - Configuration options\n * @param {string} options.title - Modal title\n * @param {string} options.content - Modal content text\n * @param {Array} options.buttons - Array of { text, variant, onClick } objects\n * @returns {Object} - Modal object with elements and close method\n */\nexport function createModal(k, options = {}) {\n    const {\n        title = 'Modal',\n        content = '',\n        buttons = [{ text: 'OK', variant: 'primary', onClick: null }]\n    } = options;\n\n    const modalWidth = 400;\n    const modalHeight = 200;\n    const elements = [];\n\n    // Overlay background\n    const overlay = k.add([\n        k.rect(k.width(), k.height()),\n        k.pos(0, 0),\n        k.color(0, 0, 0),\n        k.opacity(0.7),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL - 1)\n    ]);\n    elements.push(overlay);\n\n    // Modal background\n    const bg = k.add([\n        k.rect(modalWidth, modalHeight),\n        k.pos(k.width() / 2, k.height() / 2),\n        k.anchor('center'),\n        k.color(...UI_COLORS.BG_MEDIUM),\n        k.outline(3, k.rgb(...UI_COLORS.BORDER)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL)\n    ]);\n    elements.push(bg);\n\n    // Title\n    const titleEl = k.add([\n        k.text(title, { size: UI_TEXT_SIZES.H2 }),\n        k.pos(k.width() / 2, k.height() / 2 - 60),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_PRIMARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 1)\n    ]);\n    elements.push(titleEl);\n\n    // Content\n    const contentEl = k.add([\n        k.text(content, { size: UI_TEXT_SIZES.SMALL, width: modalWidth - 40 }),\n        k.pos(k.width() / 2, k.height() / 2 - 10),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_SECONDARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.MODAL + 1)\n    ]);\n    elements.push(contentEl);\n\n    // Buttons\n    const buttonY = k.height() / 2 + 50;\n    const buttonSpacing = 120;\n    const startX = k.width() / 2 - ((buttons.length - 1) * buttonSpacing) / 2;\n\n    buttons.forEach((btn, index) => {\n        const buttonX = startX + index * buttonSpacing;\n        const button = createButton(k, {\n            text: btn.text,\n            size: 'SM',\n            variant: btn.variant || 'secondary',\n            x: buttonX,\n            y: buttonY,\n            onClick: () => {\n                if (btn.onClick) btn.onClick();\n                close();\n            }\n        });\n        elements.push(button.bg, button.label);\n    });\n\n    // Close method\n    const close = () => {\n        elements.forEach(el => {\n            if (el && el.exists && el.exists()) {\n                k.destroy(el);\n            }\n        });\n    };\n\n    // Allow clicking overlay to close\n    overlay.onClick(close);\n\n    // Escape to close\n    const escHandler = k.onKeyPress('escape', () => {\n        close();\n        escHandler.cancel();\n    });\n\n    return {\n        elements,\n        close\n    };\n}\n\n// =============================================================================\n// STAT BAR COMPONENT (for character stats display)\n// =============================================================================\n\n/**\n * Get color based on percentage (red at 0%, yellow at 50%, green at 100%)\n * @param {number} percent - Value from 0 to 1\n * @returns {Array} RGB color array\n */\nfunction getPercentageColor(percent) {\n    // Clamp to 0-1\n    percent = Math.max(0, Math.min(1, percent));\n\n    if (percent < 0.5) {\n        // Red to Yellow (0% to 50%)\n        const t = percent * 2; // 0 to 1\n        return [255, Math.round(200 * t), 50];\n    } else {\n        // Yellow to Green (50% to 100%)\n        const t = (percent - 0.5) * 2; // 0 to 1\n        return [Math.round(255 * (1 - t)), 200 + Math.round(55 * t), 50 + Math.round(100 * t)];\n    }\n}\n\n/**\n * Create a labeled stat bar\n * @param {Object} k - Kaplay instance\n * @param {Object} options - Configuration options\n * @param {string} options.label - Stat label\n * @param {number} options.value - Current value\n * @param {number} options.maxValue - Maximum value for the bar\n * @param {number} options.x - X position\n * @param {number} options.y - Y position\n * @param {number} options.width - Bar width\n * @param {Array} options.color - Fill color (ignored if usePercentageColor is true)\n * @param {boolean} options.usePercentageColor - If true, color bar based on fill % (red=low, green=high)\n * @returns {Object} - Object with elements and update method\n */\nexport function createStatBar(k, options = {}) {\n    const {\n        label = '',\n        value = 0,\n        maxValue = 100,\n        x = 0,\n        y = 0,\n        width = 80,\n        color = UI_COLORS.PRIMARY,\n        usePercentageColor = false\n    } = options;\n\n    const elements = [];\n    const barHeight = 6;\n\n    // Calculate fill color\n    const percent = value / maxValue;\n    const fillColor = usePercentageColor ? getPercentageColor(percent) : color;\n\n    // Label\n    const labelEl = k.add([\n        k.text(label, { size: UI_TEXT_SIZES.TINY }),\n        k.pos(x, y),\n        k.anchor('topleft'),\n        k.color(...UI_COLORS.TEXT_SECONDARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_TEXT)\n    ]);\n    elements.push(labelEl);\n\n    // Bar background\n    const barBg = k.add([\n        k.rect(width, barHeight),\n        k.pos(x, y + 14),\n        k.anchor('topleft'),\n        k.color(...UI_COLORS.BG_DARK),\n        k.outline(1, k.rgb(50, 50, 60)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n    ]);\n    elements.push(barBg);\n\n    // Bar fill\n    const fillWidth = Math.max(0, (width - 2) * percent);\n    const barFill = k.add([\n        k.rect(fillWidth, barHeight - 2),\n        k.pos(x + 1, y + 15),\n        k.anchor('topleft'),\n        k.color(...fillColor),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\n    ]);\n    elements.push(barFill);\n\n    // Value text\n    const valueEl = k.add([\n        k.text(`${value}`, { size: UI_TEXT_SIZES.MICRO }),\n        k.pos(x + width + 4, y + 10),\n        k.anchor('left'),\n        k.color(...UI_COLORS.TEXT_PRIMARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.UI_TEXT)\n    ]);\n    elements.push(valueEl);\n\n    const updateValue = (newValue) => {\n        const clampedValue = Math.max(0, Math.min(maxValue, newValue));\n        const newPercent = clampedValue / maxValue;\n        barFill.width = Math.max(0, (width - 2) * newPercent);\n        valueEl.text = `${clampedValue}`;\n        if (usePercentageColor) {\n            const newColor = getPercentageColor(newPercent);\n            barFill.color = k.rgb(...newColor);\n        }\n    };\n\n    const destroy = () => {\n        elements.forEach(el => {\n            if (el.exists()) k.destroy(el);\n        });\n    };\n\n    return {\n        elements,\n        updateValue,\n        destroy\n    };\n}\n","// Game over scene - TV Station themed with player comparison table and currency animation\nimport { getCurrency, getCurrencyName, getSaveData, getSelectedCharacter, getPlayerName, calculateRunXP, addXP, getPlayerLevel, getXPProgress, getTotalXP, getXPForNextLevel } from '../systems/metaProgression.js';\nimport { playMenuSelect, playMenuNav, stopMusic, playDefeatMusic } from '../systems/sounds.js';\nimport { isMultiplayerActive, isHost } from '../systems/multiplayerGame.js';\nimport { onMessage, offMessage, broadcast } from '../systems/networkSystem.js';\nimport { ENEMY_TYPES } from '../data/enemies.js';\nimport { MINIBOSS_TYPES } from '../data/minibosses.js';\nimport { BOSS_TYPES } from '../data/bosses.js';\nimport { ACHIEVEMENTS, ACHIEVEMENT_COLORS } from '../data/achievements.js';\nimport { getRunUnlockedAchievements } from '../systems/achievementChecker.js';\nimport { showAchievementModal, isAchievementModalOpen } from '../components/achievementModal.js';\nimport { calculateScore, submitScore, formatScore } from '../systems/leaderboards.js';\nimport { getGlobalRank, submitOnlineScore, submitDailyScore } from '../systems/onlineLeaderboards.js';\nimport { markDailyCompleted, getTodayDateString } from '../systems/dailyRuns.js';\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS,\n    UI_TERMS,\n    createProgressBar\n} from '../config/uiConfig.js';\nimport { createButton } from '../config/uiComponents.js';\n\n// Get enemy name from data files, with fallback to type key\nfunction getEnemyName(type) {\n    if (ENEMY_TYPES[type]?.name) return ENEMY_TYPES[type].name;\n    if (MINIBOSS_TYPES[type]?.name) return MINIBOSS_TYPES[type].name;\n    if (BOSS_TYPES[type]?.name) return BOSS_TYPES[type].name;\n    return type;\n}\n\n// Get enemy character for display\nfunction getEnemyChar(type) {\n    return ENEMY_TYPES[type]?.char || MINIBOSS_TYPES[type]?.char || BOSS_TYPES[type]?.char || 'E';\n}\n\n// Get enemy color for display\nfunction getEnemyColor(type) {\n    return ENEMY_TYPES[type]?.color || MINIBOSS_TYPES[type]?.color || BOSS_TYPES[type]?.color || [255, 100, 100];\n}\n\n// Currency icons for variety (gold themed)\nconst CURRENCY_ICONS = ['$', '', '', '', ''];\n\n// Award definitions\nconst AWARDS = [\n    { id: 'slayer', title: 'Slayer', icon: '', desc: 'Most enemy kills', check: (stats) => stats.kills || 0, color: [255, 100, 100] },\n    { id: 'collector', title: 'Hoarder', icon: '', desc: 'Most credits collected', check: (stats) => stats.creditsPickedUp || 0, color: [255, 215, 0] },\n    { id: 'bossBuster', title: 'Boss Buster', icon: '', desc: 'Most bosses defeated', check: (stats) => stats.bossesKilled || 0, color: [255, 150, 50] }\n];\n\nexport function setupGameOverScene(k) {\n    k.scene('gameOver', (args) => {\n        // Stop combat music, play defeat music\n        stopMusic();\n        playDefeatMusic();\n\n        const runStats = args?.runStats || {\n            floorsReached: 1,\n            roomsCleared: 0,\n            enemiesKilled: 0,\n            bossesKilled: 0,\n            killsByType: {}\n        };\n        const currencyEarned = args?.currencyEarned || 0;\n        const totalCurrency = getCurrency();\n        const saveData = getSaveData();\n        const currencyName = getCurrencyName();\n        const partyStats = args?.partyStats || [];\n        const isDailyRun = args?.isDailyRun || false;\n        const dailyCharacter = args?.dailyCharacter || null;\n        // Use the date from when the daily run started, not when it ended (handles midnight boundary)\n        const runDate = args?.dailyDate || getTodayDateString();\n\n        // Calculate duration\n        const duration = runStats.startTime ? (Date.now() - runStats.startTime) / 1000 : 0;\n\n        // Calculate and submit score\n        const score = calculateScore({\n            floorsReached: runStats.floorsReached || 1,\n            enemiesKilled: runStats.enemiesKilled || 0,\n            bossesKilled: runStats.bossesKilled || 0,\n            duration: duration\n        });\n\n        const character = dailyCharacter || getSelectedCharacter() || 'survivor';\n\n        // Submit to local leaderboards\n        const leaderboardResult = submitScore({\n            score: score,\n            floor: runStats.floorsReached || 1,\n            character: character,\n            time: duration,\n            isDaily: isDailyRun,\n            date: runDate\n        });\n\n        // Submit to global online leaderboards (all players submit their own scores)\n        const playerName = getPlayerName() || 'Anonymous';\n        const inMultiplayer = isMultiplayerActive();\n\n        // All players submit to online leaderboards - each player's score matters\n        const onlineScoreEntry = {\n            name: playerName,\n            score: score,\n            floor: runStats.floorsReached || 1,\n            character: character,\n            time: duration,\n            date: runDate\n        };\n\n        // Always submit to global all-time board\n        submitOnlineScore(onlineScoreEntry, 'allTime');\n\n        // Also submit to daily board if this is a daily run\n        if (isDailyRun) {\n            submitDailyScore(onlineScoreEntry);\n        }\n\n        // Mark daily as completed if it was a daily run\n        if (isDailyRun) {\n            markDailyCompleted({\n                score: score,\n                floor: runStats.floorsReached || 1,\n                character: character,\n                duration: duration\n            });\n        }\n\n        // Calculate total credits from all players\n        const totalTeamCredits = partyStats.length > 0\n            ? partyStats.reduce((sum, p) => sum + (p.creditsPickedUp || 0), 0)\n            : currencyEarned;\n\n        // Get achievements unlocked this run\n        const unlockedAchievementIds = getRunUnlockedAchievements();\n\n        // Calculate and award XP for this run\n        const xpEarned = calculateRunXP({\n            floorsReached: runStats.floorsReached || 1,\n            enemiesKilled: runStats.enemiesKilled || 0,\n            bossesKilled: runStats.bossesKilled || 0,\n            isDailyRun: isDailyRun\n        });\n        const xpResult = addXP(xpEarned);\n        const leveledUp = xpResult.levelsGained > 0;\n\n        // Background overlay\n        k.add([\n            k.rect(k.width(), k.height()),\n            k.pos(0, 0),\n            k.anchor('topleft'),\n            k.color(20, 15, 25),\n            k.opacity(0.98),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.OVERLAY)\n        ]);\n\n        // ==========================================\n        // HEADER SECTION - Title, Score, Rankings\n        // ==========================================\n        const headerY = 25;\n\n        // Title\n        k.add([\n            k.text('BROADCAST TERMINATED', { size: 28 }),\n            k.pos(k.width() / 2, headerY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.DANGER),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // Score display - large and centered\n        k.add([\n            k.text(`SCORE: ${formatScore(score)}`, { size: 22 }),\n            k.pos(k.width() / 2, headerY + 32),\n            k.anchor('center'),\n            k.color(...UI_COLORS.GOLD),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // Run summary - compact horizontal\n        k.add([\n            k.text(`Floor ${runStats.floorsReached} | ${runStats.roomsCleared} Rooms | ${runStats.enemiesKilled} Kills | ${Math.floor(duration)}s`, { size: 12 }),\n            k.pos(k.width() / 2, headerY + 54),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // ==========================================\n        // RANKINGS ROW - Below header, above table\n        // ==========================================\n        const rankRowY = headerY + 75;\n\n        // Build rank display strings\n        let localRankText = '';\n        if (isDailyRun && leaderboardResult.dailyRank) {\n            localRankText = `Daily #${leaderboardResult.dailyRank}`;\n            if (leaderboardResult.dailyRank === 1) localRankText += ' NEW RECORD!';\n        } else if (leaderboardResult.rank) {\n            localRankText = `All-Time #${leaderboardResult.rank}`;\n            if (leaderboardResult.isNewBest) localRankText += ' PERSONAL BEST!';\n        }\n\n        if (localRankText) {\n            k.add([\n                k.text(localRankText, { size: 14 }),\n                k.pos(k.width() / 2 - 120, rankRowY),\n                k.anchor('center'),\n                k.color(...(leaderboardResult.isNewBest ? UI_COLORS.SUCCESS : UI_COLORS.TEXT_PRIMARY)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL)\n            ]);\n        }\n\n        // Global rank - fetched async\n        const globalRankLabel = k.add([\n            k.text('Global: ...', { size: 14 }),\n            k.pos(k.width() / 2 + 120, rankRowY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_DISABLED),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        getGlobalRank(playerName, score).then(result => {\n            if (!globalRankLabel.exists()) return;\n            if (result.error) {\n                globalRankLabel.text = 'Global: offline';\n            } else if (result.rank) {\n                globalRankLabel.text = `Global #${result.rank} of ${result.total}`;\n                globalRankLabel.color = k.rgb(...UI_COLORS.GOLD);\n            } else {\n                globalRankLabel.text = 'Global: unranked';\n            }\n        });\n\n        // ==========================================\n        // PLAYER COMPARISON TABLE\n        // ==========================================\n        const tableStartY = rankRowY + 30;\n        const numPlayers = Math.max(partyStats.length, 1);\n\n        // Build player data\n        const playersToShow = partyStats.length > 0 ? partyStats : [{\n            name: playerName,\n            characterData: { char: '@', color: [255, 255, 255] },\n            kills: runStats.enemiesKilled,\n            creditsPickedUp: currencyEarned,\n            bossesKilled: runStats.bossesKilled,\n            achievements: unlockedAchievementIds // For single player, all achievements belong to them\n        }];\n\n        // Calculate awards - for single player, award all qualifying awards\n        // For multiplayer, only the best player for each category gets the award\n        const awardWinners = {};\n        if (playersToShow.length === 1) {\n            // Single player gets all awards they qualify for\n            const player = playersToShow[0];\n            AWARDS.forEach(award => {\n                const value = award.check(player);\n                if (value > 0) {\n                    if (!awardWinners[player.name]) {\n                        awardWinners[player.name] = [];\n                    }\n                    awardWinners[player.name].push(award);\n                }\n            });\n        } else {\n            // Multiplayer: only best player for each award\n            AWARDS.forEach(award => {\n                let bestPlayer = null;\n                let bestValue = 0;\n                playersToShow.forEach(player => {\n                    const value = award.check(player);\n                    if (value > bestValue) {\n                        bestValue = value;\n                        bestPlayer = player;\n                    }\n                });\n                if (bestPlayer && bestValue > 0) {\n                    if (!awardWinners[bestPlayer.name]) {\n                        awardWinners[bestPlayer.name] = [];\n                    }\n                    awardWinners[bestPlayer.name].push(award);\n                }\n            });\n        }\n\n        // Table layout constants - leave room for kill panel on right\n        const killPanelReservedWidth = 210; // 180px panel + 30px gap\n        const tableWidth = Math.min(k.width() - killPanelReservedWidth - 30, 500);\n        const tableX = 20;\n        const colWidth = (tableWidth - 80) / numPlayers; // 80px for label column\n        const rowHeight = 28;\n        const labelColWidth = 80;\n\n        // Table background\n        const tableHeight = rowHeight * 7 + 10; // 7 rows + padding\n        k.add([\n            k.rect(tableWidth, tableHeight),\n            k.pos(tableX, tableStartY),\n            k.color(30, 25, 35),\n            k.outline(2, k.rgb(60, 50, 80)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // Table header row (player names with icons)\n        let currentY = tableStartY + 8;\n\n        // Row labels\n        const rowLabels = ['', 'Kills', 'Credits', 'Bosses', 'Awards', 'Achievements'];\n\n        // Header row - Player icons and names\n        playersToShow.forEach((player, idx) => {\n            const colX = tableX + labelColWidth + idx * colWidth + colWidth / 2;\n\n            // Character icon\n            const charIcon = player.characterData?.char || '@';\n            const charColor = player.characterData?.color || [255, 255, 255];\n\n            k.add([\n                k.text(charIcon, { size: 20 }),\n                k.pos(colX, currentY + 3),\n                k.anchor('center'),\n                k.color(...charColor),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 1)\n            ]);\n\n            // Player name (below icon)\n            const maxNameLen = numPlayers <= 2 ? 16 : (numPlayers === 3 ? 12 : 10);\n            const displayName = (player.name || `P${idx + 1}`).substring(0, maxNameLen);\n            k.add([\n                k.text(displayName, { size: 11 }),\n                k.pos(colX, currentY + 20),\n                k.anchor('center'),\n                k.color(...UI_COLORS.GOLD),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 1)\n            ]);\n        });\n        currentY += rowHeight + 8;\n\n        // Data rows\n        const rowData = [\n            { label: 'Kills', getValue: (p) => p.kills || 0, color: UI_COLORS.DANGER },\n            { label: 'Credits', getValue: (p) => p.creditsPickedUp || 0, color: UI_COLORS.GOLD },\n            { label: 'Bosses', getValue: (p) => p.bossesKilled || 0, color: [255, 150, 50] }\n        ];\n\n        rowData.forEach(row => {\n            // Row label\n            k.add([\n                k.text(row.label, { size: 12 }),\n                k.pos(tableX + 10, currentY),\n                k.anchor('left'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 1)\n            ]);\n\n            // Values for each player\n            playersToShow.forEach((player, idx) => {\n                const colX = tableX + labelColWidth + idx * colWidth + colWidth / 2;\n                const value = row.getValue(player);\n\n                k.add([\n                    k.text(String(value), { size: 14 }),\n                    k.pos(colX, currentY),\n                    k.anchor('center'),\n                    k.color(...row.color),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.MODAL + 1)\n                ]);\n            });\n\n            currentY += rowHeight;\n        });\n\n        // Awards row\n        k.add([\n            k.text('Awards', { size: 12 }),\n            k.pos(tableX + 10, currentY),\n            k.anchor('left'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1)\n        ]);\n\n        // Helper to show award info modal\n        let activeAwardModal = null;\n        function showAwardModal(award, player) {\n            // Remove any existing modal\n            if (activeAwardModal) {\n                activeAwardModal.forEach(e => { if (e.exists()) k.destroy(e); });\n            }\n\n            const modalWidth = 220;\n            const modalHeight = 100;\n            const modalX = k.width() / 2;\n            const modalY = k.height() / 2;\n\n            const elements = [];\n\n            // Modal background\n            elements.push(k.add([\n                k.rect(modalWidth, modalHeight),\n                k.pos(modalX, modalY),\n                k.anchor('center'),\n                k.color(30, 25, 40),\n                k.outline(3, k.rgb(...award.color)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 100)\n            ]));\n\n            // Award icon\n            elements.push(k.add([\n                k.text(award.icon, { size: 28 }),\n                k.pos(modalX, modalY - 28),\n                k.anchor('center'),\n                k.color(...award.color),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 101)\n            ]));\n\n            // Award title\n            elements.push(k.add([\n                k.text(award.title, { size: 16 }),\n                k.pos(modalX, modalY),\n                k.anchor('center'),\n                k.color(255, 255, 255),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 101)\n            ]));\n\n            // Award description\n            elements.push(k.add([\n                k.text(award.desc, { size: 11 }),\n                k.pos(modalX, modalY + 18),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 101)\n            ]));\n\n            // Player who earned it (if applicable)\n            const earnedText = numPlayers > 1 ? `Earned by ${player.name}` : 'Earned this run';\n            elements.push(k.add([\n                k.text(earnedText, { size: 10 }),\n                k.pos(modalX, modalY + 34),\n                k.anchor('center'),\n                k.color(150, 150, 180),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 101)\n            ]));\n\n            activeAwardModal = elements;\n\n            // Close on click anywhere after a short delay\n            k.wait(0.1, () => {\n                const closeHandler = k.onClick(() => {\n                    closeHandler.cancel();\n                    if (activeAwardModal) {\n                        activeAwardModal.forEach(e => { if (e.exists()) k.destroy(e); });\n                        activeAwardModal = null;\n                    }\n                });\n            });\n        }\n\n        playersToShow.forEach((player, idx) => {\n            const colX = tableX + labelColWidth + idx * colWidth + colWidth / 2;\n            const playerAwards = awardWinners[player.name] || [];\n\n            if (playerAwards.length > 0) {\n                // Create individual clickable award icons\n                const iconSize = 22;\n                const iconSpacing = 4;\n                const totalWidth = playerAwards.length * iconSize + (playerAwards.length - 1) * iconSpacing;\n                const startX = colX - totalWidth / 2 + iconSize / 2;\n\n                playerAwards.forEach((award, awardIdx) => {\n                    const awardX = startX + awardIdx * (iconSize + iconSpacing);\n\n                    // Award icon box (clickable)\n                    const awardBox = k.add([\n                        k.rect(iconSize, iconSize),\n                        k.pos(awardX, currentY),\n                        k.anchor('center'),\n                        k.color(40, 35, 50),\n                        k.outline(2, k.rgb(...award.color)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.MODAL + 1)\n                    ]);\n\n                    k.add([\n                        k.text(award.icon, { size: 12 }),\n                        k.pos(awardX, currentY),\n                        k.anchor('center'),\n                        k.color(255, 220, 100),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.MODAL + 2)\n                    ]);\n\n                    awardBox.onClick(() => {\n                        playMenuNav();\n                        showAwardModal(award, player);\n                    });\n                    awardBox.cursor = 'pointer';\n                });\n            } else {\n                k.add([\n                    k.text('-', { size: 14 }),\n                    k.pos(colX, currentY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_DISABLED),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.MODAL + 1)\n                ]);\n            }\n        });\n        currentY += rowHeight;\n\n        // Achievements row - clickable icons\n        k.add([\n            k.text('Unlocks', { size: 12 }),\n            k.pos(tableX + 10, currentY),\n            k.anchor('left'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1)\n        ]);\n\n        playersToShow.forEach((player, idx) => {\n            const colX = tableX + labelColWidth + idx * colWidth + colWidth / 2;\n\n            // For multiplayer, achievements would be per-player\n            // For single player, show all achievements\n            const playerAchievements = player.achievements || (idx === 0 ? unlockedAchievementIds : []);\n\n            if (playerAchievements.length > 0) {\n                const maxIcons = Math.min(playerAchievements.length, 3);\n                const iconSize = 22;\n                const iconSpacing = 4;\n                const totalWidth = maxIcons * iconSize + (maxIcons - 1) * iconSpacing;\n                const startX = colX - totalWidth / 2 + iconSize / 2;\n\n                playerAchievements.slice(0, maxIcons).forEach((achId, achIdx) => {\n                    const achievement = ACHIEVEMENTS[achId];\n                    if (!achievement) return;\n\n                    const achX = startX + achIdx * (iconSize + iconSpacing);\n                    const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\n\n                    // Achievement icon box\n                    const achBox = k.add([\n                        k.rect(iconSize, iconSize),\n                        k.pos(achX, currentY),\n                        k.anchor('center'),\n                        k.color(40, 35, 50),\n                        k.outline(2, k.rgb(...difficultyColor)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.MODAL + 1)\n                    ]);\n\n                    k.add([\n                        k.text(achievement.icon, { size: 12 }),\n                        k.pos(achX, currentY),\n                        k.anchor('center'),\n                        k.color(255, 255, 255),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.MODAL + 2)\n                    ]);\n\n                    achBox.onClick(() => {\n                        playMenuNav();\n                        showAchievementModal(k, achievement);\n                    });\n                    achBox.cursor = 'pointer';\n                });\n\n                // Show +N more if needed\n                if (playerAchievements.length > maxIcons) {\n                    const moreCount = playerAchievements.length - maxIcons;\n                    const moreX = startX + maxIcons * (iconSize + iconSpacing);\n                    k.add([\n                        k.text(`+${moreCount}`, { size: 10 }),\n                        k.pos(moreX, currentY),\n                        k.anchor('left'),\n                        k.color(200, 180, 100),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.MODAL + 1)\n                    ]);\n                }\n            } else {\n                k.add([\n                    k.text('-', { size: 14 }),\n                    k.pos(colX, currentY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_DISABLED),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.MODAL + 1)\n                ]);\n            }\n        });\n\n        // ==========================================\n        // MONEY BUCKET ANIMATION - Below table\n        // ==========================================\n        const bucketSectionY = tableStartY + tableHeight + 15;\n        // Calculate bucket width based on available space and player count\n        // Solo play gets a larger, more prominent bucket\n        const maxBucketWidth = numPlayers === 1 ? 240 : (numPlayers === 2 ? 180 : (numPlayers === 3 ? 140 : 110));\n        const bucketSpacing = 10;\n        // Ensure buckets fit within table width\n        const availableWidth = tableWidth - 20; // 10px padding on each side\n        const calculatedBucketWidth = (availableWidth - (numPlayers - 1) * bucketSpacing) / numPlayers;\n        const bucketWidth = Math.min(maxBucketWidth, calculatedBucketWidth);\n        // Taller bucket for solo play\n        const bucketHeight = numPlayers === 1 ? 100 : 80;\n        const totalBucketsWidth = numPlayers * bucketWidth + (numPlayers - 1) * bucketSpacing;\n        const bucketStartX = tableX + (tableWidth - totalBucketsWidth) / 2 + bucketWidth / 2;\n\n        const playerBuckets = [];\n\n        playersToShow.forEach((player, index) => {\n            const bucketX = bucketStartX + index * (bucketWidth + bucketSpacing);\n            const credits = player.creditsPickedUp || 0;\n\n            // Bucket container\n            k.add([\n                k.rect(bucketWidth - 10, bucketHeight),\n                k.pos(bucketX, bucketSectionY + bucketHeight / 2),\n                k.anchor('center'),\n                k.outline(3, k.rgb(...UI_COLORS.TEXT_DISABLED)),\n                k.color(0, 0, 0),\n                k.opacity(0.5),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL)\n            ]);\n\n            // Currency label below bucket - larger for solo play\n            const labelSize = numPlayers === 1 ? 20 : 16;\n            const currencyLabel = k.add([\n                k.text(`0 ${currencyName}`, { size: labelSize }),\n                k.pos(bucketX, bucketSectionY + bucketHeight + 16),\n                k.anchor('center'),\n                k.color(...UI_COLORS.GOLD),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 10)\n            ]);\n\n            playerBuckets.push({\n                x: bucketX,\n                y: bucketSectionY,\n                width: bucketWidth - 10,\n                height: bucketHeight,\n                credits: credits,\n                label: currencyLabel,\n                particles: [],\n                spawnedCount: 0,\n                displayedCount: 0\n            });\n        });\n\n        // Currency drop animation\n        // Solo play gets more particles for a more impressive display\n        const maxParticlesPerPlayer = numPlayers === 1 ? 50 : 35;\n        const particleSpawnDelay = 0.06;\n        const particleFallSpeed = 280;\n        let animationTimer = 0;\n        const animationStartDelay = 0.5;\n\n        k.onUpdate(() => {\n            animationTimer += k.dt();\n            if (animationTimer < animationStartDelay) return;\n\n            playerBuckets.forEach((bucket, bucketIndex) => {\n                if (bucket.credits <= 0) return;\n\n                const targetParticles = Math.min(bucket.credits, maxParticlesPerPlayer);\n                const particleValue = bucket.credits / targetParticles;\n\n                const spawnTime = (animationTimer - animationStartDelay) - (bucketIndex * 0.12);\n                const targetSpawned = Math.floor(spawnTime / particleSpawnDelay);\n\n                while (bucket.spawnedCount < targetParticles && bucket.spawnedCount < targetSpawned) {\n                    const startX = bucket.x + (Math.random() - 0.5) * (bucket.width - 16);\n                    const startY = bucket.y - 30 - Math.random() * 25;\n                    const icon = CURRENCY_ICONS[Math.floor(Math.random() * CURRENCY_ICONS.length)];\n\n                    const particle = k.add([\n                        k.text(icon, { size: 14 }),\n                        k.pos(startX, startY),\n                        k.anchor('center'),\n                        k.color(255, 215, 0),\n                        k.opacity(1),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.MODAL + 5),\n                        'currencyParticle',\n                        {\n                            velocity: particleFallSpeed + Math.random() * 60,\n                            landed: false,\n                            value: particleValue\n                        }\n                    ]);\n\n                    bucket.particles.push(particle);\n                    bucket.spawnedCount++;\n                }\n\n                // Update particles\n                bucket.particles.forEach(particle => {\n                    if (!particle.exists() || particle.landed) return;\n\n                    particle.pos.y += particle.velocity * k.dt();\n\n                    const bucketBottom = bucket.y + bucket.height - 6;\n                    const stackHeight = bucket.particles.filter(p => p.landed).length * 1.5;\n                    const landingY = bucketBottom - stackHeight;\n\n                    if (particle.pos.y >= landingY) {\n                        particle.pos.y = landingY;\n                        particle.landed = true;\n                        bucket.displayedCount += particle.value;\n                        bucket.label.text = `${Math.floor(bucket.displayedCount)} ${currencyName}`;\n                        particle.opacity = 0.85;\n                    }\n                });\n            });\n        });\n\n        // ==========================================\n        // KILL BREAKDOWN - Right side panel\n        // ==========================================\n        const killPanelX = k.width() - 110;\n        const killPanelY = tableStartY;\n        const killPanelWidth = 180;\n        const killPanelHeight = tableHeight + bucketHeight + 30;\n\n        // Kill panel background\n        k.add([\n            k.rect(killPanelWidth, killPanelHeight),\n            k.pos(killPanelX - killPanelWidth / 2, killPanelY),\n            k.color(25, 20, 30),\n            k.outline(2, k.rgb(50, 40, 60)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // Kill panel title\n        k.add([\n            k.text('STAFF', { size: 14 }),\n            k.pos(killPanelX, killPanelY + 12),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1)\n        ]);\n        k.add([\n            k.text('TERMINATED', { size: 14 }),\n            k.pos(killPanelX, killPanelY + 26),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1)\n        ]);\n\n        // Kill list\n        const killsByType = runStats.killsByType || {};\n        const sortedKills = Object.entries(killsByType)\n            .filter(([_, count]) => count > 0)\n            .sort((a, b) => b[1] - a[1]);\n\n        let killY = killPanelY + 48;\n        const killSpacing = 20;\n        const maxKillsToShow = Math.floor((killPanelHeight - 60) / killSpacing);\n\n        if (sortedKills.length === 0) {\n            k.add([\n                k.text('No staff', { size: 12 }),\n                k.pos(killPanelX, killY + 10),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_DISABLED),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 1)\n            ]);\n            k.add([\n                k.text('harmed', { size: 12 }),\n                k.pos(killPanelX, killY + 24),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_DISABLED),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.MODAL + 1)\n            ]);\n        } else {\n            const showCount = Math.min(sortedKills.length, maxKillsToShow);\n\n            for (let i = 0; i < showCount; i++) {\n                const [type, count] = sortedKills[i];\n                const char = getEnemyChar(type);\n                const color = getEnemyColor(type);\n\n                // Enemy icon\n                k.add([\n                    k.text(char, { size: 14 }),\n                    k.pos(killPanelX - 70, killY),\n                    k.anchor('center'),\n                    k.color(...color),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.MODAL + 1)\n                ]);\n\n                // Enemy name - wider panel allows more characters\n                const name = getEnemyName(type);\n                const shortName = name.length > 14 ? name.substring(0, 12) + '..' : name;\n                k.add([\n                    k.text(shortName, { size: 10 }),\n                    k.pos(killPanelX - 50, killY),\n                    k.anchor('left'),\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.MODAL + 1)\n                ]);\n\n                // Count\n                k.add([\n                    k.text(`x${count}`, { size: 11 }),\n                    k.pos(killPanelX + 70, killY),\n                    k.anchor('right'),\n                    k.color(...UI_COLORS.DANGER),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.MODAL + 1)\n                ]);\n\n                killY += killSpacing;\n            }\n\n            if (sortedKills.length > showCount) {\n                const remaining = sortedKills.slice(showCount).reduce((sum, [_, c]) => sum + c, 0);\n                k.add([\n                    k.text(`+${remaining} more`, { size: 10 }),\n                    k.pos(killPanelX, killY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_DISABLED),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.MODAL + 1)\n                ]);\n            }\n        }\n\n        // ==========================================\n        // FOOTER - Totals and Controls\n        // ==========================================\n        const footerY = k.height() - 90;\n\n        // Team earnings (left side)\n        k.add([\n            k.text(`+${totalTeamCredits} ${currencyName}`, { size: 16 }),\n            k.pos(k.width() / 2 - 100, footerY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.GOLD),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // XP earned (right side)\n        const xpColor = leveledUp ? UI_COLORS.SUCCESS : [150, 200, 255];\n        const xpText = leveledUp\n            ? `+${xpEarned} XP (LEVEL UP!)`\n            : `+${xpEarned} XP`;\n        k.add([\n            k.text(xpText, { size: 16 }),\n            k.pos(k.width() / 2 + 100, footerY),\n            k.anchor('center'),\n            k.color(...xpColor),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // Level and progress bar\n        const currentLevel = getPlayerLevel();\n        const xpProgress = getXPProgress();\n        const currentXP = getTotalXP();\n        const nextLevelXP = getXPForNextLevel();\n\n        k.add([\n            k.text(`Level ${currentLevel}`, { size: 12 }),\n            k.pos(k.width() / 2, footerY + 18),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // XP progress bar\n        const barWidth = 200;\n        const barHeight = 8;\n        const barX = k.width() / 2;\n        const barY = footerY + 32;\n\n        // Bar background\n        k.add([\n            k.rect(barWidth, barHeight),\n            k.pos(barX, barY),\n            k.anchor('center'),\n            k.color(40, 40, 60),\n            k.outline(1, k.rgb(80, 80, 100)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // Bar fill (ensure minimum width of 2 to avoid rendering issues)\n        const xpFillWidth = Math.max(2, barWidth * xpProgress);\n        k.add([\n            k.rect(xpFillWidth, barHeight - 2),\n            k.pos(barX - barWidth / 2 + xpFillWidth / 2 + 1, barY),\n            k.anchor('center'),\n            k.color(100, 180, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL + 1)\n        ]);\n\n        // XP numbers\n        k.add([\n            k.text(`${currentXP} / ${nextLevelXP} XP`, { size: 10 }),\n            k.pos(k.width() / 2, barY + 12),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        // Buttons - centered with proper spacing\n        const isHostPlayer = isHost();\n        const buttonY = k.height() - 30;\n        const { MD, SM } = UI_SIZES.BUTTON;\n        const buttonGap = 20;\n\n        const playAgainEnabled = !inMultiplayer || isHostPlayer;\n        const playAgainText = inMultiplayer && !isHostPlayer ? 'Waiting...' : 'PLAY AGAIN';\n\n        // Use MD size for play again (more reasonable) and SM for menu\n        const playAgainWidth = MD.width;\n        const playAgainHeight = MD.height;\n        const menuWidth = SM.width;\n        const menuHeight = SM.height;\n\n        // Center both buttons together\n        const totalButtonWidth = playAgainWidth + buttonGap + menuWidth;\n        const buttonsStartX = k.width() / 2 - totalButtonWidth / 2;\n\n        // Play Again button\n        const playAgainBg = k.add([\n            k.rect(playAgainWidth, playAgainHeight),\n            k.pos(buttonsStartX + playAgainWidth / 2, buttonY),\n            k.anchor('center'),\n            k.color(...(playAgainEnabled ? UI_COLORS.SUCCESS : UI_COLORS.BG_DISABLED)),\n            k.outline(2, k.rgb(...(playAgainEnabled ? UI_COLORS.BORDER : UI_COLORS.BG_DARK))),\n            k.area(),\n            k.fixed(),\n            k.scale(1),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        const playAgainLabel = k.add([\n            k.text(playAgainText, { size: UI_TEXT_SIZES.H2 }),\n            k.pos(buttonsStartX + playAgainWidth / 2, buttonY),\n            k.anchor('center'),\n            k.color(...(playAgainEnabled ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_DISABLED)),\n            k.fixed(),\n            k.scale(1),\n            k.z(UI_Z_LAYERS.MODAL + 1)\n        ]);\n\n        // Menu button\n        const menuBg = k.add([\n            k.rect(menuWidth, menuHeight),\n            k.pos(buttonsStartX + playAgainWidth + buttonGap + menuWidth / 2, buttonY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.NEUTRAL),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.scale(1),\n            k.z(UI_Z_LAYERS.MODAL)\n        ]);\n\n        const menuLabel = k.add([\n            k.text('MENU', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(buttonsStartX + playAgainWidth + buttonGap + menuWidth / 2, buttonY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.scale(1),\n            k.z(UI_Z_LAYERS.MODAL + 1)\n        ]);\n\n        // Button hover effects\n        if (playAgainEnabled) {\n            playAgainBg.onHoverUpdate(() => {\n                playAgainBg.color = k.rgb(...(UI_COLORS.SUCCESS_HOVER || [80, 180, 80]));\n                playAgainBg.scale = k.vec2(1.02, 1.02);\n                playAgainLabel.scale = k.vec2(1.02, 1.02);\n            });\n            playAgainBg.onHoverEnd(() => {\n                playAgainBg.color = k.rgb(...UI_COLORS.SUCCESS);\n                playAgainBg.scale = k.vec2(1, 1);\n                playAgainLabel.scale = k.vec2(1, 1);\n            });\n        }\n\n        menuBg.onHoverUpdate(() => {\n            menuBg.color = k.rgb(...UI_COLORS.NEUTRAL_HOVER);\n            menuBg.scale = k.vec2(1.02, 1.02);\n            menuLabel.scale = k.vec2(1.02, 1.02);\n        });\n        menuBg.onHoverEnd(() => {\n            menuBg.color = k.rgb(...UI_COLORS.NEUTRAL);\n            menuBg.scale = k.vec2(1, 1);\n            menuLabel.scale = k.vec2(1, 1);\n        });\n\n        // Button click handlers\n        if (playAgainEnabled) {\n            playAgainBg.onClick(() => {\n                playMenuSelect();\n                if (inMultiplayer && isHostPlayer) {\n                    broadcast('game_restart', {});\n                }\n                k.go('game', { resetState: true });\n            });\n        }\n\n        menuBg.onClick(() => {\n            playMenuNav();\n            if (inMultiplayer && !isHostPlayer) {\n                offMessage('game_restart');\n            }\n            k.go('menu');\n        });\n\n        // Network handlers\n        if (inMultiplayer && !isHostPlayer) {\n            onMessage('game_restart', () => {\n                playMenuSelect();\n                offMessage('game_restart');\n                k.go('game', { resetState: true });\n            });\n        }\n\n        // Keyboard shortcuts\n        k.onKeyPress('space', () => {\n            if (inMultiplayer && !isHostPlayer) return;\n            playMenuSelect();\n            if (inMultiplayer && isHostPlayer) {\n                broadcast('game_restart', {});\n            }\n            k.go('game', { resetState: true });\n        });\n\n        k.onKeyPress('escape', () => {\n            // Don't navigate away if achievement modal is open (it handles its own escape)\n            if (isAchievementModalOpen()) return;\n            playMenuNav();\n            if (inMultiplayer && !isHostPlayer) {\n                offMessage('game_restart');\n            }\n            k.go('menu');\n        });\n    });\n}\n","// Shop scene - allows players to purchase unlocks\nimport { getCurrency, getCurrencyName, isUnlocked, purchaseUnlock, purchasePermanentUpgrade, getPermanentUpgradeLevel, getTotalRefundableCredits, refundAllPermanentUpgrades, refundSinglePermanentUpgrade, isItemAchievementUnlockedSync, isAchievementUnlocked, purchaseBooster, getActiveBoostersCount, getEquippedCosmetic, setEquippedCosmetic, getSaveStats } from '../systems/metaProgression.js';\nimport { getUnlocksForCategory, getUnlockInfo, CHARACTER_UNLOCKS, WEAPON_UNLOCKS, PERMANENT_UPGRADE_UNLOCKS, COSMETIC_UNLOCKS, RUN_BOOSTER_UNLOCKS } from '../data/unlocks.js';\nimport { getAchievementById, getAchievementProgress } from '../data/achievements.js';\nimport { showAchievementModal, isAchievementModalOpen } from '../components/achievementModal.js';\nimport { playPurchaseSuccess, playPurchaseError, playMenuNav } from '../systems/sounds.js';\nimport {\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS,\n    formatButtonText,\n    createCreditIndicator,\n    createMenuParticles,\n    createAnimatedTitle\n} from '../config/uiConfig.js';\n\nexport function setupShopScene(k) {\n    k.scene('shop', () => {\n        // Prevent context menu on right-click\n        const preventContextMenu = (e) => {\n            e.preventDefault();\n            return false;\n        };\n        document.addEventListener('contextmenu', preventContextMenu);\n        \n        // Cleanup on scene leave\n        k.onSceneLeave(() => {\n            document.removeEventListener('contextmenu', preventContextMenu);\n        });\n        \n        const currency = getCurrency();\n        const currencyName = getCurrencyName();\n        \n        // Current category tab\n        let currentCategory = 'permanentUpgrades'; // Start with permanent upgrades since they're most useful\n        \n        // Background\n        k.add([\n            k.rect(k.width(), k.height()),\n            k.pos(0, 0),\n            k.anchor('topleft'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.BACKGROUND)\n        ]);\n\n        // Background particle effects\n        createMenuParticles(k, { patternCount: 10, particleCount: 15 });\n\n        // Title (moved up to avoid collision with tabs)\n        createAnimatedTitle(k, 'MERCH', k.width() / 2, 35, 8);\n\n        // Currency display (standardized)\n        const creditIndicator = createCreditIndicator(k, currency, currencyName);\n\n        // Category tabs\n        const tabY = 80;\n        const tabSpacing = 95;\n        const tabWidth = 85;\n        const tabHeight = 30;\n\n        const categories = [\n            { key: 'permanentUpgrades', label: 'Upgrades' },\n            { key: 'boosters', label: 'Boosters' },\n            { key: 'cosmetics', label: 'Cosmetics' },\n            { key: 'weapons', label: 'Weapons' },\n            { key: 'characters', label: 'Chars' }\n        ];\n        \n        // Calculate centered positions for tabs (same as Statistics and Settings menus)\n        const totalTabWidth = (categories.length - 1) * tabSpacing;\n        const firstTabX = k.width() / 2 - totalTabWidth / 2;\n        \n        const tabButtons = [];\n        categories.forEach((cat, index) => {\n            const tabX = firstTabX + index * tabSpacing;\n            const isActive = currentCategory === cat.key;\n            \n            const tabBg = k.add([\n                k.rect(tabWidth, tabHeight),\n                k.pos(tabX, tabY),\n                k.anchor('center'),\n                k.color(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM)),\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n\n            const tabLabel = k.add([\n                k.text(cat.label, { size: UI_TEXT_SIZES.BODY }),\n                k.pos(tabX, tabY),\n                k.anchor('center'),\n                k.color(...(isActive ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_TERTIARY)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            \n            tabBg.onClick(() => {\n                playMenuNav();\n                currentCategory = cat.key;\n                currentPage = 0; // Reset to first page when switching tabs\n                refreshShop();\n            });\n            \n            tabButtons.push({ bg: tabBg, label: tabLabel, category: cat.key });\n        });\n        \n        // Content area\n        const contentY = 130;\n        const contentHeight = k.height() - contentY - 100; // Leave room for pagination\n        let unlockItems = [];\n\n        // Pagination state\n        let currentPage = 0;\n        const ITEMS_PER_PAGE = 6; // 2 columns x 3 rows\n        let paginationItems = []; // Store pagination UI elements\n\n        // Flag to prevent multiple simultaneous purchases\n        let isPurchasing = false;\n\n        // Flag to prevent double-handling of pagination clicks in same frame\n        let paginationClickHandled = false;\n        \n        // Refresh shop display\n        function refreshShop() {\n            // Update currency display\n            const currentCurrency = getCurrency();\n            creditIndicator.updateCurrency(currentCurrency);\n            \n            // Update tab visuals\n            tabButtons.forEach(tab => {\n                const isActive = currentCategory === tab.category;\n                tab.bg.color = k.rgb(\n                    isActive ? 100 : 50,\n                    isActive ? 100 : 50,\n                    isActive ? 150 : 80\n                );\n                tab.label.color = k.rgb(\n                    isActive ? 255 : 150,\n                    isActive ? 255 : 150,\n                    isActive ? 255 : 150\n                );\n            });\n            \n            // Update refund button visibility\n            updateRefundButton();\n            \n            // Clear existing items\n            unlockItems.forEach(item => {\n                if (item.exists()) k.destroy(item);\n            });\n            unlockItems = [];\n\n            // Clear pagination items\n            paginationItems.forEach(item => {\n                if (item.exists()) k.destroy(item);\n            });\n            paginationItems = [];\n\n            // Get unlocks for current category\n            const unlocks = getUnlocksForCategory(currentCategory);\n            const unlockKeys = Object.keys(unlocks);\n            \n            // Filter out default unlocks if they're not interesting to show\n            const displayUnlocks = unlockKeys.filter(key => {\n                const unlock = unlocks[key];\n                // Show all permanent upgrades and boosters\n                if (currentCategory === 'permanentUpgrades') return true;\n                if (currentCategory === 'boosters') return true; // Always show boosters (consumables)\n                // For cosmetics, show all non-defaults\n                if (currentCategory === 'cosmetics') return !unlock.unlockedByDefault;\n                // For characters/weapons, only show non-default\n                return !unlock.unlockedByDefault;\n            });\n            \n            if (displayUnlocks.length === 0) {\n                // No unlocks available in this category\n                const noItemsText = k.add([\n                    k.text('No items available in this category yet.', { size: 18 }),\n                    k.pos(k.width() / 2, contentY + 50),\n                    k.anchor('center'),\n                    k.color(150, 150, 150),\n                    k.fixed(),\n                    k.z(1000)\n                ]);\n                unlockItems.push(noItemsText);\n                return;\n            }\n            \n            // Pagination calculations\n            const totalPages = Math.ceil(displayUnlocks.length / ITEMS_PER_PAGE);\n            // Clamp currentPage to valid range\n            if (currentPage >= totalPages) currentPage = Math.max(0, totalPages - 1);\n\n            // Get items for current page\n            const startIndex = currentPage * ITEMS_PER_PAGE;\n            const pageItems = displayUnlocks.slice(startIndex, startIndex + ITEMS_PER_PAGE);\n\n            // Display unlocks - Redesigned card layout\n            const cardWidth = 340;\n            const cardHeight = 105;\n            const itemSpacing = cardHeight + 8;\n            const startY = contentY + 5;\n            const itemsPerColumn = 3;\n\n            // Benefit icon mapping - shows what type of bonus this gives\n            const getBenefitIcon = (desc) => {\n                if (!desc) return null;\n                const d = desc.toLowerCase();\n                if (d.includes('hp') || d.includes('health')) return { icon: '', color: [255, 100, 100] };\n                if (d.includes('damage') || d.includes('dmg')) return { icon: '', color: [255, 200, 100] };\n                if (d.includes('speed')) return { icon: '', color: [100, 200, 255] };\n                if (d.includes('crit')) return { icon: '', color: [255, 255, 100] };\n                if (d.includes('xp') || d.includes('pickup')) return { icon: '', color: [100, 255, 200] };\n                if (d.includes('defense') || d.includes('reduction')) return { icon: '', color: [150, 150, 255] };\n                if (d.includes('credit') || d.includes('silver')) return { icon: '$', color: [200, 150, 50] };\n                if (d.includes('level')) return { icon: '', color: [200, 100, 255] };\n                if (d.includes('invuln') || d.includes('immunity')) return { icon: '', color: [100, 255, 255] };\n                if (d.includes('trail') || d.includes('glow') || d.includes('effect')) return { icon: '', color: [200, 150, 255] };\n                return null;\n            };\n\n            pageItems.forEach((key, index) => {\n                const unlock = unlocks[key];\n                const column = Math.floor(index / itemsPerColumn);\n                const row = index % itemsPerColumn;\n                const itemX = 45 + column * (cardWidth + 15);\n                const itemY = startY + row * itemSpacing;\n\n                // Check achievement requirement - handle both formats:\n                // 1. requiredAchievement: 'achievementId' (cosmetics, weapons)\n                // 2. unlockRequirement: { type: 'achievement', value: 'achievementId' } (characters)\n                const achievementId = unlock.requiredAchievement ||\n                    (unlock.unlockRequirement?.type === 'achievement' ? unlock.unlockRequirement.value : null);\n                const isAchievementLocked = achievementId ? !isAchievementUnlocked(achievementId) : false;\n                const requiredAchievement = achievementId ? getAchievementById(achievementId) : null;\n\n                // Determine item status for styling\n                const isUnlockedChar = currentCategory === 'characters' && isUnlocked('characters', key);\n                const isUnlockedWeapon = currentCategory === 'weapons' && isUnlocked('weapons', key);\n                const isMaxedUpgrade = currentCategory === 'permanentUpgrades' && getPermanentUpgradeLevel(key) >= (unlock.maxLevel || 1);\n                // Cosmetics are \"owned\" if: default, purchased, OR achievement requirement is met\n                const isCosmeticAchievementUnlocked = currentCategory === 'cosmetics' && unlock.requiredAchievement && !isAchievementLocked;\n                const isOwnedCosmetic = currentCategory === 'cosmetics' && (isUnlocked('cosmetics', key) || unlock.unlockedByDefault || isCosmeticAchievementUnlocked);\n                const isEquippedCosmetic = currentCategory === 'cosmetics' && getEquippedCosmetic(unlock.category) === key;\n\n                // Card border color based on status\n                let borderColor, bgColor;\n                if (isAchievementLocked) {\n                    borderColor = k.rgb(60, 50, 50);\n                    bgColor = [30, 25, 25];\n                } else if (isEquippedCosmetic) {\n                    borderColor = k.rgb(100, 200, 255);\n                    bgColor = [35, 45, 55];\n                } else if (isMaxedUpgrade || isUnlockedChar || isUnlockedWeapon || isOwnedCosmetic) {\n                    borderColor = k.rgb(80, 150, 80);\n                    bgColor = [35, 45, 35];\n                } else {\n                    borderColor = k.rgb(80, 80, 120);\n                    bgColor = [35, 35, 45];\n                }\n\n                // Card background\n                const cardBg = k.add([\n                    k.rect(cardWidth, cardHeight),\n                    k.pos(itemX, itemY),\n                    k.anchor('topleft'),\n                    k.color(...bgColor),\n                    k.outline(2, borderColor),\n                    k.area(),\n                    k.fixed(),\n                    k.z(1000)\n                ]);\n\n                // === TOP ROW: Icon + Name + Benefit indicator ===\n                let contentStartX = itemX + 10;\n\n                // Character/Weapon icon (if applicable)\n                if ((currentCategory === 'characters' || currentCategory === 'weapons') && unlock.char) {\n                    const iconBg = k.add([\n                        k.rect(40, 40),\n                        k.pos(itemX + 8, itemY + 8),\n                        k.anchor('topleft'),\n                        k.color(25, 25, 35),\n                        k.outline(1, k.rgb(60, 60, 80)),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n                    const iconText = k.add([\n                        k.text(unlock.char, { size: 28 }),\n                        k.pos(itemX + 28, itemY + 28),\n                        k.anchor('center'),\n                        k.color(...(isAchievementLocked ? [60, 60, 60] : (unlock.color || [200, 200, 200]))),\n                        k.fixed(),\n                        k.z(1002)\n                    ]);\n                    unlockItems.push(iconBg, iconText);\n                    contentStartX = itemX + 55;\n                }\n\n                // Cosmetic icon\n                if (currentCategory === 'cosmetics') {\n                    const cosmeticIcon = unlock.category === 'trail' ? '~' : unlock.category === 'death' ? '' : '';\n                    // Get a safe color array (handles 'rainbow' string and missing colors)\n                    let baseColor;\n                    if (unlock.color === 'rainbow') {\n                        // Rainbow gets a distinctive multicolor-ish display (magenta/cyan)\n                        baseColor = [255, 100, 200];\n                    } else if (Array.isArray(unlock.color)) {\n                        baseColor = unlock.color;\n                    } else {\n                        baseColor = [150, 150, 200];\n                    }\n                    // Dim the color when achievement-locked\n                    const cosmeticColor = isAchievementLocked ? [60, 60, 70] : baseColor;\n                    const borderColor = isAchievementLocked ? [50, 50, 60] : baseColor;\n                    const iconBg = k.add([\n                        k.rect(36, 36),\n                        k.pos(itemX + 8, itemY + 8),\n                        k.anchor('topleft'),\n                        k.color(25, 25, 35),\n                        k.outline(1, k.rgb(...borderColor)),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n                    const iconText = k.add([\n                        k.text(cosmeticIcon, { size: 22 }),\n                        k.pos(itemX + 26, itemY + 26),\n                        k.anchor('center'),\n                        k.color(...cosmeticColor),\n                        k.fixed(),\n                        k.z(1002)\n                    ]);\n                    unlockItems.push(iconBg, iconText);\n                    contentStartX = itemX + 50;\n                }\n\n                // Item name\n                const nameText = k.add([\n                    k.text(unlock.name, { size: 16 }),\n                    k.pos(contentStartX, itemY + 10),\n                    k.anchor('topleft'),\n                    k.color(isAchievementLocked ? 100 : 255, isAchievementLocked ? 100 : 255, isAchievementLocked ? 100 : 255),\n                    k.fixed(),\n                    k.z(1001)\n                ]);\n\n                // Benefit icon (top right, shows what type of bonus)\n                const benefit = getBenefitIcon(unlock.description);\n                if (benefit && !isAchievementLocked) {\n                    const benefitIcon = k.add([\n                        k.text(benefit.icon, { size: 18 }),\n                        k.pos(itemX + cardWidth - 12, itemY + 12),\n                        k.anchor('topright'),\n                        k.color(...benefit.color),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n                    unlockItems.push(benefitIcon);\n                }\n\n                // Lock icon for achievement-locked items\n                if (isAchievementLocked) {\n                    const lockIcon = k.add([\n                        k.text('(X)', { size: 14 }),\n                        k.pos(itemX + cardWidth - 10, itemY + 10),\n                        k.anchor('topright'),\n                        k.color(150, 80, 80),\n                        k.fixed(),\n                        k.z(1002)\n                    ]);\n                    unlockItems.push(lockIcon);\n                }\n\n                // === MIDDLE ROW: Description (constrained to 2 lines max) ===\n                const descWidth = cardWidth - contentStartX + itemX - 90; // Leave room for button\n                const descY = itemY + 30;\n\n                // Build description text with achievement progress for locked items\n                let descriptionText = unlock.description;\n                let achievementProgress = null;\n                if (isAchievementLocked && requiredAchievement) {\n                    const stats = getSaveStats();\n                    // Safely get achievement progress with null check\n                    if (stats) {\n                        achievementProgress = getAchievementProgress(requiredAchievement.id, stats);\n                    }\n                    if (achievementProgress) {\n                        descriptionText = `${requiredAchievement.name} (${achievementProgress.current}/${achievementProgress.target})`;\n                    } else {\n                        descriptionText = `Requires: ${requiredAchievement.name}`;\n                    }\n                }\n\n                const descText = k.add([\n                    k.text(descriptionText, { size: 12, width: descWidth }),\n                    k.pos(contentStartX, descY),\n                    k.anchor('topleft'),\n                    k.color(isAchievementLocked ? 140 : 180, isAchievementLocked ? 110 : 180, isAchievementLocked ? 110 : 180),\n                    k.fixed(),\n                    k.z(1001)\n                ]);\n\n                // Show mini progress bar for achievement-locked items with trackable progress\n                if (isAchievementLocked && achievementProgress && achievementProgress.target > 1) {\n                    const miniBarWidth = Math.min(descWidth, 120);\n                    const miniBarHeight = 4;\n                    const miniBarX = contentStartX;\n                    const miniBarY = descY + 18;\n\n                    // Background bar\n                    const miniBarBg = k.add([\n                        k.rect(miniBarWidth, miniBarHeight),\n                        k.pos(miniBarX, miniBarY),\n                        k.anchor('topleft'),\n                        k.color(40, 35, 45),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n                    unlockItems.push(miniBarBg);\n\n                    // Filled portion\n                    const fillWidth = Math.max(0, achievementProgress.progress * miniBarWidth);\n                    if (fillWidth > 0) {\n                        const miniBarFill = k.add([\n                            k.rect(fillWidth, miniBarHeight),\n                            k.pos(miniBarX, miniBarY),\n                            k.anchor('topleft'),\n                            k.color(100, 80, 130),\n                            k.fixed(),\n                            k.z(1002)\n                        ]);\n                        unlockItems.push(miniBarFill);\n                    }\n                }\n                \n                // === BOTTOM ROW: Status/Progress + Action Button ===\n                const bottomY = itemY + cardHeight - 28;\n                const buttonX = itemX + cardWidth - 85;\n                const buttonWidth = 75;\n                const buttonHeight = 24;\n\n                // Calculate escalating price for permanent upgrades\n                function getUpgradePrice(level) {\n                    const prices = [50, 65, 90, 115, 160];\n                    if (level < prices.length) return prices[level];\n                    return 160 + (level - 4) * 50;\n                }\n\n                // Determine status and purchase state\n                let statusText = '';\n                let canPurchase = false;\n                let purchaseCost = unlock.cost;\n                let showProgressBar = false;\n                let progressLevel = 0;\n                let progressMax = 1;\n\n                if (currentCategory === 'permanentUpgrades') {\n                    const level = getPermanentUpgradeLevel(key);\n                    const maxLevel = unlock.maxLevel || 1;\n                    progressLevel = level;\n                    progressMax = maxLevel;\n                    showProgressBar = true;\n\n                    if (level >= maxLevel) {\n                        statusText = 'MAXED';\n                    } else {\n                        purchaseCost = getUpgradePrice(level);\n                        canPurchase = currency >= purchaseCost;\n                    }\n                } else if (currentCategory === 'boosters') {\n                    const boosterCount = getActiveBoostersCount(key);\n                    statusText = boosterCount > 0 ? `Ready (${boosterCount})` : 'Consumable';\n                    canPurchase = currency >= purchaseCost;\n                } else if (currentCategory === 'cosmetics') {\n                    const cosmeticType = unlock.category;\n                    if (isEquippedCosmetic) {\n                        statusText = 'EQUIPPED';\n                    } else if (isOwnedCosmetic) {\n                        // Differentiate between achievement-unlocked and purchased\n                        statusText = isCosmeticAchievementUnlocked ? 'UNLOCKED' : 'OWNED';\n                    } else if (!isAchievementLocked) {\n                        // Only show purchase option if not achievement-locked\n                        canPurchase = currency >= purchaseCost;\n                    }\n                    // If achievement-locked, no status text needed (VIEW button handles it)\n                } else if (currentCategory === 'characters') {\n                    if (!isUnlockedChar) {\n                        canPurchase = currency >= purchaseCost;\n                    }\n                } else if (currentCategory === 'weapons') {\n                    if (!isUnlockedWeapon) {\n                        canPurchase = currency >= purchaseCost;\n                    }\n                }\n\n                // Progress bar for permanent upgrades\n                if (showProgressBar) {\n                    const barWidth = 100;\n                    const barHeight = 8;\n                    const barX = contentStartX;\n                    const barY = bottomY + 8;\n\n                    // Background bar\n                    const barBg = k.add([\n                        k.rect(barWidth, barHeight),\n                        k.pos(barX, barY),\n                        k.anchor('topleft'),\n                        k.color(30, 30, 40),\n                        k.outline(1, k.rgb(60, 60, 80)),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n\n                    // Filled portion\n                    const fillWidth = Math.max(0, (progressLevel / progressMax) * (barWidth - 2));\n                    if (fillWidth > 0) {\n                        const barFill = k.add([\n                            k.rect(fillWidth, barHeight - 2),\n                            k.pos(barX + 1, barY + 1),\n                            k.anchor('topleft'),\n                            k.color(progressLevel >= progressMax ? 100 : 80, progressLevel >= progressMax ? 200 : 150, progressLevel >= progressMax ? 100 : 80),\n                            k.fixed(),\n                            k.z(1002)\n                        ]);\n                        unlockItems.push(barFill);\n                    }\n\n                    // Level text\n                    const levelText = k.add([\n                        k.text(`${progressLevel}/${progressMax}`, { size: 10 }),\n                        k.pos(barX + barWidth + 8, barY + 4),\n                        k.anchor('left'),\n                        k.color(progressLevel >= progressMax ? 100 : 150, progressLevel >= progressMax ? 255 : 200, progressLevel >= progressMax ? 100 : 150),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n\n                    unlockItems.push(barBg, levelText);\n                }\n\n                // Status text (for non-progress items)\n                let statusLabel = null;\n                if (statusText && !showProgressBar) {\n                    // Color based on status type\n                    let statusColor;\n                    switch (statusText) {\n                        case 'EQUIPPED':\n                            statusColor = [100, 200, 255]; // Cyan for equipped\n                            break;\n                        case 'UNLOCKED':\n                            statusColor = [180, 140, 255]; // Purple for achievement-unlocked\n                            break;\n                        case 'MAXED':\n                        case 'OWNED':\n                            statusColor = [100, 200, 100]; // Green for owned/maxed\n                            break;\n                        default:\n                            statusColor = [180, 180, 180]; // Gray default\n                    }\n                    statusLabel = k.add([\n                        k.text(statusText, { size: 11 }),\n                        k.pos(contentStartX, bottomY + 7),\n                        k.anchor('topleft'),\n                        k.color(...statusColor),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n                }\n                \n                // Purchase button or View Achievement button\n                if (isAchievementLocked && requiredAchievement) {\n                    // Show \"View\" button for achievement-locked items\n                    const viewButtonBg = k.add([\n                        k.rect(buttonWidth, buttonHeight),\n                        k.pos(buttonX, bottomY),\n                        k.anchor('topleft'),\n                        k.color(50, 40, 60),\n                        k.outline(1, k.rgb(100, 80, 130)),\n                        k.area({ width: buttonWidth, height: buttonHeight }),\n                        k.fixed(),\n                        k.z(1010)\n                    ]);\n\n                    const viewButtonText = k.add([\n                        k.text('VIEW', { size: 11 }),\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\n                        k.anchor('center'),\n                        k.color(160, 130, 200),\n                        k.fixed(),\n                        k.z(1011)\n                    ]);\n\n                    // Hover effects for better feedback\n                    viewButtonBg.onHover(() => {\n                        viewButtonBg.color = k.rgb(70, 55, 85);\n                        viewButtonBg.outline.color = k.rgb(140, 110, 180);\n                        viewButtonText.color = k.rgb(200, 170, 255);\n                    });\n                    viewButtonBg.onHoverEnd(() => {\n                        viewButtonBg.color = k.rgb(50, 40, 60);\n                        viewButtonBg.outline.color = k.rgb(100, 80, 130);\n                        viewButtonText.color = k.rgb(160, 130, 200);\n                    });\n\n                    // Store achievement reference for closure\n                    const achievementToShow = requiredAchievement;\n                    viewButtonBg.onClick(() => {\n                        playMenuNav();\n                        showAchievementModal(k, achievementToShow);\n                    });\n                    viewButtonBg.cursor = 'pointer';\n\n                    unlockItems.push(viewButtonBg, viewButtonText);\n                } else if (isAchievementLocked) {\n                    // Achievement locked but no specific achievement found - show locked status\n                    const lockedText = k.add([\n                        k.text('LOCKED', { size: 11 }),\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\n                        k.anchor('center'),\n                        k.color(100, 80, 80),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n                    unlockItems.push(lockedText);\n                } else if (canPurchase || (currentCategory === 'permanentUpgrades' && progressLevel < progressMax)) {\n                    const buttonBg = k.add([\n                        k.rect(buttonWidth, buttonHeight),\n                        k.pos(buttonX, bottomY),\n                        k.anchor('topleft'),\n                        k.color(canPurchase ? 40 : 30, canPurchase ? 120 : 40, canPurchase ? 40 : 30),\n                        k.outline(1, k.rgb(canPurchase ? 80 : 50, canPurchase ? 180 : 60, canPurchase ? 80 : 50)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n\n                    const buttonText = k.add([\n                        k.text(`$${purchaseCost}`, { size: 12 }),\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\n                        k.anchor('center'),\n                        k.color(canPurchase ? 255 : 120, canPurchase ? 255 : 120, canPurchase ? 255 : 120),\n                        k.fixed(),\n                        k.z(1002)\n                    ]);\n                    \n                    // Add right-click handler for permanent upgrades (refund single level)\n                    if (currentCategory === 'permanentUpgrades') {\n                        if (progressLevel > 0) {\n                            // Use global mouse release event to detect right-click\n                            let rightClickHandler = null;\n                            rightClickHandler = k.onMouseRelease('right', () => {\n                                // Check if mouse is over the button\n                                const mousePos = k.mousePos();\n\n                                if (mousePos.x >= buttonX && mousePos.x <= buttonX + buttonWidth &&\n                                    mousePos.y >= bottomY && mousePos.y <= bottomY + buttonHeight) {\n                                    // Right-click on button: refund single level\n                                    if (isPurchasing) return;\n                                    isPurchasing = true;\n                                    \n                                    const result = refundSinglePermanentUpgrade(key);\n                                    \n                                    if (result && result.success) {\n                                        // Play purchase success sound (reusing for refund)\n                                        playPurchaseSuccess();\n                                        \n                                        // Refund successful\n                                        const refundMsg = k.add([\n                                            k.text(`Refunded $${result.refundAmount}!`, { size: 20 }),\n                                            k.pos(k.width() / 2, k.height() / 2),\n                                            k.anchor('center'),\n                                            k.color(100, 200, 255),\n                                            k.fixed(),\n                                            k.z(2000)\n                                        ]);\n                                        \n                                        k.wait(0.5, () => {\n                                            if (refundMsg.exists()) k.destroy(refundMsg);\n                                        });\n                                        \n                                        // Refresh shop and reset flag\n                                        refreshShop();\n                                        k.wait(0.2, () => {\n                                            isPurchasing = false;\n                                        });\n                                    } else {\n                                        // Reset flag on error\n                                        isPurchasing = false;\n                                    }\n                                }\n                            });\n                            \n                            // Cleanup handler when button is destroyed\n                            buttonBg.onDestroy(() => {\n                                if (rightClickHandler) {\n                                    rightClickHandler.cancel();\n                                }\n                            });\n                        }\n                    }\n                    \n                    if (canPurchase) {\n                        buttonBg.onClick(() => {\n                            // Prevent multiple simultaneous purchases\n                            if (isPurchasing) return;\n                            isPurchasing = true;\n\n                            let result;\n                            if (currentCategory === 'permanentUpgrades') {\n                                result = purchasePermanentUpgrade(key, purchaseCost, unlock.maxLevel);\n                            } else if (currentCategory === 'boosters') {\n                                result = purchaseBooster(key, purchaseCost);\n                            } else {\n                                result = purchaseUnlock(currentCategory, key, purchaseCost);\n                            }\n                            \n                            // Handle result (permanent upgrades and boosters return object, regular unlocks return boolean)\n                            if (currentCategory === 'permanentUpgrades' || currentCategory === 'boosters') {\n                                if (result && result.success) {\n                                    // Play purchase success sound\n                                    playPurchaseSuccess();\n\n                                    // Purchase successful - different message for boosters\n                                    const msgText = currentCategory === 'boosters' ? 'Booster Ready!' : 'Purchased!';\n                                    const successMsg = k.add([\n                                        k.text(msgText, { size: 20 }),\n                                        k.pos(k.width() / 2, k.height() / 2),\n                                        k.anchor('center'),\n                                        k.color(100, 255, 100),\n                                        k.fixed(),\n                                        k.z(2000)\n                                    ]);\n\n                                    k.wait(0.5, () => {\n                                        if (successMsg.exists()) k.destroy(successMsg);\n                                    });\n\n                                    // Refresh shop and reset purchasing flag with delay to prevent double-purchase\n                                    refreshShop();\n                                    k.wait(0.2, () => {\n                                        isPurchasing = false;\n                                    });\n                                } else if (result && result.reason === 'insufficientCurrency') {\n                                    // Play purchase error sound\n                                    playPurchaseError();\n\n                                    // Not enough currency\n                                    const errorMsg = k.add([\n                                        k.text(`Not enough ${currencyName}!`, { size: 20 }),\n                                        k.pos(k.width() / 2, k.height() / 2),\n                                        k.anchor('center'),\n                                        k.color(255, 100, 100),\n                                        k.fixed(),\n                                        k.z(2000)\n                                    ]);\n\n                                    k.wait(0.5, () => {\n                                        if (errorMsg.exists()) k.destroy(errorMsg);\n                                    });\n\n                                    // Reset purchasing flag\n                                    isPurchasing = false;\n                                } else {\n                                    // Reset purchasing flag on any other error\n                                    isPurchasing = false;\n                                }\n                            } else {\n                                // Regular unlock (returns boolean)\n                                if (result) {\n                                    // Play purchase success sound\n                                    playPurchaseSuccess();\n\n                                    // Purchase successful\n                                    const successMsg = k.add([\n                                        k.text('Purchased!', { size: 20 }),\n                                        k.pos(k.width() / 2, k.height() / 2),\n                                        k.anchor('center'),\n                                        k.color(100, 255, 100),\n                                        k.fixed(),\n                                        k.z(2000)\n                                    ]);\n\n                                    k.wait(0.5, () => {\n                                        if (successMsg.exists()) k.destroy(successMsg);\n                                    });\n\n                                    // Refresh shop and reset purchasing flag with delay to prevent double-purchase\n                                    refreshShop();\n                                    k.wait(0.2, () => {\n                                        isPurchasing = false;\n                                    });\n                                } else {\n                                    // Play purchase error sound\n                                    playPurchaseError();\n\n                                    // Not enough currency\n                                    const errorMsg = k.add([\n                                        k.text(`Not enough ${currencyName}!`, { size: 20 }),\n                                        k.pos(k.width() / 2, k.height() / 2),\n                                        k.anchor('center'),\n                                        k.color(255, 100, 100),\n                                        k.fixed(),\n                                        k.z(2000)\n                                    ]);\n\n                                    k.wait(0.5, () => {\n                                        if (errorMsg.exists()) k.destroy(errorMsg);\n                                    });\n                                    \n                                    // Reset purchasing flag\n                                    isPurchasing = false;\n                                }\n                            }\n                        });\n                    }\n                    \n                    unlockItems.push(buttonBg, buttonText);\n                } else if (currentCategory === 'cosmetics' && isOwnedCosmetic && !isEquippedCosmetic) {\n                    // Show EQUIP button for owned but not equipped cosmetics\n                    const equipButtonBg = k.add([\n                        k.rect(buttonWidth, buttonHeight),\n                        k.pos(buttonX, bottomY),\n                        k.anchor('topleft'),\n                        k.color(40, 80, 120),\n                        k.outline(1, k.rgb(80, 140, 200)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n\n                    const equipButtonText = k.add([\n                        k.text('EQUIP', { size: 11 }),\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\n                        k.anchor('center'),\n                        k.color(200, 230, 255),\n                        k.fixed(),\n                        k.z(1002)\n                    ]);\n\n                    // Hover effects\n                    equipButtonBg.onHover(() => {\n                        equipButtonBg.color = k.rgb(50, 100, 150);\n                        equipButtonBg.outline.color = k.rgb(100, 170, 240);\n                        equipButtonText.color = k.rgb(230, 245, 255);\n                    });\n                    equipButtonBg.onHoverEnd(() => {\n                        equipButtonBg.color = k.rgb(40, 80, 120);\n                        equipButtonBg.outline.color = k.rgb(80, 140, 200);\n                        equipButtonText.color = k.rgb(200, 230, 255);\n                    });\n\n                    equipButtonBg.onClick(() => {\n                        if (isPurchasing) return;\n                        isPurchasing = true;\n                        playMenuNav();\n                        setEquippedCosmetic(unlock.category, key);\n                        isPurchasing = false;\n                        refreshShop();\n                    });\n                    equipButtonBg.cursor = 'pointer';\n\n                    unlockItems.push(equipButtonBg, equipButtonText);\n                } else if (currentCategory === 'cosmetics' && isEquippedCosmetic && !key.includes('None')) {\n                    // Show UNEQUIP button for equipped cosmetics (except default \"None\" cosmetics)\n                    const unequipButtonBg = k.add([\n                        k.rect(buttonWidth, buttonHeight),\n                        k.pos(buttonX, bottomY),\n                        k.anchor('topleft'),\n                        k.color(80, 50, 50),\n                        k.outline(1, k.rgb(160, 100, 100)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n\n                    const unequipButtonText = k.add([\n                        k.text('UNEQUIP', { size: 11 }),\n                        k.pos(buttonX + buttonWidth / 2, bottomY + buttonHeight / 2),\n                        k.anchor('center'),\n                        k.color(255, 180, 180),\n                        k.fixed(),\n                        k.z(1002)\n                    ]);\n\n                    // Hover effects\n                    unequipButtonBg.onHover(() => {\n                        unequipButtonBg.color = k.rgb(100, 60, 60);\n                        unequipButtonBg.outline.color = k.rgb(200, 120, 120);\n                        unequipButtonText.color = k.rgb(255, 210, 210);\n                    });\n                    unequipButtonBg.onHoverEnd(() => {\n                        unequipButtonBg.color = k.rgb(80, 50, 50);\n                        unequipButtonBg.outline.color = k.rgb(160, 100, 100);\n                        unequipButtonText.color = k.rgb(255, 180, 180);\n                    });\n\n                    unequipButtonBg.onClick(() => {\n                        if (isPurchasing) return;\n                        isPurchasing = true;\n                        playMenuNav();\n                        // Reset to default \"None\" cosmetic for this category\n                        const noneKey = unlock.category + 'None';\n                        setEquippedCosmetic(unlock.category, noneKey);\n                        isPurchasing = false;\n                        refreshShop();\n                    });\n                    unequipButtonBg.cursor = 'pointer';\n\n                    unlockItems.push(unequipButtonBg, unequipButtonText);\n                }\n\n                // Push all items (only push statusLabel if it exists)\n                unlockItems.push(cardBg, nameText, descText);\n                if (statusLabel) {\n                    unlockItems.push(statusLabel);\n                }\n            });\n\n            // Add pagination controls if more than one page\n            if (totalPages > 1) {\n                const paginationY = k.height() - 115;\n                const paginationCenterX = k.width() / 2;\n\n                // Page indicator pips\n                const pipSpacing = 20;\n                const pipsStartX = paginationCenterX - ((totalPages - 1) * pipSpacing) / 2;\n                const pipsEndX = paginationCenterX + ((totalPages - 1) * pipSpacing) / 2;\n\n                // Arrows positioned well outside the pips to prevent overlap\n                const arrowOffset = 35;\n                const leftArrowX = pipsStartX - arrowOffset;\n                const rightArrowX = pipsEndX + arrowOffset;\n\n                // Left arrow FIRST (so it registers clicks before pips)\n                const leftArrowBg = k.add([\n                    k.rect(30, 30),\n                    k.pos(leftArrowX, paginationY),\n                    k.anchor('center'),\n                    k.color(0, 0, 0),\n                    k.opacity(0),\n                    k.area({ width: 30, height: 30 }),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS + 10)\n                ]);\n\n                const leftArrowText = k.add([\n                    k.text('<', { size: 24 }),\n                    k.pos(leftArrowX, paginationY),\n                    k.anchor('center'),\n                    k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT + 10)\n                ]);\n\n                if (currentPage > 0) {\n                    leftArrowBg.onClick(() => {\n                        if (paginationClickHandled) return;\n                        paginationClickHandled = true;\n                        k.wait(0, () => { paginationClickHandled = false; });\n                        playMenuNav();\n                        currentPage--;\n                        refreshShop();\n                    });\n                    leftArrowBg.cursor = 'pointer';\n                }\n                paginationItems.push(leftArrowBg, leftArrowText);\n\n                // Right arrow SECOND (so it registers clicks before pips)\n                const rightArrowBg = k.add([\n                    k.rect(30, 30),\n                    k.pos(rightArrowX, paginationY),\n                    k.anchor('center'),\n                    k.color(0, 0, 0),\n                    k.opacity(0),\n                    k.area({ width: 30, height: 30 }),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS + 10)\n                ]);\n\n                const rightArrowText = k.add([\n                    k.text('>', { size: 24 }),\n                    k.pos(rightArrowX, paginationY),\n                    k.anchor('center'),\n                    k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT + 10)\n                ]);\n\n                if (currentPage < totalPages - 1) {\n                    rightArrowBg.onClick(() => {\n                        if (paginationClickHandled) return;\n                        paginationClickHandled = true;\n                        k.wait(0, () => { paginationClickHandled = false; });\n                        playMenuNav();\n                        currentPage++;\n                        refreshShop();\n                    });\n                    rightArrowBg.cursor = 'pointer';\n                }\n                paginationItems.push(rightArrowBg, rightArrowText);\n\n                // Page indicator pips LAST (lower z-index, won't interfere with arrows)\n                for (let i = 0; i < totalPages; i++) {\n                    const isCurrentPage = i === currentPage;\n                    const pipX = pipsStartX + i * pipSpacing;\n\n                    const pipBg = k.add([\n                        k.rect(16, 16),\n                        k.pos(pipX, paginationY),\n                        k.anchor('center'),\n                        k.color(0, 0, 0),\n                        k.opacity(0),\n                        k.area({ width: 16, height: 16 }),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                    ]);\n\n                    const pipText = k.add([\n                        k.text(isCurrentPage ? '' : '', { size: 14 }),\n                        k.pos(pipX, paginationY),\n                        k.anchor('center'),\n                        k.color(isCurrentPage ? 255 : 120, isCurrentPage ? 255 : 120, isCurrentPage ? 255 : 120),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n\n                    const pageIndex = i;\n                    pipBg.onClick(() => {\n                        if (paginationClickHandled) return;\n                        paginationClickHandled = true;\n                        k.wait(0, () => { paginationClickHandled = false; });\n                        if (pageIndex !== currentPage) {\n                            playMenuNav();\n                            currentPage = pageIndex;\n                            refreshShop();\n                        }\n                    });\n                    pipBg.cursor = 'pointer';\n\n                    paginationItems.push(pipBg, pipText);\n                }\n            }\n        }\n        \n        // Refund button (only shown on permanent upgrades tab)\n        // Matches \"Reset to Defaults\" button formatting from Settings menu\n        let refundButton = null;\n        let refundText = null;\n        \n        function updateRefundButton() {\n            const refundableAmount = getTotalRefundableCredits();\n            const showRefund = currentCategory === 'permanentUpgrades' && refundableAmount > 0;\n            \n            if (showRefund) {\n                if (!refundButton) {\n                    refundButton = k.add([\n                        k.rect(200, 30),\n                        k.pos(k.width() / 2, k.height() - 80),\n                        k.anchor('center'),\n                        k.color(100, 50, 50),\n                        k.outline(2, k.rgb(150, 100, 100)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                    ]);\n                    \n                    refundText = k.add([\n                        k.text(`REFUND: $${refundableAmount}`, { size: 14 }),\n                        k.pos(k.width() / 2, k.height() - 80),\n                        k.anchor('center'),\n                        k.color(255, 200, 200),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    \n                    refundButton.onClick(() => {\n                        const result = refundAllPermanentUpgrades();\n                        if (result.success) {\n                            playPurchaseSuccess();\n                            // Refresh shop to update display\n                            refreshShop();\n                        } else {\n                            playPurchaseError();\n                        }\n                    });\n                } else {\n                    // Update refund amount in button text\n                    refundText.text = `REFUND: $${refundableAmount}`;\n                    refundButton.hidden = false;\n                    refundText.hidden = false;\n                }\n            } else {\n                if (refundButton) {\n                    refundButton.hidden = true;\n                    if (refundText) refundText.hidden = true;\n                }\n            }\n        }\n        \n        // Initial refresh (after refund button function is defined)\n        refreshShop();\n        \n        // Back button (standardized, centered like other menus)\n        const backButton = k.add([\n            k.rect(120, 35),\n            k.pos(k.width() / 2, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.NEUTRAL),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n        \n        const backText = k.add([\n            k.text(formatButtonText('Back'), { size: UI_TEXT_SIZES.BODY }),\n            k.pos(k.width() / 2, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n        \n        backButton.onClick(() => {\n            playMenuNav();\n            k.go('menu');\n        });\n        \n        k.onKeyPress('escape', () => {\n            // Don't navigate away if achievement modal is open (it handles its own escape)\n            if (isAchievementModalOpen()) return;\n            k.go('menu');\n        });\n    });\n}\n\n","// Settings scene - allows players to configure game options\nimport { getSettings, updateSetting, resetSettings, saveSettings } from '../systems/settings.js';\nimport { setMusicVolume, setMasterVolume, setSfxVolume, setUiSoundsEnabled, setCombatSoundsEnabled, playMenuNav } from '../systems/sounds.js';\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS,\n    createMenuParticles,\n    createAnimatedTitle\n} from '../config/uiConfig.js';\n\n/**\n * Show reset confirmation dialog\n */\nfunction showResetConfirmationDialog(k, onConfirm) {\n    // Overlay\n    const overlay = k.add([\n        k.rect(k.width(), k.height()),\n        k.pos(0, 0),\n        k.color(0, 0, 0),\n        k.opacity(0.7),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY)\n    ]);\n\n    // Dialog box\n    const dialogWidth = 400;\n    const dialogHeight = 180;\n    const dialogBg = k.add([\n        k.rect(dialogWidth, dialogHeight),\n        k.pos(k.width() / 2, k.height() / 2),\n        k.anchor('center'),\n        k.color(...UI_COLORS.BG_MEDIUM),\n        k.outline(3, k.rgb(...UI_COLORS.BORDER)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 1)\n    ]);\n\n\n    // Store dialog entities for cleanup\n    const dialogEntities = [];\n\n    // Close function\n    function closeDialog() {\n        dialogEntities.forEach(entity => {\n            if (entity && entity.exists && entity.exists()) {\n                k.destroy(entity);\n            }\n        });\n    }\n\n    // Cancel button\n    const cancelButton = k.add([\n        k.rect(100, 30),\n        k.pos(k.width() / 2 - 60, k.height() / 2 + 50),\n        k.anchor('center'),\n        k.color(...UI_COLORS.BG_MEDIUM),\n        k.outline(2, k.rgb(...UI_COLORS.TEXT_PRIMARY)),\n        k.area(),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\n    ]);\n\n    const cancelText = k.add([\n        k.text('Cancel', { size: UI_TEXT_SIZES.SMALL - 2 }),\n        k.pos(k.width() / 2 - 60, k.height() / 2 + 50),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_PRIMARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\n    ]);\n\n    cancelButton.onClick(() => {\n        closeDialog();\n    });\n    dialogEntities.push(overlay, dialogBg, cancelButton, cancelText);\n\n    // Confirm button\n    const confirmButton = k.add([\n        k.rect(100, 30),\n        k.pos(k.width() / 2 + 60, k.height() / 2 + 50),\n        k.anchor('center'),\n        k.color(100, 50, 50),\n        k.outline(2, k.rgb(150, 100, 100)),\n        k.area(),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\n    ]);\n\n    const confirmText = k.add([\n        k.text('Reset', { size: UI_TEXT_SIZES.SMALL - 2 }),\n        k.pos(k.width() / 2 + 60, k.height() / 2 + 50),\n        k.anchor('center'),\n        k.color(255, 200, 200),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\n    ]);\n\n    confirmButton.onClick(() => {\n        closeDialog();\n        onConfirm();\n    });\n    dialogEntities.push(confirmButton, confirmText);\n\n    // Add title and message to cleanup list\n    const titleText = k.add([\n        k.text('Reset to Defaults?', { size: UI_TEXT_SIZES.LABEL }),\n        k.pos(k.width() / 2, k.height() / 2 - 50),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_PRIMARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\n    ]);\n    dialogEntities.push(titleText);\n\n    const messageText = k.add([\n        k.text('This will reset all settings to their default values.', { size: UI_TEXT_SIZES.SMALL }),\n        k.pos(k.width() / 2, k.height() / 2 - 10),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_SECONDARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\n    ]);\n    dialogEntities.push(messageText);\n\n    const escapeHandler = k.onKeyPress('escape', () => {\n        closeDialog();\n        escapeHandler.cancel();\n    });\n}\n\nexport function setupSettingsScene(k) {\n    k.scene('settings', (args) => {\n        // Check if we came from game (pause menu)\n        const fromGame = args?.fromGame || false;\n        \n        let settings = getSettings();\n        let currentTab = 'audio'; // audio, video, gameplay, controls, access, data\n\n        // Background\n        k.add([\n            k.rect(k.width(), k.height()),\n            k.pos(0, 0),\n            k.anchor('topleft'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.BACKGROUND)\n        ]);\n\n        // Background particle effects\n        createMenuParticles(k, { patternCount: 10, particleCount: 15 });\n\n        // Title (moved up to avoid collision with tabs)\n        createAnimatedTitle(k, 'OPTIONS', k.width() / 2, 35, 8);\n\n        // Tab buttons\n        const tabY = 80;\n        const tabSpacing = 100;\n        const tabWidth = 90;\n        const tabHeight = 30;\n        \n        const tabs = [\n            { key: 'audio', label: 'Audio' },\n            { key: 'video', label: 'Video' },\n            { key: 'gameplay', label: 'Gameplay' },\n            { key: 'controls', label: 'Controls' },\n            { key: 'access', label: 'Access.' },\n            { key: 'data', label: 'Data' }\n        ];\n        \n        // Calculate centered positions for tabs\n        const totalTabWidth = (tabs.length - 1) * tabSpacing;\n        const firstTabX = k.width() / 2 - totalTabWidth / 2;\n        \n        const tabButtons = [];\n        tabs.forEach((tab, index) => {\n            const tabX = firstTabX + index * tabSpacing;\n            const isActive = currentTab === tab.key;\n            \n            const tabBg = k.add([\n                k.rect(tabWidth, tabHeight),\n                k.pos(tabX, tabY),\n                k.anchor('center'),\n                k.color(isActive ? 100 : 50, isActive ? 100 : 50, isActive ? 150 : 80),\n                k.outline(2, k.rgb(150, 150, 150)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n            \n            const tabLabel = k.add([\n                k.text(tab.label, { size: 16 }),\n                k.pos(tabX, tabY),\n                k.anchor('center'),\n                k.color(isActive ? 255 : 150, isActive ? 255 : 150, isActive ? 255 : 150),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            \n            tabBg.onClick(() => {\n                currentTab = tab.key;\n                refreshSettings();\n            });\n            \n            tabButtons.push({ bg: tabBg, label: tabLabel, key: tab.key });\n        });\n        \n        // Content area\n        const contentY = 120;\n        const itemSpacing = 50; // Spacing between settings items\n        const bottomButtonArea = 150; // Space reserved for buttons at bottom (prevents overlap)\n        // TODO: Add scrolling support if content exceeds available space\n        let settingsItems = [];\n        \n        // Refresh settings display\n        function refreshSettings() {\n            // Update tab visuals\n            tabButtons.forEach(tab => {\n                const isActive = currentTab === tab.key;\n                tab.bg.color = k.rgb(\n                    isActive ? 100 : 50,\n                    isActive ? 100 : 50,\n                    isActive ? 150 : 80\n                );\n                tab.label.color = k.rgb(\n                    isActive ? 255 : 150,\n                    isActive ? 255 : 150,\n                    isActive ? 255 : 150\n                );\n            });\n            \n            // Clear existing items\n            settingsItems.forEach(item => {\n                if (item.exists()) k.destroy(item);\n            });\n            settingsItems = [];\n            \n            // Reload settings\n            settings = getSettings();\n            \n            // Display settings based on current tab\n            const startY = contentY + 20;\n            let currentY = startY;\n\n            if (currentTab === 'audio') {\n                // Master Volume\n                currentY = addVolumeSlider(k, 'Master Volume', settings.audio?.masterVolume ?? 1.0, currentY, (value) => {\n                    updateSetting('audio', 'masterVolume', value);\n                    setMasterVolume(value);\n                });\n\n                // Music Volume\n                currentY = addVolumeSlider(k, 'Music Volume', settings.audio?.musicVolume ?? 0.35, currentY, (value) => {\n                    updateSetting('audio', 'musicVolume', value);\n                    setMusicVolume(value);\n                });\n\n                // SFX Volume\n                currentY = addVolumeSlider(k, 'SFX Volume', settings.audio?.sfxVolume ?? 1.0, currentY, (value) => {\n                    updateSetting('audio', 'sfxVolume', value);\n                    setSfxVolume(value);\n                    // Play a preview sound when adjusting\n                    playMenuNav();\n                });\n\n                // UI Sounds toggle\n                currentY = addToggle(k, 'UI Sounds', settings.audio?.uiSounds !== false, currentY, (value) => {\n                    updateSetting('audio', 'uiSounds', value);\n                    setUiSoundsEnabled(value);\n                });\n\n                // Combat Sounds toggle\n                currentY = addToggle(k, 'Combat Sounds', settings.audio?.combatSounds !== false, currentY, (value) => {\n                    updateSetting('audio', 'combatSounds', value);\n                    setCombatSoundsEnabled(value);\n                });\n\n            } else if (currentTab === 'video') {\n                // Show Particles\n                currentY = addToggle(k, 'Show Particles', settings.visual?.showParticles !== false, currentY, (value) => {\n                    updateSetting('visual', 'showParticles', value);\n                });\n\n                // Show Screen Shake\n                currentY = addToggle(k, 'Screen Shake', settings.visual?.showScreenShake !== false, currentY, (value) => {\n                    updateSetting('visual', 'showScreenShake', value);\n                });\n\n                // Show Hit Freeze\n                currentY = addToggle(k, 'Hit Freeze', settings.visual?.showHitFreeze !== false, currentY, (value) => {\n                    updateSetting('visual', 'showHitFreeze', value);\n                });\n\n                // Show Damage Numbers\n                currentY = addToggle(k, 'Damage Numbers', settings.visual?.showDamageNumbers !== false, currentY, (value) => {\n                    updateSetting('visual', 'showDamageNumbers', value);\n                });\n\n                // FPS Counter\n                currentY = addToggle(k, 'FPS Counter', settings.visual?.showFPS || false, currentY, (value) => {\n                    updateSetting('visual', 'showFPS', value);\n                });\n\n                // Show Timer\n                currentY = addToggle(k, 'Show Timer', settings.visual?.showTimer !== false, currentY, (value) => {\n                    updateSetting('visual', 'showTimer', value);\n                });\n\n            } else if (currentTab === 'controls') {\n                // Display current key bindings\n                const controls = settings.controls || {};\n                \n                const controlLabels = [\n                    { label: 'Move Up', key: 'moveUp', value: controls.moveUp || 'w' },\n                    { label: 'Move Down', key: 'moveDown', value: controls.moveDown || 's' },\n                    { label: 'Move Left', key: 'moveLeft', value: controls.moveLeft || 'a' },\n                    { label: 'Move Right', key: 'moveRight', value: controls.moveRight || 'd' },\n                    { label: 'Pause', key: 'pause', value: controls.pause || 'escape' },\n                    { label: 'Interact', key: 'interact', value: controls.interact || 'space' }\n                ];\n                \n                controlLabels.forEach((control, index) => {\n                    const y = startY + index * itemSpacing;\n                    \n                    // Label (moved left for consistency)\n                    const labelText = k.add([\n                        k.text(control.label + ':', { size: 16 }),\n                        k.pos(150, y),\n                        k.anchor('left'),\n                        k.color(200, 200, 200),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                    ]);\n                    \n                    // Key display (moved right for more space)\n                    const keyDisplay = k.add([\n                        k.rect(100, 30),\n                        k.pos(500, y),\n                        k.anchor('center'),\n                        k.color(50, 50, 70),\n                        k.outline(2, k.rgb(100, 100, 120)),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                    ]);\n                    \n                    const keyText = k.add([\n                        k.text(control.value.toUpperCase(), { size: 16 }),\n                        k.pos(500, y),\n                        k.anchor('center'),\n                        k.color(255, 255, 255),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    \n                    settingsItems.push(labelText, keyDisplay, keyText);\n                });\n                \n                // Note about remapping (positioned to avoid button overlap)\n                const maxContentY = startY + controlLabels.length * itemSpacing;\n                if (maxContentY < k.height() - bottomButtonArea) {\n                    const noteText = k.add([\n                        k.text('(Key remapping coming soon)', { size: 12 }),\n                        k.pos(k.width() / 2, maxContentY + 20),\n                        k.anchor('center'),\n                        k.color(150, 150, 150),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                    ]);\n                    settingsItems.push(noteText);\n                }\n                \n            } else if (currentTab === 'gameplay') {\n                // Auto-pause on level up\n                currentY = addToggle(k, 'Auto-pause on Level Up', settings.gameplay?.autoPause || false, currentY, (value) => {\n                    updateSetting('gameplay', 'autoPause', value);\n                });\n\n                // Auto-pickup Currency\n                currentY = addToggle(k, 'Auto-pickup Currency', settings.gameplay?.autoPickupCurrency || false, currentY, (value) => {\n                    updateSetting('gameplay', 'autoPickupCurrency', value);\n                });\n\n                // Auto-pickup XP\n                currentY = addToggle(k, 'Auto-pickup XP', settings.gameplay?.autoPickupXP || false, currentY, (value) => {\n                    updateSetting('gameplay', 'autoPickupXP', value);\n                });\n\n                // Confirm Before Quit\n                currentY = addToggle(k, 'Confirm Before Quit', settings.gameplay?.confirmBeforeQuit !== false, currentY, (value) => {\n                    updateSetting('gameplay', 'confirmBeforeQuit', value);\n                });\n\n                // Skip Intro Animation\n                currentY = addToggle(k, 'Skip Intro Animation', settings.gameplay?.skipIntroAnimation || false, currentY, (value) => {\n                    updateSetting('gameplay', 'skipIntroAnimation', value);\n                });\n\n            } else if (currentTab === 'access') {\n                // Accessibility tab\n\n                // Reduced Motion - disables particles, screen shake, and hit freeze\n                currentY = addToggle(k, 'Reduced Motion', settings.accessibility?.reducedMotion || false, currentY, (value) => {\n                    updateSetting('accessibility', 'reducedMotion', value);\n                });\n\n                // Info text explaining reduced motion\n                const infoText = k.add([\n                    k.text('Disables particles, screen shake, and hit freeze effects', { size: 12 }),\n                    k.pos(k.width() / 2, currentY + 10),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n                settingsItems.push(infoText);\n                currentY += 40;\n\n            } else if (currentTab === 'data') {\n                // Data management tab\n\n                // Export Save button\n                const exportButton = k.add([\n                    k.rect(200, 35),\n                    k.pos(k.width() / 2, currentY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.BG_MEDIUM),\n                    k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                    k.area(),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                ]);\n\n                const exportText = k.add([\n                    k.text('Export Save Data', { size: UI_TEXT_SIZES.SMALL }),\n                    k.pos(k.width() / 2, currentY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_PRIMARY),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n\n                let exportStatusText = null;\n\n                exportButton.onClick(() => {\n                    try {\n                        const saveData = localStorage.getItem('superSmashTexty_save') || '{}';\n                        // Check if clipboard API is available\n                        if (navigator.clipboard && navigator.clipboard.writeText) {\n                            navigator.clipboard.writeText(saveData).then(() => {\n                                if (exportStatusText && exportStatusText.exists()) {\n                                    exportStatusText.text = 'Copied to clipboard!';\n                                    exportStatusText.color = k.rgb(...UI_COLORS.SUCCESS);\n                                }\n                            }).catch(() => {\n                                if (exportStatusText && exportStatusText.exists()) {\n                                    exportStatusText.text = 'Failed to copy';\n                                    exportStatusText.color = k.rgb(...UI_COLORS.DANGER);\n                                }\n                            });\n                        } else {\n                            // Fallback: show the data in console\n                            console.log('Save data:', saveData);\n                            if (exportStatusText && exportStatusText.exists()) {\n                                exportStatusText.text = 'Check browser console (F12)';\n                                exportStatusText.color = k.rgb(...UI_COLORS.TEXT_SECONDARY);\n                            }\n                        }\n                    } catch (e) {\n                        console.error('Export failed:', e);\n                    }\n                });\n                settingsItems.push(exportButton, exportText);\n                currentY += 50;\n\n                // Status text for export\n                exportStatusText = k.add([\n                    k.text('', { size: UI_TEXT_SIZES.SMALL - 2 }),\n                    k.pos(k.width() / 2, currentY - 10),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n                settingsItems.push(exportStatusText);\n                currentY += 30;\n\n                // Import Save button\n                const importButton = k.add([\n                    k.rect(200, 35),\n                    k.pos(k.width() / 2, currentY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.BG_MEDIUM),\n                    k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                    k.area(),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                ]);\n\n                const importText = k.add([\n                    k.text('Import Save Data', { size: UI_TEXT_SIZES.SMALL }),\n                    k.pos(k.width() / 2, currentY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_PRIMARY),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n\n                importButton.onClick(() => {\n                    // Check if clipboard API is available\n                    if (!navigator.clipboard || !navigator.clipboard.readText) {\n                        if (exportStatusText && exportStatusText.exists()) {\n                            exportStatusText.text = 'Clipboard not available';\n                            exportStatusText.color = k.rgb(...UI_COLORS.DANGER);\n                        }\n                        return;\n                    }\n                    navigator.clipboard.readText().then((text) => {\n                        try {\n                            const data = JSON.parse(text);\n                            if (data && typeof data === 'object') {\n                                localStorage.setItem('superSmashTexty_save', text);\n                                if (exportStatusText && exportStatusText.exists()) {\n                                    exportStatusText.text = 'Import successful! Refresh to apply.';\n                                    exportStatusText.color = k.rgb(...UI_COLORS.SUCCESS);\n                                }\n                            }\n                        } catch (e) {\n                            if (exportStatusText && exportStatusText.exists()) {\n                                exportStatusText.text = 'Invalid save data';\n                                exportStatusText.color = k.rgb(...UI_COLORS.DANGER);\n                            }\n                        }\n                    }).catch(() => {\n                        if (exportStatusText && exportStatusText.exists()) {\n                            exportStatusText.text = 'Failed to read clipboard';\n                            exportStatusText.color = k.rgb(...UI_COLORS.DANGER);\n                        }\n                    });\n                });\n                settingsItems.push(importButton, importText);\n                currentY += 60;\n\n                // Reset Progress button\n                const resetProgressButton = k.add([\n                    k.rect(200, 35),\n                    k.pos(k.width() / 2, currentY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.DANGER),\n                    k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                    k.area(),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                ]);\n\n                const resetProgressText = k.add([\n                    k.text('Reset All Progress', { size: UI_TEXT_SIZES.SMALL }),\n                    k.pos(k.width() / 2, currentY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_PRIMARY),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n\n                resetProgressButton.onClick(() => {\n                    // Double-confirm for dangerous action\n                    showResetConfirmationDialog(k, () => {\n                        localStorage.removeItem('superSmashTexty_save');\n                        if (exportStatusText && exportStatusText.exists()) {\n                            exportStatusText.text = 'Progress reset! Refresh to apply.';\n                            exportStatusText.color = k.rgb(...UI_COLORS.SUCCESS);\n                        }\n                    });\n                });\n                settingsItems.push(resetProgressButton, resetProgressText);\n                currentY += 50;\n\n                // Warning note\n                const warningText = k.add([\n                    k.text('Warning: Reset cannot be undone!', { size: 10 }),\n                    k.pos(k.width() / 2, currentY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.DANGER),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                ]);\n                settingsItems.push(warningText);\n            }\n        }\n        \n        // Helper function to add volume slider\n        function addVolumeSlider(k, label, value, y, onChange) {\n            // Label (moved left for more space)\n            const labelText = k.add([\n                k.text(label + ':', { size: 16 }),\n                k.pos(150, y),\n                k.anchor('left'),\n                k.color(200, 200, 200),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n            \n            // Slider track (moved right for more space)\n            const trackWidth = 300;\n            const trackHeight = 20;\n            const track = k.add([\n                k.rect(trackWidth, trackHeight),\n                k.pos(500, y),\n                k.anchor('center'),\n                k.color(50, 50, 70),\n                k.outline(2, k.rgb(100, 100, 120)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n            \n            // Helper function to get gradient color based on value (0-1)\n            // Red (low) -> Yellow (mid) -> Green (high)\n            // Returns an object with r, g, b values for use with k.color()\n            function getGradientColor(val) {\n                if (val < 0.5) {\n                    // Red to Yellow\n                    const t = val * 2; // 0 to 1\n                    return {\n                        r: 255, // Red stays max\n                        g: Math.round(255 * t), // Green increases\n                        b: 0 // Blue stays 0\n                    };\n                } else {\n                    // Yellow to Green\n                    const t = (val - 0.5) * 2; // 0 to 1\n                    return {\n                        r: Math.round(255 * (1 - t)), // Red decreases\n                        g: 255, // Green stays max\n                        b: 0 // Blue stays 0\n                    };\n                }\n            }\n            \n            // Slider fill (use k.color() to properly set the gradient color)\n            const fillWidth = trackWidth * value;\n            const fillColor = getGradientColor(value);\n            const fill = k.add([\n                k.rect(fillWidth, trackHeight - 4),\n                k.pos(500 - (trackWidth - fillWidth) / 2, y),\n                k.anchor('center'),\n                k.color(fillColor.r, fillColor.g, fillColor.b),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            \n            // Slider handle\n            const handleX = 500 - trackWidth / 2 + fillWidth;\n            const handle = k.add([\n                k.rect(20, trackHeight + 4),\n                k.pos(handleX, y),\n                k.anchor('center'),\n                k.color(200, 200, 255),\n                k.outline(2, k.rgb(150, 150, 200)),\n                k.area(),\n                k.fixed(),\n                k.z(1002)\n            ]);\n            \n            // Value text (moved further right to avoid clipping)\n            const valueText = k.add([\n                k.text(Math.round(value * 100) + '%', { size: 14 }),\n                k.pos(650 + 30, y),\n                k.anchor('left'),\n                k.color(255, 255, 255),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n            \n            // Slider interaction\n            let dragging = false;\n            let lastPreviewValue = -1; // Track last value we previewed sound at\n            \n            track.onClick(() => {\n                const mouseX = k.mousePos().x;\n                const trackLeft = 500 - trackWidth / 2;\n                const localX = mouseX - trackLeft;\n                const newValue = Math.max(0, Math.min(1, localX / trackWidth));\n                updateSlider(newValue);\n            });\n            \n            handle.onClick(() => {\n                dragging = true;\n            });\n            \n            k.onMouseMove(() => {\n                if (dragging && k.isMouseDown()) {\n                    const mouseX = k.mousePos().x;\n                    const trackLeft = 500 - trackWidth / 2;\n                    const localX = mouseX - trackLeft;\n                    const newValue = Math.max(0, Math.min(1, localX / trackWidth));\n                    updateSlider(newValue);\n                } else {\n                    dragging = false;\n                }\n            });\n            \n            k.onMouseRelease(() => {\n                dragging = false;\n            });\n            \n            function updateSlider(newValue) {\n                const newFillWidth = trackWidth * newValue;\n                fill.width = newFillWidth;\n                fill.pos.x = 500 - (trackWidth - newFillWidth) / 2;\n                handle.pos.x = 500 - trackWidth / 2 + newFillWidth;\n                valueText.text = Math.round(newValue * 100) + '%';\n                \n                // Update gradient color\n                const newColor = getGradientColor(newValue);\n                fill.color = k.rgb(newColor.r, newColor.g, newColor.b);\n                \n                // Preview sound at specific intervals (0%, 25%, 50%, 75%, 100%)\n                // Only play if we cross a threshold to avoid spam\n                const thresholds = [0, 0.25, 0.5, 0.75, 1.0];\n                const crossedThreshold = thresholds.some(threshold => {\n                    const wasBelow = lastPreviewValue < threshold;\n                    const isAbove = newValue >= threshold;\n                    return wasBelow && isAbove;\n                });\n                \n                if (crossedThreshold) {\n                    // Note: Audio preview would go here when audio system is implemented\n                    // Example: k.play('volumePreview', { volume: newValue });\n                    lastPreviewValue = newValue;\n                }\n                \n                onChange(newValue);\n            }\n            \n            settingsItems.push(labelText, track, fill, handle, valueText);\n            return y + itemSpacing;\n        }\n        \n        // Helper function to add toggle\n        function addToggle(k, label, value, y, onChange) {\n            // Label (moved left for more space, with max width to prevent overflow)\n            const labelText = k.add([\n                k.text(label + ':', { size: 16, width: 280 }),\n                k.pos(150, y),\n                k.anchor('left'),\n                k.color(200, 200, 200),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n\n            // Toggle background (wider to fit ON/OFF text, moved further right)\n            const toggleWidth = 80;\n            const toggleHeight = 30;\n            const toggleX = 550;\n            const toggleBg = k.add([\n                k.rect(toggleWidth, toggleHeight),\n                k.pos(toggleX, y),\n                k.anchor('center'),\n                k.color(value ? 50 : 70, value ? 150 : 50, value ? 50 : 70),\n                k.outline(2, k.rgb(100, 100, 120)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n\n            // Toggle handle\n            const handleSize = 24;\n            const handleX = value ? toggleX + toggleWidth / 2 - handleSize / 2 - 4 : toggleX - toggleWidth / 2 + handleSize / 2 + 4;\n            const toggleHandle = k.add([\n                k.rect(handleSize, handleSize),\n                k.pos(handleX, y),\n                k.anchor('center'),\n                k.color(255, 255, 255),\n                k.outline(1, k.rgb(200, 200, 200)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            // Toggle text (positioned based on current state)\n            const textX = value ? toggleX - 12 : toggleX + 8;\n            const toggleText = k.add([\n                k.text(value ? 'ON' : 'OFF', { size: 12 }),\n                k.pos(textX, y),\n                k.anchor('center'),\n                k.color(value ? 100 : 150, value ? 255 : 150, value ? 100 : 150),\n                k.fixed(),\n                k.z(1002)\n            ]);\n\n            // Click handler\n            toggleBg.onClick(() => {\n                const newValue = !value;\n                value = newValue; // Update local value for text positioning\n                toggleBg.color = k.rgb(\n                    newValue ? 50 : 70,\n                    newValue ? 150 : 50,\n                    newValue ? 50 : 70\n                );\n                toggleHandle.pos.x = newValue ? toggleX + toggleWidth / 2 - handleSize / 2 - 4 : toggleX - toggleWidth / 2 + handleSize / 2 + 4;\n                toggleText.text = newValue ? 'ON' : 'OFF';\n                toggleText.pos.x = newValue ? toggleX - 12 : toggleX + 8;\n                toggleText.color = k.rgb(\n                    newValue ? 100 : 150,\n                    newValue ? 255 : 150,\n                    newValue ? 100 : 150\n                );\n                onChange(newValue);\n            });\n\n            settingsItems.push(labelText, toggleBg, toggleHandle, toggleText);\n            return y + itemSpacing;\n        }\n        \n        // Button sizes\n        const { MD, SM } = UI_SIZES.BUTTON;\n\n        // Reset button (created outside refreshSettings to avoid destruction on refresh)\n        const resetButton = k.add([\n            k.rect(MD.width, MD.height),\n            k.pos(k.width() / 2 + 80, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.DANGER),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n\n        const resetText = k.add([\n            k.text('RESET', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2 + 80, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        resetButton.onClick(() => {\n            // Show confirmation dialog\n            showResetConfirmationDialog(k, () => {\n                resetSettings();\n                refreshSettings();\n            });\n        });\n\n        // Initial refresh\n        refreshSettings();\n\n        // Back button (SM size - secondary action)\n        const backButton = k.add([\n            k.rect(SM.width, SM.height),\n            k.pos(k.width() / 2 - 80, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.NEUTRAL),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n\n        const backText = k.add([\n            k.text('BACK', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2 - 80, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n        \n        backButton.onClick(() => {\n            if (fromGame) {\n                k.go('game');\n            } else {\n                k.go('menu');\n            }\n        });\n        \n        k.onKeyPress('escape', () => {\n            if (fromGame) {\n                k.go('game');\n            } else {\n                k.go('menu');\n            }\n        });\n    });\n}\n\n","// Statistics and Achievements scene\nimport { getSaveStats, getUnlockedAchievements, getCurrencyName, getRunHistory } from '../systems/metaProgression.js';\nimport { ACHIEVEMENTS, getAchievementCategories, getAchievementsByCategory, ACHIEVEMENT_COLORS, getAchievementProgress } from '../data/achievements.js';\nimport { playMenuNav } from '../systems/sounds.js';\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS,\n    formatButtonText,\n    createMenuParticles,\n    createAnimatedTitle\n} from '../config/uiConfig.js';\n\n// Helper function to convert HSL to RGB for rainbow gradient\nfunction hslToRgb(h, s, l) {\n    // Clamp inputs to valid ranges\n    h = Math.max(0, Math.min(1, h));\n    s = Math.max(0, Math.min(1, s));\n    l = Math.max(0, Math.min(1, l));\n\n    let r, g, b;\n    if (s === 0) {\n        r = g = b = l; // achromatic\n    } else {\n        const hue2rgb = (p, q, t) => {\n            if (t < 0) t += 1;\n            if (t > 1) t -= 1;\n            if (t < 1/6) return p + (q - p) * 6 * t;\n            if (t < 1/2) return q;\n            if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n            return p;\n        };\n        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        const p = 2 * l - q;\n        r = hue2rgb(p, q, h + 1/3);\n        g = hue2rgb(p, q, h);\n        b = hue2rgb(p, q, h - 1/3);\n    }\n    // Ensure RGB values are valid integers\n    return [\n        Math.max(0, Math.min(255, Math.round(r * 255))),\n        Math.max(0, Math.min(255, Math.round(g * 255))),\n        Math.max(0, Math.min(255, Math.round(b * 255)))\n    ];\n}\n\nexport function setupStatisticsScene(k) {\n    k.scene('statistics', () => {\n        const stats = getSaveStats();\n        const unlockedAchievements = getUnlockedAchievements();\n        const currencyName = getCurrencyName();\n        let currentTab = 'achievements'; // achievements, stats, or history\n        let achievementCategory = 'all'; // all, or specific category\n        let currentPage = 0;\n        const ACHIEVEMENTS_PER_PAGE = 15; // 5x3 grid\n        const RUNS_PER_PAGE = 8; // History tab rows per page\n        let isNavigating = false; // Debounce flag for pagination and category tabs\n        let selectedAchievement = null; // Currently selected achievement for detail panel\n\n        // Background\n        k.add([\n            k.rect(k.width(), k.height()),\n            k.pos(0, 0),\n            k.anchor('topleft'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.BACKGROUND)\n        ]);\n\n        // Background particle effects\n        createMenuParticles(k, { patternCount: 10, particleCount: 15 });\n\n        // Title (moved up to avoid collision with tabs)\n        createAnimatedTitle(k, 'RATINGS AND RECORDS', k.width() / 2, 35, 8);\n\n        // Tab buttons (centered like Settings menu)\n        const tabY = 80;\n        const tabSpacing = 160; // Increased spacing to add padding between buttons\n        const tabWidth = 150;\n        const tabHeight = 30;\n\n        const tabs = [\n            { key: 'achievements', label: 'Achievements' },\n            { key: 'history', label: 'History' }\n        ];\n\n        // Calculate centered positions for tabs (same as Settings menu)\n        const totalTabWidth = (tabs.length - 1) * tabSpacing;\n        const firstTabX = k.width() / 2 - totalTabWidth / 2;\n\n        const tabButtons = [];\n        tabs.forEach((tab, index) => {\n            const tabX = firstTabX + index * tabSpacing;\n            const isActive = currentTab === tab.key;\n\n            const tabBg = k.add([\n                k.rect(tabWidth, tabHeight),\n                k.pos(tabX, tabY),\n                k.anchor('center'),\n                k.color(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM)),\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n\n            const tabLabel = k.add([\n                k.text(tab.label, { size: UI_TEXT_SIZES.BODY }),\n                k.pos(tabX, tabY),\n                k.anchor('center'),\n                k.color(...(isActive ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_TERTIARY)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            tabBg.onClick(() => {\n                if (isNavigating) return;\n                isNavigating = true;\n                playMenuNav();\n                currentTab = tab.key;\n                currentPage = 0;\n                achievementCategory = 'all';\n                k.wait(0, () => {\n                    refreshContent();\n                    k.wait(0.1, () => { isNavigating = false; });\n                });\n            });\n\n            tabButtons.push({ bg: tabBg, label: tabLabel, key: tab.key });\n        });\n\n        // Content area\n        const contentY = 140;\n        const backButtonArea = 80; // Increased space for back button\n        const viewportBottom = k.height() - backButtonArea;\n        let contentItems = [];\n        let categoryTabItems = [];\n\n        // Get all achievement categories\n        const allCategories = ['all', ...getAchievementCategories()];\n\n        // Refresh content display\n        function refreshContent() {\n            // Verify k is available\n            if (!k || typeof k.add !== 'function') {\n                console.error('k is not available or k.add is not a function');\n                return;\n            }\n\n            // Update tab visuals\n            tabButtons.forEach(tab => {\n                const isActive = currentTab === tab.key;\n                tab.bg.color = k.rgb(\n                    isActive ? 100 : 50,\n                    isActive ? 100 : 50,\n                    isActive ? 150 : 80\n                );\n                tab.label.color = k.rgb(\n                    isActive ? 255 : 150,\n                    isActive ? 255 : 150,\n                    isActive ? 255 : 150\n                );\n            });\n\n            // Clear existing items\n            contentItems.forEach(item => {\n                if (item && typeof item.exists === 'function' && item.exists()) {\n                    try {\n                        k.destroy(item);\n                    } catch (e) {\n                        console.warn('Error destroying content item:', e);\n                    }\n                }\n            });\n            contentItems = [];\n\n            // Clear category tab items\n            categoryTabItems.forEach(item => {\n                if (item && typeof item.exists === 'function' && item.exists()) {\n                    try {\n                        k.destroy(item);\n                    } catch (e) {\n                        console.warn('Error destroying category tab item:', e);\n                    }\n                }\n            });\n            categoryTabItems = [];\n\n            if (currentTab === 'achievements') {\n                try {\n                    // ========================================================\n                    // SPLIT PANEL LAYOUT: Grid on left, Detail panel on right\n                    // ========================================================\n\n                    // Layout constants\n                    const panelGap = 20;\n                    const leftPanelWidth = 320;\n                    const rightPanelWidth = 300;\n                    const totalWidth = leftPanelWidth + panelGap + rightPanelWidth;\n                    const startX = (k.width() - totalWidth) / 2;\n                    const panelTop = contentY + 5;\n                    const panelHeight = viewportBottom - panelTop - 80;\n\n                    // Category tabs (horizontal, above the panels)\n                    const categoryTabY = panelTop;\n                    const categoryTabWidth = 70;\n                    const categoryTabHeight = 22;\n                    const categoryTabSpacing = 75;\n\n                    const displayCategories = allCategories.slice(0, 7);\n                    const totalCategoryWidth = (displayCategories.length - 1) * categoryTabSpacing;\n                    const firstCategoryX = k.width() / 2 - totalCategoryWidth / 2;\n\n                    displayCategories.forEach((cat, index) => {\n                        const catX = firstCategoryX + index * categoryTabSpacing;\n                        const isActive = achievementCategory === cat;\n                        const catName = cat === 'all' ? 'All' : cat.charAt(0).toUpperCase() + cat.slice(1);\n\n                        const catBg = k.add([\n                            k.rect(categoryTabWidth, categoryTabHeight),\n                            k.pos(catX, categoryTabY),\n                            k.anchor('center'),\n                            k.color(isActive ? 80 : 40, isActive ? 80 : 40, isActive ? 120 : 60),\n                            k.outline(1, k.rgb(100, 100, 150)),\n                            k.area(),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n\n                        const catLabel = k.add([\n                            k.text(catName, { size: 11 }),\n                            k.pos(catX, categoryTabY),\n                            k.anchor('center'),\n                            k.color(isActive ? 255 : 150, isActive ? 255 : 150, isActive ? 255 : 150),\n                            k.fixed(),\n                            k.z(1001)\n                        ]);\n\n                        catBg.onClick(() => {\n                            if (isNavigating) return;\n                            isNavigating = true;\n                            playMenuNav();\n                            achievementCategory = cat;\n                            currentPage = 0;\n                            selectedAchievement = null;\n                            k.wait(0, () => {\n                                refreshContent();\n                                k.wait(0.1, () => { isNavigating = false; });\n                            });\n                        });\n\n                        categoryTabItems.push(catBg, catLabel);\n                    });\n\n                    // Get achievements for current category\n                    let categoryAchievements;\n                    if (achievementCategory === 'all') {\n                        categoryAchievements = Object.values(ACHIEVEMENTS);\n                    } else {\n                        categoryAchievements = getAchievementsByCategory(achievementCategory);\n                    }\n\n                    // Pagination\n                    const totalPages = Math.ceil(categoryAchievements.length / ACHIEVEMENTS_PER_PAGE);\n                    if (currentPage >= totalPages) currentPage = Math.max(0, totalPages - 1);\n\n                    const startIndex = currentPage * ACHIEVEMENTS_PER_PAGE;\n                    const pageAchievements = categoryAchievements.slice(startIndex, startIndex + ACHIEVEMENTS_PER_PAGE);\n\n                    // ========== LEFT PANEL: Achievement Grid ==========\n                    const gridTop = panelTop + 35;\n                    const boxSize = 50;\n                    const boxSpacing = 8;\n                    const boxesPerRow = 5;\n                    const rowHeight = boxSize + 22;\n                    const gridStartX = startX;\n\n                    // Left panel background\n                    const leftPanelBg = k.add([\n                        k.rect(leftPanelWidth, panelHeight - 35),\n                        k.pos(startX, gridTop),\n                        k.anchor('topleft'),\n                        k.color(25, 25, 35),\n                        k.outline(2, k.rgb(60, 60, 80)),\n                        k.fixed(),\n                        k.z(999)\n                    ]);\n                    contentItems.push(leftPanelBg);\n\n                    // Achievement grid\n                    const gridPadding = 15;\n                    pageAchievements.forEach((achievement, index) => {\n                        const isUnlocked = unlockedAchievements.includes(achievement.id);\n                        const isSelected = selectedAchievement && selectedAchievement.id === achievement.id;\n                        const row = Math.floor(index / boxesPerRow);\n                        const col = index % boxesPerRow;\n                        const boxX = gridStartX + gridPadding + col * (boxSize + boxSpacing);\n                        const boxY = gridTop + gridPadding + row * rowHeight;\n\n                        const difficultyColor = ACHIEVEMENT_COLORS[achievement.difficulty] || ACHIEVEMENT_COLORS.normal;\n\n                        // Selection highlight\n                        const highlightColor = isSelected ? [100, 100, 180] : (isUnlocked ? [50, 50, 65] : [30, 30, 40]);\n                        const borderColor = isSelected ? [150, 150, 255] : (isUnlocked ? difficultyColor : [50, 50, 60]);\n\n                        const boxBg = k.add([\n                            k.rect(boxSize, boxSize),\n                            k.pos(boxX, boxY),\n                            k.anchor('topleft'),\n                            k.color(...highlightColor),\n                            k.outline(isSelected ? 3 : 2, k.rgb(...borderColor)),\n                            k.area({ width: boxSize, height: boxSize }),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n\n                        const iconText = k.add([\n                            k.text(achievement.icon, { size: 24 }),\n                            k.pos(boxX + boxSize / 2, boxY + boxSize / 2),\n                            k.anchor('center'),\n                            k.color(isUnlocked ? 255 : 80, isUnlocked ? 255 : 80, isUnlocked ? 255 : 80),\n                            k.fixed(),\n                            k.z(1001)\n                        ]);\n\n                        // Progress bar under locked achievements\n                        if (!isUnlocked) {\n                            const progress = getAchievementProgress(achievement.id, stats);\n                            if (progress && progress.percentage > 0) {\n                                const barWidth = boxSize - 4;\n                                const fillWidth = barWidth * progress.progress;\n\n                                const progressBg = k.add([\n                                    k.rect(barWidth, 4),\n                                    k.pos(boxX + 2, boxY + boxSize - 6),\n                                    k.anchor('topleft'),\n                                    k.color(20, 20, 30),\n                                    k.fixed(),\n                                    k.z(1001)\n                                ]);\n                                contentItems.push(progressBg);\n\n                                if (fillWidth > 0) {\n                                    const progressFill = k.add([\n                                        k.rect(fillWidth, 4),\n                                        k.pos(boxX + 2, boxY + boxSize - 6),\n                                        k.anchor('topleft'),\n                                        k.color(...difficultyColor),\n                                        k.opacity(0.8),\n                                        k.fixed(),\n                                        k.z(1002)\n                                    ]);\n                                    contentItems.push(progressFill);\n                                }\n                            }\n                        }\n\n                        // Click handler - select achievement\n                        boxBg.onClick(() => {\n                            if (isNavigating) return;\n                            playMenuNav();\n                            selectedAchievement = achievement;\n                            isNavigating = true;\n                            k.wait(0, () => {\n                                refreshContent();\n                                k.wait(0.1, () => { isNavigating = false; });\n                            });\n                        });\n\n                        contentItems.push(boxBg, iconText);\n                    });\n\n                    // ========== RIGHT PANEL: Detail View ==========\n                    const rightPanelX = startX + leftPanelWidth + panelGap;\n\n                    // Right panel background\n                    const rightPanelBg = k.add([\n                        k.rect(rightPanelWidth, panelHeight - 35),\n                        k.pos(rightPanelX, gridTop),\n                        k.anchor('topleft'),\n                        k.color(30, 28, 40),\n                        k.outline(2, k.rgb(70, 70, 100)),\n                        k.fixed(),\n                        k.z(999)\n                    ]);\n                    contentItems.push(rightPanelBg);\n\n                    // Detail content\n                    const detailCenterX = rightPanelX + rightPanelWidth / 2;\n                    const detailTop = gridTop + 20;\n\n                    if (selectedAchievement) {\n                        const ach = selectedAchievement;\n                        const isUnlocked = unlockedAchievements.includes(ach.id);\n                        const progress = getAchievementProgress(ach.id, stats);\n                        const difficultyColor = ACHIEVEMENT_COLORS[ach.difficulty] || ACHIEVEMENT_COLORS.normal;\n\n                        // Large icon\n                        const iconBg = k.add([\n                            k.rect(70, 70),\n                            k.pos(detailCenterX, detailTop + 35),\n                            k.anchor('center'),\n                            k.color(isUnlocked ? 45 : 25, isUnlocked ? 45 : 25, isUnlocked ? 55 : 30),\n                            k.outline(3, k.rgb(...(isUnlocked ? difficultyColor : [60, 60, 70]))),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n                        contentItems.push(iconBg);\n\n                        const largeIcon = k.add([\n                            k.text(ach.icon, { size: 40 }),\n                            k.pos(detailCenterX, detailTop + 35),\n                            k.anchor('center'),\n                            k.color(isUnlocked ? 255 : 100, isUnlocked ? 255 : 100, isUnlocked ? 255 : 100),\n                            k.fixed(),\n                            k.z(1001)\n                        ]);\n                        contentItems.push(largeIcon);\n\n                        // Achievement name\n                        const nameText = k.add([\n                            k.text(ach.name, { size: 16 }),\n                            k.pos(detailCenterX, detailTop + 85),\n                            k.anchor('center'),\n                            k.color(...(isUnlocked ? [255, 255, 255] : [180, 180, 180])),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n                        contentItems.push(nameText);\n\n                        // Difficulty badge\n                        const diffName = ach.difficulty.charAt(0).toUpperCase() + ach.difficulty.slice(1);\n                        const diffBadge = k.add([\n                            k.text(diffName, { size: 11 }),\n                            k.pos(detailCenterX, detailTop + 105),\n                            k.anchor('center'),\n                            k.color(...difficultyColor),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n                        contentItems.push(diffBadge);\n\n                        // Description\n                        const descText = k.add([\n                            k.text(ach.description, { size: 12 }),\n                            k.pos(detailCenterX, detailTop + 130),\n                            k.anchor('center'),\n                            k.color(180, 180, 200),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n                        contentItems.push(descText);\n\n                        // Status / Progress\n                        let statusY = detailTop + 160;\n                        if (isUnlocked) {\n                            const statusText = k.add([\n                                k.text('UNLOCKED', { size: 14 }),\n                                k.pos(detailCenterX, statusY),\n                                k.anchor('center'),\n                                k.color(100, 255, 100),\n                                k.fixed(),\n                                k.z(1000)\n                            ]);\n                            contentItems.push(statusText);\n                        } else if (progress) {\n                            // Progress bar\n                            const barWidth = 200;\n                            const barHeight = 16;\n\n                            const progressBgBar = k.add([\n                                k.rect(barWidth, barHeight),\n                                k.pos(detailCenterX, statusY),\n                                k.anchor('center'),\n                                k.color(30, 30, 45),\n                                k.outline(1, k.rgb(70, 70, 90)),\n                                k.fixed(),\n                                k.z(1000)\n                            ]);\n                            contentItems.push(progressBgBar);\n\n                            const fillWidth = Math.max(2, barWidth * progress.progress);\n                            const progressFillBar = k.add([\n                                k.rect(fillWidth, barHeight - 4),\n                                k.pos(detailCenterX - barWidth / 2 + fillWidth / 2, statusY),\n                                k.anchor('center'),\n                                k.color(...difficultyColor),\n                                k.opacity(0.9),\n                                k.fixed(),\n                                k.z(1001)\n                            ]);\n                            contentItems.push(progressFillBar);\n\n                            const progressLabel = k.add([\n                                k.text(`${progress.current} / ${progress.target}`, { size: 11 }),\n                                k.pos(detailCenterX, statusY + 20),\n                                k.anchor('center'),\n                                k.color(150, 150, 180),\n                                k.fixed(),\n                                k.z(1000)\n                            ]);\n                            contentItems.push(progressLabel);\n                            statusY += 35;\n                        }\n\n                        // Hint (if locked)\n                        if (!isUnlocked && ach.hint) {\n                            const hintY = statusY + 15;\n                            const hintLabel = k.add([\n                                k.text('Hint:', { size: 10 }),\n                                k.pos(detailCenterX, hintY),\n                                k.anchor('center'),\n                                k.color(120, 120, 140),\n                                k.fixed(),\n                                k.z(1000)\n                            ]);\n                            contentItems.push(hintLabel);\n\n                            const hintText = k.add([\n                                k.text(ach.hint, { size: 11 }),\n                                k.pos(detailCenterX, hintY + 18),\n                                k.anchor('center'),\n                                k.color(160, 160, 180),\n                                k.fixed(),\n                                k.z(1000)\n                            ]);\n                            contentItems.push(hintText);\n                        }\n\n                    } else {\n                        // No achievement selected - show prompt\n                        const promptIcon = k.add([\n                            k.text('', { size: 32 }),\n                            k.pos(detailCenterX, detailTop + 60),\n                            k.anchor('center'),\n                            k.color(150, 150, 180),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n                        contentItems.push(promptIcon);\n\n                        const promptText = k.add([\n                            k.text('Select an achievement', { size: 14 }),\n                            k.pos(detailCenterX, detailTop + 100),\n                            k.anchor('center'),\n                            k.color(120, 120, 150),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n                        contentItems.push(promptText);\n\n                        const promptText2 = k.add([\n                            k.text('to view details', { size: 12 }),\n                            k.pos(detailCenterX, detailTop + 120),\n                            k.anchor('center'),\n                            k.color(100, 100, 130),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n                        contentItems.push(promptText2);\n                    }\n\n                    // Pagination controls\n                    if (totalPages > 1) {\n                        const paginationY = viewportBottom - 55;\n                        const paginationCenterX = k.width() / 2;\n\n                        // Page indicator pips\n                        const pipSpacing = 20;\n                        const pipsStartX = paginationCenterX - ((totalPages - 1) * pipSpacing) / 2;\n                        const pipsEndX = paginationCenterX + ((totalPages - 1) * pipSpacing) / 2;\n\n                        // Arrows positioned outside the pips with offset for pip clickable area (16px) + gap\n                        const arrowOffset = 25;\n                        const leftArrowX = pipsStartX - arrowOffset;\n                        const rightArrowX = pipsEndX + arrowOffset;\n\n                        // Helper function to handle page change\n                        const goToPage = (newPage) => {\n                            if (isNavigating || newPage === currentPage || newPage < 0 || newPage >= totalPages) return;\n                            isNavigating = true;\n                            playMenuNav();\n                            currentPage = newPage;\n                            // Defer refresh to next frame to ensure clean destruction\n                            k.wait(0, () => {\n                                refreshContent();\n                                k.wait(0.15, () => { isNavigating = false; });\n                            });\n                        };\n\n                        for (let i = 0; i < totalPages; i++) {\n                            const isCurrentPip = i === currentPage;\n                            const pipX = pipsStartX + i * pipSpacing;\n\n                            const pipBg = k.add([\n                                k.rect(16, 16),\n                                k.pos(pipX, paginationY),\n                                k.anchor('center'),\n                                k.color(0, 0, 0),\n                                k.opacity(0),\n                                k.area({ width: 16, height: 16 }),\n                                k.fixed(),\n                                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                            ]);\n                            const pipText = k.add([\n                                k.text(isCurrentPip ? '' : '', { size: 14 }),\n                                k.pos(pipX, paginationY),\n                                k.anchor('center'),\n                                k.color(isCurrentPip ? 255 : 120, isCurrentPip ? 255 : 120, isCurrentPip ? 255 : 120),\n                                k.fixed(),\n                                k.z(UI_Z_LAYERS.UI_TEXT)\n                            ]);\n\n                            const pageIndex = i;\n                            pipBg.onClick(() => goToPage(pageIndex));\n                            pipBg.cursor = 'pointer';\n\n                            contentItems.push(pipBg, pipText);\n                        }\n\n                        // Left arrow (higher z-index to sit on top and take priority)\n                        const leftArrowBg = k.add([\n                            k.rect(30, 30),\n                            k.pos(leftArrowX, paginationY),\n                            k.anchor('center'),\n                            k.color(0, 0, 0),\n                            k.opacity(0),\n                            k.area({ width: 30, height: 30 }),\n                            k.fixed(),\n                            k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\n                        ]);\n                        const leftArrowText = k.add([\n                            k.text('<', { size: 24 }),\n                            k.pos(leftArrowX, paginationY),\n                            k.anchor('center'),\n                            k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\n                            k.fixed(),\n                            k.z(UI_Z_LAYERS.UI_TEXT + 1)\n                        ]);\n\n                        if (currentPage > 0) {\n                            const targetPage = currentPage - 1;\n                            leftArrowBg.onClick(() => goToPage(targetPage));\n                            leftArrowBg.cursor = 'pointer';\n                        }\n                        contentItems.push(leftArrowBg, leftArrowText);\n\n                        // Right arrow (higher z-index to sit on top and take priority)\n                        const rightArrowBg = k.add([\n                            k.rect(30, 30),\n                            k.pos(rightArrowX, paginationY),\n                            k.anchor('center'),\n                            k.color(0, 0, 0),\n                            k.opacity(0),\n                            k.area({ width: 30, height: 30 }),\n                            k.fixed(),\n                            k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\n                        ]);\n                        const rightArrowText = k.add([\n                            k.text('>', { size: 24 }),\n                            k.pos(rightArrowX, paginationY),\n                            k.anchor('center'),\n                            k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\n                            k.fixed(),\n                            k.z(UI_Z_LAYERS.UI_TEXT + 1)\n                        ]);\n\n                        if (currentPage < totalPages - 1) {\n                            const targetPage = currentPage + 1;\n                            rightArrowBg.onClick(() => goToPage(targetPage));\n                            rightArrowBg.cursor = 'pointer';\n                        }\n                        contentItems.push(rightArrowBg, rightArrowText);\n                    }\n\n                    // Achievement Trophy Meter - satisfying progress display\n                    const totalAchievements = Object.keys(ACHIEVEMENTS).length;\n                    const unlockedCount = unlockedAchievements.length;\n                    const progressPercent = unlockedCount / totalAchievements;\n                    const isComplete = progressPercent >= 1;\n\n                    const meterY = viewportBottom - 20;\n                    const meterX = k.width() / 2;\n\n                    // Trophy icon on the left\n                    const trophyIcon = k.add([\n                        k.text(isComplete ? '' : '', { size: 24 }),\n                        k.pos(meterX - 220, meterY),\n                        k.anchor('center'),\n                        k.color(isComplete ? 255 : 150, isComplete ? 215 : 150, isComplete ? 0 : 150),\n                        k.fixed(),\n                        k.scale(1),\n                        k.z(1002)\n                    ]);\n                    contentItems.push(trophyIcon);\n\n                    // Animated trophy for 100% completion\n                    if (isComplete) {\n                        let trophyTime = 0;\n                        trophyIcon.onUpdate(() => {\n                            trophyTime += k.dt();\n                            // Gentle pulse effect\n                            const scale = 1 + Math.sin(trophyTime * 3) * 0.1;\n                            trophyIcon.scale = k.vec2(scale, scale);\n                        });\n                    }\n\n                    // ASCII-style progress meter: ||\n                    const totalBlocks = 20;\n                    const filledBlocks = Math.floor(progressPercent * totalBlocks);\n                    const emptyBlocks = totalBlocks - filledBlocks;\n\n                    // Build the meter string with blocks\n                    let meterString = '';\n                    for (let i = 0; i < filledBlocks; i++) {\n                        meterString += '';\n                    }\n                    for (let i = 0; i < emptyBlocks; i++) {\n                        meterString += '';\n                    }\n\n                    // Meter background frame\n                    const meterFrame = k.add([\n                        k.text('|' + ''.repeat(totalBlocks) + '|', { size: 16 }),\n                        k.pos(meterX, meterY),\n                        k.anchor('center'),\n                        k.color(60, 60, 80),\n                        k.fixed(),\n                        k.z(1000)\n                    ]);\n                    contentItems.push(meterFrame);\n\n                    // Filled portion with color based on progress\n                    let fillColor;\n                    if (isComplete) {\n                        fillColor = [255, 215, 0]; // Gold for 100%\n                    } else if (progressPercent >= 0.75) {\n                        fillColor = [100, 255, 100]; // Green for 75%+\n                    } else if (progressPercent >= 0.5) {\n                        fillColor = [255, 255, 100]; // Yellow for 50%+\n                    } else if (progressPercent >= 0.25) {\n                        fillColor = [255, 180, 100]; // Orange for 25%+\n                    } else {\n                        fillColor = [200, 200, 200]; // Gray for less\n                    }\n\n                    const filledMeter = k.add([\n                        k.text('|' + meterString + '|', { size: 16 }),\n                        k.pos(meterX, meterY),\n                        k.anchor('center'),\n                        k.color(...fillColor),\n                        k.fixed(),\n                        k.z(1001)\n                    ]);\n                    contentItems.push(filledMeter);\n\n                    // Animate fill color for 100% completion (rainbow cycle)\n                    if (isComplete) {\n                        let colorTime = 0;\n                        filledMeter.onUpdate(() => {\n                            colorTime += k.dt();\n                            const hue = (colorTime * 60) % 360;\n                            const rgb = hslToRgb(hue / 360, 1, 0.6);\n                            filledMeter.color = k.rgb(rgb[0], rgb[1], rgb[2]);\n                        });\n                    }\n\n                    // Progress count and percentage\n                    const percentText = Math.round(progressPercent * 100);\n                    const statusText = isComplete ? 'COMPLETE!' : `${percentText}%`;\n                    const progressLabel = k.add([\n                        k.text(`${unlockedCount}/${totalAchievements}`, { size: 14 }),\n                        k.pos(meterX + 180, meterY - 8),\n                        k.anchor('center'),\n                        k.color(180, 180, 200),\n                        k.fixed(),\n                        k.z(1002)\n                    ]);\n                    contentItems.push(progressLabel);\n\n                    const statusLabel = k.add([\n                        k.text(statusText, { size: 12 }),\n                        k.pos(meterX + 180, meterY + 8),\n                        k.anchor('center'),\n                        k.color(...(isComplete ? [255, 215, 0] : [150, 150, 180])),\n                        k.fixed(),\n                        k.opacity(1),\n                        k.z(1002)\n                    ]);\n                    contentItems.push(statusLabel);\n\n                    // Sparkle effect for 100% completion\n                    if (isComplete) {\n                        let sparkleTime = 0;\n                        statusLabel.onUpdate(() => {\n                            sparkleTime += k.dt();\n                            const pulse = Math.sin(sparkleTime * 4) * 0.3 + 0.7;\n                            statusLabel.opacity = pulse;\n                        });\n                    }\n                } catch (e) {\n                    console.error('Error rendering achievements:', e);\n                    // Fallback: show error message\n                    const errorText = k.add([\n                        k.text('Error loading achievements', { size: 18 }),\n                        k.pos(k.width() / 2, contentY + 50),\n                        k.anchor('center'),\n                        k.color(255, 100, 100),\n                        k.fixed(),\n                        k.z(1000)\n                    ]);\n                    contentItems.push(errorText);\n                }\n            } else if (currentTab === 'history') {\n                // Display run history with pagination\n                const runHistory = getRunHistory();\n                const historyY = contentY + 10;\n                const rowHeight = 35;\n\n                if (runHistory.length === 0) {\n                    // No history yet\n                    const noHistoryText = k.add([\n                        k.text('No run history yet. Complete a run to see it here!', { size: 16 }),\n                        k.pos(k.width() / 2, historyY + 50),\n                        k.anchor('center'),\n                        k.color(150, 150, 150),\n                        k.fixed(),\n                        k.z(1000)\n                    ]);\n                    contentItems.push(noHistoryText);\n                } else {\n                    // Calculate pagination\n                    const totalPages = Math.ceil(runHistory.length / RUNS_PER_PAGE);\n                    if (currentPage >= totalPages) currentPage = Math.max(0, totalPages - 1);\n                    const startIndex = currentPage * RUNS_PER_PAGE;\n                    const endIndex = Math.min(startIndex + RUNS_PER_PAGE, runHistory.length);\n                    const displayRuns = runHistory.slice(startIndex, endIndex);\n\n                    // Header row\n                    const headers = ['#', 'Floor', 'Rooms', 'Kills', 'Level', 'Credits', 'Time'];\n                    const headerPositions = [60, 120, 200, 280, 360, 450, 550];\n\n                    headers.forEach((header, i) => {\n                        const headerText = k.add([\n                            k.text(header, { size: 14 }),\n                            k.pos(headerPositions[i], historyY),\n                            k.anchor('left'),\n                            k.color(255, 200, 100),\n                            k.fixed(),\n                            k.z(1000)\n                        ]);\n                        contentItems.push(headerText);\n                    });\n\n                    // Run history rows\n                    displayRuns.forEach((run, index) => {\n                        const y = historyY + (index + 1) * rowHeight;\n                        const globalIndex = startIndex + index + 1;\n\n                        // Format duration\n                        const mins = Math.floor(run.duration / 60);\n                        const secs = run.duration % 60;\n                        const timeStr = `${mins}:${secs.toString().padStart(2, '0')}`;\n\n                        const rowData = [\n                            `${globalIndex}`,\n                            `${run.floorsReached}`,\n                            `${run.roomsCleared}`,\n                            `${run.enemiesKilled}`,\n                            `${run.level}`,\n                            `${currencyName}${run.currencyEarned}`,\n                            timeStr\n                        ];\n\n                        rowData.forEach((value, i) => {\n                            const cellText = k.add([\n                                k.text(value, { size: 14 }),\n                                k.pos(headerPositions[i], y),\n                                k.anchor('left'),\n                                k.color(200, 200, 200),\n                                k.fixed(),\n                                k.z(1000)\n                            ]);\n                            contentItems.push(cellText);\n                        });\n                    });\n\n                    // Pagination controls (if more than one page)\n                    if (totalPages > 1) {\n                        const paginationY = viewportBottom - 55;\n                        const centerX = k.width() / 2;\n\n                        // Page pips\n                        const pipSpacing = 20;\n                        const pipsStartX = centerX - ((totalPages - 1) * pipSpacing) / 2;\n\n                        for (let i = 0; i < totalPages; i++) {\n                            const isCurrentPip = i === currentPage;\n                            const pipX = pipsStartX + i * pipSpacing;\n\n                            const pipBg = k.add([\n                                k.rect(16, 16),\n                                k.pos(pipX, paginationY),\n                                k.anchor('center'),\n                                k.color(0, 0, 0),\n                                k.opacity(0),\n                                k.area({ width: 16, height: 16 }),\n                                k.fixed(),\n                                k.z(1000)\n                            ]);\n\n                            const pipText = k.add([\n                                k.text(isCurrentPip ? '' : '', { size: 14 }),\n                                k.pos(pipX, paginationY),\n                                k.anchor('center'),\n                                k.color(isCurrentPip ? 255 : 120, isCurrentPip ? 255 : 120, isCurrentPip ? 255 : 120),\n                                k.fixed(),\n                                k.z(1001)\n                            ]);\n\n                            const pageIndex = i;\n                            pipBg.onClick(() => {\n                                if (isNavigating || pageIndex === currentPage) return;\n                                isNavigating = true;\n                                playMenuNav();\n                                currentPage = pageIndex;\n                                refreshContent();\n                                k.wait(0.1, () => { isNavigating = false; });\n                            });\n                            pipBg.cursor = 'pointer';\n\n                            contentItems.push(pipBg, pipText);\n                        }\n\n                        // Left/Right arrows\n                        const arrowOffset = Math.max(30, (totalPages * pipSpacing) / 2 + 25);\n\n                        // Left arrow\n                        const leftArrowBg = k.add([\n                            k.rect(30, 30),\n                            k.pos(centerX - arrowOffset, paginationY),\n                            k.anchor('center'),\n                            k.color(0, 0, 0),\n                            k.opacity(0),\n                            k.area({ width: 30, height: 30 }),\n                            k.fixed(),\n                            k.z(1002)\n                        ]);\n\n                        const leftArrowText = k.add([\n                            k.text('<', { size: 24 }),\n                            k.pos(centerX - arrowOffset, paginationY),\n                            k.anchor('center'),\n                            k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\n                            k.fixed(),\n                            k.z(1003)\n                        ]);\n\n                        if (currentPage > 0) {\n                            leftArrowBg.onClick(() => {\n                                if (isNavigating) return;\n                                isNavigating = true;\n                                playMenuNav();\n                                currentPage--;\n                                refreshContent();\n                                k.wait(0.1, () => { isNavigating = false; });\n                            });\n                            leftArrowBg.cursor = 'pointer';\n                        }\n                        contentItems.push(leftArrowBg, leftArrowText);\n\n                        // Right arrow\n                        const rightArrowBg = k.add([\n                            k.rect(30, 30),\n                            k.pos(centerX + arrowOffset, paginationY),\n                            k.anchor('center'),\n                            k.color(0, 0, 0),\n                            k.opacity(0),\n                            k.area({ width: 30, height: 30 }),\n                            k.fixed(),\n                            k.z(1002)\n                        ]);\n\n                        const rightArrowText = k.add([\n                            k.text('>', { size: 24 }),\n                            k.pos(centerX + arrowOffset, paginationY),\n                            k.anchor('center'),\n                            k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\n                            k.fixed(),\n                            k.z(1003)\n                        ]);\n\n                        if (currentPage < totalPages - 1) {\n                            rightArrowBg.onClick(() => {\n                                if (isNavigating) return;\n                                isNavigating = true;\n                                playMenuNav();\n                                currentPage++;\n                                refreshContent();\n                                k.wait(0.1, () => { isNavigating = false; });\n                            });\n                            rightArrowBg.cursor = 'pointer';\n                        }\n                        contentItems.push(rightArrowBg, rightArrowText);\n                    }\n\n                    // Show total runs count\n                    const showingStart = startIndex + 1;\n                    const showingEnd = endIndex;\n                    const totalText = k.add([\n                        k.text(`Showing ${showingStart}-${showingEnd} of ${runHistory.length} runs`, { size: 12 }),\n                        k.pos(k.width() / 2, viewportBottom - 20),\n                        k.anchor('center'),\n                        k.color(100, 100, 150),\n                        k.fixed(),\n                        k.z(1000)\n                    ]);\n                    contentItems.push(totalText);\n                }\n            }\n        }\n\n        // Initial refresh\n        refreshContent();\n\n        // Back button (SM size - secondary action)\n        const { SM } = UI_SIZES.BUTTON;\n        const backButton = k.add([\n            k.rect(SM.width, SM.height),\n            k.pos(k.width() / 2, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.NEUTRAL),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n\n        const backText = k.add([\n            k.text('BACK', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        backButton.onClick(() => {\n            playMenuNav();\n            k.go('menu');\n        });\n\n        k.onKeyPress('escape', () => {\n            k.go('menu');\n        });\n    });\n}\n","// Character selection scene\nimport { getCurrency, getCurrencyName, isUnlocked, setSelectedCharacter, getSelectedCharacter, isAchievementUnlocked } from '../systems/metaProgression.js';\nimport { broadcastCharacterChange } from '../systems/partySystem.js';\nimport { CHARACTER_UNLOCKS } from '../data/unlocks.js';\nimport { ACHIEVEMENTS } from '../data/achievements.js';\nimport { playMenuSelect, playMenuNav } from '../systems/sounds.js';\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS,\n    UI_TERMS,\n    formatButtonText,\n    formatStatLabel,\n    createCreditIndicator,\n    createMenuParticles,\n    createAnimatedTitle\n} from '../config/uiConfig.js';\nimport { createStatBar } from '../config/uiComponents.js';\n\n// Animation constants for character preview\nconst CHAR_ANIM = {\n    BREATHE_SPEED: 1.5,\n    BREATHE_AMOUNT: 0.04,\n    BOB_SPEED: 2,\n    BOB_AMOUNT: 3,\n    GLOW_PULSE_SPEED: 2,\n    GLOW_MIN: 0.3,\n    GLOW_MAX: 0.7\n};\n\n// Helper function to get unlock requirement text\nfunction getUnlockText(char) {\n    if (!char.unlockRequirement) return null;\n\n    if (char.unlockRequirement.type === 'floor') {\n        return `Unlock: Complete ${UI_TERMS.FLOOR} ${char.unlockRequirement.value}`;\n    } else if (char.unlockRequirement.type === 'achievement') {\n        const achievement = ACHIEVEMENTS[char.unlockRequirement.value];\n        if (achievement) {\n            return `Unlock: ${achievement.name}`;\n        }\n        return `Unlock: Achievement required`;\n    }\n    return null;\n}\n\nexport function setupCharacterSelectScene(k) {\n    k.scene('characterSelect', () => {\n        const currency = getCurrency();\n        const currencyName = getCurrencyName();\n        const selectedChar = getSelectedCharacter();\n        \n        // Background\n        k.add([\n            k.rect(k.width(), k.height()),\n            k.pos(0, 0),\n            k.anchor('topleft'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.BACKGROUND)\n        ]);\n\n        // Background particle effects\n        createMenuParticles(k, { patternCount: 10, particleCount: 15 });\n\n        // Currency display (standardized)\n        const creditIndicator = createCreditIndicator(k, currency, currencyName);\n\n        // Title\n        createAnimatedTitle(k, 'CONTESTANTS', k.width() / 2, 60, 8);\n        \n        // Character selection layout: Left side = selection grid, Right side = details\n        const characterKeys = Object.keys(CHARACTER_UNLOCKS);\n        const leftPanelWidth = 360;\n        const rightPanelX = leftPanelWidth + 20;\n        const rightPanelWidth = k.width() - rightPanelX - 20;\n        const startY = 110;\n        // Custom smaller card size to fit more characters\n        const cardWidth = 165;\n        const cardHeight = 70;\n        const cardSpacing = 8;\n        const cardsPerRow = 2;\n        const rowsPerPage = 5;\n        const charactersPerPage = cardsPerRow * rowsPerPage;\n\n        // Helper to strip \"The \" prefix from names for display\n        const formatName = (name) => name.replace(/^The\\s+/i, '');\n\n        // Helper to render description with highlighted stats\n        // Returns array of text elements\n        const renderHighlightedDescription = (description, x, y, maxWidth) => {\n            const elements = [];\n            // Regex to match stat patterns like \"+10% XP\", \"-20% health\", \"+2 orbital\", etc.\n            const statPattern = /([+-]?\\d+%?\\s*(?:XP|health|HP|speed|damage|crit|dodge|reduction|lifesteal|blast radius|drones?|orbital))/gi;\n\n            // Split description by stat patterns\n            const parts = description.split(statPattern);\n            const matches = description.match(statPattern) || [];\n\n            // Build text segments\n            let currentText = '';\n            const segments = [];\n\n            let matchIndex = 0;\n            parts.forEach((part, i) => {\n                if (i % 2 === 0) {\n                    // Regular text\n                    if (part) segments.push({ text: part, highlight: false });\n                } else {\n                    // Stat text (matched pattern)\n                    segments.push({ text: part, highlight: true });\n                }\n            });\n\n            // Render as a single line with color markup using Kaplay's text formatting\n            // Since Kaplay doesn't support inline color changes easily, we'll render separate elements\n            // For simplicity, we'll render the full text in secondary color and overlay highlighted parts\n\n            // Full description in secondary color\n            const baseText = k.add([\n                k.text(description, { size: UI_TEXT_SIZES.SMALL, width: maxWidth }),\n                k.pos(x, y),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            elements.push(baseText);\n\n            // Create highlighted overlay for stat values\n            // We need to extract positions - this is complex, so let's use a simpler approach:\n            // Re-render just the highlighted parts in a brighter color on top\n            // Since we can't get precise character positions, we'll use a different approach:\n            // Render the description with stat values in a highlight color (gold/yellow)\n\n            // Alternative approach: Use different formatting\n            // Actually, let's format the description by replacing stat values with colored versions\n            // Since we can't do inline colors, let's just make the whole description look different\n            // by adding a separate line for the key stat highlights\n\n            // Find all stat mentions and create a summary line\n            if (matches.length > 0) {\n                const statSummary = matches.join(' | ');\n                const highlightText = k.add([\n                    k.text(statSummary, { size: UI_TEXT_SIZES.TINY }),\n                    k.pos(x, y + 28),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.GOLD),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT + 1)\n                ]);\n                elements.push(highlightText);\n            }\n\n            return elements;\n        };\n\n        // Pagination state\n        const totalPages = Math.ceil(characterKeys.length / charactersPerPage);\n        let currentPage = 0;\n\n        // Find the page containing the selected character\n        const selectedIndex = characterKeys.indexOf(selectedChar || characterKeys[0]);\n        if (selectedIndex >= 0) {\n            currentPage = Math.floor(selectedIndex / charactersPerPage);\n        }\n\n        const characterCards = [];\n        const confirmedCharacterKey = selectedChar || characterKeys[0]; // The saved selection\n        let viewedCharacterKey = confirmedCharacterKey; // What's being viewed/previewed\n        let detailItems = [];\n        let paginationItems = [];\n        let isRefreshing = false; // Prevent infinite loops\n\n        // Function to refresh display\n        function refreshDisplay() {\n            if (isRefreshing) return; // Prevent recursive calls\n            isRefreshing = true;\n\n            // Clear existing cards\n            characterCards.forEach(card => {\n                if (card && card.exists && card.exists()) {\n                    k.destroy(card);\n                }\n            });\n            characterCards.length = 0;\n\n            // Clear detail items\n            detailItems.forEach(item => {\n                if (item && item.exists && item.exists()) {\n                    k.destroy(item);\n                }\n            });\n            detailItems = [];\n\n            // Clear pagination items\n            paginationItems.forEach(item => {\n                if (item && item.exists && item.exists()) {\n                    k.destroy(item);\n                }\n            });\n            paginationItems = [];\n\n            // Get characters for current page\n            const pageStart = currentPage * charactersPerPage;\n            const pageEnd = Math.min(pageStart + charactersPerPage, characterKeys.length);\n            const pageCharacters = characterKeys.slice(pageStart, pageEnd);\n\n            // Render character selection grid (left side)\n            pageCharacters.forEach((key, pageIndex) => {\n                const char = CHARACTER_UNLOCKS[key];\n                const isUnlockedChar = isUnlocked('characters', key) || char.unlockedByDefault;\n                const isViewed = viewedCharacterKey === key;\n                const isConfirmedSelection = confirmedCharacterKey === key;\n\n                const row = Math.floor(pageIndex / cardsPerRow);\n                const col = pageIndex % cardsPerRow;\n                const cardX = 20 + col * (cardWidth + cardSpacing);\n                const cardY = startY + row * (cardHeight + cardSpacing);\n\n                // Card background\n                const cardBg = k.add([\n                    k.rect(cardWidth, cardHeight),\n                    k.pos(cardX, cardY),\n                    k.anchor('topleft'),\n                    k.color(...(isViewed ? UI_COLORS.BG_MEDIUM : UI_COLORS.BG_DARK)),\n                    k.outline(2, isViewed ? k.rgb(...UI_COLORS.BORDER_ACTIVE) : (isUnlockedChar ? k.rgb(...UI_COLORS.TEXT_DISABLED) : k.rgb(...UI_COLORS.BG_DARK))),\n                    k.area(),\n                    k.fixed(),\n                    k.scale(1),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS),\n                    {\n                        baseX: cardX,\n                        baseY: cardY,\n                        isHovered: false\n                    }\n                ]);\n\n                // Character visual\n                const charVisual = k.add([\n                    k.text(char.char, { size: UI_TEXT_SIZES.HEADER }),\n                    k.pos(cardX + 28, cardY + cardHeight / 2),\n                    k.anchor('center'),\n                    k.color(...(isUnlockedChar ? char.color : UI_COLORS.BG_DISABLED)),\n                    k.fixed(),\n                    k.scale(1),\n                    k.z(UI_Z_LAYERS.UI_TEXT),\n                    {\n                        baseX: cardX + 28,\n                        baseY: cardY + cardHeight / 2\n                    }\n                ]);\n\n                // Character name (stripped of \"The \" prefix)\n                const nameText = k.add([\n                    k.text(formatName(char.name), { size: UI_TEXT_SIZES.SMALL }),\n                    k.pos(cardX + 60, cardY + cardHeight / 2),\n                    k.anchor('left'),\n                    k.color(...(isUnlockedChar ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_DISABLED)),\n                    k.fixed(),\n                    k.scale(1),\n                    k.z(UI_Z_LAYERS.UI_TEXT),\n                    {\n                        baseX: cardX + 60,\n                        baseY: cardY + cardHeight / 2\n                    }\n                ]);\n\n                // Hover effects for cards\n                cardBg.onHoverUpdate(() => {\n                    if (!cardBg.isHovered && !isViewed) {\n                        cardBg.isHovered = true;\n                        playMenuNav();\n                    }\n                    if (!isViewed) {\n                        // Scale up slightly and brighten\n                        cardBg.scale = k.vec2(1.05, 1.05);\n                        charVisual.scale = k.vec2(1.15, 1.15);\n                        nameText.scale = k.vec2(1.05, 1.05);\n                        cardBg.color = k.rgb(50, 50, 65);\n                        // Add slight bounce to character\n                        const bounce = Math.sin(k.time() * 8) * 2;\n                        charVisual.pos.y = charVisual.baseY + bounce;\n                    }\n                });\n\n                cardBg.onHoverEnd(() => {\n                    cardBg.isHovered = false;\n                    cardBg.scale = k.vec2(1, 1);\n                    charVisual.scale = k.vec2(1, 1);\n                    nameText.scale = k.vec2(1, 1);\n                    cardBg.color = k.rgb(...(isViewed ? UI_COLORS.BG_MEDIUM : UI_COLORS.BG_DARK));\n                    charVisual.pos.y = charVisual.baseY;\n                });\n\n                // Locked overlay\n                if (!isUnlockedChar) {\n                    const lockText = k.add([\n                        k.text('', { size: UI_TEXT_SIZES.SMALL }),\n                        k.pos(cardX + cardWidth - 18, cardY + cardHeight / 2),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.DANGER),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.OVERLAY)\n                    ]);\n                    characterCards.push(lockText);\n                }\n\n                // Current selection indicator (checkmark badge)\n                if (isConfirmedSelection) {\n                    const checkBadge = k.add([\n                        k.circle(8),\n                        k.pos(cardX + cardWidth - 10, cardY + 12),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.SUCCESS),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT + 1)\n                    ]);\n                    const checkMark = k.add([\n                        k.text('', { size: 10 }),\n                        k.pos(cardX + cardWidth - 10, cardY + 12),\n                        k.anchor('center'),\n                        k.color(255, 255, 255),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT + 2)\n                    ]);\n                    characterCards.push(checkBadge, checkMark);\n                }\n\n                // Click handler - all cards are clickable for viewing\n                cardBg.onClick(() => {\n                    if (viewedCharacterKey !== key) {\n                        playMenuSelect();\n                        viewedCharacterKey = key;\n                        refreshDisplay();\n                    }\n                });\n                cardBg.cursor = 'pointer';\n\n                characterCards.push(cardBg, charVisual, nameText);\n            });\n\n            // Pagination controls (only show if more than one page)\n            if (totalPages > 1) {\n                const paginationY = startY + rowsPerPage * (cardHeight + cardSpacing) + 15;\n                const paginationCenterX = leftPanelWidth / 2;\n\n                // Page indicator pips\n                const pipSpacing = 20;\n                const pipsStartX = paginationCenterX - ((totalPages - 1) * pipSpacing) / 2;\n                const pipsEndX = paginationCenterX + ((totalPages - 1) * pipSpacing) / 2;\n\n                // Arrows positioned outside the pips with offset for pip clickable area (16px) + gap\n                const arrowOffset = 25;\n                const leftArrowX = pipsStartX - arrowOffset;\n                const rightArrowX = pipsEndX + arrowOffset;\n\n                for (let i = 0; i < totalPages; i++) {\n                    const isCurrentPage = i === currentPage;\n                    const pipX = pipsStartX + i * pipSpacing;\n\n                    const pipBg = k.add([\n                        k.rect(16, 16),\n                        k.pos(pipX, paginationY),\n                        k.anchor('center'),\n                        k.color(0, 0, 0),\n                        k.opacity(0),\n                        k.area({ width: 16, height: 16 }),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                    ]);\n\n                    const pipText = k.add([\n                        k.text(isCurrentPage ? '' : '', { size: 14 }),\n                        k.pos(pipX, paginationY),\n                        k.anchor('center'),\n                        k.color(isCurrentPage ? 255 : 120, isCurrentPage ? 255 : 120, isCurrentPage ? 255 : 120),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n\n                    const pageIndex = i;\n                    pipBg.onClick(() => {\n                        if (pageIndex !== currentPage) {\n                            playMenuNav();\n                            currentPage = pageIndex;\n                            refreshDisplay();\n                        }\n                    });\n                    pipBg.cursor = 'pointer';\n\n                    paginationItems.push(pipBg, pipText);\n                }\n\n                // Left arrow (higher z-index to sit on top and take priority)\n                const leftArrowBg = k.add([\n                    k.rect(30, 30),\n                    k.pos(leftArrowX, paginationY),\n                    k.anchor('center'),\n                    k.color(0, 0, 0),\n                    k.opacity(0),\n                    k.area({ width: 30, height: 30 }),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\n                ]);\n\n                const leftArrowText = k.add([\n                    k.text('<', { size: 24 }),\n                    k.pos(leftArrowX, paginationY),\n                    k.anchor('center'),\n                    k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT + 1)\n                ]);\n\n                if (currentPage > 0) {\n                    leftArrowBg.onClick(() => {\n                        playMenuNav();\n                        currentPage--;\n                        refreshDisplay();\n                    });\n                    leftArrowBg.cursor = 'pointer';\n                }\n                paginationItems.push(leftArrowBg, leftArrowText);\n\n                // Right arrow (higher z-index to sit on top and take priority)\n                const rightArrowBg = k.add([\n                    k.rect(30, 30),\n                    k.pos(rightArrowX, paginationY),\n                    k.anchor('center'),\n                    k.color(0, 0, 0),\n                    k.opacity(0),\n                    k.area({ width: 30, height: 30 }),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\n                ]);\n\n                const rightArrowText = k.add([\n                    k.text('>', { size: 24 }),\n                    k.pos(rightArrowX, paginationY),\n                    k.anchor('center'),\n                    k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT + 1)\n                ]);\n\n                if (currentPage < totalPages - 1) {\n                    rightArrowBg.onClick(() => {\n                        playMenuNav();\n                        currentPage++;\n                        refreshDisplay();\n                    });\n                    rightArrowBg.cursor = 'pointer';\n                }\n                paginationItems.push(rightArrowBg, rightArrowText);\n            }\n            \n            // Render character details (right side)\n            const viewedChar = CHARACTER_UNLOCKS[viewedCharacterKey];\n            const isViewedUnlocked = isUnlocked('characters', viewedCharacterKey) || viewedChar.unlockedByDefault;\n            let detailY = startY;\n\n            // Preview panel background for clarity\n            const previewPanelBg = k.add([\n                k.rect(rightPanelWidth - 10, 380),\n                k.pos(rightPanelX + 5, startY - 10),\n                k.anchor('topleft'),\n                k.color(25, 25, 35),\n                k.outline(2, k.rgb(60, 60, 80)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS - 1)\n            ]);\n            detailItems.push(previewPanelBg);\n\n            // Glow effect behind character (pulses)\n            const charGlow = k.add([\n                k.circle(50),\n                k.pos(rightPanelX + rightPanelWidth / 2, detailY + 45),\n                k.anchor('center'),\n                k.color(...(isViewedUnlocked ? viewedChar.color : [80, 80, 80])),\n                k.opacity(CHAR_ANIM.GLOW_MIN),\n                k.scale(1),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n            detailItems.push(charGlow);\n\n            // Character visual (large) with animation reference\n            const detailVisual = k.add([\n                k.text(viewedChar.char, { size: 72 }),\n                k.pos(rightPanelX + rightPanelWidth / 2, detailY + 45),\n                k.anchor('center'),\n                k.color(...(isViewedUnlocked ? viewedChar.color : UI_COLORS.BG_DISABLED)),\n                k.fixed(),\n                k.scale(1),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS + 1),\n                {\n                    baseY: detailY + 45,\n                    baseScale: 1,\n                    animTime: Math.random() * Math.PI * 2 // Random start phase\n                }\n            ]);\n            detailItems.push(detailVisual);\n\n            // Animate the character and glow\n            const animLoop = k.onUpdate(() => {\n                if (!detailVisual.exists()) return;\n\n                detailVisual.animTime += k.dt();\n\n                // Breathing effect (scale)\n                const breathe = 1 + Math.sin(detailVisual.animTime * CHAR_ANIM.BREATHE_SPEED) * CHAR_ANIM.BREATHE_AMOUNT;\n                detailVisual.scale = k.vec2(breathe, breathe);\n\n                // Bobbing effect (position)\n                const bob = Math.sin(detailVisual.animTime * CHAR_ANIM.BOB_SPEED) * CHAR_ANIM.BOB_AMOUNT;\n                detailVisual.pos.y = detailVisual.baseY + bob;\n\n                // Glow pulse\n                if (charGlow.exists()) {\n                    const glowIntensity = CHAR_ANIM.GLOW_MIN +\n                        (Math.sin(detailVisual.animTime * CHAR_ANIM.GLOW_PULSE_SPEED) * 0.5 + 0.5) *\n                        (CHAR_ANIM.GLOW_MAX - CHAR_ANIM.GLOW_MIN);\n                    charGlow.opacity = glowIntensity;\n                    charGlow.scale = k.vec2(1 + glowIntensity * 0.3, 1 + glowIntensity * 0.3);\n                }\n            });\n            detailItems.push({ exists: () => true, destroy: () => animLoop.cancel() });\n\n            detailY += 110;\n\n            // Character name (stripped of \"The \" prefix)\n            const detailName = k.add([\n                k.text(formatName(viewedChar.name), { size: UI_TEXT_SIZES.HEADER }),\n                k.pos(rightPanelX + rightPanelWidth / 2, detailY),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_PRIMARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            detailItems.push(detailName);\n            detailY += 35;\n\n            // Description with highlighted stats\n            const descElements = renderHighlightedDescription(\n                viewedChar.description,\n                rightPanelX + rightPanelWidth / 2,\n                detailY,\n                rightPanelWidth - 40\n            );\n            detailItems.push(...descElements);\n            detailY += 55;\n\n            // Stats with visual bars\n            const statsLabel = k.add([\n                k.text('Stats:', { size: UI_TEXT_SIZES.LABEL }),\n                k.pos(rightPanelX + 20, detailY),\n                k.anchor('left'),\n                k.color(...UI_COLORS.WARNING),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            detailItems.push(statsLabel);\n            detailY += 28;\n\n            // Stat bar constants\n            const statBarWidth = 100;\n            const statBarX = rightPanelX + 40;\n            const statRowHeight = 24;\n\n            // Health stat bar (max 175 - characters range 60-150)\n            const healthBar = createStatBar(k, {\n                label: UI_TERMS.HEALTH,\n                value: viewedChar.stats.health,\n                maxValue: 175,\n                x: statBarX,\n                y: detailY,\n                width: statBarWidth,\n                usePercentageColor: true\n            });\n            detailItems.push(...healthBar.elements);\n            detailY += statRowHeight;\n\n            // Speed stat bar (max 225 - characters range 100-200)\n            const speedBar = createStatBar(k, {\n                label: UI_TERMS.SPEED,\n                value: viewedChar.stats.speed,\n                maxValue: 225,\n                x: statBarX,\n                y: detailY,\n                width: statBarWidth,\n                usePercentageColor: true\n            });\n            detailItems.push(...speedBar.elements);\n            detailY += statRowHeight;\n\n            // Damage stat bar (max 25 - characters range 8-20)\n            const damageBar = createStatBar(k, {\n                label: UI_TERMS.DAMAGE,\n                value: viewedChar.stats.damage,\n                maxValue: 25,\n                x: statBarX,\n                y: detailY,\n                width: statBarWidth,\n                usePercentageColor: true\n            });\n            detailItems.push(...damageBar.elements);\n            detailY += 30;\n\n            // Currently selected indicator (show if viewing the confirmed selection)\n            if (viewedCharacterKey === confirmedCharacterKey) {\n                const selectedIndicator = k.add([\n                    k.text(' CURRENT SELECTION', { size: UI_TEXT_SIZES.LABEL }),\n                    k.pos(rightPanelX + rightPanelWidth / 2, detailY),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.SUCCESS),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n                detailItems.push(selectedIndicator);\n            }\n\n            // Locked info\n            if (!isViewedUnlocked) {\n                const unlockTextStr = getUnlockText(viewedChar);\n                if (unlockTextStr) {\n                    const unlockText = k.add([\n                        k.text(unlockTextStr, { size: UI_TEXT_SIZES.SMALL, width: rightPanelWidth - 40 }),\n                        k.pos(rightPanelX + rightPanelWidth / 2, detailY + 30),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.GOLD),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    detailItems.push(unlockText);\n                }\n            }\n            \n            isRefreshing = false;\n        }\n        \n        // Initial display\n        refreshDisplay();\n\n        // Keyboard pagination\n        k.onKeyPress('arrowleft', () => {\n            if (currentPage > 0) {\n                playMenuNav();\n                currentPage--;\n                refreshDisplay();\n            }\n        });\n\n        k.onKeyPress('arrowright', () => {\n            if (currentPage < totalPages - 1) {\n                playMenuNav();\n                currentPage++;\n                refreshDisplay();\n            }\n        });\n\n        // Cancel button (left side)\n        const cancelButton = k.add([\n            k.rect(120, 35),\n            k.pos(k.width() / 2 - 70, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.NEUTRAL),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n\n        k.add([\n            k.text(formatButtonText('Cancel'), { size: UI_TEXT_SIZES.BODY }),\n            k.pos(k.width() / 2 - 70, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        cancelButton.onClick(() => {\n            playMenuNav();\n            k.go('menu');\n        });\n\n        // Confirm button (right side) - track for enabling/disabling\n        let confirmButton = null;\n        let confirmText = null;\n        let confirmButtonItems = [];\n\n        function updateConfirmButton() {\n            // Clean up old button\n            confirmButtonItems.forEach(item => {\n                if (item && item.exists && item.exists()) {\n                    k.destroy(item);\n                }\n            });\n            confirmButtonItems = [];\n\n            const viewedChar = CHARACTER_UNLOCKS[viewedCharacterKey];\n            const isViewedUnlocked = isUnlocked('characters', viewedCharacterKey) || viewedChar.unlockedByDefault;\n\n            confirmButton = k.add([\n                k.rect(120, 35),\n                k.pos(k.width() / 2 + 70, k.height() - 40),\n                k.anchor('center'),\n                k.color(...(isViewedUnlocked ? UI_COLORS.SUCCESS : UI_COLORS.BG_DISABLED)),\n                k.outline(2, k.rgb(...(isViewedUnlocked ? UI_COLORS.BORDER : UI_COLORS.BG_DARK))),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n            confirmButtonItems.push(confirmButton);\n\n            confirmText = k.add([\n                k.text(formatButtonText('Confirm'), { size: UI_TEXT_SIZES.BODY }),\n                k.pos(k.width() / 2 + 70, k.height() - 40),\n                k.anchor('center'),\n                k.color(...(isViewedUnlocked ? UI_COLORS.TEXT_PRIMARY : UI_COLORS.TEXT_DISABLED)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            confirmButtonItems.push(confirmText);\n\n            if (isViewedUnlocked) {\n                confirmButton.onClick(() => {\n                    playMenuSelect();\n                    setSelectedCharacter(viewedCharacterKey);\n                    broadcastCharacterChange(viewedCharacterKey);\n                    k.go('menu');\n                });\n                confirmButton.cursor = 'pointer';\n            }\n        }\n\n        // Initial confirm button render\n        updateConfirmButton();\n\n        // Wrap refreshDisplay to also update confirm button\n        const originalRefreshDisplay = refreshDisplay;\n        refreshDisplay = function() {\n            originalRefreshDisplay();\n            updateConfirmButton();\n        };\n\n\n        // Controls\n        k.onKeyPress('escape', () => {\n            playMenuNav();\n            k.go('menu');\n        });\n\n        k.onKeyPress('enter', () => {\n            const viewedChar = CHARACTER_UNLOCKS[viewedCharacterKey];\n            const isViewedUnlocked = isUnlocked('characters', viewedCharacterKey) || viewedChar.unlockedByDefault;\n            if (isViewedUnlocked) {\n                playMenuSelect();\n                setSelectedCharacter(viewedCharacterKey);\n                broadcastCharacterChange(viewedCharacterKey);\n                k.go('menu');\n            }\n        });\n    });\n}\n","import { isValidInviteCode } from '../systems/nameGenerator.js';\nimport { joinPartyAsClient, restoreLocalPlayerToSoloParty, getPlayerName, getInviteCode, getSelectedCharacter } from '../systems/partySystem.js';\nimport { playMenuNav, playMenuSelect } from '../systems/sounds.js';\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS\n} from '../config/uiConfig.js';\n\n/**\n * Join Party Scene\n * Dedicated scene for entering a party invite code\n */\nexport function initJoinPartyScene(k) {\n    k.scene('joinParty', () => {\n        // Save original party state before any join attempt\n        const originalState = {\n            name: getPlayerName(),\n            inviteCode: getInviteCode(),\n            character: getSelectedCharacter()\n        };\n        let joinCancelled = false;\n\n        // Background\n        k.add([\n            k.rect(k.width(), k.height()),\n            k.pos(0, 0),\n            k.color(...UI_COLORS.BG_DARK),\n            k.fixed(),\n            k.z(0)\n        ]);\n\n        // Title\n        k.add([\n            k.text('Join Party', { size: UI_TEXT_SIZES.TITLE }),\n            k.pos(k.width() / 2, 100),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(10)\n        ]);\n\n        // Instruction\n        k.add([\n            k.text('Enter 6-digit invite code:', { size: UI_TEXT_SIZES.LABEL }),\n            k.pos(k.width() / 2, 180),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(10)\n        ]);\n\n        // Input display\n        let inputCode = '';\n        const inputDisplay = k.add([\n            k.text('______', { size: UI_TEXT_SIZES.TITLE * 1.5 }),\n            k.pos(k.width() / 2, 280),\n            k.anchor('center'),\n            k.color(...UI_COLORS.GOLD),\n            k.fixed(),\n            k.z(10)\n        ]);\n\n        // Error/Status message\n        const errorMsg = k.add([\n            k.text('', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2, 360),\n            k.anchor('center'),\n            k.color(255, 100, 100),\n            k.fixed(),\n            k.z(10)\n        ]);\n\n        // Instructions text\n        k.add([\n            k.text('Press ESC or click Cancel to go back', { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(k.width() / 2, k.height() - 100),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_DISABLED),\n            k.fixed(),\n            k.z(10)\n        ]);\n\n        let isJoining = false;\n\n        // Update display\n        function updateDisplay() {\n            let display = '';\n            for (let i = 0; i < 6; i++) {\n                if (i < inputCode.length) {\n                    display += inputCode[i];\n                } else {\n                    display += '_';\n                }\n            }\n            inputDisplay.text = display;\n        }\n\n        // Character input handler\n        k.onCharInput((ch) => {\n            if (isJoining) return;\n\n            // Only accept alphanumeric characters\n            if (/[a-zA-Z0-9]/.test(ch) && inputCode.length < 6) {\n                playMenuNav();\n                inputCode += ch.toUpperCase();\n                updateDisplay();\n                errorMsg.text = '';\n\n                // Auto-submit when 6 characters entered\n                if (inputCode.length === 6) {\n                    k.wait(0.2, attemptJoin);\n                }\n            }\n        });\n\n        // Backspace handler\n        k.onKeyPress('backspace', () => {\n            if (isJoining) return;\n\n            if (inputCode.length > 0) {\n                playMenuNav();\n                inputCode = inputCode.slice(0, -1);\n                updateDisplay();\n                errorMsg.text = '';\n            }\n        });\n\n        // Escape key to cancel (works even during join attempt)\n        k.onKeyPress('escape', () => {\n            playMenuNav();\n            joinCancelled = true;\n            isJoining = false;\n            // Restore original party state\n            restoreLocalPlayerToSoloParty(originalState);\n            k.go('menu');\n        });\n\n        // Enter key to submit\n        k.onKeyPress('enter', () => {\n            if (isJoining) return;\n            if (inputCode.length === 6) {\n                attemptJoin();\n            }\n        });\n\n        // Attempt to join party\n        async function attemptJoin() {\n            if (isJoining) return;\n\n            const code = inputCode.trim();\n\n            if (!isValidInviteCode(code)) {\n                errorMsg.text = 'Invalid invite code format';\n                errorMsg.color = k.rgb(255, 100, 100);\n                return;\n            }\n\n            isJoining = true;\n            errorMsg.text = 'Joining party...';\n            errorMsg.color = k.rgb(...UI_COLORS.GOLD);\n\n            try {\n                const success = await joinPartyAsClient(code);\n\n                if (success) {\n                    // Check if join was cancelled while waiting\n                    if (joinCancelled) {\n                        return;\n                    }\n                    playMenuSelect();\n                    errorMsg.text = 'Successfully joined party!';\n                    errorMsg.color = k.rgb(...UI_COLORS.SUCCESS);\n\n                    // Wait a moment then go to menu (now in party)\n                    k.wait(1, () => {\n                        if (!joinCancelled) {\n                            k.go('menu');\n                        }\n                    });\n                } else {\n                    isJoining = false;\n                    errorMsg.text = 'Failed to join party. Check the code and try again.';\n                    errorMsg.color = k.rgb(255, 100, 100);\n                    inputCode = '';\n                    updateDisplay();\n                }\n            } catch (error) {\n                isJoining = false;\n                console.error('[JoinParty] Error joining party:', error);\n                errorMsg.text = 'Connection error. Please try again.';\n                errorMsg.color = k.rgb(255, 100, 100);\n                inputCode = '';\n                updateDisplay();\n            }\n        }\n\n        // Cancel button (MD size - secondary action)\n        const { MD } = UI_SIZES.BUTTON;\n        const cancelButton = k.add([\n            k.rect(MD.width, MD.height),\n            k.pos(k.width() / 2, k.height() - 180),\n            k.anchor('center'),\n            k.color(...UI_COLORS.NEUTRAL),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(10)\n        ]);\n\n        const cancelText = k.add([\n            k.text('CANCEL', { size: UI_TEXT_SIZES.BODY }),\n            k.pos(k.width() / 2, k.height() - 180),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(11)\n        ]);\n\n        cancelButton.onClick(() => {\n            playMenuNav();\n            joinCancelled = true;\n            isJoining = false;\n            // Restore original party state\n            restoreLocalPlayerToSoloParty(originalState);\n            k.go('menu');\n        });\n\n        cancelButton.onHoverUpdate(() => {\n            if (!isJoining) {\n                cancelButton.color = k.rgb(...UI_COLORS.NEUTRAL_HOVER);\n            }\n        });\n\n        cancelButton.onHoverEnd(() => {\n            cancelButton.color = k.rgb(...UI_COLORS.NEUTRAL);\n        });\n    });\n}\n","/**\n * Leaderboards Scene\n *\n * Displays leaderboard data with four tabs:\n * - Daily: Today's daily run leaderboard\n * - All-Time: Top scores ever\n * - Personal Bests: Best per character\n * - Global: Online global leaderboard (Dreamlo API)\n */\n\nimport {\n    getDailyLeaderboard,\n    getAllTimeLeaderboard,\n    getPersonalBests,\n    formatScore,\n    formatTime\n} from '../systems/leaderboards.js';\nimport { getOnlineLeaderboard } from '../systems/onlineLeaderboards.js';\nimport { getPlayerName } from '../systems/metaProgression.js';\nimport { getTodayDateString, getDailyCharacter } from '../systems/dailyRuns.js';\nimport { CHARACTER_UNLOCKS } from '../data/unlocks.js';\nimport { playMenuSelect, playMenuNav } from '../systems/sounds.js';\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS\n} from '../config/uiConfig.js';\n\n// Tab types\nconst TABS = {\n    DAILY: 'daily',\n    ALL_TIME: 'allTime',\n    PERSONAL: 'personal',\n    GLOBAL: 'global'\n};\n\nexport function setupLeaderboardsScene(k) {\n    k.scene('leaderboards', (args = {}) => {\n        const initialTab = args.tab || TABS.DAILY;\n        let currentTab = initialTab;\n\n        // Pagination settings\n        const ENTRIES_PER_PAGE = 10;\n        const CHARACTERS_PER_PAGE = 5;\n        let currentPage = 0; // Used for DAILY, ALL-TIME, and PERSONAL tabs\n\n        // Background\n        k.add([\n            k.rect(k.width(), k.height()),\n            k.pos(0, 0),\n            k.color(...UI_COLORS.BG_DARK),\n            k.z(UI_Z_LAYERS.BACKGROUND)\n        ]);\n\n        // Title\n        k.add([\n            k.text('LEADERBOARDS', { size: UI_TEXT_SIZES.TITLE }),\n            k.pos(k.width() / 2, 50),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Tab container\n        const tabY = 100;\n        const tabWidth = 115;\n        const tabSpacing = 8;\n        const totalTabWidth = (tabWidth * 4) + (tabSpacing * 3);\n        const startX = (k.width() - totalTabWidth) / 2;\n\n        // Content container\n        const contentY = 160;\n\n        // Content elements (will be destroyed and recreated on tab change)\n        let contentElements = [];\n\n        // Create tab button\n        function createTab(text, tabType, x) {\n            const isActive = currentTab === tabType;\n            const bg = k.add([\n                k.rect(tabWidth, 40),\n                k.pos(x, tabY),\n                k.anchor('center'),\n                k.color(...(isActive ? UI_COLORS.SECONDARY : UI_COLORS.BG_MEDIUM)),\n                k.outline(2, k.rgb(...(isActive ? UI_COLORS.BORDER_HOVER : UI_COLORS.BORDER))),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS),\n                'tab'\n            ]);\n\n            const label = k.add([\n                k.text(text, { size: UI_TEXT_SIZES.BODY }),\n                k.pos(x, tabY),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_PRIMARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT),\n                'tab'\n            ]);\n\n            bg.onClick(() => {\n                if (currentTab !== tabType) {\n                    playMenuNav();\n                    currentTab = tabType;\n                    currentPage = 0; // Reset pagination when switching tabs\n                    refreshTabs();\n                    renderContent();\n                }\n            });\n\n            bg.onHoverUpdate(() => {\n                if (currentTab !== tabType) {\n                    bg.color = k.rgb(...UI_COLORS.BG_LIGHT);\n                }\n            });\n\n            bg.onHoverEnd(() => {\n                if (currentTab !== tabType) {\n                    bg.color = k.rgb(...UI_COLORS.BG_MEDIUM);\n                }\n            });\n\n            return { bg, label, tabType };\n        }\n\n        // Create tabs\n        let tabs = [];\n        function refreshTabs() {\n            // Destroy old tabs\n            k.get('tab').forEach(t => k.destroy(t));\n            tabs = [];\n\n            const tab1 = createTab('DAILY', TABS.DAILY, startX + tabWidth / 2);\n            const tab2 = createTab('ALL-TIME', TABS.ALL_TIME, startX + tabWidth + tabSpacing + tabWidth / 2);\n            const tab3 = createTab('PERSONAL', TABS.PERSONAL, startX + (tabWidth + tabSpacing) * 2 + tabWidth / 2);\n            const tab4 = createTab('GLOBAL', TABS.GLOBAL, startX + (tabWidth + tabSpacing) * 3 + tabWidth / 2);\n\n            tabs = [tab1, tab2, tab3, tab4];\n        }\n\n        // Render content based on current tab\n        function renderContent() {\n            // Clear previous content\n            contentElements.forEach(el => {\n                if (el.exists()) k.destroy(el);\n            });\n            contentElements = [];\n\n            switch (currentTab) {\n                case TABS.DAILY:\n                    renderDailyContent();\n                    break;\n                case TABS.ALL_TIME:\n                    renderAllTimeContent();\n                    break;\n                case TABS.PERSONAL:\n                    renderPersonalContent();\n                    break;\n                case TABS.GLOBAL:\n                    renderGlobalContent();\n                    break;\n            }\n        }\n\n        // Render daily leaderboard\n        function renderDailyContent() {\n            const today = getTodayDateString();\n            const dailyChar = getDailyCharacter(today);\n            const charData = CHARACTER_UNLOCKS[dailyChar] || CHARACTER_UNLOCKS.survivor;\n            const allEntries = getDailyLeaderboard(today, 100); // Get all entries\n            const playerName = getPlayerName() || 'Anonymous';\n\n            const totalPages = Math.ceil(allEntries.length / ENTRIES_PER_PAGE);\n            if (currentPage >= totalPages && totalPages > 0) currentPage = totalPages - 1;\n\n            const startIndex = currentPage * ENTRIES_PER_PAGE;\n            const entries = allEntries.slice(startIndex, startIndex + ENTRIES_PER_PAGE);\n\n            // Date and character info\n            const dateLabel = k.add([\n                k.text(`Date: ${today}`, { size: UI_TEXT_SIZES.BODY }),\n                k.pos(k.width() / 2 - 100, contentY),\n                k.anchor('left'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            contentElements.push(dateLabel);\n\n            const charLabel = k.add([\n                k.text(`Character: ${charData.char} ${charData.name}`, { size: UI_TEXT_SIZES.BODY }),\n                k.pos(k.width() / 2 + 50, contentY),\n                k.anchor('left'),\n                k.color(...charData.color),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            contentElements.push(charLabel);\n\n            // Header row\n            const headerY = contentY + 40;\n            renderLeaderboardHeader(headerY);\n\n            // Entries\n            if (allEntries.length === 0) {\n                const noData = k.add([\n                    k.text('No entries yet. Be the first!', { size: UI_TEXT_SIZES.BODY }),\n                    k.pos(k.width() / 2, headerY + 60),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_DISABLED),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n                contentElements.push(noData);\n            } else {\n                entries.forEach((entry, index) => {\n                    const rowY = headerY + 40 + (index * 35);\n                    const isPlayer = entry.name.toLowerCase() === playerName.toLowerCase();\n                    const globalRank = startIndex + index + 1;\n                    renderLeaderboardRow(globalRank, entry, rowY, isPlayer);\n                });\n\n                // Pagination controls\n                if (totalPages > 1) {\n                    renderPaginationControls(headerY + 40 + (ENTRIES_PER_PAGE * 35) + 10, totalPages);\n                }\n            }\n        }\n\n        // Render all-time leaderboard\n        function renderAllTimeContent() {\n            const allEntries = getAllTimeLeaderboard(100); // Get all entries\n            const playerName = getPlayerName() || 'Anonymous';\n\n            const totalPages = Math.ceil(allEntries.length / ENTRIES_PER_PAGE);\n            if (currentPage >= totalPages && totalPages > 0) currentPage = totalPages - 1;\n\n            const startIndex = currentPage * ENTRIES_PER_PAGE;\n            const entries = allEntries.slice(startIndex, startIndex + ENTRIES_PER_PAGE);\n\n            // Header row\n            const headerY = contentY + 10;\n            renderLeaderboardHeader(headerY);\n\n            // Entries\n            if (allEntries.length === 0) {\n                const noData = k.add([\n                    k.text('No entries yet. Play a game!', { size: UI_TEXT_SIZES.BODY }),\n                    k.pos(k.width() / 2, headerY + 60),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.TEXT_DISABLED),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n                contentElements.push(noData);\n            } else {\n                entries.forEach((entry, index) => {\n                    const rowY = headerY + 40 + (index * 35);\n                    const isPlayer = entry.name.toLowerCase() === playerName.toLowerCase();\n                    const globalRank = startIndex + index + 1;\n                    renderLeaderboardRow(globalRank, entry, rowY, isPlayer);\n                });\n\n                // Pagination controls\n                if (totalPages > 1) {\n                    renderPaginationControls(headerY + 40 + (ENTRIES_PER_PAGE * 35) + 10, totalPages);\n                }\n            }\n        }\n\n        // Render personal bests\n        function renderPersonalContent() {\n            const personalBests = getPersonalBests();\n            const characters = Object.keys(CHARACTER_UNLOCKS);\n            const totalPages = Math.ceil(characters.length / CHARACTERS_PER_PAGE);\n\n            // Clamp page to valid range\n            if (currentPage >= totalPages) currentPage = Math.max(0, totalPages - 1);\n\n            // Get characters for current page\n            const startIndex = currentPage * CHARACTERS_PER_PAGE;\n            const pageCharacters = characters.slice(startIndex, startIndex + CHARACTERS_PER_PAGE);\n\n            // Header\n            const headerY = contentY + 10;\n            const headers = ['Character', 'Best Score', 'Best Floor', 'Best Time'];\n            const colPositions = [120, 280, 420, 540];\n\n            headers.forEach((header, i) => {\n                const headerText = k.add([\n                    k.text(header, { size: UI_TEXT_SIZES.SMALL }),\n                    k.pos(colPositions[i], headerY),\n                    k.anchor('left'),\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n                contentElements.push(headerText);\n            });\n\n            // Divider\n            const divider = k.add([\n                k.rect(500, 2),\n                k.pos(k.width() / 2, headerY + 20),\n                k.anchor('center'),\n                k.color(...UI_COLORS.BORDER),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n            contentElements.push(divider);\n\n            // Character rows (paginated)\n            pageCharacters.forEach((charKey, pageIndex) => {\n                const charData = CHARACTER_UNLOCKS[charKey];\n                const bests = personalBests[charKey];\n                const rowY = headerY + 45 + (pageIndex * 40);\n\n                // Character icon and name\n                const charIcon = k.add([\n                    k.text(`${charData.char} ${charData.name}`, { size: UI_TEXT_SIZES.BODY }),\n                    k.pos(colPositions[0], rowY),\n                    k.anchor('left'),\n                    k.color(...charData.color),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n                contentElements.push(charIcon);\n\n                if (bests) {\n                    // Best score\n                    const scoreText = k.add([\n                        k.text(formatScore(bests.bestScore), { size: UI_TEXT_SIZES.BODY }),\n                        k.pos(colPositions[1], rowY),\n                        k.anchor('left'),\n                        k.color(...UI_COLORS.TEXT_PRIMARY),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    contentElements.push(scoreText);\n\n                    // Best floor\n                    const floorText = k.add([\n                        k.text(`Floor ${bests.bestFloor}`, { size: UI_TEXT_SIZES.BODY }),\n                        k.pos(colPositions[2], rowY),\n                        k.anchor('left'),\n                        k.color(...UI_COLORS.TEXT_PRIMARY),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    contentElements.push(floorText);\n\n                    // Best time\n                    const timeText = k.add([\n                        k.text(formatTime(bests.bestTime), { size: UI_TEXT_SIZES.BODY }),\n                        k.pos(colPositions[3], rowY),\n                        k.anchor('left'),\n                        k.color(...UI_COLORS.TEXT_PRIMARY),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    contentElements.push(timeText);\n                } else {\n                    // No data\n                    const noData = k.add([\n                        k.text('-- no data --', { size: UI_TEXT_SIZES.SMALL }),\n                        k.pos(colPositions[1], rowY),\n                        k.anchor('left'),\n                        k.color(...UI_COLORS.TEXT_DISABLED),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    contentElements.push(noData);\n                }\n            });\n\n            // Pagination controls\n            if (totalPages > 1) {\n                const paginationY = headerY + 45 + (CHARACTERS_PER_PAGE * 40) + 20;\n                renderPaginationControls(paginationY, totalPages);\n            }\n        }\n\n        // Render global leaderboard\n        function renderGlobalContent() {\n            const playerName = getPlayerName() || 'Anonymous';\n            const headerY = contentY + 10;\n\n            // Show loading state initially\n            const loadingText = k.add([\n                k.text('Connecting to global leaderboard...', { size: UI_TEXT_SIZES.BODY }),\n                k.pos(k.width() / 2, headerY + 100),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            contentElements.push(loadingText);\n\n            // Fetch global leaderboard\n            getOnlineLeaderboard(10).then(result => {\n                // Remove loading text\n                if (loadingText.exists()) {\n                    k.destroy(loadingText);\n                    const idx = contentElements.indexOf(loadingText);\n                    if (idx > -1) contentElements.splice(idx, 1);\n                }\n\n                // Check if we're still on the GLOBAL tab\n                if (currentTab !== TABS.GLOBAL) return;\n\n                if (result.error) {\n                    // Error state\n                    const errorText = k.add([\n                        k.text(result.error, { size: UI_TEXT_SIZES.BODY }),\n                        k.pos(k.width() / 2, headerY + 80),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.DANGER),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    contentElements.push(errorText);\n\n                    // Retry button\n                    const retryBg = k.add([\n                        k.rect(120, 35),\n                        k.pos(k.width() / 2, headerY + 130),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.SECONDARY),\n                        k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                        k.area(),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                    ]);\n                    contentElements.push(retryBg);\n\n                    const retryLabel = k.add([\n                        k.text('Try Again', { size: UI_TEXT_SIZES.SMALL }),\n                        k.pos(k.width() / 2, headerY + 130),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.TEXT_PRIMARY),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    contentElements.push(retryLabel);\n\n                    retryBg.onClick(() => {\n                        playMenuNav();\n                        renderContent();\n                    });\n\n                    retryBg.onHoverUpdate(() => {\n                        retryBg.color = k.rgb(...UI_COLORS.SECONDARY_HOVER);\n                    });\n\n                    retryBg.onHoverEnd(() => {\n                        retryBg.color = k.rgb(...UI_COLORS.SECONDARY);\n                    });\n\n                    return;\n                }\n\n                const entries = result.entries;\n\n                // Header row\n                renderLeaderboardHeader(headerY);\n\n                // Entries\n                if (entries.length === 0) {\n                    const noData = k.add([\n                        k.text('No global entries yet. Be the first!', { size: UI_TEXT_SIZES.BODY }),\n                        k.pos(k.width() / 2, headerY + 60),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.TEXT_DISABLED),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    contentElements.push(noData);\n                } else {\n                    entries.forEach((entry, index) => {\n                        const rowY = headerY + 40 + (index * 35);\n                        const isPlayer = entry.name.toLowerCase() === playerName.toLowerCase();\n                        renderLeaderboardRow(index + 1, entry, rowY, isPlayer);\n                    });\n                }\n\n                // Show total count at bottom\n                if (result.totalCount > 0) {\n                    const totalY = headerY + 40 + (Math.min(entries.length, 10) * 35) + 20;\n                    const totalText = k.add([\n                        k.text(`${result.totalCount} player${result.totalCount !== 1 ? 's' : ''} worldwide`, { size: UI_TEXT_SIZES.SMALL }),\n                        k.pos(k.width() / 2, totalY),\n                        k.anchor('center'),\n                        k.color(...UI_COLORS.TEXT_SECONDARY),\n                        k.fixed(),\n                        k.z(UI_Z_LAYERS.UI_TEXT)\n                    ]);\n                    contentElements.push(totalText);\n                }\n            });\n        }\n\n        // Render pagination controls (reusable)\n        function renderPaginationControls(y, totalPages) {\n            const paginationCenterX = k.width() / 2;\n\n            // Page indicator pips\n            const pipSpacing = 20;\n            const pipsStartX = paginationCenterX - ((totalPages - 1) * pipSpacing) / 2;\n            const pipsEndX = paginationCenterX + ((totalPages - 1) * pipSpacing) / 2;\n\n            // Arrows positioned outside the pips with offset for pip clickable area (16px) + gap\n            const arrowOffset = 25;\n            const leftArrowX = pipsStartX - arrowOffset;\n            const rightArrowX = pipsEndX + arrowOffset;\n\n            for (let i = 0; i < totalPages; i++) {\n                const isCurrentPagePip = i === currentPage;\n                const pipX = pipsStartX + i * pipSpacing;\n\n                const pipBg = k.add([\n                    k.rect(16, 16),\n                    k.pos(pipX, y),\n                    k.anchor('center'),\n                    k.color(0, 0, 0),\n                    k.opacity(0),\n                    k.area({ width: 16, height: 16 }),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_ELEMENTS)\n                ]);\n\n                const pipText = k.add([\n                    k.text(isCurrentPagePip ? '' : '', { size: 14 }),\n                    k.pos(pipX, y),\n                    k.anchor('center'),\n                    k.color(isCurrentPagePip ? 255 : 120, isCurrentPagePip ? 255 : 120, isCurrentPagePip ? 255 : 120),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n\n                const pageIndex = i;\n                pipBg.onClick(() => {\n                    if (pageIndex !== currentPage) {\n                        playMenuNav();\n                        currentPage = pageIndex;\n                        renderContent();\n                    }\n                });\n                pipBg.cursor = 'pointer';\n\n                contentElements.push(pipBg, pipText);\n            }\n\n            // Left arrow (higher z-index to sit on top and take priority)\n            const leftArrowBg = k.add([\n                k.rect(30, 30),\n                k.pos(leftArrowX, y),\n                k.anchor('center'),\n                k.color(0, 0, 0),\n                k.opacity(0),\n                k.area({ width: 30, height: 30 }),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\n            ]);\n\n            const leftArrowText = k.add([\n                k.text('<', { size: 24 }),\n                k.pos(leftArrowX, y),\n                k.anchor('center'),\n                k.color(currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80, currentPage > 0 ? 255 : 80),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT + 1)\n            ]);\n\n            if (currentPage > 0) {\n                leftArrowBg.onClick(() => {\n                    playMenuNav();\n                    currentPage--;\n                    renderContent();\n                });\n                leftArrowBg.cursor = 'pointer';\n            }\n            contentElements.push(leftArrowBg, leftArrowText);\n\n            // Right arrow (higher z-index to sit on top and take priority)\n            const rightArrowBg = k.add([\n                k.rect(30, 30),\n                k.pos(rightArrowX, y),\n                k.anchor('center'),\n                k.color(0, 0, 0),\n                k.opacity(0),\n                k.area({ width: 30, height: 30 }),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS + 1)\n            ]);\n\n            const rightArrowText = k.add([\n                k.text('>', { size: 24 }),\n                k.pos(rightArrowX, y),\n                k.anchor('center'),\n                k.color(currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80, currentPage < totalPages - 1 ? 255 : 80),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT + 1)\n            ]);\n\n            if (currentPage < totalPages - 1) {\n                rightArrowBg.onClick(() => {\n                    playMenuNav();\n                    currentPage++;\n                    renderContent();\n                });\n                rightArrowBg.cursor = 'pointer';\n            }\n            contentElements.push(rightArrowBg, rightArrowText);\n        }\n\n        // Render leaderboard header row\n        function renderLeaderboardHeader(y) {\n            const headers = ['#', 'Name', 'Score', 'Floor', 'Time'];\n            const colPositions = [80, 150, 350, 470, 560];\n\n            headers.forEach((header, i) => {\n                const headerText = k.add([\n                    k.text(header, { size: UI_TEXT_SIZES.SMALL }),\n                    k.pos(colPositions[i], y),\n                    k.anchor(i === 0 ? 'center' : 'left'),\n                    k.color(...UI_COLORS.TEXT_SECONDARY),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_TEXT)\n                ]);\n                contentElements.push(headerText);\n            });\n\n            // Divider line\n            const divider = k.add([\n                k.rect(550, 2),\n                k.pos(k.width() / 2, y + 20),\n                k.anchor('center'),\n                k.color(...UI_COLORS.BORDER),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n            contentElements.push(divider);\n        }\n\n        // Render leaderboard row\n        function renderLeaderboardRow(rank, entry, y, isHighlighted = false) {\n            const colPositions = [80, 150, 350, 470, 560];\n            const color = isHighlighted ? UI_COLORS.GOLD : UI_COLORS.TEXT_PRIMARY;\n            const charData = CHARACTER_UNLOCKS[entry.character] || CHARACTER_UNLOCKS.survivor;\n\n            // Rank\n            const rankText = k.add([\n                k.text(rank <= 3 ? ['', '1st', '2nd', '3rd'][rank] : `${rank}`, { size: UI_TEXT_SIZES.BODY }),\n                k.pos(colPositions[0], y),\n                k.anchor('center'),\n                k.color(...(rank === 1 ? [255, 215, 0] : rank === 2 ? [192, 192, 192] : rank === 3 ? [205, 127, 50] : color)),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            contentElements.push(rankText);\n\n            // Name with character icon\n            const nameText = k.add([\n                k.text(`${charData.char} ${entry.name}`, { size: UI_TEXT_SIZES.BODY }),\n                k.pos(colPositions[1], y),\n                k.anchor('left'),\n                k.color(...color),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            contentElements.push(nameText);\n\n            // Score\n            const scoreText = k.add([\n                k.text(formatScore(entry.score), { size: UI_TEXT_SIZES.BODY }),\n                k.pos(colPositions[2], y),\n                k.anchor('left'),\n                k.color(...color),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            contentElements.push(scoreText);\n\n            // Floor\n            const floorText = k.add([\n                k.text(`${entry.floor}`, { size: UI_TEXT_SIZES.BODY }),\n                k.pos(colPositions[3], y),\n                k.anchor('left'),\n                k.color(...color),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            contentElements.push(floorText);\n\n            // Time\n            const timeText = k.add([\n                k.text(formatTime(entry.time), { size: UI_TEXT_SIZES.BODY }),\n                k.pos(colPositions[4], y),\n                k.anchor('left'),\n                k.color(...color),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n            contentElements.push(timeText);\n\n            // Highlight background for current player\n            if (isHighlighted) {\n                const highlight = k.add([\n                    k.rect(550, 30),\n                    k.pos(k.width() / 2, y),\n                    k.anchor('center'),\n                    k.color(...UI_COLORS.GOLD),\n                    k.opacity(0.1),\n                    k.fixed(),\n                    k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\n                ]);\n                contentElements.push(highlight);\n            }\n        }\n\n        // Back button (SM size - secondary action)\n        const { SM } = UI_SIZES.BUTTON;\n        const backButton = k.add([\n            k.rect(SM.width, SM.height),\n            k.pos(k.width() / 2, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.NEUTRAL),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n\n        k.add([\n            k.text('BACK', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        backButton.onClick(() => {\n            playMenuSelect();\n            k.go('menu');\n        });\n\n        backButton.onHoverUpdate(() => {\n            backButton.color = k.rgb(...UI_COLORS.SECONDARY_HOVER);\n        });\n\n        backButton.onHoverEnd(() => {\n            backButton.color = k.rgb(...UI_COLORS.SECONDARY);\n        });\n\n        // Keyboard shortcuts\n        k.onKeyPress('escape', () => {\n            playMenuSelect();\n            k.go('menu');\n        });\n\n        // Initialize\n        refreshTabs();\n        renderContent();\n    });\n}\n","// Profile scene - displays player profile with XP, level, portraits, and stats\nimport {\n    getPlayerName, setPlayerName, getPlayerLevel, getTotalXP,\n    getXPProgress, getXPForNextLevel, getXPRequiredForLevel,\n    getSelectedPortrait, setSelectedPortrait, isPortraitUnlocked,\n    getUnlockedPortraits, unlockPortrait, getSaveStats, loadSave\n} from '../systems/metaProgression.js';\nimport { generateRandomName } from '../systems/nameGenerator.js';\nimport { playMenuSelect, playMenuNav } from '../systems/sounds.js';\nimport {\n    PORTRAITS, getPortraitById, getAllPortraits,\n    checkPortraitUnlockCondition, getPortraitUnlockDescription,\n    getPortraitUnlockProgress, PORTRAIT_CATEGORIES\n} from '../data/portraits.js';\nimport {\n    UI_SIZES,\n    UI_TEXT_SIZES,\n    UI_COLORS,\n    UI_Z_LAYERS,\n    createMenuParticles,\n    createAnimatedTitle\n} from '../config/uiConfig.js';\n\n/**\n * Show name edit dialog (same as settings scene)\n */\nfunction showNameEditDialog(k, currentName, onSave) {\n    // Overlay\n    const overlay = k.add([\n        k.rect(k.width(), k.height()),\n        k.pos(0, 0),\n        k.color(0, 0, 0),\n        k.opacity(0.7),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY)\n    ]);\n\n    // Dialog box\n    const dialogWidth = 400;\n    const dialogHeight = 180;\n    const dialogBg = k.add([\n        k.rect(dialogWidth, dialogHeight),\n        k.pos(k.width() / 2, k.height() / 2),\n        k.anchor('center'),\n        k.color(...UI_COLORS.BG_MEDIUM),\n        k.outline(3, k.rgb(...UI_COLORS.BORDER)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 1)\n    ]);\n\n    // Title\n    const titleText = k.add([\n        k.text('Edit Player Name', { size: UI_TEXT_SIZES.LABEL }),\n        k.pos(k.width() / 2, k.height() / 2 - 60),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_PRIMARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\n    ]);\n\n    // Input display background\n    const inputBg = k.add([\n        k.rect(300, 40),\n        k.pos(k.width() / 2, k.height() / 2 - 10),\n        k.anchor('center'),\n        k.color(...UI_COLORS.BG_LIGHT),\n        k.outline(2, k.rgb(...UI_COLORS.GOLD)),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\n    ]);\n\n    // Input display\n    let inputText = currentName;\n    const inputDisplay = k.add([\n        k.text(inputText, { size: UI_TEXT_SIZES.LABEL }),\n        k.pos(k.width() / 2, k.height() / 2 - 10),\n        k.anchor('center'),\n        k.color(...UI_COLORS.GOLD),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\n    ]);\n\n    // Error/Info message\n    const infoMsg = k.add([\n        k.text('(Max 20 characters)', { size: UI_TEXT_SIZES.SMALL - 2 }),\n        k.pos(k.width() / 2, k.height() / 2 + 25),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_SECONDARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\n    ]);\n\n    // Store all dialog entities\n    const dialogEntities = [overlay, dialogBg, titleText, inputBg, inputDisplay, infoMsg];\n\n    // Close function\n    function closeDialog() {\n        dialogEntities.forEach(entity => {\n            if (entity && entity.exists && entity.exists()) {\n                k.destroy(entity);\n            }\n        });\n    }\n\n    // Cancel button\n    const cancelButton = k.add([\n        k.rect(100, 30),\n        k.pos(k.width() / 2 - 60, k.height() / 2 + 60),\n        k.anchor('center'),\n        k.color(...UI_COLORS.BG_MEDIUM),\n        k.outline(2, k.rgb(...UI_COLORS.TEXT_PRIMARY)),\n        k.area(),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\n    ]);\n\n    const cancelText = k.add([\n        k.text('Cancel', { size: UI_TEXT_SIZES.SMALL - 2 }),\n        k.pos(k.width() / 2 - 60, k.height() / 2 + 60),\n        k.anchor('center'),\n        k.color(...UI_COLORS.TEXT_PRIMARY),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\n    ]);\n\n    cancelButton.onClick(() => {\n        playMenuNav();\n        closeDialog();\n    });\n    dialogEntities.push(cancelButton, cancelText);\n\n    // Save button\n    const saveButton = k.add([\n        k.rect(100, 30),\n        k.pos(k.width() / 2 + 60, k.height() / 2 + 60),\n        k.anchor('center'),\n        k.color(...UI_COLORS.BG_MEDIUM),\n        k.outline(2, k.rgb(...UI_COLORS.GOLD)),\n        k.area(),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 2)\n    ]);\n\n    const saveText = k.add([\n        k.text('Save', { size: UI_TEXT_SIZES.SMALL - 2 }),\n        k.pos(k.width() / 2 + 60, k.height() / 2 + 60),\n        k.anchor('center'),\n        k.color(...UI_COLORS.GOLD),\n        k.fixed(),\n        k.z(UI_Z_LAYERS.OVERLAY + 3)\n    ]);\n\n    saveButton.onClick(() => {\n        if (inputText.trim().length > 0) {\n            playMenuSelect();\n            onSave(inputText.trim());\n            closeDialog();\n        } else {\n            infoMsg.text = 'Name cannot be empty!';\n            infoMsg.color = k.rgb(255, 100, 100);\n        }\n    });\n    dialogEntities.push(saveButton, saveText);\n\n    // Keyboard input handlers\n    const charHandler = k.onCharInput((ch) => {\n        if (inputText.length < 20 && /[a-zA-Z0-9 ]/.test(ch)) {\n            inputText += ch;\n            inputDisplay.text = inputText;\n            infoMsg.text = '(Max 20 characters)';\n            infoMsg.color = k.rgb(...UI_COLORS.TEXT_SECONDARY);\n        }\n    });\n\n    const backspaceHandler = k.onKeyPress('backspace', () => {\n        if (inputText.length > 0) {\n            inputText = inputText.slice(0, -1);\n            inputDisplay.text = inputText || ' ';\n        }\n    });\n\n    const escapeHandler = k.onKeyPress('escape', () => {\n        closeDialog();\n        charHandler.cancel();\n        backspaceHandler.cancel();\n        escapeHandler.cancel();\n        enterHandler.cancel();\n    });\n\n    const enterHandler = k.onKeyPress('enter', () => {\n        if (inputText.trim().length > 0) {\n            playMenuSelect();\n            onSave(inputText.trim());\n            closeDialog();\n            charHandler.cancel();\n            backspaceHandler.cancel();\n            escapeHandler.cancel();\n            enterHandler.cancel();\n        }\n    });\n}\n\nexport function setupProfileScene(k) {\n    k.scene('profile', (args = {}) => {\n        // Check if viewing another player's profile\n        const externalProfile = args.externalProfile || null;\n        const isViewingOther = externalProfile !== null;\n\n        // Get profile data from external source or local save\n        const saveData = isViewingOther ? externalProfile : loadSave();\n        let selectedPortraitId = isViewingOther ? externalProfile.selectedPortrait : getSelectedPortrait();\n\n        // Extract data based on source\n        const profileStats = isViewingOther ? externalProfile.stats : getSaveStats();\n        const profileLevel = isViewingOther ? externalProfile.playerLevel : getPlayerLevel();\n        const profileXP = isViewingOther ? externalProfile.totalXP : getTotalXP();\n        const profileName = isViewingOther ? externalProfile.playerName : (getPlayerName() || 'Player');\n        const profileAchievements = isViewingOther ? externalProfile.achievements : [];\n        const profileUnlockedPortraits = isViewingOther ? externalProfile.unlockedPortraits : getUnlockedPortraits();\n\n        // Background\n        k.add([\n            k.rect(k.width(), k.height()),\n            k.pos(0, 0),\n            k.anchor('topleft'),\n            k.color(...UI_COLORS.BG_DARK),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.BACKGROUND)\n        ]);\n\n        // Background particles\n        createMenuParticles(k, { patternCount: 8, particleCount: 12 });\n\n        // Title - show player name when viewing another player\n        if (isViewingOther) {\n            k.add([\n                k.text(`${profileName}'s Profile`, { size: UI_TEXT_SIZES.H1 }),\n                k.pos(k.width() / 2, 35),\n                k.anchor('center'),\n                k.color(...UI_COLORS.GOLD),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n        } else {\n            createAnimatedTitle(k, 'PROFILE', k.width() / 2, 35, 8);\n        }\n\n        // ==========================================\n        // PROFILE CARD SECTION (Top)\n        // ==========================================\n        const cardY = 80;\n        const cardHeight = 140;\n        const cardWidth = 720;\n        const cardX = k.width() / 2;\n\n        // Card background\n        k.add([\n            k.rect(cardWidth, cardHeight),\n            k.pos(cardX, cardY + cardHeight / 2),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_MEDIUM),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\n        ]);\n\n        // Portrait frame\n        const portraitSize = 80;\n        const portraitX = cardX - cardWidth / 2 + 60;\n        const portraitY = cardY + cardHeight / 2;\n        const currentPortrait = getPortraitById(selectedPortraitId) || PORTRAITS.default;\n\n        k.add([\n            k.rect(portraitSize, portraitSize),\n            k.pos(portraitX, portraitY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_LIGHT),\n            k.outline(3, k.rgb(...(currentPortrait.color || [200, 200, 200]))),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\n        ]);\n\n        // Portrait icon\n        const portraitIcon = k.add([\n            k.text(currentPortrait.icon, { size: 40 }),\n            k.pos(portraitX, portraitY - 5),\n            k.anchor('center'),\n            k.color(...(currentPortrait.color || [200, 200, 200])),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Level badge on portrait\n        k.add([\n            k.text(`LV${profileLevel}`, { size: 12 }),\n            k.pos(portraitX, portraitY + 28),\n            k.anchor('center'),\n            k.color(...UI_COLORS.GOLD),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Player info (right of portrait)\n        const infoX = portraitX + 80;\n        let infoY = cardY + 20;\n\n        // Player name\n        let playerName = profileName;\n        const nameDisplay = k.add([\n            k.text(playerName, { size: UI_TEXT_SIZES.H1 }),\n            k.pos(infoX, infoY),\n            k.anchor('left'),\n            k.color(...UI_COLORS.GOLD),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // Edit and randomize buttons - only show for local profile\n        if (!isViewingOther) {\n            const editIconSize = 24;\n            const randomButtonX = cardX + cardWidth / 2 - 20;\n            const editButtonX = randomButtonX - editIconSize - 8;\n\n            // Edit name button (pencil icon, square)\n            const editButton = k.add([\n                k.rect(editIconSize, editIconSize),\n                k.pos(editButtonX, infoY),\n                k.anchor('right'),\n                k.color(...UI_COLORS.BG_MEDIUM),\n                k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n\n            k.add([\n                k.text('', { size: 14 }),\n                k.pos(editButtonX - editIconSize / 2, infoY),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_PRIMARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            editButton.onClick(() => {\n                playMenuSelect();\n                showNameEditDialog(k, playerName, (newName) => {\n                    setPlayerName(newName);\n                    nameDisplay.text = newName;\n                    playerName = newName;\n                });\n            });\n\n            editButton.onHoverUpdate(() => {\n                editButton.color = k.rgb(...UI_COLORS.BG_LIGHT);\n            });\n            editButton.onHoverEnd(() => {\n                editButton.color = k.rgb(...UI_COLORS.BG_MEDIUM);\n            });\n\n            // Randomize name button (dice icon, square)\n            const randomButton = k.add([\n                k.rect(editIconSize, editIconSize),\n                k.pos(randomButtonX, infoY),\n                k.anchor('right'),\n                k.color(...UI_COLORS.BG_MEDIUM),\n                k.outline(2, k.rgb(...UI_COLORS.GOLD)),\n                k.area(),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ]);\n\n            k.add([\n                k.text('', { size: 14 }),\n                k.pos(randomButtonX - editIconSize / 2, infoY),\n                k.anchor('center'),\n                k.color(...UI_COLORS.GOLD),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            randomButton.onClick(() => {\n                playMenuSelect();\n                const newName = generateRandomName();\n                setPlayerName(newName);\n                nameDisplay.text = newName;\n                playerName = newName;\n            });\n\n            randomButton.onHoverUpdate(() => {\n                randomButton.color = k.rgb(...UI_COLORS.BG_LIGHT);\n            });\n            randomButton.onHoverEnd(() => {\n                randomButton.color = k.rgb(...UI_COLORS.BG_MEDIUM);\n            });\n        }\n\n        infoY += 35;\n\n        // Level with stars\n        const stars = Math.min(5, Math.floor(profileLevel / 10));\n        const starDisplay = ''.repeat(stars) + ''.repeat(5 - stars);\n        k.add([\n            k.text(`Level ${profileLevel}  ${starDisplay}`, { size: UI_TEXT_SIZES.LABEL }),\n            k.pos(infoX, infoY),\n            k.anchor('left'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n        infoY += 30;\n\n        // XP Progress bar\n        const barWidth = 250;\n        const barHeight = 16;\n        const xpProgress = isViewingOther ? 0 : getXPProgress();\n        const currentXP = profileXP;\n        const nextLevelXP = isViewingOther ? profileXP : getXPForNextLevel();\n        const currentLevelXP = getXPRequiredForLevel(profileLevel);\n\n        // Bar background\n        k.add([\n            k.rect(barWidth, barHeight),\n            k.pos(infoX, infoY),\n            k.anchor('left'),\n            k.color(40, 40, 60),\n            k.outline(1, k.rgb(80, 80, 100)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND + 1)\n        ]);\n\n        // Bar fill\n        const fillWidth = Math.max(2, barWidth * xpProgress);\n        k.add([\n            k.rect(fillWidth, barHeight - 4),\n            k.pos(infoX + 2, infoY),\n            k.anchor('left'),\n            k.color(100, 180, 255),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n\n        // XP text\n        k.add([\n            k.text(`${Math.round(xpProgress * 100)}%`, { size: 10 }),\n            k.pos(infoX + barWidth / 2, infoY),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_PRIMARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n        infoY += 22;\n\n        // XP numbers\n        k.add([\n            k.text(`${currentXP.toLocaleString()} / ${nextLevelXP.toLocaleString()} XP`, { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(infoX, infoY),\n            k.anchor('left'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // ==========================================\n        // PORTRAITS SECTION (directly below card since buttons moved to name)\n        // ==========================================\n        const portraitsY = cardY + cardHeight + 10;\n        const portraitsSectionHeight = 165;\n\n        // Section background\n        k.add([\n            k.rect(cardWidth, portraitsSectionHeight),\n            k.pos(cardX, portraitsY + portraitsSectionHeight / 2),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_MEDIUM),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\n        ]);\n\n        // Portrait grid (no header, 2 rows max with 13 per row = 26 portraits)\n        const allPortraits = getAllPortraits();\n        const iconSize = 40;\n        const iconSpacing = 50;\n        const maxPerRow = 13;\n        // Center the grid: total width = (maxPerRow - 1) * iconSpacing\n        const gridWidth = (maxPerRow - 1) * iconSpacing;\n        const gridStartX = cardX - gridWidth / 2;\n        const gridY = portraitsY + 28;\n\n        // Selected portrait info display\n        let selectedInfoText = null;\n        let selectedDescText = null;\n\n        function updateSelectedInfo(portrait) {\n            if (selectedInfoText && selectedInfoText.exists()) {\n                selectedInfoText.text = `Selected: \"${portrait.name}\"`;\n            }\n            if (selectedDescText && selectedDescText.exists()) {\n                selectedDescText.text = portrait.description;\n            }\n        }\n\n        allPortraits.forEach((portrait, index) => {\n            const row = Math.floor(index / maxPerRow);\n            const col = index % maxPerRow;\n            const x = gridStartX + col * iconSpacing;\n            const y = gridY + row * (iconSpacing + 5);\n\n            // Check if unlocked - use external data when viewing another player\n            const isUnlocked = isViewingOther\n                ? profileUnlockedPortraits.includes(portrait.id)\n                : checkPortraitUnlockCondition(portrait.id, saveData);\n            const isSelected = portrait.id === selectedPortraitId;\n\n            // Portrait box\n            const boxColor = isUnlocked\n                ? (isSelected ? [80, 100, 140] : UI_COLORS.BG_LIGHT)\n                : [40, 40, 50];\n            const borderColor = isSelected\n                ? UI_COLORS.GOLD\n                : (isUnlocked ? portrait.color : [80, 80, 80]);\n\n            const portraitBox = k.add([\n                k.rect(iconSize, iconSize),\n                k.pos(x, y),\n                k.anchor('center'),\n                k.color(...boxColor),\n                k.outline(isSelected ? 3 : 2, k.rgb(...borderColor)),\n                isViewingOther ? null : k.area(), // Only clickable for own profile\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_ELEMENTS)\n            ].filter(Boolean));\n\n            // Portrait icon (show icon even when locked, grayed out communicates lock)\n            const displayColor = isUnlocked ? portrait.color : [80, 80, 80];\n            const iconText = k.add([\n                k.text(portrait.icon, { size: 24 }),\n                k.pos(x, y - 3),\n                k.anchor('center'),\n                k.color(...displayColor),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            // Name below\n            const nameText = isUnlocked ? portrait.name.substring(0, 8) : '???';\n            k.add([\n                k.text(nameText, { size: 8 }),\n                k.pos(x, y + iconSize / 2 + 8),\n                k.anchor('center'),\n                k.color(...(isUnlocked ? UI_COLORS.TEXT_SECONDARY : [80, 80, 80])),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            // Click handler - only for own profile\n            if (!isViewingOther) {\n                portraitBox.onClick(() => {\n                    if (isUnlocked) {\n                        playMenuSelect();\n                        setSelectedPortrait(portrait.id);\n                        selectedPortraitId = portrait.id;\n                        // Update UI - would need to refresh scene\n                        updateSelectedInfo(portrait);\n                        k.go('profile'); // Refresh scene to show new selection\n                    } else {\n                        playMenuNav();\n                        // Show unlock requirement\n                        const desc = getPortraitUnlockDescription(portrait.id);\n                        if (selectedDescText && selectedDescText.exists()) {\n                            selectedDescText.text = `Locked: ${desc}`;\n                            selectedDescText.color = k.rgb(...UI_COLORS.DANGER);\n                        }\n                    }\n                });\n\n                portraitBox.onHoverUpdate(() => {\n                    if (!isSelected) {\n                        portraitBox.color = k.rgb(...(isUnlocked ? [100, 120, 160] : [50, 50, 60]));\n                    }\n                });\n                portraitBox.onHoverEnd(() => {\n                    if (!isSelected) {\n                        portraitBox.color = k.rgb(...boxColor);\n                    }\n                });\n            }\n        });\n\n        // Selected portrait info\n        selectedInfoText = k.add([\n            k.text(`Selected: \"${currentPortrait.name}\"`, { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(cardX, portraitsY + portraitsSectionHeight - 35),\n            k.anchor('center'),\n            k.color(...UI_COLORS.GOLD),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        selectedDescText = k.add([\n            k.text(currentPortrait.description, { size: UI_TEXT_SIZES.SMALL - 2 }),\n            k.pos(cardX, portraitsY + portraitsSectionHeight - 18),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        // ==========================================\n        // STATS SECTION\n        // ==========================================\n        const statsY = portraitsY + portraitsSectionHeight + 10;\n        const statsHeight = 120;\n\n        // Section background\n        k.add([\n            k.rect(cardWidth, statsHeight),\n            k.pos(cardX, statsY + statsHeight / 2),\n            k.anchor('center'),\n            k.color(...UI_COLORS.BG_MEDIUM),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_BACKGROUND)\n        ]);\n\n        // Stats display - Three rows (use profileStats for both local and external)\n        const stats = profileStats;\n        const totalRuns = stats.totalRuns || 0;\n        const avgCurrency = totalRuns > 0 ? Math.round((stats.totalCurrencyEarned || 0) / totalRuns) : 0;\n        const avgFloors = totalRuns > 0 ? ((stats.totalFloorsReached || 0) / totalRuns).toFixed(1) : '0';\n        const avgRooms = totalRuns > 0 ? ((stats.totalRoomsCleared || 0) / totalRuns).toFixed(1) : '0';\n\n        // Format fastest run time\n        const fastestTime = stats.fastestRunTime || 0;\n        const fastestMin = Math.floor(fastestTime / 60);\n        const fastestSec = Math.floor(fastestTime % 60);\n        const fastestDisplay = fastestTime > 0 ? `${fastestMin}:${fastestSec.toString().padStart(2, '0')}` : '--:--';\n\n        // Row 1: Main stats (5 columns)\n        const row1Stats = [\n            { label: 'Total Runs', value: totalRuns },\n            { label: 'Best Floor', value: stats.bestFloor || 1 },\n            { label: 'Best Level', value: stats.bestLevel || 1 },\n            { label: 'Best Room', value: stats.bestRoom || 1 },\n            { label: 'Fastest Run', value: fastestDisplay }\n        ];\n\n        const statWidth = cardWidth / row1Stats.length;\n        row1Stats.forEach((stat, index) => {\n            const x = cardX - cardWidth / 2 + statWidth * index + statWidth / 2;\n            const y = statsY + 15;\n\n            k.add([\n                k.text(stat.label, { size: UI_TEXT_SIZES.SMALL - 2 }),\n                k.pos(x, y),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            k.add([\n                k.text(String(stat.value), { size: UI_TEXT_SIZES.LABEL }),\n                k.pos(x, y + 16),\n                k.anchor('center'),\n                k.color(...UI_COLORS.GOLD),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n        });\n\n        // Row 2: Combat stats (5 columns)\n        const row2Stats = [\n            { label: 'Enemies', value: (stats.totalEnemiesKilled || 0).toLocaleString() },\n            { label: 'Bosses', value: stats.totalBossesKilled || 0 },\n            { label: 'Rooms', value: (stats.totalRoomsCleared || 0).toLocaleString() },\n            { label: 'Avg Floor', value: avgFloors },\n            { label: 'Avg Rooms', value: avgRooms }\n        ];\n\n        row2Stats.forEach((stat, index) => {\n            const x = cardX - cardWidth / 2 + statWidth * index + statWidth / 2;\n            const y = statsY + 50;\n\n            k.add([\n                k.text(stat.label, { size: UI_TEXT_SIZES.SMALL - 2 }),\n                k.pos(x, y),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            k.add([\n                k.text(String(stat.value), { size: UI_TEXT_SIZES.SMALL }),\n                k.pos(x, y + 14),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_PRIMARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n        });\n\n        // Row 3: Currency stats (5 columns)\n        const row3Stats = [\n            { label: 'Total Money', value: (stats.totalCurrencyEarned || 0).toLocaleString() },\n            { label: 'Spent', value: (stats.totalCurrencySpent || 0).toLocaleString() },\n            { label: 'Avg Money', value: avgCurrency.toLocaleString() },\n            { label: 'Floors', value: (stats.totalFloorsReached || 0).toLocaleString() },\n            { label: 'Play Time', value: (() => {\n                const playTime = stats.totalPlayTime || 0;\n                const hours = Math.floor(playTime / 3600);\n                const minutes = Math.floor((playTime % 3600) / 60);\n                return `${hours}h ${minutes}m`;\n            })() }\n        ];\n\n        row3Stats.forEach((stat, index) => {\n            const x = cardX - cardWidth / 2 + statWidth * index + statWidth / 2;\n            const y = statsY + 85;\n\n            k.add([\n                k.text(stat.label, { size: UI_TEXT_SIZES.SMALL - 2 }),\n                k.pos(x, y),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_SECONDARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n\n            k.add([\n                k.text(String(stat.value), { size: UI_TEXT_SIZES.SMALL }),\n                k.pos(x, y + 14),\n                k.anchor('center'),\n                k.color(...UI_COLORS.TEXT_PRIMARY),\n                k.fixed(),\n                k.z(UI_Z_LAYERS.UI_TEXT)\n            ]);\n        });\n\n        // ==========================================\n        // BACK BUTTON\n        // ==========================================\n        const { SM } = UI_SIZES.BUTTON;\n\n        const backButton = k.add([\n            k.rect(SM.width, SM.height),\n            k.pos(k.width() / 2, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.NEUTRAL),\n            k.outline(2, k.rgb(...UI_COLORS.BORDER)),\n            k.area(),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_ELEMENTS)\n        ]);\n\n        k.add([\n            k.text('BACK', { size: UI_TEXT_SIZES.SMALL }),\n            k.pos(k.width() / 2, k.height() - 40),\n            k.anchor('center'),\n            k.color(...UI_COLORS.TEXT_SECONDARY),\n            k.fixed(),\n            k.z(UI_Z_LAYERS.UI_TEXT)\n        ]);\n\n        backButton.onClick(() => {\n            playMenuNav();\n            k.go('menu');\n        });\n\n        backButton.onHoverUpdate(() => {\n            backButton.color = k.rgb(...UI_COLORS.NEUTRAL_HOVER);\n        });\n        backButton.onHoverEnd(() => {\n            backButton.color = k.rgb(...UI_COLORS.NEUTRAL);\n        });\n\n        // Escape key handler\n        k.onKeyPress('escape', () => {\n            playMenuNav();\n            k.go('menu');\n        });\n    });\n}\n","import kaplay from 'kaplay';\nimport { setupGameScene } from './scenes/game.js';\nimport { setupMenuScene } from './scenes/menu.js';\nimport { setupGameOverScene } from './scenes/gameOver.js';\nimport { setupShopScene } from './scenes/shop.js';\nimport { setupSettingsScene } from './scenes/settings.js';\nimport { setupStatisticsScene } from './scenes/statistics.js';\nimport { setupCharacterSelectScene } from './scenes/characterSelect.js';\nimport { initJoinPartyScene } from './scenes/joinParty.js';\nimport { setupLeaderboardsScene } from './scenes/leaderboards.js';\nimport { setupProfileScene } from './scenes/profile.js';\nimport { GAME_CONFIG } from './config/constants.js';\n\n// Initialize KAPLAY\nconst k = kaplay({\n    width: GAME_CONFIG.CANVAS_WIDTH,\n    height: GAME_CONFIG.CANVAS_HEIGHT,\n    background: GAME_CONFIG.BACKGROUND_COLOR,\n    scale: GAME_CONFIG.CANVAS_SCALE,\n    debug: GAME_CONFIG.DEBUG_MODE,\n    root: document.querySelector('#game-container'),\n    stretch: true,  // Stretch canvas to fill container\n    letterbox: true, // Maintain aspect ratio with letterboxing\n    crisp: true, // Disable anti-aliasing for crisp pixel art\n});\n\n// Setup scenes\nsetupMenuScene(k);\nsetupGameScene(k);\nsetupGameOverScene(k);\nsetupShopScene(k);\nsetupSettingsScene(k);\nsetupStatisticsScene(k);\nsetupCharacterSelectScene(k);\ninitJoinPartyScene(k);\nsetupLeaderboardsScene(k);\nsetupProfileScene(k);\n\n// Start with menu\nk.go('menu');\n\n"],"names":["Oo","t","e","r","o","i","m","u","c","p","Ao","Te","j","b","l","de","I","So","ae","lt","E","Se","Po","v","W","q","le","Dt","bt","fe","h","d","C","g","y","O","A","R","V","x","w","An","tu","nu","Vo","Xt","n","wr","Go","he","Cr","Mo","Er","Ro","Do","Tr","ru","Sn","Vn","Bt","Bo","Fo","Lo","be","Pn","Ft","Gn","Or","et","Oe","ou","Qt","Ar","Tn","Ke","jo","we","su","S","G","M","D","L","U","H","Y","_","K","J","$","Ee","k","gt","Gt","Io","Sr","iu","au","uu","cu","lu","mu","pu","Ko","du","ko","fu","hu","_o","On","gu","s","No","Uo","Ho","Jt","qo","zo","Wo","Yo","$o","Vr","Lt","Pr","jt","Xo","Qo","Jo","Yt","xr","$t","bu","yu","Zo","es","ts","ns","rs","xu","vr","vu","wu","Cu","Mn","os","Rn","mt","ss","yt","Zt","en","Eu","is","as","us","cs","ls","tn","nn","ms","ps","Gr","ds","fs","Dn","rn","ke","re","ze","hs","gs","bs","It","Tu","ys","Bn","Mr","xs","Rr","Fn","vs","Ln","ws","Cs","Ou","tt","on","ne","Au","Ts","Su","Bu","Mu","Ru","Fu","Vu","Es","Pu","Du","Gu","xt","Dr","De","We","sn","Os","As","jn","a","Ss","Qe","Vs","pt","Ps","vt","Br","Fr","Gs","ju","Ms","f","T","P","Me","br","En","B","te","To","Ae","se","Ze","Rt","Cn","Xa","Ht","yn","xn","mr","pr","Mt","$e","vn","F","N","z","oe","ye","Q","ve","qt","ut","dr","fr","hr","gr","wn","Xe","ct","zt","Ie","Wt","Je","Ja","vo","Qa","Re","wo","yr","Co","Za","Eo","ee","an","un","Iu","Ku","ku","_u","Nu","Uu","Hu","qu","zu","_e","Rs","Ds","In","Bs","Fs","Ls","Kn","nt","Wu","Lr","jr","Ir","kn","dt","js","ie","ue","wt","Is","Ks","X","ge","ks","rt","Ye","me","Ce","_n","Ct","Nn","Ve","pe","ce","ft","_r","Et","_s","Ns","Us","Hs","Tt","Be","Un","qs","cn","zs","Ws","Fe","Ur","Kt","Nr","Ot","Ys","$s","Xs","At","Hr","Hn","qr","Qs","Js","Zs","ei","zr","qn","ti","Wr","ni","ri","ot","oi","Yr","si","ii","$r","Le","Pe","kt","zn","Ne","_t","$u","Xu","Qu","Wn","ai","st","Yn","St","ui","Xr","mi","$n","Ue","it","He","xe","qe","Qr","Xn","di","Jr","fi","hi","Qn","gi","Vt","bi","yi","Zr","xi","at","je","vi","Jn","wi","Ci","Ei","Zn","Ti","eo","Oi","Ai","er","tr","Si","Vi","Pt","nr","Ge","Pi","Gi","rr","Mi","to","Ri","Di","Bi","no","Fi","Li","ji","Ii","or","Ki","ki","_i","Ni","Ui","Hi","qi","Nt","zi","ro","oo","so","io","ao","uo","Wi","co","ar","ir","Yi","$i","pn","sr","Xi","Qi","Ji","Zi","dn","ea","ta","na","ra","ht","oa","sa","ia","aa","ur","lo","mo","ua","cr","ca","lr","fn","Ut","hn","po","gn","fo","la","ma","pa","da","fa","ha","ga","ba","ya","xa","va","wa","Ca","Ea","bn","Ta","ho","go","bo","Oa","yo","Aa","Sa","Va","Pa","Ga","xo","Ma","Ra","Da","Ba","Fa","La","ja","Ia","Ka","ka","_a","Na","Ua","Ha","qa","za","Wa","Ya","sc","ic","hw","ADJECTIVES","NOUNS","generateRandomName","adjective","noun","generateInviteCode","isValidInviteCode","code","ACHIEVEMENTS","ACHIEVEMENT_COLORS","ACHIEVEMENT_REWARDS","getAchievementReward","achievement","getAchievementsByCategory","category","ach","getAchievementCategories","categories","getAchievementById","id","getAchievementProgress","achievementId","stats","currentValue","targetValue","progress","CHARACTER_UNLOCKS","WEAPON_UNLOCKS","COSMETIC_UNLOCKS","RUN_BOOSTER_UNLOCKS","PERMANENT_UPGRADE_UNLOCKS","getUnlocksForCategory","STORAGE_KEY","CURRENCY_ICON","DEFAULT_SAVE","MAX_RUN_HISTORY","loadSave","saved","data","mergedData","saveGame","newSave","getSaveData","addCurrency","amount","save","getCurrency","isUnlocked","item","unlockItem","checkFloorUnlocks","floorCompleted","unlocked","key","char","checkAchievementUnlocks","getSelectedCharacter","setSelectedCharacter","characterKey","getPermanentUpgradeLevel","upgradeKey","purchaseUnlock","cost","getUpgradePrice","level","prices","purchasePermanentUpgrade","maxLevel","currentLevel","purchaseBooster","boosterKey","getActiveBoostersCount","consumeBoosters","boosters","getTotalRefundableCredits","total","purchaseHistory","refundSinglePermanentUpgrade","refundAmount","index","refundAllPermanentUpgrades","updateRunStats","runStats","isAchievementUnlocked","unlockAchievement","reward","unlockedChars","getUnlockedAchievements","getSaveStats","calculateCurrencyEarned","currency","bossBountyLevel","creditBonusLevel","getCurrencyName","getPlayerName","setPlayerName","name","getInviteCode","setInviteCode","recordRun","runData","runRecord","getRunHistory","getEquippedCosmetic","type","setEquippedCosmetic","getEquippedCosmetics","calculateLevelFromXP","xp","getXPRequiredForLevel","getPlayerLevel","getTotalXP","getXPForNextLevel","getXPProgress","totalXP","currentLevelXP","nextLevelXP","addXP","oldLevel","newLevel","calculateRunXP","getSelectedPortrait","setSelectedPortrait","portraitId","getUnlockedPortraits","STICK_DEADZONE","JOYSTICK_SIZE","JOYSTICK_KNOB_SIZE","JOYSTICK_OPACITY","JOYSTICK_ACTIVE_OPACITY","inputState","applyDeadzone","value","deadzone","initInputSystem","gamepads","updateGamepadInput","gamepad","rawAimX","rawAimY","initTouchControls","cleanupTouchJoysticks","createJoystickVisuals","canvas","handleTouchStart","handleTouchMove","handleTouchEnd","screenWidth","screenHeight","leftCenterX","leftCenterY","rightCenterX","rightCenterY","rect","scaleX","scaleY","touch","dx","dy","distance","maxDistance","clampedDistance","angle","normalizedDistance","getMovementInput","getAimInput","WEAPON_DEFINITIONS","getWeaponDefinition","weaponKey","isUpgradeValidForWeapon","upgradeCategory","GAME_CONFIG","PLAYER_CONFIG","PROGRESSION_CONFIG","CHARACTER_ABILITIES","COMBAT_CONFIG","WEAPON_CONFIG","PICKUP_CONFIG","calculateDamageAfterDefense","baseDamage","defense","damageReduction","afterReduction","rollCriticalHit","critChance","rng","calculateCriticalDamage","critMultiplier","createPlayer","selectedCharKey","charData","outline","player","headStartLevel","weaponDef","characterDamageBonus","weaponBaseDamage","characterDamageMultiplier","luckyStartLevel","thickSkinLevel","xpMagnetLevel","comfortZoneLevel","moveDir","windowHasFocus","keysNeedRelease","handleBlur","handleFocus","flashRate","effectiveMoveDir","altInput","len","moveAmount","newX","newY","canMoveX","canMoveY","obstacles","playerSize","obstacle","obsLeft","obsRight","obsTop","obsBottom","playerLeft","playerRight","playerTop","playerBottom","playerLeftY","playerRightY","playerTopY","playerBottomY","roomWidth","roomHeight","margin","network","initNetwork","inviteCode","isHost","resolve","reject","disconnect","peerId","isLocalhost","peerConfig","codeToReturn","err","newCode","conn","handleIncomingConnection","cb","handleMessage","connectToHost","hostInviteCode","hostPeerId","connectionTimeout","isResolved","fromPeerId","handler","onMessage","messageType","offMessage","onConnectionChange","callback","sendToHost","payload","sendToPeer","broadcast","excludePeerIds","getNetworkInfo","displayCode","CONSTANTS","assert","assertion","message","assertionError","stringToByteArray$1","str","out","byteArrayToString","bytes","pos","c1","c2","c3","c4","base64","input","webSafe","byteToCharMap","output","byte1","haveByte2","byte2","haveByte3","byte3","outByte1","outByte2","outByte3","outByte4","charToByteMap","byte4","DecodeBase64StringError","base64Encode","utf8Bytes","base64urlEncodeWithoutPadding","base64Decode","deepCopy","deepExtend","target","source","dateValue","prop","isValidKey","getGlobal","getDefaultsFromGlobal","getDefaultsFromEnvVariable","define_process_env_default","defaultsJsonString","getDefaultsFromCookie","match","decoded","getDefaults","getDefaultEmulatorHost","productName","_b","getDefaultEmulatorHostnameAndPort","host","separatorIndex","port","getDefaultAppConfig","Deferred","error","createMockUserToken","token","projectId","header","project","iat","sub","getUA","isMobileCordova","isReactNative","isNodeSdk","isIndexedDBAvailable","validateIndexedDBOpenable","preExist","DB_CHECK_NAME","request","ERROR_NAME","FirebaseError","customData","ErrorFactory","service","serviceName","errors","fullCode","template","replaceTemplate","fullMessage","PATTERN","jsonEval","stringify","decode","claims","signature","parts","isValidFormat","isAdmin","contains","obj","safeGet","isEmpty","map","contextObj","res","deepEqual","aKeys","bKeys","aProp","bProp","isObject","thing","querystring","querystringParams","params","arrayVal","Sha1","buf","offset","length","lengthMinusBlock","inbuf","digest","totalBits","errorPrefix","fnName","argName","stringToByteArray","high","low","stringLength","getModularInstance","Component","instanceFactory","mode","multipleInstances","props","DEFAULT_ENTRY_NAME","Provider","container","identifier","normalizedIdentifier","deferred","instance","options","optional","component","isComponentEager","instanceIdentifier","instanceDeferred","services","opts","normalizedDeferredIdentifier","existingCallbacks","existingInstance","callbacks","normalizeIdentifierForFactory","ComponentContainer","provider","LogLevel","levelStringToEnum","defaultLogLevel","ConsoleMethod","defaultLogHandler","logType","args","now","method","Logger","val","instanceOfAny","object","constructors","idbProxyableTypes","cursorAdvanceMethods","getIdbProxyableTypes","getCursorAdvanceMethods","cursorRequestMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","promisifyRequest","promise","unlisten","success","wrap","cacheDonePromiseForTransaction","tx","done","complete","idbProxyTraps","receiver","replaceTraps","wrapFunction","func","storeNames","unwrap","transformCachableValue","newValue","openDB","version","blocked","upgrade","blocking","terminated","openPromise","event","db","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","storeName","oldTraps","PlatformLoggerServiceImpl","isVersionServiceProvider","logString","name$q","version$1","logger","name$p","name$o","name$n","name$m","name$l","name$k","name$j","name$i","name$h","name$g","name$f","name$e","name$d","name$c","name$b","name$a","name$9","name$8","name$7","name$6","name$5","name$4","name$3","name$2","name$1","PLATFORM_LOG_STRING","_apps","_serverApps","_components","_addComponent","app","_registerComponent","componentName","serverApp","_getProvider","heartbeatController","ERRORS","ERROR_FACTORY","FirebaseAppImpl","config","SDK_VERSION","initializeApp","_options","rawConfig","existingApp","newApp","getApp","registerVersion","libraryKeyOrName","variant","library","libraryMismatch","versionMismatch","warning","DB_NAME","DB_VERSION","STORE_NAME","dbPromise","getDbPromise","oldVersion","readHeartbeatsFromIndexedDB","result","computeKey","idbGetError","writeHeartbeatsToIndexedDB","heartbeatObject","MAX_HEADER_BYTES","STORED_HEARTBEAT_RETENTION_MAX_MILLIS","HeartbeatServiceImpl","HeartbeatStorageImpl","agent","date","getUTCDateString","singleDateHeartbeat","hbTimestamp","heartbeatsToSend","unsentEntries","extractHeartbeatsForHeader","headerString","heartbeatsCache","maxSize","heartbeatEntry","hb","countBytes","idbHeartbeatObject","heartbeatsObject","existingHeartbeatsObject","registerCoreComponents","setSDKVersion","DOMStorageWrapper","domStorage_","storedVal","MemoryStorage","createStoragefor","domStorageName","domStorage","PersistentStorage","SessionStorage","logClient","LUIDGenerator","sha1","sha1Bytes","buildLogMessage_","varArgs","arg","firstLog_","enableLogging$1","logger_","persistent","log","logWrapper","prefix","fatal","warn","warnIfPageIsSecure","isInvalidJSONNumber","executeWhenDOMReady","called","wrappedFn","MIN_NAME","MAX_NAME","nameCompare","aAsInt","tryParseInt","bAsInt","stringCompare","requireKey","ObjectToUniqueKey","keys","splitStringBySize","segsize","dataSegs","each","doubleToIEEE754String","ebits","fbits","bias","ln","bits","hexByteString","hexByte","isChromeExtensionContentScript","isWindowsStoreApp","errorForServerCode","query","reason","INTEGER_REGEXP_","INTEGER_32_MIN","INTEGER_32_MAX","intVal","exceptionGuard","stack","beingCrawled","setTimeoutNonBlocking","time","timeout","AppCheckTokenProvider","appName_","appCheckProvider","appCheck","forceRefresh","listener","FirebaseAuthTokenProvider","firebaseOptions_","authProvider_","auth","errorMessage","EmulatorTokenProvider","accessToken","PROTOCOL_VERSION","VERSION_PARAM","TRANSPORT_SESSION_PARAM","REFERER_PARAM","FORGE_REF","FORGE_DOMAIN_RE","LAST_SESSION_PARAM","APPLICATION_ID_PARAM","APP_CHECK_TOKEN_PARAM","WEBSOCKET","LONG_POLLING","RepoInfo","secure","namespace","webSocketOnly","nodeAdmin","persistenceKey","includeNamespaceInQueryParams","isUsingEmulator","newHost","protocol","repoInfoNeedsQueryParam","repoInfo","repoInfoConnectionURL","connURL","pairs","StatsCollection","collections","reporters","statsManagerGetCollection","hashString","statsManagerGetOrCreateReporter","creatorFunction","PacketReceiver","onMessage_","responseNum","requestNum","toProcess","FIREBASE_LONGPOLL_START_PARAM","FIREBASE_LONGPOLL_CLOSE_COMMAND","FIREBASE_LONGPOLL_COMMAND_CB_NAME","FIREBASE_LONGPOLL_DATA_CB_NAME","FIREBASE_LONGPOLL_ID_PARAM","FIREBASE_LONGPOLL_PW_PARAM","FIREBASE_LONGPOLL_SERIAL_PARAM","FIREBASE_LONGPOLL_CALLBACK_ID_PARAM","FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM","FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET","FIREBASE_LONGPOLL_DATA_PARAM","FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM","MAX_URL_DATA_SIZE","SEG_HEADER_SIZE","MAX_PAYLOAD_SIZE","KEEPALIVE_REQUEST_INTERVAL","LP_CONNECT_TIMEOUT","BrowserPollConnection","connId","applicationId","appCheckToken","authToken","transportSessionId","lastSessionId","onDisconnect","FirebaseIFrameScriptHolder","command","arg1","arg2","arg3","arg4","pN","urlParams","connectURL","dataStr","base64data","pw","bytesReceived","commandCB","onMessageCB","urlFn","script","iframeContents","iframe","domain","theURL","curDataString","theSeg","segnum","totalsegs","url","serial","doNewRequest","keepaliveTimeout","readyStateCB","loadCB","newScript","rstate","WEBSOCKET_MAX_FRAME_SIZE","WEBSOCKET_KEEPALIVE_INTERVAL","WebSocketImpl","WebSocketConnection","isOldAndroid","oldAndroidRegex","oldAndroidMatch","fullMess","jsonMess","frameCount","mess","remainingData","TransportManager","isWebSocketsAvailable","isSkipPollConnection","transports","transport","UPGRADE_TIMEOUT","DELAY_BEFORE_SENDING_EXTRA_REQUESTS","BYTES_SENT_HEALTHY_OVERRIDE","BYTES_RECEIVED_HEALTHY_OVERRIDE","MESSAGE_TYPE","MESSAGE_DATA","CONTROL_SHUTDOWN","CONTROL_RESET","CONTROL_ERROR","CONTROL_PONG","SWITCH_ACK","END_TRANSMISSION","PING","SERVER_HELLO","Connection","repoInfo_","applicationId_","appCheckToken_","authToken_","onReady_","onDisconnect_","onKill_","onMessageReceived","onConnectionLost","healthyTimeoutMS","everConnected","dataMsg","msg","controlData","cmd","parsedData","layer","handshakePayload","handshake","timestamp","ServerActions","pathString","onComplete","hash","EventEmitter","allowedEvents_","eventType","listeners","context","eventData","OnlineMonitor","MAX_PATH_DEPTH","MAX_PATH_LENGTH_BYTES","Path","pathOrString","pieceNum","copyTo","newEmptyPath","pathGetFront","path","pathGetLength","pathPopFront","pathGetBack","pathToUrlEncodedString","pathSlice","begin","pathParent","pieces","pathChild","childPathObj","childPieces","pathIsEmpty","newRelativePath","outerPath","innerPath","outer","inner","pathCompare","left","right","leftKeys","rightKeys","cmp","pathEquals","other","pathContains","ValidationPath","errorPrefix_","validationPathCheckValid","validationPathPush","validationPath","child","validationPathPop","last","validationPathToErrorString","VisibilityMonitor","hidden","visibilityChange","visible","RECONNECT_MIN_DELAY","RECONNECT_MAX_DELAY_DEFAULT","RECONNECT_MAX_DELAY_FOR_ADMINS","RECONNECT_DELAY_MULTIPLIER","RECONNECT_DELAY_RESET_TIMEOUT","SERVER_KILL_INTERRUPT_REASON","INVALID_TOKEN_THRESHOLD","PersistentConnection","onDataUpdate_","onConnectStatus_","onServerInfoUpdate_","authTokenProvider_","appCheckTokenProvider_","authOverride_","action","body","onResponse","curReqNum","outstandingGet","currentHashFn","tag","queryId","listenSpec","get","req","status","warnings","indexSpec","indexPath","credential","authMethod","requestData","queryObj","response","errorReason","reqNum","sessionId","online","timeSinceLastConnectAttempt","reconnectDelay","onDataMessage","onReady","canceled","connection","closeFn","sendRequestFn","delta","put","listen","normalizedPathString","statusCode","explanation","queries","clientName","NamedNode","node","Index","oldNode","newNode","oldWrapped","newWrapped","__EMPTY_NODE","KeyIndex","indexValue","KEY_INDEX","SortedMapIterator","startKey","comparator","isReverse_","resultGenerator_","LLRBNode","color","SortedMap","smallest","nl","blackDepth","LLRBEmptyNode","comparator_","root_","rightParent","resultGenerator","NAME_ONLY_COMPARATOR","NAME_COMPARATOR","MAX_NODE$2","setMaxNode$1","priorityHashText","priority","validatePriorityNode","priorityNode","__childrenNodeConstructor","LeafNode","value_","priorityNode_","newPriorityNode","childName","childNode","newChildNode","front","exportFormat","toHash","otherLeaf","otherLeafType","thisLeafType","otherIndex","thisIndex","nodeFromJSON$1","MAX_NODE$1","setNodeFromJSON","setMaxNode","PriorityIndex","aPriority","bPriority","indexCmp","PRIORITY_INDEX","LOG_2","Base12Num","logBase2","num","bitMask","mask","buildChildSet","childList","keyFn","mapSortFn","buildBalancedTree","namedNode","middle","buildFrom12Array","base12","root","buildPennant","chunkSize","childTree","attachPennant","pennant","isOne","_defaultIndexMap","fallbackObject","IndexMap","indexes_","indexSet_","indexKey","sortedMap","indexDefinition","existingChildren","sawIndexedValue","iter","next","newIndex","indexName","newIndexSet","newIndexes","indexedChildren","existingSnap","newChildren","EMPTY_NODE","ChildrenNode","children_","indexMap_","newIndexMap","newPriority","newImmediateChild","numKeys","maxKey","allIntegerKeys","array","childHash","idx","predecessor","minKey","wrappedNode","startPost","iterator","endPost","MAX_NODE","otherChildrenNode","thisIter","otherIter","thisCurrent","otherCurrent","MaxNode","USE_HINZE","nodeFromJSON","json","jsonLeaf","children","childrenHavePriority","childSet","sortedChildSet","childData","PathIndex","indexPath_","snap","aChild","bChild","valueNode","ValueIndex","VALUE_INDEX","changeValue","snapshotNode","changeChildAdded","changeChildRemoved","changeChildChanged","oldSnap","changeChildMoved","IndexedFilter","index_","newChild","affectedPath","optChangeAccumulator","oldChild","newSnap","RangedFilter","isWithinStart","isWithinEnd","filtered","self","startName","endName","LimitedFilter","compareRes","count","childKey","childSnap","changeAccumulator","oldEventCache","newChildNamedNode","windowBoundary","inRange","oldChildSnap","nextChild","compareNext","newEventCache","QueryParams","copy","queryParamsGetNodeFilter","queryParams","queryParamsOrderBy","newParams","queryParamsToRestQueryStringParameters","orderBy","startParam","endParam","queryParamsGetQueryObject","viewFrom","ReadonlyRestClient","listenId","thisListen","queryStringParameters","xhr","SnapshotHolder","newSnapshotNode","newSparseSnapshotTree","sparseSnapshotTreeRemember","sparseSnapshotTree","sparseSnapshotTreeForget","tree","sparseSnapshotTreeForEachTree","prefixPath","sparseSnapshotTreeForEachChild","StatsListener","collection_","newStats","stat","FIRST_STATS_MIN_TIME","FIRST_STATS_MAX_TIME","REPORT_STATS_INTERVAL","StatsReporter","collection","server_","reportedStats","haveStatsToReport","OperationType","newOperationSourceUser","newOperationSourceServer","newOperationSourceServerTaggedQuery","AckUserWrite","affectedTree","revert","ListenComplete","Overwrite","Merge","CacheNode","node_","fullyInitialized_","filtered_","EventGenerator","query_","eventGeneratorGenerateEventsForChanges","eventGenerator","changes","eventCache","eventRegistrations","events","moves","change","eventGeneratorGenerateEventsForType","registrations","filteredChanges","eventGeneratorCompareChanges","materializedChange","eventGeneratorMaterializeSingleChange","registration","aWrapped","bWrapped","newViewCache","serverCache","viewCacheUpdateEventSnap","viewCache","eventSnap","viewCacheUpdateServerSnap","serverSnap","viewCacheGetCompleteEventSnap","viewCacheGetCompleteServerSnap","emptyChildrenSingleton","EmptyChildren","ImmutableTree","childPath","relativePath","predicate","childExistingPathAndValue","toSet","newTree","pathSoFar","accum","pathToFollow","currentRelativePath","CompoundWrite","writeTree_","compoundWriteAddWrite","compoundWrite","rootmost","rootMostPath","subtree","newWriteTree","compoundWriteAddWrites","updates","newWrite","compoundWriteRemoveWrite","compoundWriteHasCompleteWrite","compoundWriteGetCompleteNode","compoundWriteGetCompleteChildren","compoundWriteChildCompoundWrite","shadowingNode","compoundWriteIsEmpty","compoundWriteApply","applySubtreeWrite","writeTree","priorityWrite","writeTreeChildWrites","newWriteTreeRef","writeTreeAddOverwrite","writeId","writeTreeGetWrite","record","writeTreeRemoveWrite","writeToRemove","removedWriteWasVisible","removedWriteOverlapsWithOtherWrites","currentWrite","writeTreeRecordContainsPath_","writeTreeResetTree_","writeRecord","writeTreeLayerTree_","writeTreeDefaultFilter_","write","writes","filter","treeRoot","writePath","deepNode","writeTreeCalcCompleteEventCache","treePath","completeServerCache","writeIdsToExclude","includeHiddenWrites","subMerge","layeredCache","merge","mergeAtPath","writeTreeCalcCompleteEventChildren","completeServerChildren","completeChildren","topLevelSet","writeTreeCalcEventCacheAfterServerOverwrite","existingEventSnap","existingServerSnap","childMerge","writeTreeCalcCompleteChild","writeTreeShadowingWrite","writeTreeCalcIndexedSlice","completeServerData","reverse","toIterate","nodes","writeTreeRefCalcCompleteEventCache","writeTreeRef","writeTreeRefCalcCompleteEventChildren","writeTreeRefCalcEventCacheAfterServerOverwrite","writeTreeRefShadowingWrite","writeTreeRefCalcIndexedSlice","writeTreeRefCalcCompleteChild","existingServerCache","writeTreeRefChild","ChildChangeAccumulator","oldChange","oldType","NoCompleteChildSource_","NO_COMPLETE_CHILD_SOURCE","WriteTreeCompleteChildSource","writes_","viewCache_","optCompleteServerCache_","serverNode","newViewProcessor","viewProcessorAssertIndexed","viewProcessor","viewProcessorApplyOperation","oldViewCache","operation","writesCache","completeCache","accumulator","filterServerNode","overwrite","viewProcessorApplyUserOverwrite","viewProcessorApplyServerOverwrite","viewProcessorApplyUserMerge","viewProcessorApplyServerMerge","ackUserWrite","viewProcessorRevertUserWrite","viewProcessorAckUserWrite","viewProcessorListenComplete","viewProcessorMaybeAddValueEvent","isLeafOrEmpty","oldCompleteSnap","viewProcessorGenerateEventCacheAfterServerEvent","changePath","oldEventSnap","completeEventChildren","completeNode","oldEventNode","updatedPriority","childChangePath","newEventChild","eventChildUpdate","changedSnap","oldServerSnap","newServerCache","serverFilter","newServerNode","newEventSnap","viewProcessorCacheHasChild","changedChildren","curViewCache","viewProcessorApplyMerge","viewMergeTree","serverChild","childMergeTree","isUnknownDeepMerge","ackPath","mergePath","serverCachePath","oldServerNode","serverChildren","View","initialViewCache","indexFilter","initialServerCache","initialEventCache","viewGetServerCache","view","viewGetCompleteServerCache","cache","viewIsEmpty","viewAddEventRegistration","eventRegistration","viewRemoveEventRegistration","cancelError","cancelEvents","maybeEvent","remaining","existing","viewApplyOperation","viewGenerateEventsForChanges_","viewGetInitialEvents","initialChanges","referenceConstructor$1","SyncPoint","syncPointSetReferenceConstructor","syncPointGetReferenceConstructor","syncPointIsEmpty","syncPoint","syncPointApplyOperation","optCompleteServerCache","syncPointGetView","serverCacheComplete","eventCacheComplete","syncPointAddEventRegistration","syncPointRemoveEventRegistration","removed","hadCompleteView","syncPointHasCompleteView","viewQueryId","syncPointGetQueryViews","syncPointGetCompleteServerCache","syncPointViewForQuery","syncPointGetCompleteView","syncPointViewExistsForQuery","referenceConstructor","syncTreeSetReferenceConstructor","syncTreeGetReferenceConstructor","syncTreeNextQueryTag_","SyncTree","listenProvider_","syncTreeApplyUserOverwrite","syncTree","newData","syncTreeApplyOperationToSyncPoints_","syncTreeAckUserWrite","syncTreeApplyServerOverwrite","syncTreeApplyServerMerge","changeTree","syncTreeApplyListenComplete","syncTreeApplyTaggedListenComplete","queryKey","syncTreeQueryKeyForTag_","syncTreeParseQueryKey_","queryPath","op","syncTreeApplyTaggedOperation_","syncTreeRemoveEventRegistration","skipListenerDedup","maybeSyncPoint","removedAndEvents","removingDefault","covered","parentSyncPoint","newViews","syncTreeCollectDistinctViewsForSubTree_","newQuery","syncTreeCreateListenerForView_","syncTreeQueryForListening_","syncTreeTagForQuery","queryToRemove","tagToRemove","syncTreeMakeQueryKey_","syncTreeRemoveTags_","syncTreeApplyTaggedQueryOverwrite","syncTreeApplyTaggedQueryMerge","syncTreeAddEventRegistration","skipSetupListener","foundAncestorDefaultView","pathToSyncPoint","sp","childSyncPoint","viewAlreadyExists","syncTreeGetNextQueryTag_","syncTreeSetupListener_","syncTreeCalcCompleteEventCache","syncTreeApplyOperationHelper_","syncPointTree","syncTreeApplyOperationDescendantsHelper_","childOperation","childServerCache","childWritesCache","splitIndex","maybeChildSyncPoint","childMap","views","_key","childViews","removedQuery","removedQueryKey","removedQueryTag","queriesToStop","childQueries","queryToStop","ExistingValueProvider","DeferredValueProvider","generateWithValues","values","resolveDeferredLeafValue","existingVal","serverValues","resolveScalarDeferredValue","resolveComplexDeferredValue","unused","existingNode","resolveDeferredValueTree","resolveDeferredValue","resolveDeferredValueSnapshot","rawPri","leafNode","childrenNode","Tree","parent","treeSubTree","pathObj","treeGetValue","treeSetValue","treeUpdateParents","treeHasChildren","treeIsEmpty","treeForEachChild","treeForEachDescendant","includeSelf","childrenFirst","treeForEachAncestor","treeGetPath","treeUpdateChild","childEmpty","childExists","INVALID_KEY_REGEX_","INVALID_PATH_REGEX_","MAX_LEAF_SIZE_","isValidPathString","isValidRootPathString","isValidPriority","validateFirebaseDataArg","validateFirebaseData","path_","hasDotValue","hasActualChild","validateFirebaseMergePaths","mergePaths","curPath","prevPath","validateFirebaseMergeDataArg","errorPrefix$1","validatePriority","validatePathString","argumentName","validateRootPathString","validateWritablePath","validateUrl","parsedUrl","EventQueue","eventQueueQueueEvents","eventQueue","eventDataList","currList","eventQueueRaiseEventsAtPath","eventQueueRaiseQueuedEventsMatchingPredicate","eventPath","eventQueueRaiseEventsForChangedPath","changedPath","sentAll","eventList","eventListRaise","eventFn","INTERRUPT_REASON","MAX_TRANSACTION_RETRIES","Repo","forceRestClient_","appCheckProvider_","repoStart","repo","appId","authOverride","isMerge","repoOnDataUpdate","repoOnConnectStatus","connectStatus","repoOnServerInfoUpdate","infoEvents","repoUpdateInfo","repoServerTime","repoGenerateServerValues","taggedChildren","raw","taggedSnap","repoRerunTransactions","repoRunOnDisconnectEvents","repoGetNextWriteId","repoSetWithPriority","newVal","repoLog","newNodeUnresolved","clearEvents","repoCallOnCompleteCallback","repoAbortTransactions","resolvedOnDisconnectTree","resolved","repoOnDisconnectCancel","repoOnDisconnectSet","repoOnDisconnectSetWithPriority","repoOnDisconnectUpdate","childrenToMerge","repoAddEventCallbackForQuery","repoRemoveEventCallbackForQuery","repoInterrupt","repoGetLatestState","excludeSets","repoSendReadyTransactions","repoPruneCompletedTransactionsBelowNode","queue","repoBuildTransactionQueue","transaction","repoSendTransactionQueue","setsToIgnore","txn","latestState","snapToSend","latestHash","dataToSend","pathToSend","rootMostTransactionNode","repoGetAncestorTransactionNode","repoRerunTransactionQueue","abortTransaction","abortReason","currentNode","newDataNode","oldWriteId","newNodeResolved","unwatcher","transactionNode","transactionQueue","repoAggregateTransactionQueuesForNode","nodeQueue","from","repoAbortTransactionsOnNode","lastSent","decodePath","pathStringDecoded","piece","decodeQuery","queryString","results","segment","kv","parseRepoInfo","dataURL","parseDatabaseURL","subdomain","scheme","colonInd","slashInd","questionMarkInd","hostWithoutPort","dotInd","PUSH_CHARS","nextPushId","lastPushTime","lastRandChars","duplicateTime","timeStampChars","DataEvent","snapshot","prevName","ref","CancelEvent","CallbackContext","snapshotCallback","cancelCallback","expDataSnapshot","previousChildName","OnDisconnect","_repo","_path","QueryImpl","_queryParams","_orderByCalled","ReferenceImpl","sameRepo","samePath","sameQueryIdentifier","validateNoPreviousOrderByCall","validateQueryEndpoints","startNode","endNode","tooManyArgsError","wrongArgTypeError","parentPath","DataSnapshot","_node","_index","childRef","push","thenablePushRef","pushRef","remove","set","ValueEventRegistration","callbackContext","addEventListener","cancelCallbackOrListenOptions","onValue","off","QueryConstraint","QueryOrderByChildConstraint","parsedPath","orderByChild","queryConstraints","queryImpl","constraint","FIREBASE_DATABASE_EMULATOR_HOST_VAR","repos","useRestClient","repoManagerApplyEmulatorSettings","tokenProvider","repoManagerDatabaseFromApp","authProvider","dbUrl","dbEmulatorHost","authTokenProvider","repoManagerCreateRepo","Database","repoManagerDeleteRepo","appName","appRepos","_repoInternal","apiName","getDatabase","emulator","connectDatabaseEmulator","registerDatabase","SDK_VERSION$1","SERVER_TIMESTAMP","serverTimestamp","onEcho","firebaseConfig","database","isInitialized","isSearching","queueEntryRef","queueListener","kaplayInstance","matchmakingCallbacks","initFirebase","setupGlobalMatchHandler","isMatchmaking","startMatchmaking","isPartyFull","playerName","queueRef","orderedQueueRef","queueData","players","hostEntry","stopMatchmaking","joinPartyAsClient","notifyEnd","entryToRemove","onPlayerJoinedParty","getParty","isFirebaseConfigured","party","partyHostHandlersRegistered","partyClientHandlersRegistered","initParty","selectedCharacter","selectedPortrait","actualCode","setupNetworkHandlers","slotIndex","addPlayerToPartyFromNetwork","partySyncData","slot","sendInitialGameState","broadcastPartyUpdate","checkAllReady","handlePartyEmote","targetSlot","handleProfileRequest","targetPeerId","handleProfileResponse","handlePlayerDisconnect","getPartySize","getDisplayInviteCode","permanentUpgradeLevels","playerLevel","savedLocalPlayer","setupClientHandlers","restoreLocalPlayerToSoloParty","playerInfo","partySize","localSlotIndex","broadcastGameStart","playerData","finalizeDisconnect","cleanupDisconnectedPlayer","removePlayerFromParty","getPartyDisplayInfo","broadcastCharacterChange","toggleReady","localSlot","getLocalPlayerSlot","isLocalPlayerReady","areAllPlayersReady","occupiedSlots","startCountdown","cancelCountdown","getCountdownState","elapsed","emoteType","broadcastPartyEmote","onPartyEmote","offPartyEmote","getActiveEmote","maxAge","emote","clearPartyCallbacks","profileRequestCallbacks","getLocalProfileData","requestPlayerProfile","profileData","BOSS_TYPES","getBossDefinition","createBoss","floor","baseConfig","floorMultiplier","getBossVisual","leftArmor","rightArmor","boss","leftShield","rightShield","shieldPercent","armorPercent","visual","damage","shieldChanged","armorChanged","previousShieldHealth","previousArmorHealth","shieldRegenCooldownDuration","shieldDamage","remainingDamage","reducedDamage","armorDamage","damageMultiplier","finalDamage","healthPercent","phase","minionCount","angleVariation","spawnDistance","spawnX","spawnY","minionType","minion","createEnemy","isMultiplayerActive","registerEnemy","directions","projectileSpeed","projectileDamage","dir","projectile","createProjectile","targetPos","regenInterval","regenAmount","minionSpawnInterval","chargeCooldown","radialBurstInterval","chargeMove","normalized","moveSpeed","bossSize","bossLeftX","bossRightX","bossTopX","bossBottomX","bossLeftY","bossRightY","bossTopY","bossBottomY","chargeDistance","chargeSpeedMultiplier","preferredDistance","fireInterval","direction","spawnInterval","activeMinions","centerX","centerY","toCenter","toPlayer","playerDistance","broadcastDeathEvent","createTwinGuardians","door1","door2","meleeGuardian","rangedGuardian","broadcastBossEnrage","POWERUP_WEAPONS","rollPowerupDrop","enemyType","dropChanceBonus","powerup","adjustedChance","finalChance","applyPowerupWeapon","powerupKey","durabilityBonus","restoreOriginalWeapon","original","updatePowerupWeapon","broadcastPowerupExpired","decrementPowerupAmmo","getPowerupDisplay","createXPPickup","pickup","pulse","dirToPlayer","registerPickup","unregisterPickup","CURRENCY_ICONS","getRandomCurrencyIcon","createCurrencyPickup","icon","currencyIcon","timeRemaining","flashSpeed","flash","createPowerupWeaponPickup","SeededRandom","seed","min","max","arr","probability","state","createSeed","components","seedFromString","connectionState","initConnectionQuality","pingId","peerState","latency","UPGRADE_STACK_LIMITS","UPGRADES","stacks","multiplier","baseFireRate","baseSpeed","baseHealth","bonusHP","oldMaxHealth","hpDiff","baseMultiplier","baseRadius","baseCount","basePiercing","baseObstaclePiercing","finalCritChance","finalCritDamage","baseSpread","baseRange","baseJumps","baseReduction","baseDefense","baseDodge","pickupStacks","pickupMultiplier","baseDuration","isUpgradeValidForPlayer","maxStacks","startingWeapon","getRandomUpgrades","allOptions","validOptions","option","selected","used","randomIndex","applyUpgrade","recalculateAllUpgrades","getUpgradeDescription","UI_SIZES","UI_TEXT_SIZES","UI_COLORS","UI_BUTTON","UI_TERMS","formatButtonText","text","formatXP","current","UI_Z_LAYERS","CURRENCY_SYMBOLS","createMenuParticles","patternCount","particleCount","includeCursorFollowers","patterns","pattern","scale","particle","cursorFollowers","shipChars","ship","dist","ASCII_TITLES","createAnimatedTitle","fontSize","hslToRgb","titleKey","asciiTitle","title","colorTime","hue","titleLines","lineSpacing","startY","line","titleLine","createCreditIndicator","currencyName","getRandomInterval","measurementText","panelWidth","panelHeight","panel","updateCurrency","newCurrency","newWidth","toastState","initToastSystem","showToast","toast","processQueue","showAchievementToast","difficultyColor","showMultiplayerAchievementToast","toastData","createToastUI","startX","targetX","toastIndex","borderColor","bgColor","borderWidth","glowTime","iconBg","iconSize","iconTime","baseY","bounce","messageLines","messageElements","toastElements","updateHandler","easedProgress","easeOutCubic","currentX","lerp","updateToastPositionX","easeInCubic","exitX","opacity","destroyToast","repositionActiveToasts","oldY","offsetY","msgIndex","start","end","mpGame","initMultiplayerGame","gameSeed","setupHostHandlers","multiplayerClientHandlersRegistered","multiplayerHostHandlersRegistered","moveX","moveY","aimAngle","collectGameState","playerState","localPlayer","receivedIds","enemyState","existingEnemy","enemy","pickupState","targetPlayer","damageText","originalColor","entity","revivePercent","reviveHealth","reviveHealthPercent","reviveEffect","cleanupMultiplayer","registerPlayer","playerEntity","broadcastPlayerDisconnect","updateMultiplayer","broadcastGameState","sendInputState","desyncDetected","requestResync","lerpFactor","playerStates","enemyStates","projectileStates","pickupStates","weaponsArray","upgradesArray","stacksObj","currentHP","entityId","sendAllExistingEntities","entityData","move","getPlayerCount","creationParams","registerProjectile","colorArray","unregisterProjectile","spawnData","broadcastDamageEvent","broadcastHealEvent","broadcastDodgeEvent","bossNetworkId","broadcastRevivalEvent","broadcastGameOver","currencyEarned","partyStats","broadcastHostQuit","broadcastPowerupWeaponApplied","broadcastUpgradeSelected","broadcastLevelUpQueued","broadcastSynergyActivated","synergyKeys","hasGameSeed","onGameSeedReceived","setCurrentFloor","floorSeed","getRoomRNG","getFirstRoomTemplateKey","getFloorRNG","getUpgradeRNG","playerIndex","broadcastGameSeed","firstRoomTemplateKey","broadcastPauseState","paused","sendPauseRequest","sendEnemyDeath","deathData","broadcastObstacles","doorStates","broadcastRoomCompletion","broadcastXPGain","xpValue","broadcastCurrencyGain","currencyValue","getAndClearPendingXP","pending","broadcastEmote","broadcastRoomTransition","entryDirection","allPlayerStats","gridDirection","currentFloor","roomTemplateKey","broadcastEnemySplit","splitCount","broadcastPlayerDeath","broadcastAchievementUnlocked","playerSlotIndex","ObjectPool","createFn","resetFn","initialSize","pools","initObjectPools","proj","speed","piercing","obstaclePiercing","isCrit","maxRange","size","velocity","gravity","lifetime","fadeStart","friction","zIndex","getParticlePool","clearAllPools","distToPlayer","returnDir","returnSpeed","distanceThisFrame","ENEMY_TYPES","getEnemyDefinition","GRID_SIZE","MAX_PATH_LENGTH","PriorityQueue","element","worldToGrid","gridToWorld","gx","gy","isCellWalkable","gridWidth","gridHeight","worldPos","halfSize","cellLeft","cellRight","cellTop","cellBottom","obstacleLeft","obstacleRight","obstacleTop","obstacleBottom","heuristic","findPath","goalX","goalY","goal","frontier","cameFrom","costSoFar","getKey","iterations","maxIterations","neighbors","moveCost","newCost","nextKey","getSmartMoveDirection","targetY","waypoint","toWaypoint","distanceToWaypoint","toTarget","getPerimeterMoveDirection","perim","threshold","distanceToTarget","getEnemyVisual","floorArmorBonus","floorShieldBonus","floorShieldRegen","armorRoll","shieldRoll","bothRoll","totalBaseArmor","totalBaseShield","healthBarWidth","healthBarHeight","healthBarOffset","healthBarBg","healthBar","barWidth","isPositionClear","testX","testY","enemySize","enemyLeft","enemyRight","enemyTop","enemyBottom","applyObstacleAvoidance","desiredMove","desiredDir","perpendicular1","perpendicular2","testDirections","testDir","avoidMove","avoidX","avoidY","alivePlayers","minDistance","finalMove","jitter","teleportDir","teleportPos","spawnAngle","nearbyEnemies","otherEnemy","maxHP","newHP","healText","teleportAngle","teleportX","teleportY","clampedX","clampedY","teleportText","rushMove","bomb","toPlayerNorm","buffedEnemy","splitType","splitEnemy","explosionText","MINIBOSS_TYPES","getMinibossDefinition","createMiniboss","miniboss","minibossSize","createDoor","doorGroup","part","doorChars","doorText","leftCorner","rightCorner","spacing","doorPart","topDecor","bottomDecor","blockedMarker","newColor","newText","createObstacle","width","height","isWall","defaultColor","defaultOutline","BARREL_CONFIG","allBarrels","createBarrel","barrel","healthBarFill","sourceId","fromNetwork","explosionX","explosionY","createExplosionEffect","dealExplosionDamage","triggerChainReaction","radius","outerRing","innerRing","core","debris","knockbackForce","falloff","knockback","sourceBarrelId","chainRadius","findBarrelByPosition","tolerance","clearAllBarrels","SpatialGrid","cellSize","cellX","cellY","cell","oldKey","newKey","cellRadius","centerKey","cx","cy","minX","minY","maxX","maxY","minCellX","minCellY","maxCellX","maxCellY","totalEntities","maxEntitiesInCell","minEntitiesInCell","audioContext","masterVolume","musicVolume","sfxVolume","uiSoundsEnabled","combatSoundsEnabled","currentMusic","currentMusicTrack","MUSIC_TRACKS","musicCache","initAudio","resumeAudioContext","getAudioContext","setMasterVolume","volume","setSfxVolume","setUiSoundsEnabled","enabled","setCombatSoundsEnabled","playTone","frequency","duration","ctx","osc","gainNode","finalVolume","attack","decay","playNoise","bufferSize","buffer","vary","playPistolFire","variation","playSMGFire","playShotgunFire","freq","playSniperFire","playFlamethrowerFire","playExplosiveFire","playChainLightningFire","playOrbitalFire","playGenericFire","playEnemyHit","playPlayerHit","playEnemyDeath","playExplosion","playXPPickup","playCurrencyPickup","playLevelUp","baseFreq","mult","playDoorOpen","playMenuSelect","playMenuNav","playUpgradeSelect","playBossSpawn","playBossDeath","playAchievement","playPurchaseSuccess","playPurchaseError","playPause","playUnpause","playWeaponFire","weaponType","weaponName","setMusicVolume","stopMusic","playMusicTrack","trackName","loop","trackPath","playPromise","playMenuMusic","playCombatMusic","playDefeatMusic","SETTINGS_KEY","DEFAULT_SETTINGS","loadSettings","mergeDeep","saveSettings","settings","getSettings","updateSetting","getSetting","resetSettings","createParticle","pool","releaseParticle","updateParticles","lifetimePercent","fadePercent","areParticlesEnabled","spawnBloodSplatter","chars","actualCount","actualSpeed","actualColor","speedMult","spawnDeathExplosion","isBoss","isMiniboss","spawnHitImpact","dirLen","dirNorm","spreadAngle","spawnTrailParticle","trailType","trailChars","particleColor","offsetX","createGlowEffect","glowType","glowEntity","updateGlowEffect","glow","spawnCosmeticDeath","deathType","enemyColor","spawnExplosiveDeath","spawnDisintegrateDeath","spawnVaporizeDeath","spawnPixelateDeath","spawnFireworksDeath","coreCount","kInstance","originalCamPos","shakeTimer","shakeIntensity","inHitFreeze","lastShakeTime","MIN_SHAKE_INTERVAL","lastFreezeTime","MIN_FREEZE_INTERVAL","initVisualEffects","screenShake","intensity","currentTime","updateScreenShake","hitFreeze","isInHitFreeze","EffectPresets","resetVisualEffects","spawnDamageNumber","displayText","dmgText","applySafeKnockback","knockbackDir","knockbackAmount","roomMargin","boundedX","boundedY","originalX","originalY","walls","allObstacles","colliding","setupCombatSystem","lastFireTime","initializeOrbitalWeapons","aimInput","mousePos","aimAngleDeg","enemies","bosses","minibosses","updateOrbitalWeapons","baseDirection","shouldFire","angleRad","effectiveFireRate","speedStacks","projectileCount","angleStep","startAngle","rad","cos","sin","delay","weaponRange","burnDamagePerTick","burnDuration","dotMultiplier","createExplosiveProjectile","createChainProjectile","wall","explodeProjectile","cover","maxReflections","reflectionCount","jumpCount","chainToNextEnemy","ownerPlayer","healAmount","lifestealMultiplier","impactDir","thornsDamage","reducedThornsDamage","enrageMultiplier","damageAfterReduction","orb","orbCount","orbitRadius","expectedOrbCount","rotationSpeed","explosionRadius","explosionDamage","chainRange","maxJumps","allTargets","currentEnemy","nearestEnemy","nearestDist","startPos","endPos","midX","midY","chainLine","TUTORIAL_HINTS","TUTORIAL_STORAGE_KEY","currentHint","loadTutorialProgress","stored","saveTutorialProgress","hasHintBeenShown","hintId","markHintShown","showHint","hint","hintBg","hintText","showMovementHint","showSynergyHint","SYNERGIES","newMaxHealth","minSafeHP","trackUpgrade","checkAndApplySynergies","activeSynergies","synergyKey","synergy","hasAllRequired","showSynergyNotification","notification","desc","reapplySynergies","upgradeDraftActive","showUpgradeDraft","onSelect","levelOverride","rerollsAvailable","inMultiplayer","minimapNeedsUpdate","toughChoicesLevel","mulliganLevel","numUpgradeOptions","rerollsRemaining","rerollSeed","generateUpgrades","upgradeRng","upgrades","overlay","titleText","createUpgradeCards","baseCardWidth","baseCardHeight","maxTotalWidth","cardWidth","cardHeight","availableWidth","cardY","cards","cardX","cardBg","iconColor","nameSize","descSize","description","numSize","selectUpgrade","rerollText","rerollButton","performReroll","activatedSynergies","synergyNames","isUpgradeDraftActive","setupProgressionSystem","reviveAllPlayersCallback","isMultiplayer","levelUpInProgress","adjustedAmount","handleLevelUp","pendingLevel","ENEMY_SPAWN_WEIGHTS","getDefaultWeights","weightedRandom","weights","sum","weight","random","getRandomEnemyType","ELITE_MODIFIERS","ELITE_CONFIG","shouldSpawnElite","getRandomEliteModifier","modifiers","roll","applyEliteModifier","modifierKey","modifier","newChar","tryMakeElite","ROOM_WIDTH","ROOM_HEIGHT","ROOM_MARGIN","lastRoomTemplate","ROOM_TEMPLATES","constrainObstacleToRoom","halfWidth","halfHeight","getFloorColors","floorPalettes","palette","getWeightedRoomTemplate","allTemplates","availableTemplates","floorSpecific","universal","templatePool","finalPool","randomKey","getBarrelPositions","templateKey","positions","extraX","extraY","resetRoomTemplateHistory","getRoomTemplateByKey","runUnlockedAchievements","unlockAndNotify","initAchievementChecker","getRunUnlockedAchievements","checkAchievements","currentRunStats","savedStats","newlyUnlocked","check","condition","RoomNode","FloorMap","midRow","bossRow","startRoom","bossRoom","room","maxBranches","branchesAdded","enemyCount","visited","nextPos","exits","nextRoom","currentRoom","minimapGrid","row","adjRoom","connections","generateFloorMap","floorMap","MINIMAP_MODE","LAYOUT","COLORS","Minimap","el","bg","badge","grid","headerHeight","gridStartX","gridStartY","counter","legendHeight","padding","safeWidth","actualGridWidth","legendY","showBackground","col","cellBg","cellText","legends","colWidth","rowHeight","legend","itemX","itemY","symbol","label","createMinimap","FLOOR_THEMES","getFloorTheme","theme","generateFloorDecorations","decorations","deco","baseColor","perSide","renderFloorDecorations","PlayerState","playerId","EntityState","GameState","playerJson","entityJson","StateManager","gameMode","stateManager","PlayerInput","frameNumber","InputManager","playerIds","inputs","InputManagerSingleton","inputManager","MessageType","NetworkMessage","senderId","NetworkManager","messages","handlers","NetworkManagerSingleton","networkManager","gameState","gameSceneMessageHandlersRegistered","applyPermanentUpgrades","upgradeLevels","useLocalStorage","healthLevel","damageLevel","speedLevel","applyRunBoosters","booster","boosterDef","effect","boosterText","setupGameScene","eventHandlers","doorEntered","roomCompleted","spawnDoors","reviveAllPlayers","spatialGrids","getSeededRoomRNG","roomSeed","generateFloorMapAndMinimap","floorRng","floorNames","getFloorName","skipIntroAnimation","floorTitle","floorSubtitle","doorMargin","playerSpawnX","playerSpawnY","characterOverride","wasRemote","savedHP","glowDef","trailDef","equippedCosmetics","networkInfo","roomRng","firstRoomTemplate","localOffsetX","remotePlayer","fullRunStats","nameTag","currentLocalSlot","localPlayerStats","door","isBossRoom","northDoor","completionText","completionMsg","obsData","upgradingPlayer","leveledPlayer","synergyPlayer","expiringPlayer","healedPlayer","dodgingPlayer","dodgeText","showEmote","emoteChar","emoteColor","lastEmoteTime","EMOTE_COOLDOWN","emotingPlayer","localPlayerId","secondWindLevel","revivedCount","playerKey","progressionSystem","pendingXP","currentRoomNode","roomTemplate","firstRoomKey","floorColors","isFirstRoom","safeZoneRadius","entranceDoorX","entranceDoorY","obstacleDataForBroadcast","shouldCreateObstacles","obs","distanceToSpawn","distanceToEntrance","obstacleRadius","constrainedPos","obstacleColor","distToSpawn","distToEntrance","overlapsObstacle","enemyIcon","enemiesCounter","creditText","runTimerText","runElapsedTime","fpsCounter","fpsUpdateInterval","lastFps","playerCount","statusColor","statusText","xpBarWidth","xpBarHeight","xpBarY","initialXpProgress","initialXpWidth","xpBarFill","xpBarText","levelBadgeSize","levelBadgeX","levelBadgeY","levelText","playerHealthBarWidth","playerHealthBarHeight","playerHealthBarOffsetY","playerHealthBarBg","playerHealthBarFill","weaponIconSize","weaponIconX","weaponIconY","weaponIconBg","weaponIconText","weaponDetailWidth","weaponDetailHeight","weaponDetailBg","weaponDetailIcon","weaponDetailName","weaponDetailDamage","weaponDetailFireRate","weaponDetailDPS","weaponDetailState","powerupIconSize","powerupIconX","powerupIconY","powerupIconBg","powerupIconText","powerupAmmoText","buffsDisplayX","buffsDisplayY","buffIconSize","buffIconSpacing","activeBuffIcons","updateBuffDisplay","upgradesWithStacks","xPos","upgradeDef","stackText","levelUpButtonSize","levelUpButtonX","levelUpButtonY","levelUpButtonBg","levelUpButtonText","levelUpCountBadgeSize","levelUpCountBadgeX","levelUpCountBadgeY","levelUpCountBadge","levelUpCountText","levelUpGlowTime","outlineSize","brightness","tooltip","tooltipText","tooltipData","showTooltip","hideTooltip","saveTooltipState","restoreTooltipState","additionalEnemiesFromSplits","minutes","seconds","isBelowThreshold","speedMultiplier","timeSinceCombat","cooldown","regenPercent","trailInterval","distMoved","hovering","bossNameText","bossHealthBarBg","bossHealthBar","bossArmorBarBg","bossArmorBar","bossHealthText","bossArmorText","bossShieldBarBg","bossShieldBar","bossShieldText","xpProgress","healthBarX","healthBarY","fillWidth","fillBarX","currentEnemies","totalEnemies","enemiesToSpawn","isMinibossRoom","currentMinibosses","remainingEnemies","enemiesSpawned","minibossSpawned","dps","powerupDisplay","pendingCount","twinGuardians","meleeHP","rangedHP","totalHP","totalMaxHP","meleeShield","rangedShield","totalShield","totalMaxShield","meleeArmor","rangedArmor","totalArmor","totalMaxArmor","remainingBoss","bossHP","bossMaxHP","bossShieldHP","bossMaxShieldHP","bossArmorHP","bossMaxArmorHP","bossName","initialSpawnDelay","bossSpawned","entranceDoorExclusionTime","roomStartTime","minibossChance","getRandomMinibossType","minibossTypes","simpleTypes","getBossTypeForFloor","allDoorPositions","availableExits","availableGridDirs","exit","spawnDoor","enemySpawnTimer","enemySpawnInterval","roomStartTimeSet","bossType","bossRng","availableDoors","shuffled","oppositeMap","guardian","announcement","bossSpawnDoor","doorIndex","bossX","bossY","bossMinions","handleRoomCompletion","minibossType","minibossRng","doorsToUse","randomDoor","minibossX","minibossY","minibossName","spawnRng","timeSinceRoomStart","side","posX","posY","deathEffect","shrapnelCount","shrapnelSpeed","shrapnelDamage","killerSlot","lootRng","currencyDropCount","powerupDrop","minibossKillerSlot","minibossCurrencyCount","minibossCurrencyValue","deathText","bossKillerSlot","bossCurrencyCount","bossCurrencyValue","bossCurrencyIcon","autoPickupXP","effectiveXPRadius","pickupCheckRadius","nearbyPickups","closestPlayer","closestDistance","magnetRadius","autoPickupCurrency","effectiveCurrencyRadius","flashAge","doorProgressCircle","doorProgressBg","doorProgressTime","doorProgressDoor","doorProgressIsForced","DOOR_PROGRESS_DURATION","DOOR_FORCE_DURATION","hostInRange","allPlayersInRange","shouldShowProgress","isForced","handleDoorEntry","spawnRoomClearRewards","baseXP","baseCurrency","xpMultiplier","currencyMultiplier","floorBonus","numXPPickups","numCurrencyPickups","rewardRng","powerupKeys","numPowerups","randomPowerup","entryDirectionMap","unlockText","nextTemplate","runDuration","pauseOverlay","pauseText","pauseCenterY","LG","SM","resumeButton","quitButton","btn","updatePauseUI","yesButton","noButton","dialogKeyHandlers","confirmYes","confirmNo","handleGameBlur","PORTRAIT_CATEGORIES","PORTRAITS","getPortraitById","getAllPortraits","checkPortraitUnlockCondition","saveData","portrait","statValue","getPortraitUnlockDescription","statName","DAILY_RUN_STORAGE_KEY","DAILY_CHARACTERS","getTodayDateString","getDailySeed","dateStr","getDailyCharacter","getTodayDailyCharacter","getDailyRunData","saveDailyRunData","hasCompletedDailyToday","today","getDailyCompletion","getTodayCompletion","markDailyCompleted","completion","getTodayAttemptCount","getDailyRunInfo","character","completed","attempts","createMenuButton","primaryColor","hoverColor","textColor","formattedText","isDisabled","getContrastingTextColor","setupMenuScene","audioResumed","resumeAudio","rightColumnX","profileCardX","profileCardY","profileCardWidth","profileCardHeight","profileCardBg","portraitSize","portraitX","portraitY","displayName","infoX","xpBarX","xpFillWidth","partyPanelX","partyPanelY","partyPanelWidth","slotHeight","slotSpacing","titlePadding","partyPanelHeight","slotsStartY","slotElements","updatePartySlots","elements","slotY","elementsForThisSlot","isClickable","slotBg","slotIcon","slotIconEl","levelBadge","charIcon","nameText","readyIcon","readyColor","readyText","activeEmote","emoteText","dcText","lastPartyCheck","updateStartButtonState","inviteCodeY","inviteCodeDisplay","hasValidCode","currentCode","joinButtonY","findMatchY","findMatchButton","findMatchLabel","updateFindMatchButton","searching","buttonText","buttonColor","outlineColor","hostCode","readyButtonY","readyButtonElements","countdownDisplay","lastReadyState","updateReadyButton","forceUpdate","countdown","isReady","countdownSeconds","readyBg","readyLabel","lastCountdownCheck","dailyPanelWidth","dailyPanelHeight","dailyPanelX","dailyRunY","dailyInfo","dailyChar","dailyDisabledInMultiplayer","dailyPlayButton","leaderboardsY","leaderboardsPanel","titleY","buttonStartY","buttonSpacing","XL","playButton","shouldDisable","characterButton","selectedCharData","isCharUnlocked","charDisplayX","charDisplayY","charDisplaySize","charDisplayBg","charDisplayIcon","shopButton","statisticsButton","settingsButton","menuButtons","buttonColorTime","button","spaceHandler","cHandler","sHandler","oHandler","tHandler","qHandler","eHandler","emoteCallback","goldenEnemy","rewardText","getCharactersUnlockedByAchievement","characters","modalState","showAchievementModal","onClose","closeAchievementModal","modalWidth","modalHeight","modalBg","iconText","descText","characterUnlocks","hasShopUnlocks","hasCharacterUnlocks","unlockParts","unlockKey","weapon","cosmetic","unlocksText","progressBaseY","progressY","progressBg","progressFill","progressText","unlockedText","creditReward","rewardY","rewardLabel","difficultyName","difficultyBadge","closeButton","closeText","escHandler","isAchievementModalOpen","LEADERBOARDS","CORS_PROXY","DREAMLO_RAW_URL","buildProxiedUrl","CACHE_DURATION_MS","leaderboardCaches","REQUEST_TIMEOUT_MS","sanitizeName","isValidScore","score","fetchWithTimeout","controller","timeoutId","submitOnlineScore","entry","boardType","board","submitDailyScore","parseEntry","textParts","getOnlineLeaderboard","limit","entries","rawEntries","getGlobalRank","playerScore","sanitizedName","MAX_DAILY_ENTRIES","MAX_ALLTIME_ENTRIES","getLeaderboards","parsed","saveLeaderboards","calculateScore","floorScore","enemyScore","bossScore","timeBonus","submitScore","personal","getDailyLeaderboard","targetDate","getAllTimeLeaderboard","getPersonalBests","formatTime","mins","secs","formatScore","getPercentageColor","percent","createStatBar","maxValue","usePercentageColor","barHeight","fillColor","labelEl","barBg","barFill","valueEl","clampedValue","newPercent","getEnemyName","getEnemyChar","getEnemyColor","AWARDS","setupGameOverScene","isDailyRun","dailyCharacter","runDate","leaderboardResult","onlineScoreEntry","totalTeamCredits","unlockedAchievementIds","xpEarned","leveledUp","headerY","rankRowY","localRankText","globalRankLabel","tableStartY","numPlayers","playersToShow","awardWinners","award","bestPlayer","bestValue","tableWidth","tableX","labelColWidth","tableHeight","currentY","colX","charColor","maxNameLen","activeAwardModal","showAwardModal","modalX","modalY","earnedText","closeHandler","playerAwards","totalWidth","awardIdx","awardX","awardBox","playerAchievements","maxIcons","iconSpacing","achId","achIdx","achX","achBox","moreCount","moreX","bucketSectionY","maxBucketWidth","bucketSpacing","calculatedBucketWidth","bucketWidth","bucketHeight","totalBucketsWidth","bucketStartX","playerBuckets","bucketX","credits","labelSize","currencyLabel","maxParticlesPerPlayer","particleSpawnDelay","particleFallSpeed","animationTimer","animationStartDelay","bucket","bucketIndex","targetParticles","particleValue","spawnTime","targetSpawned","bucketBottom","stackHeight","landingY","killPanelX","killPanelY","killPanelWidth","killPanelHeight","killsByType","sortedKills","killY","killSpacing","maxKillsToShow","showCount","shortName","footerY","xpColor","xpText","currentXP","barX","barY","isHostPlayer","buttonY","MD","buttonGap","playAgainEnabled","playAgainText","playAgainWidth","playAgainHeight","menuWidth","menuHeight","totalButtonWidth","buttonsStartX","playAgainBg","playAgainLabel","menuBg","menuLabel","setupShopScene","preventContextMenu","currentCategory","creditIndicator","tabY","tabSpacing","tabWidth","tabHeight","totalTabWidth","firstTabX","tabButtons","cat","tabX","isActive","tabBg","tabLabel","currentPage","refreshShop","contentY","unlockItems","ITEMS_PER_PAGE","paginationItems","isPurchasing","paginationClickHandled","currentCurrency","tab","updateRefundButton","unlocks","displayUnlocks","unlock","noItemsText","totalPages","startIndex","pageItems","itemSpacing","itemsPerColumn","getBenefitIcon","column","isAchievementLocked","requiredAchievement","isUnlockedChar","isUnlockedWeapon","isMaxedUpgrade","isCosmeticAchievementUnlocked","isOwnedCosmetic","isEquippedCosmetic","contentStartX","cosmeticIcon","cosmeticColor","benefit","benefitIcon","lockIcon","descWidth","descY","descriptionText","achievementProgress","miniBarWidth","miniBarHeight","miniBarX","miniBarY","miniBarBg","miniBarFill","bottomY","buttonX","buttonWidth","buttonHeight","canPurchase","purchaseCost","showProgressBar","progressLevel","progressMax","boosterCount","statusLabel","viewButtonBg","viewButtonText","achievementToShow","lockedText","buttonBg","rightClickHandler","refundMsg","msgText","successMsg","errorMsg","equipButtonBg","equipButtonText","unequipButtonBg","unequipButtonText","noneKey","paginationY","paginationCenterX","pipSpacing","pipsStartX","pipsEndX","arrowOffset","leftArrowX","rightArrowX","leftArrowBg","leftArrowText","rightArrowBg","rightArrowText","isCurrentPage","pipX","pipBg","pipText","pageIndex","refundButton","refundText","refundableAmount","backButton","showResetConfirmationDialog","onConfirm","dialogBg","dialogEntities","closeDialog","cancelButton","cancelText","confirmButton","confirmText","messageText","escapeHandler","setupSettingsScene","fromGame","currentTab","tabs","refreshSettings","bottomButtonArea","settingsItems","addVolumeSlider","addToggle","controls","controlLabels","control","labelText","keyDisplay","keyText","maxContentY","noteText","infoText","exportButton","exportText","exportStatusText","importButton","importText","resetProgressButton","resetProgressText","warningText","onChange","trackWidth","trackHeight","track","getGradientColor","fill","handleX","handle","valueText","dragging","mouseX","trackLeft","localX","updateSlider","newFillWidth","toggleWidth","toggleHeight","toggleX","toggleBg","handleSize","toggleHandle","textX","toggleText","resetButton","hue2rgb","setupStatisticsScene","unlockedAchievements","achievementCategory","ACHIEVEMENTS_PER_PAGE","RUNS_PER_PAGE","isNavigating","selectedAchievement","refreshContent","viewportBottom","contentItems","categoryTabItems","allCategories","panelTop","categoryTabY","categoryTabWidth","categoryTabHeight","categoryTabSpacing","displayCategories","totalCategoryWidth","firstCategoryX","catX","catName","catBg","catLabel","categoryAchievements","pageAchievements","gridTop","boxSize","boxSpacing","boxesPerRow","leftPanelBg","gridPadding","isSelected","boxX","boxY","highlightColor","boxBg","rightPanelX","rightPanelBg","detailCenterX","detailTop","largeIcon","diffName","diffBadge","statusY","progressBgBar","progressFillBar","progressLabel","hintY","hintLabel","promptIcon","promptText","promptText2","goToPage","newPage","isCurrentPip","targetPage","totalAchievements","unlockedCount","progressPercent","isComplete","meterY","meterX","trophyIcon","trophyTime","totalBlocks","filledBlocks","emptyBlocks","meterString","meterFrame","filledMeter","rgb","percentText","sparkleTime","errorText","runHistory","historyY","noHistoryText","endIndex","displayRuns","headers","headerPositions","headerText","run","globalIndex","timeStr","showingStart","showingEnd","totalText","CHAR_ANIM","getUnlockText","setupCharacterSelectScene","selectedChar","characterKeys","leftPanelWidth","rightPanelWidth","cardSpacing","cardsPerRow","rowsPerPage","charactersPerPage","formatName","renderHighlightedDescription","maxWidth","statPattern","matches","baseText","statSummary","highlightText","selectedIndex","characterCards","confirmedCharacterKey","viewedCharacterKey","detailItems","isRefreshing","refreshDisplay","card","pageStart","pageEnd","isViewed","isConfirmedSelection","charVisual","lockText","checkBadge","checkMark","viewedChar","isViewedUnlocked","detailY","previewPanelBg","charGlow","detailVisual","animLoop","breathe","bob","glowIntensity","detailName","descElements","statsLabel","statBarWidth","statBarX","statRowHeight","speedBar","damageBar","selectedIndicator","unlockTextStr","confirmButtonItems","updateConfirmButton","originalRefreshDisplay","initJoinPartyScene","originalState","joinCancelled","inputCode","inputDisplay","isJoining","updateDisplay","display","ch","attemptJoin","TABS","setupLeaderboardsScene","ENTRIES_PER_PAGE","CHARACTERS_PER_PAGE","contentElements","createTab","tabType","refreshTabs","renderContent","renderDailyContent","renderAllTimeContent","renderPersonalContent","renderGlobalContent","allEntries","dateLabel","charLabel","renderLeaderboardHeader","noData","rowY","isPlayer","globalRank","renderLeaderboardRow","renderPaginationControls","personalBests","pageCharacters","colPositions","divider","charKey","bests","scoreText","floorText","timeText","loadingText","retryBg","retryLabel","totalY","isCurrentPagePip","rank","isHighlighted","rankText","highlight","showNameEditDialog","currentName","onSave","inputBg","inputText","infoMsg","saveButton","saveText","charHandler","backspaceHandler","enterHandler","setupProfileScene","externalProfile","isViewingOther","selectedPortraitId","profileStats","profileLevel","profileXP","profileName","profileUnlockedPortraits","currentPortrait","infoY","nameDisplay","randomButtonX","editButtonX","editButton","newName","randomButton","stars","starDisplay","portraitsY","portraitsSectionHeight","allPortraits","maxPerRow","gridY","selectedInfoText","selectedDescText","updateSelectedInfo","boxColor","portraitBox","displayColor","statsY","statsHeight","totalRuns","avgCurrency","avgFloors","avgRooms","fastestTime","fastestMin","fastestSec","fastestDisplay","row1Stats","statWidth","playTime","hours","kaplay"],"mappings":"ssBAAA,IAAIA,IAAI,IAAI,CAAC,QAAQC,EAAE,IAAI,WAAW,GAAG,EAAEC,EAAE,EAAEA,EAAE,GAAGA,IAAID,EAAEC,EAAE,GAAGA,EAAE,GAAGA,EAAE,GAAGA,EAAE,GAAGA,EAAE,GAAGA,EAAE,EAAEA,EAAE,EAAE,GAAG,EAAEA,EAAE,OAAO,GAAG,CAAC,QAAQC,EAAE,EAAE,OAAOC,EAAE,IAAI,YAAYD,GAAG,EAAEA,EAAE,CAAC,GAAG,MAAM,EAAEA,EAAE,CAAC,GAAG,MAAM,EAAE,EAAE,CAAC,EAAE,EAAE,EAAEE,EAAE,EAAE,EAAEF,GAAG,CAAC,IAAIG,EAAEL,EAAE,EAAE,WAAW,GAAG,CAAC,EAAEM,EAAEN,EAAE,EAAE,WAAW,GAAG,CAAC,EAAEO,EAAEP,EAAE,EAAE,WAAW,GAAG,CAAC,EAAEQ,EAAER,EAAE,EAAE,WAAW,GAAG,CAAC,EAAEG,EAAEC,GAAG,EAAEC,GAAG,EAAEC,GAAG,EAAEH,EAAEC,GAAG,EAAEE,GAAG,EAAEC,GAAG,EAAEJ,EAAEC,GAAG,EAAEG,GAAG,EAAEC,CAAC,CAAC,OAAOL,CAAC,CAAC,GAAC,EAAQM,GAAG,CAAoJ,QAAQ,WAAsyD,EAAE,SAASC,GAAGV,EAAEC,EAAE,EAAE,CAAC,OAAOA,EAAE,EAAES,GAAGV,EAAE,EAAEC,CAAC,EAAE,KAAK,IAAI,KAAK,IAAID,EAAEC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAIU,GAAE,MAAMX,EAAC,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,YAAYC,EAAE,EAAEC,EAAE,CAAC,KAAK,EAAEQ,GAAGT,EAAE,EAAE,GAAG,EAAE,KAAK,EAAES,GAAG,EAAE,EAAE,GAAG,EAAE,KAAK,EAAEA,GAAGR,EAAE,EAAE,GAAG,CAAC,CAAC,OAAO,UAAUD,EAAE,CAAC,OAAO,IAAID,GAAEC,EAAE,CAAC,EAAEA,EAAE,CAAC,EAAEA,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,QAAQA,EAAE,CAAC,GAAG,OAAOA,GAAG,SAAS,OAAO,IAAID,GAAEC,GAAG,GAAG,IAAIA,GAAG,EAAE,IAAIA,GAAG,EAAE,GAAG,EAAE,GAAG,OAAOA,GAAG,SAAS,CAAC,IAAI,EAAE,4CAA4C,KAAKA,CAAC,EAAE,GAAG,CAAC,EAAE,MAAM,IAAI,MAAM,0BAA0B,EAAE,OAAO,IAAID,GAAE,SAAS,EAAE,CAAC,EAAE,EAAE,EAAE,SAAS,EAAE,CAAC,EAAE,EAAE,EAAE,SAAS,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,KAAM,OAAM,IAAI,MAAM,0BAA0B,CAAC,CAAC,OAAO,QAAQC,EAAE,EAAEC,EAAE,CAAC,GAAG,GAAG,EAAE,OAAO,IAAIF,GAAE,IAAIE,EAAE,IAAIA,EAAE,IAAIA,CAAC,EAAE,IAAIC,EAAE,CAACK,EAAEI,EAAEC,KAAKA,EAAE,IAAIA,GAAG,GAAGA,EAAE,IAAIA,GAAG,GAAGA,EAAE,EAAE,EAAEL,GAAGI,EAAEJ,GAAG,EAAEK,EAAEA,EAAE,EAAE,EAAED,EAAEC,EAAE,EAAE,EAAEL,GAAGI,EAAEJ,IAAI,EAAE,EAAEK,GAAG,EAAEL,GAAG,EAAEN,EAAE,GAAGA,GAAG,EAAE,GAAGA,EAAE,EAAEA,EAAE,EAAEE,EAAE,EAAEF,EAAE,EAAEG,EAAEF,EAAEC,EAAE,EAAEH,EAAE,EAAE,CAAC,EAAEK,EAAEH,EAAEC,EAAE,EAAEH,CAAC,EAAEM,EAAEJ,EAAEC,EAAE,EAAEH,EAAE,EAAE,CAAC,EAAE,OAAO,IAAID,GAAE,KAAK,MAAMK,EAAE,GAAG,EAAE,KAAK,MAAMC,EAAE,GAAG,EAAE,KAAK,MAAMC,EAAE,GAAG,CAAC,CAAC,CAAC,OAAO,IAAI,IAAIP,GAAE,IAAI,EAAE,CAAC,EAAE,OAAO,MAAM,IAAIA,GAAE,EAAE,IAAI,CAAC,EAAE,OAAO,KAAK,IAAIA,GAAE,EAAE,EAAE,GAAG,EAAE,OAAO,OAAO,IAAIA,GAAE,IAAI,IAAI,CAAC,EAAE,OAAO,QAAQ,IAAIA,GAAE,IAAI,EAAE,GAAG,EAAE,OAAO,KAAK,IAAIA,GAAE,EAAE,IAAI,GAAG,EAAE,OAAO,MAAM,IAAIA,GAAE,IAAI,IAAI,GAAG,EAAE,OAAO,MAAM,IAAIA,GAAE,EAAE,EAAE,CAAC,EAAE,OAAO,CAAC,OAAO,IAAIA,GAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,QAAQC,EAAE,CAAC,OAAO,IAAID,GAAE,KAAK,EAAEC,EAAE,KAAK,EAAEA,EAAE,KAAK,EAAEA,CAAC,CAAC,CAAC,OAAOA,EAAE,CAAC,OAAO,KAAK,QAAQ,CAACA,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,IAAID,GAAE,IAAI,KAAK,EAAE,IAAI,KAAK,EAAE,IAAI,KAAK,CAAC,CAAC,CAAC,KAAKC,EAAE,CAAC,OAAO,IAAID,GAAE,KAAK,EAAEC,EAAE,EAAE,IAAI,KAAK,EAAEA,EAAE,EAAE,IAAI,KAAK,EAAEA,EAAE,EAAE,GAAG,CAAC,CAAC,KAAKA,EAAE,EAAE,CAAC,OAAO,IAAID,GAAEc,GAAG,KAAK,EAAEb,EAAE,EAAE,CAAC,EAAEa,GAAG,KAAK,EAAEb,EAAE,EAAE,CAAC,EAAEa,GAAG,KAAK,EAAEb,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAIA,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,IAAIC,EAAE,KAAK,EAAE,IAAIC,EAAE,KAAK,IAAIF,EAAE,EAAEC,CAAC,EAAE,EAAE,KAAK,IAAID,EAAE,EAAEC,CAAC,EAAEE,GAAGD,EAAE,GAAG,EAAEE,EAAED,EAAEE,EAAEF,EAAE,GAAGD,GAAG,EAAEC,EAAEC,EAAE,MAAM,CAAC,IAAIE,EAAEJ,EAAE,EAAE,OAAOE,EAAEC,EAAE,GAAGC,GAAG,EAAEJ,EAAE,GAAGI,GAAGJ,EAAE,GAAGA,EAAC,CAAE,KAAKF,EAAEG,GAAG,EAAEF,GAAGK,GAAG,EAAEL,EAAE,EAAE,GAAG,MAAM,KAAK,EAAEE,GAAGF,EAAED,GAAGM,EAAE,EAAE,MAAM,KAAKL,EAAEE,GAAGH,EAAE,GAAGM,EAAE,EAAE,KAAK,CAACH,GAAG,CAAC,CAAC,MAAM,CAACA,EAAEC,EAAEC,CAAC,CAAC,CAAC,GAAGL,EAAE,CAAC,OAAO,KAAK,IAAIA,EAAE,GAAG,KAAK,IAAIA,EAAE,GAAG,KAAK,IAAIA,EAAE,CAAC,CAAC,UAAU,CAAC,MAAM,OAAO,KAAK,CAAC,KAAK,KAAK,CAAC,KAAK,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,MAAM,GAAG,KAAK,KAAK,GAAG,KAAK,KAAK,GAAG,GAAG,KAAK,GAAG,SAAS,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,SAASc,MAAKf,EAAE,CAAC,GAAGA,EAAE,SAAS,EAAE,OAAO,IAAIW,GAAE,IAAI,IAAI,GAAG,EAAE,GAAGX,EAAE,SAAS,EAAE,CAAC,GAAGA,EAAE,CAAC,YAAYW,GAAE,OAAOX,EAAE,CAAC,EAAE,MAAK,EAAG,GAAG,OAAOA,EAAE,CAAC,GAAG,SAAS,OAAOW,GAAE,QAAQX,EAAE,CAAC,CAAC,EAAE,GAAG,MAAM,QAAQA,EAAE,CAAC,CAAC,GAAGA,EAAE,CAAC,EAAE,SAAS,EAAE,OAAOW,GAAE,UAAUX,EAAE,CAAC,CAAC,CAAC,SAASA,EAAE,SAAS,GAAG,GAAGA,EAAE,CAAC,YAAYW,GAAE,OAAOX,EAAE,CAAC,EAAE,MAAK,UAAWA,EAAE,SAAS,GAAGA,EAAE,SAAS,EAAE,OAAO,IAAIW,GAAEX,EAAE,CAAC,EAAEA,EAAE,CAAC,EAAEA,EAAE,CAAC,CAAC,EAAE,MAAM,IAAI,MAAM,yBAAyB,CAAC,CAAC,IAAIgB,GAAG,CAAChB,EAAEC,EAAE,IAAIU,GAAE,QAAQX,EAAEC,EAAE,CAAC,EAAE,SAASgB,GAAGjB,EAAE,CAAC,OAAOA,EAAE,KAAK,GAAG,GAAG,CAAC,SAASkB,GAAGlB,EAAE,CAAC,OAAOA,EAAE,IAAI,KAAK,EAAE,CAAC,SAASc,GAAGd,EAAEC,EAAE,EAAE,CAAC,GAAG,OAAOD,GAAG,UAAU,OAAOC,GAAG,SAAS,OAAOD,GAAGC,EAAED,GAAG,EAAuD,GAAlDA,aAAamB,IAAGlB,aAAakB,IAAwBnB,aAAaW,IAAGV,aAAaU,GAAE,OAAOX,EAAE,KAAKC,EAAE,CAAC,EAAE,MAAM,IAAI,MAAM,yBAAyBD,CAAC,KAAKC,CAAC,6CAA6C,CAAC,CAAC,SAASmB,GAAGpB,EAAEC,EAAE,EAAEC,EAAEC,EAAE,CAAC,OAAOD,GAAGF,EAAEC,IAAI,EAAEA,IAAIE,EAAED,EAAE,CAAC,SAASmB,GAAGrB,EAAEC,EAAE,EAAEC,EAAEC,EAAE,CAAC,OAAOO,GAAGU,GAAGpB,EAAEC,EAAE,EAAEC,EAAEC,CAAC,EAAED,EAAEC,CAAC,CAAC,CAAC,IAAIgB,GAAE,MAAMnB,EAAC,CAAC,EAAE,EAAE,EAAE,EAAE,YAAYC,EAAE,EAAE,EAAEA,EAAE,CAAC,KAAK,EAAEA,EAAE,KAAK,EAAE,CAAC,CAAC,OAAO,UAAUA,EAAE,CAAC,IAAI,EAAEgB,GAAGhB,CAAC,EAAE,OAAO,IAAID,GAAE,KAAK,IAAI,CAAC,EAAE,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,UAAUC,EAAE,CAAC,OAAO,IAAID,GAAEC,EAAE,CAAC,EAAEA,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,KAAK,IAAID,GAAE,EAAE,CAAC,EAAE,OAAO,IAAI,IAAIA,GAAE,EAAE,CAAC,EAAE,OAAO,KAAK,IAAIA,GAAE,GAAG,CAAC,EAAE,OAAO,MAAM,IAAIA,GAAE,EAAE,CAAC,EAAE,OAAO,GAAG,IAAIA,GAAE,EAAE,EAAE,EAAE,OAAO,KAAK,IAAIA,GAAE,EAAE,CAAC,EAAE,OAAO,CAAC,OAAO,IAAIA,GAAE,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,OAAOC,EAAE,CAAC,IAAI,EAAEqB,EAAE,GAAGrB,CAAC,EAAE,OAAO,IAAID,GAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,OAAOC,EAAE,CAAC,IAAI,EAAEqB,EAAE,GAAGrB,CAAC,EAAE,OAAO,IAAID,GAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,SAASC,EAAE,CAAC,IAAI,EAAEqB,EAAE,GAAGrB,CAAC,EAAE,OAAO,IAAID,GAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQC,EAAE,CAAC,IAAI,EAAEqB,EAAE,GAAGrB,CAAC,EAAE,OAAO,KAAK,IAAI,CAAC,EAAE,IAAG,CAAE,CAAC,SAASA,EAAE,CAAC,IAAI,EAAEqB,EAAE,GAAGrB,CAAC,EAAE,OAAO,KAAK,IAAI,CAAC,EAAE,KAAI,CAAE,CAAC,OAAO,MAAMA,EAAE,EAAE,CAAC,IAAIC,EAAED,EAAE,EAAE,EAAE,EAAEE,EAAEF,EAAE,EAAE,EAAE,EAAE,OAAOC,EAAEA,EAAEC,EAAEA,CAAC,CAAC,KAAK,CAAC,OAAO,KAAK,KAAK,KAAK,IAAI,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,KAAK,IAAI,IAAI,CAAC,CAAC,MAAM,CAAC,IAAIF,EAAE,KAAK,IAAG,EAAG,OAAOA,IAAI,EAAE,IAAID,GAAE,CAAC,EAAE,KAAK,MAAM,EAAEC,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,IAAID,GAAE,KAAK,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,QAAQC,EAAE,CAAC,OAAO,KAAK,IAAIA,EAAE,MAAM,EAAE,KAAK,IAAIA,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQA,EAAE,CAAC,OAAOA,EAAE,MAAMA,EAAE,IAAI,IAAI,EAAEA,EAAE,IAAG,CAAE,CAAC,CAAC,OAAOA,EAAE,CAAC,OAAO,KAAK,IAAI,KAAK,QAAQA,CAAC,CAAC,CAAC,CAAC,IAAIA,EAAE,CAAC,OAAO,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,CAAC,CAAC,OAAO,IAAIA,EAAE,EAAE,CAAC,OAAOA,EAAE,EAAE,EAAE,EAAEA,EAAE,EAAE,EAAE,CAAC,CAAC,MAAMA,EAAE,CAAC,OAAO,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,CAAC,CAAC,OAAO,MAAMA,EAAE,EAAE,CAAC,OAAOA,EAAE,EAAE,EAAE,EAAEA,EAAE,EAAE,EAAE,CAAC,CAAC,SAASA,EAAE,CAAC,IAAI,EAAEqB,EAAE,GAAGrB,CAAC,EAAE,OAAOiB,GAAG,KAAK,MAAM,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,gBAAgBjB,EAAE,CAAC,IAAI,EAAEqB,EAAE,GAAGrB,CAAC,EAAE,OAAOiB,GAAG,KAAK,MAAM,KAAK,MAAM,CAAC,EAAE,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,KAAKjB,EAAE,EAAE,CAAC,OAAO,IAAID,GAAEc,GAAG,KAAK,EAAEb,EAAE,EAAE,CAAC,EAAEa,GAAG,KAAK,EAAEb,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,MAAMA,EAAE,EAAE,CAAC,IAAIC,EAAE,KAAK,IAAID,CAAC,EAAEE,EAAE,KAAK,MAAMF,CAAC,EAAE,EAAE,KAAK,MAAME,EAAED,CAAC,EAAE,OAAO,KAAK,MAAM,KAAK,KAAK,EAAE,GAAG,CAAC,CAAC,EAAE,IAAID,EAAE,MAAM,KAAK,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE,MAAM,EAAEE,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,KAAK,IAAI,GAAG,KAAK,IAAI,CAAC,CAAC,QAAQF,EAAE,CAAC,OAAO,IAAID,GAAE,OAAO,KAAK,EAAE,QAAQC,CAAC,CAAC,EAAE,OAAO,KAAK,EAAE,QAAQA,CAAC,CAAC,CAAC,CAAC,CAAC,UAAUA,EAAE,CAAC,OAAOA,EAAE,SAAS,IAAI,CAAC,CAAC,GAAGA,EAAE,CAAC,OAAO,KAAK,IAAIA,EAAE,GAAG,KAAK,IAAIA,EAAE,CAAC,CAAC,MAAM,CAAC,OAAO,IAAIsB,GAAE,KAAK,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,MAAM,QAAQ,KAAK,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,EAAE,QAAQ,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,SAASD,KAAKtB,EAAE,CAAC,GAAGA,EAAE,SAAS,EAAE,CAAC,GAAGA,EAAE,CAAC,YAAYmB,GAAE,OAAO,IAAIA,GAAEnB,EAAE,CAAC,EAAE,EAAEA,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,MAAM,QAAQA,EAAE,CAAC,CAAC,GAAGA,EAAE,CAAC,EAAE,SAAS,EAAE,OAAO,IAAImB,GAAE,GAAGnB,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,IAAImB,GAAE,GAAGnB,CAAC,CAAC,CAAC,IAAIwB,GAAE,MAAMxB,EAAC,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,YAAYC,EAAE,EAAEC,EAAEC,EAAE,CAAC,KAAK,EAAEF,EAAE,KAAK,EAAE,EAAE,KAAK,EAAEC,EAAE,KAAK,EAAEC,CAAC,CAAC,MAAMF,EAAE,CAAC,OAAO,IAAID,GAAE,KAAK,EAAE,KAAK,EAAEC,EAAE,EAAE,KAAK,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,IAAIkB,GAAE,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,IAAInB,GAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,GAAGC,EAAE,CAAC,OAAO,KAAK,IAAIA,EAAE,GAAG,KAAK,IAAIA,EAAE,GAAG,KAAK,IAAIA,EAAE,GAAG,KAAK,IAAIA,EAAE,CAAC,CAAC,UAAU,CAAC,MAAM,QAAQ,KAAK,CAAC,KAAK,KAAK,CAAC,KAAK,KAAK,CAAC,KAAK,KAAK,CAAC,GAAG,CAAC,EAAE,SAASwB,GAAGzB,EAAEC,EAAE,EAAEC,EAAE,CAAC,OAAO,IAAIsB,GAAExB,EAAEC,EAAE,EAAEC,CAAC,CAAC,CAAC,IAAIwB,GAAG,MAAM1B,EAAC,CAAC,EAAE,EAAE,EAAE,EAAE,YAAYC,EAAE,EAAEC,EAAEC,EAAE,CAAC,KAAK,EAAEF,EAAE,KAAK,EAAE,EAAE,KAAK,EAAEC,EAAE,KAAK,EAAEC,CAAC,CAAC,IAAIF,EAAE,CAAC,OAAO,IAAID,GAAE,KAAK,EAAEC,EAAE,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,CAAC,CAAC,CAAC,UAAUA,EAAE,CAAC,OAAOqB,EAAE,KAAK,EAAErB,EAAE,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,EAAE,KAAK,EAAEA,EAAE,CAAC,CAAC,CAAC,IAAI,SAAS,CAAC,IAAIA,EAAE,KAAK,IAAI,OAAO,IAAID,GAAE,KAAK,EAAEC,EAAE,CAAC,KAAK,EAAEA,EAAE,CAAC,KAAK,EAAEA,EAAE,KAAK,EAAEA,CAAC,CAAC,CAAC,IAAI,WAAW,CAAC,OAAO,IAAID,GAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,IAAI,aAAa,CAAC,IAAIC,EAAE,KAAK,MAAM,EAAE,EAAE,KAAK,IAAIC,EAAED,EAAE,KAAK,KAAKA,EAAEA,EAAE,CAAC,EAAEE,EAAEF,EAAE,KAAK,KAAKA,EAAEA,EAAE,CAAC,EAAE,MAAM,CAACC,EAAEC,CAAC,CAAC,CAAC,aAAaF,EAAE,EAAE,CAAC,OAAO,KAAK,GAAG,EAAE,CAAC,CAACA,EAAE,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,GAAG,EAAE,CAAC,CAAC,KAAK,EAAEA,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,IAAI,KAAK,UAAUqB,EAAE,EAAE,CAAC,CAAC,EAAE,EAAErB,CAAC,EAAE,OAAO,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,OAAO,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,OAAO,CAAC,OAAO,KAAK,EAAE,KAAK,CAAC,CAAC,OAAO,SAASA,EAAE,CAAC,IAAI,EAAE,KAAK,IAAIA,CAAC,EAAEC,EAAE,KAAK,IAAID,CAAC,EAAE,OAAO,IAAID,GAAE,EAAEE,EAAE,CAACA,EAAE,CAAC,CAAC,CAAC,OAAO,MAAMD,EAAE,EAAE,CAAC,OAAO,IAAID,GAAEC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,EAAM0B,GAAG,MAAM3B,EAAC,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,YAAYC,EAAE,EAAEC,EAAEC,EAAE,EAAEC,EAAEC,EAAEC,EAAEC,EAAE,CAAC,KAAK,IAAIN,EAAE,KAAK,IAAI,EAAE,KAAK,IAAIC,EAAE,KAAK,IAAIC,EAAE,KAAK,IAAI,EAAE,KAAK,IAAIC,EAAE,KAAK,IAAIC,EAAE,KAAK,IAAIC,EAAE,KAAK,IAAIC,CAAC,CAAC,OAAO,SAASN,EAAE,CAAC,OAAO,IAAID,GAAEC,EAAE,EAAEA,EAAE,EAAE,EAAEA,EAAE,EAAEA,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,IAAIyB,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,GAAG,CAAC,CAAC,IAAIzB,EAAE,CAAC,OAAO,IAAID,GAAE,KAAK,IAAIC,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,IAAI,KAAK,IAAIA,EAAE,GAAG,CAAC,CAAC,IAAI,KAAK,CAAC,OAAO,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,GAAG,CAAC,OAAOA,EAAE,CAAC,IAAI,EAAE,KAAK,IAAIA,CAAC,EAAEC,EAAE,KAAK,IAAID,CAAC,EAAEE,EAAE,KAAK,IAAI,EAAE,KAAK,IAAI,OAAO,KAAK,IAAI,EAAE,KAAK,IAAID,EAAE,KAAK,IAAI,KAAK,IAAI,EAAE,KAAK,IAAIA,EAAE,KAAK,IAAI,KAAK,IAAI,EAAE,KAAK,IAAIA,EAAEC,EAAE,KAAK,IAAI,EAAE,KAAK,IAAID,EAAE,EAAE,IAAI,CAAC,MAAMD,EAAE,EAAE,CAAC,OAAO,KAAK,KAAKA,EAAE,KAAK,KAAKA,EAAE,KAAK,KAAK,EAAE,KAAK,KAAK,EAAE,IAAI,CAAC,IAAI,SAAS,CAAC,IAAIA,EAAE,KAAK,IAAI,OAAO,IAAID,IAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,KAAKC,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,KAAKA,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,KAAKA,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,KAAKA,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,KAAKA,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,KAAKA,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,KAAKA,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,KAAKA,GAAG,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,KAAKA,CAAC,CAAC,CAAC,IAAI,WAAW,CAAC,OAAO,IAAID,GAAE,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,KAAK,GAAG,CAAC,CAAC,EAAE4B,GAAG,MAAM5B,EAAC,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,YAAYC,EAAE,CAACA,IAAI,KAAK,EAAEA,EAAE,CAAC,OAAO,UAAUA,EAAE,CAAC,OAAO,IAAID,GAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAEC,EAAE,EAAEA,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,MAAMA,EAAE,CAAC,OAAO,IAAID,GAAE,CAACC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAEA,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,QAAQA,EAAE,CAACA,EAAEgB,GAAG,CAAChB,CAAC,EAAE,IAAI,EAAE,KAAK,IAAIA,CAAC,EAAEC,EAAE,KAAK,IAAID,CAAC,EAAE,OAAO,IAAID,GAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAACE,EAAE,EAAE,EAAEA,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,QAAQD,EAAE,CAACA,EAAEgB,GAAG,CAAChB,CAAC,EAAE,IAAI,EAAE,KAAK,IAAIA,CAAC,EAAEC,EAAE,KAAK,IAAID,CAAC,EAAE,OAAO,IAAID,GAAE,CAAC,EAAE,EAAEE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAACA,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,QAAQD,EAAE,CAACA,EAAEgB,GAAG,CAAChB,CAAC,EAAE,IAAI,EAAE,KAAK,IAAIA,CAAC,EAAEC,EAAE,KAAK,IAAID,CAAC,EAAE,OAAO,IAAID,GAAE,CAAC,EAAE,CAACE,EAAE,EAAE,EAAEA,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,UAAUD,EAAE,CAAC,OAAO,KAAK,EAAE,EAAE,GAAG,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,KAAK,EAAE,EAAE,GAAG,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,KAAK,EAAE,EAAE,GAAG,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,KAAK,EAAE,EAAE,GAAG,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,IAAI,CAAC,MAAMA,EAAE,CAAC,OAAO,KAAK,EAAE,CAAC,GAAGA,EAAE,EAAE,KAAK,EAAE,CAAC,GAAGA,EAAE,EAAE,KAAK,EAAE,CAAC,GAAGA,EAAE,EAAE,KAAK,EAAE,CAAC,GAAGA,EAAE,EAAE,KAAK,EAAE,CAAC,GAAGA,EAAE,EAAE,KAAK,EAAE,CAAC,GAAGA,EAAE,EAAE,KAAK,EAAE,CAAC,GAAGA,EAAE,EAAE,KAAK,EAAE,CAAC,GAAGA,EAAE,EAAE,IAAI,CAAC,OAAOA,EAAE,CAACA,EAAEgB,GAAG,CAAChB,CAAC,EAAE,IAAI,EAAE,KAAK,IAAIA,CAAC,EAAEC,EAAE,KAAK,IAAID,CAAC,EAAEE,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,OAAO,KAAK,EAAE,CAAC,EAAEF,EAAE,EAAE,EAAED,EAAE,KAAK,EAAE,CAAC,EAAE,CAACC,EAAED,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEE,EAAE,EAAEC,EAAEH,EAAE,KAAK,EAAE,CAAC,EAAE,CAACE,EAAEF,EAAEG,EAAE,EAAE,IAAI,CAAC,KAAKJ,EAAE,CAAC,IAAI,EAAE,CAAA,EAAG,QAAQC,EAAE,EAAEA,EAAE,EAAEA,IAAI,QAAQC,EAAE,EAAEA,EAAE,EAAEA,IAAI,EAAED,EAAE,EAAEC,CAAC,EAAE,KAAK,EAAE,EAAIA,CAAC,EAAEF,EAAE,EAAEC,EAAE,EAAE,CAAC,EAAE,KAAK,EAAE,EAAIC,CAAC,EAAEF,EAAE,EAAEC,EAAE,EAAE,CAAC,EAAE,KAAK,EAAE,EAAIC,CAAC,EAAEF,EAAE,EAAEC,EAAE,EAAE,CAAC,EAAE,KAAK,EAAE,GAAIC,CAAC,EAAEF,EAAE,EAAEC,EAAE,EAAE,CAAC,EAAE,OAAO,IAAIF,GAAE,CAAC,CAAC,CAAC,SAASC,EAAE,CAAC,OAAO,IAAIkB,GAAElB,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAEA,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEA,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,gBAAgB,CAAC,OAAO,IAAIkB,GAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,GAAG,KAAK,EAAE,CAAC,GAAG,EAAE,CAAC,IAAIlB,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,KAAK,KAAK,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,IAAIkB,GAAE,EAAElB,EAAE,CAAC,CAAC,SAAS,KAAK,EAAE,CAAC,GAAG,GAAG,KAAK,EAAE,CAAC,GAAG,EAAE,CAAC,IAAIA,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,KAAK,KAAK,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,IAAIkB,GAAElB,EAAE,EAAE,CAAC,CAAC,KAAM,QAAO,IAAIkB,GAAE,EAAE,CAAC,CAAC,CAAC,aAAa,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,GAAG,KAAK,EAAE,CAAC,GAAG,EAAE,CAAC,IAAIlB,EAAE,KAAK,KAAK,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,OAAOiB,GAAG,KAAK,EAAE,CAAC,EAAE,EAAE,KAAK,KAAK,KAAK,EAAE,CAAC,EAAEjB,CAAC,EAAE,CAAC,KAAK,KAAK,KAAK,EAAE,CAAC,EAAEA,CAAC,CAAC,CAAC,SAAS,KAAK,EAAE,CAAC,GAAG,GAAG,KAAK,EAAE,CAAC,GAAG,EAAE,CAAC,IAAIA,EAAE,KAAK,KAAK,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,OAAOiB,GAAG,KAAK,GAAG,GAAG,KAAK,EAAE,CAAC,EAAE,EAAE,KAAK,KAAK,CAAC,KAAK,EAAE,CAAC,EAAEjB,CAAC,EAAE,CAAC,KAAK,KAAK,KAAK,EAAE,CAAC,EAAEA,CAAC,EAAE,CAAC,KAAM,OAAO,EAAC,CAAC,SAAS,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,GAAG,KAAK,EAAE,CAAC,GAAG,EAAE,CAAC,IAAIA,EAAE,KAAK,KAAK,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,IAAIkB,GAAE,KAAK,KAAK,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,GAAGlB,EAAEA,GAAG,CAAC,CAAC,SAAS,KAAK,EAAE,CAAC,GAAG,GAAG,KAAK,EAAE,CAAC,GAAG,EAAE,CAAC,IAAIA,EAAE,KAAK,KAAK,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,IAAIkB,GAAE,EAAE,KAAK,KAAK,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,GAAGlB,EAAEA,EAAE,CAAC,KAAM,QAAO,IAAIkB,GAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAIlB,EAAE,GAAG,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEI,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEgB,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAEC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK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","x_google_ignoreList":[0,10,11,12,13,14,15,16,17]}